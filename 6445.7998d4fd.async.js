!(function(){var Z_=(rr,J,L)=>new Promise((re,pe)=>{var _=he=>{try{U(L.next(he))}catch(ae){pe(ae)}},le=he=>{try{U(L.throw(he))}catch(ae){pe(ae)}},U=he=>he.done?re(he.value):Promise.resolve(he.value).then(_,le);U((L=L.apply(rr,J)).next())});(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[6445],{4638:function(rr,J,L){"use strict";var re=L(50959),pe=L(38551),_=function(){return _=Object.assign||function(U){for(var he,ae=1,qe=arguments.length;ae<qe;ae++){he=arguments[ae];for(var ie in he)Object.prototype.hasOwnProperty.call(he,ie)&&(U[ie]=he[ie])}return U},_.apply(this,arguments)},le=function(U){return re.createElement(pe.P,_({},U,{chartType:"Area"}))};J.Z=le},71463:function(rr,J,L){"use strict";var re=L(50959),pe=L(38551),_=function(){return _=Object.assign||function(U){for(var he,ae=1,qe=arguments.length;ae<qe;ae++){he=arguments[ae];for(var ie in he)Object.prototype.hasOwnProperty.call(he,ie)&&(U[ie]=he[ie])}return U},_.apply(this,arguments)},le=function(U){return re.createElement(pe.P,_({},U,{chartType:"Gauge"}))};J.Z=le},82283:function(rr,J,L){"use strict";var re=L(50959),pe=L(38551),_=function(){return _=Object.assign||function(U){for(var he,ae=1,qe=arguments.length;ae<qe;ae++){he=arguments[ae];for(var ie in he)Object.prototype.hasOwnProperty.call(he,ie)&&(U[ie]=he[ie])}return U},_.apply(this,arguments)},le=function(U){return re.createElement(pe.P,_({},U,{chartType:"Liquid"}))};J.Z=le},17103:function(rr,J,L){"use strict";var re=L(50959),pe=L(38551),_=function(){return _=Object.assign||function(U){for(var he,ae=1,qe=arguments.length;ae<qe;ae++){he=arguments[ae];for(var ie in he)Object.prototype.hasOwnProperty.call(he,ie)&&(U[ie]=he[ie])}return U},_.apply(this,arguments)},le=function(U){return re.createElement(pe.P,_({},U,{chartType:"WordCloud"}))};J.Z=le},19494:function(rr,J,L){"use strict";L.d(J,{f:function(){return mt}});var re=L(73273),pe=L(56197),_=L(84875),le=L.n(_),U=L(50959),he=L(169),ae=L(33346),qe=L(26488),ie=function(Yt){return(0,re.Z)({},Yt.componentCls,{width:"100%","&-wide":{maxWidth:1152,margin:"0 auto"}})};function Ke(Dt){return(0,qe.Xj)("ProLayoutGridContent",function(Yt){var Ht=(0,ae.Z)((0,ae.Z)({},Yt),{},{componentCls:".".concat(Dt)});return[ie(Ht)]})}var ht=L(11527),mt=function(Yt){var Ht=(0,U.useContext)(he.X),ir=Yt.children,Xt=Yt.contentWidth,yt=Yt.className,bt=Yt.style,Pr=(0,U.useContext)(pe.ZP.ConfigContext),hr=Pr.getPrefixCls,ur=Yt.prefixCls||hr("pro"),Et=Xt||Ht.contentWidth,nt="".concat(ur,"-grid-content"),Pt=Ke(nt),ft=Pt.wrapSSR,qt=Pt.hashId,Sr=Et==="Fixed"&&Ht.layout==="top";return ft((0,ht.jsx)("div",{className:le()(nt,qt,yt,(0,re.Z)({},"".concat(nt,"-wide"),Sr)),style:bt,children:(0,ht.jsx)("div",{className:"".concat(ur,"-grid-content-children ").concat(qt).trim(),children:ir})}))}},27449:function(rr,J,L){"use strict";L.d(J,{S:function(){return ae}});var re=L(33346),pe=L(10570),_=L(38705),le=L(50959),U=L(11527),he=["isLoading","pastDelay","timedOut","error","retry"],ae=function(ie){var Ke=ie.isLoading,ht=ie.pastDelay,mt=ie.timedOut,Dt=ie.error,Yt=ie.retry,Ht=(0,pe.Z)(ie,he);return(0,U.jsx)("div",{style:{paddingBlockStart:100,textAlign:"center"},children:(0,U.jsx)(_.Z,(0,re.Z)({size:"large"},Ht))})}},169:function(rr,J,L){"use strict";L.d(J,{X:function(){return pe}});var re=L(50959),pe=(0,re.createContext)({})},18735:function(){window._iconfont_svg_string_3580659='<svg><symbol id="l7-icon-area1" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.064889 219.136l38.798223 466.261333a113.777778 113.777778 0 1 1-133.518223 145.237334H279.210667a113.777778 113.777778 0 1 1-60.302223-137.272889L697.856 227.555556A113.777778 113.777778 0 0 1 796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m577.592889-534.072889L269.198222 796.444444c4.152889 7.168 7.509333 14.791111 10.012445 22.812445h465.578666a114.119111 114.119111 0 0 1 65.479111-71.224889l-38.798222-466.261333a112.924444 112.924444 0 0 1-23.210666-7.964445zM796.444444 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-area" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.008 219.136l38.855112 466.261333a113.777778 113.777778 0 0 1-16.497778 224.540445L853.333333 967.111111a113.777778 113.777778 0 0 1-108.544-79.644444H279.210667a113.834667 113.834667 0 0 1-100.067556 79.36L170.666667 967.111111a113.777778 113.777778 0 0 1-17.066667-226.304l30.492444-351.175111a113.777778 113.777778 0 0 1 34.986667-218.680889L227.555556 170.666667a113.777778 113.777778 0 0 1 99.896888 59.221333l355.84-71.395556a113.777778 113.777778 0 0 1 104.675556-101.262222L796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m526.051555-582.314666L340.650667 296.903111a113.891556 113.891556 0 0 1-88.462223 98.645333l-30.947555 355.84c27.477333 13.653333 48.64 38.115556 58.026667 67.754667h465.521777a114.119111 114.119111 0 0 1 65.536-71.168l-38.855111-466.261333a113.948444 113.948444 0 0 1-74.752-56.206222zM227.555556 238.933333a45.511111 45.511111 0 1 0 0 91.022223 45.511111 45.511111 0 0 0 0-91.022223z m568.888888-113.777777a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-delete" viewBox="0 0 1024 1024"><path d="M705.422222 85.333333a34.133333 34.133333 0 0 1 34.133334 34.133334V227.555556h136.533333a34.133333 34.133333 0 0 1 0 68.266666h-25.543111l-24.348445 610.076445a34.133333 34.133333 0 0 1-34.133333 32.768H231.936a34.133333 34.133333 0 0 1-34.076444-32.768L173.340444 295.822222H147.911111a34.133333 34.133333 0 1 1 0-68.266666H284.444444V119.466667a34.133333 34.133333 0 0 1 34.133334-34.133334h386.844444zM241.720889 295.822222l22.983111 574.577778h494.535111l23.04-574.577778H241.720889zM671.288889 153.6H352.711111V227.555556h318.577778V153.6z"  ></path></symbol><symbol id="l7-icon-color" viewBox="0 0 1024 1024"><path d="M512 56.888889c9.841778 0 19.626667 0.341333 29.354667 0.910222 69.176889 4.437333 119.068444 62.577778 124.302222 131.072l0.455111 9.386667c0.739556 44.600889 15.303111 84.935111 44.999111 114.631111 27.022222 27.022222 62.805333 41.528889 102.570667 44.430222l12.060444 0.568889c72.476444 1.194667 135.793778 52.451556 140.458667 124.757333 1.137778 18.261333 1.251556 36.807111 0.170667 55.637334-13.198222 233.585778-211.399111 424.220444-445.326223 428.714666L512 967.111111a455.111111 455.111111 0 0 1-455.054222-464.156444c4.551111-233.927111 195.185778-432.128 428.771555-445.326223C494.535111 57.116444 503.296 56.888889 512 56.888889z m0 68.266667a385.706667 385.706667 0 0 0-22.414222 0.625777C291.726222 136.988444 129.080889 305.948444 125.155556 504.263111c-4.152889 212.366222 163.100444 387.185778 372.508444 394.353778l13.425778 0.227555 8.533333-0.113777c198.371556-3.811556 367.331556-166.456889 378.538667-364.373334a396.174222 396.174222 0 0 0-0.170667-47.331555c-1.991111-31.232-29.127111-56.604444-67.128889-60.472889l-8.248889-0.455111-14.051555-0.682667c-56.547556-4.209778-107.406222-25.884444-145.806222-64.284444-38.855111-38.798222-60.416-90.225778-64.284445-145.749334l-0.910222-21.333333c-2.901333-38.001778-28.785778-66.048-60.302222-68.096A433.891556 433.891556 0 0 0 512 125.155556zM438.044444 682.666667a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m-170.666666-227.555556a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m142.222222-227.555555a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z"  ></path></symbol><symbol id="l7-icon-base-map" viewBox="0 0 1024 1024"><path d="M923.761778 115.029333A34.133333 34.133333 0 0 1 967.111111 147.911111v624.128a34.133333 34.133333 0 0 1-22.186667 32.028445l-278.755555 103.992888a34.133333 34.133333 0 0 1-23.665778 0.056889L381.724444 812.714667a34.133333 34.133333 0 0 0-23.665777 0.113777L102.968889 908.060444a34.133333 34.133333 0 0 1-45.738667-26.965333L56.888889 876.088889V251.960889a34.133333 34.133333 0 0 1 22.186667-32.028445l278.755555-103.992888a34.133333 34.133333 0 0 1 20.992-0.967112l266.183111 72.988445a34.133333 34.133333 0 0 0 18.204445 0zM403.911111 192.625778v555.576889l216.177778 79.075555V251.960889l-216.177778-59.335111z m-68.266667 4.380444L125.155556 275.569778v551.310222l210.432-78.506667V197.006222zM898.844444 192.853333l-210.545777 58.936889v575.089778l210.545777-78.563556V192.853333z"  ></path></symbol><symbol id="l7-icon-dot" viewBox="0 0 1024 1024"><path d="M341.333333 739.555556a113.777778 113.777778 0 0 1 8.533334 227.271111L341.333333 967.111111a113.777778 113.777778 0 0 1-8.533333-227.271111L341.333333 739.555556z m0 68.266666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM910.222222 341.333333a113.777778 113.777778 0 0 1 8.533334 227.271111L910.222222 568.888889a113.777778 113.777778 0 0 1-8.533333-227.271111L910.222222 341.333333z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM227.555556 56.888889a113.777778 113.777778 0 0 1 8.533333 227.271111L227.555556 284.444444a113.777778 113.777778 0 0 1-8.533334-227.271111L227.555556 56.888889z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-display" viewBox="0 0 1024 1024"><path d="M512 170.666667c284.444444 0 455.111111 227.555556 455.111111 341.333333s-170.666667 341.333333-455.111111 341.333333-455.111111-227.555556-455.111111-341.333333 170.666667-341.333333 455.111111-341.333333z m0 68.266666C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 110.762667 178.574222 273.066667 386.844444 273.066667s386.844444-162.304 386.844444-273.066667c0-110.762667-178.574222-273.066667-386.844444-273.066667zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-enlarge" viewBox="0 0 1024 1024"><path d="M546.133333 147.911111l-0.056889 329.955556H876.088889a34.133333 34.133333 0 0 1 0 68.266666H546.076444v329.955556a34.133333 34.133333 0 0 1-68.266666 0V546.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h329.898667V147.911111a34.133333 34.133333 0 0 1 68.266666 0z"  ></path></symbol><symbol id="l7-icon-export-picture" viewBox="0 0 1024 1024"><path d="M883.873684 161.684211a32.336842 32.336842 0 0 1 32.336842 32.336842v582.063158a32.336842 32.336842 0 0 1-32.336842 32.336842H86.231579a32.336842 32.336842 0 0 1-32.336842-32.336842V194.021053a32.336842 32.336842 0 0 1 32.336842-32.336842h797.642105z m-32.336842 64.673684H118.568421v517.389473h170.792421a32.175158 32.175158 0 0 1 0.431158-0.646736l3.772632-4.473264 330.320842-330.374736a32.336842 32.336842 0 0 1 38.588631-5.389474l4.473263 3.018105 184.589474 147.725474V226.357895z m-202.428631 248.131368L379.850105 743.747368H851.536842v-107.304421l-202.428631-161.953684zM323.368421 323.368421a107.789474 107.789474 0 1 1 0 215.578947 107.789474 107.789474 0 0 1 0-215.578947z m0 64.673684a43.115789 43.115789 0 1 0 0 86.231579 43.115789 43.115789 0 0 0 0-86.231579z"  ></path></symbol><symbol id="l7-icon-exit-fullscreen" viewBox="0 0 1024 1024"><path d="M841.955556 591.644444a34.133333 34.133333 0 0 1 5.518222 67.811556l-5.518222 0.455111h-133.745778l192 192.056889a34.133333 34.133333 0 0 1-38.343111 55.182222l-5.176889-2.958222-4.721778-3.982222L659.911111 708.266667V841.955556a34.133333 34.133333 0 0 1-28.615111 33.678222L625.777778 876.088889a34.133333 34.133333 0 0 1-33.678222-28.615111L591.644444 841.955556V625.777778a34.133333 34.133333 0 0 1 28.615112-33.678222L625.777778 591.644444h216.177778z m-443.733334 0a34.133333 34.133333 0 0 1 33.678222 28.615112L432.355556 625.777778v216.177778a34.133333 34.133333 0 0 1-67.811556 5.518222L364.088889 841.955556v-133.745778l-192.056889 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L315.847111 659.911111H182.044444a34.133333 34.133333 0 0 1-33.678222-28.615111L147.911111 625.777778a34.133333 34.133333 0 0 1 28.615111-33.678222L182.044444 591.644444H398.222222zM167.310222 119.808l4.721778 3.982222L364.088889 315.847111V182.044444a34.133333 34.133333 0 0 1 28.615111-33.678222L398.222222 147.911111a34.133333 34.133333 0 0 1 33.678222 28.615111L432.355556 182.044444V398.222222a34.133333 34.133333 0 0 1-28.615112 33.678222L398.222222 432.355556H182.044444a34.133333 34.133333 0 0 1-5.518222-67.811556L182.044444 364.088889h133.802667L123.790222 172.032a34.133333 34.133333 0 0 1 43.52-52.224z m732.899556 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L708.266667 364.088889H841.955556a34.133333 34.133333 0 0 1 33.678222 28.615111L876.088889 398.222222a34.133333 34.133333 0 0 1-28.615111 33.678222L841.955556 432.355556H625.777778a34.133333 34.133333 0 0 1-33.678222-28.615112L591.644444 398.222222V182.044444a34.133333 34.133333 0 0 1 67.811556-5.518222l0.455111 5.518222v133.802667l192.056889-192.056889a34.133333 34.133333 0 0 1 48.241778 0z"  ></path></symbol><symbol id="l7-icon-line" viewBox="0 0 1024 1024"><path d="M853.333333 56.888889a113.777778 113.777778 0 0 1 8.533334 227.271111L853.333333 284.444444c-19.000889 0-36.864-4.664889-52.622222-12.856888l-529.123555 529.066666a113.777778 113.777778 0 0 1-92.387556 166.115556L170.666667 967.111111a113.777778 113.777778 0 0 1-8.533334-227.271111L170.666667 739.555556c19.000889 0 36.864 4.664889 52.622222 12.856888l529.123555-529.066666a113.777778 113.777778 0 0 1 92.387556-166.115556L853.333333 56.888889zM170.666667 807.822222a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m682.666666-682.666666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-layer" viewBox="0 0 1024 1024"><path d="M767.089778 625.777778l180.167111 82.773333a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730667-420.977778 193.422222a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422222a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730667L256.853333 625.777778l81.749334 37.546666L172.771556 739.555556 512 895.374222 851.171556 739.555556l-165.831112-76.231112 81.749334-37.546666z m0-227.555556l180.167111 82.773334a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730666-420.977778 193.422223a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422223a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730666L256.853333 398.222222l81.749334 37.546667-165.831111 76.174222L512 667.818667l339.171556-155.875556-165.831112-76.174222L767.089778 398.222222zM497.720889 60.017778a34.133333 34.133333 0 0 1 28.558222 0l420.977778 193.422222a34.133333 34.133333 0 0 1 0 62.008889l-420.977778 193.422222a34.133333 34.133333 0 0 1-28.558222 0l-420.977778-193.422222a34.133333 34.133333 0 0 1 0-62.008889zM512 128.568889L172.771556 284.387556 512 440.263111l339.171556-155.875555L512 128.568889z"  ></path></symbol><symbol id="l7-icon-narrow" viewBox="0 0 1024 1024"><path d="M910.222222 512a34.133333 34.133333 0 0 1-34.133333 34.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h728.177778a34.133333 34.133333 0 0 1 34.133333 34.133333z"  ></path></symbol><symbol id="l7-icon-fullscreen" viewBox="0 0 1024 1024"><path d="M645.176889 597.674667l4.721778 3.982222L841.955556 793.6l0.056888-133.688889a34.133333 34.133333 0 0 1 28.615112-33.678222L876.088889 625.777778a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 659.911111v216.177778a34.133333 34.133333 0 0 1-28.615111 33.678222L876.088889 910.222222h-216.177778a34.133333 34.133333 0 0 1-5.518222-67.811555l5.518222-0.455111h133.745778l-192-192.056889a34.133333 34.133333 0 0 1 43.52-52.224z m-222.833778 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L230.286222 841.955556H364.088889a34.133333 34.133333 0 0 1 33.678222 28.615111L398.222222 876.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L364.088889 910.222222H147.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 876.088889v-216.177778a34.133333 34.133333 0 0 1 67.811555-5.518222l0.455111 5.518222-0.056888 133.745778 192.113777-192a34.133333 34.133333 0 0 1 48.241778 0zM364.088889 113.777778a34.133333 34.133333 0 0 1 5.518222 67.811555L364.088889 182.044444H230.343111l192 192.056889a34.133333 34.133333 0 0 1-43.52 52.224l-4.721778-3.982222-192.113777-192.056889L182.044444 364.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L147.911111 398.222222a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 364.088889V147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L147.911111 113.777778h216.177778z m512 0a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 147.911111v216.177778a34.133333 34.133333 0 0 1-67.811555 5.518222L841.955556 364.088889l-0.056889-133.745778-192 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L793.6 182.044444H659.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L625.777778 147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L659.911111 113.777778h216.177778z"  ></path></symbol><symbol id="l7-icon-hide" viewBox="0 0 1024 1024"><path d="M875.52 87.836444a34.133333 34.133333 0 0 1 7.281778 43.121778l-3.527111 5.006222-682.666667 796.444445a34.133333 34.133333 0 0 1-55.409778-39.367111l3.527111-5.006222 97.166223-113.379556C123.164444 697.969778 56.888889 582.940444 56.888889 512c0-113.777778 170.666667-341.333333 455.111111-341.333333a496.64 496.64 0 0 1 208.952889 45.112889l106.439111-124.188445a34.133333 34.133333 0 0 1 48.128-3.754667z m-38.684444 202.524445C921.031111 362.951111 967.111111 452.835556 967.111111 512c0 113.777778-170.666667 341.333333-455.111111 341.333333-50.631111 0-97.678222-7.224889-140.8-19.740444l50.232889-58.595556A417.393778 417.393778 0 0 0 512 785.066667c208.270222 0 386.844444-162.304 386.844444-273.066667 0-52.849778-40.675556-117.418667-105.813333-170.496l43.804445-51.2zM512 238.933333C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 66.787556 64.853333 152.291556 162.133333 209.692444L377.173333 616.675556a170.666667 170.666667 0 0 1 217.713778-253.895112l78.620445-91.704888A432.924444 432.924444 0 0 0 512 238.933333z m166.684444 236.088889a170.666667 170.666667 0 0 1-177.664 207.303111l177.607112-207.303111zM512 409.6a102.4 102.4 0 0 0-88.746667 153.486222L548.864 416.426667A102.172444 102.172444 0 0 0 512 409.6z"  ></path></symbol><symbol id="l7-icon-rectangle" viewBox="0 0 1024 1024"><path d="M170.666667 56.888889a113.777778 113.777778 0 0 1 108.544 79.644444H853.333333a34.133333 34.133333 0 0 1 33.678223 28.615111L887.466667 170.666667v574.122666a113.777778 113.777778 0 1 1-142.677334 142.734223L170.666667 887.466667a34.133333 34.133333 0 0 1-33.678223-28.615111L136.533333 853.333333V279.210667A113.777778 113.777778 0 0 1 170.666667 56.888889z m682.666666 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-34.133333-603.022222H279.210667a114.062222 114.062222 0 0 1-74.353778 74.410667L204.8 819.2h539.989333a114.062222 114.062222 0 0 1 74.410667-74.410667V204.8zM170.666667 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-ranging" viewBox="0 0 1024 1024"><path d="M723.171556 50.403556l250.424888 250.424888a31.061333 31.061333 0 0 1 0 43.918223L344.746667 973.596444a31.061333 31.061333 0 0 1-43.918223 0L50.403556 723.171556a31.061333 31.061333 0 0 1 0-43.918223L679.253333 50.403556a31.061333 31.061333 0 0 1 43.918223 0z m-21.959112 74.524444l-39.765333 39.822222 98.986667 98.872889a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222 62.179556 62.122667a34.133333 34.133333 0 0 1-44.088889 51.882667L563.2 387.242667 501.077333 325.063111 437.191111 388.949333l98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222L387.242667 563.2a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.584-62.122667-62.179556-63.886222 63.886222 98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-39.765333 39.822222 197.802667 197.745778 576.284444-576.284444-197.802667-197.745778z"  ></path></symbol><symbol id="l7-icon-reposition" viewBox="0 0 1024 1024"><path d="M512 56.888889a34.133333 34.133333 0 0 1 34.133333 34.133333v24.177778A398.336 398.336 0 0 1 908.856889 477.866667h24.177778a34.133333 34.133333 0 0 1 0 68.266666h-24.177778A398.336 398.336 0 0 1 546.133333 908.856889L546.133333 932.977778a34.133333 34.133333 0 0 1-68.266666 0v-24.177778A398.336 398.336 0 0 1 115.2 546.133333L91.022222 546.133333a34.133333 34.133333 0 1 1 0-68.266666h24.177778A398.336 398.336 0 0 1 477.866667 115.2V91.022222A34.133333 34.133333 0 0 1 512 56.888889z m34.190222 126.862222L546.133333 193.422222a34.133333 34.133333 0 1 1-68.266666 0v-9.671111A330.069333 330.069333 0 0 0 183.751111 477.866667h9.671111a34.133333 34.133333 0 1 1 0 68.266666l-9.671111 0.056889A330.069333 330.069333 0 0 0 477.866667 840.248889V830.577778a34.133333 34.133333 0 0 1 68.266666 0l0.056889 9.671111A330.069333 330.069333 0 0 0 840.248889 546.133333L830.577778 546.133333a34.133333 34.133333 0 0 1 0-68.266666h9.671111A330.069333 330.069333 0 0 0 546.133333 183.751111zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-round" viewBox="0 0 1024 1024"><path d="M512 56.888889a455.111111 455.111111 0 0 1 391.395556 687.502222 113.777778 113.777778 0 0 1-159.061334 158.890667A455.111111 455.111111 0 0 1 120.604444 279.608889 113.777778 113.777778 0 0 1 279.608889 120.604444 452.835556 452.835556 0 0 1 512 56.888889z m0 68.266667a384.910222 384.910222 0 0 0-191.715556 50.744888A113.777778 113.777778 0 0 1 175.957333 320.284444a386.844444 386.844444 0 0 0 527.815111 527.758223 113.777778 113.777778 0 0 1 144.270223-144.440889A386.844444 386.844444 0 0 0 512 125.155556z m299.406222 640.739555a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM212.593778 167.082667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-guanbi" viewBox="0 0 1024 1024"><path d="M576 512l277.333333 277.333333-64 64-277.333333-277.333333L234.666667 853.333333 170.666667 789.333333l277.333333-277.333333L170.666667 234.666667 234.666667 170.666667l277.333333 277.333333L789.333333 170.666667 853.333333 234.666667 576 512z"  ></path></symbol></svg>',function(rr){try{let ie=function(){U||(U=!0,_())},Ke=function(){try{le.documentElement.doScroll("left")}catch(ht){return void setTimeout(Ke,50)}ie()};var ae=ie,qe=Ke,L=(L=document.getElementsByTagName("script"))[L.length-1],J=L.getAttribute("data-injectcss"),L=L.getAttribute("data-disable-injectsvg");if(!L){var re,pe,_,le,U,he=function(mt,Dt){Dt.parentNode.insertBefore(mt,Dt)};if(J&&!rr.__iconfont__svg__cssinject__){rr.__iconfont__svg__cssinject__=!0;try{document.write("<style>.svgfont {display: inline-block;width: 1em;height: 1em;fill: currentColor;vertical-align: -0.1em;font-size:16px;}</style>")}catch(ht){console&&console.log(ht)}}re=function(){var mt,Dt=document.createElement("div");Dt.innerHTML=rr._iconfont_svg_string_3580659,(Dt=Dt.getElementsByTagName("svg")[0])&&(Dt.setAttribute("aria-hidden","true"),Dt.style.position="absolute",Dt.style.width=0,Dt.style.height=0,Dt.style.overflow="hidden",Dt=Dt,(mt=document.body).firstChild?he(Dt,mt.firstChild):mt.appendChild(Dt))},document.addEventListener?~["complete","loaded","interactive"].indexOf(document.readyState)?setTimeout(re,0):(pe=function(){document.removeEventListener("DOMContentLoaded",pe,!1),re()},document.addEventListener("DOMContentLoaded",pe,!1)):document.attachEvent&&(_=re,le=rr.document,U=!1,Ke(),le.onreadystatechange=function(){le.readyState=="complete"&&(le.onreadystatechange=null,ie())})}}catch(ie){}}(window)},91934:function(rr,J,L){"use strict";L.d(J,{zP:function(){return gB},JE:function(){return vF},ns:function(){return mB}});var re=L(50959),pe=(0,re.createContext)({});function _(){return(0,re.useContext)(pe)}var le={},U={},he=function(r){return U[r]},ae=function(r,t){U[r]=t},qe=function(r){return le[r]},ie=function(r,t){le[r]=t},Ke={},ht={},mt=34,Dt=10,Yt=13;function Ht(e){return new Function("d","return {"+e.map(function(r,t){return JSON.stringify(r)+": d["+t+'] || ""'}).join(",")+"}")}function ir(e,r){var t=Ht(e);return function(n,i){return r(t(n),i,e)}}function Xt(e){var r=Object.create(null),t=[];return e.forEach(function(n){for(var i in n)i in r||t.push(r[i]=i)}),t}function yt(e,r){var t=e+"",n=t.length;return n<r?new Array(r-n+1).join(0)+t:t}function bt(e){return e<0?"-"+yt(-e,6):e>9999?"+"+yt(e,6):yt(e,4)}function Pr(e){var r=e.getUTCHours(),t=e.getUTCMinutes(),n=e.getUTCSeconds(),i=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":bt(e.getUTCFullYear(),4)+"-"+yt(e.getUTCMonth()+1,2)+"-"+yt(e.getUTCDate(),2)+(i?"T"+yt(r,2)+":"+yt(t,2)+":"+yt(n,2)+"."+yt(i,3)+"Z":n?"T"+yt(r,2)+":"+yt(t,2)+":"+yt(n,2)+"Z":t||r?"T"+yt(r,2)+":"+yt(t,2)+"Z":"")}function hr(e){var r=new RegExp('["'+e+`
\r]`),t=e.charCodeAt(0);function n(b,T){var M,O,k=i(b,function($,G){if(M)return M($,G-1);O=$,M=T?ir($,T):Ht($)});return k.columns=O||[],k}function i(b,T){var M=[],O=b.length,k=0,$=0,G,oe=O<=0,ye=!1;b.charCodeAt(O-1)===Dt&&--O,b.charCodeAt(O-1)===Yt&&--O;function Le(){if(oe)return ht;if(ye)return ye=!1,Ke;var ut,vt=k,Rt;if(b.charCodeAt(vt)===mt){for(;k++<O&&b.charCodeAt(k)!==mt||b.charCodeAt(++k)===mt;);return(ut=k)>=O?oe=!0:(Rt=b.charCodeAt(k++))===Dt?ye=!0:Rt===Yt&&(ye=!0,b.charCodeAt(k)===Dt&&++k),b.slice(vt+1,ut-1).replace(/""/g,'"')}for(;k<O;){if((Rt=b.charCodeAt(ut=k++))===Dt)ye=!0;else if(Rt===Yt)ye=!0,b.charCodeAt(k)===Dt&&++k;else if(Rt!==t)continue;return b.slice(vt,ut)}return oe=!0,b.slice(vt,O)}for(;(G=Le())!==ht;){for(var $e=[];G!==Ke&&G!==ht;)$e.push(G),G=Le();T&&($e=T($e,$++))==null||M.push($e)}return M}function o(b,T){return b.map(function(M){return T.map(function(O){return y(M[O])}).join(e)})}function s(b,T){return T==null&&(T=Xt(b)),[T.map(y).join(e)].concat(o(b,T)).join(`
`)}function l(b,T){return T==null&&(T=Xt(b)),o(b,T).join(`
`)}function f(b){return b.map(v).join(`
`)}function v(b){return b.map(y).join(e)}function y(b){return b==null?"":b instanceof Date?Pr(b):r.test(b+="")?'"'+b.replace(/"/g,'""')+'"':b}return{parse:n,parseRows:i,format:s,formatBody:l,formatRows:f,formatRow:v,formatValue:y}}var ur=hr(","),Et=ur.parse,nt=ur.parseRows,Pt=ur.format,ft=ur.formatBody,qt=ur.formatRows,Sr=ur.formatRow,te=ur.formatValue,H=L(33346),K=63710088e-1,Be={centimeters:K*100,centimetres:K*100,degrees:K/111325,feet:K*3.28084,inches:K*39.37,kilometers:K/1e3,kilometres:K/1e3,meters:K,metres:K,miles:K/1609.344,millimeters:K*1e3,millimetres:K*1e3,nauticalmiles:K/1852,radians:1,yards:K*1.0936},Ae={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/K,yards:1.0936133},dt={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Ue(e,r,t){t===void 0&&(t={});var n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=r||{},n.geometry=e,n}function We(e,r,t){switch(t===void 0&&(t={}),e){case"Point":return it(r).geometry;case"LineString":return Cn(r).geometry;case"Polygon":return yr(r).geometry;case"MultiPoint":return jn(r).geometry;case"MultiLineString":return oi(r).geometry;case"MultiPolygon":return rn(r).geometry;default:throw new Error(e+" is invalid")}}function it(e,r,t){if(t===void 0&&(t={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!ne(e[0])||!ne(e[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:e};return Ue(n,r,t)}function Mt(e,r,t){return t===void 0&&(t={}),un(e.map(function(n){return it(n,r)}),t)}function yr(e,r,t){t===void 0&&(t={});for(var n=0,i=e;n<i.length;n++){var o=i[n];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var s=0;s<o[o.length-1].length;s++)if(o[o.length-1][s]!==o[0][s])throw new Error("First and last Position are not equivalent.")}var l={type:"Polygon",coordinates:e};return Ue(l,r,t)}function lr(e,r,t){return t===void 0&&(t={}),un(e.map(function(n){return yr(n,r)}),t)}function Cn(e,r,t){if(t===void 0&&(t={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:e};return Ue(n,r,t)}function mn(e,r,t){return t===void 0&&(t={}),un(e.map(function(n){return Cn(n,r)}),t)}function un(e,r){r===void 0&&(r={});var t={type:"FeatureCollection"};return r.id&&(t.id=r.id),r.bbox&&(t.bbox=r.bbox),t.features=e,t}function oi(e,r,t){t===void 0&&(t={});var n={type:"MultiLineString",coordinates:e};return Ue(n,r,t)}function jn(e,r,t){t===void 0&&(t={});var n={type:"MultiPoint",coordinates:e};return Ue(n,r,t)}function rn(e,r,t){t===void 0&&(t={});var n={type:"MultiPolygon",coordinates:e};return Ue(n,r,t)}function $i(e,r,t){t===void 0&&(t={});var n={type:"GeometryCollection",geometries:e};return Ue(n,r,t)}function Wi(e,r){if(r===void 0&&(r=0),r&&!(r>=0))throw new Error("precision must be a positive number");var t=Math.pow(10,r||0);return Math.round(e*t)/t}function Zi(e,r){r===void 0&&(r="kilometers");var t=Be[r];if(!t)throw new Error(r+" units is invalid");return e*t}function Jn(e,r){r===void 0&&(r="kilometers");var t=Be[r];if(!t)throw new Error(r+" units is invalid");return e/t}function Bn(e,r){return oa(Jn(e,r))}function Do(e){var r=e%360;return r<0&&(r+=360),r}function oa(e){var r=e%(2*Math.PI);return r*180/Math.PI}function $a(e){var r=e%360;return r*Math.PI/180}function Ot(e,r,t){if(r===void 0&&(r="kilometers"),t===void 0&&(t="kilometers"),!(e>=0))throw new Error("length must be a positive number");return Zi(Jn(e,r),t)}function F(e,r,t){if(r===void 0&&(r="meters"),t===void 0&&(t="kilometers"),!(e>=0))throw new Error("area must be a positive number");var n=dt[r];if(!n)throw new Error("invalid original units");var i=dt[t];if(!i)throw new Error("invalid final units");return e/n*i}function ne(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function de(e){return!!e&&e.constructor===Object}function Ne(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(r){if(!ne(r))throw new Error("bbox must only contain numbers")})}function _t(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}function Kt(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Ar(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Ve(e){if(e.length>1&&isNumber(e[0])&&isNumber(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return Ve(e[0]);throw new Error("coordinates must only contain numbers")}function wt(e,r,t){if(!r||!t)throw new Error("type and name required");if(!e||e.type!==r)throw new Error("Invalid input to "+t+": must be a "+r+", given "+e.type)}function sr(e,r,t){if(!e)throw new Error("No feature passed");if(!t)throw new Error(".featureOf() requires a name");if(!e||e.type!=="Feature"||!e.geometry)throw new Error("Invalid input to "+t+", Feature with geometry required");if(!e.geometry||e.geometry.type!==r)throw new Error("Invalid input to "+t+": must be a "+r+", given "+e.geometry.type)}function dr(e,r,t){if(!e)throw new Error("No featureCollection passed");if(!t)throw new Error(".collectionOf() requires a name");if(!e||e.type!=="FeatureCollection")throw new Error("Invalid input to "+t+", FeatureCollection required");for(var n=0,i=e.features;n<i.length;n++){var o=i[n];if(!o||o.type!=="Feature"||!o.geometry)throw new Error("Invalid input to "+t+", Feature with geometry required");if(!o.geometry||o.geometry.type!==r)throw new Error("Invalid input to "+t+": must be a "+r+", given "+o.geometry.type)}}function Vr(e){return e.type==="Feature"?e.geometry:e}function Ln(e,r){return e.type==="FeatureCollection"?"FeatureCollection":e.type==="GeometryCollection"?"GeometryCollection":e.type==="Feature"&&e.geometry!==null?e.geometry.type:e.type}function En(e,r,t){if(e!==null)for(var n,i,o,s,l,f,v,y=0,b=0,T,M=e.type,O=M==="FeatureCollection",k=M==="Feature",$=O?e.features.length:1,G=0;G<$;G++){v=O?e.features[G].geometry:k?e.geometry:e,T=v?v.type==="GeometryCollection":!1,l=T?v.geometries.length:1;for(var oe=0;oe<l;oe++){var ye=0,Le=0;if(s=T?v.geometries[oe]:v,s!==null){f=s.coordinates;var $e=s.type;switch(y=t&&($e==="Polygon"||$e==="MultiPolygon")?1:0,$e){case null:break;case"Point":if(r(f,b,G,ye,Le)===!1)return!1;b++,ye++;break;case"LineString":case"MultiPoint":for(n=0;n<f.length;n++){if(r(f[n],b,G,ye,Le)===!1)return!1;b++,$e==="MultiPoint"&&ye++}$e==="LineString"&&ye++;break;case"Polygon":case"MultiLineString":for(n=0;n<f.length;n++){for(i=0;i<f[n].length-y;i++){if(r(f[n][i],b,G,ye,Le)===!1)return!1;b++}$e==="MultiLineString"&&ye++,$e==="Polygon"&&Le++}$e==="Polygon"&&ye++;break;case"MultiPolygon":for(n=0;n<f.length;n++){for(Le=0,i=0;i<f[n].length;i++){for(o=0;o<f[n][i].length-y;o++){if(r(f[n][i][o],b,G,ye,Le)===!1)return!1;b++}Le++}ye++}break;case"GeometryCollection":for(n=0;n<s.geometries.length;n++)if(En(s.geometries[n],r,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Rn(e,r,t,n){var i=t;return En(e,function(o,s,l,f,v){s===0&&t===void 0?i=o:i=r(i,o,s,l,f,v)},n),i}function xn(e,r){var t;switch(e.type){case"FeatureCollection":for(t=0;t<e.features.length&&r(e.features[t].properties,t)!==!1;t++);break;case"Feature":r(e.properties,0);break}}function si(e,r,t){var n=t;return xn(e,function(i,o){o===0&&t===void 0?n=i:n=r(n,i,o)}),n}function ei(e,r){if(e.type==="Feature")r(e,0);else if(e.type==="FeatureCollection")for(var t=0;t<e.features.length&&r(e.features[t],t)!==!1;t++);}function la(e,r,t){var n=t;return ei(e,function(i,o){o===0&&t===void 0?n=i:n=r(n,i,o)}),n}function sa(e){var r=[];return En(e,function(t){r.push(t)}),r}function Eo(e,r){var t,n,i,o,s,l,f,v,y,b,T=0,M=e.type==="FeatureCollection",O=e.type==="Feature",k=M?e.features.length:1;for(t=0;t<k;t++){for(l=M?e.features[t].geometry:O?e.geometry:e,v=M?e.features[t].properties:O?e.properties:{},y=M?e.features[t].bbox:O?e.bbox:void 0,b=M?e.features[t].id:O?e.id:void 0,f=l?l.type==="GeometryCollection":!1,s=f?l.geometries.length:1,i=0;i<s;i++){if(o=f?l.geometries[i]:l,o===null){if(r(null,T,v,y,b)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(r(o,T,v,y,b)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<o.geometries.length;n++)if(r(o.geometries[n],T,v,y,b)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}T++}}function Ks(e,r,t){var n=t;return Eo(e,function(i,o,s,l,f){o===0&&t===void 0?n=i:n=r(n,i,o,s,l,f)}),n}function di(e,r){Eo(e,function(t,n,i,o,s){var l=t===null?null:t.type;switch(l){case null:case"Point":case"LineString":case"Polygon":return r(Ue(t,i,{bbox:o,id:s}),n,0)===!1?!1:void 0}var f;switch(l){case"MultiPoint":f="Point";break;case"MultiLineString":f="LineString";break;case"MultiPolygon":f="Polygon";break}for(var v=0;v<t.coordinates.length;v++){var y=t.coordinates[v],b={type:f,coordinates:y};if(r(Ue(b,i),n,v)===!1)return!1}})}function W(e,r,t){var n=t;return di(e,function(i,o,s){o===0&&s===0&&t===void 0?n=i:n=r(n,i,o,s)}),n}function Q(e,r){di(e,function(t,n,i){var o=0;if(t.geometry){var s=t.geometry.type;if(!(s==="Point"||s==="MultiPoint")){var l,f=0,v=0,y=0;if(En(t,function(b,T,M,O,k){if(l===void 0||n>f||O>v||k>y){l=b,f=n,v=O,y=k,o=0;return}var $=lineString([l,b],t.properties);if(r($,n,i,k,o)===!1)return!1;o++,l=b})===!1)return!1}}})}function se(e,r,t){var n=t,i=!1;return Q(e,function(o,s,l,f,v){i===!1&&t===void 0?n=o:n=r(n,o,s,l,f,v),i=!0}),n}function xe(e,r){if(!e)throw new Error("geojson is required");di(e,function(t,n,i){if(t.geometry!==null){var o=t.geometry.type,s=t.geometry.coordinates;switch(o){case"LineString":if(r(t,n,i,0,0)===!1)return!1;break;case"Polygon":for(var l=0;l<s.length;l++)if(r(lineString(s[l],t.properties),n,i,l)===!1)return!1;break}}})}function Re(e,r,t){var n=t;return xe(e,function(i,o,s,l){o===0&&t===void 0?n=i:n=r(n,i,o,s,l)}),n}function Je(e,r){if(r=r||{},!isObject(r))throw new Error("options is invalid");var t=r.featureIndex||0,n=r.multiFeatureIndex||0,i=r.geometryIndex||0,o=r.segmentIndex||0,s=r.properties,l;switch(e.type){case"FeatureCollection":t<0&&(t=e.features.length+t),s=s||e.features[t].properties,l=e.features[t].geometry;break;case"Feature":s=s||e.properties,l=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":l=e;break;default:throw new Error("geojson is invalid")}if(l===null)return null;var f=l.coordinates;switch(l.type){case"Point":case"MultiPoint":return null;case"LineString":return o<0&&(o=f.length+o-1),lineString([f[o],f[o+1]],s,r);case"Polygon":return i<0&&(i=f.length+i),o<0&&(o=f[i].length+o-1),lineString([f[i][o],f[i][o+1]],s,r);case"MultiLineString":return n<0&&(n=f.length+n),o<0&&(o=f[n].length+o-1),lineString([f[n][o],f[n][o+1]],s,r);case"MultiPolygon":return n<0&&(n=f.length+n),i<0&&(i=f[n].length+i),o<0&&(o=f[n][i].length-o-1),lineString([f[n][i][o],f[n][i][o+1]],s,r)}throw new Error("geojson is invalid")}function lt(e,r){if(r=r||{},!isObject(r))throw new Error("options is invalid");var t=r.featureIndex||0,n=r.multiFeatureIndex||0,i=r.geometryIndex||0,o=r.coordIndex||0,s=r.properties,l;switch(e.type){case"FeatureCollection":t<0&&(t=e.features.length+t),s=s||e.features[t].properties,l=e.features[t].geometry;break;case"Feature":s=s||e.properties,l=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":l=e;break;default:throw new Error("geojson is invalid")}if(l===null)return null;var f=l.coordinates;switch(l.type){case"Point":return point(f,s,r);case"MultiPoint":return n<0&&(n=f.length+n),point(f[n],s,r);case"LineString":return o<0&&(o=f.length+o),point(f[o],s,r);case"Polygon":return i<0&&(i=f.length+i),o<0&&(o=f[i].length+o),point(f[i][o],s,r);case"MultiLineString":return n<0&&(n=f.length+n),o<0&&(o=f[n].length+o),point(f[n][o],s,r);case"MultiPolygon":return n<0&&(n=f.length+n),i<0&&(i=f[n].length+i),o<0&&(o=f[n][i].length-o),point(f[n][i][o],s,r)}throw new Error("geojson is invalid")}var V=L(77254),q=L(47920),De=L(44906),et=L(56622),be=L(46355),er=L(87157);function Tr(e){try{return Function.toString.call(e).indexOf("[native code]")!==-1}catch(r){return typeof e=="function"}}var bn=L(67598);function nn(e,r,t){return(0,bn.Z)()?nn=Reflect.construct.bind():nn=function(i,o,s){var l=[null];l.push.apply(l,o);var f=Function.bind.apply(i,l),v=new f;return s&&(0,er.Z)(v,s.prototype),v},nn.apply(null,arguments)}function ar(e){var r=typeof Map=="function"?new Map:void 0;return ar=function(n){if(n===null||!Tr(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof r!="undefined"){if(r.has(n))return r.get(n);r.set(n,i)}function i(){return nn(n,arguments,(0,be.Z)(this).constructor)}return i.prototype=Object.create(n.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),(0,er.Z)(i,n)},ar(e)}var Kr={REGISTERED_PROTOCOLS:{}};function Hr(e){var r=$r();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function $r(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var hi=function(r){return Kr.REGISTERED_PROTOCOLS[r.substring(0,r.indexOf("://"))]},Qr=function(e){(0,De.Z)(t,e);var r=Hr(t);function t(n,i,o,s){var l;return(0,q.Z)(this,t),l=r.call(this,"AJAXError: ".concat(i," (").concat(n,"): ").concat(o)),l.status=n,l.statusText=i,l.url=o,l.body=s,l}return(0,V.Z)(t)}(ar(Error));function vi(e,r){var t=new XMLHttpRequest,n=Array.isArray(e.url)?e.url[0]:e.url;t.open(e.method||"GET",n,!0),e.type==="arrayBuffer"&&(t.responseType="arraybuffer");for(var i in e.headers)e.headers.hasOwnProperty(i)&&t.setRequestHeader(i,e.headers[i]);return e.type==="json"&&(t.responseType="text",t.setRequestHeader("Accept","application/json")),t.withCredentials=e.credentials==="include",t.onerror=function(){r(new Error(t.statusText))},t.onload=function(){if((t.status>=200&&t.status<300||t.status===0)&&t.response!==null){var o=t.response;if(e.type==="json")try{o=JSON.parse(t.response)}catch(l){return r(l)}r(null,o,t.getResponseHeader("Cache-Control"),t.getResponseHeader("Expires"),t)}else{var s=new Blob([t.response],{type:t.getResponseHeader("Content-Type")});r(new Qr(t.status,t.statusText,n.toString(),s))}},t.cancel=t.abort,t.send(e.body),t}function Yi(e){return new Promise(function(r,t){vi(e,function(n,i,o,s,l){n?t({err:n,data:null,xhr:l}):r({err:null,data:i,cacheControl:o,expires:s,xhr:l})})})}function ci(e,r){return vi(e,r)}var Li=function(r,t){var n=hi(r.url)||ci;return n((0,H.Z)((0,H.Z)({},r),{},{type:"json"}),t)},Si=function(r,t){var n=hi(r.url)||ci;return n((0,H.Z)((0,H.Z)({},r),{},{type:"arrayBuffer"}),t)},Xo=function(r,t){return ci(_objectSpread(_objectSpread({},r),{},{method:"POST"}),t)},Ki=function(r,t){return ci((0,H.Z)((0,H.Z)({},r),{},{method:"GET"}),t)};function Ia(e){var r=window.document.createElement("a");return r.href=e,r.protocol===window.document.location.protocol&&r.host===window.document.location.host}var Ai="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function mi(e,r){var t=new window.Image,n=window.URL||window.webkitURL;t.crossOrigin="anonymous",t.onload=function(){r(null,t),n.revokeObjectURL(t.src),t.onload=null,window.requestAnimationFrame(function(){t.src=Ai})},t.onerror=function(){return r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var i=new Blob([new Uint8Array(e)],{type:"image/png"});t.src=e.byteLength?n.createObjectURL(i):Ai}function Ti(e,r){var t=new Blob([new Uint8Array(e)],{type:"image/png"});createImageBitmap(t).then(function(n){r(null,n)}).catch(function(n){r(new Error("Could not load image because of ".concat(n.message,". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")))})}var Pa=function(r,t,n){var i=function(s,l){if(s)t(s);else if(l){var f=typeof createImageBitmap=="function",v=n?n(l):l;f?Ti(v,t):mi(v,t)}};return r.type==="json"?Li(r,i):Si(r,i)},cu=function(r,t){var n=typeof createImageBitmap=="function";n?Ti(r,t):mi(r,t)},ma=function(e){return e.CENTER="center",e.TOP="top",e["TOP-LEFT"]="top-left",e["TOP-RIGHT"]="top-right",e.BOTTOM="bottom",e["BOTTOM-LEFT"]="bottom-left",e["BOTTOM-RIGHT"]="bottom-right",e.LEFT="left",e.RIGHT="right",e}({}),Aa={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function $l(e,r,t){var n=e.classList;for(var i in Aa)Aa.hasOwnProperty(i)&&n.remove("l7-".concat(t,"-anchor-").concat(i));n.add("l7-".concat(t,"-anchor-").concat(r))}var os=L(52617);function Ta(e){return typeof e=="string"?!!d3.color(e):!1}function fi(e){var r=os.ZP(e),t=[0,0,0,0];return r!=null&&(t[0]=r.r/255,t[1]=r.g/255,t[2]=r.b/255,t[3]=r.opacity),t}function Oa(e){var r=e&&e[0],t=e&&e[1],n=e&&e[2],i=r+t*256+n*65536-1;return i}function ia(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function So(e){var r=window.document.createElement("canvas"),t=r.getContext("2d");r.width=256,r.height=1;for(var n=null,i=t.createLinearGradient(0,0,256,1),o=e.positions[0],s=e.positions[e.positions.length-1],l=0;l<e.colors.length;++l){var f=(e.positions[l]-o)/(s-o);i.addColorStop(f,e.colors[l])}return t.fillStyle=i,t.fillRect(0,0,256,1),n=new Uint8ClampedArray(t.getImageData(0,0,256,1).data),r=null,t=null,{data:n,width:256,height:1}}function ha(e,r){var t=window.document.createElement("canvas"),n=t.getContext("2d");t.width=256,t.height=1;for(var i=n.createLinearGradient(0,0,256,1),o=r[1]-r[0],s=0;s<e.colors.length;++s){var l=Math.max((e.positions[s]-r[0])/o,0);i.addColorStop(l,e.colors[s])}n.fillStyle=i,n.fillRect(0,0,256,1);var f=n.getImageData(0,0,256,1).data,v=ss(n,f);return t=null,n=null,v}function $o(e){var r=window.document.createElement("canvas"),t=r.getContext("2d");r.width=256,r.height=1;var n=t.createImageData(256,1);return n.data.fill(0),e.positions.forEach(function(i,o){var s=fi(e.colors[o]);n.data[i*4+0]=s[0]*255,n.data[i*4+1]=s[1]*255,n.data[i*4+2]=s[2]*255,n.data[i*4+3]=s[3]*255}),r=null,t=null,n}function Vo(e){var r=window.document.createElement("canvas"),t=r.getContext("2d");t.globalAlpha=1,r.width=256,r.height=1;for(var n=256/e.colors.length,i=0;i<e.colors.length;i++)t.beginPath(),t.lineWidth=2,t.strokeStyle=e.colors[i],t.moveTo(i*n,0),t.lineTo((i+1)*n,0),t.stroke();var o=t.getImageData(0,0,256,1).data,s=ss(t,o);return r=null,t=null,s}function Ru(e,r){var t=window.document.createElement("canvas"),n=t.getContext("2d");n.globalAlpha=1,t.width=256,t.height=1;var i=r[1]-r[0];e.positions.length-e.colors.length!==1&&console.warn("positions \u7684\u6570\u5B57\u4E2A\u6570\u5E94\u5F53\u6BD4 colors \u7684\u6837\u5F0F\u591A\u4E00\u4E2A,poisitions \u7684\u9996\u5C3E\u503C\u4E00\u822C\u4E3A\u6570\u636E\u7684\u6700\u5927\u6700\u65B0\u503C");for(var o=0;o<e.colors.length;o++)n.beginPath(),n.lineWidth=2,n.strokeStyle=e.colors[o],n.moveTo((e.positions[o]-r[0])/i*255,0),n.lineTo((e.positions[o+1]-r[0])/i*255,0),n.stroke();var s=n.getImageData(0,0,256,1).data,l=ss(n,s);return t=null,n=null,l}function ss(e,r){for(var t=e.createImageData(256,1),n=0;n<t.data.length;n+=4)t.data[n+0]=r[n+0],t.data[n+1]=r[n+1],t.data[n+2]=r[n+2],t.data[n+3]=r[n+3];return t}function Cc(e){switch(e.type){case"cat":return[0,255];default:return[0,1]}}var Ea={BACK:1029,FRONT:1028};function Qi(e){switch(e){case"GAODE1.x":return Ea.BACK;case"GAODE2.x":return Ea.BACK;case"MAPBOX":return Ea.FRONT;case"SIMPLE":return Ea.FRONT;case"GLOBEL":return Ea.BACK;case"DEBAULT":return Ea.FRONT;default:return Ea.FRONT}}var Wt=L(1788),yn=L(32682),fe=L(35636),Te=L.n(fe),ot=L(32222),nr=L.n(ot),jr=L(66292),Mn=L.n(jr),Vi=L(65439),ho=L.n(Vi),Ao=L(98071),uo=L.n(Ao),Is=L(31223),ys=L.n(Is),Kh=L(46207),Cf=L.n(Kh),jo=L(59933),xl=L.n(jo),bl=L(69143),Mu=L.n(bl),Iu=L(56549),Qu=L.n(Iu),Qc=L(73806),Ps=L.n(Qc),Ya=L(67929),El=L.n(Ya),Ju=L(53954),Rf=L.n(Ju),Qh=L(25066),Mf=L.n(Qh),ph=L(38209),dh=L.n(ph),vh=L(4363),Jh=L.n(vh),ep=L(42950),Zp=L.n(ep),Jc=L(92042),Pu=L.n(Jc),tp=L(36838),Ho=L.n(tp),Yl=L(89300),Sl=L.n(Yl),Xs=L(47638),Al=L.n(Xs),ii={isNil:Cf(),merge:El(),throttle:dh(),isString:Qu(),debounce:Mn(),pull:Mf(),isTypedArray:Ps(),isPlainObject:Mu(),isNumber:xl(),isBoolean:uo(),isEqual:ys(),cloneDeep:nr(),uniq:Jh(),clamp:Te(),upperFirst:Zp(),get:ho(),mergeWith:Rf(),isFunction:Pu(),isObject:Ho(),isUndefined:Sl(),camelCase:Al()},el=ii.pull;function Os(e){var r=e;return typeof e=="string"&&(r=window.document.getElementById(e)),r}function Ou(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function tl(e){return Ou(e).split(/\s+/)}function rp(e){var r,t=(r=document)===null||r===void 0||(r=r.documentElement)===null||r===void 0?void 0:r.style;if(!t)return e[0];for(var n in e)if(e[n]&&e[n]in t)return e[n];return e[0]}function Ji(e,r,t){var n=window.document.createElement(e);return r&&(n.className=r||""),t&&t.appendChild(n),n}function Ci(e){var r=e.parentNode;r&&r.removeChild(e)}function fu(e,r){if(e.classList!==void 0)for(var t=tl(r),n=0,i=t.length;n<i;n++)e.classList.add(t[n]);else if(!mh(e,r)){var o=ef(e);ja(e,(o?o+" ":"")+r)}}function Du(e,r){if(e.classList!==void 0){var t=tl(r);t.forEach(function(n){e.classList.remove(n)})}else ja(e,Ou((" "+ef(e)+" ").replace(" "+r+" "," ")))}function mh(e,r){if(e.classList!==void 0)return e.classList.contains(r);var t=ef(e);return t.length>0&&new RegExp("(^|\\s)"+r+"(\\s|$)").test(t)}function ja(e,r){e instanceof HTMLElement?e.className=r:e.className.baseVal=r}function ef(e){return e instanceof SVGElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function Vp(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}var xs=rp(["transform","WebkitTransform"]);function ku(e,r){e.style[xs]=r}function Fu(){if(typeof Event=="function")window.dispatchEvent(new Event("resize"));else{var e=window.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,window,0),window.dispatchEvent(e)}}function ql(e){var r=["padding: "+(e.height/2-8)+"px "+e.width/2+"px;","line-height: "+e.height+"px;","background-image: url("+e.toDataURL()+");"];console.log(`%c
`,r.join(""))}function If(){var e,r=window.document.querySelector('meta[name="viewport"]');if(!r)return 1;var t=(e=r.content)===null||e===void 0?void 0:e.split(","),n=t.find(function(i){var o=i.split("="),s=(0,yn.Z)(o,1),l=s[0];return l==="initial-scale"});return n?n.split("=")[1]*1:1}var wa=If()<1?1:window.devicePixelRatio;function Qs(e,r){e.setAttribute("style","".concat(e.style.cssText).concat(r))}function Rc(e){return e.split(";").map(function(r){return r.trim()}).filter(function(r){return r})}function Kl(e,r){var t,n=Rc((t=e.getAttribute("style"))!==null&&t!==void 0?t:""),i=Rc(r),o=el.apply(void 0,[n].concat((0,Wt.Z)(i)));e.setAttribute("style",o.join(";"))}function rl(e){return Object.entries(e).map(function(r){var t=(0,yn.Z)(r,2),n=t[0],i=t[1];return"".concat(n,": ").concat(i)}).join(";")}function gh(e,r){return{left:e.left-r.left,top:e.top-r.top,right:r.left+r.width-e.left-e.width,bottom:r.top+r.height-e.top-e.height}}function Ql(e,r){e.checked=r,r?e.setAttribute("checked","true"):e.removeAttribute("checked")}function ca(e){e.innerHTML=""}function tf(e){e.setAttribute("draggable","false")}function np(e,r){if(typeof r=="string"){var t=document.createElement("div");for(t.innerHTML=r;t.firstChild;)e.append(t.firstChild)}else Array.isArray(r)?e.append.apply(e,(0,Wt.Z)(r)):e.append(r)}function Tl(e,r){for(var t=Array.isArray(r)?r:[r],n=e;n instanceof Element&&n!==window.document.body;){var i,o;if(t.find(function(s){var l;return(l=n)===null||l===void 0?void 0:l.matches(s)}))return n;n=(i=(o=n)===null||o===void 0?void 0:o.parentElement)!==null&&i!==void 0?i:null}}var Jl;function _h(e){return typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap}function Pf(){return typeof importScripts=="function"}var wl=Pf()?function(){return self.worker&&self.worker.referrer}:function(){return(window.location.protocol==="blob:"?window.parent:window).location.href},hu=(Jl=navigator)===null||Jl===void 0?void 0:Jl.userAgent,Mc=!!hu.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),rf=hu.indexOf("Android")>-1||hu.indexOf("Adr")>-1;function ec(){for(var e=hu,r=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],t=!0,n=0,i=r;n<i.length;n++){var o=i[n];if(e.indexOf(o)>0){t=!1;break}}return t}function tc(e,r){e.forEach(function(t){r[t]&&(r[t]=r[t].bind(r))})}var ip=null;function nl(e){var r=[1/0,1/0,-1/0,-1/0];return En(e,function(t){r[0]>t[0]&&(r[0]=t[0]),r[1]>t[1]&&(r[1]=t[1]),r[2]<t[0]&&(r[2]=t[0]),r[3]<t[1]&&(r[3]=t[1])}),r}nl.default=nl;var Js=nl;function nf(e){return typeof e=="number"}var Ic=2*Math.PI*6378137/2;function yh(e,r){var t=(0,yn.Z)(r,4),n=t[0],i=t[1],o=t[2],s=t[3];return e.lng>n&&e.lng<=o&&e.lat>i&&e.lat<=s}function Cl(e){var r=[1/0,1/0,-1/0,-1/0];return e.forEach(function(t){var n=t.coordinates;pu(r,n)}),r}function pu(e,r){return Array.isArray(r[0])?r.forEach(function(t){pu(e,t)}):(e[0]>r[0]&&(e[0]=r[0]),e[1]>r[1]&&(e[1]=r[1]),e[2]<r[0]&&(e[2]=r[0]),e[3]<r[1]&&(e[3]=r[1])),e}function af(e,r){return Pc(e,r)}function Pc(e,r){return Array.isArray(e[0])?e.map(function(t){return Pc(t,r)}):r(e)}function Bu(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};e=Df(e,r);var n=e[0],i=e[1],o=n*Ic/180,s=Math.log(Math.tan((90+i)*Math.PI/360))/(Math.PI/180);return s=s*Ic/180,t.enable&&(o=Number(o.toFixed(t.decimal)),s=Number(s.toFixed(t.decimal))),e.length===3?[o,s,e[2]]:[o,s]}function Md(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,t=e[0],n=e[1],i=t/Ic*180,o=n/Ic*180;return o=180/Math.PI*(2*Math.atan(Math.exp(o*Math.PI/180))-Math.PI/2),r!=null&&(i=Number(i.toFixed(r)),o=Number(o.toFixed(r))),e.length===3?[i,o,e[2]]:[i,o]}function Of(e){if(e==null)throw new Error("lng is required");return(e>180||e<-180)&&(e=e%360,e>180&&(e=-360+e),e<-180&&(e=360+e),e===0&&(e=0)),e}function xh(e){if(e==null)throw new Error("lat is required");return(e>90||e<-90)&&(e=e%180,e>90&&(e=-180+e),e<-90&&(e=180+e),e===0&&(e=0)),e}function Df(e,r){if(r===!1)return e;var t=Of(e[0]),n=xh(e[1]);return n>85&&(n=85),n<-85&&(n=-85),e.length===3?[t,n,e[2]]:[t,n]}function ko(e){var r=85.0511287798,t=Math.max(Math.min(r,e[1]),-r),n=256<<20,i=Math.PI/180,o=e[0]*i,s=t*i;s=Math.log(Math.tan(Math.PI/4+s/2));var l=.5/Math.PI,f=.5,v=-.5/Math.PI;return i=.5,o=n*(l*o+f),s=n*(v*s+i),[Math.floor(o),Math.floor(s)]}function bh(e){var r=.5/Math.PI,t=.5,n=-.5/Math.PI,i=.5,o=256<<20,s=_slicedToArray(e,2),l=s[0],f=s[1];l=(l/o-t)/r,f=(f/o-i)/n,f=(Math.atan(Math.pow(Math.E,f))-Math.PI/4)*2,i=Math.PI/180;var v=f/i,y=l/i;return[y,v]}function ap(e,r){var t=85.0511287798,n=Math.PI/180,i=6378137;return r=Math.max(Math.min(t,r),-t),e*=n,r*=n,r=Math.log(Math.tan(Math.PI/4+r/2)),[e*i,r*i]}function kf(e,r){var t=Math.PI/180,n=6378137,i=e/n/t,o=2*(Math.atan(Math.exp(r/n))-Math.PI/4)/t;return[i,o]}function Eh(e,r,t){var n=$a(r[1]-e[1]),i=$a(r[0]-e[0]),o=$a(e[1]),s=$a(r[1]),l=Math.pow(Math.sin(n/2),2)+Math.pow(Math.sin(i/2),2)*Math.cos(o)*Math.cos(s);return Zi(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)),t="meters")}function Oc(e){var r=Math.PI/180,t=85.0511287798,n=6378137,i=Math.max(Math.min(t,e[1]),-t),o=Math.sin(i*r),s=n*e[0]*r,l=n*Math.log((1+o)/(1-o))/2;return[s,l]}function of(e,r){var t=Math.abs(e[1][1]-e[0][1])*r,n=Math.abs(e[1][0]-e[0][0])*r;return[[e[0][0]-n,e[0][1]-t],[e[1][0]+n,e[1][1]+t]]}function il(e,r){return e[0][0]<=r[0][0]&&e[0][1]<=r[0][1]&&e[1][0]>=r[1][0]&&e[1][1]>=r[1][1]}function pa(e){return[[e[0],e[1]],[e[2],e[3]]]}function Ff(e){var r=du(e,[0,0]);return[e[0]/r,e[1]/r]}function du(e,r){return Math.sqrt(Math.pow(e[0]-r[0],2)+Math.pow(e[1]-r[1],2))}function Rl(e,r){return e[0]*r[0]+e[1]*r[1]}function ki(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function Ca(e,r){return Math.acos(Rl(e,r)/(ki(e)*ki(r)))*180/Math.PI}function $s(e,r){return r[0]>0?r[1]>0?90-Math.atan(r[1]/r[0])*180/Math.PI:90+Math.atan(-r[1]/r[0])*180/Math.PI:r[1]<0?180+(90-Math.atan(r[1]/r[0])*180/Math.PI):270+Math.atan(r[1]/-r[0])*180/Math.PI}function Bf(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100;if(!(!e||e.length<2)){for(var t=[0,1],n=0,i=[],o=0;o<e.length-1;o++){var s=e[o],l=e[o+1],f=du(s,l);n+=f;var v=[s[0]-l[0],s[1]-l[1]],y=$s(t,v);if(o>0){var b=i[o-1].rotation;b-y>360-b+y&&(y=y+360)}i.push({start:s,end:l,dis:f,rotation:y,duration:0})}return i.map(function(T){T.duration=r*(T.dis/n)}),i}}function Ds(e){if(nf(e[0]))return e;if(nf(e[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(nf(e[0][0][0])){var r=e,t=0,n=0,i=0;return r.forEach(function(o){o.forEach(function(s){t+=s[0],n+=s[1],i++})}),[t/i,n/i,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}function sf(e){for(var r=e[0],t=e[1],n=e[0],i=e[1],o=0,s=0,l=0,f=0;f<e.length;f+=2){var v=e[f],y=e[f+1];v&&y&&(r=Math.max(v,r),t=Math.max(y,t),n=Math.min(v,n),i=Math.min(y,i),o+=v,s+=y,l++)}return{center:[o/l,s/l],radius:Math.sqrt(Math.pow(r-n,2)+Math.pow(t-i,2))/2}}function op(e){return Js(un([Cn(e)]))}function Sh(e){var r=131,t=137,n=0;e+="x";for(var i=Math.floor(9007199254740991/t),o=0;o<e.length;o++)n>i&&(n=Math.floor(n/t)),n=n*r+e.charCodeAt(o);return n}function Lf(e){e=e.toString();for(var r=5381,t=e.length;t;)r=r*33^e.charCodeAt(--t);return r>>>0}function Ml(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var r=Math.random()*16|0,t=e==="x"?r:r&3|8;return t.toString(16)})}var Fo=function(e){return e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.DEFAULT="DEFAUlTMAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL",e}({});function Ha(e,r,t,n,i){var o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:30,s=arguments.length>6?arguments[6]:void 0,l=t;return s&&(l=Math.round(t*(o-1))/(o-1)),n?vn(e,r,l,n,i):vn(e,r,l,.314,i)}function al(e,r){var t=1-r;return(e[0]*t+e[1]*r)*t+(e[1]*t+e[2]*r)*r}function Ah(e,r){return Math.sqrt(Math.pow(e[0]-r[0],2)+Math.pow(e[1]-r[1],2))}function qa(e,r,t){var n=[r[0]-e[0],r[1]-e[1]],i=Ah(n,[0,0]),o=Math.atan2(n[1],n[0]),s=i/2/Math.cos(t),l=o+t,f=[s*Math.cos(l)+e[0],s*Math.sin(l)+e[1]];return f}function vn(e,r,t,n,i){if(i===MapType["GAODE2.x"]){var o=amap2Project(e[0],e[1]),s=amap2Project(r[0],r[1]),l=qa(o,s,n),f=[o[0],l[0],s[0]],v=[o[1],l[1],s[1]];return[].concat(_toConsumableArray(amap2UnProject(al(f,t),al(v,t))),[0])}else{var y=qa(e,r,n),b=[e[0],y[0],r[0]],T=[e[1],y[1],r[1]];return[al(b,t),al(T,t),0]}}function ks(e,r,t,n,i){var o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:30,s=arguments.length>6?arguments[6]:void 0,l=t;return s&&(l=Math.round(t*29)/29),ga(e,r,l,i)}function uf(e,r){var t=[r[0]-e[0],r[1]-e[1]],n=calDistance(t,[0,0]),i=Math.atan2(t[1],t[0]),o=.314,s=n/2/Math.cos(o),l=i+o,f=[s*Math.cos(l)+e[0],s*Math.sin(l)+e[1]];return f}function rc(e,r){var t=1-r;return(e[0]*t+e[1]*r)*t+(e[1]*t+e[2]*r)*r}function us(e,r){var t=[e[0]-r[0],e[1]-r[1]],n=[Math.sin(t[0]/2),Math.sin(t[1]/2)],i=n[1]*n[1]+Math.cos(e[1])*Math.cos(r[1])*n[0]*n[0];return 2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i))}function ga(e,r,t,n){var i=[degreesToRadians(e[0]),degreesToRadians(e[1])],o=[degreesToRadians(r[0]),degreesToRadians(r[1])];if(n==="GAODE2.x"){var s=uf(i,o),l=[i[0],s[0],o[0]],f=[i[1],s[1],o[1]];return[rc(l,t),rc(f,t),0]}else{var v=us(i,o);if(Math.abs(v-Math.PI)<.001)return[(1-t)*i[0]+t*o[0],(1-t)*i[1]+t*o[1]];var y=Math.sin((1-t)*v)/Math.sin(v),b=Math.sin(t*v)/Math.sin(v),T=[Math.sin(i[0]),Math.sin(i[1])],M=[Math.cos(i[0]),Math.cos(i[1])],O=[Math.sin(o[0]),Math.sin(o[1])],k=[Math.cos(o[0]),Math.cos(o[1])],$=y*M[1]*M[0]+b*k[1]*k[0],G=y*M[1]*T[0]+b*k[1]*O[0],oe=y*T[1]+b*O[1];return[radiansToDegrees(Math.atan2(G,$)),radiansToDegrees(Math.atan2(oe,Math.sqrt($*$+G*G)))]}}function Th(e,r){for(var t=0,n=[],i=0;i<e.length-1;i++){var o=e[i],s=e[i+1],l=ol(o,s),f=t;t+=l,n.push({p1:o,p2:s,totalDistance:t,distance:l,lastTotalDistance:f})}for(var v=t*r,y,b,T=0,M=n;T<M.length;T++){var O=M[T],k=O.totalDistance;if(k>v){var $=O.p1,G=O.p2,oe=(v-O.lastTotalDistance)/O.distance,ye=Yr(G,$,oe);y=ye[0],b=ye[1];break}}return{lng:y,lat:b,height:0}}function Yr(e,r,t){return[e[0]*t+r[0]*(1-t),e[1]*t+r[1]*(1-t)]}function ol(e,r){return Math.sqrt(Math.pow(e[0]-r[0],2)+Math.pow(e[1]-r[1],2))}function Dc(e,r){var t=r.featureId,n=e.data.dataArray;return typeof t=="number"&&(n=n.filter(function(i){var o=i.id;return o===t})),n.map(function(i){var o=eu(i,r);return _objectSpread(_objectSpread({},i),o)})}function wh(e,r){return new Promise(function(t){e.inited?t(Dc(e,r)):e.once("update",function(){t(Dc(e,r))})})}function eu(e,r){var t=r.offset,n=r.shape,i=r.thetaOffset,o=r.mapVersion,s=r.segmentNumber,l=s===void 0?30:s,f=r.autoFit,v=f===void 0?!0:f,y=e.coordinates;if(n==="line")return pathLineAtOffset(y,t);var b=y[0],T=y[1],M=typeof i=="string"?e[i]||0:i,O;switch(n){case"arc":O=arcLineAtOffset;break;case"greatcircle":O=greatCircleLineAtOffset;break;default:O=arcLineAtOffset}var k=O(b,T,t,M,o,l,v),$=_slicedToArray(k,3),G=$[0],oe=$[1],ye=$[2];return{lng:G,lat:oe,height:ye}}var Fs=function(){function e(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,t=arguments.length>1?arguments[1]:void 0;(0,q.Z)(this,e),this.limit=r,this.destroy=t||this.defaultDestroy,this.order=[],this.clear()}return(0,V.Z)(e,[{key:"clear",value:function(){var t=this;this.order.forEach(function(n){t.delete(n)}),this.cache={},this.order=[]}},{key:"get",value:function(t){var n=this.cache[t];return n&&(this.deleteOrder(t),this.appendOrder(t)),n}},{key:"set",value:function(t,n){this.cache[t]?(this.delete(t),this.cache[t]=n,this.appendOrder(t)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[t]=n,this.appendOrder(t))}},{key:"delete",value:function(t){var n=this.cache[t];n&&(this.deleteCache(t),this.deleteOrder(t),this.destroy(n,t))}},{key:"deleteCache",value:function(t){delete this.cache[t]}},{key:"deleteOrder",value:function(t){var n=this.order.findIndex(function(i){return i===t});n>=0&&this.order.splice(n,1)}},{key:"appendOrder",value:function(t){this.order.push(t)}},{key:"defaultDestroy",value:function(t,n){return null}}]),e}();function Nf(e){if(e.length===0)throw new Error("max requires at least one data point");for(var r=e[0],t=1;t<e.length;t++)e[t]>r&&(r=e[t]);return r*1}function Uf(e){if(e.length===0)throw new Error("min requires at least one data point");for(var r=e[0],t=1;t<e.length;t++)e[t]<r&&(r=e[t]);return r*1}function Yo(e){if(e.length===0)return 0;for(var r=e[0]*1,t=1;t<e.length;t++)r+=e[t]*1;return r}function Lu(e){if(e.length===0)throw new Error("mean requires at least one data point");return Yo(e)/e.length}function sp(e){if(e.length===0)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var r=e[0],t=NaN,n=0,i=1,o=1;o<e.length+1;o++)e[o]!==r?(i>n&&(n=i,t=r),i=1,r=e[o]):i++;return t*1}var Il={min:Uf,max:Nf,mean:Lu,sum:Yo,mode:sp};function lf(e,r){return e.map(function(t){return t[r]})}function up(e,r){return Il[e](r)}var Ct=L(47801),Ie=L(95325),B=L(73273),Ys=L(51726),me=L.n(Ys);function Bo(e,r){r===void 0&&(r={});var t=Number(e[0]),n=Number(e[1]),i=Number(e[2]),o=Number(e[3]);if(e.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var s=[t,n],l=[t,o],f=[i,o],v=[i,n];return yr([[s,v,f,l,s]],r.properties,{bbox:e,id:r.id})}var no=L(11312),vu=L.n(no),bs=function(e){return e.Realtime="realtime",e.Overlap="overlap",e.Replace="replace",e}({}),Da=function(e){return e.Loading="Loading",e.Loaded="Loaded",e.Failure="Failure",e.Cancelled="Cancelled",e}({}),nc=0,On=1,gn=2;function Bs(e){e.forEach(function(r){r.isCurrent&&(r.isVisible=r.isLoaded)})}function qo(e){e.forEach(function(r){r.properties.state=nc}),e.forEach(function(r){r.isCurrent&&!ka(r)&&Ls(r)}),e.forEach(function(r){r.isVisible=!!(r.properties.state&gn)})}function mu(e){e.forEach(function(t){t.properties.state=nc}),e.forEach(function(t){t.isCurrent&&ka(t)});var r=e.slice().sort(function(t,n){return t.z-n.z});r.forEach(function(t){t.isVisible=!!(t.properties.state&gn),t.children.length&&(t.isVisible||t.properties.state&On)?t.children.forEach(function(n){n.properties.state=On}):t.isCurrent&&Ls(t)})}function ka(e){for(;e;){if(e.isLoaded)return e.properties.state|=gn,!0;e=e.parent}return!1}function Ls(e){e.children.forEach(function(r){r.isLoaded?r.properties.state|=gn:Ls(r)})}var qs,kc=256,ea=[-1/0,-1/0,1/0,1/0],To=.2,Ch=5,Pl=(qs={},(0,B.Z)(qs,bs.Realtime,Bs),(0,B.Z)(qs,bs.Overlap,qo),(0,B.Z)(qs,bs.Replace,mu),qs),zf=function(){};function gu(e,r,t){var n=Math.floor((e+180)/360*Math.pow(2,t)),i=Math.floor((1-Math.log(Math.tan(r*Math.PI/180)+1/Math.cos(r*Math.PI/180))/Math.PI)/2*Math.pow(2,t));return[n,i]}function Es(e,r,t){var n=e/Math.pow(2,t)*360-180,i=Math.PI-2*Math.PI*r/Math.pow(2,t),o=180/Math.PI*Math.atan(.5*(Math.exp(i)-Math.exp(-i)));return[n,o]}var ic=function(r,t,n){var i=Es(r,t,n),o=(0,yn.Z)(i,2),s=o[0],l=o[1],f=Es(r+1,t+1,n),v=(0,yn.Z)(f,2),y=v[0],b=v[1];return[s,b,y,l]};function Nu(e){var r=e.zoom,t=e.latLonBounds,n=e.maxZoom,i=n===void 0?1/0:n,o=e.minZoom,s=o===void 0?0:o,l=e.zoomOffset,f=l===void 0?0:l,v=e.extent,y=v===void 0?ea:v,b=Math.ceil(r)+f;if(Number.isFinite(s)&&b<s)return[];Number.isFinite(i)&&b>i&&(b=i);for(var T=(0,yn.Z)(t,4),M=T[0],O=T[1],k=T[2],$=T[3],G=[Math.max(M,y[0]),Math.max(O,y[1]),Math.min(k,y[2]),Math.min($,y[3])],oe=[],ye=gu(G[0],G[1],b),Le=(0,yn.Z)(ye,2),$e=Le[0],ut=Le[1],vt=gu(G[2],G[3],b),Rt=(0,yn.Z)(vt,2),Jt=Rt[0],Mr=Rt[1],br=$e;br<=Jt;br++)for(var pn=Mr;pn<=ut;pn++)oe.push({x:br,y:pn,z:b});var kn=(Jt+$e)/2,Pi=(ut+Mr)/2,xa=function(_s,as){return Math.abs(_s-kn)+Math.abs(as-Pi)};return oe.sort(function(is,_s){return xa(is.x,is.y)-xa(_s.x,_s.y)}),oe}var Zf=function(r,t,n){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,o=Math.pow(2,n),s=o-1,l=o,f=r,v=t;return i&&(f<0?f=f+l:f>s&&(f=f%l)),{warpX:f,warpY:v}};function Fc(e){var r=cf();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function cf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Vf=function(e){(0,De.Z)(t,e);var r=Fc(t);function t(n){var i;(0,q.Z)(this,t),i=r.call(this),(0,B.Z)((0,Ie.Z)(i),"tileSize",256),(0,B.Z)((0,Ie.Z)(i),"isVisible",!1),(0,B.Z)((0,Ie.Z)(i),"isCurrent",!1),(0,B.Z)((0,Ie.Z)(i),"isVisibleChange",!1),(0,B.Z)((0,Ie.Z)(i),"loadedLayers",0),(0,B.Z)((0,Ie.Z)(i),"isLayerLoaded",!1),(0,B.Z)((0,Ie.Z)(i),"isLoad",!1),(0,B.Z)((0,Ie.Z)(i),"isChildLoad",!1),(0,B.Z)((0,Ie.Z)(i),"parent",null),(0,B.Z)((0,Ie.Z)(i),"children",[]),(0,B.Z)((0,Ie.Z)(i),"data",null),(0,B.Z)((0,Ie.Z)(i),"properties",{}),(0,B.Z)((0,Ie.Z)(i),"loadDataId",0);var o=n.x,s=n.y,l=n.z,f=n.tileSize,v=n.warp,y=v===void 0?!0:v;return i.x=o,i.y=s,i.z=l,i.warp=y||!0,i.tileSize=f,i}return(0,V.Z)(t,[{key:"isLoading",get:function(){return this.loadStatus===Da.Loading}},{key:"isLoaded",get:function(){return this.loadStatus===Da.Loaded}},{key:"isFailure",get:function(){return this.loadStatus===Da.Failure}},{key:"setTileLayerLoaded",value:function(){this.isLayerLoaded=!0}},{key:"isCancelled",get:function(){return this.loadStatus===Da.Cancelled}},{key:"isDone",get:function(){return[Da.Loaded,Da.Cancelled,Da.Failure].includes(this.loadStatus)}},{key:"bounds",get:function(){return ic(this.x,this.y,this.z)}},{key:"bboxPolygon",get:function(){var i=(0,yn.Z)(this.bounds,4),o=i[0],s=i[1],l=i[2],f=i[3],v=[(l-o)/2,(f-s)/2],y=Bo(this.bounds,{properties:{key:this.key,id:this.key,bbox:this.bounds,center:v,meta:`
      `.concat(this.key,`
      `)}});return y}},{key:"key",get:function(){var i="".concat(this.x,"_").concat(this.y,"_").concat(this.z);return i}},{key:"layerLoad",value:function(){this.loadedLayers++,this.emit("layerLoaded")}},{key:"loadData",value:function(){var n=(0,Ct.Z)(me().mark(function o(s){var l,f,v,y,b,T,M,O,k,$,G,oe,ye,Le,$e,ut,vt;return me().wrap(function(Jt){for(;;)switch(Jt.prev=Jt.next){case 0:return l=s.getData,f=s.onLoad,v=s.onError,this.loadDataId++,y=this.loadDataId,this.isLoading&&this.abortLoad(),this.abortController=new AbortController,this.loadStatus=Da.Loading,b=null,Jt.prev=7,M=this.x,O=this.y,k=this.z,$=this.bounds,G=this.tileSize,oe=this.warp,ye=Zf(M,O,k,oe),Le=ye.warpX,$e=ye.warpY,ut=this.abortController.signal,vt={x:Le,y:$e,z:k,bounds:$,tileSize:G,signal:ut,warp:oe},Jt.next=14,l(vt,this);case 14:b=Jt.sent,Jt.next=20;break;case 17:Jt.prev=17,Jt.t0=Jt.catch(7),T=Jt.t0;case 20:if(y===this.loadDataId){Jt.next=22;break}return Jt.abrupt("return");case 22:if(!(this.isCancelled&&!b)){Jt.next=24;break}return Jt.abrupt("return");case 24:if(!(T||!b)){Jt.next=28;break}return this.loadStatus=Da.Failure,v(T,this),Jt.abrupt("return");case 28:this.loadStatus=Da.Loaded,this.data=b,f(this);case 31:case"end":return Jt.stop()}},o,this,[[7,17]])}));function i(o){return n.apply(this,arguments)}return i}()},{key:"reloadData",value:function(i){this.isLoading&&this.abortLoad(),this.loadData(i)}},{key:"abortLoad",value:function(){this.isLoaded||this.isCancelled||(this.loadStatus=Da.Cancelled,this.abortController.abort(),this.xhrCancel&&this.xhrCancel())}}]),t}(no.EventEmitter),ac=function(r,t){var n=pa(r),i=of(n,t),o=360*3-180,s=85.0511287798065,l=[Math.max(i[0][0],-o),Math.max(i[0][1],-s),Math.min(i[1][0],o),Math.min(i[1][1],s)];return l},oc=function(r,t){var n=pa(r),i=pa(t),o=il(n,i);return o};function Uu(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=zu(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var v=t.next();return o=v.done,v},e:function(v){s=!0,l=v},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function zu(e,r){if(e){if(typeof e=="string")return tu(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return tu(e,r)}}function tu(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function jf(e){var r=Ol();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function Ol(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ru=ii.throttle,Dl=function(e){return e.TilesLoadStart="tiles-load-start",e.TileLoaded="tile-loaded",e.TileError="tile-error",e.TileUnload="tile-unload",e.TileUpdate="tile-update",e.TilesLoadFinished="tiles-load-finished",e}({}),ff=function(e){(0,De.Z)(t,e);var r=jf(t);function t(n){var i;return(0,q.Z)(this,t),i=r.call(this),(0,B.Z)((0,Ie.Z)(i),"currentTiles",[]),(0,B.Z)((0,Ie.Z)(i),"cacheTiles",new Map),(0,B.Z)((0,Ie.Z)(i),"throttleUpdate",ru(function(o,s){i.update(o,s)},16)),(0,B.Z)((0,Ie.Z)(i),"onTileLoad",function(o){i.emit(Dl.TileLoaded,o),i.updateTileVisible(),i.loadFinished()}),(0,B.Z)((0,Ie.Z)(i),"onTileError",function(o,s){i.emit(Dl.TileError,{error:o,tile:s}),i.updateTileVisible(),i.loadFinished()}),(0,B.Z)((0,Ie.Z)(i),"onTileUnload",function(o){i.emit(Dl.TileUnload,o),i.loadFinished()}),i.options={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,extent:ea,getTileData:zf,warp:!0,updateStrategy:bs.Replace},i.updateOptions(n),i}return(0,V.Z)(t,[{key:"isLoaded",get:function(){return this.currentTiles.every(function(i){return i.isDone})}},{key:"tiles",get:function(){var i=Array.from(this.cacheTiles.values()).sort(function(o,s){return o.z-s.z});return i}},{key:"updateOptions",value:function(i){var o=i.minZoom===void 0?this.options.minZoom:Math.ceil(i.minZoom),s=i.maxZoom===void 0?this.options.maxZoom:Math.floor(i.maxZoom);this.options=(0,H.Z)((0,H.Z)((0,H.Z)({},this.options),i),{},{minZoom:o,maxZoom:s})}},{key:"update",value:function(i,o){var s=this,l=Math.max(0,Math.ceil(i));if(!(this.lastViewStates&&this.lastViewStates.zoom===l&&oc(this.lastViewStates.latLonBoundsBuffer,o))){var f=ac(o,To);this.lastViewStates={zoom:l,latLonBounds:o,latLonBoundsBuffer:f},this.currentZoom=l;var v=!1,y=this.getTileIndices(l,f).filter(function(b){return s.options.warp||b.x>=0&&b.x<Math.pow(2,l)});this.emit(Dl.TilesLoadStart),this.currentTiles=y.map(function(b){var T=b.x,M=b.y,O=b.z,k=s.getTile(T,M,O);if(k){var $,G,oe=(($=k)===null||$===void 0?void 0:$.isFailure)||((G=k)===null||G===void 0?void 0:G.isCancelled);return oe&&k.loadData({getData:s.options.getTileData,onLoad:s.onTileLoad,onError:s.onTileError}),k}return k=s.createTile(T,M,O),v=!0,k}),v&&this.resizeCacheTiles(),this.updateTileVisible(),this.pruneRequests()}}},{key:"reloadAll",value:function(){var i=Uu(this.cacheTiles),o;try{for(i.s();!(o=i.n()).done;){var s=(0,yn.Z)(o.value,2),l=s[0],f=s[1];if(!this.currentTiles.includes(f)){this.cacheTiles.delete(l),this.onTileUnload(f);return}this.onTileUnload(f),f.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError})}}catch(v){i.e(v)}finally{i.f()}}},{key:"reloadTileById",value:function(i,o,s){var l=this.cacheTiles.get("".concat(o,",").concat(s,",").concat(i));l&&(this.onTileUnload(l),l.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}))}},{key:"reloadTileByLnglat",value:function(i,o,s){var l=this.getTileByLngLat(i,o,s);l&&this.reloadTileById(l.z,l.x,l.y)}},{key:"reloadTileByExtent",value:function(i,o){var s=this,l=this.getTileIndices(o,i);l.forEach(function(f){s.reloadTileById(f.z,f.x,f.y)})}},{key:"pruneRequests",value:function(){var i=[],o=Uu(this.cacheTiles.values()),s;try{for(o.s();!(s=o.n()).done;){var l=s.value;l.isLoading&&!l.isCurrent&&!l.isVisible&&i.push(l)}}catch(v){o.e(v)}finally{o.f()}for(;i.length>0;){var f=i.shift();f.abortLoad()}}},{key:"getTileByLngLat",value:function(i,o,s){var l=this.options.zoomOffset,f=Math.ceil(s)+l,v=gu(i,o,f),y=this.tiles.filter(function(b){return b.key==="".concat(v[0],"_").concat(v[1],"_").concat(f)});return y[0]}},{key:"getTileExtent",value:function(i,o){return this.getTileIndices(o,i)}},{key:"getTileByZXY",value:function(i,o,s){var l=this.tiles.filter(function(f){return f.key==="".concat(o,"_").concat(s,"_").concat(i)});return l[0]}},{key:"clear",value:function(){var i=Uu(this.cacheTiles.values()),o;try{for(i.s();!(o=i.n()).done;){var s=o.value;s.isLoading?s.abortLoad():this.onTileUnload(s)}}catch(l){i.e(l)}finally{i.f()}this.lastViewStates=void 0,this.cacheTiles.clear(),this.currentTiles=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"updateTileVisible",value:function(){var i=this.options.updateStrategy,o=new Map,s=Uu(this.cacheTiles.values()),l;try{for(s.s();!(l=s.n()).done;){var f=l.value;o.set(f.key,f.isVisible),f.isCurrent=!1,f.isVisible=!1}}catch(O){s.e(O)}finally{s.f()}var v=Uu(this.currentTiles),y;try{for(v.s();!(y=v.n()).done;){var b=y.value;b.isCurrent=!0,b.isVisible=!0}}catch(O){v.e(O)}finally{v.f()}var T=Array.from(this.cacheTiles.values());typeof i=="function"?i(T):Pl[i](T);var M=!1;Array.from(this.cacheTiles.values()).forEach(function(O){O.isVisible!==o.get(O.key)?(O.isVisibleChange=!0,M=!0):O.isVisibleChange=!1}),M&&this.emit(Dl.TileUpdate)}},{key:"getTileIndices",value:function(i,o){var s=this.options,l=s.tileSize,f=s.extent,v=s.zoomOffset,y=Math.floor(this.options.maxZoom),b=Math.ceil(this.options.minZoom),T=Nu({maxZoom:y,minZoom:b,zoomOffset:v,tileSize:l,zoom:i,latLonBounds:o,extent:f});return T}},{key:"getTileId",value:function(i,o,s){var l="".concat(i,",").concat(o,",").concat(s);return l}},{key:"loadFinished",value:function(){var i=!this.currentTiles.some(function(o){return!o.isDone});return i&&this.emit(Dl.TilesLoadFinished),i}},{key:"getTile",value:function(i,o,s){var l=this.getTileId(i,o,s),f=this.cacheTiles.get(l);return f}},{key:"createTile",value:function(i,o,s){var l=this.getTileId(i,o,s),f=new Vf({x:i,y:o,z:s,tileSize:this.options.tileSize,warp:this.options.warp});return this.cacheTiles.set(l,f),f.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}),f}},{key:"resizeCacheTiles",value:function(){var i=Ch*this.currentTiles.length,o=this.cacheTiles.size>i;if(o){var s=Uu(this.cacheTiles),l;try{for(s.s();!(l=s.n()).done;){var f=(0,yn.Z)(l.value,2),v=f[0],y=f[1];if(!y.isVisible&&!this.currentTiles.includes(y)&&(this.cacheTiles.delete(v),this.onTileUnload(y)),this.cacheTiles.size<=i)break}}catch(b){s.e(b)}finally{s.f()}}this.rebuildTileTree()}},{key:"rebuildTileTree",value:function(){var i=Uu(this.cacheTiles.values()),o;try{for(i.s();!(o=i.n()).done;){var s=o.value;s.parent=null,s.children.length=0}}catch(b){i.e(b)}finally{i.f()}var l=Uu(this.cacheTiles.values()),f;try{for(l.s();!(f=l.n()).done;){var v=f.value,y=this.getNearestAncestor(v.x,v.y,v.z);v.parent=y,y!=null&&y.children&&y.children.push(v)}}catch(b){l.e(b)}finally{l.f()}}},{key:"getNearestAncestor",value:function(i,o,s){for(;s>this.options.minZoom;){i=Math.floor(i/2),o=Math.floor(o/2),s=s-1;var l=this.getTile(i,o,s);if(l)return l}return null}}]),t}(vu());function Rh(e){return/(?=.*{box})(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(e)}function Hf(e){var r=[],t=/\{([a-z])-([a-z])\}/.exec(e);if(t){var n=t[1].charCodeAt(0),i=t[2].charCodeAt(0),o;for(o=n;o<=i;++o)r.push(e.replace(t[0],String.fromCharCode(o)));return r}if(t=/\{(\d+)-(\d+)\}/.exec(e),t){for(var s=parseInt(t[2],10),l=parseInt(t[1],10);l<=s;l++)r.push(e.replace(t[0],l.toString()));return r}return r.push(e),r}function h(e,r){if(!e||!e.length)throw new Error("url is not allowed to be empty");var t=r.x,n=r.y,i=r.z,o=Hf(e),s=Math.abs(t+n)%o.length,l=hi(o[s])?"".concat(o[s],"/{z}/{x}/{y}"):o[s];return l.replace(/\{x\}/g,t.toString()).replace(/\{y\}/g,n.toString()).replace(/\{z\}/g,i.toString()).replace(/\{bbox\}/g,ic(t,n,i).join(",")).replace(/\{-y\}/g,(Math.pow(2,i)-n-1).toString())}function d(e,r){var t=r.x,n=r.y,i=r.z,o=r.layer,s=r.version,l=s===void 0?"1.0.0":s,f=r.style,v=f===void 0?"default":f,y=r.format,b=r.service,T=b===void 0?"WMTS":b,M=r.tileMatrixset,O="".concat(e,"&SERVICE=").concat(T,"&REQUEST=GetTile&VERSION=").concat(l,"&LAYER=").concat(o,"&STYLE=").concat(v,"&TILEMATRIXSET=").concat(M,"&FORMAT=").concat(y,"&TILECOL=").concat(t,"&TILEROW=").concat(n,"&TILEMATRIX=").concat(i);return O}function p(e,r){if(!e)throw new Error(r||"web worker helper assertion failed.")}var g={self:typeof self!="undefined"&&self,window:typeof window!="undefined"&&window,document:typeof document!="undefined"&&document},S=g.self||g.window||{},w=g.window||g.self||{},C=g.self||g.window||{},P=g.document||{},Z=typeof importScripts=="function",Y=typeof window!="undefined"&&typeof window.orientation!="undefined",ce=function(){function e(r,t){var n=this;this.name=r,this.workerThread=t,this.isRunning=!0,this.resolve=function(){},this.reject=function(){},this.result=new Promise(function(i,o){n.resolve=i,n.reject=o})}return e.prototype.postMessage=function(r,t){this.workerThread.postMessage({source:"Main thread",type:r,payload:t})},e.prototype.done=function(r){p(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.resolve(r)},e.prototype.error=function(r){p(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.reject(r)},e}(),ge=ce,_e=new Map;function Fe(e){p(e.source&&!e.url||!e.source&&e.url);var r=_e.get(e.source||e.url);return r||(e.url&&(r=Pe(e.url),_e.set(e.url,r)),e.source&&(r=Xe(e.source),_e.set(e.source,r))),p(r),r}function Pe(e){if(!e.startsWith("http"))return e;var r=we(e);return Xe(r)}function Xe(e){var r=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(r)}function we(e){return`try {
  importScripts('`+e+`');
} catch (error) {
  console.error(error);
  throw error;
}`}function Ge(e,r,t){r===void 0&&(r=!0);var n=t||new Set;if(e){if(ct(e))n.add(e);else if(ct(e.buffer))n.add(e.buffer);else if(!ArrayBuffer.isView(e)){if(r&&typeof e=="object")for(var i in e)Ge(e[i],r,n)}}return t===void 0?Array.from(n):[]}function ct(e){return e?e instanceof ArrayBuffer||typeof MessagePort!="undefined"&&e instanceof MessagePort||typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap||typeof OffscreenCanvas!="undefined"&&e instanceof OffscreenCanvas:!1}var At=function(){},$t=function(){function e(r){this.terminated=!1,this.loadableURL="";var t=r.name,n=r.source,i=r.url;p(n||i),this.name=t,this.source=n,this.url=i,this.onMessage=At,this.onError=function(o){return console.log(o)},this.worker=this.createBrowserWorker()}return e.isSupported=function(){return typeof Worker!="undefined"},e.prototype.destroy=function(){this.onMessage=At,this.onError=At,this.worker.terminate(),this.terminated=!0},Object.defineProperty(e.prototype,"isRunning",{get:function(){return!!this.onMessage},enumerable:!1,configurable:!0}),e.prototype.postMessage=function(r,t){t=t||Ge(r),this.worker.postMessage(r,t)},e.prototype.getErrorFromErrorEvent=function(r){var t="Failed to load ";return t+="worker "+this.name+" from "+this.url+". ",r.message&&(t+=r.message+" in "),r.lineno&&(t+=":"+r.lineno+":"+r.colno),new Error(t)},e.prototype.createBrowserWorker=function(){var r=this;this.loadableURL=Fe({source:this.source,url:this.url});var t=new Worker(this.loadableURL,{name:this.name});return t.onmessage=function(n){n.data?r.onMessage(n.data):r.onError(new Error("No data received"))},t.onerror=function(n){r.onError(r.getErrorFromErrorEvent(n)),r.terminated=!0},t.onmessageerror=function(n){return console.error("worker "+r.name+", message error: "+n)},t},e}(),Nt=$t,tr=function(){return tr=Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++){r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},tr.apply(this,arguments)},mr=function(e,r,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function l(y){try{v(n.next(y))}catch(b){s(b)}}function f(y){try{v(n.throw(y))}catch(b){s(b)}}function v(y){y.done?o(y.value):i(y.value).then(l,f)}v((n=n.apply(e,r||[])).next())})},Nr=function(e,r){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(v){return function(y){return f([v,y])}}function f(v){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=v[0]&2?i.return:v[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,v[1])).done)return o;switch(i=0,o&&(v=[v[0]&2,o.value]),v[0]){case 0:case 1:o=v;break;case 4:return t.label++,{value:v[1],done:!1};case 5:t.label++,i=v[1],v=[0];continue;case 7:v=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(v[0]===6||v[0]===2)){t=0;continue}if(v[0]===3&&(!o||v[1]>o[0]&&v[1]<o[3])){t.label=v[1];break}if(v[0]===6&&t.label<o[1]){t.label=o[1],o=v;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(v);break}o[2]&&t.ops.pop(),t.trys.pop();continue}v=r.call(e,t)}catch(y){v=[6,y],i=0}finally{n=o=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}},Fr=function(){function e(r){this.name="unnamed",this.maxConcurrency=1,this.maxMobileConcurrency=1,this.onDebug=function(){},this.reuseWorkers=!0,this.props={},this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.source=r.source,this.url=r.url,this.setProps(r)}return e.prototype.destroy=function(){this.idleQueue.forEach(function(r){return r.destroy()}),this.isDestroyed=!0},e.prototype.setProps=function(r){this.props=tr(tr({},this.props),r),r.name!==void 0&&(this.name=r.name),r.maxConcurrency!==void 0&&(this.maxConcurrency=r.maxConcurrency),r.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=r.maxMobileConcurrency),r.reuseWorkers!==void 0&&(this.reuseWorkers=r.reuseWorkers),r.onDebug!==void 0&&(this.onDebug=r.onDebug)},e.prototype.startJob=function(r,t,n){return t===void 0&&(t=function(i,o,s){return i.done(s)}),n===void 0&&(n=function(i,o){return i.error(o)}),mr(this,void 0,void 0,function(){var i,o=this;return Nr(this,function(s){switch(s.label){case 0:return i=new Promise(function(l){return o.jobQueue.push({name:r,onMessage:t,onError:n,onStart:l}),o}),this.startQueuedJob(),[4,i];case 1:return[2,s.sent()]}})})},e.prototype.startQueuedJob=function(){return mr(this,void 0,void 0,function(){var r,t,n;return Nr(this,function(i){switch(i.label){case 0:if(!this.jobQueue.length)return[2];if(r=this.getAvailableWorker(),!r)return[2];if(t=this.jobQueue.shift(),!t)return[3,4];this.onDebug({message:"Starting job",name:t.name,backlog:this.jobQueue.length,workerThread:r}),n=new ge(t.name,r),r.onMessage=function(o){return t.onMessage(n,o.type,o.payload)},r.onError=function(o){return t.onError(n,o)},t.onStart(n),i.label=1;case 1:return i.trys.push([1,,3,4]),[4,n.result];case 2:return i.sent(),[3,4];case 3:return this.returnWorkerToQueue(r),[7];case 4:return[2]}})})},e.prototype.returnWorkerToQueue=function(r){var t=this.isDestroyed||!this.reuseWorkers||this.count>this.getMaxConcurrency();t?(r.destroy(),this.count--):this.idleQueue.push(r),this.isDestroyed||this.startQueuedJob()},e.prototype.getAvailableWorker=function(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this.getMaxConcurrency()){this.count++;var r=this.name.toLowerCase()+" (#"+this.count+" of "+this.maxConcurrency+")";return new Nt({name:r,source:this.source,url:this.url})}return null},e.prototype.getMaxConcurrency=function(){return Y?this.maxMobileConcurrency:this.maxConcurrency},e}(),an=Fr,In=function(){return In=Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++){r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},In.apply(this,arguments)},Nn=function(e){var r=typeof Symbol=="function"&&Symbol.iterator,t=r&&e[r],n=0;if(t)return t.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")},Un={maxConcurrency:3,maxMobileConcurrency:1,onDebug:function(){},reuseWorkers:!0},ji=function(){function e(r){this.workerPools=new Map,this.props=In({},Un),this.setProps(r),this.workerPools=new Map}return e.isSupported=function(){return Nt.isSupported()},e.getWorkerFarm=function(r){return r===void 0&&(r={}),e.workerFarm=e.workerFarm||new e({}),e.workerFarm.setProps(r),e.workerFarm},e.prototype.destroy=function(){var r,t;try{for(var n=Nn(this.workerPools.values()),i=n.next();!i.done;i=n.next()){var o=i.value;o.destroy()}}catch(s){r={error:s}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(r)throw r.error}}},e.prototype.setProps=function(r){var t,n;this.props=In(In({},this.props),r);try{for(var i=Nn(this.workerPools.values()),o=i.next();!o.done;o=i.next()){var s=o.value;s.setProps(this.getWorkerPoolProps())}}catch(l){t={error:l}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}},e.prototype.getWorkerPool=function(r){var t=r.name,n=r.source,i=r.url,o=this.workerPools.get(t);return o||(o=new an({name:t,source:n,url:i}),o.setProps(this.getWorkerPoolProps()),this.workerPools.set(t,o)),o},e.prototype.getWorkerPoolProps=function(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}},e}(),hn=null,Kn=new Map,_i=function(){function e(){}return Object.defineProperty(e,"onmessage",{set:function(r){self.onmessage=function(t){if(Xn(t)){var n=t.data,i=n.type,o=n.payload;r(i,o)}}},enumerable:!1,configurable:!0}),e.addEventListener=function(r){var t=Kn.get(r);t||(t=function(n){if(Xn(n)){var i=n.data,o=i.type,s=i.payload;r(o,s)}}),self.addEventListener("message",t)},e.removeEventListener=function(r){var t=Kn.get(r);Kn.delete(r),self.removeEventListener("message",t)},e.postMessage=function(r,t){if(self){var n={source:"Worker thread",type:r,payload:t},i=Ge(t);self.postMessage(n,i)}},e}(),ti=null;function Xn(e){var r=e.type,t=e.data;return r==="message"&&t&&typeof t.source=="string"&&t.source==="Main thread"}function pi(e){return JSON.parse(qn(e))}function qn(e){var r=new Set;return JSON.stringify(e,function(t,n){if(typeof n=="object"&&n!==null){if(r.has(n))try{return JSON.parse(JSON.stringify(n))}catch(i){return}r.add(n)}return n})}function $n(e){return""+e.name}function wo(e,r){r===void 0&&(r={});var t=r[e.id]||{},n=e.name+".worker.js",i=t.workerUrl;return r._workerType==="test"&&(i=e.module+"/dist/"+n),i||(i="https://unpkg.com/"+e.module+"/dist/"+n),assert(i),i}var Na=function(e,r,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function l(y){try{v(n.next(y))}catch(b){s(b)}}function f(y){try{v(n.throw(y))}catch(b){s(b)}}function v(y){y.done?o(y.value):i(y.value).then(l,f)}v((n=n.apply(e,r||[])).next())})},Co=function(e,r){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(v){return function(y){return f([v,y])}}function f(v){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=v[0]&2?i.return:v[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,v[1])).done)return o;switch(i=0,o&&(v=[v[0]&2,o.value]),v[0]){case 0:case 1:o=v;break;case 4:return t.label++,{value:v[1],done:!1};case 5:t.label++,i=v[1],v=[0];continue;case 7:v=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(v[0]===6||v[0]===2)){t=0;continue}if(v[0]===3&&(!o||v[1]>o[0]&&v[1]<o[3])){t.label=v[1];break}if(v[0]===6&&t.label<o[1]){t.label=o[1],o=v;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(v);break}o[2]&&t.ops.pop(),t.trys.pop();continue}v=r.call(e,t)}catch(y){v=[6,y],i=0}finally{n=o=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}};function Lo(e,r){return WorkerFarm.isSupported()?e.worker&&(r==null?void 0:r.worker):!1}function Wa(e,r,t,n){return t===void 0&&(t={}),n===void 0&&(n={}),Na(this,void 0,void 0,function(){var i,o,s,l,f,v,y,b;return Co(this,function(T){switch(T.label){case 0:return i=getWorkerName(e),o=getWorkerURL(e,t),s=WorkerFarm.getWorkerFarm(t),l=s.getWorkerPool({name:i,url:o}),f=t.jobName||e.name,[4,l.startJob(f,Ga.bind(null,n))];case 1:return v=T.sent(),y=removeNontransferableOptions(t),v.postMessage("process",{input:r,options:y}),[4,v.result];case 2:return b=T.sent(),[2,b.result]}})})}function Ga(e,r,t,n){return Na(this,void 0,void 0,function(){var i,o,s,l,f,v,y;return Co(this,function(b){switch(b.label){case 0:switch(i=t,i){case"done":return[3,1];case"error":return[3,2];case"process":return[3,3]}return[3,8];case 1:return r.done(n),[3,9];case 2:return r.error(new Error(n.error)),[3,9];case 3:o=n.id,s=n.input,l=n.options,b.label=4;case 4:return b.trys.push([4,6,,7]),e.process?[4,e.process(s,l)]:(r.postMessage("error",{id:o,error:"Worker not set up to process on main thread"}),[2]);case 5:return f=b.sent(),r.postMessage("done",{id:o,result:f}),[3,7];case 6:return v=b.sent(),y=v instanceof Error?v.message:"unknown error",r.postMessage("error",{id:o,error:y}),[3,7];case 7:return[3,9];case 8:console.warn("process-on-worker: unknown message "+t),b.label=9;case 9:return[2]}})})}var Ss=function(){function e(){this._values=[],this._settlers=[],this._closed=!1}return e.prototype[Symbol.asyncIterator]=function(){return this},e.prototype.push=function(r){return this.enqueue(r)},e.prototype.enqueue=function(r){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");var t=this._settlers.shift();r instanceof Error?t.reject(r):t.resolve({value:r})}else this._values.push(r)},e.prototype.close=function(){for(;this._settlers.length>0;){var r=this._settlers.shift();r.resolve({done:!0})}this._closed=!0},e.prototype.next=function(){var r=this;if(this._values.length>0){var t=this._values.shift();return t instanceof Error?Promise.reject(t):Promise.resolve({done:!1,value:t})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0,value:void 0})}return new Promise(function(n,i){r._settlers.push({resolve:n,reject:i})})},e}(),ls=null,Zu=function(e,r,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function l(y){try{v(n.next(y))}catch(b){s(b)}}function f(y){try{v(n.throw(y))}catch(b){s(b)}}function v(y){y.done?o(y.value):i(y.value).then(l,f)}v((n=n.apply(e,r||[])).next())})},cs=function(e,r){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(v){return function(y){return f([v,y])}}function f(v){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=v[0]&2?i.return:v[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,v[1])).done)return o;switch(i=0,o&&(v=[v[0]&2,o.value]),v[0]){case 0:case 1:o=v;break;case 4:return t.label++,{value:v[1],done:!1};case 5:t.label++,i=v[1],v=[0];continue;case 7:v=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(v[0]===6||v[0]===2)){t=0;continue}if(v[0]===3&&(!o||v[1]>o[0]&&v[1]<o[3])){t.label=v[1];break}if(v[0]===6&&t.label<o[1]){t.label=o[1],o=v;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(v);break}o[2]&&t.ops.pop(),t.trys.pop();continue}v=r.call(e,t)}catch(y){v=[6,y],i=0}finally{n=o=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}},nu=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=e[Symbol.asyncIterator],t;return r?r.call(e):(e=typeof __values=="function"?__values(e):e[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(o){t[o]=e[o]&&function(s){return new Promise(function(l,f){s=e[o](s),i(l,f,s.done,s.value)})}}function i(o,s,l,f){Promise.resolve(f).then(function(v){o({value:v,done:l})},s)}},Ns=0,sl,kl;function ul(e,r){var t=this;if(typeof self!="undefined"){var n={process:Fl};WorkerBody.onmessage=function(i,o){return Zu(t,void 0,void 0,function(){var s,l,f,v,y,b,T,M,O,k,$;return cs(this,function(G){switch(G.label){case 0:switch(G.trys.push([0,19,,20]),s=i,s){case"process":return[3,1];case"process-in-batches":return[3,3];case"input-batch":return[3,16];case"input-done":return[3,17]}return[3,18];case 1:if(!e)throw new Error("Worker does not support atomic processing");return[4,e(o.input,o.options||{},n)];case 2:return l=G.sent(),WorkerBody.postMessage("done",{result:l}),[3,18];case 3:if(!r)throw new Error("Worker does not support batched processing");sl=new AsyncQueue,kl=o.options||{},f=r(sl,kl,n),G.label=4;case 4:G.trys.push([4,9,10,15]),v=nu(f),G.label=5;case 5:return[4,v.next()];case 6:if(y=G.sent(),!!y.done)return[3,8];b=y.value,WorkerBody.postMessage("output-batch",{result:b}),G.label=7;case 7:return[3,5];case 8:return[3,15];case 9:return T=G.sent(),k={error:T},[3,15];case 10:return G.trys.push([10,,13,14]),y&&!y.done&&($=v.return)?[4,$.call(v)]:[3,12];case 11:G.sent(),G.label=12;case 12:return[3,14];case 13:if(k)throw k.error;return[7];case 14:return[7];case 15:return WorkerBody.postMessage("done",{}),[3,18];case 16:return sl.push(o.input),[3,18];case 17:return sl.close(),[3,18];case 18:return[3,20];case 19:return M=G.sent(),O=M instanceof Error?M.message:"",WorkerBody.postMessage("error",{error:O}),[3,20];case 20:return[2]}})})}}}function Fl(e,r){return r===void 0&&(r={}),new Promise(function(t,n){var i=Ns++,o=function(l,f){if(f.id===i)switch(l){case"done":WorkerBody.removeEventListener(o),t(f.result);break;case"error":WorkerBody.removeEventListener(o),n(f.error);break;default:}};WorkerBody.addEventListener(o);var s={id:i,input:e,options:r};WorkerBody.postMessage("process",s)})}var Vu=function(e,r,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function l(y){try{v(n.next(y))}catch(b){s(b)}}function f(y){try{v(n.throw(y))}catch(b){s(b)}}function v(y){y.done?o(y.value):i(y.value).then(l,f)}v((n=n.apply(e,r||[])).next())})},iu=function(e,r){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(v){return function(y){return f([v,y])}}function f(v){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=v[0]&2?i.return:v[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,v[1])).done)return o;switch(i=0,o&&(v=[v[0]&2,o.value]),v[0]){case 0:case 1:o=v;break;case 4:return t.label++,{value:v[1],done:!1};case 5:t.label++,i=v[1],v=[0];continue;case 7:v=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(v[0]===6||v[0]===2)){t=0;continue}if(v[0]===3&&(!o||v[1]>o[0]&&v[1]<o[3])){t.label=v[1];break}if(v[0]===6&&t.label<o[1]){t.label=o[1],o=v;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(v);break}o[2]&&t.ops.pop(),t.trys.pop();continue}v=r.call(e,t)}catch(y){v=[6,y],i=0}finally{n=o=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}},ju={};function Ko(e,r,t){return r===void 0&&(r=null),t===void 0&&(t={}),Vu(this,void 0,void 0,function(){return iu(this,function(n){switch(n.label){case 0:return r&&(e=Ka(e,r,t)),ju[e]=ju[e]||As(e),[4,ju[e]];case 1:return[2,n.sent()]}})})}function Ka(e,r,t){if(e.startsWith("http"))return e;var n=t.modules||{};return n[e]?n[e]:t.CDN?(assert(t.CDN.startsWith("http")),t.CDN+"/"+r+"/dist/libs/"+e):isWorker?"../src/libs/"+e:"modules/"+r+"/src/libs/"+e}function As(e){return Vu(this,void 0,void 0,function(){var r,t,n;return iu(this,function(i){switch(i.label){case 0:return e.endsWith("wasm")?[4,fetch(e)]:[3,3];case 1:return r=i.sent(),[4,r.arrayBuffer()];case 2:return[2,i.sent()];case 3:return isWorker?[2,importScripts(e)]:[4,fetch(e)];case 4:return t=i.sent(),[4,t.text()];case 5:return n=i.sent(),[2,au(n,e)]}})})}function au(e,r){if(isWorker)return eval.call(global,e),null;var t=document.createElement("script");t.id=r;try{t.appendChild(document.createTextNode(e))}catch(n){t.text=e}return document.body.appendChild(t),null}var Hu="0.0.3",Ni={id:"null",name:"null",module:"web-worker-helper",options:{}};function po(e){var r=e.color;return!r||!r.length?[1,1,1,1]:r}function io(e,r,t){return t.length===2?[t[0],t[1],0]:[t[0],t[1],t[2]]}function ou(e){var r=e.filter;return r?[1]:[0]}function Bc(e,r){return[r]}var Bl=L(75734),fs=L.n(Bl),Or=L(38015),Wu=Or.Ue(),Gu=Or.Ue(),ao=Or.Ue(),Ll=Or.Ue(),_u=Or.Ue();function Qo(e,r,t,n,i){Or.IH(e,t,n),Or.Fv(e,e),r=Or.al(-e[1],e[0]);var o=Or.al(-t[1],t[0]);return[i/Or.AK(r,o),r]}function sc(e,r){return Or.t8(e,-r[1],r[0])}function hf(e,r,t){return Or.lu(e,r,t),Or.Fv(e,e),e}function Lc(e,r){return e[0]===r[0]&&e[1]===r[1]}function Km(e){for(var r=new Map,t=0;t<e.length;t++){var n=e[0].toString()+"-"+e[1].toString();r.get(n)?(e.splice(t,1),t++):r.set(n,n)}return e}var Bv=function(){function e(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,q.Z)(this,e),(0,B.Z)(this,"lastFlip",-1),(0,B.Z)(this,"miter",Or.al(0,0)),(0,B.Z)(this,"started",!1),(0,B.Z)(this,"dash",!1),(0,B.Z)(this,"totalDistance",0),(0,B.Z)(this,"currentIndex",0),this.join=r.join||"miter",this.cap=r.cap||"butt",this.miterLimit=r.miterLimit||10,this.thickness=r.thickness||1,this.dash=r.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,V.Z)(e,[{key:"extrude_gaode2",value:function(t,n){var i=this.complex;if(t.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=t.length,s=i.startIndex,l=1;l<o;l++){var f,v,y,b=t[l-1];b.push((f=n[l-1][2])!==null&&f!==void 0?f:0);var T=n[l-1],M=t[l];M.push((v=n[l][2])!==null&&v!==void 0?v:0);var O=n[l],k=l<t.length-1?[].concat((0,Wt.Z)(t[l+1]),[(y=n[l+1][2])!==null&&y!==void 0?y:0]):null,$=l<n.length-1?n[l+1]:null,G=this.segment_gaode2(i,s,b,M,k,T,O,$);s+=G}if(this.dash)for(var oe=0;oe<i.positions.length/6;oe++)i.positions[oe*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"simpleExtrude_gaode2",value:function(t,n){var i=this.complex;if(t.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=t.length,s=i.startIndex,l=1;l<o;l++){var f,v,y,b=t[l-1];b.push((f=n[l-1][2])!==null&&f!==void 0?f:0);var T=n[l-1],M=t[l];M.push((v=n[l][2])!==null&&v!==void 0?v:0);var O=n[l],k=l<t.length-1?[].concat((0,Wt.Z)(t[l+1]),[(y=n[l+1][2])!==null&&y!==void 0?y:0]):null,$=l<n.length-1?n[l+1]:null,G=this.simpleSegment(i,s,b,M,k,T,O,$);s+=G}if(this.dash)for(var oe=0;oe<i.positions.length/6;oe++)i.positions[oe*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"extrude",value:function(t){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var i=t.length,o=n.startIndex,s=1;s<i;s++){var l=t[s-1],f=t[s],v=s<t.length-1?t[s+1]:null,y=this.segment(n,o,l,f,v);o+=y}if(this.dash)for(var b=0;b<n.positions.length/6;b++)n.positions[b*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude",value:function(t){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var i=t.length,o=n.startIndex,s=1;s<i;s++){var l=t[s-1],f=t[s],v=s<t.length-1?t[s+1]:null,y=this.simpleSegment(n,o,l,f,v);o+=y}if(this.dash)for(var b=0;b<n.positions.length/6;b++)n.positions[b*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"segment_gaode2",value:function(t,n,i,o,s,l,f,v){var y=0,b=t.indices,T=t.positions,M=t.normals,O=this.cap==="square",k=this.join==="bevel",$=ko([f[0],f[1]]),G=ko([l[0],l[1]]);hf(ao,o,i);var oe=0;if(this.dash&&(oe=this.lineSegmentDistance($,G),this.totalDistance+=oe),this.normal||(this.normal=Or.Ue(),sc(this.normal,ao)),!this.started)if(this.started=!0,O){var ye=Or.Ue(),Le=Or.Ue();Or.IH(ye,this.normal,ao),Or.IH(Le,this.normal,ao),M.push(Le[0],Le[1],0),M.push(ye[0],ye[1],0),T.push(i[0],i[1],i[2]|0,this.totalDistance-oe,-this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),T.push(i[0],i[1],i[2]|0,this.totalDistance-oe,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(T,M,i,this.normal,this.thickness,this.totalDistance-oe);if(b.push(n+0,n+1,n+2),s){Lc(o,s)&&Or.IH(s,o,Or.Fv(s,Or.$X(s,o,i))),hf(Ll,s,o);var vt=Qo(_u,Or.Ue(),ao,Ll,this.thickness),Rt=(0,yn.Z)(vt,2),Jt=Rt[0],Mr=Rt[1],br=Or.AK(_u,this.normal)<0?-1:1,pn=k;if(!pn&&this.join==="miter"){var kn=Jt;kn>this.miterLimit&&(pn=!0)}pn?(M.push(this.normal[0],this.normal[1],0),M.push(Mr[0],Mr[1],0),T.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*br,o[2]|0),this.complex.indexes.push(this.currentIndex),T.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*br,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,b.push.apply(b,(0,Wt.Z)(this.lastFlip!==-br?[n,n+2,n+3]:[n+2,n+1,n+3])),b.push(n+2,n+3,n+4),sc(Wu,Ll),Or.JG(this.normal,Wu),M.push(this.normal[0],this.normal[1],0),T.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*br,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,y+=3):(this.extrusions(T,M,o,Mr,Jt,this.totalDistance),b.push.apply(b,(0,Wt.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),br=-1,Or.JG(this.normal,Mr),y+=2),this.lastFlip=br}else{if(sc(this.normal,ao),O){var $e=Or.Ue(),ut=Or.Ue();Or.lu(ut,ao,this.normal),Or.IH($e,ao,this.normal),M.push(ut[0],ut[1],0),M.push($e[0],$e[1],0),T.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),T.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(T,M,o,this.normal,this.thickness,this.totalDistance);b.push.apply(b,(0,Wt.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),y+=2}return y}},{key:"simpleSegment",value:function(t,n,i,o,s){var l=0,f=t.indices,v=t.positions,y=t.normals,b=ko([o[0],o[1]]),T=ko([i[0],i[1]]);hf(ao,b,T);var M=0;if(this.dash&&(M=this.lineSegmentDistance(b,T),this.totalDistance+=M),this.normal||(this.normal=Or.Ue(),sc(this.normal,ao)),this.started||(this.started=!0,this.extrusions(v,y,i,this.normal,this.thickness,this.totalDistance-M)),f.push(n+0,n+1,n+2),!s)sc(this.normal,ao),this.extrusions(v,y,o,this.normal,this.thickness,this.totalDistance),f.push.apply(f,(0,Wt.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2;else{var O=ko([s[0],s[1]]);Lc(b,O)&&Or.IH(O,b,Or.Fv(O,Or.$X(O,b,T))),hf(Ll,O,b);var k=Qo(_u,Or.Ue(),ao,Ll,this.thickness),$=(0,yn.Z)(k,2),G=$[0],oe=$[1],ye=Or.AK(_u,this.normal)<0?-1:1;this.extrusions(v,y,o,oe,G,this.totalDistance),f.push.apply(f,(0,Wt.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),ye=-1,Or.JG(this.normal,oe),l+=2,this.lastFlip=ye}return l}},{key:"segment",value:function(t,n,i,o,s){var l=0,f=t.indices,v=t.positions,y=t.normals,b=this.cap==="square",T=this.join==="bevel",M=ko([o[0],o[1]]),O=ko([i[0],i[1]]);hf(ao,M,O);var k=0;if(this.dash&&(k=this.lineSegmentDistance(M,O),this.totalDistance+=k),this.normal||(this.normal=Or.Ue(),sc(this.normal,ao)),!this.started)if(this.started=!0,b){var $=Or.Ue(),G=Or.Ue();Or.IH($,this.normal,ao),Or.IH(G,this.normal,ao),y.push(G[0],G[1],0),y.push($[0],$[1],0),v.push(i[0],i[1],i[2]|0,this.totalDistance-k,-this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),v.push(i[0],i[1],i[2]|0,this.totalDistance-k,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(v,y,i,this.normal,this.thickness,this.totalDistance-k);if(f.push(n+0,n+1,n+2),s){var Le=ko([s[0],s[1]]);Lc(M,Le)&&Or.IH(Le,M,Or.Fv(Le,Or.$X(Le,M,O))),hf(Ll,Le,M);var $e=Qo(_u,Or.Ue(),ao,Ll,this.thickness),ut=(0,yn.Z)($e,2),vt=ut[0],Rt=ut[1],Jt=Or.AK(_u,this.normal)<0?-1:1,Mr=T;if(!Mr&&this.join==="miter"){var br=vt;br>this.miterLimit&&(Mr=!0)}Mr?(y.push(this.normal[0],this.normal[1],0),y.push(Rt[0],Rt[1],0),v.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*Jt,o[2]|0),this.complex.indexes.push(this.currentIndex),v.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*Jt,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,f.push.apply(f,(0,Wt.Z)(this.lastFlip!==-Jt?[n,n+2,n+3]:[n+2,n+1,n+3])),f.push(n+2,n+3,n+4),sc(Wu,Ll),Or.JG(this.normal,Wu),y.push(this.normal[0],this.normal[1],0),v.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*Jt,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,l+=3):(this.extrusions(v,y,o,Rt,vt,this.totalDistance),f.push.apply(f,(0,Wt.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Jt=-1,Or.JG(this.normal,Rt),l+=2),this.lastFlip=Jt}else{if(sc(this.normal,ao),b){var oe=Or.Ue(),ye=Or.Ue();Or.lu(ye,ao,this.normal),Or.IH(oe,ao,this.normal),y.push(ye[0],ye[1],0),y.push(oe[0],oe[1],0),v.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),v.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(v,y,o,this.normal,this.thickness,this.totalDistance);f.push.apply(f,(0,Wt.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2}return l}},{key:"extrusions",value:function(t,n,i,o,s,l){n.push(o[0],o[1],0),n.push(o[0],o[1],0),t.push(i[0],i[1],i[2]|0,l,-s,i[2]|0),this.complex.indexes.push(this.currentIndex),t.push(i[0],i[1],i[2]|0,l,s,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(t,n){var i=n[0]-t[0],o=n[1]-t[1];return Math.sqrt(i*i+o*o)}}]),e}();function jp(e){var r=e.coordinates,t=e.originCoordinates,n=e.version,i=new Bv({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var o=r;Array.isArray(o[0][0])||(o=[r]);var s=t;Array.isArray(s[0][0])||(s=[t]);for(var l=0;l<o.length;l++){var f=o[l],v=s[l];i.extrude_gaode2(f,v)}}else{var y=r;y[0]&&!Array.isArray(y[0][0])&&(y=[r]),y.forEach(function(T){i.extrude(T)})}var b=i.complex;return{vertices:b.positions,indices:b.indices,normals:b.normals,indexes:b.indexes,size:6}}function pf(e){var r=Ds(e.coordinates);return{vertices:[].concat((0,Wt.Z)(r),(0,Wt.Z)(r),(0,Wt.Z)(r),(0,Wt.Z)(r)),indices:[0,1,2,2,3,0],size:r.length}}function Id(e){var r=e.coordinates,t=fs().flatten(r),n=t.vertices,i=t.dimensions,o=t.holes,s=fs()(n,o,i);return{indices:s,vertices:n,size:i}}var lp=function(){var e=(0,Ct.Z)(me().mark(function r(t){var n,i,o,s,l,f,v,y,b;return me().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return n=t.descriptors,i=t.features,o=t.enablePicking,s=t.iconMap,l={a_Color:po,a_Position:io,filter:ou,a_vertexId:Bc,a_PickingColor:function(k){var $=k.id;return o?ia($):[0,0,0]},a_DistanceAndIndex:function(k,$,G,oe,ye,Le){return Le===void 0?[G[3],10]:[G[3],Le]},a_Total_Distance:function(k,$,G){return[G[5]]},a_Size:function(k){var $=k.size,G=$===void 0?1:$;return Array.isArray(G)?[G[0],G[1]]:[G,0]},a_Normal:function(k,$,G,oe,ye){return ye},a_Miter:function(k,$,G){return[G[4]]},a_iconMapUV:function(k){var $=k.texture,G=s[$]||{x:0,y:0},oe=G.x,ye=G.y;return[oe,ye]}},f={sizePerElement:0,elements:[]},v=0,y=[],b=3,i.forEach(function(O,k){var $=jp(O),G=$.indices,oe=$.vertices,ye=$.normals,Le=$.size,$e=$.indexes;G.forEach(function(Jt){y.push(Jt+v)}),b=Le;var ut=oe.length/Le;f.sizePerElement=b,f.elements.push({featureIdx:k,vertices:oe,normals:ye,offset:v}),v+=ut;for(var vt=function(Mr){var br=(ye==null?void 0:ye.slice(Mr*3,Mr*3+3))||[],pn=oe.slice(Mr*Le,Mr*Le+Le),kn=0;$e&&$e[Mr]!==void 0&&(kn=$e[Mr]),n.forEach(function(Pi){if(Pi&&l[Pi.name]){var xa;(xa=Pi.buffer.data).push.apply(xa,(0,Wt.Z)(l[Pi.name](O,k,pn,Mr,br,kn)))}})},Rt=0;Rt<ut;Rt++)vt(Rt)}),M.abrupt("return",{descriptors:n,featureLayout:f,indices:y});case 8:case"end":return M.stop()}},r)}));return function(t){return e.apply(this,arguments)}}(),Pd=function(){var e=(0,Ct.Z)(me().mark(function r(t){var n,i,o,s,l,f,v,y,b;return me().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return n=t.descriptors,i=t.features,o=t.enablePicking,s=t.shape2d,l={a_Color:po,a_Position:io,filter:ou,a_vertexId:Bc,a_PickingColor:function(k){var $=k.id;return o?ia($):[0,0,0]},a_Shape:function(k){var $=k.shape,G=$===void 0?2:$,oe=s.indexOf(G);return[oe]},a_Extrude:function(k,$,G,oe){var ye=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],Le=oe%4*3;return[ye[Le],ye[Le+1],ye[Le+2]]},a_Size:function(k){var $=k.size,G=$===void 0?5:$;return Array.isArray(G)?[G[0]]:[G]}},f={sizePerElement:0,elements:[]},v=0,y=[],b=3,i.forEach(function(O,k){var $=pf(O),G=$.indices,oe=$.vertices,ye=$.normals,Le=$.size,$e=$.indexes;G.forEach(function(Jt){y.push(Jt+v)}),b=Le;var ut=oe.length/Le;f.sizePerElement=b,f.elements.push({featureIdx:k,vertices:oe,normals:ye,offset:v}),v+=ut;for(var vt=function(Mr){var br=(ye==null?void 0:ye.slice(Mr*3,Mr*3+3))||[],pn=oe.slice(Mr*Le,Mr*Le+Le),kn=0;$e&&$e[Mr]!==void 0&&(kn=$e[Mr]),n.forEach(function(Pi){if(Pi&&l[Pi.name]){var xa;(xa=Pi.buffer.data).push.apply(xa,(0,Wt.Z)(l[Pi.name](O,k,pn,Mr,br,kn)))}})},Rt=0;Rt<ut;Rt++)vt(Rt)}),M.abrupt("return",{descriptors:n,featureLayout:f,indices:y});case 8:case"end":return M.stop()}},r)}));return function(t){return e.apply(this,arguments)}}(),Nc=function(){var e=(0,Ct.Z)(me().mark(function r(t){var n,i,o,s,l,f,v,y;return me().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return n=t.descriptors,i=t.features,o=t.enablePicking,s={a_Color:po,a_Position:io,filter:ou,a_vertexId:Bc,a_PickingColor:function(O){var k=O.id;return o?ia(k):[0,0,0]}},l={sizePerElement:0,elements:[]},f=0,v=[],y=3,i.forEach(function(M,O){var k=Id(M),$=k.indices,G=k.vertices,oe=k.normals,ye=k.size,Le=k.indexes;$.forEach(function(Rt){v.push(Rt+f)}),y=ye;var $e=G.length/ye;l.sizePerElement=y,l.elements.push({featureIdx:O,vertices:G,normals:oe,offset:f}),f+=$e;for(var ut=function(Jt){var Mr=(oe==null?void 0:oe.slice(Jt*3,Jt*3+3))||[],br=G.slice(Jt*ye,Jt*ye+ye),pn=0;Le&&Le[Jt]!==void 0&&(pn=Le[Jt]),n.forEach(function(kn){if(kn&&s[kn.name]){var Pi;(Pi=kn.buffer.data).push.apply(Pi,(0,Wt.Z)(s[kn.name](M,O,br,Jt,Mr,pn)))}})},vt=0;vt<$e;vt++)ut(vt)}),T.abrupt("return",{descriptors:n,featureLayout:l,indices:v});case 8:case"end":return T.stop()}},r)}));return function(t){return e.apply(this,arguments)}}(),Mh={pointFill:Pd,line:lp,polygonFill:Nc},Od=(0,H.Z)({},Mh);function Qm(e){return Hp.apply(this,arguments)}function Hp(){return Hp=_asyncToGenerator(_regeneratorRuntime.mark(function e(r){var t,n;return _regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(t=r.workerType,n=r.data,!Od[t]){o.next=3;break}return o.abrupt("return",Od[t](n));case 3:return o.abrupt("return",Promise.reject(new Error('Worker with type "'.concat(t,'" non-existent.'))));case 4:case"end":return o.stop()}},e)})),Hp.apply(this,arguments)}var Dd=new Map;function Jm(e,r){Dd.set(e,r)}function kd(e){var r=Dd.get(e);return r}var Uc="l7-worker",Wf=3,cp=!0;function df(e){registerWorkerSource(Uc,e)}function fp(){var e=getWorkerSource(Uc);if(!e)throw new Error("get worker failed by workerName: ".concat(Uc,"."));return e}function oo(e,r){return uc.apply(this,arguments)}function uc(){return uc=_asyncToGenerator(_regeneratorRuntime.mark(function e(r,t){var n,i,o,s,l;return _regeneratorRuntime.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return n=fp(),i=WorkerFarm.getWorkerFarm({maxConcurrency:Wf,reuseWorkers:cp}),o=i.getWorkerPool({name:Uc,source:n}),v.next=5,o.startJob(Uc,function(y,b,T){return y.done(T)});case 5:return s=v.sent,s.postMessage("process",{input:{workerType:r,data:t}}),v.next=9,s.result;case 9:return l=v.sent,v.abrupt("return",l.result);case 11:case"end":return v.stop()}},e)})),uc.apply(this,arguments)}var hp=L(47903),vf=L.n(hp);function mf(e,r){return e.map(function(t){return t[r]*1})}function zc(e){return e===void 0?!1:!Array.isArray(e)&&e.data!==void 0}function Ih(e){return Array.isArray(e)?e.length===0?!1:!!zc(e[0]):!1}function gf(e){return Array.isArray(e)?e.length===0||typeof e[0]=="number":!1}function ll(e){var r=Object.isFrozen(e)?ii.cloneDeep(e):e;return vf()(r,!0),r}function Zc(e,r){var t=r.x,n=r.y,i=r.x1,o=r.y1,s=r.coordinates,l=r.geometry,f=[];if(!Array.isArray(e))return{dataArray:[]};if(l)return e.filter(function(G){return G[l]&&G[l].type&&G[l].coordinates&&G[l].coordinates.length>0}).forEach(function(G,oe){var ye=ll(G[l]);di(ye,function(Le){var $e=Ar(Le),ut=(0,H.Z)((0,H.Z)({},G),{},{_id:oe,coordinates:$e});f.push(ut)})}),{dataArray:f};for(var v=0;v<e.length;v++){var y=e[v],b=[];if(s){var T="Polygon";Array.isArray(s[0])||(T="Point"),Array.isArray(s[0])&&!Array.isArray(s[0][0])&&(T="LineString");var M=ll({type:T,coordinates:y[s]});b=M.coordinates}else if(t&&n&&i&&o){var O=[parseFloat(y[t]),parseFloat(y[n])],k=[parseFloat(y[i]),parseFloat(y[o])];b=[O,k]}else t&&n&&(b=[parseFloat(y[t]),parseFloat(y[n])]);var $=(0,H.Z)((0,H.Z)({},y),{},{_id:v,coordinates:b});f.push($)}return{dataArray:f}}function _f(e,r){var t=Et(e);return Zc(t,r)}var cl=L(40727);function lc(e){for(var r=e.toString(),t=5381,n=r.length;n;)t=t*33^r.charCodeAt(--n);return t>>>0}function yf(e,r){return r===void 0?null:(0,cl.Z)(e.properties[r])*1==="number"?e.properties[r]*1:e.properties&&e.properties[r]?lc(e.properties[r]+"")%1000019:null}function pp(e,r){var t=[],n={};return e.features?(e.features=e.features.filter(function(i){var o=i.geometry;return i!=null&&o&&o.type&&o.coordinates&&o.coordinates.length>0}),e=ll(e),e.features.length===0?{dataArray:[],featureKeys:n}:(di(e,function(i,o){var s=yf(i,r==null?void 0:r.featureId);s===null&&(s=o);var l=s,f=Ar(i),v=(0,H.Z)((0,H.Z)({},i.properties),{},{coordinates:f,_id:l});t.push(v)}),{dataArray:t,featureKeys:n})):(e.features=[],{dataArray:[]})}function Ph(e,r,t,n){for(var i=n,o=t-r>>1,s=t-r,l,f=e[r],v=e[r+1],y=e[t],b=e[t+1],T=r+3;T<t;T+=3){var M=Wp(e[T],e[T+1],f,v,y,b);if(M>i)l=T,i=M;else if(M===i){var O=Math.abs(T-o);O<s&&(l=T,s=O)}}i>n&&(l-r>3&&Ph(e,r,l,n),e[l+2]=i,t-l>3&&Ph(e,l,t,n))}function Wp(e,r,t,n,i,o){var s=i-t,l=o-n;if(s!==0||l!==0){var f=((e-t)*s+(r-n)*l)/(s*s+l*l);f>1?(t=i,n=o):f>0&&(t+=s*f,n+=l*f)}return s=e-t,l=r-n,s*s+l*l}function xf(e,r,t,n){var i={id:typeof e=="undefined"?null:e,type:r,geometry:t,tags:n,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return fl(i),i}function fl(e){var r=e.geometry,t=e.type;if(t==="Point"||t==="MultiPoint"||t==="LineString")Nl(e,r);else if(t==="Polygon"||t==="MultiLineString")for(var n=0;n<r.length;n++)Nl(e,r[n]);else if(t==="MultiPolygon")for(n=0;n<r.length;n++)for(var i=0;i<r[n].length;i++)Nl(e,r[n][i])}function Nl(e,r){for(var t=0;t<r.length;t+=3)e.minX=Math.min(e.minX,r[t]),e.minY=Math.min(e.minY,r[t+1]),e.maxX=Math.max(e.maxX,r[t]),e.maxY=Math.max(e.maxY,r[t+1])}function Fd(e,r){var t=[];if(e.type==="FeatureCollection")for(var n=0;n<e.features.length;n++)Oh(t,e.features[n],r,n);else e.type==="Feature"?Oh(t,e,r):Oh(t,{geometry:e},r);return t}function Oh(e,r,t,n){if(r.geometry){var i=r.geometry.coordinates,o=r.geometry.type,s=Math.pow(t.tolerance/((1<<t.maxZoom)*t.extent),2),l=[],f=r.id;if(t.promoteId?f=r.properties[t.promoteId]:t.generateId&&(f=n||0),o==="Point")Gp(i,l);else if(o==="MultiPoint")for(var v=0;v<i.length;v++)Gp(i[v],l);else if(o==="LineString")dp(i,l,s,!1);else if(o==="MultiLineString")if(t.lineMetrics){for(v=0;v<i.length;v++)l=[],dp(i[v],l,s,!1),e.push(xf(f,"LineString",l,r.properties));return}else cc(i,l,s,!1);else if(o==="Polygon")cc(i,l,s,!0);else if(o==="MultiPolygon")for(v=0;v<i.length;v++){var y=[];cc(i[v],y,s,!0),l.push(y)}else if(o==="GeometryCollection"){for(v=0;v<r.geometry.geometries.length;v++)Oh(e,{id:f,geometry:r.geometry.geometries[v],properties:r.properties},t,n);return}else throw new Error("Input data is not a valid GeoJSON object.");e.push(xf(f,o,l,r.properties))}}function Gp(e,r){r.push(Bd(e[0])),r.push(hl(e[1])),r.push(0)}function dp(e,r,t,n){for(var i,o,s=0,l=0;l<e.length;l++){var f=Bd(e[l][0]),v=hl(e[l][1]);r.push(f),r.push(v),r.push(0),l>0&&(n?s+=(i*v-f*o)/2:s+=Math.sqrt(Math.pow(f-i,2)+Math.pow(v-o,2))),i=f,o=v}var y=r.length-3;r[2]=1,Ph(r,0,y,t),r[y+2]=1,r.size=Math.abs(s),r.start=0,r.end=r.size}function cc(e,r,t,n){for(var i=0;i<e.length;i++){var o=[];dp(e[i],o,t,n),r.push(o)}}function Bd(e){return e/360+.5}function hl(e){var r=Math.sin(e*Math.PI/180),t=.5-.25*Math.log((1+r)/(1-r))/Math.PI;return t<0?0:t>1?1:t}function pl(e,r,t,n,i,o,s,l){if(t/=r,n/=r,o>=t&&s<n)return e;if(s<t||o>=n)return null;for(var f=[],v=0;v<e.length;v++){var y=e[v],b=y.geometry,T=y.type,M=i===0?y.minX:y.minY,O=i===0?y.maxX:y.maxY;if(M>=t&&O<n){f.push(y);continue}else if(O<t||M>=n)continue;var k=[];if(T==="Point"||T==="MultiPoint")bf(b,k,t,n,i);else if(T==="LineString")fc(b,k,t,n,i,!1,l.lineMetrics);else if(T==="MultiLineString")Ul(b,k,t,n,i,!1);else if(T==="Polygon")Ul(b,k,t,n,i,!0);else if(T==="MultiPolygon")for(var $=0;$<b.length;$++){var G=[];Ul(b[$],G,t,n,i,!0),G.length&&k.push(G)}if(k.length){if(l.lineMetrics&&T==="LineString"){for($=0;$<k.length;$++)f.push(xf(y.id,T,k[$],y.tags));continue}(T==="LineString"||T==="MultiLineString")&&(k.length===1?(T="LineString",k=k[0]):T="MultiLineString"),(T==="Point"||T==="MultiPoint")&&(T=k.length===3?"Point":"MultiPoint"),f.push(xf(y.id,T,k,y.tags))}}return f.length?f:null}function bf(e,r,t,n,i){for(var o=0;o<e.length;o+=3){var s=e[o+i];s>=t&&s<=n&&(r.push(e[o]),r.push(e[o+1]),r.push(e[o+2]))}}function fc(e,r,t,n,i,o,s){for(var l=Xp(e),f=i===0?vp:Ts,v=e.start,y,b,T=0;T<e.length-3;T+=3){var M=e[T],O=e[T+1],k=e[T+2],$=e[T+3],G=e[T+4],oe=i===0?M:O,ye=i===0?$:G,Le=!1;s&&(y=Math.sqrt(Math.pow(M-$,2)+Math.pow(O-G,2))),oe<t?ye>t&&(b=f(l,M,O,$,G,t),s&&(l.start=v+y*b)):oe>n?ye<n&&(b=f(l,M,O,$,G,n),s&&(l.start=v+y*b)):Gf(l,M,O,k),ye<t&&oe>=t&&(b=f(l,M,O,$,G,t),Le=!0),ye>n&&oe<=n&&(b=f(l,M,O,$,G,n),Le=!0),!o&&Le&&(s&&(l.end=v+y*b),r.push(l),l=Xp(e)),s&&(v+=y)}var $e=e.length-3;M=e[$e],O=e[$e+1],k=e[$e+2],oe=i===0?M:O,oe>=t&&oe<=n&&Gf(l,M,O,k),$e=l.length-3,o&&$e>=3&&(l[$e]!==l[0]||l[$e+1]!==l[1])&&Gf(l,l[0],l[1],l[2]),l.length&&r.push(l)}function Xp(e){var r=[];return r.size=e.size,r.start=e.start,r.end=e.end,r}function Ul(e,r,t,n,i,o){for(var s=0;s<e.length;s++)fc(e[s],r,t,n,i,o,!1)}function Gf(e,r,t,n){e.push(r),e.push(t),e.push(n)}function vp(e,r,t,n,i,o){var s=(o-r)/(n-r);return e.push(o),e.push(t+(i-t)*s),e.push(1),s}function Ts(e,r,t,n,i,o){var s=(o-t)/(i-t);return e.push(r+(n-r)*s),e.push(o),e.push(1),s}function hs(e,r){var t=r.buffer/r.extent,n=e,i=pl(e,1,-1-t,t,0,-1,2,r),o=pl(e,1,1-t,2+t,0,-1,2,r);return(i||o)&&(n=pl(e,1,-t,1+t,0,-1,2,r)||[],i&&(n=vo(i,1).concat(n)),o&&(n=n.concat(vo(o,-1)))),n}function vo(e,r){for(var t=[],n=0;n<e.length;n++){var i=e[n],o=i.type,s;if(o==="Point"||o==="MultiPoint"||o==="LineString")s=Us(i.geometry,r);else if(o==="MultiLineString"||o==="Polygon"){s=[];for(var l=0;l<i.geometry.length;l++)s.push(Us(i.geometry[l],r))}else if(o==="MultiPolygon")for(s=[],l=0;l<i.geometry.length;l++){for(var f=[],v=0;v<i.geometry[l].length;v++)f.push(Us(i.geometry[l][v],r));s.push(f)}t.push(xf(i.id,o,s,i.tags))}return t}function Us(e,r){var t=[];t.size=e.size,e.start!==void 0&&(t.start=e.start,t.end=e.end);for(var n=0;n<e.length;n+=3)t.push(e[n]+r,e[n+1],e[n+2]);return t}function $p(e,r){if(e.transformed)return e;var t=1<<e.z,n=e.x,i=e.y,o,s,l;for(o=0;o<e.features.length;o++){var f=e.features[o],v=f.geometry,y=f.type;if(f.geometry=[],y===1)for(s=0;s<v.length;s+=2)f.geometry.push(Xf(v[s],v[s+1],r,t,n,i));else for(s=0;s<v.length;s++){var b=[];for(l=0;l<v[s].length;l+=2)b.push(Xf(v[s][l],v[s][l+1],r,t,n,i));f.geometry.push(b)}}return e.transformed=!0,e}function Xf(e,r,t,n,i,o){return[Math.round(t*(e*n-i)),Math.round(t*(r*n-o))]}function Ld(e,r,t,n,i){for(var o=r===i.maxZoom?0:i.tolerance/((1<<r)*i.extent),s={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:t,y:n,z:r,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},l=0;l<e.length;l++){s.numFeatures++,Lv(s,e[l],o,i);var f=e[l].minX,v=e[l].minY,y=e[l].maxX,b=e[l].maxY;f<s.minX&&(s.minX=f),v<s.minY&&(s.minY=v),y>s.maxX&&(s.maxX=y),b>s.maxY&&(s.maxY=b)}return s}function Lv(e,r,t,n){var i=r.geometry,o=r.type,s=[];if(o==="Point"||o==="MultiPoint")for(var l=0;l<i.length;l+=3)s.push(i[l]),s.push(i[l+1]),e.numPoints++,e.numSimplified++;else if(o==="LineString")Yp(s,i,e,t,!1,!1);else if(o==="MultiLineString"||o==="Polygon")for(l=0;l<i.length;l++)Yp(s,i[l],e,t,o==="Polygon",l===0);else if(o==="MultiPolygon")for(var f=0;f<i.length;f++){var v=i[f];for(l=0;l<v.length;l++)Yp(s,v[l],e,t,!0,l===0)}if(s.length){var y=r.tags||null;if(o==="LineString"&&n.lineMetrics){y={};for(var b in r.tags)y[b]=r.tags[b];y.mapbox_clip_start=i.start/i.size,y.mapbox_clip_end=i.end/i.size}var T={geometry:s,type:o==="Polygon"||o==="MultiPolygon"?3:o==="LineString"||o==="MultiLineString"?2:1,tags:y};r.id!==null&&(T.id=r.id),e.features.push(T)}}function Yp(e,r,t,n,i,o){var s=n*n;if(n>0&&r.size<(i?s:n)){t.numPoints+=r.length/3;return}for(var l=[],f=0;f<r.length;f+=3)(n===0||r[f+2]>s)&&(t.numSimplified++,l.push(r[f]),l.push(r[f+1])),t.numPoints++;i&&Nd(l,o),e.push(l)}function Nd(e,r){for(var t=0,n=0,i=e.length,o=i-2;n<i;o=n,n+=2)t+=(e[n]-e[o])*(e[n+1]+e[o+1]);if(t>0===r)for(n=0,i=e.length;n<i/2;n+=2){var s=e[n],l=e[n+1];e[n]=e[i-2-n],e[n+1]=e[i-1-n],e[i-2-n]=s,e[i-1-n]=l}}function Nv(e,r){return new Dh(e,r)}function Dh(e,r){r=this.options=Uv(Object.create(this.options),r);var t=r.debug;if(t&&console.time("preprocess data"),r.maxZoom<0||r.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(r.promoteId&&r.generateId)throw new Error("promoteId and generateId cannot be used together.");var n=Fd(e,r);this.tiles={},this.tileCoords=[],t&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",r.indexMaxZoom,r.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),n=hs(n,r),n.length&&this.splitTile(n,0,0,0),t&&(n.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}Dh.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Dh.prototype.splitTile=function(e,r,t,n,i,o,s){for(var l=[e,r,t,n],f=this.options,v=f.debug;l.length;){n=l.pop(),t=l.pop(),r=l.pop(),e=l.pop();var y=1<<r,b=Jo(r,t,n),T=this.tiles[b];if(!T&&(v>1&&console.time("creation"),T=this.tiles[b]=Ld(e,r,t,n,f),this.tileCoords.push({z:r,x:t,y:n}),v)){v>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",r,t,n,T.numFeatures,T.numPoints,T.numSimplified),console.timeEnd("creation"));var M="z"+r;this.stats[M]=(this.stats[M]||0)+1,this.total++}if(T.source=e,i){if(r===f.maxZoom||r===i)continue;var O=1<<i-r;if(t!==Math.floor(o/O)||n!==Math.floor(s/O))continue}else if(r===f.indexMaxZoom||T.numPoints<=f.indexMaxPoints)continue;if(T.source=null,e.length!==0){v>1&&console.time("clipping");var k=.5*f.buffer/f.extent,$=.5-k,G=.5+k,oe=1+k,ye,Le,$e,ut,vt,Rt;ye=Le=$e=ut=null,vt=pl(e,y,t-k,t+G,0,T.minX,T.maxX,f),Rt=pl(e,y,t+$,t+oe,0,T.minX,T.maxX,f),e=null,vt&&(ye=pl(vt,y,n-k,n+G,1,T.minY,T.maxY,f),Le=pl(vt,y,n+$,n+oe,1,T.minY,T.maxY,f),vt=null),Rt&&($e=pl(Rt,y,n-k,n+G,1,T.minY,T.maxY,f),ut=pl(Rt,y,n+$,n+oe,1,T.minY,T.maxY,f),Rt=null),v>1&&console.timeEnd("clipping"),l.push(ye||[],r+1,t*2,n*2),l.push(Le||[],r+1,t*2,n*2+1),l.push($e||[],r+1,t*2+1,n*2),l.push(ut||[],r+1,t*2+1,n*2+1)}}},Dh.prototype.getTile=function(e,r,t){var n=this.options,i=n.extent,o=n.debug;if(e<0||e>24)return null;var s=1<<e;r=(r%s+s)%s;var l=Jo(e,r,t);if(this.tiles[l])return $p(this.tiles[l],i);o>1&&console.log("drilling down to z%d-%d-%d",e,r,t);for(var f=e,v=r,y=t,b;!b&&f>0;)f--,v=Math.floor(v/2),y=Math.floor(y/2),b=this.tiles[Jo(f,v,y)];return!b||!b.source?null:(o>1&&console.log("found parent tile z%d-%d-%d",f,v,y),o>1&&console.time("drilling down"),this.splitTile(b.source,f,v,y,e,r,t),o>1&&console.timeEnd("drilling down"),this.tiles[l]?$p(this.tiles[l],i):null)};function Jo(e,r,t){return((1<<e)*t+r)*32+e}function Uv(e,r){for(var t in r)e[t]=r[t];return e}var $f=function(){function e(r,t,n,i){(0,q.Z)(this,e),(0,B.Z)(this,"vectorLayerCache",{}),this.x=t,this.y=n,this.z=i,this.vectorTile=r}return(0,V.Z)(e,[{key:"getTileData",value:function(t){if(!t||!this.vectorTile.layers[t])return[];if(this.vectorLayerCache[t])return this.vectorLayerCache[t];var n=this.vectorTile.layers[t];return n.features}},{key:"getFeatureById",value:function(){throw new Error("Method not implemented.")}}]),e}(),qp={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0};function Ud(e){for(var r=0,t=0,n=e.length,i=n-1,o,s;t<n;i=t++)o=e[t],s=e[i],r+=(s.x-o.x)*(o.y+s.y);return r}function Kp(e){var r=e.length;if(r<=1)return[e];for(var t=[],n,i,o=0;o<r;o++){var s=Ud(e[o]);s!==0&&(i===void 0&&(i=s<0),i===s<0?(n&&t.push(n),n=[e[o]]):n.push(e[o]))}return n&&t.push(n),t}var zv=["Unknown","Point","LineString","Polygon"];function Zv(e,r,t,n,i){var o=i.geometry,s=i.type,l=i.tags,f=i.id,v=e*Math.pow(2,n),y=e*r,b=e*t,T=zv[s],M,O;function k(oe){for(var ye=0;ye<oe.length;ye++){var Le=oe[ye];if(Le[3])break;var $e=180-(Le[1]+b)*360/v,ut=(Le[0]+y)*360/v-180,vt=360/Math.PI*Math.atan(Math.exp($e*Math.PI/180))-90;oe[ye]=[ut,vt,0,1]}}switch(s){case 1:var $=[];for(M=0;M<o.length;M++)$[M]=o[M][0];o=$,k(o);break;case 2:for(M=0;M<o.length;M++)k(o[M]);break;case 3:for(o=Kp(o),M=0;M<o.length;M++)for(O=0;O<o[M].length;O++)k(o[M][O]);break}o.length===1?o=o[0]:T="Multi"+T;var G={type:"Feature",geometry:{type:T,coordinates:o},properties:l,id:f,tileOrigin:[0,0],coord:""};return G}var zd=function(){var e=(0,Ct.Z)(me().mark(function r(t,n,i,o){return me().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",new Promise(function(f){var v=n.getTile(t.z,t.x,t.y),y=v?v.features.map(function(M){return Zv(o,i.x,i.y,i.z,M)}):[],b={layers:{defaultLayer:{features:y}}},T=new $f(b,t.x,t.y,t.z);f(T)}));case 1:case"end":return l.stop()}},r)}));return function(t,n,i,o){return e.apply(this,arguments)}}();function Zd(e){var r={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!0,debug:0};return e===void 0||typeof e.geojsonvtOptions=="undefined"?r:(0,H.Z)((0,H.Z)({},r),e.geojsonvtOptions)}function z(e,r){var t=Zd(r),n=t.extent||4096,i=Nv(e,t),o=function(f,v){return zd(v,i,f,n)},s=(0,H.Z)((0,H.Z)((0,H.Z)({},qp),r),{},{getTileData:o});return{data:e,dataArray:[],tilesetOptions:s,isTile:!0}}function Ee(e,r){var t=r.extent,n=t===void 0?[121.168,30.2828,121.384,30.4219]:t,i=r.requestParameters,o=i===void 0?{}:i,s=new Promise(function(f){e instanceof HTMLImageElement||_h(e)?f([e]):Ze(e,o,function(v){f(v)})}),l={originData:e,images:s,_id:1,dataArray:[{_id:0,coordinates:[[n[0],n[1]],[n[2],n[3]]]}]};return l}function Ze(e,r,t){var n=[];if(typeof e=="string")Pa((0,H.Z)((0,H.Z)({},r),{},{url:e}),function(s,l){l&&(n.push(l),t(n))});else{var i=e.length,o=0;e.forEach(function(s){Pa((0,H.Z)((0,H.Z)({},r),{},{url:s}),function(l,f){o++,f&&n.push(f),o===i&&t(n)})})}return Ee}var Ut=function(){var e=(0,Ct.Z)(me().mark(function r(t,n,i,o){var s,l;return me().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return s={x:n.x,y:n.y,z:n.z},l=h(t,s),v.abrupt("return",new Promise(function(y){o?o(s,function(b,T){if(b||!T){var M={layers:{defaultLayer:{features:[]}}},O=new $f(M,n.x,n.y,n.z);y(O)}else{var k={layers:{defaultLayer:{features:T.features}}},$=new $f(k,n.x,n.y,n.z);y($)}}):Ki((0,H.Z)((0,H.Z)({},i),{},{url:l}),function(b,T){if(b||!T){var M={layers:{defaultLayer:{features:[]}}},O=new $f(M,n.x,n.y,n.z);y(O)}else{var k=JSON.parse(T),$={layers:{defaultLayer:{features:k}}},G=new $f($,n.x,n.y,n.z);y(G)}})}));case 3:case"end":return v.stop()}},r)}));return function(t,n,i,o){return e.apply(this,arguments)}}();function cr(e,r){var t=function(o,s){return Ut(e,s,r==null?void 0:r.requestParameters,r.getCustomData)},n=(0,H.Z)((0,H.Z)({},r),{},{getTileData:t});return{dataArray:[],tilesetOptions:n,isTile:!0}}var zt=L(99996),kt=L(63713),Dr=L.n(kt),wr=function(){function e(r,t,n,i){(0,q.Z)(this,e),(0,B.Z)(this,"vectorLayerCache",{}),this.x=t,this.y=n,this.z=i,this.vectorTile=new zt.VectorTile(new(Dr())(r))}return(0,V.Z)(e,[{key:"getTileData",value:function(t){if(!t||!this.vectorTile.layers[t])return[];if(this.vectorLayerCache[t])return this.vectorLayerCache[t];var n=this.vectorTile.layers[t];if(Array.isArray(n.features))return this.vectorLayerCache[t]=n.features,n.features;for(var i=[],o=0;o<n.length;o++){var s=n.feature(o),l=s.toGeoJSON(this.x,this.y,this.z);i.push((0,H.Z)((0,H.Z)({},l),{},{properties:(0,H.Z)({id:l.id},l.properties)}))}return this.vectorLayerCache[t]=i,i}},{key:"getFeatureById",value:function(){throw new Error("Method not implemented.")}}]),e}(),Zr={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,warp:!0},Br=function(){var e=(0,Ct.Z)(me().mark(function r(t,n,i,o,s){var l;return me().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return l=h(t,n),v.abrupt("return",new Promise(function(y){if(s)s({x:i.x,y:i.y,z:i.z},function(T,M){if(T||!M)y(void 0);else{var O=new wr(M,i.x,i.y,i.z);y(O)}});else{var b=Si((0,H.Z)((0,H.Z)({},o),{},{url:l}),function(T,M){if(T||!M)y(void 0);else{var O=new wr(M,i.x,i.y,i.z);y(O)}});i.xhrCancel=function(){return b.cancel()}}}));case 2:case"end":return v.stop()}},r)}));return function(t,n,i,o,s){return e.apply(this,arguments)}}();function Ur(e,r){var t=Array.isArray(e)?e[0]:e,n=function(s,l){return Br(t,s,l,r==null?void 0:r.requestParameters,r==null?void 0:r.getCustomData)},i=(0,H.Z)((0,H.Z)((0,H.Z)({},Zr),r),{},{getTileData:n});return{data:t,dataArray:[],tilesetOptions:i,isTile:!0}}function Wr(e,r,t){switch(e){case"+":return r+t;case"-":return r-t;case"*":return r*t;case"/":return r/t;case"%":return r%t;case"^":return Math.pow(r,t);case"abs":return Math.abs(r);case"floor":return Math.floor(r);case"round":return Math.round(r);case"ceil":return Math.ceil(r);case"sin":return Math.sin(r);case"cos":return Math.cos(r);case"atan":return t===-1?Math.atan(r):Math.atan2(r,t);case"min":return Math.min(r,t);case"max":return Math.max(r,t);case"log10":return Math.log(r);case"log2":return Math.log2(r);default:return console.warn("Calculate symbol err! Return default 0"),0}}function Er(e,r){for(var t=r[0],n=t.width,i=t.height,o=r.map(function(M){return M.rasterData}),s=n*i,l=[],f=JSON.stringify(e),v=0;v<s;v++){var y=JSON.parse(f),b=zr(y,o,v);if(typeof b=="number")l.push(b);else{var T=Qt(y);l.push(T)}}return l}function zr(e,r,t){if(e.length===2&&e[0]==="band"&&typeof e[1]=="number")try{return r[e[1]][t]}catch(n){return console.warn("Raster Data err!"),0}e.map(function(n,i){if(Array.isArray(n)&&n.length>0)switch(n[0]){case"band":try{e[i]=r[n[1]][t]}catch(o){console.warn("Raster Data err!"),e[i]=0}break;default:zr(n,r,t)}})}function St(e){var r=(0,yn.Z)(e,3),t=r[0],n=r[1],i=n===void 0?-1:n,o=r[2],s=o===void 0?-1:o;if(t===void 0)return console.warn("Express err!"),["+",0,0];var l=t.replace(/\s+/g,"");return[l,i,s]}function Qt(e){var r=St(e),t=r[0],n=r[1],i=r[2];return Array.isArray(n)&&(n=Qt(e[1])),Array.isArray(i)&&(i=Qt(e[2])),Wr(t,n,i)}var kr={nd:{type:"operation",expression:["/",["-",["band",1],["band",0]],["+",["band",1],["band",0]]]},rgb:{type:"function",method:Jr}};function Jr(e,r){for(var t=e[0].rasterData,n=e[1].rasterData,i=e[2].rasterData,o=[],s=(r==null?void 0:r.countCut)||[2,98],l=(0,yn.Z)(s,2),f=l[0],v=l[1],y=(r==null?void 0:r.RMinMax)||gr(t,f,v),b=(r==null?void 0:r.GMinMax)||gr(n,f,v),T=(r==null?void 0:r.BMinMax)||gr(i,f,v),M=0;M<t.length;M++)o.push(Math.max(0,t[M]-y[0])),o.push(Math.max(0,n[M]-b[0])),o.push(Math.max(0,i[M]-T[0]));return{rasterData:o,rMinMax:y,gMinMax:b,bMinMax:T}}function gr(e,r,t){var n=e.slice().sort(function(l,f){return l-f}),i=n.length,o=n[Math.ceil(i*r/100)],s=n[Math.ceil(i*t/100)];return[o,s]}function tn(e,r,t){return Ir.apply(this,arguments)}function Ir(){return Ir=(0,Ct.Z)(me().mark(function e(r,t,n){var i,o,s,l,f,v;return me().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(r.length!==0){b.next=2;break}return b.abrupt("return",{rasterData:[0],width:1,heigh:1});case 2:return b.next=4,Promise.all(r.map(function(T){var M=T.data,O=T.bands,k=O===void 0?[0]:O;return t(M,k)}));case 4:i=b.sent,o=[],i.forEach(function(T){Array.isArray(T)?o.push.apply(o,(0,Wt.Z)(T)):o.push(T)}),s=o[0],l=s.width,f=s.height,b.t0=(0,cl.Z)(n),b.next=b.t0==="function"?11:b.t0==="object"?13:15;break;case 11:return v=n(o),b.abrupt("break",16);case 13:return Array.isArray(n)?v={rasterData:Er(n,o)}:v=en(n,o),b.abrupt("break",16);case 15:v={rasterData:o[0].rasterData};case 16:return b.abrupt("return",(0,H.Z)((0,H.Z)({},v),{},{width:l,height:f}));case 17:case"end":return b.stop()}},e)})),Ir.apply(this,arguments)}function en(e,r){var t=kr[e.type];if(t.type==="function")return t.method(r,e==null?void 0:e.options);if(t.type==="operation")return e.type==="rgb"?xr(t.expression,r):{rasterData:Er(t.expression,r)}}function xr(e,r){e.r===void 0&&console.warn("Channel R lost in Operation! Use band[0] to fill!"),e.g===void 0&&console.warn("Channel G lost in Operation! Use band[0] to fill!"),e.b===void 0&&console.warn("Channel B lost in Operation! Use band[0] to fill!");var t=Er(e.r||["band",0],r),n=Er(e.g||["band",0],r),i=Er(e.b||["band",0],r);return[t,n,i]}function Xr(e,r,t,n){return Fn.apply(this,arguments)}function Fn(){return Fn=(0,Ct.Z)(me().mark(function e(r,t,n,i){var o;return me().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,tn(r,t,n);case 2:o=l.sent,i(null,{data:o});case 4:case"end":return l.stop()}},e)})),Fn.apply(this,arguments)}function ui(e,r){var t=r.extent,n=r.width,i=r.height,o=r.min,s=r.max,l=r.format,f=r.operation,v,y,b;if(l===void 0||gf(e))v=Array.from(e),y=n,b=i;else{var T=Array.isArray(e)?e:[e];v=tn(T,l,f)}var M={_id:1,dataArray:[{_id:1,data:v,width:y,height:b,min:o,max:s,coordinates:[[t[0],t[1]],[t[2],t[3]]]}]};return M}var qr=L(96485),gt=L(14156),pr=L(67754),tt={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),IDebugService:Symbol.for("IDebugService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},wi=L(25865),on=L.n(wi);function yi(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=ai(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var v=t.next();return o=v.done,v},e:function(v){s=!0,l=v},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function ai(e,r){if(e){if(typeof e=="string")return Yn(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Yn(e,r)}}function Yn(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var Ui=30;function mo(e){var r=e.characterSet,t=e.getFontWidth,n=e.fontHeight,i=e.buffer,o=e.maxCanvasWidth,s=e.mapping,l=s===void 0?{}:s,f=e.xOffset,v=f===void 0?0:f,y=e.yOffset,b=y===void 0?0:y,T=0,M=v;Array.from(r).forEach(function(k,$){if(!l[k]){var G=t(k,$);M+Ui>o&&(M=0,T++),l[k]={x:M,y:b+T*Ui,width:Ui,height:Ui,advance:G},M+=Ui}});var O=n+i*2;return{mapping:l,xOffset:M,yOffset:b+T*O,canvasHeight:lo(b+(T+1)*O)}}function Wo(e,r,t){var n=0,i=0,o=0,s=[],l={},f=yi(e),v;try{for(f.s();!(v=f.n()).done;){var y=v.value;if(!l[y.id]){var b=y.size;n+b+r>t&&(Ri(l,s,i),n=0,i=o+i+r,o=0,s=[]),s.push({icon:y,xOffset:n}),n=n+b+r,o=Math.max(o,b)}}}catch(M){f.e(M)}finally{f.f()}s.length>0&&Ri(l,s,i);var T=lo(o+i+r);return{mapping:l,canvasHeight:T}}function Ri(e,r,t){var n=yi(r),i;try{for(n.s();!(i=n.n()).done;){var o=i.value,s=o.icon,l=o.xOffset;e[s.id]=(0,H.Z)((0,H.Z)({},s),{},{x:l,y:t,image:s.image,width:s.width,height:s.height})}}catch(f){n.e(f)}finally{n.f()}}function lo(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var Sa,go;function _o(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Qa(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var v=t.next();return o=v.done,v},e:function(v){s=!0,l=v},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function Qa(e,r){if(e){if(typeof e=="string")return Ro(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Ro(e,r)}}function Ro(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function ps(e){var r=Mo();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function Mo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xi=bi(),es="sans-serif",aa="normal",Wn=24,Mi=3,Gi=.25,yo=8,Xu=1024,ke=1,Zt=1,Bt=3,ln=null;function bi(){for(var e=[],r=32;r<128;r++)e.push(String.fromCharCode(r));return e}function da(e,r,t,n){e.font="".concat(n," ").concat(t,"px ").concat(r),e.fillStyle="black",e.textBaseline="middle"}function ue(e,r){for(var t=0;t<e.length;t++)r.data[4*t+3]=e[t]}var Se=(Sa=(0,gt.b2)(),Sa(go=function(e){(0,De.Z)(t,e);var r=ps(t);function t(){var n;(0,q.Z)(this,t);for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return n=r.call.apply(r,[this].concat(o)),(0,B.Z)((0,Ie.Z)(n),"fontAtlas",void 0),(0,B.Z)((0,Ie.Z)(n),"iconFontMap",void 0),(0,B.Z)((0,Ie.Z)(n),"iconFontGlyphs",{}),(0,B.Z)((0,Ie.Z)(n),"fontOptions",void 0),(0,B.Z)((0,Ie.Z)(n),"key",void 0),(0,B.Z)((0,Ie.Z)(n),"cache",new Fs(Bt)),n}return(0,V.Z)(t,[{key:"scale",get:function(){return Zt}},{key:"canvas",get:function(){var i=this.cache.get(this.key);return i&&i.data}},{key:"mapping",get:function(){var i=this.cache.get(this.key);return i&&i.mapping||{}}},{key:"getCanvasByKey",value:function(i){var o=this.cache.get(i);return o&&o.data}},{key:"getMappingByKey",value:function(i){var o=this.cache.get(i);return o&&o.mapping||{}}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:es,fontWeight:aa,characterSet:xi,fontSize:Wn,buffer:Mi,sdf:!0,cutoff:Gi,radius:yo,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(i){var o=this;i.forEach(function(s){o.iconFontGlyphs[s.name]=s.unicode})}},{key:"addIconFont",value:function(i,o){this.iconFontMap.set(i,o)}},{key:"getIconFontKey",value:function(i){return this.iconFontMap.get(i)||i}},{key:"getGlyph",value:function(i){return this.iconFontGlyphs[i]?String.fromCharCode(parseInt(this.iconFontGlyphs[i],16)):""}},{key:"setFontOptions",value:function(i){this.fontOptions=(0,H.Z)((0,H.Z)({},this.fontOptions),i),this.key=this.getKey();var o=this.getNewChars(this.key,this.fontOptions.characterSet),s=this.cache.get(this.key);if(!(s&&o.length===0)){var l=this.generateFontAtlas(this.key,o,s);this.fontAtlas=l,this.cache.set(this.key,l)}}},{key:"addFontFace",value:function(i,o){var s=this,l=document.createElement("style");l.type="text/css",l.innerText=`
        @font-face{
            font-family: '`.concat(i,`';
            src: url('`).concat(o,`') format('woff2'),
            url('`).concat(o,`') format('woff'),
            url('`).concat(o,`') format('truetype');
        }`),l.onload=function(){if(document.fonts)try{document.fonts.load("24px ".concat(i),"L7text"),document.fonts.ready.then(function(){s.emit("fontloaded",{fontFamily:i})})}catch(f){console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 document.fonts !"),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 iconfont !"),console.warn(f)}},document.getElementsByTagName("head")[0].appendChild(l)}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(i,o,s){var l=this.fontOptions,f=l.fontFamily,v=l.fontWeight,y=l.fontSize,b=l.buffer,T=l.sdf,M=l.radius,O=l.cutoff,k=l.iconfont,$=s&&s.data;$||($=window.document.createElement("canvas"),$.width=Xu);var G=$.getContext("2d",{willReadFrequently:!0});da(G,f,y,v);var oe=mo((0,H.Z)({getFontWidth:function(lu){return G.measureText(lu).width},fontHeight:y*Zt,buffer:b,characterSet:o,maxCanvasWidth:Xu},s&&{mapping:s.mapping,xOffset:s.xOffset,yOffset:s.yOffset})),ye=oe.mapping,Le=oe.canvasHeight,$e=oe.xOffset,ut=oe.yOffset,vt=G.getImageData(0,0,$.width,$.height);if($.height=Le,G.putImageData(vt,0,0),da(G,f,y,v),T){var Rt=new(on())(y,b,M,O,f,v),Jt=G.getImageData(0,0,Rt.size,Rt.size),Mr=_o(o),br;try{for(Mr.s();!(br=Mr.n()).done;){var pn=br.value;if(k){var kn=String.fromCharCode(parseInt(pn.replace("&#x","").replace(";",""),16)),Pi=Rt.draw(kn);ue(Pi,Jt)}else ue(Rt.draw(pn),Jt);G.putImageData(Jt,ye[pn].x,ye[pn].y)}}catch(as){Mr.e(as)}finally{Mr.f()}}else{var xa=_o(o),is;try{for(xa.s();!(is=xa.n()).done;){var _s=is.value;G.fillText(_s,ye[_s].x,ye[_s].y+y*ke)}}catch(as){xa.e(as)}finally{xa.f()}}return{xOffset:$e,yOffset:ut,mapping:ye,data:$,width:$.width,height:$.height}}},{key:"getKey",value:function(){var i=this.fontOptions,o=i.fontFamily,s=i.fontWeight;return"".concat(o,"_").concat(s)}},{key:"getNewChars",value:function(i,o){var s=this.cache.get(i);if(!s)return o;var l=[],f=s.mapping,v=new Set(Object.keys(f)),y=new Set(o);return y.forEach(function(b){v.has(b)||l.push(b)}),l}}]),t}(no.EventEmitter))||go),ze,Lt;function Ft(e){var r=Ye();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function Ye(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var st=3,pt=1024,Me=64,rt=(ze=(0,gt.b2)(),ze(Lt=function(e){(0,De.Z)(t,e);var r=Ft(t);function t(){var n;(0,q.Z)(this,t);for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return n=r.call.apply(r,[this].concat(o)),(0,B.Z)((0,Ie.Z)(n),"canvasHeight",128),(0,B.Z)((0,Ie.Z)(n),"texture",void 0),(0,B.Z)((0,Ie.Z)(n),"canvas",void 0),(0,B.Z)((0,Ie.Z)(n),"iconData",void 0),(0,B.Z)((0,Ie.Z)(n),"iconMap",void 0),(0,B.Z)((0,Ie.Z)(n),"ctx",void 0),(0,B.Z)((0,Ie.Z)(n),"loadingImageCount",0),n}return(0,V.Z)(t,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=window.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(){var n=(0,Ct.Z)(me().mark(function o(s,l){var f,v;return me().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return f=new Image,this.loadingImageCount++,this.hasImage(s)?console.warn("Image Id already exists"):this.iconData.push({id:s,size:Me}),this.updateIconMap(),b.next=6,this.loadImage(l);case 6:f=b.sent,v=this.iconData.find(function(T){return T.id===s}),v&&(v.image=f,v.width=f.width,v.height=f.height),this.update();case 10:case"end":return b.stop()}},o,this)}));function i(o,s){return n.apply(this,arguments)}return i}()},{key:"addImageMini",value:function(i,o,s){var l=this,f=s.getSceneConfig().canvas,v=f.createImage();if(this.loadingImageCount++,this.hasImage(i))throw new Error("Image Id already exists");this.iconData.push({id:i,size:Me}),this.updateIconMap(),this.loadImageMini(o,f).then(function(y){v=y;var b=l.iconData.find(function(T){return T.id===i});b&&(b.image=v,b.width=v.width,b.height=v.height),l.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(i){return this.iconMap.hasOwnProperty(i)}},{key:"removeImage",value:function(i){this.hasImage(i)&&(this.iconData=this.iconData.filter(function(o){return o.id!==i}),delete this.iconMap[i],this.update())}},{key:"destroy",value:function(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}},{key:"loadImage",value:function(i){return new Promise(function(o,s){if(i instanceof HTMLImageElement){o(i);return}var l=new Image;l.crossOrigin="anonymous",l.onload=function(){o(l)},l.onerror=function(){s(new Error("Could not load image at "+i))},l.src=i instanceof File?URL.createObjectURL(i):i})}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var i=this;this.canvas.width=pt,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(o){var s=i.iconMap[o],l=s.x,f=s.y,v=s.image,y=s.width,b=y===void 0?64:y,T=s.height,M=T===void 0?64:T,O=Math.max(b,M),k=O/Me,$=M/k,G=b/k;v&&i.ctx.drawImage(v,l+(Me-G)/2,f+(Me-$)/2,G,$)})}},{key:"updateIconMap",value:function(){var i=Wo(this.iconData,st,pt),o=i.mapping,s=i.canvasHeight;this.iconMap=o,this.canvasHeight=s}},{key:"loadImageMini",value:function(i,o){return new Promise(function(s,l){var f=o.createImage();f.crossOrigin="anonymous",f.onload=function(){s(f)},f.onerror=function(){l(new Error("Could not load image at "+i))},f.src=i})}}]),t}(no.EventEmitter))||Lt),ve=L(39536),at,Gt,or=(at=(0,gt.b2)(),at(Gt=function(){function e(){(0,q.Z)(this,e),(0,B.Z)(this,"viewport",void 0),(0,B.Z)(this,"overridedViewProjectionMatrix",void 0),(0,B.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,B.Z)(this,"jitteredProjectionMatrix",void 0),(0,B.Z)(this,"viewMatrixInverse",void 0),(0,B.Z)(this,"cameraPosition",void 0)}return(0,V.Z)(e,[{key:"init",value:function(){}},{key:"update",value:function(t){this.viewport=t,this.viewMatrixInverse=ve.create(),ve.invert(this.viewMatrixInverse,t.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var t=this.viewport.getCenter(),n=(0,yn.Z)(t,2),i=n[0],o=n[1];return[i,o]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(t,n){return this.viewport.projectFlat(t,n)}},{key:"setViewProjectionMatrix",value:function(t){this.overridedViewProjectionMatrix=t}},{key:"jitterProjectionMatrix",value:function(t,n){var i=ve.fromTranslation(ve.create(),[t,n,0]);this.jitteredProjectionMatrix=ve.multiply(ve.create(),i,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=ve.multiply(ve.create(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),e}())||Gt),_r=function(e){return e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft",e.TOPCENTER="topcenter",e.BOTTOMCENTER="bottomcenter",e.LEFTCENTER="leftcenter",e.RIGHTCENTER="rightcenter",e.LEFTTOP="lefttop",e.RIGHTTOP="righttop",e.LEFTBOTTOM="leftbottom",e.RIGHTBOTTOM="rightbottom",e}({}),vr,Rr;function Pn(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=_n(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var v=t.next();return o=v.done,v},e:function(v){s=!0,l=v},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function _n(e,r){if(e){if(typeof e=="string")return Sn(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Sn(e,r)}}function Sn(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var Gn={topleft:"column",topright:"column",bottomright:"column",bottomleft:"column",leftcenter:"column",rightcenter:"column",topcenter:"row",bottomcenter:"row",lefttop:"row",righttop:"row",leftbottom:"row",rightbottom:"row"},ri=(vr=(0,gt.b2)(),vr(Rr=function(){function e(){(0,q.Z)(this,e),(0,B.Z)(this,"container",void 0),(0,B.Z)(this,"controlCorners",void 0),(0,B.Z)(this,"controlContainer",void 0),(0,B.Z)(this,"scene",void 0),(0,B.Z)(this,"mapsService",void 0),(0,B.Z)(this,"controls",[]),(0,B.Z)(this,"unAddControls",[])}return(0,V.Z)(e,[{key:"init",value:function(t,n){this.container=t.container,this.scene=n,this.mapsService=n.get(tt.IMapService),this.initControlPos()}},{key:"addControl",value:function(t,n){var i=n.get(tt.IMapService);i.map?(t.addTo(this.scene),this.controls.push(t)):this.unAddControls.push(t)}},{key:"getControlByName",value:function(t){return this.controls.find(function(n){return n.controlOption.name===t})}},{key:"removeControl",value:function(t){var n=this.controls.indexOf(t);return n>-1&&this.controls.splice(n,1),t.remove(),this}},{key:"addControls",value:function(){var t=this;this.unAddControls.forEach(function(n){n.addTo(t.scene),t.controls.push(n)}),this.unAddControls=[]}},{key:"destroy",value:function(){var t=Pn(this.controls),n;try{for(t.s();!(n=t.n()).done;){var i=n.value;i.remove()}}catch(o){t.e(o)}finally{t.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var t=this.controlCorners={},n="l7-",i=this.controlContainer=Ji("div",n+"control-container",this.container);function o(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],f=l.map(function(v){return n+v}).join(" ");t[l.filter(function(v){return!["row","column"].includes(v)}).join("")]=Ji("div",f,i)}function s(l){var f=l.replace(/^(top|bottom|left|right|center)/,"$1-").split("-");return[].concat((0,Wt.Z)(f),[Gn[l]])}Object.values(_r).forEach(function(l){o(s(l))}),this.checkCornerOverlap()}},{key:"clearControlPos",value:function(){for(var t in this.controlCorners)this.controlCorners[t]&&Ci(this.controlCorners[t]);this.controlContainer&&Ci(this.controlContainer)}},{key:"checkCornerOverlap",value:function(){var t=this,n=window.MutationObserver;if(n)for(var i=function(){var f=s[o],v=f.match(/^(top|bottom)(left|right)$/);if(v){var y=(0,yn.Z)(v,3),b=y[1],T=y[2],M=t.controlCorners["".concat(b).concat(T)],O=new n(function(k){var $=(0,yn.Z)(k,1),G=$[0].target;M&&(M.style[b]=G.clientHeight+"px")});O.observe(t.controlCorners["".concat(T).concat(b)],{childList:!0,attributes:!0})}},o=0,s=Object.keys(this.controlCorners);o<s.length;o++)i()}}]),e}())||Rr),ta,xo,dl=(ta=(0,gt.b2)(),ta(xo=function(){function e(){(0,q.Z)(this,e),(0,B.Z)(this,"container",void 0),(0,B.Z)(this,"scene",void 0),(0,B.Z)(this,"mapsService",void 0),(0,B.Z)(this,"markers",[]),(0,B.Z)(this,"markerLayers",[]),(0,B.Z)(this,"unAddMarkers",[]),(0,B.Z)(this,"unAddMarkerLayers",[])}return(0,V.Z)(e,[{key:"addMarkerLayer",value:function(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(t),t.addTo(this.scene)):this.unAddMarkerLayers.push(t)}},{key:"removeMarkerLayer",value:function(t){t.destroy(),this.markerLayers.indexOf(t);var n=this.markerLayers.indexOf(t);n>-1&&this.markerLayers.splice(n,1)}},{key:"addMarker",value:function(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(t),t.addTo(this.scene)):this.unAddMarkers.push(t)}},{key:"addMarkers",value:function(){var t=this;this.unAddMarkers.forEach(function(n){n.addTo(t.scene),t.markers.push(n)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var t=this;this.unAddMarkerLayers.forEach(function(n){t.markerLayers.push(n),n.addTo(t.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(t){t.remove(),this.markers.indexOf(t);var n=this.markers.indexOf(t);n>-1&&this.markers.splice(n,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(t){this.scene=t,this.mapsService=t.get(tt.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(t){t.remove()}),this.markers=[],this.markerLayers.forEach(function(t){t.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(t){t.destroy()}}]),e}())||xo),mp,yu,Vd=(mp=(0,gt.b2)(),mp(yu=function(){function e(){(0,q.Z)(this,e),(0,B.Z)(this,"scene",void 0),(0,B.Z)(this,"mapsService",void 0),(0,B.Z)(this,"popups",[]),(0,B.Z)(this,"unAddPopups",[])}return(0,V.Z)(e,[{key:"isMarkerReady",get:function(){return this.mapsService.map&&this.mapsService.getMarkerContainer()}},{key:"removePopup",value:function(t){t!=null&&t.isOpen()&&t.remove();var n=this.popups.indexOf(t);n>-1&&this.popups.splice(n,1);var i=this.unAddPopups.indexOf(t);i>-1&&this.unAddPopups.splice(i,1)}},{key:"destroy",value:function(){this.popups.forEach(function(t){return t.remove()})}},{key:"addPopup",value:function(t){var n=this;t&&t.getOptions().autoClose&&[].concat((0,Wt.Z)(this.popups),(0,Wt.Z)(this.unAddPopups)).forEach(function(i){i.getOptions().autoClose&&n.removePopup(i)}),this.isMarkerReady?(t.addTo(this.scene),this.popups.push(t)):this.unAddPopups.push(t),t.on("close",function(){n.removePopup(t)})}},{key:"initPopup",value:function(){var t=this;this.unAddPopups.length&&this.unAddPopups.forEach(function(n){t.addPopup(n),t.unAddPopups=[]})}},{key:"init",value:function(t){this.scene=t,this.mapsService=t.get(tt.IMapService)}}]),e}())||yu),zs=function(e){return e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none",e}({}),hc=function(e){return e.MULTIPLE="MULTIPLE",e.SINGLE="SINGLE",e}({}),Qp=function(e){return e.AND="and",e.OR="or",e}({}),ds=function(e){return e.INIT="init",e.UPDATE="update",e}({}),eg={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo \u6D4B\u8BD5 Token, \u751F\u4EA7\u73AF\u5883\u52A1\u5FC5\u81EA\u884C\u6CE8\u518C Token \u786E\u4FDD\u670D\u52A1\u7A33\u5B9A \u9AD8\u5FB7\u5730\u56FE\u7533\u8BF7\u5730\u5740 https://lbs.amap.com/api/javascript-api/guide/abc/prepare  Mapbox\u5730\u56FE\u7533\u8BF7\u5730\u5740 https://docs.mapbox.com/help/glossary/access-token/",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},jd=eg,Yf,Hd,gp=ii.merge,tg={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,stencil:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},No={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",maskLayers:[],enableMask:!0,maskOperation:Qp.AND,pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},Xa=(Yf=(0,gt.b2)(),Yf(Hd=function(){function e(){(0,q.Z)(this,e),(0,B.Z)(this,"sceneConfigCache",{}),(0,B.Z)(this,"layerConfigCache",{}),(0,B.Z)(this,"layerAttributeConfigCache",{})}return(0,V.Z)(e,[{key:"getSceneConfig",value:function(t){return this.sceneConfigCache[t]}},{key:"getSceneWarninfo",value:function(t){return jd[t]}},{key:"setSceneConfig",value:function(t,n){this.sceneConfigCache[t]=(0,H.Z)((0,H.Z)({},tg),n)}},{key:"getLayerConfig",value:function(t){return this.layerConfigCache[t]}},{key:"setLayerConfig",value:function(t,n,i){this.layerConfigCache[n]=(0,H.Z)({},gp({},this.sceneConfigCache[t],No,i))}},{key:"getAttributeConfig",value:function(t){return this.layerAttributeConfigCache[t]}},{key:"setAttributeConfig",value:function(t,n){this.layerAttributeConfigCache[t]=(0,H.Z)((0,H.Z)({},this.layerAttributeConfigCache[t]),n)}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),e}())||Hd);function Fi(e,r,t,n){t&&Object.defineProperty(e,r,{enumerable:t.enumerable,configurable:t.configurable,writable:t.writable,value:t.initializer?t.initializer.call(n):void 0})}function Oi(e,r,t,n,i){var o={};return Object.keys(n).forEach(function(s){o[s]=n[s]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=t.slice().reverse().reduce(function(s,l){return l(e,r,s)||s},o),i&&o.initializer!==void 0&&(o.value=o.initializer?o.initializer.call(i):void 0,o.initializer=void 0),o.initializer===void 0&&(Object.defineProperty(e,r,o),o=null),o}var kh=L(49953),Wd=Math.PI/180,rg=512,Gd=4003e4;function qf(e){var r=e.latitude,t=r===void 0?0:r,n=e.zoom,i=n===void 0?0:n,o=e.scale,s=e.highPrecision,l=s===void 0?!1:s,f=e.flipY,v=f===void 0?!1:f;o=o!==void 0?o:Math.pow(2,i);var y={},b=rg*o,T=Math.cos(t*Wd),M=b/360,O=M/T,k=b/Gd/T;if(y.pixelsPerMeter=[k,-k,k],y.metersPerPixel=[1/k,-1/k,1/k],y.pixelsPerDegree=[M,-O,k],y.degreesPerPixel=[1/M,-1/O,1/k],l){var $=Wd*Math.tan(t*Wd)/T,G=M*$/2,oe=b/Gd*$,ye=oe/O*k;y.pixelsPerDegree2=[0,-G,oe],y.pixelsPerMeter2=[ye,0,ye],v&&(y.pixelsPerDegree2[1]=-y.pixelsPerDegree2[1],y.pixelsPerMeter2[1]=-y.pixelsPerMeter2[1])}return v&&(y.pixelsPerMeter[1]=-y.pixelsPerMeter[1],y.metersPerPixel[1]=-y.metersPerPixel[1],y.pixelsPerDegree[1]=-y.pixelsPerDegree[1],y.degreesPerPixel[1]=-y.degreesPerPixel[1]),y}var zl=function(e){return e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.P20=5]="P20",e[e.P20_OFFSET=6]="P20_OFFSET",e[e.METER_OFFSET=7]="METER_OFFSET",e[e.P20_2=8]="P20_2",e}({}),Kf={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},Io,_p,Vc,yp,Jp,Vv=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],xp=(Io=(0,gt.b2)(),_p=(0,gt.f3)(tt.ICameraService),Io(Vc=(yp=function(){function e(){(0,q.Z)(this,e),(0,B.Z)(this,"needRefresh",!0),Fi(this,"cameraService",Jp,this),(0,B.Z)(this,"coordinateSystem",void 0),(0,B.Z)(this,"viewportCenter",void 0),(0,B.Z)(this,"viewportCenterProjection",void 0),(0,B.Z)(this,"pixelsPerDegree",void 0),(0,B.Z)(this,"pixelsPerDegree2",void 0),(0,B.Z)(this,"pixelsPerMeter",void 0)}return(0,V.Z)(e,[{key:"refresh",value:function(t){var n=this.cameraService.getZoom(),i=this.cameraService.getZoomScale(),o=t||this.cameraService.getCenter(),s=qf({latitude:o[1],zoom:n}),l=s.pixelsPerMeter,f=s.pixelsPerDegree;this.viewportCenter=o,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=l,this.pixelsPerDegree=f,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===zl.LNGLAT||this.coordinateSystem===zl.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===zl.LNGLAT_OFFSET?this.calculateLnglatOffset(o,n):this.coordinateSystem===zl.P20_OFFSET&&this.calculateLnglatOffset(o,n,i,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(t){this.coordinateSystem=t}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(t,n,i,o){var s=qf({latitude:t[1],zoom:n,scale:i,flipY:o,highPrecision:!0}),l=s.pixelsPerMeter,f=s.pixelsPerDegree,v=s.pixelsPerDegree2,y=this.cameraService.getViewMatrix(),b=this.cameraService.getProjectionMatrix(),T=ve.multiply([],b,y),M=this.cameraService.projectFlat([Math.fround(t[0]),Math.fround(t[1])],Math.pow(2,n));this.viewportCenterProjection=kh.fF([],[M[0],M[1],0,1],T),y=this.cameraService.getViewMatrixUncentered()||y,T=ve.multiply([],b,y),T=ve.multiply([],T,Vv),this.cameraService.setViewProjectionMatrix(T),this.pixelsPerMeter=l,this.pixelsPerDegree=f,this.pixelsPerDegree2=v}}]),e}(),Jp=Oi(yp.prototype,"cameraService",[_p],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yp))||Vc),jc,jv;function ng(e){var r=E0();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function E0(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ts=(jc=(0,gt.b2)(),jc(jv=function(e){(0,De.Z)(t,e);var r=ng(t);function t(){var n;(0,q.Z)(this,t);for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return n=r.call.apply(r,[this].concat(o)),(0,B.Z)((0,Ie.Z)(n),"renderMap",new Map),(0,B.Z)((0,Ie.Z)(n),"enable",!1),(0,B.Z)((0,Ie.Z)(n),"renderEnable",!1),(0,B.Z)((0,Ie.Z)(n),"cacheLogs",{}),n}return(0,V.Z)(t,[{key:"setEnable",value:function(i){this.enable=!!i}},{key:"log",value:function(i,o){var s=this;if(this.enable){var l=i.split("."),f=null;l.forEach(function(v,y){f!==null?(f[v]||(f[v]={}),y!==l.length-1&&(f=f[v])):(s.cacheLogs[v]||(s.cacheLogs[v]={}),y!==l.length-1&&(f=s.cacheLogs[v])),y===l.length-1&&(f[v]=(0,H.Z)((0,H.Z)({time:Date.now()},f[v]),o))})}}},{key:"getLog",value:function(i){var o=this;switch((0,cl.Z)(i)){case"string":return this.cacheLogs[i];case"object":return i.map(function(s){return o.cacheLogs[s]}).filter(function(s){return s!==void 0});case"undefined":return this.cacheLogs}}},{key:"removeLog",value:function(i){delete this.cacheLogs[i]}},{key:"generateRenderUid",value:function(){return this.renderEnable?Ml():""}},{key:"renderDebug",value:function(i){this.renderEnable=i}},{key:"renderStart",value:function(i){if(!(!this.renderEnable||!this.enable)){var o=this.renderMap.get(i)||{};this.renderMap.set(i,(0,H.Z)((0,H.Z)({},o),{},{renderUid:i,renderStart:Date.now()}))}}},{key:"renderEnd",value:function(i){if(!(!this.renderEnable||!this.enable)){var o=this.renderMap.get(i);if(o){var s=o.renderStart,l=Date.now();this.emit("renderEnd",(0,H.Z)((0,H.Z)({},o),{},{renderEnd:l,renderDuration:l-s})),this.renderMap.delete(i)}}}},{key:"destroy",value:function(){this.cacheLogs=null,this.renderMap.clear()}}]),t}(no.EventEmitter))||jv),Qf=L(11553),bp=L.n(Qf),a=function(e){return e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag",e}({}),u,c,m,x,E;function A(e){var r=I();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function I(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var D={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},N=(u=(0,gt.b2)(),c=(0,gt.f3)(tt.IMapService),u(m=(x=function(e){(0,De.Z)(t,e);var r=A(t);function t(){var n;(0,q.Z)(this,t);for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return n=r.call.apply(r,[this].concat(o)),(0,B.Z)((0,Ie.Z)(n),"indragging",!1),Fi((0,Ie.Z)(n),"mapService",E,(0,Ie.Z)(n)),(0,B.Z)((0,Ie.Z)(n),"hammertime",void 0),(0,B.Z)((0,Ie.Z)(n),"lastClickTime",0),(0,B.Z)((0,Ie.Z)(n),"lastClickXY",[-1,-1]),(0,B.Z)((0,Ie.Z)(n),"clickTimer",void 0),(0,B.Z)((0,Ie.Z)(n),"$containter",void 0),(0,B.Z)((0,Ie.Z)(n),"onDrag",function(l){var f=n.interactionEvent(l);f.type=D[f.type],f.type==="dragging"?n.indragging=!0:n.indragging=!1,n.emit(a.Drag,f)}),(0,B.Z)((0,Ie.Z)(n),"onHammer",function(l){l.srcEvent.stopPropagation();var f=n.interactionEvent(l);n.emit(a.Hover,f)}),(0,B.Z)((0,Ie.Z)(n),"onTouch",function(l){var f=l.touches[0];n.onHover({x:f.pageX,y:f.pageY,type:"touch"})}),(0,B.Z)((0,Ie.Z)(n),"onHover",function(l){var f=l.clientX,v=l.clientY,y=f,b=v,T=l.type,M=n.mapService.getMapContainer();if(M){var O=M.getBoundingClientRect(),k=O.top,$=O.left;y=y-$-M.clientLeft,b=b-k-M.clientTop}var G=n.mapService.containerToLngLat([y,b]);if(T==="click"){n.isDoubleTap(y,b,G);return}if(T==="touch"){n.isDoubleTap(y,b,G);return}T!=="click"&&T!=="dblclick"&&n.emit(a.Hover,{x:y,y:b,lngLat:G,type:T,target:l})}),n}return(0,V.Z)(t,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(a.Hover)}},{key:"triggerHover",value:function(i){var o=i.x,s=i.y;this.emit(a.Hover,{x:o,y:s})}},{key:"triggerSelect",value:function(i){this.emit(a.Select,{featureId:i})}},{key:"triggerActive",value:function(i){this.emit(a.Active,{featureId:i})}},{key:"handleMiniEvent",value:function(i){this.onHover({clientX:i.touches[0].pageX,clientY:i.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var i=this.mapService.getMapContainer();if(i){var o=new(bp()).Manager(i);o.add(new(bp()).Tap({event:"dblclick",taps:2})),o.add(new(bp()).Tap({event:"click"})),o.add(new(bp()).Pan({threshold:0,pointers:0})),o.add(new(bp()).Press({})),o.on("dblclick click",this.onHammer),o.on("panstart panmove panend pancancel",this.onDrag),i.addEventListener("mousemove",this.onHover),i.addEventListener("mousedown",this.onHover,!0),i.addEventListener("mouseup",this.onHover),i.addEventListener("contextmenu",this.onHover),this.hammertime=o}}},{key:"removeEventListenerOnMap",value:function(){var i=this.mapService.getMapContainer();i&&(i.removeEventListener("mousemove",this.onHover),this.hammertime.off("dblclick click",this.onHammer),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),i.removeEventListener("mousedown",this.onHover),i.removeEventListener("mouseup",this.onHover),i.removeEventListener("contextmenu",this.onHover))}},{key:"interactionEvent",value:function(i){var o=i.type,s=i.pointerType,l,f;s==="touch"?(f=Math.floor(i.pointers[0].clientY),l=Math.floor(i.pointers[0].clientX)):(f=Math.floor(i.srcEvent.y),l=Math.floor(i.srcEvent.x));var v=this.mapService.getMapContainer();if(v){var y=v.getBoundingClientRect(),b=y.top,T=y.left;l-=T,f-=b}var M=this.mapService.containerToLngLat([l,f]);return{x:l,y:f,lngLat:M,type:o,target:i.srcEvent}}},{key:"isDoubleTap",value:function(i,o,s){var l=this,f=new Date().getTime(),v="click";f-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-i)<10&&Math.abs(this.lastClickXY[1]-o)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),v="dblclick",this.emit(a.Hover,{x:i,y:o,lngLat:s,type:v})):(this.lastClickTime=f,this.lastClickXY=[i,o],this.clickTimer=setTimeout(function(){v="click",l.emit(a.Hover,{x:i,y:o,lngLat:s,type:v})},400))}}]),t}(vu()),E=Oi(x.prototype,"mapService",[c],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),x))||m),j=0;function X(e){var r=e;if(typeof e=="string"&&(r=document.getElementById(e)),r){var t=document.createElement("div");return t.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,t.id="l7-scene-".concat(j++),t.classList.add("l7-scene"),r.appendChild(t),t}return null}function ee(e){var r,t=!0;if((e==null||(r=e.target)===null||r===void 0?void 0:r.target)instanceof HTMLElement)for(var n,i=e==null||(n=e.target)===null||n===void 0?void 0:n.target;i;){var o,s=Array.from(i.classList);if(s.includes("l7-marker")||s.includes("l7-popup")){t=!1;break}i=(o=i)===null||o===void 0?void 0:o.parentElement}return t}var R=function(e){return e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e}({}),Ce,Oe,Qe,He,xt,It,Vt,jt,fr,Lr,Gr,Dn,sn,zn=(Ce=(0,gt.b2)(),Oe=(0,gt.f3)(tt.IMapService),Qe=(0,gt.f3)(tt.IRendererService),He=(0,gt.f3)(tt.IGlobalConfigService),xt=(0,gt.f3)(tt.IInteractionService),It=(0,gt.f3)(tt.ILayerService),Ce(Vt=(jt=function(){function e(){var r=this;(0,q.Z)(this,e),(0,B.Z)(this,"pickedColors",void 0),(0,B.Z)(this,"pickedTileLayers",[]),Fi(this,"mapService",fr,this),Fi(this,"rendererService",Lr,this),Fi(this,"configService",Gr,this),Fi(this,"interactionService",Dn,this),Fi(this,"layerService",sn,this),(0,B.Z)(this,"pickingFBO",void 0),(0,B.Z)(this,"width",0),(0,B.Z)(this,"height",0),(0,B.Z)(this,"alreadyInPicking",!1),(0,B.Z)(this,"pickBufferScale",1),(0,B.Z)(this,"pickFromPickingFBO",function(t,n){var i=n.x,o=n.y,s=n.lngLat,l=n.type,f=n.target,v=!1,y=r.rendererService,b=y.readPixels,T=y.getContainer,M=r.getContainerSize(T()),O=M.width,k=M.height;O*=wa,k*=wa;var $=t.getLayerConfig(),G=$.enableHighlight,oe=$.enableSelect,ye=i*wa,Le=o*wa;if(ye>O-1*wa||ye<0||Le>k-1*wa||Le<0)return!1;var $e=b({x:Math.floor(ye/r.pickBufferScale),y:Math.floor((k-(o+1)*wa)/r.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:r.pickingFBO});if(r.pickedColors=$e,$e[0]!==0||$e[1]!==0||$e[2]!==0){var ut=Oa($e),vt=t.layerPickService.getFeatureById(ut);ut!==t.getCurrentPickId()&&l==="mousemove"&&(l="mouseenter");var Rt={x:i,y:o,type:l,lngLat:s,featureId:ut,feature:vt,target:f};vt&&(v=!0,t.setCurrentPickId(ut),r.triggerHoverOnLayer(t,Rt))}else{var Jt={x:i,y:o,lngLat:s,type:t.getCurrentPickId()!==null&&l==="mousemove"?"mouseout":"un"+l,featureId:null,target:f,feature:null};r.triggerHoverOnLayer(t,(0,H.Z)((0,H.Z)({},Jt),{},{type:"unpick"})),r.triggerHoverOnLayer(t,Jt),t.setCurrentPickId(null)}if(G&&t.layerPickService.highlightPickedFeature($e),oe&&l==="click"&&($e==null?void 0:$e.toString())!==[0,0,0,0].toString()){var Mr=Oa($e);t.getCurrentSelectedId()===null||Mr!==t.getCurrentSelectedId()?(t.layerPickService.selectFeature($e),t.setCurrentSelectedId(Mr)):(t.layerPickService.selectFeature(new Uint8Array([0,0,0,0])),t.setCurrentSelectedId(null))}return v})}return(0,V.Z)(e,[{key:"init",value:function(t){var n=this.rendererService,i=n.createTexture2D,o=n.createFramebuffer,s=n.getContainer,l=this.getContainerSize(s()),f=l.width,v=l.height;f*=wa,v*=wa,this.pickBufferScale=this.configService.getSceneConfig(t).pickBufferScale||1,this.pickingFBO=o({color:i({width:Math.round(f/this.pickBufferScale),height:Math.round(v/this.pickBufferScale),wrapS:R.CLAMP_TO_EDGE,wrapT:R.CLAMP_TO_EDGE})}),this.interactionService.on(a.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var r=(0,Ct.Z)(me().mark(function n(i,o,s){var l=this,f,v,y;return me().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:f=this.rendererService,v=f.useFramebuffer,y=f.clear,this.resizePickingFBO(),v(this.pickingFBO,function(){y({framebuffer:l.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),i.hooks.beforePickingEncode.call(),i.renderModels({ispick:!0}),i.hooks.afterPickingEncode.call();var M=l.pickBox(i,o);s(M)});case 3:case"end":return T.stop()}},n,this)}));function t(n,i,o){return r.apply(this,arguments)}return t}()},{key:"pickBox",value:function(t,n){var i=this,o=n.map(function(Mr){var br=Mr<0?0:Mr;return Math.floor(br*wa/i.pickBufferScale)}),s=(0,yn.Z)(o,4),l=s[0],f=s[1],v=s[2],y=s[3],b=this.rendererService,T=b.readPixels,M=b.getContainer,O=this.getContainerSize(M()),k=O.width,$=O.height;if(k*=wa,$*=wa,l>(k-1)*wa/this.pickBufferScale||v<0||f>($-1)*wa/this.pickBufferScale||y<0)return[];for(var G=Math.min(k/this.pickBufferScale,v)-l,oe=Math.min($/this.pickBufferScale,y)-f,ye=T({x:l,y:Math.floor($/this.pickBufferScale-(y+1)),width:G,height:oe,data:new Uint8Array(G*oe*4),framebuffer:this.pickingFBO}),Le=[],$e={},ut=0;ut<ye.length/4;ut=ut+1){var vt=ye.slice(ut*4,ut*4+4),Rt=Oa(vt);if(Rt!==-1&&!$e[Rt]){var Jt=t.layerPickService.getFeatureById(Rt);Le.push((0,H.Z)((0,H.Z)({},Jt),{},{pickedFeatureIdx:Rt})),$e[Rt]=!0}}return Le}},{key:"handleCursor",value:function(t,n){var i=t.getLayerConfig(),o=i.cursor,s=o===void 0?"":o,l=i.cursorEnabled;if(l){var f=this.mapService.version,v=f==="GAODE2.x"?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),y=v==null?void 0:v.style.getPropertyValue("cursor");n==="unmousemove"&&y!==""?v==null||v.style.setProperty("cursor",""):n==="mousemove"&&(v==null||v.style.setProperty("cursor",s))}}},{key:"destroy",value:function(){this.pickingFBO.destroy(),this.pickingFBO=null}},{key:"getContainerSize",value:function(t){return t.getContext?{width:t.width/wa,height:t.height/wa}:t.getBoundingClientRect()}},{key:"pickingAllLayer",value:function(){var r=(0,Ct.Z)(me().mark(function n(i){return me().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(!(!this.layerService.needPick(i.type)||!this.isPickingAllLayer())){s.next=2;break}return s.abrupt("return");case 2:return this.alreadyInPicking=!0,s.next=5,this.pickingLayers(i);case 5:this.layerService.renderLayers(),this.alreadyInPicking=!1;case 7:case"end":return s.stop()}},n,this)}));function t(n){return r.apply(this,arguments)}return t}()},{key:"isPickingAllLayer",value:function(){return!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.interactionService.indragging||!this.layerService.getShaderPickStat())}},{key:"resizePickingFBO",value:function(){var t=this.rendererService.getContainer,n=this.getContainerSize(t()),i=n.width,o=n.height;i*=wa,o*=wa,(this.width!==i||this.height!==o)&&(this.pickingFBO.resize({width:Math.round(i/this.pickBufferScale),height:Math.round(o/this.pickBufferScale)}),this.width=i,this.height=o)}},{key:"pickingLayers",value:function(){var r=(0,Ct.Z)(me().mark(function n(i){var o=this,s,l,f;return me().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:s=this.rendererService,l=s.useFramebuffer,f=s.clear,this.resizePickingFBO(),l(this.pickingFBO,function(){var b=o.layerService.getRenderList();b.filter(function(T){return T.needPick(i.type)}).reverse().some(function(T){f({framebuffer:o.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),T.layerPickService.pickRender(i);var M=o.pickFromPickingFBO(T,i);return o.layerService.pickedLayerId=M?+T.id:-1,M&&!T.getLayerConfig().enablePropagation})});case 3:case"end":return y.stop()}},n,this)}));function t(n){return r.apply(this,arguments)}return t}()},{key:"triggerHoverOnLayer",value:function(t,n){ee(n)&&(this.handleCursor(t,n.type),t.emit(n.type,n))}}]),e}(),fr=Oi(jt.prototype,"mapService",[Oe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lr=Oi(jt.prototype,"rendererService",[Qe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gr=Oi(jt.prototype,"configService",[He],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dn=Oi(jt.prototype,"interactionService",[xt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sn=Oi(jt.prototype,"layerService",[It],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jt))||Vt),cn=function(){function e(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,q.Z)(this,e),(0,B.Z)(this,"autoStart",void 0),(0,B.Z)(this,"startTime",0),(0,B.Z)(this,"oldTime",0),(0,B.Z)(this,"running",!1),(0,B.Z)(this,"elapsedTime",0),this.autoStart=r}return(0,V.Z)(e,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var n=(typeof performance=="undefined"?Date:performance).now();t=(n-this.oldTime)/1e3,this.oldTime=n,this.elapsedTime+=t}return t}}]),e}(),Ei,Qn,Tn,Ii,gi,Bi,Zn,ra,Ua;function Ja(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=so(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var v=t.next();return o=v.done,v},e:function(v){s=!0,l=v},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function so(e,r){if(e){if(typeof e=="string")return za(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return za(e,r)}}function za(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function co(e){var r=Go();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function Go(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Uo=ii.throttle,Zs=(Ei=(0,gt.b2)(),Qn=(0,gt.f3)(tt.IRendererService),Tn=(0,gt.f3)(tt.IMapService),Ii=(0,gt.f3)(tt.IDebugService),Ei(gi=(Bi=function(e){(0,De.Z)(t,e);var r=co(t);function t(){var n;(0,q.Z)(this,t);for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return n=r.call.apply(r,[this].concat(o)),(0,B.Z)((0,Ie.Z)(n),"pickedLayerId",-1),(0,B.Z)((0,Ie.Z)(n),"clock",new cn),(0,B.Z)((0,Ie.Z)(n),"alreadyInRendering",!1),(0,B.Z)((0,Ie.Z)(n),"layers",[]),(0,B.Z)((0,Ie.Z)(n),"layerList",[]),(0,B.Z)((0,Ie.Z)(n),"layerRenderID",void 0),(0,B.Z)((0,Ie.Z)(n),"sceneInited",!1),(0,B.Z)((0,Ie.Z)(n),"animateInstanceCount",0),(0,B.Z)((0,Ie.Z)(n),"shaderPicking",!0),(0,B.Z)((0,Ie.Z)(n),"enableRender",!0),Fi((0,Ie.Z)(n),"renderService",Zn,(0,Ie.Z)(n)),Fi((0,Ie.Z)(n),"mapService",ra,(0,Ie.Z)(n)),Fi((0,Ie.Z)(n),"debugService",Ua,(0,Ie.Z)(n)),(0,B.Z)((0,Ie.Z)(n),"reRender",Uo(function(){n.renderLayers()},32)),(0,B.Z)((0,Ie.Z)(n),"throttleRenderLayers",Uo(function(){n.renderLayers()},16)),n}return(0,V.Z)(t,[{key:"needPick",value:function(i){return this.layerList.some(function(o){return o.needPick(i)})}},{key:"add",value:function(i){var o=this;this.layers.push(i),this.sceneInited&&i.init().then(function(){o.renderLayers()})}},{key:"addMask",value:function(i){var o=this;this.sceneInited&&i.init().then(function(){o.renderLayers()})}},{key:"initLayers",value:function(){var n=(0,Ct.Z)(me().mark(function o(){var s=this;return me().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:this.sceneInited=!0,this.layers.forEach(function(){var v=(0,Ct.Z)(me().mark(function y(b){return me().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:if(b.startInit){M.next=4;break}return M.next=3,b.init();case 3:s.updateLayerRenderList();case 4:case"end":return M.stop()}},y)}));return function(y){return v.apply(this,arguments)}}());case 2:case"end":return f.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSceneInited",value:function(){return this.sceneInited}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(i){return this.layers.find(function(o){return o.id===i})}},{key:"getLayerByName",value:function(i){return this.layers.find(function(o){return o.name===i})}},{key:"remove",value:function(){var n=(0,Ct.Z)(me().mark(function o(s,l){var f,v;return me().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:l?(f=l.layerChildren.indexOf(s),f>-1&&l.layerChildren.splice(f,1)):(v=this.layers.indexOf(s),v>-1&&this.layers.splice(v,1)),s.destroy(),this.reRender(),this.emit("layerChange",this.layers);case 4:case"end":return b.stop()}},o,this)}));function i(o,s){return n.apply(this,arguments)}return i}()},{key:"removeAllLayers",value:function(){var n=(0,Ct.Z)(me().mark(function o(){return me().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:this.destroy(),this.reRender();case 2:case"end":return l.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"setEnableRender",value:function(i){this.enableRender=i}},{key:"renderLayers",value:function(){var n=(0,Ct.Z)(me().mark(function o(){var s,l,f,v,y,b;return me().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:if(!(this.alreadyInRendering||!this.enableRender)){M.next=2;break}return M.abrupt("return");case 2:this.updateLayerRenderList(),s=this.debugService.generateRenderUid(),this.debugService.renderStart(s),this.alreadyInRendering=!0,this.clear(),this.renderService.beginFrame(),l=Ja(this.layerList),M.prev=9,l.s();case 11:if((f=l.n()).done){M.next=24;break}if(v=f.value,y=v.getLayerConfig(),b=y.enableMask,v.masks.filter(function(O){return O.inited}).length>0&&b&&this.renderMask(v.masks),!v.getLayerConfig().enableMultiPassRenderer){M.next=20;break}return M.next=18,v.renderMultiPass();case 18:M.next=22;break;case 20:return M.next=22,v.render();case 22:M.next=11;break;case 24:M.next=29;break;case 26:M.prev=26,M.t0=M.catch(9),l.e(M.t0);case 29:return M.prev=29,l.f(),M.finish(29);case 32:this.renderService.endFrame(),this.debugService.renderEnd(s),this.alreadyInRendering=!1;case 35:case"end":return M.stop()}},o,this,[[9,26,29,32]])}));function i(){return n.apply(this,arguments)}return i}()},{key:"renderMask",value:function(i){var o=0;this.renderService.clear({stencil:0,depth:1,framebuffer:null});var s=i.length>1?hc.MULTIPLE:hc.SINGLE,l=Ja(i),f;try{for(l.s();!(f=l.n()).done;){var v=f.value;v.render({isStencil:!0,stencilType:s,stencilIndex:o++})}}catch(y){l.e(y)}finally{l.f()}}},{key:"beforeRenderData",value:function(){var n=(0,Ct.Z)(me().mark(function o(s){var l;return me().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,s.hooks.beforeRenderData.promise();case 2:l=v.sent,l&&this.renderLayers();case 4:case"end":return v.stop()}},o,this)}));function i(o){return n.apply(this,arguments)}return i}()},{key:"renderTileLayerMask",value:function(i){var o=0,s=i.getLayerConfig(),l=s.enableMask,f=l===void 0?!0:l,v=i.tileMask?1:0,y=i.masks.filter(function(k){return k.inited});v=v+(f?y.length:1);var b=v>1?hc.MULTIPLE:hc.SINGLE;if((i.tileMask||y.length&&f)&&this.renderService.clear({stencil:0,depth:1,framebuffer:null}),y.length&&f){var T=Ja(y),M;try{for(T.s();!(M=T.n()).done;){var O=M.value;O.render({isStencil:!0,stencilType:b,stencilIndex:o++})}}catch(k){T.e(k)}finally{T.f()}}i.tileMask&&i.tileMask.render({isStencil:!0,stencilType:b,stencilIndex:o++,stencilOperation:Qp.OR})}},{key:"renderTileLayer",value:function(){var n=(0,Ct.Z)(me().mark(function o(s){return me().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(this.renderTileLayerMask(s),!s.getLayerConfig().enableMultiPassRenderer){f.next=6;break}return f.next=4,s.renderMultiPass();case 4:f.next=8;break;case 6:return f.next=8,s.render();case 8:case"end":return f.stop()}},o,this)}));function i(o){return n.apply(this,arguments)}return i}()},{key:"updateLayerRenderList",value:function(){var i=this;this.layerList=[],this.layers.filter(function(o){return o.inited}).filter(function(o){return o.isVisible()}).sort(function(o,s){return o.zIndex-s.zIndex}).forEach(function(o){i.layerList.push(o)})}},{key:"destroy",value:function(){this.layers.forEach(function(i){i.destroy()}),this.layers=[],this.layerList=[],this.emit("layerChange",this.layers)}},{key:"startAnimate",value:function(){this.animateInstanceCount++===0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount===0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"clear",value:function(){var i=fi(this.mapService.bgColor);this.renderService.clear({color:i,depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=window.requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){window.cancelAnimationFrame(this.layerRenderID)}}]),t}(no.EventEmitter),Zn=Oi(Bi.prototype,"renderService",[Qn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ra=Oi(Bi.prototype,"mapService",[Tn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ua=Oi(Bi.prototype,"debugService",[Ii],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bi))||gi),Fa=L(10570),Vs=ii.isNil,bo=function(){function e(r){var t=this;(0,q.Z)(this,e),(0,B.Z)(this,"name",void 0),(0,B.Z)(this,"type",void 0),(0,B.Z)(this,"scale",void 0),(0,B.Z)(this,"descriptor",void 0),(0,B.Z)(this,"featureBufferLayout",[]),(0,B.Z)(this,"needRescale",!1),(0,B.Z)(this,"needRemapping",!1),(0,B.Z)(this,"needRegenerateVertices",!1),(0,B.Z)(this,"featureRange",{startIndex:0,endIndex:1/0}),(0,B.Z)(this,"vertexAttribute",void 0),(0,B.Z)(this,"defaultCallback",function(n){if(n.length===0){var i;return((i=t.scale)===null||i===void 0?void 0:i.defaultValues)||[]}return n.map(function(o,s){var l,f=(l=t.scale)===null||l===void 0?void 0:l.scalers[s].func,v=f(o);return v})}),this.setProps(r)}return(0,V.Z)(e,[{key:"setProps",value:function(t){Object.assign(this,t)}},{key:"mapping",value:function(t){var n;if((n=this.scale)!==null&&n!==void 0&&n.callback){var i,o=(i=this.scale)===null||i===void 0?void 0:i.callback.apply(i,(0,Wt.Z)(t));if(!Vs(o))return[o]}return this.defaultCallback(t)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),e}(),rs=["buffer","update","name"],zi=["buffer","update","name"],fa,va,Xi,js,ns,Ba,Po=(fa={},(0,B.Z)(fa,R.FLOAT,4),(0,B.Z)(fa,R.UNSIGNED_BYTE,1),(0,B.Z)(fa,R.UNSIGNED_SHORT,2),fa),ws=(va=(0,gt.b2)(),Xi=(0,gt.f3)(tt.IRendererService),va(js=(ns=function(){function e(){(0,q.Z)(this,e),(0,B.Z)(this,"attributesAndIndices",void 0),Fi(this,"rendererService",Ba,this),(0,B.Z)(this,"attributes",[]),(0,B.Z)(this,"triangulation",void 0),(0,B.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,V.Z)(e,[{key:"registerStyleAttribute",value:function(t){var n=this.getLayerStyleAttribute(t.name||"");return n?n.setProps(t):(n=new bo(t),this.attributes.push(n)),n}},{key:"unRegisterStyleAttribute",value:function(t){var n=this.attributes.findIndex(function(i){return i.name===t});n>-1&&this.attributes.splice(n,1)}},{key:"updateScaleAttribute",value:function(t){this.attributes.forEach(function(n){var i,o=n.name,s=(i=n.scale)===null||i===void 0?void 0:i.field;(t[o]||s&&t[s])&&(n.needRescale=!0,n.needRemapping=!0,n.needRegenerateVertices=!0)})}},{key:"updateStyleAttribute",value:function(t,n,i){var o=this.getLayerStyleAttribute(t);o||(o=this.registerStyleAttribute((0,H.Z)((0,H.Z)({},n),{},{name:t})));var s=n.scale;s&&o&&(o.scale=s,o.needRescale=!0,o.needRemapping=!0,o.needRegenerateVertices=!0,i&&i.featureRange&&(o.featureRange=i.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(t){return this.attributes.find(function(n){return n.name===t})}},{key:"getLayerAttributeScale",value:function(t){var n,i=this.getLayerStyleAttribute(t),o=i==null||(n=i.scale)===null||n===void 0?void 0:n.scalers;return o&&o[0]?o[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(t,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,o=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0,l=this.attributes.find(function($e){return $e.name===t});if(l&&l.descriptor){var f=l.descriptor,v=f.update,y=f.buffer,b=f.size,T=b===void 0?0:b,M=Po[y.type||R.FLOAT];if(v){var O=this.featureLayout,k=O.elements,$=O.sizePerElement,G=k.slice(i,o);if(!G.length)return;var oe=G[0].offset,ye=oe*T*M,Le=G.map(function($e,ut){for(var vt=$e.featureIdx,Rt=$e.vertices,Jt=$e.normals,Mr=Rt.length/$,br=[],pn=0;pn<Mr;pn++){var kn=Jt?Jt.slice(pn*3,pn*3+3):[];br.push.apply(br,(0,Wt.Z)(v(n[vt],vt,Rt.slice(pn*$,pn*$+$),ut,kn)))}return br}).reduce(function($e,ut){return $e.push.apply($e,(0,Wt.Z)(ut)),$e},[]);l.vertexAttribute.updateBuffer({data:Le,offset:ye}),s==null||s.emit("legend:".concat(t),{type:t,attr:l})}}}},{key:"createAttributesAndIndices",value:function(t,n,i){var o=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var s=this.attributes.map(function(G){return G.resetDescriptor(),G.descriptor}),l=0,f=0,v=[],y=3;t.forEach(function(G,oe){var ye=o.triangulation(G,i),Le=ye.indices,$e=ye.vertices,ut=ye.normals,vt=ye.size,Rt=ye.indexes,Jt=ye.count;typeof Jt=="number"&&(f+=Jt),Le.forEach(function(kn){v.push(kn+l)}),y=vt;var Mr=$e.length/vt;o.featureLayout.sizePerElement=y,o.featureLayout.elements.push({featureIdx:oe,vertices:$e,normals:ut,offset:l}),l+=Mr;for(var br=function(Pi){var xa=(ut==null?void 0:ut.slice(Pi*3,Pi*3+3))||[],is=$e.slice(Pi*vt,Pi*vt+vt),_s=0;Rt&&Rt[Pi]!==void 0&&(_s=Rt[Pi]),s.forEach(function(as,lu){if(as&&as.update){var Ac;(Ac=as.buffer.data).push.apply(Ac,(0,Wt.Z)(as.update(G,oe,is,Pi,xa,_s)))}})},pn=0;pn<Mr;pn++)br(pn)});var b=this.rendererService,T=b.createAttribute,M=b.createBuffer,O=b.createElements,k={};s.forEach(function(G,oe){if(G){var ye=G.buffer,Le=G.update,$e=G.name,ut=(0,Fa.Z)(G,rs),vt=T((0,H.Z)({buffer:M(ye)},ut));k[G.name||""]=vt,o.attributes[oe].vertexAttribute=vt}});var $=O({data:v,type:R.UNSIGNED_INT,count:v.length});return this.attributesAndIndices={attributes:k,elements:$,count:f},this.attributesAndIndices}},{key:"createAttributes",value:function(t,n){var i=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var o=this.attributes.map(function(M){return M.resetDescriptor(),M.descriptor}),s=0,l=[],f=3;t.forEach(function(M,O){var k=i.triangulation(M),$=k.indices,G=k.vertices,oe=k.normals,ye=k.size,Le=k.indexes;$.forEach(function(Rt){l.push(Rt+s)}),f=ye;var $e=G.length/ye;i.featureLayout.sizePerElement=f,i.featureLayout.elements.push({featureIdx:O,vertices:G,normals:oe,offset:s}),s+=$e;for(var ut=function(Jt){var Mr=(oe==null?void 0:oe.slice(Jt*3,Jt*3+3))||[],br=G.slice(Jt*ye,Jt*ye+ye),pn=0;Le&&Le[Jt]!==void 0&&(pn=Le[Jt]),o.forEach(function(kn,Pi){if(kn&&kn.update){var xa;(xa=kn.buffer.data).push.apply(xa,(0,Wt.Z)(kn.update(M,O,br,Jt,Mr,pn)))}})},vt=0;vt<$e;vt++)ut(vt)});var v=this.rendererService,y=v.createAttribute,b=v.createBuffer,T={};return o.forEach(function(M,O){if(M){var k=M.buffer,$=M.update,G=M.name,oe=(0,Fa.Z)(M,zi),ye=y((0,H.Z)({buffer:b(k)},oe));T[M.name||""]=ye,i.attributes[O].vertexAttribute=ye}}),{attributes:T}}},{key:"clearAllAttributes",value:function(){var t;this.attributes.forEach(function(n){n.vertexAttribute&&n.vertexAttribute.destroy()}),(t=this.attributesAndIndices)===null||t===void 0||t.elements.destroy(),this.attributes=[]}}]),e}(),Ba=Oi(ns.prototype,"rendererService",[Xi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ns))||js),qi=L(14224);function Zl(e,r,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function l(y){try{v(n.next(y))}catch(b){s(b)}}function f(y){try{v(n.throw(y))}catch(b){s(b)}}function v(y){y.done?o(y.value):i(y.value).then(l,f)}v((n=n.apply(e,r||[])).next())})}function su(e,r){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(v){return function(y){return f([v,y])}}function f(v){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=v[0]&2?i.return:v[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,v[1])).done)return o;switch(i=0,o&&(v=[v[0]&2,o.value]),v[0]){case 0:case 1:o=v;break;case 4:return t.label++,{value:v[1],done:!1};case 5:t.label++,i=v[1],v=[0];continue;case 7:v=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(v[0]===6||v[0]===2)){t=0;continue}if(v[0]===3&&(!o||v[1]>o[0]&&v[1]<o[3])){t.label=v[1];break}if(v[0]===6&&t.label<o[1]){t.label=o[1],o=v;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(v);break}o[2]&&t.ops.pop(),t.trys.pop();continue}v=r.call(e,t)}catch(y){v=[6,y],i=0}finally{n=o=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}}function vl(e,r){var t=typeof Symbol=="function"&&e[Symbol.iterator];if(!t)return e;var n=t.call(e),i,o=[],s;try{for(;(r===void 0||r-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o}function eo(e,r,t){if(t||arguments.length===2)for(var n=0,i=r.length,o;n<i;n++)(o||!(n in r))&&(o||(o=Array.prototype.slice.call(r,0,n)),o[n]=r[n]);return e.concat(o||Array.prototype.slice.call(r))}function Vl(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var $u={exports:{}},Ef={exports:{}},pc={exports:{}};(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=t;function t(n){return n&&typeof n.length=="number"&&n.length>=0&&n.length%1===0}e.exports=r.default})(pc,pc.exports);var Cs={},dc={exports:{}},Jf={exports:{}};(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(t){return function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];var o=n.pop();return t.call(this,n,o)}},e.exports=r.default})(Jf,Jf.exports);var vc={};Object.defineProperty(vc,"__esModule",{value:!0}),vc.fallback=td,vc.wrap=Hc;var Ep=vc.hasQueueMicrotask=typeof queueMicrotask=="function"&&queueMicrotask,ed=vc.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,Xd=vc.hasNextTick=typeof qi=="object"&&typeof qi.nextTick=="function";function td(e){setTimeout(e,0)}function Hc(e){return function(r){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];return e(function(){return r.apply(void 0,t)})}}var Sf;Ep?Sf=queueMicrotask:ed?Sf=setImmediate:Xd?Sf=qi.nextTick:Sf=td,vc.default=Hc(Sf),function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=f;var t=Jf.exports,n=l(t),i=vc,o=l(i),s=Cs;function l(b){return b&&b.__esModule?b:{default:b}}function f(b){return(0,s.isAsync)(b)?function(){for(var T=[],M=arguments.length;M--;)T[M]=arguments[M];var O=T.pop(),k=b.apply(this,T);return v(k,O)}:(0,n.default)(function(T,M){var O;try{O=b.apply(this,T)}catch(k){return M(k)}if(O&&typeof O.then=="function")return v(O,M);M(null,O)})}function v(b,T){return b.then(function(M){y(T,null,M)},function(M){y(T,M&&M.message?M:new Error(M))})}function y(b,T,M){try{b(T,M)}catch(O){(0,o.default)(function(k){throw k},O)}}e.exports=r.default}(dc,dc.exports),Object.defineProperty(Cs,"__esModule",{value:!0}),Cs.isAsyncIterable=Cs.isAsyncGenerator=Cs.isAsync=void 0;var Sp=dc.exports,eh=Ap(Sp);function Ap(e){return e&&e.__esModule?e:{default:e}}function rd(e){return e[Symbol.toStringTag]==="AsyncFunction"}function $d(e){return e[Symbol.toStringTag]==="AsyncGenerator"}function nd(e){return typeof e[Symbol.asyncIterator]=="function"}function id(e){if(typeof e!="function")throw new Error("expected a function");return rd(e)?(0,eh.default)(e):e}Cs.default=id,Cs.isAsync=rd,Cs.isAsyncGenerator=$d,Cs.isAsyncIterable=nd;var Wc={exports:{}};(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=t;function t(n,i){if(i===void 0&&(i=n.length),!i)throw new Error("arity is undefined");function o(){for(var s=this,l=[],f=arguments.length;f--;)l[f]=arguments[f];return typeof l[i-1]=="function"?n.apply(this,l):new Promise(function(v,y){l[i-1]=function(b){for(var T=[],M=arguments.length-1;M-- >0;)T[M]=arguments[M+1];if(b)return y(b);v(T.length>1?T:T[0])},n.apply(s,l)})}return o}e.exports=r.default})(Wc,Wc.exports),function(e,r){Object.defineProperty(r,"__esModule",{value:!0});var t=pc.exports,n=f(t),i=Cs,o=f(i),s=Wc.exports,l=f(s);function f(v){return v&&v.__esModule?v:{default:v}}r.default=(0,l.default)(function(v,y,b){var T=(0,n.default)(y)?[]:{};v(y,function(M,O,k){(0,o.default)(M)(function($){for(var G,oe=[],ye=arguments.length-1;ye-- >0;)oe[ye]=arguments[ye+1];oe.length<2&&(G=oe,oe=G[0]),T[O]=oe,k($)})},function(M){return b(M,T)})},3),e.exports=r.default}(Ef,Ef.exports);var Fh={exports:{}},th={exports:{}},Bh={exports:{}},rh={exports:{}};(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=t;function t(n){function i(){for(var o=[],s=arguments.length;s--;)o[s]=arguments[s];if(n!==null){var l=n;n=null,l.apply(this,o)}}return Object.assign(i,n),i}e.exports=r.default})(rh,rh.exports);var nh={exports:{}},Tp={exports:{}};(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(t){return t[Symbol.iterator]&&t[Symbol.iterator]()},e.exports=r.default})(Tp,Tp.exports),function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=y;var t=pc.exports,n=s(t),i=Tp.exports,o=s(i);function s(b){return b&&b.__esModule?b:{default:b}}function l(b){var T=-1,M=b.length;return function(){return++T<M?{value:b[T],key:T}:null}}function f(b){var T=-1;return function(){var O=b.next();return O.done?null:(T++,{value:O.value,key:T})}}function v(b){var T=b?Object.keys(b):[],M=-1,O=T.length;return function k(){var $=T[++M];return $==="__proto__"?k():M<O?{value:b[$],key:$}:null}}function y(b){if((0,n.default)(b))return l(b);var T=(0,o.default)(b);return T?f(T):v(b)}e.exports=r.default}(nh,nh.exports);var Gc={exports:{}};(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=t;function t(n){return function(){for(var i=[],o=arguments.length;o--;)i[o]=arguments[o];if(n===null)throw new Error("Callback was already called.");var s=n;n=null,s.apply(this,i)}}e.exports=r.default})(Gc,Gc.exports);var Lh={exports:{}},mc={exports:{}};(function(e,r){Object.defineProperty(r,"__esModule",{value:!0});var t={};r.default=t,e.exports=r.default})(mc,mc.exports),function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=o;var t=mc.exports,n=i(t);function i(s){return s&&s.__esModule?s:{default:s}}function o(s,l,f,v){var y=!1,b=!1,T=!1,M=0,O=0;function k(){M>=l||T||y||(T=!0,s.next().then(function(oe){var ye=oe.value,Le=oe.done;if(!(b||y)){if(T=!1,Le){y=!0,M<=0&&v(null);return}M++,f(ye,O,$),O++,k()}}).catch(G))}function $(oe,ye){if(M-=1,!b){if(oe)return G(oe);if(oe===!1){y=!0,b=!0;return}if(ye===n.default||y&&M<=0)return y=!0,v(null);k()}}function G(oe){b||(T=!1,y=!0,v(oe))}k()}e.exports=r.default}(Lh,Lh.exports),function(e,r){Object.defineProperty(r,"__esModule",{value:!0});var t=rh.exports,n=M(t),i=nh.exports,o=M(i),s=Gc.exports,l=M(s),f=Cs,v=Lh.exports,y=M(v),b=mc.exports,T=M(b);function M(O){return O&&O.__esModule?O:{default:O}}r.default=function(O){return function(k,$,G){if(G=(0,n.default)(G),O<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!k)return G(null);if((0,f.isAsyncGenerator)(k))return(0,y.default)(k,O,$,G);if((0,f.isAsyncIterable)(k))return(0,y.default)(k[Symbol.asyncIterator](),O,$,G);var oe=(0,o.default)(k),ye=!1,Le=!1,$e=0,ut=!1;function vt(Jt,Mr){if(!Le)if($e-=1,Jt)ye=!0,G(Jt);else if(Jt===!1)ye=!0,Le=!0;else{if(Mr===T.default||ye&&$e<=0)return ye=!0,G(null);ut||Rt()}}function Rt(){for(ut=!0;$e<O&&!ye;){var Jt=oe();if(Jt===null){ye=!0,$e<=0&&G(null);return}$e+=1,$(Jt.value,Jt.key,(0,l.default)(vt))}ut=!1}Rt()}},e.exports=r.default}(Bh,Bh.exports),function(e,r){Object.defineProperty(r,"__esModule",{value:!0});var t=Bh.exports,n=f(t),i=Cs,o=f(i),s=Wc.exports,l=f(s);function f(y){return y&&y.__esModule?y:{default:y}}function v(y,b,T,M){return(0,n.default)(b)(y,(0,o.default)(T),M)}r.default=(0,l.default)(v,4),e.exports=r.default}(th,th.exports),function(e,r){Object.defineProperty(r,"__esModule",{value:!0});var t=th.exports,n=s(t),i=Wc.exports,o=s(i);function s(f){return f&&f.__esModule?f:{default:f}}function l(f,v,y){return(0,n.default)(f,1,v,y)}r.default=(0,o.default)(l,3),e.exports=r.default}(Fh,Fh.exports),function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=l;var t=Ef.exports,n=s(t),i=Fh.exports,o=s(i);function s(f){return f&&f.__esModule?f:{default:f}}function l(f,v){return(0,n.default)(o.default,f,v)}e.exports=r.default}($u,$u.exports);var ih=Vl($u.exports),xu=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var r=arguments,t=[],n=0;n<arguments.length;n++)t[n]=r[n];return this.args=t,ih(this.tasks)},e.prototype.tap=function(r,t){var n=this;this.tasks.push(function(i){t.apply(void 0,eo([],vl(n.args),!1)),i(null,r)})},e}(),ad={exports:{}},Yd={exports:{}};(function(e,r){Object.defineProperty(r,"__esModule",{value:!0});var t=pc.exports,n=$(t),i=mc.exports,o=$(i),s=th.exports,l=$(s),f=rh.exports,v=$(f),y=Gc.exports,b=$(y),T=Cs,M=$(T),O=Wc.exports,k=$(O);function $(Le){return Le&&Le.__esModule?Le:{default:Le}}function G(Le,$e,ut){ut=(0,v.default)(ut);var vt=0,Rt=0,Jt=Le.length,Mr=!1;Jt===0&&ut(null);function br(pn,kn){pn===!1&&(Mr=!0),Mr!==!0&&(pn?ut(pn):(++Rt===Jt||kn===o.default)&&ut(null))}for(;vt<Jt;vt++)$e(Le[vt],vt,(0,b.default)(br))}function oe(Le,$e,ut){return(0,l.default)(Le,1/0,$e,ut)}function ye(Le,$e,ut){var vt=(0,n.default)(Le)?G:oe;return vt(Le,(0,M.default)($e),ut)}r.default=(0,k.default)(ye,3),e.exports=r.default})(Yd,Yd.exports),function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=l;var t=Yd.exports,n=s(t),i=Ef.exports,o=s(i);function s(f){return f&&f.__esModule?f:{default:f}}function l(f,v){return(0,o.default)(n.default,f,v)}e.exports=r.default}(ad,ad.exports);var Hv=Vl(ad.exports),S0=function(){function e(){this.tasks=[]}return e.prototype.promise=function(){return Hv(this.tasks)},e.prototype.tapPromise=function(r,t){var n=this;this.tasks.push(function(i){return Zl(n,void 0,void 0,function(){return su(this,function(o){switch(o.label){case 0:return[4,t()];case 1:return o.sent(),i(null,r),[2]}})})})},e}(),od={exports:{}};(function(e,r){Object.defineProperty(r,"__esModule",{value:!0});var t=rh.exports,n=y(t),i=Gc.exports,o=y(i),s=Cs,l=y(s),f=Wc.exports,v=y(f);function y(T){return T&&T.__esModule?T:{default:T}}function b(T,M){if(M=(0,n.default)(M),!Array.isArray(T))return M(new Error("First argument to waterfall must be an array of functions"));if(!T.length)return M();var O=0;function k(G){var oe=(0,l.default)(T[O++]);oe.apply(void 0,G.concat([(0,o.default)($)]))}function $(G){for(var oe=[],ye=arguments.length-1;ye-- >0;)oe[ye]=arguments[ye+1];if(G!==!1){if(G||O===T.length)return M.apply(void 0,[G].concat(oe));k(oe)}}k([])}r.default=(0,v.default)(b),e.exports=r.default})(od,od.exports);var ig=Vl(od.exports),qd=function(){function e(){this.tasks=[]}return e.prototype.call=function(){return ig(this.tasks)},e.prototype.tap=function(r,t){this.tasks.length===0?this.tasks.push(function(n){var i=t();n(i?null:!1,i)}):this.tasks.push(function(n,i){var o=t.apply(void 0,eo([],vl(n),!1));i(o?null:!1,r)})},e}(),fo=function(){function e(){this.tasks=[]}return e.prototype.call=function(){return ih(this.tasks)},e.prototype.tap=function(r,t){this.tasks.push(function(n){var i=t();n(i,r)})},e}(),gc=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.promise=function(){for(var r=arguments,t=[],n=0;n<arguments.length;n++)t[n]=r[n];return this.args=t,ih(this.tasks)},e.prototype.tapPromise=function(r,t){var n=this;this.tasks.push(function(i){return Zl(n,void 0,void 0,function(){return su(this,function(o){switch(o.label){case 0:return[4,t.apply(void 0,eo([],vl(this.args),!1))];case 1:return o.sent(),i(null,r),[2]}})})})},e}(),A0=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.promise=function(){for(var r=arguments,t=[],n=0;n<arguments.length;n++)t[n]=r[n];return this.args=t,ih(this.tasks)},e.prototype.tapPromise=function(r,t){var n=this;this.tasks.push(function(i){return Zl(n,void 0,void 0,function(){var o;return su(this,function(s){switch(s.label){case 0:return[4,t.apply(void 0,eo([],vl(this.args),!1))];case 1:return o=s.sent(),i(o,r),[2]}})})})},e}(),ah=function(){function e(){this.tasks=[]}return e.prototype.promise=function(){return ig(this.tasks)},e.prototype.tapPromise=function(r,t){this.tasks.length===0?this.tasks.push(function(n){t().then(function(i){n(null,i)})}):this.tasks.push(function(n,i){t(n).then(function(o){i(null,o)})})},e}(),Kd=L(31204),ag=L.n(Kd),sd,_c,ud,wp,ld,cd,Qd,Wv,Cp,Gv,Xv,$v,Yv,qv,bu,fd,Kv,yc,Hs,Qv,oh,Nh,Uh,zh,Zh,Jv,em,tm,rm,Jd,ev,Xc,nm,tv,rv;function og(e){var r=im();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function im(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var sg=(sd=(0,gt.b2)(),_c=(0,gt.f3)(tt.SceneID),ud=(0,gt.f3)(tt.IIconService),wp=(0,gt.f3)(tt.IFontService),ld=(0,gt.f3)(tt.IControlService),cd=(0,gt.f3)(tt.IGlobalConfigService),Qd=(0,gt.f3)(tt.IMapService),Wv=(0,gt.f3)(tt.ICoordinateSystemService),Cp=(0,gt.f3)(tt.IRendererService),Gv=(0,gt.f3)(tt.ILayerService),Xv=(0,gt.f3)(tt.IDebugService),$v=(0,gt.f3)(tt.ICameraService),Yv=(0,gt.f3)(tt.IInteractionService),qv=(0,gt.f3)(tt.IPickingService),bu=(0,gt.f3)(tt.IShaderModuleService),fd=(0,gt.f3)(tt.IMarkerService),Kv=(0,gt.f3)(tt.IPopupService),sd(yc=(Hs=function(e){(0,De.Z)(t,e);var r=og(t);function t(){var n;return(0,q.Z)(this,t),n=r.call(this),(0,B.Z)((0,Ie.Z)(n),"destroyed",!1),(0,B.Z)((0,Ie.Z)(n),"loaded",!1),Fi((0,Ie.Z)(n),"id",Qv,(0,Ie.Z)(n)),Fi((0,Ie.Z)(n),"iconService",oh,(0,Ie.Z)(n)),Fi((0,Ie.Z)(n),"fontService",Nh,(0,Ie.Z)(n)),Fi((0,Ie.Z)(n),"controlService",Uh,(0,Ie.Z)(n)),Fi((0,Ie.Z)(n),"configService",zh,(0,Ie.Z)(n)),Fi((0,Ie.Z)(n),"map",Zh,(0,Ie.Z)(n)),Fi((0,Ie.Z)(n),"coordinateSystemService",Jv,(0,Ie.Z)(n)),Fi((0,Ie.Z)(n),"rendererService",em,(0,Ie.Z)(n)),Fi((0,Ie.Z)(n),"layerService",tm,(0,Ie.Z)(n)),Fi((0,Ie.Z)(n),"debugService",rm,(0,Ie.Z)(n)),Fi((0,Ie.Z)(n),"cameraService",Jd,(0,Ie.Z)(n)),Fi((0,Ie.Z)(n),"interactionService",ev,(0,Ie.Z)(n)),Fi((0,Ie.Z)(n),"pickingService",Xc,(0,Ie.Z)(n)),Fi((0,Ie.Z)(n),"shaderModuleService",nm,(0,Ie.Z)(n)),Fi((0,Ie.Z)(n),"markerService",tv,(0,Ie.Z)(n)),Fi((0,Ie.Z)(n),"popupService",rv,(0,Ie.Z)(n)),(0,B.Z)((0,Ie.Z)(n),"inited",!1),(0,B.Z)((0,Ie.Z)(n),"initPromise",void 0),(0,B.Z)((0,Ie.Z)(n),"rendering",!1),(0,B.Z)((0,Ie.Z)(n),"$container",void 0),(0,B.Z)((0,Ie.Z)(n),"canvas",void 0),(0,B.Z)((0,Ie.Z)(n),"markerContainer",void 0),(0,B.Z)((0,Ie.Z)(n),"hooks",void 0),(0,B.Z)((0,Ie.Z)(n),"handleWindowResized",function(){n.emit("resize"),n.$container&&(n.initContainer(),Fu(),n.coordinateSystemService.needRefresh=!0,n.render())}),(0,B.Z)((0,Ie.Z)(n),"handleMapCameraChanged",function(i){n.cameraService.update(i),n.render()}),n.hooks={init:new gc},n}return(0,V.Z)(t,[{key:"init",value:function(i){var o=this;this.configService.setSceneConfig(this.id,i),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return o.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,Ct.Z)(me().mark(function s(){return me().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return o.debugService.log("map.mapInitStart",{type:o.map.version}),f.next=3,new Promise(function(v){o.map.onCameraChanged(function(y){o.cameraService.init(),o.cameraService.update(y),v()}),o.map.init()});case 3:o.map.onCameraChanged(o.handleMapCameraChanged),o.map.addMarkerContainer(),o.markerService.addMarkers(),o.markerService.addMarkerLayers(),o.popupService.initPopup(),o.interactionService.init(),o.interactionService.on(a.Drag,o.addSceneEvent.bind(o));case 10:case"end":return f.stop()}},s)}))),this.hooks.init.tapPromise("initRenderer",(0,Ct.Z)(me().mark(function s(){var l,f,v;return me().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(f=((l=o.map)===null||l===void 0?void 0:l.getOverlayContainer())||void 0,f?o.$container=f:o.$container=X(o.configService.getSceneConfig(o.id).id||""),!o.$container){b.next=13;break}return o.canvas=Ji("canvas","",o.$container),o.setCanvas(),b.next=7,o.rendererService.init(o.canvas,o.configService.getSceneConfig(o.id),i.gl);case 7:o.registerContextLost(),o.initContainer(),ag()(o.$container,o.handleWindowResized),window.matchMedia&&((v=window.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))===null||v===void 0||v.addListener(o.handleWindowResized)),b.next=14;break;case 13:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 14:o.pickingService.init(o.id);case 15:case"end":return b.stop()}},s)}))),this.render()}},{key:"registerContextLost",value:function(){var i=this,o=this.rendererService.getCanvas();o&&o.addEventListener("webglcontextlost",function(){return i.emit("webglcontextlost")})}},{key:"initMiniScene",value:function(i){var o=this;this.configService.setSceneConfig(this.id,i),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return o.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,Ct.Z)(me().mark(function s(){return me().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,new Promise(function(v){o.map.onCameraChanged(function(y){o.cameraService.init(),o.cameraService.update(y),o.map.version!=="GAODE2.x"&&v()}),o.map.initMiniMap()});case 2:o.map.onCameraChanged(o.handleMapCameraChanged),o.interactionService.init(),o.interactionService.on(a.Drag,o.addSceneEvent.bind(o));case 5:case"end":return f.stop()}},s)}))),this.hooks.init.tapPromise("initRenderer",(0,Ct.Z)(me().mark(function s(){var l;return me().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(l=i.canvas,o.$container=l||null,!o.$container){v.next=7;break}return v.next=5,o.rendererService.init(i.canvas,o.configService.getSceneConfig(o.id),void 0);case 5:v.next=8;break;case 7:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 8:o.pickingService.init(o.id);case 9:case"end":return v.stop()}},s)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(i){this.layerService.sceneService=this,this.layerService.add(i)}},{key:"addMask",value:function(i){this.layerService.sceneService=this,this.layerService.addMask(i)}},{key:"render",value:function(){var n=(0,Ct.Z)(me().mark(function o(){return me().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!(this.rendering||this.destroyed)){l.next=2;break}return l.abrupt("return");case 2:if(this.rendering=!0,this.inited){l.next=16;break}return l.next=6,this.hooks.init.promise();case 6:return this.destroyed&&this.destroy(),l.next=9,this.layerService.initLayers();case 9:this.layerService.renderLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0,l.next=20;break;case 16:return l.next=18,this.layerService.initLayers();case 18:return l.next=20,this.layerService.renderLayers();case 20:this.rendering=!1;case 21:case"end":return l.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"addFontFace",value:function(i,o){this.fontService.addFontFace(i,o)}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(){var n=(0,Ct.Z)(me().mark(function o(s){var l,f,v;return me().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return f=(l=this.$container)===null||l===void 0?void 0:l.getElementsByTagName("canvas")[0],b.next=3,this.render();case 3:return v=s==="jpg"?f==null?void 0:f.toDataURL("image/jpeg"):f==null?void 0:f.toDataURL("image/png"),b.abrupt("return",v);case 5:case"end":return b.stop()}},o,this)}));function i(o){return n.apply(this,arguments)}return i}()},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var i=this.$container.parentElement;i!==null&&(this.markerContainer=Ji("div","l7-marker-container",i))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var i=this,o;if(!this.inited){this.destroyed=!0;return}if((0,Kd.unbind)(this.$container,this.handleWindowResized),window.matchMedia){var s;(s=window.matchMedia("screen and (min-resolution: 2dppx)"))===null||s===void 0||s.removeListener(this.handleWindowResized)}this.pickingService.destroy(),this.layerService.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),this.removeAllListeners(),this.inited=!1,this.map.destroy(),setTimeout(function(){var l;(l=i.$container)===null||l===void 0||l.removeChild(i.canvas),i.canvas=null,i.rendererService.destroy()}),(o=this.$container)===null||o===void 0||(o=o.parentNode)===null||o===void 0||o.removeChild(this.$container),this.emit("destroy")}},{key:"initContainer",value:function(){var i,o,s=wa,l=((i=this.$container)===null||i===void 0?void 0:i.clientWidth)||400,f=((o=this.$container)===null||o===void 0?void 0:o.clientHeight)||300,v=this.canvas;v&&(v.width=l*s,v.height=f*s),this.rendererService.viewport({x:0,y:0,width:s*l,height:s*f})}},{key:"setCanvas",value:function(){var i,o,s=wa,l=((i=this.$container)===null||i===void 0?void 0:i.clientWidth)||400,f=((o=this.$container)===null||o===void 0?void 0:o.clientHeight)||300,v=this.canvas;v.width=l*s,v.height=f*s,v.style.width="100%",v.style.height="100%"}},{key:"addSceneEvent",value:function(i){this.emit(i.type,i)}}]),t}(no.EventEmitter),Qv=Oi(Hs.prototype,"id",[_c],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oh=Oi(Hs.prototype,"iconService",[ud],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nh=Oi(Hs.prototype,"fontService",[wp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Uh=Oi(Hs.prototype,"controlService",[ld],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zh=Oi(Hs.prototype,"configService",[cd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zh=Oi(Hs.prototype,"map",[Qd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jv=Oi(Hs.prototype,"coordinateSystemService",[Wv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),em=Oi(Hs.prototype,"rendererService",[Cp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tm=Oi(Hs.prototype,"layerService",[Gv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rm=Oi(Hs.prototype,"debugService",[Xv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jd=Oi(Hs.prototype,"cameraService",[$v],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ev=Oi(Hs.prototype,"interactionService",[Yv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xc=Oi(Hs.prototype,"pickingService",[qv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nm=Oi(Hs.prototype,"shaderModuleService",[bu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tv=Oi(Hs.prototype,"markerService",[fd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rv=Oi(Hs.prototype,"popupService",[Kv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hs))||yc);function ug(e){var r=0;switch(e){case"vec2":case"ivec2":r=2;break;case"vec3":case"ivec3":r=3;break;case"vec4":case"ivec4":case"mat2":r=4;break;case"mat3":r=9;break;case"mat4":r=16;break;default:}return r}var nv=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function am(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,t={};return e=e.replace(nv,function(n,i,o){var s=o.split(":"),l=s[0].trim(),f="";switch(s.length>1&&(f=s[1].trim()),i){case"bool":f=f==="true";break;case"float":case"int":f=Number(f);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":f?f=f.replace("[","").replace("]","").split(",").reduce(function(v,y){return v.push(Number(y.trim())),v},[]):f=new Array(ug(i)).fill(0);break;default:}return t[l]=f,"".concat(r?"uniform ":"").concat(i," ").concat(l,`;
`)}),{content:e,uniforms:t}}function Vh(e){var r=am(e,!0),t=r.content,n=r.uniforms;return t=t.replace(/(\s*uniform\s*.*\s*){((?:\s*.*\s*)*?)};/g,function(i,o,s){s=s.trim().replace(/^.*$/gm,function(y){return"uniform ".concat(y)});var l=am(s),f=l.content,v=l.uniforms;return Object.assign(n,v),"".concat(o,`{
`).concat(f,`
};`)}),{content:t,uniforms:n}}function om(e){var r={};return e.replace(nv,function(t,n,i){var o=i.trim();return r[o]?"":(r[o]=!0,"uniform ".concat(n," ").concat(o,`;
`))})}var hd,lg,cg=ii.uniq,fg="#define PI 3.14159265359",T0=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,hg=`layout(std140) uniform SceneUniforms {
  mat4 u_ViewMatrix;
  mat4 u_ProjectionMatrix;
  mat4 u_ViewProjectionMatrix;
  mat4 u_ModelMatrix;
  mat4 u_Mvp;
  vec4 u_ViewportCenterProjection;
  vec3 u_PixelsPerDegree;
  float u_Zoom;
  vec3 u_PixelsPerDegree2;
  float u_ZoomScale;
  vec3 u_PixelsPerMeter;
  float u_CoordinateSystem;
  vec3 u_CameraPosition;
  float u_DevicePixelRatio;
  vec2 u_ViewportCenter;
  vec2 u_ViewportSize;
  vec2 u_sceneCenterMercator;
  float u_FocalDistance;
};`,pg=`layout(std140) uniform PickingUniforms {
  vec4 u_HighlightColor;
  vec4 u_SelectColor;
  vec3 u_PickingColor;
  float u_PickingStage;
  vec3 u_CurrentSelectedId;
  float u_PickingThreshold;
  float u_PickingBuffer;
  float u_shaderPick;
  float u_EnableSelect;
  float u_activeMix;
};`,w0=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,C0=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,R0=`
in vec4 v_PickingResult;

#pragma include "picking_uniforms"

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define HIGHLIGHT 1.0
#define SELECT 2.0

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color, float weight) {
  // float selected = v_PickingResult.a;
  bool selected = bool(v_PickingResult.a);

  // if (selected == SELECT) {
  if (selected) {
  //   // \u70B9\u51FB\u9009\u4E2D\u72B6\u6001
  //   vec4 selectColor = u_SelectColor * COLOR_SCALE;
  //   return selectColor;
  // } else if (selected == HIGHLIGHT) {
  //   // hover \u9AD8\u4EAE\u72B6\u6001
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  // \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, 1.0));
  }
  
}

vec4 filterColorAlpha(vec4 color, float alpha) {
  // \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, alpha));
  }
}

`,M0=`layout(location = 2) in vec3 a_PickingColor;
out vec4 v_PickingResult;

#pragma include "picking_uniforms"

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define NORMAL 0.0
#define HIGHLIGHT 1.0
#define SELECT 2.0

bool isVertexPicked(vec3 vertexColor) {
  return distance(vertexColor,u_PickingColor.rgb) < 0.01;
}

// \u5224\u65AD\u5F53\u524D\u70B9\u662F\u5426\u5DF2\u7ECF\u88AB select \u9009\u4E2D
bool isVertexSelected(vec3 vertexColor) {
  return distance(vertexColor,u_CurrentSelectedId.rgb) < 0.01;
}

void setPickingColor(vec3 pickingColor) {
  if(u_shaderPick < 0.5) {
    return;
  }
  // compares only in highlight stage

  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,$c=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,pd=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)
#define EARTH_CIRCUMFERENCE 40.03e6

#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0
#pragma include "scene_uniforms"


// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
   if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return lnglat;
  }
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_mvt_offset_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return project_offset(vec4(0.0, 0.0, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }
  return position;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  // if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
 

  //    return vec4(
  //     position.xy,
  //     project_scale(position.z),
  //     position.w);
  // }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}



float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel * u_FocalDistance ;
}

// \u9002\u914D\u7EB9\u7406\u8D34\u56FE\u7684\u7B49\u50CF\u7D20\u5927\u5C0F
float project_pixel_texture(float pixel) {
  // mapbox zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    return pixel * pow(0.5, u_Zoom) * u_FocalDistance ;
  }

  // amap2 zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))* u_FocalDistance ;
  }

  // amap zoom > 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return pixel * pow(0.5, u_Zoom)* u_FocalDistance ;
  }

  // amap zoom < 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return pixel * pow(2.0, (20.0 - u_Zoom))* u_FocalDistance ;
  }
  return pixel * 2.0 *  u_FocalDistance;;
}

// \u5728\u4E0D\u8BBA\u4EC0\u4E48\u5E95\u56FE\u4E0B\u9700\u8981\u7EDF\u4E00\u5904\u7406\u7684\u65F6\u5019\u4F7F\u7528
float project_float_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // mapbox P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom))  * u_FocalDistance ;
  }
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))* u_FocalDistance ;
  }
  return pixel * u_FocalDistance;
}

// Project meter into the unit of pixel which used in the camera world space
float project_float_meter(float meter) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Since the zoom level uniform is updated by mapservice and it's alread been subtracted by 1
    // Not sure if we are supposed to do that again
   return meter;
  } else  {
    return project_float_pixel(meter);
  }

  // TODO: change the following code to make adaptations for amap
  return u_FocalDistance * TILE_SIZE * pow(2.0, u_Zoom) * meter / EARTH_CIRCUMFERENCE;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom)) * u_FocalDistance ;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom)) * u_FocalDistance ;
  }
  return pixel * u_FocalDistance;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom)) * u_FocalDistance ;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom)) * u_FocalDistance ;
  }
  return pixel * -1. * u_FocalDistance;
}
vec3 project_pixel(vec3 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom)) *  u_FocalDistance ;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))  * u_FocalDistance ;
  }
  return pixel * -1. * u_FocalDistance;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}

// \u652F\u6301 GaodeV2\u3001Mapbox
vec4 project_common_position_to_clipspace_v2(vec4 position) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    return u_Mvp * position;
  } else {
    return project_common_position_to_clipspace(position);
  }
}
`,dg=`vec2 rotate_matrix(vec2 v, float a) {
    float b = a / 180.0 * 3.1415926535897932384626433832795;
    float s = sin(b);
    float c = cos(b);
    mat2 m = mat2(c, s, -s, c);
    return m * v;
}`,dd=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,sm=/precision\s+(high|low|medium)p\s+float/,V_=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,J2=/#pragma include (["^+"]?["[a-zA-Z_0-9](.*)"]*?)/g,eS=/void\s+main\s*\([^)]*\)\s*\{\n?/,HB=/}\n?[^{}]*$/,tS=(hd=(0,gt.b2)(),hd(lg=function(){function e(){(0,q.Z)(this,e),(0,B.Z)(this,"moduleCache",{}),(0,B.Z)(this,"rawContentCache",{})}return(0,V.Z)(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:fg,fs:fg}),this.registerModule("decode",{vs:T0,fs:""}),this.registerModule("scene_uniforms",{vs:hg,fs:hg}),this.registerModule("picking_uniforms",{vs:pg,fs:pg}),this.registerModule("projection",{vs:pd,fs:pd}),this.registerModule("project",{vs:$c,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:dd}),this.registerModule("lighting",{vs:C0,fs:""}),this.registerModule("light",{vs:w0,fs:""}),this.registerModule("picking",{vs:M0,fs:R0}),this.registerModule("rotation_2d",{vs:dg,fs:""})}},{key:"registerModule",value:function(t,n){n.vs=n.vs.replace(/\r\n/g,`
`),n.fs=n.fs.replace(/\r\n/g,`
`);var i=n.vs,o=n.fs,s=n.uniforms,l=n.inject,f=Vh(i),v=f.content,y=f.uniforms,b=Vh(o),T=b.content,M=b.uniforms;this.rawContentCache[t]={fs:T,inject:l,uniforms:(0,H.Z)((0,H.Z)((0,H.Z)({},y),M),s),vs:v}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(t){var n=this,i=this.rawContentCache[t].vs,o=this.rawContentCache[t].fs,s=this.rawContentCache[t].inject,l={};s!=null&&s["vs:#decl"]&&(i=(s==null?void 0:s["vs:#decl"])+i,l=Vh(s==null?void 0:s["vs:#decl"]).uniforms),s!=null&&s["vs:#main-start"]&&(i=i.replace(eS,function(G){return G+(s==null?void 0:s["vs:#main-start"])})),s!=null&&s["fs:#decl"]&&(o=(s==null?void 0:s["fs:#decl"])+o);var f=this.processModule(i,[],"vs"),v=f.content,y=f.includeList,b=this.processModule(o,[],"fs"),T=b.content,M=b.includeList,O="",k=cg(y.concat(M).concat(t)).reduce(function(G,oe){return(0,H.Z)((0,H.Z)({},G),n.rawContentCache[oe].uniforms)},(0,H.Z)({},l));sm.test(T)||(O=O+V_),O=O+T;var $="";return sm.test(v)||($=$+V_),$=$+v,this.moduleCache[t]={fs:O.trim(),uniforms:k,vs:$.trim()},this.moduleCache[t]}},{key:"processModule",value:function(t,n,i){var o=this,s=t.replace(J2,function(l,f){var v=f.split(" "),y=v[0].replace(/"/g,"");if(n.indexOf(y)>-1)return"";var b=o.rawContentCache[y][i];n.push(y);var T=o.processModule(b,n,i),M=T.content;return M});return{content:s,includeList:n}}},{key:"injectDefines",value:function(t){var n=Object.keys(t).reduce(function(i,o){return i+"#define ".concat(o.toUpperCase()," ").concat(t[o],`;
`)},`
`);return n}}]),e}())||lg);function rS(e,r){for(;!Object.prototype.hasOwnProperty.call(e,r)&&(e=(0,be.Z)(e),e!==null););return e}function Ra(){return typeof Reflect!="undefined"&&Reflect.get?Ra=Reflect.get.bind():Ra=function(r,t,n){var i=rS(r,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(arguments.length<3?r:n):o.value}},Ra.apply(this,arguments)}var iv=function(e){return e.Normal="normal",e.PostProcessing="post-processing",e}({}),j_,H_,vg=(j_=(0,gt.b2)(),j_(H_=function(){function e(){(0,q.Z)(this,e),(0,B.Z)(this,"shaderModuleService",void 0),(0,B.Z)(this,"rendererService",void 0),(0,B.Z)(this,"cameraService",void 0),(0,B.Z)(this,"mapService",void 0),(0,B.Z)(this,"interactionService",void 0),(0,B.Z)(this,"layerService",void 0),(0,B.Z)(this,"config",void 0)}return(0,V.Z)(e,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return iv.Normal}},{key:"init",value:function(t,n){this.config=n,this.rendererService=t.getContainer().get(tt.IRendererService),this.cameraService=t.getContainer().get(tt.ICameraService),this.mapService=t.getContainer().get(tt.IMapService),this.interactionService=t.getContainer().get(tt.IInteractionService),this.layerService=t.getContainer().get(tt.ILayerService),this.shaderModuleService=t.getContainer().get(tt.IShaderModuleService)}},{key:"render",value:function(t){}}]),e}())||H_),W_,G_;function nS(e){var r=iS();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function iS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var aS=(W_=(0,gt.b2)(),W_(G_=function(e){(0,De.Z)(t,e);var r=nS(t);function t(){return(0,q.Z)(this,t),r.apply(this,arguments)}return(0,V.Z)(t,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(i,o){Ra((0,be.Z)(t.prototype),"init",this).call(this,i,o)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),t}(vg))||G_),X_,$_,Y_,I0,q_;function oS(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=sS(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var v=t.next();return o=v.done,v},e:function(v){s=!0,l=v},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function sS(e,r){if(e){if(typeof e=="string")return K_(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return K_(e,r)}}function K_(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var uS=(X_=(0,gt.b2)(),$_=(0,gt.f3)(tt.IPostProcessor),X_(Y_=(I0=function(){function e(){(0,q.Z)(this,e),(0,B.Z)(this,"passes",[]),Fi(this,"postProcessor",q_,this),(0,B.Z)(this,"layer",void 0),(0,B.Z)(this,"renderFlag",void 0),(0,B.Z)(this,"width",0),(0,B.Z)(this,"height",0)}return(0,V.Z)(e,[{key:"setLayer",value:function(t){this.layer=t}},{key:"setRenderFlag",value:function(t){this.renderFlag=t}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var r=(0,Ct.Z)(me().mark(function n(){var i,o,s;return me().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:i=oS(this.passes),f.prev=1,i.s();case 3:if((o=i.n()).done){f.next=9;break}return s=o.value,f.next=7,s.render(this.layer);case 7:f.next=3;break;case 9:f.next=14;break;case 11:f.prev=11,f.t0=f.catch(1),i.e(f.t0);case 14:return f.prev=14,i.f(),f.finish(14);case 17:return f.next=19,this.postProcessor.render(this.layer);case 19:case"end":return f.stop()}},n,this,[[1,11,14,17]])}));function t(){return r.apply(this,arguments)}return t}()},{key:"resize",value:function(t,n){(this.width!==t||this.height!==n)&&(this.postProcessor.resize(t,n),this.width=t,this.height=n)}},{key:"add",value:function(t,n){t.getType()===iv.PostProcessing?this.postProcessor.add(t,this.layer,n):(t.init(this.layer,n),this.passes.push(t))}},{key:"insert",value:function(t,n,i){t.init(this.layer,n),this.passes.splice(i,0,t)}},{key:"destroy",value:function(){this.passes.length=0}}]),e}(),q_=Oi(I0.prototype,"postProcessor",[$_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),I0))||Y_),Q_,J_;function lS(e){var r=cS();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function cS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var fS=(Q_=(0,gt.b2)(),Q_(J_=function(e){(0,De.Z)(t,e);var r=lS(t);function t(){var n;(0,q.Z)(this,t);for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return n=r.call.apply(r,[this].concat(o)),(0,B.Z)((0,Ie.Z)(n),"pickingFBO",void 0),(0,B.Z)((0,Ie.Z)(n),"layer",void 0),(0,B.Z)((0,Ie.Z)(n),"width",0),(0,B.Z)((0,Ie.Z)(n),"height",0),(0,B.Z)((0,Ie.Z)(n),"alreadyInRendering",!1),(0,B.Z)((0,Ie.Z)(n),"pickFromPickingFBO",function(l){var f=l.x,v=l.y,y=l.lngLat,b=l.type;if(!(!n.layer.isVisible()||!n.layer.needPick(b))){var T=n.rendererService,M=T.getViewportSize,O=T.readPixels,k=T.useFramebuffer,$=M(),G=$.width,oe=$.height,ye=n.layer.getLayerConfig(),Le=ye.enableHighlight,$e=ye.enableSelect,ut=f*wa,vt=v*wa;if(!(ut>G||ut<0||vt>oe||vt<0)){var Rt;k(n.pickingFBO,function(){var Jt;if(Rt=O({x:Math.round(ut),y:Math.round(oe-(v+1)*wa),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:n.pickingFBO}),Rt[0]!==0||Rt[1]!==0||Rt[2]!==0){var Mr=Oa(Rt),br=n.layer.getSource().getFeatureById(Mr),pn={x:f,y:v,type:b,lngLat:y,featureId:Mr,feature:br};br&&(n.layer.setCurrentPickId(Mr),n.triggerHoverOnLayer(pn))}else{var kn={x:f,y:v,lngLat:y,type:n.layer.getCurrentPickId()===null?"un"+b:"mouseout",featureId:null,feature:null};n.triggerHoverOnLayer((0,H.Z)((0,H.Z)({},kn),{},{type:"unpick"})),n.triggerHoverOnLayer(kn),n.layer.setCurrentPickId(null)}Le&&n.highlightPickedFeature(Rt),$e&&b==="click"&&((Jt=Rt)===null||Jt===void 0?void 0:Jt.toString())!==[0,0,0,0].toString()&&n.selectFeature(Rt)})}}}),n}return(0,V.Z)(t,[{key:"getType",value:function(){return iv.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(i,o){Ra((0,be.Z)(t.prototype),"init",this).call(this,i,o),this.layer=i;var s=this.rendererService,l=s.createTexture2D,f=s.createFramebuffer,v=s.getViewportSize,y=v(),b=y.width,T=y.height;this.pickingFBO=f({color:l({width:b,height:T,wrapS:R.CLAMP_TO_EDGE,wrapT:R.CLAMP_TO_EDGE})}),this.interactionService.on(a.Hover,this.pickFromPickingFBO),this.interactionService.on(a.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(a.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(i){var o=this;if(!this.alreadyInRendering){var s=this.rendererService,l=s.getViewportSize,f=s.useFramebuffer,v=s.clear,y=l(),b=y.width,T=y.height;this.alreadyInRendering=!0,(this.width!==b||this.height!==T)&&(this.pickingFBO.resize({width:b,height:T}),this.width=b,this.height=T),f(this.pickingFBO,function(){v({framebuffer:o.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var M=o.layer.multiPassRenderer.getRenderFlag();o.layer.multiPassRenderer.setRenderFlag(!1),i.hooks.beforePickingEncode.call(),i.render(),i.hooks.afterPickingEncode.call(),o.layer.multiPassRenderer.setRenderFlag(M),o.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(i){this.layer.emit(i.type,i)}},{key:"highlightPickedFeature",value:function(i){var o=(0,yn.Z)(i,3),s=o[0],l=o[1],f=o[2];this.layer.hooks.beforeHighlight.call([s,l,f]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(i){var o=(0,yn.Z)(i,3),s=o[0],l=o[1],f=o[2];this.layer.hooks.beforeSelect.call([s,l,f]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(i){var o=i.featureId,s=ia(o);this.selectFeature(new Uint8Array(s))}},{key:"highlightFeatureHandle",value:function(i){var o=i.featureId,s=ia(o);this.highlightPickedFeature(new Uint8Array(s))}}]),t}(vg))||J_),ey,ty,ry,P0,ny,hS=ii.camelCase,pS=ii.isNil,dS=ii.upperFirst,vS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,jh=(ey=(0,gt.b2)(),ty=(0,gt.f3)(tt.IShaderModuleService),ey(ry=(P0=function(){function e(){(0,q.Z)(this,e),Fi(this,"shaderModuleService",ny,this),(0,B.Z)(this,"rendererService",void 0),(0,B.Z)(this,"config",void 0),(0,B.Z)(this,"quad",vS),(0,B.Z)(this,"enabled",!0),(0,B.Z)(this,"renderToScreen",!1),(0,B.Z)(this,"model",void 0),(0,B.Z)(this,"name",void 0),(0,B.Z)(this,"optionsToUpdate",{})}return(0,V.Z)(e,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(t){this.name=t}},{key:"getType",value:function(){return iv.PostProcessing}},{key:"init",value:function(t,n){this.config=n,this.rendererService=t.getContainer().get(tt.IRendererService),this.shaderModuleService=t.getContainer().get(tt.IShaderModuleService);var i=this.rendererService,o=i.createAttribute,s=i.createBuffer,l=i.createModel,f=this.setupShaders(),v=f.vs,y=f.fs,b=f.uniforms;this.model=l({vs:v,fs:y,attributes:{a_Position:o({buffer:s({data:[-4,-4,4,-4,0,4],type:R.FLOAT}),size:2})},uniforms:(0,H.Z)((0,H.Z)({u_Texture:null},b),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(t,n){var i=this,o=t.multiPassRenderer.getPostProcessor(),s=this.rendererService,l=s.useFramebuffer,f=s.getViewportSize,v=s.clear,y=f(),b=y.width,T=y.height;l(this.renderToScreen?null:o.getWriteFBO(),function(){v({framebuffer:o.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});var M=(0,H.Z)({u_BloomFinal:0,u_Texture:o.getReadFBO(),u_ViewportSize:[b,T]},i.convertOptionsToUniforms(i.optionsToUpdate));n&&(M.u_BloomFinal=1,M.u_Texture2=n),i.model.draw({uniforms:M})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(t){this.enabled=t}},{key:"setRenderToScreen",value:function(t){this.renderToScreen=t}},{key:"updateOptions",value:function(t){this.optionsToUpdate=(0,H.Z)((0,H.Z)({},this.optionsToUpdate),t)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(t){var n={};return Object.keys(t).forEach(function(i){pS(t[i])||(n["u_".concat(dS(hS(i)))]=t[i])}),n}}]),e}(),ny=Oi(P0.prototype,"shaderModuleService",[ty],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),P0))||ry),iy,ay;function mS(e){var r=gS();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function gS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _S=`varying vec2 v_UV;

uniform float u_BloomFinal: 0.0;
uniform sampler2D u_Texture;
uniform sampler2D u_Texture2;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_radius: 5.0;
uniform float u_intensity: 0.3;
uniform float u_baseRadio: 0.5;

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

float luminance(vec4 color) {
  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;
}

void main() {
  // vec4 baseColor = texture2D(u_Texture, v_UV);

  float r = sqrt(u_radius);

  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));
  // c1 *= luminance(c1);
  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));
  // c2 *= luminance(c2);
  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));
  // c3 *= luminance(c3);
  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));
  // c4 *= luminance(c4);
  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;

  // float lum = luminance(inbloomColor);
  // inbloomColor.rgb *= lum;

  if(u_BloomFinal > 0.0) {
    vec4 baseColor = texture2D(u_Texture2, v_UV);
    float baselum = luminance(baseColor);
    gl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);
    if(baselum <= 0.2) {
      gl_FragColor = inbloomColor * u_intensity;
    }
  } else {
    gl_FragColor = inbloomColor;
  }
}`,yS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,O0=ii.isNil,xS=(iy=(0,gt.b2)(),iy(ay=function(e){(0,De.Z)(t,e);var r=mS(t);function t(){return(0,q.Z)(this,t),r.apply(this,arguments)}return(0,V.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:yS,fs:_S});var i=this.shaderModuleService.getModule("blur-pass"),o=i.vs,s=i.fs,l=i.uniforms,f=this.rendererService.getViewportSize(),v=f.width,y=f.height;return{vs:o,fs:s,uniforms:(0,H.Z)((0,H.Z)({},l),{},{u_ViewportSize:[v,y]})}}},{key:"convertOptionsToUniforms",value:function(i){var o={};return O0(i.bloomRadius)||(o.u_radius=i.bloomRadius),O0(i.bloomIntensity)||(o.u_intensity=i.bloomIntensity),O0(i.bloomBaseRadio)||(o.u_baseRadio=i.bloomBaseRadio),o}}]),t}(jh))||ay),oy,sy;function bS(e){var r=ES();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function ES(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var SS=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,AS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,TS=ii.isNil,wS=(oy=(0,gt.b2)(),oy(sy=function(e){(0,De.Z)(t,e);var r=bS(t);function t(){return(0,q.Z)(this,t),r.apply(this,arguments)}return(0,V.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:AS,fs:SS});var i=this.shaderModuleService.getModule("blur-pass"),o=i.vs,s=i.fs,l=i.uniforms,f=this.rendererService.getViewportSize(),v=f.width,y=f.height;return{vs:o,fs:s,uniforms:(0,H.Z)((0,H.Z)({},l),{},{u_ViewportSize:[v,y]})}}},{key:"convertOptionsToUniforms",value:function(i){var o={};return TS(i.blurRadius)||(o.u_BlurDir=[i.blurRadius,0]),o}}]),t}(jh))||sy),uy,ly;function CS(e){var r=RS();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function RS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var MS=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,IS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,PS=ii.isNil,OS=(uy=(0,gt.b2)(),uy(ly=function(e){(0,De.Z)(t,e);var r=CS(t);function t(){return(0,q.Z)(this,t),r.apply(this,arguments)}return(0,V.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:IS,fs:MS});var i=this.shaderModuleService.getModule("blur-pass"),o=i.vs,s=i.fs,l=i.uniforms,f=this.rendererService.getViewportSize(),v=f.width,y=f.height;return{vs:o,fs:s,uniforms:(0,H.Z)((0,H.Z)({},l),{},{u_ViewportSize:[v,y]})}}},{key:"convertOptionsToUniforms",value:function(i){var o={};return PS(i.blurRadius)||(o.u_BlurDir=[0,i.blurRadius]),o}}]),t}(jh))||ly),cy,fy;function DS(e){var r=kS();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function kS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var FS=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,BS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,LS=(cy=(0,gt.b2)(),cy(fy=function(e){(0,De.Z)(t,e);var r=DS(t);function t(){return(0,q.Z)(this,t),r.apply(this,arguments)}return(0,V.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:BS,fs:FS});var i=this.shaderModuleService.getModule("colorhalftone-pass"),o=i.vs,s=i.fs,l=i.uniforms,f=this.rendererService.getViewportSize(),v=f.width,y=f.height;return{vs:o,fs:s,uniforms:(0,H.Z)((0,H.Z)({},l),{},{u_ViewportSize:[v,y]})}}}]),t}(jh))||fy),hy,py;function NS(e){var r=US();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function US(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var zS=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,ZS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,VS=(hy=(0,gt.b2)(),hy(py=function(e){(0,De.Z)(t,e);var r=NS(t);function t(){return(0,q.Z)(this,t),r.apply(this,arguments)}return(0,V.Z)(t,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:ZS,fs:zS}),this.shaderModuleService.getModule("copy-pass")}}]),t}(jh))||py),dy,vy;function jS(e){var r=HS();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function HS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var WS=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,GS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,XS=(dy=(0,gt.b2)(),dy(vy=function(e){(0,De.Z)(t,e);var r=jS(t);function t(){return(0,q.Z)(this,t),r.apply(this,arguments)}return(0,V.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:GS,fs:WS});var i=this.shaderModuleService.getModule("hexagonalpixelate-pass"),o=i.vs,s=i.fs,l=i.uniforms,f=this.rendererService.getViewportSize(),v=f.width,y=f.height;return{vs:o,fs:s,uniforms:(0,H.Z)((0,H.Z)({},l),{},{u_ViewportSize:[v,y]})}}}]),t}(jh))||vy),gy,_y;function $S(e){var r=YS();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function YS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var qS=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,KS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,QS=(gy=(0,gt.b2)(),gy(_y=function(e){(0,De.Z)(t,e);var r=$S(t);function t(){return(0,q.Z)(this,t),r.apply(this,arguments)}return(0,V.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:KS,fs:qS});var i=this.shaderModuleService.getModule("ink-pass"),o=i.vs,s=i.fs,l=i.uniforms,f=this.rendererService.getViewportSize(),v=f.width,y=f.height;return{vs:o,fs:s,uniforms:(0,H.Z)((0,H.Z)({},l),{},{u_ViewportSize:[v,y]})}}}]),t}(jh))||_y),yy,xy;function JS(e){var r=eA();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function eA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var tA=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,rA=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,nA=(yy=(0,gt.b2)(),yy(xy=function(e){(0,De.Z)(t,e);var r=JS(t);function t(){return(0,q.Z)(this,t),r.apply(this,arguments)}return(0,V.Z)(t,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:rA,fs:tA}),this.shaderModuleService.getModule("noise-pass")}}]),t}(jh))||xy),by,Ey;function iA(e){var r=aA();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function aA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var oA=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,sA=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,uA=(by=(0,gt.b2)(),by(Ey=function(e){(0,De.Z)(t,e);var r=iA(t);function t(){return(0,q.Z)(this,t),r.apply(this,arguments)}return(0,V.Z)(t,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:oA,fs:sA}),this.shaderModuleService.getModule("sepia-pass")}}]),t}(jh))||Ey),Sy,Ay,Ty,wy,av,Cy,lA=(Sy=(0,gt.b2)(),Ay=(0,gt.f3)(tt.IRendererService),Ty=(0,gt.zY)(),Sy(wy=(av=function(){function e(){(0,q.Z)(this,e),Fi(this,"rendererService",Cy,this),(0,B.Z)(this,"passes",[]),(0,B.Z)(this,"readFBO",void 0),(0,B.Z)(this,"writeFBO",void 0)}return(0,V.Z)(e,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"getCurrentFBOTex",value:function(){var t=this.rendererService,n=t.getViewportSize,i=t.createTexture2D,o=n(),s=o.width,l=o.height;return i({x:0,y:0,width:s,height:l,copy:!0})}},{key:"getReadFBOTex",value:function(){var t=this,n=this.rendererService.useFramebuffer;return new Promise(function(i){n(t.readFBO,(0,Ct.Z)(me().mark(function o(){return me().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:i(t.getCurrentFBOTex());case 1:case"end":return l.stop()}},o)})))})}},{key:"renderBloomPass",value:function(){var r=(0,Ct.Z)(me().mark(function n(i,o){var s,l;return me().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,this.getReadFBOTex();case 2:s=v.sent,l=0;case 4:if(!(l<4)){v.next=11;break}return v.next=7,o.render(i,s);case 7:this.swap(),l++,v.next=4;break;case 11:case"end":return v.stop()}},n,this)}));function t(n,i){return r.apply(this,arguments)}return t}()},{key:"render",value:function(){var r=(0,Ct.Z)(me().mark(function n(i){var o,s;return me().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:o=0;case 1:if(!(o<this.passes.length)){f.next=15;break}if(s=this.passes[o],s.setRenderToScreen(this.isLastEnabledPass(o)),s.getName()!=="bloom"){f.next=9;break}return f.next=7,this.renderBloomPass(i,s);case 7:f.next=12;break;case 9:return f.next=11,s.render(i);case 11:o!==this.passes.length-1&&this.swap();case 12:o++,f.next=1;break;case 15:case"end":return f.stop()}},n,this)}));function t(n){return r.apply(this,arguments)}return t}()},{key:"resize",value:function(t,n){this.readFBO.resize({width:t,height:n}),this.writeFBO.resize({width:t,height:n})}},{key:"add",value:function(t,n,i){t.init(n,i),this.passes.push(t)}},{key:"insert",value:function(t,n,i,o){t.init(i,o),this.passes.splice(n,0,t)}},{key:"getPostProcessingPassByName",value:function(t){return this.passes.find(function(n){return n.getName()===t})}},{key:"init",value:function(){var t=this.rendererService,n=t.createFramebuffer,i=t.createTexture2D;this.readFBO=n({color:i({width:1,height:1,wrapS:R.CLAMP_TO_EDGE,wrapT:R.CLAMP_TO_EDGE})}),this.writeFBO=n({color:i({width:1,height:1,wrapS:R.CLAMP_TO_EDGE,wrapT:R.CLAMP_TO_EDGE})})}},{key:"isLastEnabledPass",value:function(t){for(var n=t+1;n<this.passes.length;n++)if(this.passes[n].isEnabled())return!1;return!0}},{key:"swap",value:function(){var t=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=t}}]),e}(),Cy=Oi(av.prototype,"rendererService",[Ay],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Oi(av.prototype,"init",[Ty],Object.getOwnPropertyDescriptor(av.prototype,"init"),av.prototype),av))||wy),Ry,My;function cA(e){var r=fA();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function fA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var hA=(Ry=(0,gt.b2)(),Ry(My=function(e){(0,De.Z)(t,e);var r=cA(t);function t(){return(0,q.Z)(this,t),r.apply(this,arguments)}return(0,V.Z)(t,[{key:"getType",value:function(){return iv.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(i,o){Ra((0,be.Z)(t.prototype),"init",this).call(this,i,o)}},{key:"render",value:function(i){var o=this.rendererService,s=o.useFramebuffer,l=o.clear,f=i.multiPassRenderer.getPostProcessor().getReadFBO();s(f,function(){l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:f}),i.multiPassRenderer.setRenderFlag(!1),i.models.forEach(function(v){v.draw({uniforms:i.layerModel.getUninforms()})}),i.multiPassRenderer.setRenderFlag(!0)})}}]),t}(vg))||My),Iy,Py,Oy,D0,Dy;function pA(e){var r=dA();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function dA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var vA=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,ky=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,mA=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function Fy(e,r){for(var t=0,n=1/r,i=e;i>0;)t=t+n*(i%r),i=Math.floor(i/r),n=n/r;return t}var gA=1,_A=(Iy=(0,gt.b2)(),Py=(0,gt.f3)(tt.IShaderModuleService),Iy(Oy=(D0=function(e){(0,De.Z)(t,e);var r=pA(t);function t(){var n;(0,q.Z)(this,t);for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return n=r.call.apply(r,[this].concat(o)),Fi((0,Ie.Z)(n),"shaderModuleService",Dy,(0,Ie.Z)(n)),(0,B.Z)((0,Ie.Z)(n),"haltonSequence",[]),(0,B.Z)((0,Ie.Z)(n),"accumulatingId",0),(0,B.Z)((0,Ie.Z)(n),"frame",0),(0,B.Z)((0,Ie.Z)(n),"timer",void 0),(0,B.Z)((0,Ie.Z)(n),"sampleRenderTarget",void 0),(0,B.Z)((0,Ie.Z)(n),"prevRenderTarget",void 0),(0,B.Z)((0,Ie.Z)(n),"outputRenderTarget",void 0),(0,B.Z)((0,Ie.Z)(n),"copyRenderTarget",void 0),(0,B.Z)((0,Ie.Z)(n),"blendModel",void 0),(0,B.Z)((0,Ie.Z)(n),"outputModel",void 0),(0,B.Z)((0,Ie.Z)(n),"copyModel",void 0),n}return(0,V.Z)(t,[{key:"getType",value:function(){return iv.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(i,o){Ra((0,be.Z)(t.prototype),"init",this).call(this,i,o);var s=this.rendererService,l=s.createFramebuffer,f=s.createTexture2D;this.sampleRenderTarget=l({color:f({width:1,height:1,wrapS:R.CLAMP_TO_EDGE,wrapT:R.CLAMP_TO_EDGE})}),this.prevRenderTarget=l({color:f({width:1,height:1,wrapS:R.CLAMP_TO_EDGE,wrapT:R.CLAMP_TO_EDGE})}),this.outputRenderTarget=l({color:f({width:1,height:1,wrapS:R.CLAMP_TO_EDGE,wrapT:R.CLAMP_TO_EDGE})}),this.copyRenderTarget=l({color:f({width:1,height:1,wrapS:R.CLAMP_TO_EDGE,wrapT:R.CLAMP_TO_EDGE})});for(var v=0;v<30;v++)this.haltonSequence.push([Fy(v,2),Fy(v,3)]);this.blendModel=this.createTriangleModel("blend-pass",vA),this.outputModel=this.createTriangleModel("copy-pass",ky,{blend:{enable:!0,func:{srcRGB:R.ONE,dstRGB:R.ONE_MINUS_SRC_ALPHA,srcAlpha:R.ONE,dstAlpha:R.ONE_MINUS_SRC_ALPHA},equation:{rgb:R.FUNC_ADD,alpha:R.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",ky)}},{key:"render",value:function(i){var o=this,s=this.rendererService,l=s.clear,f=s.getViewportSize,v=s.useFramebuffer,y=f(),b=y.width,T=y.height;this.sampleRenderTarget.resize({width:b,height:T}),this.prevRenderTarget.resize({width:b,height:T}),this.outputRenderTarget.resize({width:b,height:T}),this.copyRenderTarget.resize({width:b,height:T}),this.resetFrame(),this.stopAccumulating();var M=i.multiPassRenderer.getPostProcessor().getReadFBO();v(M,function(){l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:M}),i.multiPassRenderer.setRenderFlag(!1),i.render(),i.multiPassRenderer.setRenderFlag(!0)});var O=function k($){!o.accumulatingId||$!==o.accumulatingId||o.isFinished()||(o.doRender(i),window.requestAnimationFrame(function(){k($)}))};this.accumulatingId=gA++,this.timer=window.setTimeout(function(){O(o.accumulatingId)},50)}},{key:"doRender",value:function(i){var o=this,s=this.rendererService,l=s.clear,f=s.getViewportSize,v=s.useFramebuffer,y=f(),b=y.width,T=y.height,M=i.getLayerConfig(),O=M.jitterScale,k=O===void 0?1:O,$=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix(($[0]*2-1)/b*k,($[1]*2-1)/T*k),i.multiPassRenderer.setRenderFlag(!1),i.hooks.beforeRender.call(),v(this.sampleRenderTarget,function(){l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:o.sampleRenderTarget}),i.render()}),i.hooks.afterRender.call(),i.multiPassRenderer.setRenderFlag(!0);var G=i.getLayerConfig();v(this.outputRenderTarget,function(){o.blendModel.draw({uniforms:{u_opacity:G.opacity||1,u_MixRatio:o.frame===0?1:.9,u_Diffuse1:o.sampleRenderTarget,u_Diffuse2:o.frame===0?i.multiPassRenderer.getPostProcessor().getReadFBO():o.prevRenderTarget}})}),this.frame===0&&l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(v(this.copyRenderTarget,function(){o.outputModel.draw({uniforms:{u_Texture:o.outputRenderTarget}})}),v(i.multiPassRenderer.getPostProcessor().getReadFBO(),function(){o.copyModel.draw({uniforms:{u_Texture:o.copyRenderTarget}})}),i.multiPassRenderer.getPostProcessor().render(i));var oe=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=oe,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,window.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(i,o,s){this.shaderModuleService.registerModule(i,{vs:mA,fs:o});var l=this.shaderModuleService.getModule(i),f=l.vs,v=l.fs,y=l.uniforms,b=this.rendererService,T=b.createAttribute,M=b.createBuffer,O=b.createModel;return O((0,H.Z)({vs:f,fs:v,attributes:{a_Position:T({buffer:M({data:[-4,-4,4,-4,0,4],type:R.FLOAT}),size:2})},uniforms:(0,H.Z)({},y),depth:{enable:!1},count:3},s))}}]),t}(vg),Dy=Oi(D0.prototype,"shaderModuleService",[Py],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D0))||Oy),um=new gt.W2;um.bind(tt.IGlobalConfigService).to(Xa).inSingletonScope(),(0,gt.GW)((0,gt.b2)(),no.EventEmitter),um.bind(tt.IEventEmitter).to(no.EventEmitter);var By=(0,pr.Z)(um,!1),k0=function(r){var t=By.lazyInject(r);return function(n,i,o){t.call(this,n,i),o&&(o.initializer=function(){return n[i]})}},WB=function(r){var t=By.lazyMultiInject(r);return function(n,i,o){t.call(this,n,i),o&&(o.initializer=function(){return n[i]})}},jl=um,yA=0;function xA(){var e=new gt.W2;return e.parent=um,e.bind(tt.SceneID).toConstantValue("".concat(yA++)),e.bind(tt.IShaderModuleService).to(tS).inSingletonScope(),e.bind(tt.ILayerService).to(Zs).inSingletonScope(),e.bind(tt.IDebugService).to(ts).inSingletonScope(),e.bind(tt.ISceneService).to(sg).inSingletonScope(),e.bind(tt.ICameraService).to(or).inSingletonScope(),e.bind(tt.ICoordinateSystemService).to(xp).inSingletonScope(),e.bind(tt.IInteractionService).to(N).inSingletonScope(),e.bind(tt.IPickingService).to(zn).inSingletonScope(),e.bind(tt.IControlService).to(ri).inSingletonScope(),e.bind(tt.IMarkerService).to(dl).inSingletonScope(),e.bind(tt.IIconService).to(rt).inSingletonScope(),e.bind(tt.IFontService).to(Se).inSingletonScope(),e.bind(tt.IPopupService).to(Vd).inSingletonScope(),e.bind(tt.INormalPass).to(aS).whenTargetNamed("clear"),e.bind(tt.INormalPass).to(fS).whenTargetNamed("pixelPicking"),e.bind(tt.INormalPass).to(hA).whenTargetNamed("render"),e.bind(tt.INormalPass).to(_A).whenTargetNamed("taa"),e.bind(tt.IFactoryNormalPass).toFactory(function(r){return function(t){return r.container.getNamed(tt.INormalPass,t)}}),e.bind(tt.IPostProcessingPass).to(VS).whenTargetNamed("copy"),e.bind(tt.IPostProcessingPass).to(xS).whenTargetNamed("bloom"),e.bind(tt.IPostProcessingPass).to(wS).whenTargetNamed("blurH"),e.bind(tt.IPostProcessingPass).to(OS).whenTargetNamed("blurV"),e.bind(tt.IPostProcessingPass).to(nA).whenTargetNamed("noise"),e.bind(tt.IPostProcessingPass).to(uA).whenTargetNamed("sepia"),e.bind(tt.IPostProcessingPass).to(LS).whenTargetNamed("colorHalftone"),e.bind(tt.IPostProcessingPass).to(XS).whenTargetNamed("hexagonalPixelate"),e.bind(tt.IPostProcessingPass).to(QS).whenTargetNamed("ink"),e.bind(tt.IFactoryPostProcessingPass).toFactory(function(r){return function(t){var n=r.container.getNamed(tt.IPostProcessingPass,t);return n.setName(t),n}}),e}function lm(e){var r=new gt.W2;return r.parent=e,r.bind(tt.IStyleAttributeService).to(ws).inSingletonScope(),r.bind(tt.IMultiPassRenderer).to(uS).inSingletonScope(),r.bind(tt.IPostProcessor).to(lA).inSingletonScope(),r}var bA=null;function GB(e){return bA.indexOf(e)}var Ly=ii.clamp,EA=2,XB=4,SA=64,$B=128,AA=256,TA=512,YB=8192,qB=16384,KB=32768,wA=null,Ny=131072,QB=262144,CA=524288,JB=1048576,RA=2097152,eL=4194304,MA=8388608,IA=16777216,PA=null;function mg(e,r){return e=Ly(Math.floor(e),0,255),r=Ly(Math.floor(r),0,255),256*e+r}function tL(e){var r=e.color,t=e.radius,n=e.tileX,i=e.tileY,o=e.shape,s=e.opacity,l=e.stroke,f=e.strokeWidth,v=e.strokeOpacity,y=[],b=[],T=[],M=[mg(r[0],r[1]),mg(r[2],r[3])],O=[mg(l[0],l[1]),mg(l[2],l[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(k){var $=_slicedToArray(k,2),G=$[0],oe=$[1];y.push([].concat(M,[(G+1)*MA+(oe+1)*RA+getShapeIndex(o)*Ny+t,(n+512)*CA+(i+512)*SA])),b.push([].concat(O,[f,v])),T.push([s,0,0,0])}),{packedBuffer:y,packedBuffer2:b,packedBuffer3:T}}function rL(e,r){if(e===0&&!r)return 0;if(e===1&&r)return 4294967295;var t=r?1:0,n=Math.floor(e*127);return n*PA+t*IA+n*Ny+t*wA+n*TA+t*AA+n*EA+t}var vd={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},Rs={MapInitStart:"mapInitStart",LayerInitStart:"layerInitStart",LayerInitEnd:"layerInitEnd",SourceInitStart:"sourceInitStart",SourceInitEnd:"sourceInitEnd",ScaleInitStart:"scaleInitStart",ScaleInitEnd:"scaleInitEnd",MappingStart:"mappingStart",MappingEnd:"mappingEnd",BuildModelStart:"buildModelStart",BuildModelEnd:"buildModelEnd"},to=function(e){return e.LINEAR="linear",e.SEQUENTIAL="sequential",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat",e.DIVERGING="diverging",e}({}),ov=function(e){return e.CONSTANT="constant",e.VARIABLE="variable",e}({}),fn=function(e){return e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform",e}({}),OA=["mapload","mapchange","mapAfterFrameChange"],gg=["loaded","fontloaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"],Eu=function(e){return e.IMAGE="image",e.CUSTOMIMAGE="customImage",e.ARRAYBUFFER="arraybuffer",e.RGB="rgb",e.TERRAINRGB="terrainRGB",e.CUSTOMRGB="customRGB",e.CUSTOMARRAYBUFFER="customArrayBuffer",e.CUSTOMTERRAINRGB="customTerrainRGB",e}({}),DA=function(){var e=(0,Ct.Z)(me().mark(function r(t,n,i,o){return me().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",new Promise(function(f,v){n({x:t.x,y:t.y,z:t.z},function(y,b){if(y||b.length===0){v(y);return}b&&Xr([{data:b,bands:[0]}],i,o,function(T,M){T?v(T):M&&f(M)})})}));case 1:case"end":return l.stop()}},r)}));return function(t,n,i,o){return e.apply(this,arguments)}}(),kA=function(){var e=(0,Ct.Z)(me().mark(function r(t,n){return me().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",new Promise(function(s,l){n({x:t.x,y:t.y,z:t.z},function(f,v){if(f||!v){l(f);return}v instanceof ArrayBuffer?cu(v,function(y,b){y&&l(y),s(b)}):v instanceof HTMLImageElement?s(v):l(f)})}));case 1:case"end":return o.stop()}},r)}));return function(t,n){return e.apply(this,arguments)}}();function FA(e,r){return Array.isArray(e)?typeof e[0]=="string"?e.map(function(t){return h(t,r)}):e.map(function(t){return{url:h(t.url,r),bands:t.bands||[0]}}):h(e,r)}function BA(e){return typeof e=="string"?[{url:e,bands:[0]}]:typeof e[0]=="string"?e.map(function(r){return{url:r,bands:[0]}}):e}function Uy(e,r){e.xhrCancel=function(){r.map(function(t){t.abort()})}}var LA=function(){var e=(0,Ct.Z)(me().mark(function r(t,n,i,o,s){var l,f,v,y,b,T;return me().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:if(l=BA(n.url),!(l.length>1)){O.next=15;break}return O.next=4,NA(l,n);case 4:if(f=O.sent,v=f.rasterFiles,y=f.xhrList,b=f.errList,Uy(t,y),!(b.length>0)){O.next=12;break}return i(b,null),O.abrupt("return");case 12:Xr(v,o,s,i),O.next=17;break;case 15:T=Si(n,function(k,$){if(k)i(k);else if($){var G=[{data:$,bands:l[0].bands}];Xr(G,o,s,i)}}),Uy(t,[T]);case 17:case"end":return O.stop()}},r)}));return function(t,n,i,o,s){return e.apply(this,arguments)}}();function NA(e,r){return F0.apply(this,arguments)}function F0(){return F0=(0,Ct.Z)(me().mark(function e(r,t){var n,i,o,s,l,f,v,y,b,T,M;return me().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:n=[],i=[],o=[],s=0;case 4:if(!(s<r.length)){k.next=20;break}return l=r[s],f=(0,H.Z)((0,H.Z)({},t),{},{url:l.url}),v=l.bands,k.next=10,Yi((0,H.Z)((0,H.Z)({},f),{},{type:"arrayBuffer"}));case 10:y=k.sent,b=y.err,T=y.data,M=y.xhr,b&&o.push(b),i.push(M),n.push({data:T,bands:v});case 17:s++,k.next=4;break;case 20:return k.abrupt("return",{rasterFiles:n,xhrList:i,errList:o});case 21:case"end":return k.stop()}},e)})),F0.apply(this,arguments)}var UA=function(){var e=(0,Ct.Z)(me().mark(function r(t,n,i,o,s){var l;return me().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return l={url:FA(t,n)},v.abrupt("return",new Promise(function(y,b){LA(i,l,function(T,M){T?b(T):M&&y(M)},o,s)}));case 2:case"end":return v.stop()}},r)}));return function(t,n,i,o,s){return e.apply(this,arguments)}}(),zy=function(){var e=(0,Ct.Z)(me().mark(function r(t,n,i,o){var s,l,f,v;return me().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return l=Array.isArray(t)?t[0]:t,o.wmtsOptions?(f=(o==null?void 0:o.getURLFromTemplate)||d,s=f(l,(0,H.Z)((0,H.Z)({},n),o.wmtsOptions))):(v=(o==null?void 0:o.getURLFromTemplate)||h,s=v(l,n)),b.abrupt("return",new Promise(function(T,M){var O,k=Pa({url:s,type:(o==null||(O=o.requestParameters)===null||O===void 0?void 0:O.type)||"arrayBuffer"},function($,G){$?M($):G&&T(G)},o.transformResponse);i.xhrCancel=function(){return k.cancel()}}));case 3:case"end":return b.stop()}},r)}));return function(t,n,i,o){return e.apply(this,arguments)}}(),Zy=function(){return{rasterData:new Uint8Array([0]),width:1,height:1}},zA={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,warp:!0},nL=[Eu.ARRAYBUFFER,Eu.RGB];function ZA(e){return!!(Array.isArray(e)&&e.length===0||!Array.isArray(e)&&typeof e!="string")}function VA(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(ZA(e))throw new Error("tile server url is error");var t=(r==null?void 0:r.dataType)||Eu.IMAGE;t===Eu.RGB&&(t=Eu.ARRAYBUFFER);var n=function(s,l){switch(t){case Eu.IMAGE:return zy(e,s,l,r);case Eu.CUSTOMIMAGE:case Eu.CUSTOMTERRAINRGB:return kA(l,r==null?void 0:r.getCustomData);case Eu.ARRAYBUFFER:return UA(e,s,l,(r==null?void 0:r.format)||Zy,r==null?void 0:r.operation);case Eu.CUSTOMARRAYBUFFER:case Eu.CUSTOMRGB:return DA(l,r==null?void 0:r.getCustomData,(r==null?void 0:r.format)||Zy,r==null?void 0:r.operation);default:return zy(e,s,l,r)}},i=(0,H.Z)((0,H.Z)((0,H.Z)({},zA),r),{},{getTileData:n});return{data:e,dataArray:[],tilesetOptions:i,isTile:!0}}var jA=["extent","min","max","width","height","format","operation"];function HA(e,r){var t=r.extent,n=r.min,i=r.max,o=r.width,s=r.height,l=r.format,f=r.operation,v=(0,Fa.Z)(r,jA),y;if(l===void 0||gf(e))y=Array.from(e);else{var b=Array.isArray(e)?e:[e];y=tn(b,l,f)}var T={_id:1,dataArray:[(0,H.Z)((0,H.Z)({_id:1,data:y,width:o,height:s},v),{},{min:n,max:i,coordinates:[[t[0],t[1]],[t[2],t[3]]]})]};return T}var WA={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0},GA=function(){var e=(0,Ct.Z)(me().mark(function r(t){return me().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",new Promise(function(o){var s=(0,yn.Z)(t.bounds,4),l=s[0],f=s[1],v=s[2],y=s[3],b={layers:{testTile:{features:[{type:"Feature",properties:{key:t.x+"/"+t.y+"/"+t.z,x:(l+v)/2,y:(f+y)/2},geometry:{type:"LineString",coordinates:[[v,y],[v,f],[l,f],[l,f]]}}]}}};o(b)}));case 1:case"end":return i.stop()}},r)}));return function(t){return e.apply(this,arguments)}}();function XA(e,r){var t=function(o){return GA(o)},n=(0,H.Z)((0,H.Z)((0,H.Z)({},WA),r),{},{getTileData:t});return{data:e,dataArray:[],tilesetOptions:n,isTile:!0}}var $A=L(48096),YA=L.n($A);function Vy(e,r){var t=r.radius,n=t===void 0?40:t,i=r.maxZoom,o=i===void 0?18:i,s=r.minZoom,l=s===void 0?0:s,f=r.zoom,v=f===void 0?2:f;if(e.pointIndex){var y=e.pointIndex.getClusters(e.extent,Math.floor(v));return e.dataArray=qA(y),e}var b=new(YA())({radius:n,minZoom:l,maxZoom:o}),T={type:"FeatureCollection",features:[]};return T.features=e.dataArray.map(function(M){return{type:"Feature",geometry:{type:"Point",coordinates:M.coordinates},properties:(0,H.Z)({},M)}}),b.load(T.features),b}function qA(e){return e.map(function(r,t){return(0,H.Z)({coordinates:r.geometry.coordinates,_id:t+1},r.properties)})}function KA(e){if(e.length===0)throw new Error("max requires at least one data point");for(var r=e[0],t=1;t<e.length;t++)e[t]>r&&(r=e[t]);return r}function QA(e){if(e.length===0)throw new Error("min requires at least one data point");for(var r=e[0],t=1;t<e.length;t++)e[t]<r&&(r=e[t]);return r}function jy(e){if(e.length===0)return 0;for(var r=e[0],t=0,n,i=1;i<e.length;i++)n=r+e[i]*1,Math.abs(r)>=Math.abs(e[i])?t+=r-n+e[i]:t+=e[i]-n+r,r=n;return r+t*1}function JA(e){if(e.length===0)throw new Error("mean requires at least one data point");return jy(e)/e.length}var eT={min:QA,max:KA,mean:JA,sum:jy};function tT(e){var r=rT();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function rT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var nT=ii.cloneDeep,Hy=ii.isFunction,iT=ii.isString,aT=ii.mergeWith;function oT(e,r){if(Array.isArray(r))return r}var sT=function(e){(0,De.Z)(t,e);var r=tT(t);function t(n,i){var o;return(0,q.Z)(this,t),o=r.call(this),(0,B.Z)((0,Ie.Z)(o),"type","source"),(0,B.Z)((0,Ie.Z)(o),"isTile",!1),(0,B.Z)((0,Ie.Z)(o),"inited",!1),(0,B.Z)((0,Ie.Z)(o),"hooks",{init:new xu}),(0,B.Z)((0,Ie.Z)(o),"parser",{type:"geojson"}),(0,B.Z)((0,Ie.Z)(o),"transforms",[]),(0,B.Z)((0,Ie.Z)(o),"cluster",!1),(0,B.Z)((0,Ie.Z)(o),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,B.Z)((0,Ie.Z)(o),"invalidExtent",!1),(0,B.Z)((0,Ie.Z)(o),"dataArrayChanged",!1),(0,B.Z)((0,Ie.Z)(o),"cfg",{autoRender:!0}),o.originData=n,o.initCfg(i),o.init().then(function(){o.inited=!0,o.emit("update",{type:"inited"})}),o}return(0,V.Z)(t,[{key:"getSourceCfg",value:function(){return this.cfg}},{key:"getClusters",value:function(i){return this.clusterIndex.getClusters(this.caculClusterExtent(2),i)}},{key:"getClustersLeaves",value:function(i){return this.clusterIndex.getLeaves(i,1/0)}},{key:"getParserType",value:function(){return this.parser.type}},{key:"updateClusterData",value:function(i){var o=this,s=this.clusterOptions,l=s.method,f=l===void 0?"sum":l,v=s.field,y=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(i));this.clusterOptions.zoom=i,y.forEach(function(b){b.id||(b.properties.point_count=1)}),(v||Hy(f))&&(y=y.map(function(b){var T=b.id;if(T){var M=o.clusterIndex.getLeaves(T,1/0),O=M.map(function(G){return G.properties}),k;if(iT(f)&&v){var $=mf(O,v);k=eT[f]($)}Hy(f)&&(k=f(O)),b.properties.stat=k}else b.properties.point_count=1;return b})),this.data=he("geojson")({type:"FeatureCollection",features:y}),this.executeTrans()}},{key:"getFeatureById",value:function(i){var o=this.parser,s=o.type,l=s===void 0?"geojson":s,f=o.geometry;if(l==="geojson"&&!this.cluster){var v=i<this.originData.features.length?this.originData.features[i]:"null",y=nT(v);if(y!=null&&y.properties&&(this.transforms.length!==0||this.dataArrayChanged)){var b=this.data.dataArray.find(function(T){return T._id===i});y.properties=b}return y}else return l==="json"&&f?this.data.dataArray.find(function(T){return T._id===i}):i<this.data.dataArray.length?this.data.dataArray[i]:"null"}},{key:"updateFeaturePropertiesById",value:function(i,o){this.data.dataArray=this.data.dataArray.map(function(s){return s._id===i?(0,H.Z)((0,H.Z)({},s),o):s}),this.dataArrayChanged=!0,this.emit("update",{type:"update"})}},{key:"getFeatureId",value:function(i,o){var s=this.data.dataArray.find(function(l){return l[i]===o});return s==null?void 0:s._id}},{key:"setData",value:function(i,o){var s=this;this.originData=i,this.dataArrayChanged=!1,this.initCfg(o),this.init().then(function(){s.emit("update",{type:"update"})})}},{key:"reloadAllTile",value:function(){var i;(i=this.tileset)===null||i===void 0||i.reloadAll()}},{key:"reloadTilebyId",value:function(i,o,s){var l;(l=this.tileset)===null||l===void 0||l.reloadTileById(i,o,s)}},{key:"reloadTileByLnglat",value:function(i,o,s){var l;(l=this.tileset)===null||l===void 0||l.reloadTileByLnglat(i,o,s)}},{key:"getTileExtent",value:function(i,o){var s;return(s=this.tileset)===null||s===void 0?void 0:s.getTileExtent(i,o)}},{key:"getTileByZXY",value:function(i,o,s){var l;return(l=this.tileset)===null||l===void 0?void 0:l.getTileByZXY(i,o,s)}},{key:"reloadTileByExtent",value:function(i,o){var s;(s=this.tileset)===null||s===void 0||s.reloadTileByExtent(i,o)}},{key:"destroy",value:function(){var i;this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null,(i=this.tileset)===null||i===void 0||i.destroy()}},{key:"processData",value:function(){var n=(0,Ct.Z)(me().mark(function o(){var s=this;return me().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.abrupt("return",new Promise(function(v,y){try{s.excuteParser(),s.initCluster(),s.executeTrans(),v({})}catch(b){y(b)}}));case 1:case"end":return f.stop()}},o)}));function i(){return n.apply(this,arguments)}return i}()},{key:"initCfg",value:function(i){this.cfg=aT(this.cfg,i,oT);var o=this.cfg;o&&(o.parser&&(this.parser=o.parser),o.transforms&&(this.transforms=o.transforms),this.cluster=o.cluster||!1,o.clusterOptions&&(this.cluster=!0,this.clusterOptions=(0,H.Z)((0,H.Z)({},this.clusterOptions),o.clusterOptions)))}},{key:"init",value:function(){var n=(0,Ct.Z)(me().mark(function o(){return me().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.inited=!1,l.next=3,this.processData();case 3:this.inited=!0;case 4:case"end":return l.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"excuteParser",value:function(){var i=this.parser,o=i.type||"geojson",s=he(o);this.data=s(this.originData,i),this.tileset=this.initTileset(),!i.cancelExtent&&(this.extent=Cl(this.data.dataArray),this.setCenter(this.extent),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3])}},{key:"setCenter",value:function(i){this.center=[(i[0]+i[2])/2,(i[1]+i[3])/2],(isNaN(this.center[0])||isNaN(this.center[1]))&&(this.center=[108.92361111111111,34.54083333333333])}},{key:"initTileset",value:function(){var i=this.data.tilesetOptions;if(i){if(this.isTile=!0,this.tileset)return this.tileset.updateOptions(i),this.tileset;var o=new ff((0,H.Z)({},i));return o}}},{key:"executeTrans",value:function(){var i=this,o=this.transforms;o.forEach(function(s){var l=s.type,f=qe(l)(i.data,s);Object.assign(i.data,f)})}},{key:"initCluster",value:function(){if(this.cluster){var i=this.clusterOptions||{};this.clusterIndex=Vy(this.data,i)}}},{key:"caculClusterExtent",value:function(i){var o=[[-1/0,-1/0],[1/0,1/0]];return this.invalidExtent||(o=of(pa(this.extent),i)),o[0].concat(o[1])}}]),t}(no.EventEmitter);function uT(e,r){var t=r.callback;return t&&(e.dataArray=e.dataArray.filter(t)),e}function Wy(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=lT(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var v=t.next();return o=v.done,v},e:function(v){s=!0,l=v},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function lT(e,r){if(e){if(typeof e=="string")return Gy(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Gy(e,r)}}function Gy(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var B0=6378e3;function cT(e,r){var t=e.dataArray,n=r.size,i=n===void 0?10:n,o=i/(2*Math.PI*B0)*(256<<20)/2,s=fT(t,i),l=s.gridHash,f=s.gridOffset,v=vT(l,f,r);return{yOffset:o,xOffset:o,radius:o,type:"grid",dataArray:v}}function fT(e,r){var t=1/0,n=-1/0,i,o=Wy(e),s;try{for(o.s();!(s=o.n()).done;){var l=s.value;i=l.coordinates[1],Number.isFinite(i)&&(t=i<t?i:t,n=i>n?i:n)}}catch(ye){o.e(ye)}finally{o.f()}var f=(t+n)/2,v=hT(r,f);if(v.xOffset<=0||v.yOffset<=0)return{gridHash:{},gridOffset:v};var y={},b=Wy(e),T;try{for(b.s();!(T=b.n()).done;){var M=T.value,O=M.coordinates[1],k=M.coordinates[0];if(Number.isFinite(O)&&Number.isFinite(k)){var $=Math.floor((O+90)/v.yOffset),G=Math.floor((k+180)/v.xOffset),oe="".concat($,"-").concat(G);y[oe]=y[oe]||{count:0,points:[]},y[oe].count+=1,y[oe].points.push(M)}}}catch(ye){b.e(ye)}finally{b.f()}return{gridHash:y,gridOffset:v}}function hT(e,r){var t=pT(e),n=dT(r,e);return{yOffset:t,xOffset:n}}function pT(e){return e/B0*(180/Math.PI)}function dT(e,r){return r/B0*(180/Math.PI)/Math.cos(e*Math.PI/180)}function vT(e,r,t){return Object.keys(e).reduce(function(n,i,o){var s=i.split("-"),l=parseInt(s[0],10),f=parseInt(s[1],10),v={};if(t.field&&t.method){var y=lf(e[i].points,t.field);v[t.method]=Il[t.method](y)}return Object.assign(v,{_id:o,coordinates:ko([-180+r.xOffset*(f+.5),-90+r.yOffset*(l+.5)]),rawData:e[i].points,count:e[i].count}),n.push(v),n},[])}var sv=Math.PI/3,mT=[0,sv,2*sv,3*sv,4*sv,5*sv];function gT(e){return e[0]}function _T(e){return e[1]}function yT(){var e=0,r=0,t=1,n=1,i=gT,o=_T,s,l,f;function v(b){var T={},M=[],O,k=b.length;for(O=0;O<k;++O)if(!(isNaN(G=+i.call(null,$=b[O],O,b))||isNaN(oe=+o.call(null,$,O,b)))){var $,G,oe,ye=Math.round(oe=oe/f),Le=Math.round(G=G/l-(ye&1)/2),$e=oe-ye;if(Math.abs($e)*3>1){var ut=G-Le,vt=Le+(G<Le?-1:1)/2,Rt=ye+(oe<ye?-1:1),Jt=G-vt,Mr=oe-Rt;ut*ut+$e*$e>Jt*Jt+Mr*Mr&&(Le=vt+(ye&1?1:-1)/2,ye=Rt)}var br=Le+"-"+ye,pn=T[br];pn?pn.push($):(M.push(pn=T[br]=[$]),pn.x=(Le+(ye&1)/2)*l,pn.y=ye*f)}return M}function y(b){var T=0,M=0;return mT.map(function(O){var k=Math.sin(O)*b,$=-Math.cos(O)*b,G=k-T,oe=$-M;return T=k,M=$,[G,oe]})}return v.hexagon=function(b){return"m"+y(b==null?s:+b).join("l")+"z"},v.centers=function(){for(var b=[],T=Math.round(r/f),M=Math.round(e/l),O=T*f;O<n+s;O+=f,++T)for(var k=M*l+(T&1)*l/2;k<t+l/2;k+=l)b.push([k,O]);return b},v.mesh=function(){var b=y(s).slice(0,4).join("l");return v.centers().map(function(T){return"M"+T+"m"+b}).join("")},v.x=function(b){return arguments.length?(i=b,v):i},v.y=function(b){return arguments.length?(o=b,v):o},v.radius=function(b){return arguments.length?(s=+b,l=s*2*Math.sin(sv),f=s*1.5,v):s},v.size=function(b){return arguments.length?(e=r=0,t=+b[0],n=+b[1],v):[t-e,n-r]},v.extent=function(b){return arguments.length?(e=+b[0][0],r=+b[0][1],t=+b[1][0],n=+b[1][1],v):[[e,r],[t,n]]},v.radius(1)}var xT=6378e3;function bT(e,r){var t=e.dataArray,n=r.size,i=n===void 0?10:n,o=r.method,s=o===void 0?"sum":o,l=i/(2*Math.PI*xT)*(256<<20)/2,f=t.map(function(T){var M=ko(T.coordinates),O=(0,yn.Z)(M,2),k=O[0],$=O[1];return(0,H.Z)((0,H.Z)({},T),{},{coordinates:[k,$]})}),v=yT().radius(l).x(function(T){return T.coordinates[0]}).y(function(T){return T.coordinates[1]}),y=v(f),b={dataArray:y.map(function(T,M){var O;if(r.field&&s){var k=lf(T,r.field);T[s]=Il[s](k)}return O={},(0,B.Z)(O,r.method,T[s]),(0,B.Z)(O,"count",T.length),(0,B.Z)(O,"rawData",T),(0,B.Z)(O,"coordinates",[T.x,T.y]),(0,B.Z)(O,"_id",M),O}),radius:l,xOffset:l,yOffset:l,type:"hexagon"};return b}function ET(e,r){var t=r.sourceField,n=r.targetField,i=r.data,o={};return i.forEach(function(s){o[s[t]]=s}),e.dataArray=e.dataArray.map(function(s){var l=s[n];return(0,H.Z)((0,H.Z)({},s),o[l])}),e}function ST(e,r){var t=r.callback;return t&&(e.dataArray=e.dataArray.map(t)),e}ae("rasterTile",VA),ae("mvt",Ur),ae("geojsonvt",z),ae("testTile",XA),ae("geojson",pp),ae("jsonTile",cr),ae("image",Ee),ae("csv",_f),ae("json",Zc),ae("raster",ui),ae("rasterRgb",HA),ie("cluster",Vy),ie("filter",uT),ie("join",ET),ie("map",ST),ie("grid",cT),ie("hexagon",bT);var Xy=sT;function AT(e){var r=TT();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function TT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var wT=function(e){(0,De.Z)(t,e);var r=AT(t);function t(n){var i;return(0,q.Z)(this,t),i=r.call(this),(0,B.Z)((0,Ie.Z)(i),"added",!1),(0,B.Z)((0,Ie.Z)(i),"eventHandle",function(o){i.polyfillEvent(o),i.emit(o.type,{target:o,data:i.markerOption.extData,lngLat:i.lngLat})}),i.markerOption=(0,H.Z)((0,H.Z)({},i.getDefault()),n),tc(["update","onMove","onMapClick"],(0,Ie.Z)(i)),i.init(),i}return(0,V.Z)(t,[{key:"getMarkerLayerContainerSize",value:function(){}},{key:"getDefault",value:function(){return{element:void 0,anchor:ma.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(i){this.scene=i,this.mapsService=i.get(tt.IMapService),this.sceneSerive=i.get(tt.ISceneService);var o=this.markerOption.element;return this.mapsService.getMarkerContainer().appendChild(o),this.registerMarkerEvent(o),this.mapsService.on("camerachange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("camerachange",this.update)),this.unRegisterMarkerEvent(),this.removeAllListeners();var i=this.markerOption.element;return i&&Ci(i),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(i){return this.lngLat=i,Array.isArray(i)&&(this.lngLat={lng:i[0],lat:i[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(i){var o=this;if(!this.added)return this.once("added",function(){o.setElement(i)}),this;var s=this.markerOption.element;return s&&Ci(s),this.markerOption.element=i,this.init(),this.mapsService.getMarkerContainer().appendChild(i),this.registerMarkerEvent(i),this.update(),this}},{key:"openPopup",value:function(){var i=this;if(!this.added)return this.once("added",function(){i.openPopup()}),this;var o=this.popup;return o?(o.isOpen()||o.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var i=this;this.added||this.once("added",function(){i.closePopup()});var o=this.popup;return o&&o.remove(),this}},{key:"setPopup",value:function(i){return this.popup=i,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var i=this.popup;if(i)i.isOpen()?i.remove():i.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(i){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(i){this.markerOption.extData=i}},{key:"update",value:function(){if(this.mapsService){var i=this.markerOption,o=i.element,s=i.anchor;this.updatePosition(),ku(o,"".concat(Aa[s]))}}},{key:"onMapClick",value:function(i){var o=this.markerOption.element;this.popup&&o&&this.togglePopup()}},{key:"getCurrentContainerSize",value:function(){var i=this.mapsService.getContainer();return{containerHeight:(i==null?void 0:i.scrollHeight)||0,containerWidth:(i==null?void 0:i.scrollWidth)||0,bounds:this.mapsService.getBounds()}}},{key:"updatePosition",value:function(){if(this.mapsService){var i=this.markerOption,o=i.element,s=i.offsets,l=this.lngLat,f=l.lng,v=l.lat,y=this.mapsService.lngLatToContainer([f,v]);if(o){o.style.display="block",o.style.whiteSpace="nowrap";var b=this.getMarkerLayerContainerSize()||this.getCurrentContainerSize(),T=b.containerHeight,M=b.containerWidth,O=b.bounds;if(!O)return;if(Math.abs(O[0][0])>180||Math.abs(O[1][0])>180){if(y.x>M){var k=this.mapsService.lngLatToContainer([f-360,v]);y.x=k.x}if(y.x<0){var $=this.mapsService.lngLatToContainer([f+360,v]);y.x=$.x}}(y.x>M||y.x<0||y.y>T||y.y<0)&&(o.style.display="none"),o.style.left=y.x+s[0]+"px",o.style.top=y.y-s[1]+"px"}}}},{key:"init",value:function(){var i=this,o=this.markerOption.element,s=this.markerOption,l=s.color,f=s.anchor;if(!o){this.defaultMarker=!0,o=Ji("div"),this.markerOption.element=o;var v=document.createElementNS("http://www.w3.org/2000/svg","svg");v.setAttributeNS(null,"display","block"),v.setAttributeNS(null,"height","48px"),v.setAttributeNS(null,"width","48px"),v.setAttributeNS(null,"viewBox","0 0 1024 1024");var y=document.createElementNS("http://www.w3.org/2000/svg","path");y.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),y.setAttributeNS(null,"fill",l),v.appendChild(y),o.appendChild(v)}fu(o,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(b){var T,M,O=((T=i.markerOption)===null||T===void 0?void 0:T.style)&&((M=i.markerOption)===null||M===void 0?void 0:M.style[b]);o&&(o.style[b]=O)}),$l(o,f,"marker")}},{key:"registerMarkerEvent",value:function(i){i.addEventListener("click",this.onMapClick),i.addEventListener("mousemove",this.eventHandle),i.addEventListener("click",this.eventHandle),i.addEventListener("mousedown",this.eventHandle),i.addEventListener("mouseup",this.eventHandle),i.addEventListener("dblclick",this.eventHandle),i.addEventListener("contextmenu",this.eventHandle),i.addEventListener("mouseover",this.eventHandle),i.addEventListener("mouseout",this.eventHandle),i.addEventListener("touchstart",this.eventHandle),i.addEventListener("touchend",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var i=this.getElement();i.removeEventListener("click",this.onMapClick),i.removeEventListener("mousemove",this.eventHandle),i.removeEventListener("click",this.eventHandle),i.removeEventListener("mousedown",this.eventHandle),i.removeEventListener("mouseup",this.eventHandle),i.removeEventListener("dblclick",this.eventHandle),i.removeEventListener("contextmenu",this.eventHandle),i.removeEventListener("mouseover",this.eventHandle),i.removeEventListener("mouseout",this.eventHandle),i.removeEventListener("touchstart",this.eventHandle),i.removeEventListener("touchend",this.eventHandle)}},{key:"polyfillEvent",value:function(i){!this.mapsService||this.mapsService.version!=="GAODE2.x"||ec()||(i.type==="touchstart"&&(this.touchStartTime=Date.now()),i.type==="touchend"&&Date.now()-this.touchStartTime<300&&this.emit("click",{target:i,data:this.markerOption.extData,lngLat:this.lngLat}))}},{key:"addDragHandler",value:function(i){return null}},{key:"onUp",value:function(i){throw new Error("Method not implemented.")}}]),t}(no.EventEmitter);function iL(e){var r=CT();return function(){var n=_getPrototypeOf(e),i;if(r){var o=_getPrototypeOf(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return _possibleConstructorReturn(this,i)}}function CT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var aL=ii.merge,oL=null,sL=L(18735);function RT(e){var r=MT();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function MT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var uv=function(e){(0,De.Z)(t,e);var r=RT(t);function t(n){var i;return(0,q.Z)(this,t),i=r.call(this),t.controlCount++,i.controlOption=(0,H.Z)((0,H.Z)({},i.getDefault(n)),n||{}),i}return(0,V.Z)(t,[{key:"getOptions",value:function(){return this.controlOption}},{key:"setOptions",value:function(i){var o=this.getDefault(i);Object.entries(i).forEach(function(s){var l=(0,yn.Z)(s,2),f=l[0],v=l[1];v===void 0&&(i[f]=o[f])}),"position"in i&&this.setPosition(i.position),"className"in i&&this.setClassName(i.className),"style"in i&&this.setStyle(i.style),this.controlOption=(0,H.Z)((0,H.Z)({},this.controlOption),i)}},{key:"addTo",value:function(i){this.mapsService=i.get(tt.IMapService),this.renderService=i.get(tt.IRendererService),this.layerService=i.get(tt.ILayerService),this.controlService=i.get(tt.IControlService),this.configService=i.get(tt.IGlobalConfigService),this.scene=i.get(tt.ISceneService),this.sceneContainer=i,this.isShow=!0,this.container=this.onAdd(),fu(this.container,"l7-control");var o=this.controlOption,s=o.className,l=o.style;return s&&this.setClassName(s),l&&this.setStyle(l),this.insertContainer(),this.emit("add",this),this}},{key:"remove",value:function(){if(!this.mapsService)return this;Ci(this.container),this.onRemove(),this.emit("remove",this)}},{key:"onAdd",value:function(){return Ji("div")}},{key:"onRemove",value:function(){}},{key:"show",value:function(){var i=this.container;Du(i,"l7-control--hide"),this.isShow=!0,this.emit("show",this)}},{key:"hide",value:function(){var i=this.container;fu(i,"l7-control--hide"),this.isShow=!1,this.emit("hide",this)}},{key:"getDefault",value:function(i){return{position:_r.TOPRIGHT,name:"".concat(t.controlCount)}}},{key:"getContainer",value:function(){return this.container}},{key:"getIsShow",value:function(){return this.isShow}},{key:"_refocusOnMap",value:function(i){if(this.mapsService&&i&&i.screenX>0&&i.screenY>0){var o=this.mapsService.getContainer();o!==null&&o.focus()}}},{key:"setPosition",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:_r.TOPLEFT,o=this.controlService;return o&&o.removeControl(this),this.controlOption.position=i,o&&o.addControl(this,this.sceneContainer),this}},{key:"setClassName",value:function(i){var o=this.container,s=this.controlOption.className;s&&Du(o,s),i&&fu(o,i)}},{key:"setStyle",value:function(i){var o=this.container;i?o.setAttribute("style",i):o.removeAttribute("style")}},{key:"insertContainer",value:function(){var i=this.controlOption.position,o=this.container;if(i instanceof Element)i.appendChild(o);else{var s=this.controlService.controlCorners[i];["bottomleft","bottomright","righttop","rightbottom"].includes(i)?s.insertBefore(o,s.firstChild):s.appendChild(o)}}},{key:"checkUpdateOption",value:function(i,o){return o.some(function(s){return s in i})}}]),t}(vu());(0,B.Z)(uv,"controlCount",0);function IT(e){var r=PT();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function PT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _g=function(e){(0,De.Z)(t,e);var r=IT(t);function t(){var n;(0,q.Z)(this,t);for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return n=r.call.apply(r,[this].concat(o)),(0,B.Z)((0,Ie.Z)(n),"isDisable",!1),n}return(0,V.Z)(t,[{key:"setIsDisable",value:function(i){if(this.isDisable=i,i){var o;(o=this.button)===null||o===void 0||o.setAttribute("disabled","true")}else{var s;(s=this.button)===null||s===void 0||s.removeAttribute("disabled")}}},{key:"createButton",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return Ji("button","l7-button-control ".concat(i))}},{key:"onAdd",value:function(){this.button=this.createButton(),this.isDisable=!1;var i=this.controlOption,o=i.title,s=i.btnText,l=i.btnIcon;return this.setBtnTitle(o),this.setBtnText(s),this.setBtnIcon(l),this.button}},{key:"onRemove",value:function(){this.button=this.buttonIcon=this.buttonText=void 0,this.isDisable=!1}},{key:"setOptions",value:function(i){var o=i.title,s=i.btnText,l=i.btnIcon;this.checkUpdateOption(i,["title"])&&this.setBtnTitle(o),this.checkUpdateOption(i,["btnIcon"])&&this.setBtnIcon(l),this.checkUpdateOption(i,["btnText"])&&this.setBtnText(s),Ra((0,be.Z)(t.prototype),"setOptions",this).call(this,i)}},{key:"setBtnTitle",value:function(i){var o;(o=this.button)===null||o===void 0||o.setAttribute("title",i!=null?i:"")}},{key:"setBtnIcon",value:function(i){if(this.buttonIcon&&Ci(this.buttonIcon),i){var o,s=(o=this.button)===null||o===void 0?void 0:o.firstChild;if(s){var l;(l=this.button)===null||l===void 0||l.insertBefore(i,s)}else{var f;(f=this.button)===null||f===void 0||f.appendChild(i)}this.buttonIcon=i}}},{key:"setBtnText",value:function(i){if(this.button)if(Du(this.button,"l7-button-control--row"),Du(this.button,"l7-button-control--column"),i){var o=this.buttonText;if(!o){var s;o=Ji("div","l7-button-control__text"),(s=this.button)===null||s===void 0||s.appendChild(o),this.buttonText=o}o.innerText=i,fu(this.button,this.controlOption.vertical?"l7-button-control--column":"l7-button-control--row")}else!i&&this.buttonText&&(Ci(this.buttonText),this.buttonText=void 0)}}]),t}(uv);function OT(e){var r=DT();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function DT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $y=function(e){(0,De.Z)(t,e);var r=OT(t);function t(n,i){var o;return(0,q.Z)(this,t),o=r.call(this),(0,B.Z)((0,Ie.Z)(o),"isShow",!1),(0,B.Z)((0,Ie.Z)(o),"timeout",null),(0,B.Z)((0,Ie.Z)(o),"show",function(){return o.isShow||!o.contentDOM.innerHTML||(o.resetPopperPosition(),Du(o.popperDOM,"l7-popper-hide"),o.isShow=!0,o.option.unique&&t.conflictPopperList.forEach(function(s){s!==(0,Ie.Z)(o)&&s.isShow&&s.hide()}),o.emit("show"),window.addEventListener("pointerdown",o.onPopperUnClick)),(0,Ie.Z)(o)}),(0,B.Z)((0,Ie.Z)(o),"hide",function(){return o.isShow&&(fu(o.popperDOM,"l7-popper-hide"),o.isShow=!1,o.emit("hide"),window.removeEventListener("pointerdown",o.onPopperUnClick)),(0,Ie.Z)(o)}),(0,B.Z)((0,Ie.Z)(o),"setHideTimeout",function(){o.timeout||(o.timeout=window.setTimeout(function(){o.isShow&&(o.hide(),o.timeout=null)},300))}),(0,B.Z)((0,Ie.Z)(o),"clearHideTimeout",function(){o.timeout&&(window.clearTimeout(o.timeout),o.timeout=null)}),(0,B.Z)((0,Ie.Z)(o),"onBtnClick",function(){o.isShow?o.hide():o.show()}),(0,B.Z)((0,Ie.Z)(o),"onPopperUnClick",function(s){Tl(s.target,[".l7-button-control",".l7-popper-content"])||o.hide()}),(0,B.Z)((0,Ie.Z)(o),"onBtnMouseLeave",function(){o.setHideTimeout()}),(0,B.Z)((0,Ie.Z)(o),"onBtnMouseMove",function(){o.clearHideTimeout(),!o.isShow&&o.show()}),o.button=n,o.option=i,o.init(),i.unique&&t.conflictPopperList.push((0,Ie.Z)(o)),o}return(0,V.Z)(t,[{key:"buttonRect",get:function(){return this.button.getBoundingClientRect()}},{key:"getPopperDOM",value:function(){return this.popperDOM}},{key:"getIsShow",value:function(){return this.isShow}},{key:"getContent",value:function(){return this.content}},{key:"setContent",value:function(i){typeof i=="string"?this.contentDOM.innerHTML=i:i instanceof HTMLElement&&(ca(this.contentDOM),this.contentDOM.appendChild(i)),this.content=i}},{key:"init",value:function(){var i=this.option.trigger;this.popperDOM=this.createPopper(),i==="click"?this.button.addEventListener("click",this.onBtnClick):(this.button.addEventListener("mousemove",this.onBtnMouseMove),this.button.addEventListener("mouseleave",this.onBtnMouseLeave),this.popperDOM.addEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.addEventListener("mouseleave",this.onBtnMouseLeave))}},{key:"destroy",value:function(){this.button.removeEventListener("click",this.onBtnClick),this.button.removeEventListener("mousemove",this.onBtnMouseMove),this.button.removeEventListener("mousemove",this.onBtnMouseLeave),this.popperDOM.removeEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.removeEventListener("mouseleave",this.onBtnMouseLeave),Ci(this.popperDOM)}},{key:"resetPopperPosition",value:function(){var i={},o=this.option,s=o.container,l=o.offset,f=l===void 0?[0,0]:l,v=o.placement,y=(0,yn.Z)(f,2),b=y[0],T=y[1],M=this.button.getBoundingClientRect(),O=s.getBoundingClientRect(),k=gh(M,O),$=k.left,G=k.right,oe=k.top,ye=k.bottom,Le=!1,$e=!1;/^(left|right)/.test(v)?(v.includes("left")?i.right="".concat(M.width+G,"px"):v.includes("right")&&(i.left="".concat(M.width+$,"px")),v.includes("start")?i.top="".concat(oe,"px"):v.includes("end")?i.bottom="".concat(ye,"px"):(i.top="".concat(oe+M.height/2,"px"),$e=!0,i.transform="translate(".concat(b,"px, calc(").concat(T,"px - 50%))"))):/^(top|bottom)/.test(v)&&(v.includes("top")?i.bottom="".concat(M.height+ye,"px"):v.includes("bottom")&&(i.top="".concat(M.height+oe,"px")),v.includes("start")?i.left="".concat($,"px"):v.includes("end")?i.right="".concat(G,"px"):(i.left="".concat($+M.width/2,"px"),Le=!0,i.transform="translate(calc(".concat(b,"px - 50%), ").concat(T,"px)"))),i.transform="translate(calc(".concat(b,"px - ").concat(Le?"50%":"0%","), calc(").concat(T,"px - ").concat($e?"50%":"0%",")");var ut=v.split("-");ut.length&&fu(this.popperDOM,ut.map(function(vt){return"l7-popper-".concat(vt)}).join(" ")),Qs(this.popperDOM,rl(i))}},{key:"createPopper",value:function(){var i=this.option,o=i.container,s=i.className,l=s===void 0?"":s,f=i.content,v=Ji("div","l7-popper l7-popper-hide ".concat(l)),y=Ji("div","l7-popper-content"),b=Ji("div","l7-popper-arrow");return v.appendChild(y),v.appendChild(b),o.appendChild(v),this.popperDOM=v,this.contentDOM=y,f&&this.setContent(f),v}}]),t}(no.EventEmitter);(0,B.Z)($y,"conflictPopperList",[]);function kT(e){var r=FT();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function FT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var BT={topleft:"right-start",topcenter:"bottom",topright:"left-start",bottomleft:"right-end",bottomcenter:"top",bottomright:"left-end",lefttop:"bottom-start",leftcenter:"right",leftbottom:"top-start",righttop:"bottom-end",rightcenter:"left",rightbottom:"top-end"},LT=function(e){(0,De.Z)(t,e);var r=kT(t);function t(){return(0,q.Z)(this,t),r.apply(this,arguments)}return(0,V.Z)(t,[{key:"getPopper",value:function(){return this.popper}},{key:"hide",value:function(){this.popper.hide(),Ra((0,be.Z)(t.prototype),"hide",this).call(this)}},{key:"getDefault",value:function(i){var o,s=Ra((0,be.Z)(t.prototype),"getDefault",this).call(this,i),l=(o=i==null?void 0:i.position)!==null&&o!==void 0?o:s.position;return(0,H.Z)((0,H.Z)({},Ra((0,be.Z)(t.prototype),"getDefault",this).call(this,i)),{},{popperPlacement:l instanceof Element?"bottom":BT[l],popperTrigger:"click"})}},{key:"onAdd",value:function(){var i=Ra((0,be.Z)(t.prototype),"onAdd",this).call(this);return this.initPopper(),i}},{key:"onRemove",value:function(){this.popper.destroy()}},{key:"initPopper",value:function(){var i=this,o=this.controlOption,s=o.popperClassName,l=o.popperPlacement,f=o.popperTrigger,v=this.mapsService.getMapContainer();return this.popper=new $y(this.button,{className:s,placement:l,trigger:f,container:v,unique:!0}),this.popper.on("show",function(){i.emit("popperShow",i)}).on("hide",function(){i.emit("popperHide",i)}),this.popper}},{key:"setOptions",value:function(i){if(Ra((0,be.Z)(t.prototype),"setOptions",this).call(this,i),this.checkUpdateOption(i,["popperPlacement","popperTrigger","popperClassName"])){var o=this.popper.getContent();this.popper.destroy(),this.initPopper(),this.popper.setContent(o)}}}]),t}(_g);function NT(e){var r=UT();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function UT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Rp=function(e){return e.ActiveOptionClassName="l7-select-control-item-active",e.OptionValueAttrKey="data-option-value",e.OptionIndexAttrKey="data-option-index",e}(Rp||{}),Yy=function(e){(0,De.Z)(t,e);var r=NT(t);function t(){var n;(0,q.Z)(this,t);for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return n=r.call.apply(r,[this].concat(o)),(0,B.Z)((0,Ie.Z)(n),"selectValue",[]),(0,B.Z)((0,Ie.Z)(n),"createNormalOption",function(l){var f=n.selectValue.includes(l.value),v=Ji("div","l7-select-control-item ".concat(f?Rp.ActiveOptionClassName:""));n.getIsMultiple()&&v.appendChild(n.createCheckbox(f)),l.icon&&v.appendChild(l.icon);var y=Ji("span");return y.innerText=l.text,v.appendChild(y),v}),(0,B.Z)((0,Ie.Z)(n),"onItemClick",function(l){if(n.getIsMultiple()){var f=n.selectValue.findIndex(function(v){return v===l.value});f>-1?n.selectValue.splice(f,1):n.selectValue=[].concat((0,Wt.Z)(n.selectValue),[l.value])}else n.selectValue=[l.value];n.setSelectValue(n.selectValue)}),n}return(0,V.Z)(t,[{key:"setOptions",value:function(i){Ra((0,be.Z)(t.prototype),"setOptions",this).call(this,i);var o=i.options;o&&this.popper.setContent(this.getPopperContent(o))}},{key:"onAdd",value:function(){var i=Ra((0,be.Z)(t.prototype),"onAdd",this).call(this),o=this.controlOption.defaultValue;return o&&(this.selectValue=this.transSelectValue(o)),this.popper.setContent(this.getPopperContent(this.controlOption.options)),i}},{key:"getSelectValue",value:function(){return this.getIsMultiple()?this.selectValue:this.selectValue[0]}},{key:"setSelectValue",value:function(i){var o=this,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,l=this.transSelectValue(i);this.optionDOMList.forEach(function(f){var v=f.getAttribute(Rp.OptionValueAttrKey),y=o.getIsMultiple()?f.querySelector("input[type=checkbox]"):void 0;l.includes(v)?(fu(f,Rp.ActiveOptionClassName),y&&Ql(y,!0)):(Du(f,Rp.ActiveOptionClassName),y&&Ql(y,!1))}),this.selectValue=l,s&&this.emit("selectChange",this.getIsMultiple()?l:l[0])}},{key:"getIsMultiple",value:function(){return!1}},{key:"getPopperContent",value:function(i){var o=this,s=this.isImageOptions(),l=Ji("div",s?"l7-select-control--image":"l7-select-control--normal");this.getIsMultiple()&&fu(l,"l7-select-control--multiple");var f=i.map(function(v,y){var b=s?o.createImageOption(v):o.createNormalOption(v);return b.setAttribute(Rp.OptionValueAttrKey,v.value),b.setAttribute(Rp.OptionIndexAttrKey,window.String(y)),b.addEventListener("click",o.onItemClick.bind(o,v)),b});return l.append.apply(l,(0,Wt.Z)(f)),this.optionDOMList=f,l}},{key:"createImageOption",value:function(i){var o=this.selectValue.includes(i.value),s=Ji("div","l7-select-control-item ".concat(o?Rp.ActiveOptionClassName:"")),l=Ji("img");l.setAttribute("src",i.img),tf(l),s.appendChild(l);var f=Ji("div","l7-select-control-item-row");this.getIsMultiple()&&s.appendChild(this.createCheckbox(o));var v=Ji("span");return v.innerText=i.text,f.appendChild(v),s.appendChild(f),s}},{key:"createCheckbox",value:function(i){var o=Ji("input");return o.setAttribute("type","checkbox"),i&&Ql(o,!0),o}},{key:"isImageOptions",value:function(){return!!this.controlOption.options.find(function(i){return i.img})}},{key:"transSelectValue",value:function(i){return Array.isArray(i)?i:[i]}}]),t}(LT),Hh=function(r){var t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.classList.add("l7-iconfont"),t.setAttribute("aria-hidden","true");var n=document.createElementNS("http://www.w3.org/2000/svg","use");return n.setAttributeNS("http://www.w3.org/1999/xlink","href","#".concat(r)),t.appendChild(n),t};function zT(e){var r=ZT();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function ZT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var VT=function(e){(0,De.Z)(t,e);var r=zT(t);function t(){var n;(0,q.Z)(this,t);for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return n=r.call.apply(r,[this].concat(o)),(0,B.Z)((0,Ie.Z)(n),"onClick",(0,Ct.Z)(me().mark(function l(){var f;return me().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(f=n.controlOption.onExport,y.t0=f==null,y.t0){y.next=8;break}return y.t1=f,y.next=6,n.getImage();case 6:y.t2=y.sent,(0,y.t1)(y.t2);case 8:case"end":return y.stop()}},l)}))),(0,B.Z)((0,Ie.Z)(n),"mergeImage",(0,Ct.Z)(me().mark(function l(){var f,v,y,b,T,M,O,k,$,G,oe,ye,Le,$e,ut=arguments;return me().wrap(function(Rt){for(;;)switch(Rt.prev=Rt.next){case 0:for(y=n.controlOption.imageType,b=(f=(v=n.mapsService.getContainer())===null||v===void 0?void 0:v.getBoundingClientRect())!==null&&f!==void 0?f:{},T=b.width,M=T===void 0?0:T,O=b.height,k=O===void 0?0:O,$=document.createElement("canvas"),$.width=M,$.height=k,G=$.getContext("2d"),oe=ut.length,ye=new Array(oe),Le=0;Le<oe;Le++)ye[Le]=ut[Le];return Rt.next=9,Promise.all(ye.map(function(Jt){return new Promise(function(Mr){var br=new Image;br.onload=function(){Mr(br)},br.src=Jt})}));case 9:return $e=Rt.sent,$e.forEach(function(Jt){G==null||G.drawImage(Jt,0,0,M,k)}),Rt.abrupt("return",$.toDataURL("image/".concat(y)));case 12:case"end":return Rt.stop()}},l)}))),n}return(0,V.Z)(t,[{key:"onAdd",value:function(){var i=Ra((0,be.Z)(t.prototype),"onAdd",this).call(this);return i.addEventListener("click",this.onClick),i}},{key:"getDefault",value:function(i){return(0,H.Z)((0,H.Z)({},Ra((0,be.Z)(t.prototype),"getDefault",this).call(this,i)),{},{title:"\u5BFC\u51FA\u56FE\u7247",btnIcon:Hh("l7-icon-export-picture"),imageType:"png"})}},{key:"getImage",value:function(){var n=(0,Ct.Z)(me().mark(function o(){var s,l;return me().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,this.mapsService.exportMap("png");case 2:return s=v.sent,v.next=5,this.scene.exportPng("png");case 5:return l=v.sent,v.abrupt("return",this.mergeImage.apply(this,(0,Wt.Z)([s,l].filter(function(y){return y}))));case 7:case"end":return v.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()}]),t}(_g);function jT(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=HT(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var v=t.next();return o=v.done,v},e:function(v){s=!0,l=v},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function HT(e,r){if(e){if(typeof e=="string")return qy(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return qy(e,r)}}function qy(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var Ky=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],Wh=function(){if(typeof document=="undefined")return!1;for(var e=Ky[0],r={},t=0,n=Ky;t<n.length;t++){var i=n[t],o=i==null?void 0:i[1];if(o in document){var s=jT(i.entries()),l;try{for(s.s();!(l=s.n()).done;){var f=(0,yn.Z)(l.value,2),v=f[0],y=f[1];r[e[v]]=y}}catch(b){s.e(b)}finally{s.f()}return r}}return!1}(),Qy={change:Wh.fullscreenchange,error:Wh.fullscreenerror},xc={request:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:document.documentElement,t=arguments.length>1?arguments[1]:void 0;return new Promise(function(n,i){var o=function l(){xc.off("change",l),n()};xc.on("change",o);var s=r[Wh.requestFullscreen](t);s instanceof Promise&&s.then(o).catch(i)})},exit:function(){return new Promise(function(r,t){if(!xc.isFullscreen){r();return}var n=function o(){xc.off("change",o),r()};xc.on("change",n);var i=document[Wh.exitFullscreen]();i instanceof Promise&&i.then(n).catch(t)})},toggle:function(r,t){return xc.isFullscreen?xc.exit():xc.request(r,t)},onchange:function(r){xc.on("change",r)},onerror:function(r){xc.on("error",r)},on:function(r,t){var n=Qy[r];n&&document.addEventListener(n,t,!1)},off:function(r,t){var n=Qy[r];n&&document.removeEventListener(n,t,!1)},raw:Wh};Object.defineProperties(xc,{isFullscreen:{get:function(){return!!document[Wh.fullscreenElement]}},element:{enumerable:!0,get:function(){var r;return(r=document[Wh.fullscreenElement])!==null&&r!==void 0?r:void 0}},isEnabled:{enumerable:!0,get:function(){return!!document[Wh.fullscreenEnabled]}}}),Wh||(xc={isEnabled:!1});var L0=xc;function WT(e){var r=GT();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function GT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var XT=function(e){(0,De.Z)(t,e);var r=WT(t);function t(n){var i;return(0,q.Z)(this,t),i=r.call(this,n),(0,B.Z)((0,Ie.Z)(i),"isFullscreen",!1),(0,B.Z)((0,Ie.Z)(i),"toggleFullscreen",(0,Ct.Z)(me().mark(function o(){return me().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!L0.isEnabled){l.next=3;break}return l.next=3,L0.toggle(i.mapContainer);case 3:case"end":return l.stop()}},o)}))),(0,B.Z)((0,Ie.Z)(i),"onClick",function(){i.toggleFullscreen()}),(0,B.Z)((0,Ie.Z)(i),"onFullscreenChange",function(){i.isFullscreen=!!document.fullscreenElement;var o=i.controlOption,s=o.btnText,l=o.btnIcon,f=o.title,v=o.exitBtnText,y=o.exitBtnIcon,b=o.exitTitle;i.isFullscreen?(i.setBtnTitle(b),i.setBtnText(v),i.setBtnIcon(y)):(i.setBtnTitle(f),i.setBtnText(s),i.setBtnIcon(l)),i.emit("fullscreenChange",i.isFullscreen)}),L0.isEnabled||console.warn("\u5F53\u524D\u6D4F\u89C8\u5668\u73AF\u5883\u4E0D\u652F\u6301\u5BF9\u5730\u56FE\u5168\u5C4F\u5316"),i}return(0,V.Z)(t,[{key:"setOptions",value:function(i){var o=i.exitBtnText,s=i.exitBtnIcon,l=i.exitTitle;this.isFullscreen&&(this.checkUpdateOption(i,["exitBtnIcon"])&&this.setBtnIcon(s),this.checkUpdateOption(i,["exitBtnText"])&&this.setBtnText(o),this.checkUpdateOption(i,["exitTitle"])&&this.setBtnTitle(l)),Ra((0,be.Z)(t.prototype),"setOptions",this).call(this,i)}},{key:"onAdd",value:function(){var i=Ra((0,be.Z)(t.prototype),"onAdd",this).call(this);return i.addEventListener("click",this.onClick),this.mapContainer=Os(this.scene.getSceneConfig().id),this.mapContainer.addEventListener("fullscreenchange",this.onFullscreenChange),i}},{key:"onRemove",value:function(){Ra((0,be.Z)(t.prototype),"onRemove",this).call(this),this.mapContainer.removeEventListener("fullscreenchange",this.onFullscreenChange)}},{key:"getDefault",value:function(i){return(0,H.Z)((0,H.Z)({},Ra((0,be.Z)(t.prototype),"getDefault",this).call(this,i)),{},{title:"\u5168\u5C4F",btnIcon:Hh("l7-icon-fullscreen"),exitTitle:"\u9000\u51FA\u5168\u5C4F",exitBtnIcon:Hh("l7-icon-exit-fullscreen")})}}]),t}(_g);function $T(e){var r=YT();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function YT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var qT=function(e){(0,De.Z)(t,e);var r=$T(t);function t(n){var i;return(0,q.Z)(this,t),i=r.call(this,n),(0,B.Z)((0,Ie.Z)(i),"getGeoLocation",function(){return new Promise(function(o,s){window.navigator.geolocation.getCurrentPosition(function(l){var f=l.coords,v=f!=null?f:{},y=v.longitude,b=v.latitude;!isNaN(y)&&!isNaN(b)?o([y,b]):s()},function(l){s(l)})})}),(0,B.Z)((0,Ie.Z)(i),"onClick",(0,Ct.Z)(me().mark(function o(){var s,l,f;return me().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(window.navigator.geolocation){y.next=2;break}return y.abrupt("return");case 2:return s=i.controlOption.transform,y.next=5,i.getGeoLocation();case 5:if(l=y.sent,f=i.mapsService.getZoom(),y.t0=i.mapsService,y.t1=f>15?f:15,!s){y.next=15;break}return y.next=12,s(l);case 12:y.t2=y.sent,y.next=16;break;case 15:y.t2=l;case 16:y.t3=y.t2,y.t0.setZoomAndCenter.call(y.t0,y.t1,y.t3);case 18:case"end":return y.stop()}},o)}))),window.navigator.geolocation||console.warn("\u5F53\u524D\u6D4F\u89C8\u5668\u73AF\u5883\u4E0D\u652F\u6301\u83B7\u53D6\u5730\u7406\u5B9A\u4F4D"),i}return(0,V.Z)(t,[{key:"getDefault",value:function(i){return(0,H.Z)((0,H.Z)({},Ra((0,be.Z)(t.prototype),"getDefault",this).call(this,i)),{},{title:"\u5B9A\u4F4D",btnIcon:Hh("l7-icon-reposition")})}},{key:"onAdd",value:function(){var i=Ra((0,be.Z)(t.prototype),"onAdd",this).call(this);return i.addEventListener("click",this.onClick),i}}]),t}(_g);function KT(e){var r=QT();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function QT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Jy(e){return Object.keys(e!=null?e:{}).every(function(r){return["layer","name","img"].includes(r)})}var e1=function(e){(0,De.Z)(t,e);var r=KT(t);function t(){var n;(0,q.Z)(this,t);for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return n=r.call.apply(r,[this].concat(o)),(0,B.Z)((0,Ie.Z)(n),"onLayerChange",function(){var l;(l=n.controlOption.layers)!==null&&l!==void 0&&l.length||(n.selectValue=n.getLayerVisible(),n.setOptions({options:n.getLayerOptions()}))}),(0,B.Z)((0,Ie.Z)(n),"onLayerVisibleChane",function(){n.setSelectValue(n.getLayerVisible())}),(0,B.Z)((0,Ie.Z)(n),"onSelectChange",function(){n.layers.forEach(function(l){var f=n.selectValue.includes(l.name),v=l.isVisible();f&&!v&&l.show(),!f&&v&&l.hide()})}),n}return(0,V.Z)(t,[{key:"layers",get:function(){var i=this.layerService,o=this.controlOption.layers;if(Array.isArray(o)&&o.length){var s=[];return o.forEach(function(l){if(l instanceof Object&&(Jy(l)?s.push(l.layer):s.push(l)),typeof l=="string"){var f=i.getLayer(l)||i.getLayerByName(l);f&&s.push(f)}}),s}return i.getLayers()||[]}},{key:"getDefault",value:function(i){return(0,H.Z)((0,H.Z)({},Ra((0,be.Z)(t.prototype),"getDefault",this).call(this,i)),{},{title:"\u56FE\u5C42\u63A7\u5236",btnIcon:Hh("l7-icon-layer"),options:[]})}},{key:"getLayerVisible",value:function(){return this.layers.filter(function(i){return i.isVisible()}).map(function(i){return i.name})}},{key:"getLayerOptions",value:function(){var i=this,o=this.controlOption.layers,s=o==null?void 0:o.every(function(l){return l.img});return o?o==null?void 0:o.map(function(l){if(Jy(l))return{text:l.name||l.layer.name,value:l.layer.name,img:s?l.img:void 0};if(typeof l=="string"){var f=i.layerService.getLayer(l)||i.layerService.getLayerByName(l);return{text:f==null?void 0:f.name,value:f==null?void 0:f.name}}return{text:l.name,value:l.name}}):this.layers.map(function(l){return{text:l.name,value:l.name}})}},{key:"setOptions",value:function(i){var o=this.checkUpdateOption(i,["layers"]);Ra((0,be.Z)(t.prototype),"setOptions",this).call(this,i),o&&(this.selectValue=this.getLayerVisible(),this.controlOption.options=this.getLayerOptions(),this.popper.setContent(this.getPopperContent(this.controlOption.options)))}},{key:"onAdd",value:function(){var i;return(i=this.controlOption.options)!==null&&i!==void 0&&i.length||(this.controlOption.options=this.getLayerOptions()),this.controlOption.defaultValue||(this.controlOption.defaultValue=this.getLayerVisible()),this.on("selectChange",this.onSelectChange),this.layerService.on("layerChange",this.onLayerChange),Ra((0,be.Z)(t.prototype),"onAdd",this).call(this)}},{key:"onRemove",value:function(){this.off("selectChange",this.onSelectChange),this.layerService.off("layerChange",this.onLayerChange)}},{key:"getIsMultiple",value:function(){return!0}}]),t}(Yy);function JT(e){var r=ew();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function ew(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var t1=function(e){(0,De.Z)(t,e);var r=JT(t);function t(){return(0,q.Z)(this,t),r.apply(this,arguments)}return(0,V.Z)(t,[{key:"getDefault",value:function(){return{position:_r.BOTTOMLEFT,name:"logo",href:"https://l7.antv.antgroup.com/",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*GRb1TKp4HcMAAAAAAAAAAAAAARQnAQ"}}},{key:"onAdd",value:function(){var i=Ji("div","l7-control-logo");return this.setLogoContent(i),i}},{key:"onRemove",value:function(){return null}},{key:"setOptions",value:function(i){Ra((0,be.Z)(t.prototype),"setOptions",this).call(this,i),this.checkUpdateOption(i,["img","href"])&&(ca(this.container),this.setLogoContent(this.container))}},{key:"setLogoContent",value:function(i){var o=this.controlOption,s=o.href,l=o.img,f=Ji("img");if(f.setAttribute("src",l),f.setAttribute("aria-label","AntV logo"),tf(f),s){var v=Ji("a","l7-control-logo-link");v.target="_blank",v.href=s,v.rel="noopener nofollow",v.setAttribute("rel","noopener nofollow"),v.appendChild(f),i.appendChild(v)}else i.appendChild(f)}}]),t}(uv),tw={normal:{text:"\u6807\u51C6",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*qdFDSbvIalgAAAAAAAAAAAAADmJ7AQ/original"},light:{text:"\u6708\u5149\u94F6",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*d-vcRLzu8WIAAAAAAAAAAAAADmJ7AQ/original"},dark:{text:"\u5E7B\u5F71\u9ED1",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*HMbRTI3XnpIAAAAAAAAAAAAADmJ7AQ/original"},fresh:{text:"\u8349\u8272\u9752",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*kqaGQ5kjSiAAAAAAAAAAAAAADmJ7AQ/original"},grey:{text:"\u96C5\u58EB\u7070",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*XegrTpZIbqAAAAAAAAAAAAAADmJ7AQ/original"},graffiti:{text:"\u6D82\u9E26",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*G5g9SZ_Jg4cAAAAAAAAAAAAADmJ7AQ/original"},macaron:{text:"\u9A6C\u5361\u9F99",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*irVvQbDpQMwAAAAAAAAAAAAADmJ7AQ/original"},darkblue:{text:"\u6781\u591C\u84DD",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*lKRzQYB4iR0AAAAAAAAAAAAADmJ7AQ/original"},wine:{text:"\u9171\u7C7D",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*orY0T7QL-lwAAAAAAAAAAAAADmJ7AQ/original"}},rw={normal:{text:"\u6807\u51C6",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*kIyZTok4Uk0AAAAAAAAAAAAADmJ7AQ/original"},light:{text:"\u4EAE",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*Z3JRQKDI-cIAAAAAAAAAAAAADmJ7AQ/original"},dark:{text:"\u6697",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*d7HCQbfmyaoAAAAAAAAAAAAADmJ7AQ/original"},satellite:{text:"\u536B\u661F",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*TytUT6pS9okAAAAAAAAAAAAADmJ7AQ/original"},outdoors:{text:"\u6237\u5916",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*hWwFSYJEFWsAAAAAAAAAAAAADmJ7AQ/original"}};function nw(e){var r=iw();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function iw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var aw=function(e){(0,De.Z)(t,e);var r=nw(t);function t(){var n;(0,q.Z)(this,t);for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return n=r.call.apply(r,[this].concat(o)),(0,B.Z)((0,Ie.Z)(n),"onMapThemeChange",function(){n.mapsService.setMapStyle(n.selectValue[0])}),n}return(0,V.Z)(t,[{key:"getDefault",value:function(i){return(0,H.Z)((0,H.Z)({},Ra((0,be.Z)(t.prototype),"getDefault",this).call(this,i)),{},{title:"\u5730\u56FE\u6837\u5F0F",btnIcon:Hh("l7-icon-color"),options:[]})}},{key:"getStyleOptions",value:function(){var i=this.mapsService.getType()==="mapbox"?rw:tw;return Object.entries(this.mapsService.getMapStyleConfig()).filter(function(o){var s=(0,yn.Z)(o,2),l=s[0],f=s[1];return typeof f=="string"&&l!=="blank"}).map(function(o){var s,l=(0,yn.Z)(o,2),f=l[0],v=l[1],y=(s=i[f])!==null&&s!==void 0?s:{},b=y.text,T=y.img;return{text:b!=null?b:f,value:v,img:T,key:f}})}},{key:"getMapStyle",value:function(){return this.mapsService.getMapStyle()}},{key:"onAdd",value:function(){var i,o=this;if((i=this.controlOption.options)!==null&&i!==void 0&&i.length||(this.controlOption.options=this.getStyleOptions()),this.controlOption.defaultValue){var s,l,f=this.controlOption.defaultValue;this.controlOption.defaultValue=(s=(l=this.controlOption.options.find(function(y){return y.key===f}))===null||l===void 0?void 0:l.value)!==null&&s!==void 0?s:f}else{var v=this.getMapStyle();v?this.controlOption.defaultValue=v:this.mapsService.map.once("styledata",function(){var y=o.mapsService.getMapStyle();o.controlOption.defaultValue=y,o.setSelectValue(y,!1)})}return this.on("selectChange",this.onMapThemeChange),Ra((0,be.Z)(t.prototype),"onAdd",this).call(this)}},{key:"getIsMultiple",value:function(){return!1}}]),t}(Yy);function ow(e){var r=sw();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function sw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var uw=function(e){(0,De.Z)(t,e);var r=ow(t);function t(){var n;(0,q.Z)(this,t);for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return n=r.call.apply(r,[this].concat(o)),(0,B.Z)((0,Ie.Z)(n),"location",[0,0]),(0,B.Z)((0,Ie.Z)(n),"onMouseMove",function(l){var f=n.location,v=l.lngLat||l.lnglat,y=n.controlOption.transform;v&&(f=[v.lng,v.lat]),n.location=f,y&&(f=y(f)),n.insertLocation2HTML(f),n.emit("locationChange",f)}),n}return(0,V.Z)(t,[{key:"getLocation",value:function(){return this.location}},{key:"getDefault",value:function(i){return(0,H.Z)((0,H.Z)({},Ra((0,be.Z)(t.prototype),"getDefault",this).call(this,i)),{},{position:_r.BOTTOMLEFT,transform:function(s){var l=(0,yn.Z)(s,2),f=l[0],v=l[1];return[+(+f).toFixed(6),+(+v).toFixed(6)]}})}},{key:"onAdd",value:function(){var i=Ji("div","l7-control-mouse-location");return i.innerHTML="&nbsp;",this.mapsService.on("mousemove",this.onMouseMove),i}},{key:"onRemove",value:function(){this.mapsService.off("mousemove",this.onMouseMove)}},{key:"insertLocation2HTML",value:function(i){this.container.innerText=i.join(", ")}}]),t}(uv);function lw(e){var r=cw();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function cw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var fw=function(e){(0,De.Z)(t,e);var r=lw(t);function t(){var n;(0,q.Z)(this,t);for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return n=r.call.apply(r,[this].concat(o)),(0,B.Z)((0,Ie.Z)(n),"update",function(){var l=n.mapsService,f=n.controlOption.maxWidth,v=l.getSize()[1]/2,y=l.containerToLngLat([0,v]),b=l.containerToLngLat([f,v]),T=Eh([y.lng,y.lat],[b.lng,b.lat]);n.updateScales(T)}),n}return(0,V.Z)(t,[{key:"getDefault",value:function(i){return(0,H.Z)((0,H.Z)({},Ra((0,be.Z)(t.prototype),"getDefault",this).call(this,i)),{},{name:"scale",position:_r.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,lockWidth:!0})}},{key:"onAdd",value:function(){var i="l7-control-scale",o=Ji("div",i);this.resetScaleLines(o);var s=this.controlOption.updateWhenIdle;return this.mapsService.on(s?"moveend":"mapmove",this.update),this.mapsService.on(s?"zoomend":"zoomchange",this.update),o}},{key:"onRemove",value:function(){var i=this.controlOption.updateWhenIdle;this.mapsService.off(i?"zoomend":"zoomchange",this.update),this.mapsService.off(i?"moveend":"mapmove",this.update)}},{key:"setOptions",value:function(i){Ra((0,be.Z)(t.prototype),"setOptions",this).call(this,i),this.checkUpdateOption(i,["lockWidth","maxWidth","metric","updateWhenIdle","imperial"])&&this.resetScaleLines(this.container)}},{key:"updateScales",value:function(i){var o=this.controlOption,s=o.metric,l=o.imperial;s&&i&&this.updateMetric(i),l&&i&&this.updateImperial(i)}},{key:"resetScaleLines",value:function(i){ca(i);var o=this.controlOption,s=o.metric,l=o.imperial,f=o.maxWidth,v=o.lockWidth;v&&Qs(i,"width: ".concat(f,"px")),s&&(this.mScale=Ji("div","l7-control-scale-line",i)),l&&(this.iScale=Ji("div","l7-control-scale-line",i)),this.update()}},{key:"updateScale",value:function(i,o,s){var l=this.controlOption.maxWidth;i.style.width=Math.round(l*s)+"px",i.innerHTML=o}},{key:"getRoundNum",value:function(i){var o=Math.pow(10,(Math.floor(i)+"").length-1),s=i/o;return s=s>=10?10:s>=5?5:s>=3?3:s>=2?2:1,o*s}},{key:"updateMetric",value:function(i){var o=this.getRoundNum(i),s=o<1e3?o+" m":o/1e3+" km";this.updateScale(this.mScale,s,o/i)}},{key:"updateImperial",value:function(i){var o=i*3.2808399,s,l,f;o>5280?(s=o/5280,l=this.getRoundNum(s),this.updateScale(this.iScale,l+" mi",l/s)):(f=this.getRoundNum(o),this.updateScale(this.iScale,f+" ft",f/o))}}]),t}(uv);function hw(e){var r=pw();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function pw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var dw=function(e){(0,De.Z)(t,e);var r=hw(t);function t(){var n;(0,q.Z)(this,t);for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return n=r.call.apply(r,[this].concat(o)),(0,B.Z)((0,Ie.Z)(n),"zoomIn",function(){!n.disabled&&n.mapsService.getZoom()<n.mapsService.getMaxZoom()&&n.mapsService.zoomIn()}),(0,B.Z)((0,Ie.Z)(n),"zoomOut",function(){!n.disabled&&n.mapsService.getZoom()>n.mapsService.getMinZoom()&&n.mapsService.zoomOut()}),(0,B.Z)((0,Ie.Z)(n),"updateDisabled",function(){var l=n.mapsService;n.zoomInButton.removeAttribute("disabled"),n.zoomOutButton.removeAttribute("disabled"),(n.disabled||l.getZoom()<=l.getMinZoom())&&n.zoomOutButton.setAttribute("disabled","true"),n.controlOption.showZoom&&n.zoomNumDiv&&(n.zoomNumDiv.innerText=String(Math.floor(l.getZoom()))),(n.disabled||l.getZoom()>=l.getMaxZoom())&&n.zoomInButton.setAttribute("disabled","true")}),n}return(0,V.Z)(t,[{key:"getDefault",value:function(i){return(0,H.Z)((0,H.Z)({},Ra((0,be.Z)(t.prototype),"getDefault",this).call(this,i)),{},{position:_r.BOTTOMRIGHT,name:"zoom",zoomInText:Hh("l7-icon-enlarge"),zoomInTitle:"Zoom in",zoomOutText:Hh("l7-icon-narrow"),zoomOutTitle:"Zoom out",showZoom:!1})}},{key:"setOptions",value:function(i){Ra((0,be.Z)(t.prototype),"setOptions",this).call(this,i),this.checkUpdateOption(i,["zoomInText","zoomInTitle","zoomOutText","zoomOutTitle","showZoom"])&&this.resetButtonGroup(this.container)}},{key:"onAdd",value:function(){var i=Ji("div","l7-control-zoom");return this.resetButtonGroup(i),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),i}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"resetButtonGroup",value:function(i){ca(i),this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,"l7-button-control",i,this.zoomIn),this.controlOption.showZoom&&(this.zoomNumDiv=this.createButton("0","","l7-button-control l7-control-zoom__number",i)),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,"l7-button-control",i,this.zoomOut),this.updateDisabled()}},{key:"createButton",value:function(i,o,s,l,f){var v=Ji("button",s,l);return typeof i=="string"?v.innerHTML=i:v.append(i),v.title=o,f&&v.addEventListener("click",f),v}}]),t}(uv);function vw(e){var r=mw();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function mw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var r1=function(e){(0,De.Z)(t,e);var r=vw(t);function t(n){var i;(0,q.Z)(this,t),i=r.call(this),(0,B.Z)((0,Ie.Z)(i),"isShow",!0),(0,B.Z)((0,Ie.Z)(i),"onMouseMove",function(s){var l,f=i.mapsService.getMapContainer(),v=(l=f==null?void 0:f.getBoundingClientRect())!==null&&l!==void 0?l:{},y=v.left,b=y===void 0?0:y,T=v.top,M=T===void 0?0:T;i.setPopupPosition(s.clientX-b,s.clientY-M)}),(0,B.Z)((0,Ie.Z)(i),"updateLngLatPosition",function(){if(!(!i.mapsService||i.popupOption.followCursor)){var s=i.lngLat,l=s.lng,f=s.lat,v=i.mapsService.lngLatToContainer([l,f]),y=v.x,b=v.y;i.setPopupPosition(y,b)}}),(0,B.Z)((0,Ie.Z)(i),"onKeyDown",function(s){s.keyCode===27&&i.remove()}),(0,B.Z)((0,Ie.Z)(i),"onCloseButtonClick",function(s){s.stopPropagation&&s.stopPropagation(),i.hide()}),(0,B.Z)((0,Ie.Z)(i),"update",function(){var s=!!i.lngLat,l=i.popupOption,f=l.className,v=l.style,y=l.maxWidth,b=l.anchor,T=l.stopPropagation;if(!(!i.mapsService||!s||!i.content)){var M=i.mapsService.getMarkerContainer();if(!i.container&&M&&(i.container=Ji("div","l7-popup ".concat(f!=null?f:""," ").concat(i.isShow?"":"l7-popup-hide"),M),v&&i.container.setAttribute("style",v),i.tip=Ji("div","l7-popup-tip",i.container),i.container.appendChild(i.content),T&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function($){i.container.addEventListener($,function(G){G.stopPropagation()})}),i.container.style.whiteSpace="nowrap"),i.updateLngLatPosition(),ku(i.container,"".concat(Aa[b])),$l(i.container,b,"popup"),y){var O=i.container.getBoundingClientRect(),k=O.width;k>parseFloat(y)&&(i.container.style.width=y)}else i.container.style.removeProperty("width")}}),i.popupOption=(0,H.Z)((0,H.Z)({},i.getDefault(n!=null?n:{})),n);var o=i.popupOption.lngLat;return o&&(i.lngLat=o),i}return(0,V.Z)(t,[{key:"lngLat",get:function(){var i;return(i=this.popupOption.lngLat)!==null&&i!==void 0?i:{lng:0,lat:0}},set:function(i){this.popupOption.lngLat=i}},{key:"getIsShow",value:function(){return this.isShow}},{key:"addTo",value:function(i){this.mapsService=i.get(tt.IMapService),this.sceneService=i.get(tt.ISceneService),this.layerService=i.get(tt.ILayerService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=i,this.update(),this.updateCloseOnClick(),this.updateCloseOnEsc(),this.updateFollowCursor();var o=this.popupOption,s=o.html,l=o.text,f=o.title;return s?this.setHTML(s):l&&this.setText(l),f&&this.setTitle(f),this.emit("open"),this}},{key:"remove",value:function(){if(this!==null&&this!==void 0&&this.isOpen())return this.content&&Ci(this.content),this.container&&(Ci(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.updateCloseOnClick(!0),this.updateCloseOnEsc(!0),this.updateFollowCursor(!0),delete this.mapsService),this.emit("close"),this}},{key:"getOptions",value:function(){return this.popupOption}},{key:"setOptions",value:function(i){return this.show(),this.popupOption=(0,H.Z)((0,H.Z)({},this.popupOption),i),this.checkUpdateOption(i,["html","text","title","closeButton","closeButtonOffsets","maxWidth","anchor","stopPropagation","className","style","lngLat","offsets"])&&(this.container&&(Ci(this.container),this.container=void 0),this.popupOption.html?this.setHTML(this.popupOption.html):this.popupOption.text&&this.setText(this.popupOption.text),this.popupOption.title&&this.setTitle(this.popupOption.title)),this.checkUpdateOption(i,["closeOnEsc"])&&this.updateCloseOnEsc(),this.checkUpdateOption(i,["closeOnClick"])&&this.updateCloseOnClick(),this.checkUpdateOption(i,["followCursor"])&&this.updateFollowCursor(),this.checkUpdateOption(i,["html"])&&i.html?this.setHTML(i.html):this.checkUpdateOption(i,["text"])&&i.text&&this.setText(i.text),this.checkUpdateOption(i,["lngLat"])&&i.lngLat&&this.setLnglat(i.lngLat),this}},{key:"open",value:function(){return this.addTo(this.scene),this}},{key:"close",value:function(){return this.remove(),this}},{key:"show",value:function(){if(!this.isShow)return this.container&&Du(this.container,"l7-popup-hide"),this.isShow=!0,this.emit("show"),this}},{key:"hide",value:function(){if(this.isShow)return this.container&&fu(this.container,"l7-popup-hide"),this.isShow=!1,this.emit("hide"),this}},{key:"setHTML",value:function(i){return this.popupOption.html=i,this.setDOMContent(i)}},{key:"setText",value:function(i){return this.popupOption.text=i,this.setDOMContent(window.document.createTextNode(i))}},{key:"setTitle",value:function(i){this.show(),this.popupOption.title=i,i?(this.contentTitle||(this.contentTitle=Ji("div","l7-popup-content__title"),this.content.firstChild?this.content.insertBefore(this.contentTitle,this.content.firstChild):this.content.append(this.contentTitle)),ca(this.contentTitle),np(this.contentTitle,i)):this.contentTitle&&(Ci(this.contentTitle),this.contentTitle=void 0)}},{key:"panToPopup",value:function(){var i=this.lngLat,o=i.lng,s=i.lat;return this.popupOption.autoPan&&this.mapsService.panTo([o,s]),this}},{key:"setLngLat",value:function(i){return this.setLnglat(i)}},{key:"setLnglat",value:function(i){var o=this;return this.show(),this.lngLat=i,Array.isArray(i)&&(this.lngLat={lng:i[0],lat:i[1]}),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this.popupOption.autoPan&&setTimeout(function(){o.panToPopup()},0),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setMaxWidth",value:function(i){return this.popupOption.maxWidth=i,this.update(),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"getDefault",value:function(i){return{closeButton:!0,closeOnClick:!1,maxWidth:"240px",offsets:[0,0],anchor:ma.BOTTOM,stopPropagation:!0,autoPan:!1,autoClose:!0,closeOnEsc:!1,followCursor:!1}}},{key:"setDOMContent",value:function(i){return this.show(),this.createContent(),np(this.contentPanel,i),this.update(),this}},{key:"updateCloseOnClick",value:function(i){var o=this,s=this.mapsService;s&&(s==null||s.off("click",this.onCloseButtonClick),this.popupOption.closeOnClick&&!i&&requestAnimationFrame(function(){s==null||s.on("click",o.onCloseButtonClick)}))}},{key:"updateCloseOnEsc",value:function(i){window.removeEventListener("keydown",this.onKeyDown),this.popupOption.closeOnEsc&&!i&&window.addEventListener("keydown",this.onKeyDown)}},{key:"updateFollowCursor",value:function(i){var o,s=(o=this.mapsService)===null||o===void 0?void 0:o.getContainer();s&&(s==null||s.removeEventListener("mousemove",this.onMouseMove),this.popupOption.followCursor&&!i&&(s==null||s.addEventListener("mousemove",this.onMouseMove)))}},{key:"createContent",value:function(){var i=this;if(this.content&&Ci(this.content),this.contentTitle=void 0,this.content=Ji("div","l7-popup-content",this.container),this.setTitle(this.popupOption.title),this.popupOption.closeButton){var o=Hh("l7-icon-guanbi");fu(o,"l7-popup-close-button"),this.content.appendChild(o),this.popupOption.closeButtonOffsets&&(o.style.right=this.popupOption.closeButtonOffsets[0]+"px",o.style.top=this.popupOption.closeButtonOffsets[1]+"px"),o.setAttribute("aria-label","Close popup"),o.addEventListener("click",function(){i.hide()}),o.addEventListener("pointerup",function(s){s.stopPropagation()}),o.addEventListener("pointerdown",function(s){s.stopPropagation()}),this.closeButton=o}else this.closeButton=void 0;this.contentPanel=Ji("div","l7-popup-content__panel",this.content)}},{key:"setPopupPosition",value:function(i,o){if(this.container){var s=this.popupOption.offsets;this.container.style.left=i+s[0]+"px",this.container.style.top=o-s[1]+"px"}}},{key:"checkUpdateOption",value:function(i,o){return o.some(function(s){return s in i})}}]),t}(no.EventEmitter);function uL(e){var r=gw();return function(){var n=_getPrototypeOf(e),i;if(r){var o=_getPrototypeOf(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return _possibleConstructorReturn(this,i)}}function gw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var lL=ii.get,cL=null;function _w(e,r){var t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(t||n)&&(r||(r=document),!!r)){var i=r.head||r.getElementsByTagName("head")[0];if(!i){i=r.createElement("head");var o=r.body||r.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):r.documentElement.appendChild(i)}var s=r.createElement("style");return s.type="text/css",s.styleSheet?s.styleSheet.cssText=e:s.appendChild(r.createTextNode(e)),i.appendChild(s),s}}_w(`.l7-marker-container {
  position: absolute;
  width: 100%;
  height: 100%;
  overflow: hidden;
}
.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}
.l7-marker-cluster {
  width: 40px;
  height: 40px;
  background-color: rgba(181, 226, 140, 0.6);
  background-clip: padding-box;
  border-radius: 20px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-top: 5px;
  margin-left: 5px;
  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  text-align: center;
  background-color: rgba(110, 204, 57, 0.6);
  border-radius: 15px;
}
.l7-marker-cluster span {
  line-height: 30px;
}
.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  -webkit-box-shadow: none;
          box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  background-clip: padding-box;
  border: 2px solid rgba(0, 0, 0, 0.2);
}
.mapboxgl-ctrl-logo,
.amap-logo {
  display: none !important;
}
.l7-select-box {
  border: 3px dashed gray;
  border-radius: 2px;
  position: absolute;
  z-index: 999;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
}
.l7-control-container {
  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
.l7-control-container .l7-control {
  position: relative;
  z-index: 999;
  float: left;
  clear: both;
  color: #595959;
  font-size: 12px;
  pointer-events: visiblePainted;
  /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control-container .l7-control.l7-control--hide {
  display: none;
}
.l7-control-container .l7-top {
  top: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-top .l7-control:not(.l7-control--hide) {
  margin-top: 8px;
}
.l7-control-container .l7-right {
  right: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-right .l7-control:not(.l7-control--hide) {
  margin-right: 8px;
}
.l7-control-container .l7-bottom {
  bottom: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-bottom .l7-control:not(.l7-control--hide) {
  margin-bottom: 8px;
}
.l7-control-container .l7-left {
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-left .l7-control:not(.l7-control--hide) {
  margin-left: 8px;
}
.l7-control-container .l7-center {
  position: absolute;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
}
.l7-control-container .l7-center.l7-top,
.l7-control-container .l7-center.l7-bottom {
  width: 100%;
}
.l7-control-container .l7-center.l7-left,
.l7-control-container .l7-center.l7-right {
  height: 100%;
}
.l7-control-container .l7-center .l7-control {
  margin-right: 8px;
  margin-bottom: 8px;
}
.l7-control-container .l7-row {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}
.l7-control-container .l7-row.l7-top {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-control-container .l7-row.l7-bottom {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-control-container .l7-column {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-control-container .l7-column.l7-left {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-control-container .l7-column.l7-right {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-button-control {
  min-width: 28px;
  height: 28px;
  background-color: #fff;
  border-width: 0;
  border-radius: 2px;
  outline: 0;
  cursor: pointer;
  -webkit-transition: all 0.2s;
  transition: all 0.2s;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  padding: 0 6px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
  line-height: 16px;
}
.l7-button-control .l7-iconfont {
  fill: #595959;
  color: #595959;
  width: 16px;
  height: 16px;
}
.l7-button-control.l7-button-control--row {
  padding: 0 16px 0 13px;
}
.l7-button-control.l7-button-control--row * + .l7-button-control__text {
  margin-left: 8px;
}
.l7-button-control.l7-button-control--column {
  height: 44px;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-button-control.l7-button-control--column .l7-iconfont {
  margin-top: 3px;
}
.l7-button-control.l7-button-control--column .l7-button-control__text {
  margin-top: 3px;
  font-size: 10px;
  -webkit-transform: scale(0.83333);
          transform: scale(0.83333);
}
.l7-button-control:not(:disabled):hover {
  background-color: #f3f3f3;
}
.l7-button-control:not(:disabled):active {
  background-color: #f3f3f3;
}
.l7-button-control:disabled {
  background-color: #fafafa;
  color: #bdbdbd;
  cursor: not-allowed;
}
.l7-button-control:disabled .l7-iconfont {
  fill: #bdbdbd;
  color: #bdbdbd;
}
.l7-button-control:disabled:hover {
  background-color: #fafafa;
}
.l7-button-control:disabled:active {
  background-color: #fafafa;
}
.l7-popper {
  position: absolute;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  z-index: 5;
  color: #595959;
}
.l7-popper.l7-popper-hide {
  display: none;
}
.l7-popper .l7-popper-content {
  min-height: 28px;
  background: #fff;
  border-radius: 2px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-popper .l7-popper-arrow {
  width: 0;
  height: 0;
  border-width: 4px;
  border-style: solid;
  border-top-color: transparent;
  border-bottom-color: transparent;
  border-left-color: transparent;
  border-right-color: transparent;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-popper.l7-popper-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}
.l7-popper.l7-popper-left .l7-popper-arrow {
  border-left-color: #fff;
  margin: 10px 0;
}
.l7-popper.l7-popper-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popper.l7-popper-right .l7-popper-arrow {
  border-right-color: #fff;
  margin: 10px 0;
}
.l7-popper.l7-popper-top {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-popper.l7-popper-top .l7-popper-arrow {
  border-top-color: #fff;
  margin: 0 10px;
}
.l7-popper.l7-popper-bottom {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}
.l7-popper.l7-popper-bottom .l7-popper-arrow {
  border-bottom-color: #fff;
  margin: 0 10px;
}
.l7-popper.l7-popper-start {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-popper.l7-popper-end {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-select-control--normal {
  padding: 4px 0;
}
.l7-select-control--normal .l7-select-control-item {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  height: 24px;
  padding: 0 16px;
  font-size: 12px;
  line-height: 24px;
}
.l7-select-control--normal .l7-select-control-item > * + * {
  margin-left: 6px;
}
.l7-select-control--normal .l7-select-control-item input[type='checkbox'] {
  width: 14px;
  height: 14px;
}
.l7-select-control--normal .l7-select-control-item:hover {
  background-color: #f3f3f3;
}
.l7-select-control--image {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -ms-flex-wrap: wrap;
      flex-wrap: wrap;
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
  -webkit-box-sizing: content-box;
          box-sizing: content-box;
  max-width: 460px;
  max-height: 400px;
  margin: 12px 0 0 12px;
  overflow-x: hidden;
  overflow-y: auto;
}
.l7-select-control--image .l7-select-control-item {
  position: relative;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-flex: 0;
      -ms-flex: 0 0 calc((100% - (12px + 9px) * 2) / 3);
          flex: 0 0 calc((100% - (12px + 9px) * 2) / 3);
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  -webkit-box-sizing: content-box;
          box-sizing: content-box;
  margin-right: 12px;
  margin-bottom: 12px;
  overflow: hidden;
  font-size: 12px;
  border: 1px solid #fff;
  border-radius: 2px;
}
.l7-select-control--image .l7-select-control-item img {
  width: 100%;
  height: 80px;
}
.l7-select-control--image .l7-select-control-item input[type='checkbox'] {
  position: absolute;
  top: 0;
  right: 0;
}
.l7-select-control--image .l7-select-control-item .l7-select-control-item-row {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  line-height: 26px;
}
.l7-select-control--image .l7-select-control-item .l7-select-control-item-row > * + * {
  margin-left: 8px;
}
.l7-select-control--image .l7-select-control-item.l7-select-control-item-active {
  border-color: #0370fe;
}
.l7-select-control-item {
  cursor: pointer;
}
.l7-select-control-item input[type='checkbox'] {
  margin: 0;
  cursor: pointer;
}
.l7-select-control--multiple .l7-select-control-item:hover {
  background-color: transparent;
}
.l7-control-logo {
  width: 89px;
  height: 16px;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}
.l7-control-logo img {
  height: 100%;
  width: 100%;
}
.l7-control-logo .l7-control-logo-link {
  display: block;
  cursor: pointer;
}
.l7-control-logo .l7-control-logo-link img {
  cursor: pointer;
}
.l7-control-mouse-location {
  background-color: #fff;
  border-radius: 2px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
  padding: 2px 4px;
  min-width: 130px;
}
.l7-control-zoom {
  overflow: hidden;
  border-radius: 2px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-control-zoom .l7-button-control {
  font-size: 16px;
  border-bottom: 1px solid #f0f0f0;
  border-radius: 0;
  -webkit-box-shadow: 0 0 0;
          box-shadow: 0 0 0;
}
.l7-control-zoom .l7-button-control .l7-iconfont {
  width: 14px;
  height: 14px;
}
.l7-control-zoom .l7-button-control:last-child {
  border-bottom: 0;
}
.l7-control-zoom .l7-control-zoom__number {
  color: #595959;
  padding: 0;
}
.l7-control-zoom .l7-control-zoom__number:hover {
  background-color: #fff;
}
.l7-control-scale {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-control-scale .l7-control-scale-line {
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
  padding: 2px 5px 1px;
  overflow: hidden;
  color: #595959;
  font-size: 10px;
  line-height: 1.1;
  white-space: nowrap;
  background: #fff;
  border: 2px solid #000;
  border-top: 0;
  -webkit-transition: width 0.1s;
  transition: width 0.1s;
}
.l7-control-scale .l7-control-scale-line + .l7-control-scale .l7-control-scale-line {
  margin-top: -2px;
  border-top: 2px solid #777;
  border-bottom: none;
}
.l7-right .l7-control-scale {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-right .l7-control-scale .l7-control-scale-line {
  text-align: right;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  z-index: 5;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
}
.l7-popup.l7-popup-hide {
  display: none;
}
.l7-popup .l7-popup-content {
  position: relative;
  padding: 16px;
  font-size: 14px;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}
.l7-popup .l7-popup-content .l7-popup-content__title {
  margin-bottom: 8px;
  font-weight: bold;
}
.l7-popup .l7-popup-content .l7-popup-close-button,
.l7-popup .l7-popup-content .l7-popup-content__title,
.l7-popup .l7-popup-content .l7-popup-content__panel {
  white-space: normal;
  -webkit-user-select: text;
     -moz-user-select: text;
      -ms-user-select: text;
          user-select: text;
  pointer-events: initial;
}
.l7-popup .l7-popup-content .l7-popup-close-button {
  position: absolute;
  top: 0;
  right: 0;
  width: 18px;
  height: 18px;
  padding: 0;
  font-size: 14px;
  line-height: 18px;
  text-align: center;
  background-color: transparent;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
}
.l7-popup .l7-popup-tip {
  position: relative;
  z-index: 1;
  width: 0;
  height: 0;
  border: 10px solid transparent;
}
.l7-popup.l7-popup-anchor-bottom,
.l7-popup.l7-popup-anchor-bottom-left,
.l7-popup.l7-popup-anchor-bottom-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}
.l7-popup.l7-popup-anchor-bottom .l7-popup-tip,
.l7-popup.l7-popup-anchor-bottom-left .l7-popup-tip,
.l7-popup.l7-popup-anchor-bottom-right .l7-popup-tip {
  bottom: 1px;
}
.l7-popup.l7-popup-anchor-top,
.l7-popup.l7-popup-anchor-top-left,
.l7-popup.l7-popup-anchor-top-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-popup.l7-popup-anchor-top .l7-popup-tip,
.l7-popup.l7-popup-anchor-top-left .l7-popup-tip,
.l7-popup.l7-popup-anchor-top-right .l7-popup-tip {
  top: 1px;
}
.l7-popup.l7-popup-anchor-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}
.l7-popup.l7-popup-anchor-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popup-anchor-top .l7-popup-tip {
  position: relative;
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}
.l7-popup-anchor-top-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top: none;
  border-bottom-color: #fff;
  border-left: none;
}
.l7-popup-anchor-top-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}
.l7-popup-anchor-bottom .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top-color: #fff;
  border-bottom: none;
}
.l7-popup-anchor-bottom-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top-color: #fff;
  border-bottom: none;
  border-left: none;
}
.l7-popup-anchor-bottom-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top-color: #fff;
  border-right: none;
  border-bottom: none;
}
.l7-popup-anchor-left .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right-color: #fff;
  border-left: none;
}
.l7-popup-anchor-right .l7-popup-tip {
  right: 1px;
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right: none;
  border-left-color: #fff;
}
.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}
.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}
.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}
.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}
.l7-popup-track-pointer {
  display: none;
}
.l7-popup-track-pointer * {
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
  pointer-events: none;
}
.l7-map:hover .l7-popup-track-pointer {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}
.l7-map:active .l7-popup-track-pointer {
  display: none;
}
.l7-layer-popup__row {
  font-size: 12px;
}
.l7-layer-popup__row + .l7-layer-popup__row {
  margin-top: 4px;
}
`);var Mp,n1=(Mp={},(0,B.Z)(Mp,zs.additive,{enable:!0,func:{srcRGB:R.ONE,dstRGB:R.ONE,srcAlpha:1,dstAlpha:1}}),(0,B.Z)(Mp,zs.none,{enable:!1}),(0,B.Z)(Mp,zs.normal,{enable:!0,func:{srcRGB:R.SRC_ALPHA,dstRGB:R.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,B.Z)(Mp,zs.subtractive,{enable:!0,func:{srcRGB:R.ONE,dstRGB:R.ONE,srcAlpha:R.ZERO,dstAlpha:R.ONE_MINUS_SRC_COLOR},equation:{rgb:R.FUNC_SUBTRACT,alpha:R.FUNC_SUBTRACT}}),(0,B.Z)(Mp,zs.max,{enable:!0,func:{srcRGB:R.ONE,dstRGB:R.ONE},equation:{rgb:R.MAX_EXT}}),(0,B.Z)(Mp,zs.min,{enable:!0,func:{srcRGB:R.ONE,dstRGB:R.ONE},equation:{rgb:R.MIN_EXT}}),Mp);function i1(e){return e.map(function(r){return typeof r=="string"&&(r=[r,{}]),r})}function a1(e,r,t,n){var i=e.multiPassRenderer,o=e.getLayerConfig(),s=o.enableTAA;return s?i.add(n("taa")):i.add(n("render")),i1(r).forEach(function(l){var f=(0,yn.Z)(l,2),v=f[0],y=f[1];i.add(t(v),y)}),i.add(t("copy")),i}var yw=function(){function e(r){(0,q.Z)(this,e),this.layer=r}return(0,V.Z)(e,[{key:"pickRender",value:function(t){var n=this.layer.getContainer(),i=n.get(tt.ILayerService),o=this.layer;if(o.tileLayer)return o.tileLayer.pickRender(t);o.hooks.beforePickingEncode.call(),i.renderTileLayerMask(o),o.renderModels({ispick:!0}),o.hooks.afterPickingEncode.call()}},{key:"pick",value:function(t,n){var i=this.layer.getContainer(),o=i.get(tt.IPickingService);return t.type==="RasterLayer"?this.pickRasterLayer(t,n):(this.pickRender(n),o.pickFromPickingFBO(t,n))}},{key:"pickRasterLayer",value:function(t,n,i){var o=this.layer.getContainer(),s=o.get(tt.IPickingService),l=o.get(tt.IMapService),f=this.layer.getSource().extent,v=yh(n.lngLat,f),y={x:n.x,y:n.y,type:n.type,lngLat:n.lngLat,target:n,rasterValue:null},b=i||t;if(v){var T=this.readRasterValue(t,f,l,n.x,n.y);return y.rasterValue=T,s.triggerHoverOnLayer(b,y),!0}else return y.type=n.type==="mousemove"?"mouseout":"un"+n.type,s.triggerHoverOnLayer(b,(0,H.Z)((0,H.Z)({},y),{},{type:"unpick"})),s.triggerHoverOnLayer(b,y),!1}},{key:"readRasterValue",value:function(t,n,i,o,s){var l=t.getSource().data.dataArray[0],f=(0,yn.Z)(n,4),v=f[0],y=v===void 0?0:v,b=f[1],T=b===void 0?0:b,M=f[2],O=M===void 0?10:M,k=f[3],$=k===void 0?-10:k,G=i.lngLatToContainer([y,T]),oe=i.lngLatToContainer([O,$]),ye=oe.x-G.x,Le=G.y-oe.y,$e=[(o-G.x)/ye,(s-oe.y)/Le],ut=l.width||1,vt=l.height||1,Rt=Math.floor($e[0]*ut),Jt=Math.floor($e[1]*vt),Mr=Math.max(0,Jt-1)*ut+Rt,br=l.data[Mr];return br}},{key:"selectFeature",value:function(t){var n=this.layer,i=(0,yn.Z)(t,3),o=i[0],s=i[1],l=i[2];n.hooks.beforeSelect.call([o,s,l])}},{key:"highlightPickedFeature",value:function(t){var n=(0,yn.Z)(t,3),i=n[0],o=n[1],s=n[2];this.layer.hooks.beforeHighlight.call([i,o,s])}},{key:"getFeatureById",value:function(t){return this.layer.getSource().getFeatureById(t)}}]),e}(),xw=function(){function e(r){(0,q.Z)(this,e),this.layer=r;var t=this.layer.getContainer();this.rendererService=t.get(tt.IRendererService)}return(0,V.Z)(e,[{key:"getColorTexture",value:function(t,n){var i=this.getTextureKey(t,n);return this.key===i?this.colorTexture:(this.createColorTexture(t,n),this.key=i,this.colorTexture)}},{key:"createColorTexture",value:function(t,n){var i=this.rendererService.createTexture2D,o=this.getColorRampBar(t,n),s=i({data:new Uint8Array(o.data),width:o.width,height:o.height,flipY:!1});return this.colorTexture=s,s}},{key:"setColorTexture",value:function(t,n,i){this.key=this.getTextureKey(n,i),this.colorTexture=t}},{key:"destroy",value:function(){var t;(t=this.colorTexture)===null||t===void 0||t.destroy()}},{key:"getColorRampBar",value:function(t,n){switch(t.type){case"cat":return $o(t);case"quantize":return Vo(t);case"custom":return Ru(t,n);case"linear":return ha(t,n);default:return So(t)}}},{key:"getTextureKey",value:function(t,n){var i;return"".concat(t.colors.join("_"),"_").concat(t==null||(i=t.positions)===null||i===void 0?void 0:i.join("_"),"_").concat(t.type,"_").concat(n==null?void 0:n.join("_"))}}]),e}(),bw=["passes"],Ew=["moduleName","vertexShader","fragmentShader","inject","triangulation","styleOption"],o1,N0,s1;function Sw(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Aw(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var v=t.next();return o=v.done,v},e:function(v){s=!0,l=v},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function Aw(e,r){if(e){if(typeof e=="string")return u1(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return u1(e,r)}}function u1(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function Tw(e){var r=ww();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function ww(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var U0=ii.isEqual,l1=ii.isFunction,c1=ii.isNumber,Su=ii.isObject,Cw=ii.isPlainObject,Rw=ii.isUndefined,f1=0,Ip=(o1=k0(tt.IGlobalConfigService),N0=function(e){(0,De.Z)(t,e);var r=Tw(t);function t(){var n,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,q.Z)(this,t),n=r.call(this),(0,B.Z)((0,Ie.Z)(n),"id","".concat(f1++)),(0,B.Z)((0,Ie.Z)(n),"name","".concat(f1)),(0,B.Z)((0,Ie.Z)(n),"visible",!0),(0,B.Z)((0,Ie.Z)(n),"zIndex",0),(0,B.Z)((0,Ie.Z)(n),"inited",!1),(0,B.Z)((0,Ie.Z)(n),"layerModelNeedUpdate",!1),(0,B.Z)((0,Ie.Z)(n),"pickedFeatureID",null),(0,B.Z)((0,Ie.Z)(n),"selectedFeatureID",null),(0,B.Z)((0,Ie.Z)(n),"styleNeedUpdate",!1),(0,B.Z)((0,Ie.Z)(n),"forceRender",!1),(0,B.Z)((0,Ie.Z)(n),"clusterZoom",0),(0,B.Z)((0,Ie.Z)(n),"defaultSourceConfig",{data:[],options:{parser:{type:"json"}}}),(0,B.Z)((0,Ie.Z)(n),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,B.Z)((0,Ie.Z)(n),"hooks",{init:new A0,afterInit:new fo,beforeRender:new fo,beforeRenderData:new ah,afterRender:new xu,beforePickingEncode:new xu,afterPickingEncode:new xu,beforeHighlight:new xu(["pickedColor"]),afterHighlight:new xu,beforeSelect:new xu(["pickedColor"]),afterSelect:new xu,beforeDestroy:new xu,afterDestroy:new xu}),(0,B.Z)((0,Ie.Z)(n),"models",[]),(0,B.Z)((0,Ie.Z)(n),"startInit",!1),(0,B.Z)((0,Ie.Z)(n),"layerChildren",[]),(0,B.Z)((0,Ie.Z)(n),"masks",[]),Fi((0,Ie.Z)(n),"configService",s1,(0,Ie.Z)(n)),(0,B.Z)((0,Ie.Z)(n),"animateOptions",{enable:!1}),(0,B.Z)((0,Ie.Z)(n),"currentPickId",null),(0,B.Z)((0,Ie.Z)(n),"encodeStyleAttribute",{}),(0,B.Z)((0,Ie.Z)(n),"enableShaderEncodeStyles",[]),(0,B.Z)((0,Ie.Z)(n),"enableDataEncodeStyles",[]),(0,B.Z)((0,Ie.Z)(n),"enablg",[]),(0,B.Z)((0,Ie.Z)(n),"pendingStyleAttributes",[]),(0,B.Z)((0,Ie.Z)(n),"scaleOptions",{}),(0,B.Z)((0,Ie.Z)(n),"animateStatus",!1),(0,B.Z)((0,Ie.Z)(n),"isDestroyed",!1),(0,B.Z)((0,Ie.Z)(n),"encodeDataLength",0),(0,B.Z)((0,Ie.Z)(n),"sourceEvent",function(){n.dataState.dataSourceNeedUpdate=!0;var o=n.getLayerConfig();o&&o.autoFit&&n.fitBounds(o.fitBoundsOptions);var s=n.layerSource.getSourceCfg().autoRender;s&&setTimeout(function(){n.reRender()},10)}),n.name=i.name||n.id,n.zIndex=i.zIndex||0,n.rawConfig=i,n}return(0,V.Z)(t,[{key:"addMask",value:function(i){this.masks.push(i),this.enableMask()}},{key:"removeMask",value:function(i){var o=this.masks.indexOf(i);o>-1&&this.masks.splice(o,1)}},{key:"disableMask",value:function(){this.updateLayerConfig({enableMask:!1})}},{key:"enableMask",value:function(){this.updateLayerConfig({enableMask:!0})}},{key:"addMaskLayer",value:function(i){this.masks.push(i)}},{key:"removeMaskLayer",value:function(i){var o=this.masks.indexOf(i);o>-1&&this.masks.splice(o,1),i.destroy()}},{key:"getAttribute",value:function(i){return this.styleAttributeService.getLayerStyleAttribute(i)}},{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(i){var o=this;if(Object.keys(i).map(function(l){l in o.rawConfig&&(o.rawConfig[l]=i[l])}),!this.startInit)this.needUpdateConfig=(0,H.Z)((0,H.Z)({},this.needUpdateConfig),i);else{var s=this.container.get(tt.SceneID);this.configService.setLayerConfig(s,this.id,(0,H.Z)((0,H.Z)((0,H.Z)({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),i)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(i,o){this.container=i,this.sceneContainer=o}},{key:"getContainer",value:function(){return this.container}},{key:"addPlugin",value:function(i){return this.plugins.push(i),this}},{key:"init",value:function(){var n=(0,Ct.Z)(me().mark(function o(){var s=this,l,f,v,y,b,T,M;return me().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:l=this.container.get(tt.SceneID),this.startInit=!0,this.configService.setLayerConfig(l,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.iconService=this.container.get(tt.IIconService),this.fontService=this.container.get(tt.IFontService),this.rendererService=this.container.get(tt.IRendererService),this.layerService=this.container.get(tt.ILayerService),this.debugService=this.container.get(tt.IDebugService),this.interactionService=this.container.get(tt.IInteractionService),this.pickingService=this.container.get(tt.IPickingService),this.mapService=this.container.get(tt.IMapService),f=this.getLayerConfig(),v=f.enableMultiPassRenderer,y=f.passes,v&&y!==null&&y!==void 0&&y.length&&y.length>0&&this.mapService.on("mapAfterFrameChange",function(){s.renderLayers()}),this.cameraService=this.container.get(tt.ICameraService),this.coordinateService=this.container.get(tt.ICoordinateSystemService),this.shaderModuleService=this.container.get(tt.IShaderModuleService),this.postProcessingPassFactory=this.container.get(tt.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(tt.IFactoryNormalPass),this.styleAttributeService=this.container.get(tt.IStyleAttributeService),v&&(this.multiPassRenderer=this.container.get(tt.IMultiPassRenderer),this.multiPassRenderer.setLayer(this)),this.pendingStyleAttributes.forEach(function($){var G=$.attributeName,oe=$.attributeField,ye=$.attributeValues,Le=$.updateOptions;s.styleAttributeService.updateStyleAttribute(G,{scale:(0,H.Z)({field:oe},s.splitValuesAndCallbackInAttribute(ye,oe?void 0:s.getLayerConfig()[G]))},Le)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(tt.ILayerPlugin),b=Sw(this.plugins);try{for(b.s();!(T=b.n()).done;)M=T.value,M.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}catch($){b.e($)}finally{b.f()}return this.layerPickService=new yw(this),this.textureService=new xw(this),this.log(Rs.LayerInitStart),k.next=31,this.hooks.init.promise();case 31:this.log(Rs.LayerInitEnd),this.inited=!0,this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this.hooks.afterInit.call();case 36:case"end":return k.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"log",value:function(i){var o,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"init";if(!(this.tileLayer||this.isTileLayer)){var l="".concat(this.id,".").concat(s,".").concat(i),f={id:this.id,type:this.type};(o=this.debugService)===null||o===void 0||o.log(l,f)}}},{key:"updateModelData",value:function(i){i.attributes&&i.elements?this.models.map(function(o){o.updateAttributesAndElements(i.attributes,i.elements)}):console.warn("data error")}},{key:"setLayerPickService",value:function(i){this.layerPickService=i}},{key:"prepareBuildModel",value:function(){Object.keys(this.needUpdateConfig||{}).length!==0&&this.updateLayerConfig({});var i=this.getLayerConfig(),o=i.animateOption;o!=null&&o.enable&&(this.layerService.startAnimate(),this.animateStatus=!0)}},{key:"color",value:function(i,o,s){return this.updateStyleAttribute("color",i,o,s),this}},{key:"texture",value:function(i,o,s){return this.updateStyleAttribute("texture",i,o,s),this}},{key:"rotate",value:function(i,o,s){return this.updateStyleAttribute("rotate",i,o,s),this}},{key:"size",value:function(i,o,s){return this.updateStyleAttribute("size",i,o,s),this}},{key:"filter",value:function(i,o,s){var l=this.updateStyleAttribute("filter",i,o,s);return this.dataState.dataSourceNeedUpdate=l&&this.inited,this}},{key:"shape",value:function(i,o,s){this.shapeOption={field:i,values:o};var l=this.updateStyleAttribute("shape",i,o,s);return this.dataState.dataSourceNeedUpdate=l&&this.inited,this}},{key:"label",value:function(i,o,s){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:i,attributeValues:o,updateOptions:s}),this}},{key:"animate",value:function(i){var o={};return Su(i)?(o.enable=!0,o=(0,H.Z)((0,H.Z)({},o),i)):o.enable=i,this.updateLayerConfig({animateOption:o}),this}},{key:"source",value:function(i,o){return(i==null?void 0:i.type)==="source"?(this.setSource(i),this):(this.sourceOption={data:i,options:o},this.clusterZoom=0,this)}},{key:"setData",value:function(i,o){var s=this;return this.inited?(this.log(Rs.SourceInitStart,ds.UPDATE),this.layerSource.setData(i,o),this.log(Rs.SourceInitEnd,ds.UPDATE)):this.on("inited",function(){s.log(Rs.SourceInitStart,ds.UPDATE);var l=s.getSource();l?s.layerSource.setData(i,o):s.source(new Xy(i,o)),s.layerSource.once("update",function(){s.log(Rs.SourceInitEnd,ds.UPDATE)})}),this}},{key:"style",value:function(i){var o=this,s=i.passes,l=(0,Fa.Z)(i,bw);s&&i1(s).forEach(function(v){var y=o.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(v[0]);y&&y.updateOptions(v[1])}),l.borderColor&&(l.stroke=l.borderColor),l.borderWidth&&(l.strokeWidth=l.borderWidth);var f=l;return Object.keys(l).forEach(function(v){var y=l[v];Array.isArray(y)&&y.length===2&&!c1(y[0])&&!c1(y[1])&&(f[v]={field:y[0],value:y[1]})}),this.encodeStyle(f),this.updateLayerConfig(f),this}},{key:"encodeStyle",value:function(i){var o=this;Object.keys(i).forEach(function(s){[].concat((0,Wt.Z)(o.enableShaderEncodeStyles),(0,Wt.Z)(o.enableDataEncodeStyles)).includes(s)&&Cw(i[s])&&(i[s].field||i[s].value)&&!U0(o.encodeStyleAttribute[s],i[s])?(o.encodeStyleAttribute[s]=i[s],o.updateStyleAttribute(s,i[s].field,i[s].value),o.inited&&(o.dataState.dataMappingNeedUpdate=!0)):o.encodeStyleAttribute[s]&&(delete o.encodeStyleAttribute[s],o.dataState.dataSourceNeedUpdate=!0)})}},{key:"scale",value:function(i,o){var s=(0,H.Z)({},this.scaleOptions);if(Su(i)?this.scaleOptions=(0,H.Z)((0,H.Z)({},this.scaleOptions),i):this.scaleOptions[i]=o,this.styleAttributeService&&!U0(s,this.scaleOptions)){var l=Su(i)?i:(0,B.Z)({},i,o);this.styleAttributeService.updateScaleAttribute(l)}return this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.reRender(),this.rendering=!1}},{key:"render",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.tileLayer?(this.tileLayer.render(),this):(this.layerService.beforeRenderData(this),this.encodeDataLength<=0&&!this.forceRender?this:(this.renderModels(i),this))}},{key:"renderMultiPass",value:function(){var n=(0,Ct.Z)(me().mark(function o(){return me().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!(this.encodeDataLength<=0&&!this.forceRender)){l.next=2;break}return l.abrupt("return");case 2:if(!(this.multiPassRenderer&&this.multiPassRenderer.getRenderFlag())){l.next=7;break}return l.next=5,this.multiPassRenderer.render();case 5:l.next=8;break;case 7:this.multiPassRenderer?this.renderModels():this.renderModels();case 8:case"end":return l.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"active",value:function(i){var o={};return o.enableHighlight=Su(i)?!0:i,Su(i)?(o.enableHighlight=!0,i.color&&(o.highlightColor=i.color),i.mix&&(o.activeMix=i.mix)):o.enableHighlight=!!i,this.updateLayerConfig(o),this}},{key:"setActive",value:function(i,o){var s=this;if(Su(i)){var l=i.x,f=l===void 0?0:l,v=i.y,y=v===void 0?0:v;this.updateLayerConfig({highlightColor:Su(o)?o.color:this.getLayerConfig().highlightColor,activeMix:Su(o)?o.mix:this.getLayerConfig().activeMix}),this.pick({x:f,y})}else this.updateLayerConfig({pickedFeatureID:i,highlightColor:Su(o)?o.color:this.getLayerConfig().highlightColor,activeMix:Su(o)?o.mix:this.getLayerConfig().activeMix}),this.hooks.beforeHighlight.call(ia(i)).then(function(){setTimeout(function(){s.reRender()},1)})}},{key:"select",value:function(i){var o={};return o.enableSelect=Su(i)?!0:i,Su(i)?(o.enableSelect=!0,i.color&&(o.selectColor=i.color),i.mix&&(o.selectMix=i.mix)):o.enableSelect=!!i,this.updateLayerConfig(o),this}},{key:"setSelect",value:function(i,o){var s=this;if(Su(i)){var l=i.x,f=l===void 0?0:l,v=i.y,y=v===void 0?0:v;this.updateLayerConfig({selectColor:Su(o)?o.color:this.getLayerConfig().selectColor,selectMix:Su(o)?o.mix:this.getLayerConfig().selectMix}),this.pick({x:f,y})}else this.updateLayerConfig({pickedFeatureID:i,selectColor:Su(o)?o.color:this.getLayerConfig().selectColor,selectMix:Su(o)?o.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(ia(i)).then(function(){setTimeout(function(){s.reRender()},1)})}},{key:"setBlend",value:function(i){return this.updateLayerConfig({blend:i}),this.reRender(),this}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this.emit("show"),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this.emit("hide"),this}},{key:"setIndex",value:function(i){return this.zIndex=i,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(i){this.currentPickId=i}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(i){this.selectedFeatureID=i}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var i=this.mapService.getZoom(),o=this.getLayerConfig(),s=o.visible,l=o.minZoom,f=l===void 0?-1/0:l,v=o.maxZoom,y=v===void 0?1/0:v;return!!s&&i>=f&&i<y}},{key:"setMultiPass",value:function(i,o){if(this.updateLayerConfig({enableMultiPassRenderer:i}),o&&this.updateLayerConfig({passes:o}),i){var s=this.getLayerConfig(),l=s.passes,f=l===void 0?[]:l;this.multiPassRenderer=a1(this,f,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);var v=this.rendererService.getViewportSize(),y=v.width,b=v.height;this.multiPassRenderer.resize(y,b)}return this}},{key:"setMinZoom",value:function(i){return this.updateLayerConfig({minZoom:i}),this}},{key:"getMinZoom",value:function(){var i=this.getLayerConfig(),o=i.minZoom;return o}},{key:"getMaxZoom",value:function(){var i=this.getLayerConfig(),o=i.maxZoom;return o}},{key:"get",value:function(i){var o=this.getLayerConfig();return o[i]}},{key:"setMaxZoom",value:function(i){return this.updateLayerConfig({maxZoom:i}),this}},{key:"setAutoFit",value:function(i){return this.updateLayerConfig({autoFit:i}),this}},{key:"fitBounds",value:function(i){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var o=this.getSource(),s=o.extent,l=s.some(function(f){return Math.abs(f)===1/0});return l?this:(this.mapService.fitBounds([[s[0],s[1]],[s[2],s[3]]],i),this)}},{key:"destroy",value:function(){var i,o,s,l,f,v=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;if(!this.isDestroyed){(i=this.layerModel)===null||i===void 0||i.uniformBuffers.forEach(function(T){T.destroy()}),this.layerChildren.map(function(T){return T.destroy(!1)}),this.layerChildren=[];var y=this.getLayerConfig(),b=y.maskfence;b&&(this.masks.map(function(T){return T.destroy(!1)}),this.masks=[]),this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),(o=this.multiPassRenderer)===null||o===void 0||o.destroy(),this.textureService.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),(s=this.layerModel)===null||s===void 0||s.clearModels(v),(l=this.tileLayer)===null||l===void 0||l.destroy(),this.models=[],(f=this.debugService)===null||f===void 0||f.removeLog(this.id),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroyed=!0}}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){var i;this.models.forEach(function(o){return o.destroy()}),(i=this.layerModel)===null||i===void 0||i.clearModels(),this.models=[]}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(i){return i.needRescale||i.needRemapping||i.needRegenerateVertices}).length}},{key:"setSource",value:function(i){var o=this;if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=i,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var s=this.mapService.getZoom();this.layerSource.updateClusterData(s)}this.layerSource.inited&&this.sourceEvent(),this.layerSource.on("update",function(l){var f=l.type;if(o.coordCenter===void 0){var v,y=o.layerSource.center;o.coordCenter=y,(v=o.mapService)!==null&&v!==void 0&&v.setCoordCenter&&o.mapService.setCoordCenter(y)}if(f==="update"){if(o.tileLayer){o.tileLayer.reload();return}o.sourceEvent()}})}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(i){this.encodedData=i,this.encodeDataLength=i.length}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getScale",value:function(i){return this.styleAttributeService.getLayerAttributeScale(i)}},{key:"getLegend",value:function(i){var o,s,l,f=this.styleAttributeService.getLayerStyleAttribute(i),v=(f==null||(o=f.scale)===null||o===void 0?void 0:o.scalers)||[];return{type:(s=v[0].option)===null||s===void 0?void 0:s.type,field:f==null||(l=f.scale)===null||l===void 0?void 0:l.field,items:this.getLegendItems(i)}}},{key:"getLegendItems",value:function(i){var o=this.styleAttributeService.getLayerAttributeScale(i);if(!o)return[];if(o.invertExtent){var s=o.range().map(function(v){return(0,B.Z)({value:o.invertExtent(v)},i,v)});return s}else if(o.ticks){var l=o.ticks().map(function(v){return(0,B.Z)({value:v},i,o(v))});return l}else if(o!=null&&o.domain){var f=o.domain().filter(function(v){return!Rw(v)}).map(function(v){return(0,B.Z)({value:v},i,o(v))});return f}return[]}},{key:"pick",value:function(i){var o=i.x,s=i.y;this.interactionService.triggerHover({x:o,y:s})}},{key:"boxSelect",value:function(i,o){this.pickingService.boxPickLayer(this,i,o)}},{key:"buildLayerModel",value:function(){var n=(0,Ct.Z)(me().mark(function o(s){var l=this,f,v,y,b,T,M,O,k,$,G,oe,ye;return me().wrap(function($e){for(;;)switch($e.prev=$e.next){case 0:return f=s.moduleName,v=s.vertexShader,y=s.fragmentShader,b=s.inject,T=s.triangulation,M=s.styleOption,O=(0,Fa.Z)(s,Ew),this.shaderModuleService.registerModule(f,{vs:v,fs:y,inject:b}),k=this.shaderModuleService.getModule(f),$=k.vs,G=k.fs,oe=k.uniforms,ye=this.rendererService.createModel,$e.abrupt("return",new Promise(function(ut){var vt=l.styleAttributeService.createAttributesAndIndices(l.encodedData,T,M),Rt=vt.attributes,Jt=vt.elements,Mr=vt.count,br=(0,H.Z)({attributes:Rt,uniforms:oe,fs:G,vs:$,elements:Jt,blend:n1[zs.normal],uniformBuffers:[].concat((0,Wt.Z)(l.layerModel.uniformBuffers),(0,Wt.Z)(l.rendererService.uniformBuffers)),textures:l.layerModel.textures},O);Mr&&(br.count=Mr);var pn=ye(br);ut(pn)}));case 5:case"end":return $e.stop()}},o,this)}));function i(o){return n.apply(this,arguments)}return i}()},{key:"createAttributes",value:function(i){var o=i.triangulation,s=this.styleAttributeService.createAttributes(this.encodedData,o),l=s.attributes;return l}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.animateStatus&&(this.layerService.stopAnimate(),this.animateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(i){var o=this.getLayerConfig(),s=o.enableHighlight,l=s===void 0?!0:s,f=o.enableSelect,v=f===void 0?!0:f,y=this.eventNames().indexOf(i)!==-1||this.eventNames().indexOf("un"+i)!==-1;return(i==="click"||i==="dblclick")&&v&&(y=!0),i==="mousemove"&&(l||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(y=!0),this.isVisible()&&y}},{key:"buildModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){return me().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return l.stop()}},o)}));function i(){return n.apply(this,arguments)}return i}()},{key:"rebuildModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){return me().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:case"end":return l.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"renderMulPass",value:function(){var n=(0,Ct.Z)(me().mark(function o(s){return me().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,s.render();case 2:case"end":return f.stop()}},o)}));function i(o){return n.apply(this,arguments)}return i}()},{key:"renderModels",value:function(){var i=this,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.encodeDataLength<=0&&!this.forceRender?(this.clearModels(),this):(this.hooks.beforeRender.call(),this.models.forEach(function(s){s.draw({uniforms:i.layerModel.getUninforms(),blend:i.layerModel.getBlend(),stencil:i.layerModel.getStencil(o)},(o==null?void 0:o.ispick)||!1)}),this.hooks.afterRender.call(),this)}},{key:"updateStyleAttribute",value:function(i,o,s,l){var f=this.configService.getAttributeConfig(this.id)||{};return U0(f[i],{field:o,values:s})?!1:(["color","size","texture","rotate","filter","label","shape"].indexOf(i)!==-1&&this.configService.setAttributeConfig(this.id,(0,B.Z)({},i,{field:o,values:s})),this.startInit?this.styleAttributeService.updateStyleAttribute(i,{scale:(0,H.Z)({field:o},this.splitValuesAndCallbackInAttribute(s,this.getLayerConfig()[o]))},l):this.pendingStyleAttributes.push({attributeName:i,attributeField:o,attributeValues:s,updateOptions:l}),!0)}},{key:"getLayerAttributeConfig",value:function(){return this.configService.getAttributeConfig(this.id)}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(i){console.warn("empty fn")}},{key:"processData",value:function(i){return i}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"initLayerModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){return me().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.models.forEach(function(f){return f.destroy()}),this.models=[],l.next=4,this.layerModel.initModels();case 4:this.models=l.sent;case 5:case"end":return l.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"reRender",value:function(){this.inited&&this.layerService.reRender()}},{key:"splitValuesAndCallbackInAttribute",value:function(i){return{values:l1(i)?void 0:i,callback:l1(i)?i:void 0}}}]),t}(no.EventEmitter),s1=Oi(N0.prototype,"configService",[o1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N0);function Mw(e,r){return{enable:e,mask:255,func:{cmp:R.EQUAL,ref:r?1:0,mask:1}}}function h1(e){return e.maskOperation===Qp.OR?{enable:!0,mask:255,func:{cmp:R.ALWAYS,ref:1,mask:255},opFront:{fail:R.KEEP,zfail:R.REPLACE,zpass:R.REPLACE}}:{enable:!0,mask:255,func:{cmp:e.stencilType===hc.SINGLE||e.stencilIndex===0?R.ALWAYS:R.LESS,ref:e.stencilType===hc.SINGLE?1:e.stencilIndex===0?2:1,mask:255},opFront:{fail:R.KEEP,zfail:R.REPLACE,zpass:R.REPLACE}}}var Iw={opacity:1,stroke:[1,0,0,1],offsets:[0,0],rotation:0,extrusionBase:0,strokeOpacity:1,thetaOffset:.314},yg={opacity:"float",stroke:"vec4",offsets:"vec2",textOffset:"vec2",rotation:"float",extrusionBase:"float",strokeOpacity:"float",thetaOffset:"float"};function fL(e){var r="";return Object.keys(e).forEach(function(t){var n=e[t];Array.isArray(n)?r+="vec".concat(n.length," ").concat(t,`;
`):r+="flot ".concat(t,`;
`)}),r}function p1(e){return Math.ceil(e/4)*4}var Ms=function(e){return e[e.POSITION=0]="POSITION",e[e.COLOR=1]="COLOR",e[e.VERTEX_ID=2]="VERTEX_ID",e[e.PICKING_COLOR=3]="PICKING_COLOR",e[e.STROKE=4]="STROKE",e[e.OPACITY=5]="OPACITY",e[e.OFFSETS=6]="OFFSETS",e[e.ROTATION=7]="ROTATION",e[e.EXTRUSION_BASE=8]="EXTRUSION_BASE",e[e.SIZE=9]="SIZE",e[e.SHAPE=10]="SHAPE",e[e.EXTRUDE=11]="EXTRUDE",e[e.MAX=12]="MAX",e[e.NORMAL=13]="NORMAL",e}({});function Pw(e){switch(e){case"rotation":return{name:"Rotation",type:fn.Attribute,descriptor:{name:"a_Rotation",shaderLocation:Ms.ROTATION,buffer:{usage:R.DYNAMIC_DRAW,data:[],type:R.FLOAT},size:1,update:function(t){var n=t.rotation,i=n===void 0?0:n;return Array.isArray(i)?[i[0]]:[i]}}};case"stroke":return{name:"stroke",type:fn.Attribute,descriptor:{name:"a_Stroke",shaderLocation:Ms.STROKE,buffer:{usage:R.DYNAMIC_DRAW,data:[],type:R.FLOAT},size:4,update:function(t){var n=t.stroke,i=n===void 0?[1,1,1,1]:n;return i}}};case"opacity":return{name:"opacity",type:fn.Attribute,descriptor:{name:"a_Opacity",shaderLocation:Ms.OPACITY,buffer:{usage:R.STATIC_DRAW,data:[],type:R.FLOAT},size:1,update:function(t){var n=t.opacity,i=n===void 0?1:n;return[i]}}};case"extrusionBase":return{name:"extrusionBase",type:fn.Attribute,descriptor:{name:"a_ExtrusionBase",shaderLocation:Ms.EXTRUSION_BASE,buffer:{usage:R.STATIC_DRAW,data:[],type:R.FLOAT},size:1,update:function(t){var n=t.extrusionBase,i=n===void 0?0:n;return[i]}}};case"offsets":return{name:"offsets",type:fn.Attribute,descriptor:{name:"a_Offsets",shaderLocation:Ms.OFFSETS,buffer:{usage:R.STATIC_DRAW,data:[],type:R.FLOAT},size:2,update:function(t){var n=t.offsets;return n}}};case"thetaOffset":return{name:"thetaOffset",type:fn.Attribute,descriptor:{name:"a_ThetaOffset",buffer:{usage:R.STATIC_DRAW,data:[],type:R.FLOAT},size:1,update:function(t){var n=t.thetaOffset,i=n===void 0?1:n;return[i]}}};default:return}}var d1,z0,v1,m1={opacity:Ms.OPACITY,stroke:Ms.STROKE,offsets:Ms.OFFSETS,rotation:Ms.ROTATION,extrusionBase:Ms.EXTRUSION_BASE},Ma=(d1=k0(tt.IGlobalConfigService),z0=function(){function e(r){(0,q.Z)(this,e),(0,B.Z)(this,"uniformBuffers",[]),(0,B.Z)(this,"textures",[]),(0,B.Z)(this,"preStyleAttribute",{}),(0,B.Z)(this,"encodeStyleAttribute",{}),Fi(this,"configService",v1,this),this.layer=r,this.rendererService=r.getContainer().get(tt.IRendererService),this.pickingService=r.getContainer().get(tt.IPickingService),this.shaderModuleService=r.getContainer().get(tt.IShaderModuleService),this.styleAttributeService=r.getContainer().get(tt.IStyleAttributeService),this.mapService=r.getContainer().get(tt.IMapService),this.iconService=r.getContainer().get(tt.IIconService),this.fontService=r.getContainer().get(tt.IFontService),this.cameraService=r.getContainer().get(tt.ICameraService),this.layerService=r.getContainer().get(tt.ILayerService),this.registerStyleAttribute(),this.registerBuiltinAttributes(),this.startModelAnimate();var t=this.rendererService.createTexture2D;this.createTexture2D=t}return(0,V.Z)(e,[{key:"getBlend",value:function(){var t=this.layer.getLayerConfig(),n=t.blend,i=n===void 0?"normal":n;return n1[zs[i]]}},{key:"getStencil",value:function(t){var n=this.layer.getLayerConfig(),i=n.mask,o=i===void 0?!1:i,s=n.maskInside,l=s===void 0?!0:s,f=n.enableMask,v=n.maskOperation,y=v===void 0?Qp.AND:v;if(this.layer.type==="MaskLayer")return h1({isStencil:!0,stencilType:hc.SINGLE});if(t.isStencil)return h1((0,H.Z)((0,H.Z)({},t),{},{maskOperation:y}));var b=o||f&&this.layer.masks.length!==0||this.layer.tileMask!==void 0;return Mw(b,l)}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){var r=(0,Ct.Z)(me().mark(function n(){return me().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",!1);case 1:case"end":return o.stop()}},n)}));function t(){return r.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var r=(0,Ct.Z)(me().mark(function n(){return me().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return o.stop()}},n)}));function t(){return r.apply(this,arguments)}return t}()},{key:"initModels",value:function(){var r=(0,Ct.Z)(me().mark(function n(){return me().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return o.stop()}},n)}));function t(){return r.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(t){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.duration||4,t.interval||.2,t.trailLength||.1]}},{key:"startModelAnimate",value:function(){var t=this.layer.getLayerConfig(),n=t.animateOption;n.enable&&this.layer.setAnimateStartTime()}},{key:"getInject",value:function(){var t=this.layer.encodeStyleAttribute,n="",i=[];this.layer.enableShaderEncodeStyles.forEach(function(l){t[l]?n+="#define USE_ATTRIBUTE_".concat(l.toUpperCase(),` 0.0; 

`):i.push("  ".concat(yg[l]," u_").concat(l,";")),n+=`
          #ifdef USE_ATTRIBUTE_`.concat(l.toUpperCase(),`
          layout(location = `).concat(m1[l],") in ").concat(yg[l]," a_").concat(l.charAt(0).toUpperCase()+l.slice(1),`;
        #endif

        `)});var o=i.length?`
layout(std140) uniform AttributeUniforms {
`.concat(i.join(`
`),`
};
    `):"";n+=o;var s="";return this.layer.enableShaderEncodeStyles.forEach(function(l){s+=`

    #ifdef USE_ATTRIBUTE_`.concat(l.toUpperCase(),`
      `).concat(yg[l]," ").concat(l,"  = a_").concat(l.charAt(0).toUpperCase()+l.slice(1),`;
    #else
      `).concat(yg[l]," ").concat(l," = u_").concat(l,`;
    #endif

    `)}),{"vs:#decl":n,"fs:#decl":o,"vs:#main-start":s}}},{key:"getStyleAttribute",value:function(){var t=this,n={};return this.layer.enableShaderEncodeStyles.forEach(function(i){if(!t.layer.encodeStyleAttribute[i]){var o=t.layer.getLayerConfig()[i],s=typeof o=="undefined"?Iw[i]:o;i==="stroke"&&(s=fi(s)),n["u_"+i]=s}}),n}},{key:"registerStyleAttribute",value:function(){var t=this;Object.keys(this.layer.encodeStyleAttribute).forEach(function(n){var i=Pw(n);i&&(t.styleAttributeService.registerStyleAttribute(i),i.descriptor&&(i.descriptor.shaderLocation=m1[n]))})}},{key:"updateEncodeAttribute",value:function(t,n){this.encodeStyleAttribute[t]=n}},{key:"initUniformsBuffer",value:function(){var t=this.getUniformsBufferInfo(this.getStyleAttribute()),n=this.getCommonUniformsInfo();this.attributeUnifoms=this.rendererService.createBuffer({data:new Float32Array(p1(t.uniformsLength)),isUBO:!0}),this.commonUnifoms=this.rendererService.createBuffer({data:new Float32Array(p1(n.uniformsLength)),isUBO:!0}),this.uniformBuffers=[this.attributeUnifoms,this.commonUnifoms]}},{key:"getUniformsBufferInfo",value:function(t){var n=0,i=[];return Object.values(t).forEach(function(o){Array.isArray(o)?(i.push.apply(i,(0,Wt.Z)(o)),n+=o.length):(i.push(o),n+=1)}),{uniformsOption:t,uniformsLength:n,uniformsArray:i}}},{key:"getCommonUniformsInfo",value:function(){return{uniformsLength:0,uniformsArray:[],uniformsOption:{}}}},{key:"updateStyleUnifoms",value:function(){var t=this.getUniformsBufferInfo(this.getStyleAttribute()),n=t.uniformsArray,i=this.getCommonUniformsInfo(),o=i.uniformsArray;this.attributeUnifoms.subData({offset:0,data:new Uint8Array(new Float32Array(n).buffer)}),this.commonUnifoms.subData({offset:0,data:new Uint8Array(new Float32Array(o).buffer)})}}]),e}(),v1=Oi(z0.prototype,"configService",[d1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z0),Z0=100,hL=36,pL=40;function g1(e){return e/180*Math.acos(-1)}function _1(e){var r=g1(e[0])+Math.PI/2,t=g1(e[1]),n=Z0+Math.random()*.4,i=n*Math.cos(t)*Math.cos(r),o=n*Math.cos(t)*Math.sin(r),s=n*Math.sin(t);return[o,s,i]}function dL(e,r){var t=mat4.create(),n=mat4.create(),i=vec3.fromValues(0,1,0),o=vec3.fromValues(0,0,0);r=r||{},e=typeof e!="undefined"?e:1;for(var s=typeof r.segments!="undefined"?r.segments:32,l=2+s,f=2*l,v=[],y=[],b=[],T=[],M=[],O=[],k=0;k<=l;k++){for(var $=k/l,G=$*Math.PI,oe=0;oe<=f;oe++){var ye=oe/f,Le=ye*Math.PI*2;mat4.identity(n),mat4.rotateZ(n,n,-G),mat4.identity(t),mat4.rotateY(t,t,Le),vec3.transformMat4(o,i,n),vec3.transformMat4(o,o,t),vec3.scale(o,o,-e),b.push(o.slice()),T.push.apply(T,_toConsumableArray(o.slice())),vec3.normalize(o,o),M.push.apply(M,_toConsumableArray(o.slice())),O.push([ye,1-$]),T.push(ye,1-$)}if(k>0)for(var $e=b.length,ut=$e-2*(f+1);ut+f+2<$e;ut++)v.push([ut,ut+1,ut+f+1]),y.push(ut,ut+1,ut+f+1),v.push([ut+f+1,ut+1,ut+f+2]),y.push(ut+f+1,ut+1,ut+f+2)}return{cells:v,positions:b,uvs:O,positionsArr:T,indicesArr:y,normalArr:M}}var xg=Or.Ue(),vL=Or.Ue(),Ws=Or.Ue(),Pp=Or.Ue(),lv=Or.Ue();function V0(e,r,t,n,i){Or.IH(e,t,n),Or.Fv(e,e),r=Or.al(-e[1],e[0]);var o=Or.al(-t[1],t[0]);return[i/Or.AK(r,o),r]}function Op(e,r){return Or.t8(e,-r[1],r[0])}function cv(e,r,t){return Or.lu(e,r,t),Or.Fv(e,e),e}function j0(e,r){return e[0]===r[0]&&e[1]===r[1]}function mL(e){for(var r=new Map,t=0;t<e.length;t++){var n=e[0].toString()+"-"+e[1].toString();r.get(n)?(e.splice(t,1),t++):r.set(n,n)}return e}var Ow=function(){function e(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,q.Z)(this,e),(0,B.Z)(this,"lastFlip",-1),(0,B.Z)(this,"miter",Or.al(0,0)),(0,B.Z)(this,"started",!1),(0,B.Z)(this,"dash",!1),(0,B.Z)(this,"totalDistance",0),(0,B.Z)(this,"currentIndex",0),this.join=r.join||"miter",this.cap=r.cap||"butt",this.miterLimit=r.miterLimit||10,this.thickness=r.thickness||1,this.dash=r.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,V.Z)(e,[{key:"simpleExtrude",value:function(t){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var i=t.length,o=n.startIndex,s=1;s<i;s++){var l=t[s-1],f=t[s],v=s<t.length-1?t[s+1]:null,y=this.simpleSegment(n,o,l,f,v);o+=y}if(this.dash)for(var b=0;b<n.positions.length/6;b++)n.positions[b*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude_gaode2",value:function(t,n){var i=this.complex;if(t.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=t.length,s=i.startIndex,l=1;l<o;l++){var f,v,y,b=t[l-1];b.push((f=n[l-1][2])!==null&&f!==void 0?f:0);var T=n[l-1],M=t[l];M.push((v=n[l][2])!==null&&v!==void 0?v:0);var O=n[l],k=l<t.length-1?[].concat((0,Wt.Z)(t[l+1]),[(y=n[l+1][2])!==null&&y!==void 0?y:0]):null,$=l<n.length-1?n[l+1]:null,G=this.simpleSegment(i,s,b,M,k,T,O,$);s+=G}if(this.dash)for(var oe=0;oe<i.positions.length/6;oe++)i.positions[oe*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"extrude_gaode2",value:function(t,n){var i=this.complex;if(t.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=t.length,s=i.startIndex,l=1;l<o;l++){var f,v,y,b=t[l-1];b.push((f=n[l-1][2])!==null&&f!==void 0?f:0);var T=n[l-1],M=t[l];M.push((v=n[l][2])!==null&&v!==void 0?v:0);var O=n[l],k=l<t.length-1?[].concat((0,Wt.Z)(t[l+1]),[(y=n[l+1][2])!==null&&y!==void 0?y:0]):null,$=l<n.length-1?n[l+1]:null,G=this.segment_gaode2(i,s,b,M,k,T,O,$);s+=G}if(this.dash)for(var oe=0;oe<i.positions.length/6;oe++)i.positions[oe*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"extrude",value:function(t){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var i=t.length,o=n.startIndex,s=1;s<i;s++){var l=t[s-1],f=t[s],v=s<t.length-1?t[s+1]:null,y=this.segment(n,o,l,f,v);o+=y}if(this.dash)for(var b=0;b<n.positions.length/6;b++)n.positions[b*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleSegment",value:function(t,n,i,o,s){var l=0,f=t.indices,v=t.positions,y=t.normals,b=ko([o[0],o[1]]),T=ko([i[0],i[1]]);cv(Ws,b,T);var M=0;if(this.dash&&(M=this.lineSegmentDistance(b,T),this.totalDistance+=M),this.normal||(this.normal=Or.Ue(),Op(this.normal,Ws)),this.started||(this.started=!0,this.extrusions(v,y,i,this.normal,this.thickness,this.totalDistance-M)),f.push(n+0,n+1,n+2),!s)Op(this.normal,Ws),this.extrusions(v,y,o,this.normal,this.thickness,this.totalDistance),f.push.apply(f,(0,Wt.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2;else{var O=ko([s[0],s[1]]);j0(b,O)&&Or.IH(O,b,Or.Fv(O,Or.$X(O,b,T))),cv(Pp,O,b);var k=V0(lv,Or.Ue(),Ws,Pp,this.thickness),$=(0,yn.Z)(k,2),G=$[0],oe=$[1],ye=Or.AK(lv,this.normal)<0?-1:1;this.extrusions(v,y,o,oe,G,this.totalDistance),f.push.apply(f,(0,Wt.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),ye=-1,Or.JG(this.normal,oe),l+=2,this.lastFlip=ye}return l}},{key:"segment_gaode2",value:function(t,n,i,o,s,l,f,v){var y=0,b=t.indices,T=t.positions,M=t.normals,O=this.cap==="square",k=this.join==="bevel",$=ko([f[0],f[1]]),G=ko([l[0],l[1]]);cv(Ws,o,i);var oe=0;if(this.dash&&(oe=this.lineSegmentDistance($,G),this.totalDistance+=oe),this.normal||(this.normal=Or.Ue(),Op(this.normal,Ws)),!this.started)if(this.started=!0,O){var ye=Or.Ue(),Le=Or.Ue();Or.IH(ye,this.normal,Ws),Or.IH(Le,this.normal,Ws),M.push(Le[0],Le[1],0),M.push(ye[0],ye[1],0),T.push(i[0],i[1],i[2]|0,this.totalDistance-oe,-this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),T.push(i[0],i[1],i[2]|0,this.totalDistance-oe,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(T,M,i,this.normal,this.thickness,this.totalDistance-oe);if(b.push(n+0,n+1,n+2),s){j0(o,s)&&Or.IH(s,o,Or.Fv(s,Or.$X(s,o,i))),cv(Pp,s,o);var vt=V0(lv,Or.Ue(),Ws,Pp,this.thickness),Rt=(0,yn.Z)(vt,2),Jt=Rt[0],Mr=Rt[1],br=Or.AK(lv,this.normal)<0?-1:1,pn=k;if(!pn&&this.join==="miter"){var kn=Jt;kn>this.miterLimit&&(pn=!0)}pn?(M.push(this.normal[0],this.normal[1],0),M.push(Mr[0],Mr[1],0),T.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*br,o[2]|0),this.complex.indexes.push(this.currentIndex),T.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*br,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,b.push.apply(b,(0,Wt.Z)(this.lastFlip!==-br?[n,n+2,n+3]:[n+2,n+1,n+3])),b.push(n+2,n+3,n+4),Op(xg,Pp),Or.JG(this.normal,xg),M.push(this.normal[0],this.normal[1],0),T.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*br,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,y+=3):(this.extrusions(T,M,o,Mr,Jt,this.totalDistance),b.push.apply(b,(0,Wt.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),br=-1,Or.JG(this.normal,Mr),y+=2),this.lastFlip=br}else{if(Op(this.normal,Ws),O){var $e=Or.Ue(),ut=Or.Ue();Or.lu(ut,Ws,this.normal),Or.IH($e,Ws,this.normal),M.push(ut[0],ut[1],0),M.push($e[0],$e[1],0),T.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),T.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(T,M,o,this.normal,this.thickness,this.totalDistance);b.push.apply(b,(0,Wt.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),y+=2}return y}},{key:"segment",value:function(t,n,i,o,s){var l=0,f=t.indices,v=t.positions,y=t.normals,b=this.cap==="square",T=this.join==="bevel",M=ko([o[0],o[1]]),O=ko([i[0],i[1]]);cv(Ws,M,O);var k=0;if(this.dash&&(k=this.lineSegmentDistance(M,O),this.totalDistance+=k),this.normal||(this.normal=Or.Ue(),Op(this.normal,Ws)),!this.started)if(this.started=!0,b){var $=Or.Ue(),G=Or.Ue();Or.IH($,this.normal,Ws),Or.IH(G,this.normal,Ws),y.push(G[0],G[1],0),y.push($[0],$[1],0),v.push(i[0],i[1],i[2]|0,this.totalDistance-k,-this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),v.push(i[0],i[1],i[2]|0,this.totalDistance-k,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(v,y,i,this.normal,this.thickness,this.totalDistance-k);if(f.push(n+0,n+1,n+2),s){var Le=ko([s[0],s[1]]);j0(M,Le)&&Or.IH(Le,M,Or.Fv(Le,Or.$X(Le,M,O))),cv(Pp,Le,M);var $e=V0(lv,Or.Ue(),Ws,Pp,this.thickness),ut=(0,yn.Z)($e,2),vt=ut[0],Rt=ut[1],Jt=Or.AK(lv,this.normal)<0?-1:1,Mr=T;if(!Mr&&this.join==="miter"){var br=vt;br>this.miterLimit&&(Mr=!0)}Mr?(y.push(this.normal[0],this.normal[1],0),y.push(Rt[0],Rt[1],0),v.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*Jt,o[2]|0),this.complex.indexes.push(this.currentIndex),v.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*Jt,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,f.push.apply(f,(0,Wt.Z)(this.lastFlip!==-Jt?[n,n+2,n+3]:[n+2,n+1,n+3])),f.push(n+2,n+3,n+4),Op(xg,Pp),Or.JG(this.normal,xg),y.push(this.normal[0],this.normal[1],0),v.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*Jt,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,l+=3):(this.extrusions(v,y,o,Rt,vt,this.totalDistance),f.push.apply(f,(0,Wt.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Jt=-1,Or.JG(this.normal,Rt),l+=2),this.lastFlip=Jt}else{if(Op(this.normal,Ws),b){var oe=Or.Ue(),ye=Or.Ue();Or.lu(ye,Ws,this.normal),Or.IH(oe,Ws,this.normal),y.push(ye[0],ye[1],0),y.push(oe[0],oe[1],0),v.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),v.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(v,y,o,this.normal,this.thickness,this.totalDistance);f.push.apply(f,(0,Wt.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2}return l}},{key:"extrusions",value:function(t,n,i,o,s,l){n.push(o[0],o[1],0),n.push(o[0],o[1],0),t.push(i[0],i[1],i[2]|0,l,-s,i[2]|0),this.complex.indexes.push(this.currentIndex),t.push(i[0],i[1],i[2]|0,l,s,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(t,n){var i=n[0]-t[0],o=n[1]-t[1];return Math.sqrt(i*i+o*o)}}]),e}(),La=L(54442);function Dw(e){var r=e[0][0],t=e[0][e[0].length-1];r[0]===t[0]&&r[1]===t[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var n=e[0].length,i=fs().flatten(e),o=i.vertices,s=i.dimensions,l=[],f=[],v=0;v<o.length/s;v++)s===2?l.push(o[v*2],o[v*2+1],1):l.push(o[v*3],o[v*3+1],1);var y=fs()(i.vertices,i.holes,i.dimensions);f.push.apply(f,(0,Wt.Z)(y));for(var b=function(){var O=i.vertices.slice(T*s,(T+1)*s),k=i.vertices.slice((T+1)*s,(T+2)*s);k.length===0&&(k=i.vertices.slice(0,s));var $=l.length/3;l.push(O[0],O[1],1,k[0],k[1],1,O[0],O[1],0,k[0],k[1],0),f.push.apply(f,(0,Wt.Z)([0,2,1,2,3,1].map(function(G){return G+$})))},T=0;T<n;T++)b();return{positions:l,index:f}}function kw(e){var r=fs().flatten(e),t=fs()(r.vertices,r.holes,r.dimensions);return{positions:r.vertices,index:t}}function y1(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,t=e[0][0],n=e[0][e[0].length-1];t[0]===n[0]&&t[1]===n[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var i=e[0].length,o=fs().flatten(e),s=o.vertices,l=o.dimensions,f=[],v=[],y=[],b=0;b<s.length/l;b++)f.push(s[b*l],s[b*l+1],1,-1,-1),y.push(0,0,1);var T=fs()(o.vertices,o.holes,o.dimensions);v.push.apply(v,(0,Wt.Z)(T));for(var M=function(){var $=o.vertices.slice(O*l,(O+1)*l),G=o.vertices.slice((O+1)*l,(O+2)*l);G.length===0&&(G=o.vertices.slice(0,l));var oe=f.length/5;f.push($[0],$[1],1,0,0,G[0],G[1],1,.1,0,$[0],$[1],0,0,.8,G[0],G[1],0,.1,.8);var ye=Fw([G[0],G[1],1],[$[0],$[1],0],[$[0],$[1],1],r);y.push.apply(y,(0,Wt.Z)(ye).concat((0,Wt.Z)(ye),(0,Wt.Z)(ye),(0,Wt.Z)(ye))),v.push.apply(v,(0,Wt.Z)([1,2,0,3,2,1].map(function(Le){return Le+oe})))},O=0;O<i;O++)M();return{positions:f,index:v,normals:y}}function Fw(e,r,t){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,i=La.create(),o=La.create(),s=La.create();n&&(e=Bu(e),r=Bu(r),t=Bu(t));var l=La.fromValues.apply(La,(0,Wt.Z)(e)),f=La.fromValues.apply(La,(0,Wt.Z)(r)),v=La.fromValues.apply(La,(0,Wt.Z)(t));La.sub(i,v,f),La.sub(o,l,f),La.cross(s,i,o);var y=La.create();return La.normalize(y,s),y}var Yc,cm=function(e){return e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn",e}({}),fm=function(e){return e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon",e}({});function hm(e){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=Math.PI*2/e,n=[],i=0;i<e;i++)n.push(t*i+r*Math.PI/12);var o=n.map(function(s){var l=Math.sin(s+Math.PI/4),f=Math.cos(s+Math.PI/4);return[l,f,0]});return o}function H0(){return hm(30)}function x1(){return hm(4)}function b1(){return hm(3)}function E1(){return hm(6,1)}function S1(){return hm(5)}var fv=(Yc={},(0,B.Z)(Yc,fm.CIRCLE,H0),(0,B.Z)(Yc,fm.HEXAGON,E1),(0,B.Z)(Yc,fm.TRIANGLE,b1),(0,B.Z)(Yc,fm.SQUARE,x1),(0,B.Z)(Yc,fm.PENTAGON,S1),(0,B.Z)(Yc,cm.CYLINDER,H0),(0,B.Z)(Yc,cm.HEXAGONCOLUMN,E1),(0,B.Z)(Yc,cm.TRIANGLECOLUMN,b1),(0,B.Z)(Yc,cm.SQUARECOLUMN,x1),(0,B.Z)(Yc,cm.PENTAGONCOLUMN,S1),Yc),bg={};function Eg(e){var r=Ds(e.coordinates);return{vertices:[].concat((0,Wt.Z)(r),(0,Wt.Z)(r),(0,Wt.Z)(r),(0,Wt.Z)(r)),indices:[0,1,2,2,3,0],size:r.length}}function A1(e){var r=Ds(e.coordinates),t=_1(r);return{vertices:[].concat((0,Wt.Z)(t),(0,Wt.Z)(t),(0,Wt.Z)(t),(0,Wt.Z)(t)),indices:[0,1,2,2,3,0],size:t.length}}function W0(e){var r=e.shape,t=Vw(r,!1),n=t.positions,i=t.index,o=t.normals;return{vertices:n,indices:i,normals:o,size:5}}function Bw(e){var r=Ds(e.coordinates);return{vertices:(0,Wt.Z)(r),indices:[0],size:r.length}}function G0(e){var r=e.coordinates,t=e.originCoordinates,n=e.version,i=new Ow({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var o=r;Array.isArray(o[0][0])||(o=[r]);var s=t;Array.isArray(s[0][0])||(s=[t]);for(var l=0;l<o.length;l++){var f=o[l],v=s[l];i.extrude_gaode2(f,v)}}else{var y=r;y[0]&&!Array.isArray(y[0][0])&&(y=[r]),y.forEach(function(T){i.extrude(T)})}var b=i.complex;return{vertices:b.positions,indices:b.indices,normals:b.normals,indexes:b.indexes,size:6}}function gL(e){var r=e.coordinates.flat(),t=1,n=1;return{vertices:[1,0,0].concat(_toConsumableArray(r),[1,2,-3],_toConsumableArray(r),[1,1,-3],_toConsumableArray(r),[0,1,0],_toConsumableArray(r),[0,0,0],_toConsumableArray(r),[1,0,0],_toConsumableArray(r),[1,2,-3],_toConsumableArray(r),[1,1,-3],_toConsumableArray(r),[0,1,0],_toConsumableArray(r),[0,0,0],_toConsumableArray(r)),normals:[-t,2*n,1,2*n,-n,1,n,-n,1,n,-n,1,-t,-n,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],indices:[0,1,2,0,2,3,0,3,4,5,6,7,5,7,8,5,8,9],size:7}}function Lw(e){var r=e.coordinates,t=[];if(!Array.isArray(r[0]))return{vertices:[],indices:[],normals:[],size:6,count:0};var n=Nw(r),i=n.results,o=n.totalDistance;return i.map(function(s){t.push(s[0],s[1],s[2],s[3],0,o)}),{vertices:t,indices:[],normals:[],size:6,count:i.length}}function _L(e){var r=e.coordinates,t=[];if(!Array.isArray(r[0]))return{vertices:[],indices:[],size:4,count:0};var n=Uw(r),i=n.results;return i.map(function(o){t.push(o[0],o[1],o[2],o[3])}),{vertices:t,indices:[],size:4,count:i.length}}function T1(e,r){var t=r[0]-e[0],n=r[1]-e[1];return Math.sqrt(t*t+n*n)}function hv(e,r){return e.length<3&&e.push(0),r!==void 0&&e.push(r),e}function Nw(e){var r=e;Array.isArray(r)&&Array.isArray(r[0])&&Array.isArray(r[0][0])&&(r=e.flat());var t=0;if(r.length<2)return{results:r,totalDistance:0};var n=[],i=hv(r[0],t);n.push(i);for(var o=1;o<r.length-1;o++){var s=T1(r[o-1],r[o]);t+=s;var l=hv(r[o],t);n.push(l),n.push(l)}var f=T1(r[r.length-2],r[r.length-1]);return t+=f,n.push(hv(r[r.length-1],t)),{results:n,totalDistance:t}}function Uw(e){if(e.length<2)return{results:e};var r=[],t=hv(e[0]);r.push(t);for(var n=1;n<e.length-1;n++){var i=hv(e[n]);r.push(i),r.push(i)}return r.push(hv(e[e.length-1])),{results:r}}function X0(e){var r=e.coordinates,t=fs().flatten(r),n=t.vertices,i=t.dimensions,o=t.holes;return{indices:fs()(n,o,i),vertices:n,size:i}}function zw(e){var r=e.coordinates,t=fs().flatten(r),n=t.vertices,i=t.dimensions,o=t.holes;return{indices:fs()(n,o,i),vertices:Zw(n),size:i+4}}function Zw(e){for(var r=[],t=sf(e),n=t.center,i=t.radius,o=0;o<e.length;o+=2){var s=e[o],l=e[o+1];r.push.apply(r,[s,l,0].concat((0,Wt.Z)(n),[i]))}return r}function $0(e){var r=e.coordinates,t=y1(r,!0),n=t.positions,i=t.index,o=t.normals;return{vertices:n,indices:i,normals:o,size:5}}function w1(e){var r=e.shape,t=Hw(r),n=t.positions,i=t.index;return{vertices:n,indices:i,size:3}}function Sg(e){var r=e.coordinates,t=[].concat((0,Wt.Z)(r[0]),[0,0,1,r[1][0],r[0][1],0,1,1],(0,Wt.Z)(r[1]),[0,1,0],(0,Wt.Z)(r[0]),[0,0,1],(0,Wt.Z)(r[1]),[0,1,0,r[0][0],r[1][1],0,0,0]),n=[0,1,2,3,4,5];return{vertices:t,indices:n,size:5}}function Ag(e,r){for(var t=r.segmentNumber,n=t===void 0?30:t,i=e.coordinates,o=[],s=[],l=function(y){o.push(y,1,y,i[0][0],i[0][1],i[1][0],i[1][1],y,-1,y,i[0][0],i[0][1],i[1][0],i[1][1]),y!==n-1&&s.push.apply(s,(0,Wt.Z)([0,1,2,1,3,2].map(function(b){return y*2+b})))},f=0;f<n;f++)l(f);return{vertices:o,indices:s,size:7}}function C1(e){var r=e.coordinates;r.length===2&&r.push(0);var t=Tg(-1,1),n=Tg(1,1),i=Tg(-1,-1),o=Tg(1,-1),s=[].concat((0,Wt.Z)(r),(0,Wt.Z)(t),(0,Wt.Z)(r),(0,Wt.Z)(i),(0,Wt.Z)(r),(0,Wt.Z)(o),(0,Wt.Z)(r),(0,Wt.Z)(n)),l=[0,1,2,3,0,2];return{vertices:s,indices:l,size:5}}function Vw(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(bg&&bg[e])return bg[e];var t=fv[e]?fv[e]():fv.cylinder(),n=y1([t],r);return bg[e]=n,n}function yL(e,r){for(var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,i=new Float32Array(e.length/t*3),o,s,l,f=vec3.create(),v=vec3.create(),y=vec3.create(),b=0,T=r.length;b<T;b+=3){o=r[b+0]*3,s=r[b+1]*3,l=r[b+2]*3;var M=[e[o],e[o+1]],O=[e[s],e[s+1]],k=[e[l],e[l+1]];n&&(M=lngLatToMeters(M),O=lngLatToMeters(O),k=lngLatToMeters(k));var $=M,G=_slicedToArray($,2),oe=G[0],ye=G[1],Le=vec3.fromValues(oe,ye,e[o+2]),$e=O,ut=_slicedToArray($e,2),vt=ut[0],Rt=ut[1],Jt=vec3.fromValues(vt,Rt,e[s+2]),Mr=k,br=_slicedToArray(Mr,2),pn=br[0],kn=br[1],Pi=vec3.fromValues(pn,kn,e[l+2]);vec3.sub(f,Pi,Jt),vec3.sub(v,Le,Jt),vec3.cross(y,f,v),i[o]+=f[0],i[o+1]+=f[1],i[o+2]+=f[2],i[s]+=f[0],i[s+1]+=f[1],i[s+2]+=f[2],i[l]+=f[0],i[l+1]+=f[1],i[l+2]+=f[2]}return jw(i),i}function jw(e){for(var r=0,t=e.length;r<t;r+=3){var n=vec3.fromValues(e[r],e[r+1],e[r+2]),i=vec3.create();vec3.normalize(i,n),e.set(i,r)}}function xL(e){var r=e[0][0],t=e[0][e[0].length-1];return r[0]===t[0]&&r[1]===t[1]}function Hw(e){var r=["cylinder","triangleColumn","hexagonColumn","squareColumn"],t=fv[e]?fv[e]():fv.circle(),n=r.indexOf(e)===-1?kw([t]):Dw([t]);return n}function Tg(e,r){var t=(e+1)/2,n=(r+1)/2;return[t,n]}function bL(){var e=primitiveSphere(EARTH_RADIUS,{segments:EARTH_SEGMENTS}),r=e.positionsArr,t=e.indicesArr,n=e.normalArr;return{vertices:r,indices:t,size:5,normals:n}}function EL(){var e=primitiveSphere(EARTH_RADIUS+EARTH_RADIUS_OUTER,{segments:EARTH_SEGMENTS}),r=e.positionsArr,t=e.indicesArr,n=e.normalArr;return{vertices:r,indices:t,size:5,normals:n}}function Ww(e){var r=Gw();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function Gw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Xw=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

uniform float u_circleSweep;
uniform float u_cityMinSize;
uniform vec3 u_circleSweepColor;
uniform float u_circleSweepSpeed;

varying float v_worldDis;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }


  if(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {
    float r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);
    gl_FragColor.rgb += r * r * u_circleSweepColor;
  }
   
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,$w=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;

uniform float u_circleSweep;
uniform vec2 u_cityCenter;

varying float v_worldDis;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"


void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

   v_texCoord = a_Uv;

  if(u_circleSweep > 0.0) {
     vec2 lnglatscale = vec2(0.0);
    if(u_CoordinateSystem != COORDINATE_SYSTEM_P20_2) {
      lnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);
    }
    v_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);
  }
 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,Yw=function(e){(0,De.Z)(t,e);var r=Ww(t);function t(){return(0,q.Z)(this,t),r.apply(this,arguments)}return(0,V.Z)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),o=i.opacity,s=o===void 0?1:o,l=i.baseColor,f=l===void 0?"rgb(16,16,16)":l,v=i.brightColor,y=v===void 0?"rgb(255,176,38)":v,b=i.windowColor,T=b===void 0?"rgb(30,60,89)":b,M=i.time,O=M===void 0?0:M,k=i.sweep,$=k===void 0?{enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4,sweepCenter:this.cityCenter}:k;return{u_cityCenter:$.sweepCenter||this.cityCenter,u_cityMinSize:this.cityMinSize*$.sweepRadius,u_circleSweep:$.enable?1:0,u_circleSweepColor:fi($.sweepColor).slice(0,3),u_circleSweepSpeed:$.sweepSpeed,u_opacity:s,u_baseColor:fi(f),u_brightColor:fi(y),u_windowColor:fi(T),u_time:this.layer.getLayerAnimateTime()||O}}},{key:"calCityGeo",value:function(){var i=(0,yn.Z)(this.layer.getSource().extent,4),o=i[0],s=i[1],l=i[2],f=i[3];if(this.mapService.version==="GAODE2.x"){this.cityCenter=this.mapService.lngLatToCoord([(l+o)/2,(f+s)/2]);var v=this.mapService.lngLatToCoord([l,f]),y=this.mapService.lngLatToCoord([o,s]);this.cityMinSize=Math.sqrt(Math.pow(v[0]-y[0],2)+Math.pow(v[1]-y[1],2))/4}else{var b=l-o,T=f-s;this.cityCenter=[(l+o)/2,(f+s)/2],this.cityMinSize=Math.sqrt(Math.pow(b,2)+Math.pow(T,2))/4}}},{key:"initModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){return me().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.calCityGeo(),this.startModelAnimate(),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){var s;return me().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:$w,fragmentShader:Xw,triangulation:$0,depth:{enable:!0},cull:{enable:!0,face:R.BACK}});case 2:return s=f.sent,f.abrupt("return",[s]);case 4:case"end":return f.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:fn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:R.STATIC_DRAW,data:[],type:R.FLOAT},size:3,update:function(o,s,l,f,v){return v}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:fn.Attribute,descriptor:{name:"a_Size",buffer:{usage:R.DYNAMIC_DRAW,data:[],type:R.FLOAT},size:1,update:function(o){var s=o.size,l=s===void 0?10:s;return Array.isArray(l)?[l[0]]:[l]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:fn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:R.DYNAMIC_DRAW,data:[],type:R.FLOAT},size:2,update:function(o,s,l){return[l[3],l[4]]}}})}}]),t}(Ma);function qw(e){var r=Kw();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function Kw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Qw=function(e){(0,De.Z)(t,e);var r=qw(t);function t(){var n;(0,q.Z)(this,t);for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return n=r.call.apply(r,[this].concat(o)),(0,B.Z)((0,Ie.Z)(n),"type","CityBuildingLayer"),n}return(0,V.Z)(t,[{key:"buildModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){return me().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.layerModel=new Yw(this),l.next=3,this.initLayerModels();case 3:case"end":return l.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"setLight",value:function(i){this.updateLayerConfig({time:i})}},{key:"getModelType",value:function(){return"citybuilding"}}]),t}(Ip);function Jw(e){var r=eC();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function eC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var tC=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
\r
varying vec4 v_color;\r
\r
uniform vec2 u_sceneCenterMercator;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,rC=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,nC=function(e){(0,De.Z)(t,e);var r=Jw(t);function t(){return(0,q.Z)(this,t),r.apply(this,arguments)}return(0,V.Z)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),o=i.opacity,s=i.coverage,l=i.angle;return{u_opacity:o||1,u_coverage:s||.9,u_angle:l||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){return me().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){var s;return me().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,this.layer.buildLayerModel({moduleName:"heatmapGrid",vertexShader:tC,fragmentShader:rC,triangulation:w1,primitive:R.TRIANGLES,depth:{enable:!1}});case 2:return s=f.sent,f.abrupt("return",[s]);case 4:case"end":return f.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:fn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:R.DYNAMIC_DRAW,data:[],type:R.FLOAT},size:3,update:function(o){var s=o.version==="GAODE2.x"?o.originCoordinates:o.coordinates;return[s[0],s[1],0]}}})}}]),t}(Ma);function iC(e){var r=aC();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function aC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var oC=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;

varying vec4 v_color;

uniform vec2 u_sceneCenterMercator;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));


  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
 
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,sC=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,uC=function(e){(0,De.Z)(t,e);var r=iC(t);function t(){return(0,q.Z)(this,t),r.apply(this,arguments)}return(0,V.Z)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),o=i.opacity,s=i.coverage,l=i.angle;return{u_opacity:o||1,u_coverage:s||1,u_angle:l||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){return me().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){var s;return me().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,this.layer.buildLayerModel({moduleName:"heatmapGrid3d",vertexShader:oC,fragmentShader:sC,triangulation:W0,primitive:R.TRIANGLES,depth:{enable:!0}});case 2:return s=f.sent,f.abrupt("return",[s]);case 4:case"end":return f.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:fn.Attribute,descriptor:{name:"a_Size",buffer:{usage:R.DYNAMIC_DRAW,data:[],type:R.FLOAT},size:1,update:function(o){var s=o.size;return Array.isArray(s)?[s[0]]:[s]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:fn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:R.STATIC_DRAW,data:[],type:R.FLOAT},size:3,update:function(o,s,l,f,v){return v}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:fn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:R.DYNAMIC_DRAW,data:[],type:R.FLOAT},size:3,update:function(o){var s=o.version==="GAODE2.x"?o.originCoordinates:o.coordinates;return[s[0],s[1],0]}}})}}]),t}(Ma);function lC(e,r){for(var t=[],n=[],i=[],o=e+1,s=r+1,l=e/2,f=r/2,v=0;v<s;v++)for(var y=v-f,b=0;b<o;b++){var T=b-l;n.push(T/l,-y/f,0),i.push(b/e),i.push(1-v/r)}for(var M=0;M<r;M++)for(var O=0;O<e;O++){var k=O+o*M,$=O+o*(M+1),G=O+1+o*(M+1),oe=O+1+o*M;t.push(k,$,oe),t.push($,G,oe)}return{vertices:n,indices:t,uvs:i}}var R1,M1;function cC(e){var r=fC();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function fC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var hC=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,pC=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,dC=`uniform sampler2D u_texture;        // \u70ED\u529B\u5F3A\u5EA6\u56FE
uniform sampler2D u_colorTexture;   // \u6839\u636E\u5F3A\u5EA6\u5206\u5E03\u7684\u8272\u5E26
uniform float u_opacity;
varying vec2 v_texCoord;

uniform vec2 u_ViewportSize;

float getBlurIndusty() {
    float vW = 2.0/u_ViewportSize.x;
    float vH = 2.0/u_ViewportSize.y;
    vec2 vUv = v_texCoord;
    float i11 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i12 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i13 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y + 1.0 * vH) ).r;

    float i21 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y) ).r;
    float i22 = texture2D( u_texture, vec2( vUv.x , vUv.y) ).r;
    float i23 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y) ).r;

    float i31 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y-1.0*vH) ).r;
    float i32 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y-1.0*vH) ).r;
    float i33 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y-1.0*vH) ).r;

    return(
        i11 + 
        i12 + 
        i13 + 
        i21 + 
        i21 + 
        i22 + 
        i23 + 
        i31 + 
        i32 + 
        i33
        )/9.0;
}


void main(){
    // float intensity = texture2D(u_texture, v_texCoord).r;
    float intensity = getBlurIndusty();
    vec4 color = texture2D(u_colorTexture, vec2(intensity, 0.0));

    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,vC=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;

void main() {
  v_texCoord = a_Uv;

  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,mC=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,gC=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;


#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,_C=ii.isEqual,I1=(R1=(0,gt.b2)(),R1(M1=function(e){(0,De.Z)(t,e);var r=cC(t);function t(){return(0,q.Z)(this,t),r.apply(this,arguments)}return(0,V.Z)(t,[{key:"render",value:function(i){var o=this,s=this.rendererService,l=s.clear,f=s.useFramebuffer,v=this.layer.getLayerConfig(),y=v.rampColors;f(this.heatmapFramerBuffer,function(){l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:o.heatmapFramerBuffer}),o.drawIntensityMode()}),_C(this.preRampColors,y)||this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode(i):this.draw3DHeatMap(i)}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){var s,l,f,v,y,b,T,M,O,k;return me().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return l=this.rendererService,f=l.createFramebuffer,v=l.getViewportSize,y=l.createTexture2D,b=this.styleAttributeService.getLayerStyleAttribute("shape"),T=(b==null||(s=b.scale)===null||s===void 0?void 0:s.field)||"heatmap",this.shapeType=T,G.next=6,this.buildHeatMapIntensity();case 6:return this.intensityModel=G.sent,this.colorModel=T==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap(),M=v(),O=M.width,k=M.height,this.heatmapFramerBuffer=f({color:y({width:Math.floor(O/4),height:Math.floor(k/4),wrapS:R.CLAMP_TO_EDGE,wrapT:R.CLAMP_TO_EDGE,min:R.LINEAR,mag:R.LINEAR}),depth:!1}),this.updateColorTexture(),G.abrupt("return",[this.intensityModel,this.colorModel]);case 12:case"end":return G.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){return me().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.initModels());case 1:case"end":return l.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:fn.Attribute,descriptor:{name:"a_Dir",buffer:{usage:R.DYNAMIC_DRAW,data:[],type:R.FLOAT},size:2,update:function(o,s,l){return[l[3],l[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:fn.Attribute,descriptor:{name:"a_Size",buffer:{usage:R.DYNAMIC_DRAW,data:[],type:R.FLOAT},size:1,update:function(o){var s=o.size,l=s===void 0?1:s;return[l]}}})}},{key:"buildHeatMapIntensity",value:function(){var n=(0,Ct.Z)(me().mark(function o(){var s;return me().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.layer.triangulation=C1,f.next=3,this.layer.buildLayerModel({moduleName:"heatmapIntensity",vertexShader:gC,fragmentShader:mC,triangulation:C1,depth:{enable:!1},cull:{enable:!0,face:Qi(this.mapService.version)}});case 3:return s=f.sent,f.abrupt("return",s);case 5:case"end":return f.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildHeatmapColor",value:function(){this.shaderModuleService.registerModule("heatmapColor",{vs:vC,fs:dC});var i=this.shaderModuleService.getModule("heatmapColor"),o=i.vs,s=i.fs,l=i.uniforms,f=this.rendererService,v=f.createAttribute,y=f.createElements,b=f.createBuffer,T=f.createModel;return T({vs:o,fs:s,attributes:{a_Position:v({buffer:b({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:R.FLOAT}),size:3}),a_Uv:v({buffer:b({data:[0,1,1,1,0,0,1,0],type:R.FLOAT}),size:2})},uniforms:(0,H.Z)({},l),depth:{enable:!1},elements:y({data:[0,2,1,2,3,1],type:R.UNSIGNED_INT,count:6})})}},{key:"drawIntensityMode",value:function(){var i,o=this.layer.getLayerConfig(),s=o.opacity,l=o.intensity,f=l===void 0?10:l,v=o.radius,y=v===void 0?5:v;this.layerService.beforeRenderData(this.layer),this.layer.hooks.beforeRender.call(),(i=this.intensityModel)===null||i===void 0||i.draw({uniforms:{u_opacity:s||1,u_radius:y,u_intensity:f},blend:{enable:!0,func:{srcRGB:R.ONE,srcAlpha:1,dstRGB:R.ONE,dstAlpha:1}},stencil:{enable:!1,mask:255,func:{cmp:514,ref:1,mask:255}}}),this.layer.hooks.afterRender.call()}},{key:"drawColorMode",value:function(i){var o,s=this.layer.getLayerConfig(),l=s.opacity;(o=this.colorModel)===null||o===void 0||o.draw({uniforms:{u_opacity:l||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer},blend:this.getBlend(),stencil:this.getStencil(i)})}},{key:"draw3DHeatMap",value:function(i){var o,s=this.layer.getLayerConfig(),l=s.opacity,f=ve.create();ve.invert(f,this.cameraService.getViewProjectionMatrixUncentered()),(o=this.colorModel)===null||o===void 0||o.draw({uniforms:{u_opacity:l||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,Wt.Z)(f)},blend:{enable:!0,func:{srcRGB:R.SRC_ALPHA,srcAlpha:1,dstRGB:R.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},stencil:this.getStencil(i)})}},{key:"build3dHeatMap",value:function(){var i=this.rendererService.getViewportSize,o=i(),s=o.width,l=o.height,f=lC(s/4,l/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:pC,fs:hC});var v=this.shaderModuleService.getModule("heatmap3dColor"),y=v.vs,b=v.fs,T=v.uniforms,M=this.rendererService,O=M.createAttribute,k=M.createElements,$=M.createBuffer,G=M.createModel;return G({vs:y,fs:b,attributes:{a_Position:O({buffer:$({data:f.vertices,type:R.FLOAT}),size:3}),a_Uv:O({buffer:$({data:f.uvs,type:R.FLOAT}),size:2})},primitive:R.TRIANGLES,uniforms:(0,H.Z)({},T),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:R.SRC_ALPHA,srcAlpha:1,dstRGB:R.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:k({data:f.indices,type:R.UNSIGNED_INT,count:f.indices.length})})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var i=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var o=this.layer.getLayerConfig(),s=o.rampColors,l=So(s);this.colorTexture=i({data:new Uint8Array(l.data),width:l.width,height:l.height,wrapS:R.CLAMP_TO_EDGE,wrapT:R.CLAMP_TO_EDGE,min:R.NEAREST,mag:R.NEAREST,flipY:!1}),this.preRampColors=s}}]),t}(Ma))||M1);function yC(e){var r=xC();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function xC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var bC=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,EC=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;

varying vec4 v_color;

uniform vec2 u_sceneCenterMercator;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,SC=function(e){(0,De.Z)(t,e);var r=yC(t);function t(){return(0,q.Z)(this,t),r.apply(this,arguments)}return(0,V.Z)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),o=i.opacity,s=i.coverage,l=i.angle;return{u_opacity:o||1,u_coverage:s||.9,u_angle:l||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){return me().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){var s;return me().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,this.layer.buildLayerModel({moduleName:"heatmapHexagon",vertexShader:EC,fragmentShader:bC,triangulation:w1,depth:{enable:!1},primitive:R.TRIANGLES});case 2:return s=f.sent,f.abrupt("return",[s]);case 4:case"end":return f.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:fn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:R.DYNAMIC_DRAW,data:[],type:R.FLOAT},size:3,update:function(o){var s=o.version==="GAODE2.x"?o.originCoordinates:o.coordinates;return[s[0],s[1],0]}}})}}]),t}(Ma),AC={heatmap:I1,heatmap3d:I1,grid:nC,grid3d:uC,hexagon:SC},TC=AC;function wC(e){var r=CC();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function CC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var RC=function(e){(0,De.Z)(t,e);var r=wC(t);function t(){var n;(0,q.Z)(this,t);for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return n=r.call.apply(r,[this].concat(o)),(0,B.Z)((0,Ie.Z)(n),"type","HeatMapLayer"),n}return(0,V.Z)(t,[{key:"buildModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){var s;return me().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return s=this.getModelType(),this.layerModel=new TC[s](this),f.next=4,this.initLayerModels();case 4:case"end":return f.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"renderModels",value:function(){var i=this,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=this.getModelType();return s==="heatmap"?(this.layerModel&&this.layerModel.render(o),this):this.encodeDataLength<=0&&!this.forceRender?this:(this.hooks.beforeRender.call(),this.models.forEach(function(l){return l.draw({uniforms:i.layerModel.getUninforms(),blend:i.layerModel.getBlend(),stencil:i.layerModel.getStencil(o)})}),this.hooks.afterRender.call(),this)}},{key:"updateModelData",value:function(i){i.attributes&&i.elements?this.models[0].updateAttributesAndElements(i.attributes,i.elements):console.warn("data error")}},{key:"getModelType",value:function(){var i,o=this.styleAttributeService.getLayerStyleAttribute("shape"),s=this.getLayerConfig(),l=s.shape3d,f=this.getSource(),v=f.data.type,y=(o==null||(i=o.scale)===null||i===void 0?void 0:i.field)||"heatmap";return y==="heatmap"||y==="heatmap3d"?"heatmap":v==="hexagon"?(l==null?void 0:l.indexOf(y))===-1?"hexagon":"grid3d":v==="grid"?(l==null?void 0:l.indexOf(y))===-1?"grid":"grid3d":"heatmap"}}]),t}(Ip);function MC(e){var r=IC();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function IC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var PC=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
  if(gl_FragColor.a < 0.01)
    discard;
}
`,OC=`precision highp float;
uniform mat4 u_ModelMatrix;

attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));
 
}
`,DC=function(e){(0,De.Z)(t,e);var r=MC(t);function t(){return(0,q.Z)(this,t),r.apply(this,arguments)}return(0,V.Z)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),o=i.opacity;return{u_opacity:o||1,u_texture:this.texture}}},{key:"initModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){var s,l,f,v;return me().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return s=this.layer.getSource(),l=this.rendererService.createTexture2D,this.texture=l({height:0,width:0}),b.next=5,s.data.images;case 5:return f=b.sent,this.texture=l({data:f[0],width:f[0].width,height:f[0].height,mag:R.LINEAR,min:R.LINEAR}),b.next=9,this.layer.buildLayerModel({moduleName:"rasterImage",vertexShader:OC,fragmentShader:PC,triangulation:Sg,primitive:R.TRIANGLES,blend:{enable:!0},depth:{enable:!1}});case 9:return v=b.sent,b.abrupt("return",[v]);case 11:case"end":return b.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy()}},{key:"buildModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){return me().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.initModels());case 1:case"end":return l.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:fn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:R.DYNAMIC_DRAW,data:[],type:R.FLOAT},size:2,update:function(o,s,l){return[l[3],l[4]]}}})}}]),t}(Ma),kC={image:DC},FC=kC;function BC(e){var r=LC();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function LC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var P1=function(e){(0,De.Z)(t,e);var r=BC(t);function t(){var n;(0,q.Z)(this,t);for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return n=r.call.apply(r,[this].concat(o)),(0,B.Z)((0,Ie.Z)(n),"type","ImageLayer"),n}return(0,V.Z)(t,[{key:"buildModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){var s;return me().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return s=this.getModelType(),this.layerModel=new FC[s](this),f.next=4,this.initLayerModels();case 4:case"end":return f.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getDefaultConfig",value:function(){var i=this.getModelType(),o={image:{}};return o[i]}},{key:"getModelType",value:function(){return"image"}}]),t}(Ip);function NC(e){var r=UC();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function UC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var zC=`varying vec4 v_dash_array;
varying vec4 v_color;
varying float v_distance_ratio;

uniform float segmentNumber;


#pragma include "picking"

void main() {
  gl_FragColor = v_color;

  float flag = 0.;
  float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    flag = 1.;
  };
  gl_FragColor.a *=flag;
  
  gl_FragColor = filterColor(gl_FragColor);
}`,ZC=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

uniform float segmentNumber;
varying vec4 v_color;


uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;
varying float v_distance_ratio;
#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
  // dash: index / (segmentNumber - 1.);
  // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
  return index / (segmentNumber - 1.);
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  vec2 s = source;
  vec2 t = target;
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    s = unProjCustomCoord(source);
    t = unProjCustomCoord(target);
  }
  float total_Distance = pixelDistance(s, t) / 2.0 * PI;
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;

  v_distance_ratio = segmentIndex / segmentNumber;

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, thetaOffset), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, thetaOffset), 0.0, 1.0));
 
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));

  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + offset, 0, 1.0));

  gl_PointSize = 5.0;
  setPickingColor(a_PickingColor);
}
`,VC=`
#define Animate 0.0
#define LineTexture 1.0
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;
varying vec4 v_lineData;


#pragma include "picking"

void main() {
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  gl_FragColor = v_color;
  

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_lineData.b, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (v_lineData.r / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float count = v_lineData.g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);
    float v = v_lineData.a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
}`,jC=`#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;
varying vec4 v_lineData;
varying vec2 v_distance_ratio;


#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    // dash: index / (segmentNumber - 1.);
    // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
    //  return index / (segmentNumber - 1.);
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;
  v_color.a = v_color.a * opacity;

  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  
  if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

 v_lineData.b = d_distance_ratio;

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, thetaOffset), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, thetaOffset), 0.0, 1.0));

  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
 v_lineData.r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel_texture(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    v_lineData.g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
    v_lineData.a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }

  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + offset, 0, 1.0));

  setPickingColor(a_PickingColor);
}
`,HC=`varying vec4 v_color;

#pragma include "picking"

void main() {
// \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E

  gl_FragColor = v_color;
  gl_FragColor = filterColor(gl_FragColor);
}`,WC=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

uniform float segmentNumber;
varying vec4 v_color;
varying float v_segmentIndex;

uniform float u_lineDir: 1.0;

uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;




#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, thetaOffset), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, thetaOffset), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E

  v_color = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  v_color.a *= opacity;

  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + offset, 0, 1.0));

  setPickingColor(a_PickingColor);
}
`,GC={solid:0,dash:1},SL=ii.isNumber,XC=function(e){(0,De.Z)(t,e);var r=NC(t);function t(){var n;(0,q.Z)(this,t);for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return n=r.call.apply(r,[this].concat(o)),(0,B.Z)((0,Ie.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:R.NEAREST,min:R.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,V.Z)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),o=i.opacity,s=o===void 0?1:o,l=i.sourceColor,f=i.targetColor,v=i.textureBlend,y=v===void 0?"normal":v,b=i.lineType,T=b===void 0?"solid":b,M=i.dashArray,O=M===void 0?[10,5]:M,k=i.forward,$=k===void 0?!0:k,G=i.lineTexture,oe=G===void 0?!1:G,ye=i.iconStep,Le=ye===void 0?100:ye,$e=i.segmentNumber,ut=$e===void 0?30:$e;O.length===2&&O.push(0,0);var vt=0,Rt=[0,0,0,0],Jt=[0,0,0,0];return l&&f&&(Rt=fi(l),Jt=fi(f),vt=1),this.rendererService.getDirty()&&this.texture.bind(),(0,H.Z)({u_textureBlend:y==="normal"?0:1,segmentNumber:ut,u_line_type:GC[T||"solid"],u_dash_array:O,u_blur:.9,u_lineDir:$?1:-1,u_texture:this.texture,u_line_texture:oe?1:0,u_icon_step:Le,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:vt,u_sourceColor:Rt,u_targetColor:Jt},this.getStyleAttribute())}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),o=i.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){return me().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var i=this.layer.getLayerConfig(),o=i.sourceColor,s=i.targetColor,l=i.lineType;return l==="dash"?{frag:zC,vert:ZC,type:"Dash"}:o&&s?{frag:HC,vert:WC,type:"Linear"}:{frag:VC,vert:jC,type:""}}},{key:"buildModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){var s,l,f,v,y,b,T,M;return me().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return s=this.layer.getLayerConfig(),l=s.segmentNumber,f=l===void 0?30:l,v=this.getShaders(),y=v.frag,b=v.vert,T=v.type,k.next=4,this.layer.buildLayerModel({moduleName:"lineArc2d"+T,vertexShader:b,fragmentShader:y,inject:this.getInject(),triangulation:Ag,depth:{enable:!1},styleOption:{segmentNumber:f}});case 4:return M=k.sent,k.abrupt("return",[M]);case 6:case"end":return k.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:fn.Attribute,descriptor:{name:"a_Size",buffer:{usage:R.DYNAMIC_DRAW,data:[],type:R.FLOAT},size:1,update:function(s){var l=s.size,f=l===void 0?1:l;return Array.isArray(f)?[f[0]]:[f]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:fn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:R.STATIC_DRAW,data:[],type:R.FLOAT},size:4,update:function(s,l,f){return[f[3],f[4],f[5],f[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:fn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:R.DYNAMIC_DRAW,data:[],type:R.FLOAT},size:2,update:function(s){var l=i.iconService.getIconMap(),f=s.texture,v=l[f]||{x:0,y:0},y=v.x,b=v.y;return[y,b]}}})}}]),t}(Ma);function $C(e){var r=YC();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function YC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var qC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;
varying vec4 v_line_data;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;


varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];


#pragma include "picking"

void main() {
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_line_data.g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;

  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = v_line_data.b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = v_line_data.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,KC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;

uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;
varying vec4 v_line_data;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {

  v_color = a_Color;
  v_color.a = v_color.a * opacity;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  v_line_data.g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    v_line_data.b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    v_line_data.a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }


  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + project_pixel(offset), curr.z * thetaOffset, 1.0));

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,QC=`
#define Animate 0.0
uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_Color;

varying float v_distance_ratio;
#pragma include "picking"

void main() {

  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  gl_FragColor = v_Color;

  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,JC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;
attribute vec2 a_iconMapUV;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;

uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_distance_ratio;

varying vec4 v_dash_array;
varying vec4 v_color;
varying vec2 v_iconMapUV;
varying vec4 v_Color;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }


  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);

  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  v_Color = mix(u_sourceColor, u_targetColor, a_Position.x/segmentNumber);

  v_Color.a *= opacity;

  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,e3={solid:0,dash:1},t3=function(e){(0,De.Z)(t,e);var r=$C(t);function t(){var n;(0,q.Z)(this,t);for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return n=r.call.apply(r,[this].concat(o)),(0,B.Z)((0,Ie.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:R.NEAREST,min:R.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,V.Z)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),o=i.sourceColor,s=i.targetColor,l=i.textureBlend,f=l===void 0?"normal":l,v=i.lineType,y=v===void 0?"solid":v,b=i.dashArray,T=b===void 0?[10,5]:b,M=i.lineTexture,O=M===void 0?!1:M,k=i.iconStep,$=k===void 0?100:k,G=i.segmentNumber,oe=G===void 0?30:G,ye=i.globalArcHeight,Le=ye===void 0?10:ye;T.length===2&&T.push(0,0);var $e=0,ut=[0,0,0,0],vt=[0,0,0,0];return o&&s&&(ut=fi(o),vt=fi(s),$e=1),this.rendererService.getDirty()&&this.texture.bind(),(0,H.Z)({u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:Z0,u_global_height:Le,u_textureBlend:f==="normal"?0:1,segmentNumber:oe,u_line_type:e3[y]||0,u_dash_array:T,u_texture:this.texture,u_line_texture:O?1:0,u_icon_step:$,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:$e,u_sourceColor:ut,u_targetColor:vt},this.getStyleAttribute())}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),o=i.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){return me().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var i=this.layer.getLayerConfig(),o=i.sourceColor,s=i.targetColor;return o&&s?{frag:QC,vert:JC,type:"Linear"}:{frag:qC,vert:KC,type:""}}},{key:"buildModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){var s,l,f,v,y,b,T,M;return me().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return s=this.layer.getLayerConfig(),l=s.segmentNumber,f=l===void 0?30:l,v=this.getShaders(),y=v.frag,b=v.vert,T=v.type,k.next=4,this.layer.buildLayerModel({moduleName:"lineArc3d"+T,vertexShader:b,fragmentShader:y,inject:this.getInject(),triangulation:Ag,styleOption:{segmentNumber:f}});case 4:return M=k.sent,k.abrupt("return",[M]);case 6:case"end":return k.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:fn.Attribute,descriptor:{name:"a_Size",buffer:{usage:R.DYNAMIC_DRAW,data:[],type:R.FLOAT},size:1,update:function(s){var l=s.size,f=l===void 0?1:l;return Array.isArray(f)?[f[0]]:[f]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:fn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:R.STATIC_DRAW,data:[],type:R.FLOAT},size:4,update:function(s,l,f){return[f[3],f[4],f[5],f[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:fn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:R.DYNAMIC_DRAW,data:[],type:R.FLOAT},size:2,update:function(s){var l=i.iconService.getIconMap(),f=s.texture,v=l[f]||{x:0,y:0},y=v.x,b=v.y;return[y,b]}}})}}]),t}(Ma);function r3(e){var r=n3();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function n3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var i3=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;
varying vec4 v_line_data;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;


varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];


#pragma include "picking"

void main() {
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_line_data.g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;

  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = v_line_data.b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = v_line_data.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,a3=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;

uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;
varying vec4 v_line_data;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {

  v_color = a_Color;
  v_color.a = v_color.a * opacity;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  v_line_data.g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    v_line_data.b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    v_line_data.a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }


  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + project_pixel(offset), curr.z * thetaOffset, 1.0));

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,o3=`
#define Animate 0.0
uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_Color;

varying float v_distance_ratio;
#pragma include "picking"

void main() {

  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  gl_FragColor = v_Color;

  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,s3=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;
attribute vec2 a_iconMapUV;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;

uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_distance_ratio;

varying vec4 v_dash_array;
varying vec4 v_color;
varying vec2 v_iconMapUV;
varying vec4 v_Color;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }


  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);

  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  v_Color = mix(u_sourceColor, u_targetColor, a_Position.x/segmentNumber);

  v_Color.a *= opacity;

  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,u3={solid:0,dash:1},l3=function(e){(0,De.Z)(t,e);var r=r3(t);function t(){var n;(0,q.Z)(this,t);for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return n=r.call.apply(r,[this].concat(o)),(0,B.Z)((0,Ie.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:R.NEAREST,min:R.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,V.Z)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),o=i.opacity,s=o===void 0?1:o,l=i.sourceColor,f=i.targetColor,v=i.textureBlend,y=v===void 0?"normal":v,b=i.lineType,T=b===void 0?"solid":b,M=i.dashArray,O=M===void 0?[10,5]:M,k=i.lineTexture,$=k===void 0?!1:k,G=i.iconStep,oe=G===void 0?100:G,ye=i.segmentNumber,Le=ye===void 0?30:ye,$e=i.globalArcHeight,ut=$e===void 0?10:$e;O.length===2&&O.push(0,0);var vt=0,Rt=[0,0,0,0],Jt=[0,0,0,0];return l&&f&&(Rt=fi(l),Jt=fi(f),vt=1),this.rendererService.getDirty()&&this.texture.bind(),{u_globel:1,u_globel_radius:Z0,u_global_height:ut,u_opacity:s,u_textureBlend:y==="normal"?0:1,segmentNumber:Le,u_line_type:u3[T]||0,u_dash_array:O,u_texture:this.texture,u_line_texture:$?1:0,u_icon_step:oe,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:vt,u_sourceColor:Rt,u_targetColor:Jt}}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),o=i.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){return me().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var i=this.layer.getLayerConfig(),o=i.sourceColor,s=i.targetColor;return o&&s?{frag:o3,vert:s3,type:"Linear"}:{frag:i3,vert:a3,type:""}}},{key:"buildModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){var s,l,f,v,y,b,T,M;return me().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return s=this.layer.getLayerConfig(),l=s.segmentNumber,f=l===void 0?30:l,v=this.getShaders(),y=v.frag,b=v.vert,T=v.type,k.next=4,this.layer.buildLayerModel({moduleName:"lineEarthArc3d"+T,vertexShader:b,fragmentShader:y,triangulation:Ag,depth:{enable:!0},styleOption:{segmentNumber:f}});case 4:return M=k.sent,k.abrupt("return",[M]);case 6:case"end":return k.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:fn.Attribute,descriptor:{name:"a_Size",buffer:{usage:R.DYNAMIC_DRAW,data:[],type:R.FLOAT},size:1,update:function(s){var l=s.size,f=l===void 0?1:l;return Array.isArray(f)?[f[0]]:[f]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:fn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:R.STATIC_DRAW,data:[],type:R.FLOAT},size:4,update:function(s,l,f){return[f[3],f[4],f[5],f[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:fn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:R.DYNAMIC_DRAW,data:[],type:R.FLOAT},size:2,update:function(s){var l=i.iconService.getIconMap(),f=s.texture,v=l[f]||{x:0,y:0},y=v.x,b=v.y;return[y,b]}}})}}]),t}(Ma),O1={circle:2,triangle:2,diamond:4,rect:2,classic:3,halfTriangle:2,none:0},Hl=1/2;function c3(e,r){var t=r.width,n=t===void 0?2:t,i=r.height,o=i===void 0?1:i;return{vertices:[0,Hl*e,1*e*n,-(o+Hl)*e,1*e*n,(o-Hl)*e,0,Hl*e,1*e*n,-(o+Hl)*e,1*e*n,(o-Hl)*e],indices:[3,4,5],outLineIndices:[0,1,2],normals:[1*e,-2*e,1,-2*e,1.5*e,1,1*e,1.5*e,1,0,0,0,0,0,0,0,0,0],dimensions:2}}function f3(e,r){var t=r.width,n=t===void 0?2:t,i=r.height,o=i===void 0?3:i;return{vertices:[0,0,1*e*n,1*o,1*e*n,-1*o,0,0,1*e*n,1*o,1*e*n,-1*o],outLineIndices:[0,1,2],indices:[3,4,5],normals:[0,-1.5*e,1,2,1*e,1,-2,1*e,1,0,0,0,0,0,0,0,0,0],dimensions:2}}function h3(e,r){var t=r.width,n=t===void 0?2:t,i=r.height,o=i===void 0?2:i;return{vertices:[0,o/2,e*n*1,o/2,e*n*1,-o/2,0,-o/2,0,o/2,e*n*1,o/2,e*n*1,-o/2,0,-o/2],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-e,1,1,0,1,0,-e,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]}}function p3(e,r){var t=r.width,n=t===void 0?2:t,i=r.height,o=i===void 0?3:i;return{vertices:[0,0,1*n*e,.5*o,2*n*e,0,1*n*e,-.5*o,0,0,1*n*e,.5*o,2*n*e,0,1*n*e,-.5*o],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-e,1,1,0,1,0,-e,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]}}function v3(e,r){var t=r.width,n=t===void 0?2:t,i=r.height,o=i===void 0?3:i;return{vertices:[0,0,2*e*n,1*o,1.5*e*n,0,2*e*n,-1*o,0,0,2*e*n,1*o,1.5*e*n,0,2*e*n,-1*o],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-e,1,1,0,1,0,-e,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]}}function m3(e,r){var t=r.width,n=t===void 0?2:t,i=r.height,o=i===void 0?2:i,s=H0(),l=fs().flatten([s]),f=fs()(l.vertices,l.holes,l.dimensions),v=s.map(function(y){return[y[0]*n*e,y[1]*o]}).flat();return{vertices:[].concat((0,Wt.Z)(v),(0,Wt.Z)(v)),dimensions:2,indices:f.map(function(y){return y+s.length}),outLineIndices:f,normals:[].concat((0,Wt.Z)(s.map(function(y){return[y[1]*o,y[0]*n*e,1]}).flat()),(0,Wt.Z)(new Array(s.length*3).fill(0)))}}function g3(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=arguments.length>2?arguments[2]:void 0,n=(0,cl.Z)(t.source)==="object"?t.source.type:t.source,i=(0,cl.Z)(t.target)==="object"?t.target.type:t.target,o=(0,cl.Z)(t.source)==="object"?t.source:{},s=o.width,l=s===void 0?n?O1[n]:0:s,f=o.height,v=f===void 0?2:f,y=(0,cl.Z)(t.target)==="object"?t.target:{},b=y.width,T=b===void 0?i?O1[i]:0:b,M=y.height,O=M===void 0?2:M;return{vertices:[0,Hl,1*l].concat((0,Wt.Z)(e),[1,Hl,-1*T],(0,Wt.Z)(e),[1,-Hl,-1*T],(0,Wt.Z)(e),[0,-Hl,1*l],(0,Wt.Z)(e),[0,Hl,1*l],(0,Wt.Z)(e),[1,Hl,-1*T],(0,Wt.Z)(e),[1,-Hl,-1*T],(0,Wt.Z)(e),[0,-Hl,1*l],(0,Wt.Z)(e)),outLineIndices:[0,1,2,0,2,3].map(function(k){return k+r}),indices:[4,5,6,4,6,7].map(function(k){return k+r}),normals:[1,-1,1,1,1,1,-1,0,1,-1,0,1,0,0,0,0,0,0,0,0,0,0,0,0],dimensions:2}}function D1(e,r){var t=(0,cl.Z)(e)==="object"?e.type:e,n=r==="source"?1:-1,i=(0,cl.Z)(e)==="object"?e:{};switch(t){case"circle":return m3(n,i);case"triangle":return f3(n,i);case"diamond":return p3(n,i);case"rect":return h3(n,i);case"classic":return v3(n,i);case"halfTriangle":return c3(n,i);default:return{vertices:[],indices:[],normals:[],dimensions:2,outLineIndices:[],outLineNormals:[]}}}function _3(e){var r=e.coordinates.flat(),t=1,n=1;return{vertices:[1,0,0].concat((0,Wt.Z)(r),[1,2,-3],(0,Wt.Z)(r),[1,1,-3],(0,Wt.Z)(r),[0,1,0],(0,Wt.Z)(r),[0,0,0],(0,Wt.Z)(r),[1,0,0],(0,Wt.Z)(r),[1,2,-3],(0,Wt.Z)(r),[1,1,-3],(0,Wt.Z)(r),[0,1,0],(0,Wt.Z)(r),[0,0,0],(0,Wt.Z)(r)),normals:[-t,2*n,1,2*n,-n,1,n,-n,1,n,-n,1,-t,-n,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],indices:[0,1,2,0,2,3,0,3,4,5,6,7,5,7,8,5,8,9],size:7}}function y3(e,r){return r?x3(e,r):_3(e)}function x3(e,r){var t=e.coordinates.flat(),n=r,i=n.target,o=i===void 0?"classic":i,s=n.source,l=s===void 0?"circle":s,f=k1(D1(l,"source"),t,0,0),v=g3(t,f.vertices.length/7,r),y=k1(D1(o,"target"),t,1,f.vertices.length/7+v.vertices.length/7),b={vertices:[].concat((0,Wt.Z)(f.vertices),(0,Wt.Z)(v.vertices),(0,Wt.Z)(y.vertices)),indices:[].concat((0,Wt.Z)(f.outLineIndices),(0,Wt.Z)(v.outLineIndices),(0,Wt.Z)(y.outLineIndices),(0,Wt.Z)(f.indices),(0,Wt.Z)(v.indices),(0,Wt.Z)(y.indices)),normals:[].concat((0,Wt.Z)(f.normals),(0,Wt.Z)(v.normals),(0,Wt.Z)(y.normals)),size:7};return b}function k1(e,r){for(var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,i=[],o=e.vertices,s=e.indices,l=e.dimensions,f=e.outLineIndices,v=0;v<o.length;v+=l)i.push.apply(i,[t,o[v+1],o[v]].concat((0,Wt.Z)(r)));return(0,H.Z)((0,H.Z)({},e),{},{vertices:i,indices:s.map(function(y){return y+n}),outLineIndices:f.map(function(y){return y+n})})}function b3(e){var r=E3();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function E3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var S3=`#extension GL_OES_standard_derivatives : enable

varying vec4 v_color;


// line texture

#pragma include "picking"

void main() {
gl_FragColor = v_color;
gl_FragColor = filterColor(gl_FragColor);
}
`,A3=`attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec4 a_Instance;
attribute vec3 a_Normal;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;


#pragma include "projection"
#pragma include "project"
#pragma include "picking"
varying vec4 v_color;
uniform float u_gap_width: 1.0;
uniform float u_stroke_width: 1.0;
uniform float u_stroke_opacity: 1.0;

vec2 project_pixel_offset(vec2 offsets) {

   vec2 data = project_pixel(offsets);
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return data;
  }

  return vec2(data.x, -data.y);;
}

vec2 line_dir(vec2 target, vec2 source) {

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
     return normalize(target - source);
  }
  return normalize(ProjectFlat(target) - ProjectFlat(source));
}

float flag_gap() {
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
     return 1.;
  }
  return -1.;

}


void main() {

// \u900F\u660E\u5EA6\u8BA1\u7B97
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  vec2 flowlineDir = line_dir(target,source);
  vec2 perpendicularDir = vec2(flowlineDir.y, flowlineDir.x); // mapbox || \u9AD8\u5FB7


  vec2 position = mix(source, target, a_Position.x);
  
  float lengthCommon = length(project_position(vec4(target,0,1)) - project_position(vec4(source,0,1)));  //    
  vec2 offsetDistances = a_Size.x * project_pixel_offset(vec2(a_Position.y, a_Position.z)); // Mapbox || \u9AD8\u5FB7
  vec2 limitedOffsetDistances = clamp(   
   offsetDistances,
   project_pixel(-lengthCommon*.2), project_pixel(lengthCommon*.2)
  );


  float startOffsetCommon = project_pixel(offsets[0]);
  float endOffsetCommon = project_pixel(offsets[1]);
  float endpointOffset = mix(
    clamp(startOffsetCommon, 0.0, lengthCommon*.2),
    -clamp(endOffsetCommon, 0.0, lengthCommon*.2),
    a_Position.x
  );

  vec2 normalsCommon =  u_stroke_width * project_pixel_offset(vec2(a_Normal.x, a_Normal.y)); // mapbox || \u9AD8\u5FB7

  float gapCommon = flag_gap() * project_pixel(u_gap_width);
  vec3 offsetCommon = vec3(
    flowlineDir * (limitedOffsetDistances[1] + normalsCommon.y + endpointOffset * 1.05) -
    perpendicularDir * (limitedOffsetDistances[0] + gapCommon + normalsCommon.x),
    0.0
  );


  vec4 project_pos = project_position(vec4(position.xy, 0, 1.0));

  vec4 fillColor = vec4(a_Color.rgb, a_Color.a * opacity);
  v_color = mix(fillColor, vec4(u_stroke.xyz, u_stroke.w * fillColor.w * u_stroke_opacity), a_Normal.z);

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offsetCommon.xy, 0., 1.0));



  setPickingColor(a_PickingColor);
}
`,T3=function(e){(0,De.Z)(t,e);var r=b3(t);function t(){return(0,q.Z)(this,t),r.apply(this,arguments)}return(0,V.Z)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),o=i.gapWidth,s=o===void 0?2:o,l=i.strokeWidth,f=l===void 0?1:l,v=i.stroke,y=v===void 0?"#000":v,b=i.strokeOpacity,T=b===void 0?1:b;return(0,H.Z)({u_gap_width:s,u_stroke_width:f,u_stroke:fi(y),u_stroke_opacity:T},this.getStyleAttribute())}},{key:"initModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){return me().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){var s;return me().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,this.layer.buildLayerModel({moduleName:"flow_line",vertexShader:A3,fragmentShader:S3,inject:this.getInject(),triangulation:y3,styleOption:this.layer.getLayerConfig().symbol,primitive:R.TRIANGLES,depth:{enable:!1},pick:!1});case 2:return s=f.sent,f.abrupt("return",[s]);case 4:case"end":return f.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:fn.Attribute,descriptor:{name:"a_Size",buffer:{usage:R.DYNAMIC_DRAW,data:[],type:R.FLOAT},size:2,update:function(o){var s=o.size,l=s===void 0?1:s;return Array.isArray(l)?[l[0],l[1]]:[l,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:fn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:R.STATIC_DRAW,data:[],type:R.FLOAT},size:4,update:function(o,s,l){return[l[3],l[4],l[5],l[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:fn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:R.STATIC_DRAW,data:[],type:R.FLOAT},size:3,update:function(o,s,l,f,v){return v}}})}}]),t}(Ma);function w3(e){var r=C3();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function C3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var R3=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
varying vec4 v_line_data;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {

  float animateSpeed = 0.0;
  float d_segmentIndex = v_line_data.g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
     gl_FragColor.a *= v_color.a;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  if(u_line_type == LineTypeDash) {
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      // \u5B9E\u7EBF\u90E8\u5206
    } else {
      // \u865A\u7EBF\u90E8\u5206
      discard;
    };
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = v_line_data.b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_animate.x == Animate) {
      u = gl_FragColor.a/v_color.a;
    }

    float v = v_line_data.a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,M3=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;
varying vec4 v_line_data;


#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return index / (segmentNumber - 1.);
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  v_color = a_Color;
  v_color.a = v_color.a * opacity;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*16.0; // total_Distance*16.0 \u8C03\u6574\u9ED8\u8BA4\u7684\u6548\u679C
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;
  }

  if(u_animate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

v_line_data.g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
v_line_data.b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
v_line_data.a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }



  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + offset, 0, 1.0));
  setPickingColor(a_PickingColor);
}

`,I3={solid:0,dash:1},P3=function(e){(0,De.Z)(t,e);var r=w3(t);function t(){var n;(0,q.Z)(this,t);for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return n=r.call.apply(r,[this].concat(o)),(0,B.Z)((0,Ie.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:R.NEAREST,min:R.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,V.Z)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),o=i.sourceColor,s=i.targetColor,l=i.textureBlend,f=l===void 0?"normal":l,v=i.lineType,y=v===void 0?"solid":v,b=i.dashArray,T=b===void 0?[10,5]:b,M=i.lineTexture,O=M===void 0?!1:M,k=i.iconStep,$=k===void 0?100:k,G=i.segmentNumber,oe=G===void 0?30:G;T.length===2&&T.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var ye=0,Le=[0,0,0,0],$e=[0,0,0,0];return o&&s&&(Le=fi(o),$e=fi(s),ye=1),(0,H.Z)({u_textureBlend:f==="normal"?0:1,segmentNumber:oe,u_line_type:I3[y]||0,u_dash_array:T,u_texture:this.texture,u_line_texture:O?1:0,u_icon_step:$,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:ye,u_sourceColor:Le,u_targetColor:$e},this.getStyleAttribute())}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),o=i.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){return me().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){var s,l,f,v;return me().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return s=this.layer.getLayerConfig(),l=s.segmentNumber,f=l===void 0?30:l,b.next=3,this.layer.buildLayerModel({moduleName:"lineGreatCircle",vertexShader:M3,fragmentShader:R3,triangulation:Ag,styleOption:{segmentNumber:f},inject:this.getInject(),depth:{enable:!1}});case 3:return v=b.sent,b.abrupt("return",[v]);case 5:case"end":return b.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:fn.Attribute,descriptor:{name:"a_Size",buffer:{usage:R.DYNAMIC_DRAW,data:[],type:R.FLOAT},size:1,update:function(s){var l=s.size,f=l===void 0?1:l;return Array.isArray(f)?[f[0]]:[f]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:fn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:R.STATIC_DRAW,data:[],type:R.FLOAT},size:4,update:function(s,l,f){return[f[3],f[4],f[5],f[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:fn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:R.DYNAMIC_DRAW,data:[],type:R.FLOAT},size:2,update:function(s){var l=i.iconService.getIconMap(),f=s.texture,v=l[f]||{x:0,y:0},y=v.x,b=v.y;return[y,b]}}})}}]),t}(Ma),AL=function(e){return e[e.solid=0]="solid",e[e.dash=1]="dash",e}({}),wg=function(e){return e.VERTICAL="vertical",e.HORIZONTAL="horizontal",e}({}),O3=function(e){return e.NORMAL="normal",e.REPLACE="replace",e}({}),Y0=function(e){return e[e.pixel=0]="pixel",e[e.meter=1]="meter",e}({}),TL=function(e){return e.ALWAYS="always",e.DRAGEND="dragend",e}({});function D3(e){var r=k3();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function k3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var F3=`#define LineTypeSolid 0.0
varying vec4 v_color;

// dash
varying vec4 v_dash_array;
varying float v_d_distance_ratio;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

// [animate, duration, interval, trailLength],
void main() {

  gl_FragColor = v_color;

  float dashLength = mod(v_d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    // \u5B9E\u7EBF\u90E8\u5206
  } else {
    // \u865A\u7EBF\u90E8\u5206
    discard;
  };

  gl_FragColor = filterColor(gl_FragColor);
}
`,B3=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;
uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;

uniform mat4 u_ModelMatrix;

uniform vec4 u_dash_array: [10.0, 5., 0, 0];

uniform float u_vertexScale: 1.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;
varying float v_d_distance_ratio;


void main() {

  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  vec2 offset = project_pixel(size.xy);
  v_d_distance_ratio = a_DistanceAndIndex.x / a_Total_Distance;


  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));
  
 float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,L3=`#extension GL_OES_standard_derivatives : enable
#define Animate 0.0
#define LineTexture 1.0
uniform float u_textureBlend;

uniform float u_strokeWidth: 0.0;

uniform vec3 u_blur;
varying vec4 v_color;
varying vec4 v_stroke;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying vec2 v_iconMapUV;
varying vec4 v_texture_data;


#pragma include "picking"

uniform float u_time;
uniform vec4 u_animate: [ 1, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8
// [animate, duration, interval, trailLength],
void main() {
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_texture_data.r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = v_texture_data.g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = v_texture_data.b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = v_texture_data.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor += pattern;
    } else { // replace
        pattern.a *= v_color.a;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = pattern;
    }
  } 

  float v = v_texture_data.a;
  float strokeWidth = min(0.5, u_strokeWidth);
  // \u7ED8\u5236 border
  if(strokeWidth > 0.01) {
    float borderOuterWidth = strokeWidth / 2.0;


    if(v >= 1.0 - strokeWidth || v <= strokeWidth) {
      if(v > strokeWidth) { // \u5916\u4FA7
        float linear = smoothstep(0.0, 1.0, (v - (1.0 - strokeWidth))/strokeWidth);
        //  float linear = step(0.0, (v - (1.0 - borderWidth))/borderWidth);
        gl_FragColor.rgb = mix(gl_FragColor.rgb, v_stroke.rgb, linear);
      } else if(v <= strokeWidth) {
        float linear = smoothstep(0.0, 1.0, v/strokeWidth);
        gl_FragColor.rgb = mix(v_stroke.rgb, gl_FragColor.rgb, linear);
      }
    }

    if(v < borderOuterWidth) {
      gl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);
    } else if(v > 1.0 - borderOuterWidth) {
      gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
    }
  }

  // blur
  float blurV = v_texture_data.a;
  if(blurV < 0.5) {
    gl_FragColor.a *= mix(u_blur.r, u_blur.g, blurV/0.5);
  } else {
    gl_FragColor.a *= mix(u_blur.g, u_blur.b, (blurV - 0.5)/0.5);
  }
  
  gl_FragColor = filterColor(gl_FragColor);
}
`,F1=`
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;

uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_stroke;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;
uniform float u_arrow: 0.0;
uniform float u_arrowHeight: 3.0;
uniform float u_arrowWidth: 2.0;
uniform float u_tailWidth: 1.0;

varying vec4 v_texture_data;

vec2 calculateArrow(vec2 offset) {
  /*
  * \u5728\u652F\u6301\u7BAD\u5934\u7684\u65F6\u5019\uFF0C\u7B2C\u4E8C\u3001\u7B2C\u4E09\u7EC4\u9876\u70B9\u662F\u989D\u5916\u63D2\u5165\u7528\u4E8E\u6784\u5EFA\u9876\u70B9\u7684
  */
  float arrowFlag = -1.0;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // \u9AD8\u5FB7 2.0 \u7684\u65CB\u8F6C\u89D2\u5EA6\u4E0D\u540C
    arrowFlag = 1.0;
  }
  float pi = arrowFlag * 3.1415926/2.;
  if(a_Miter < 0.) {
    // \u6839\u636E\u7EBF\u7684\u4E24\u4FA7\u504F\u79FB\u4E0D\u540C\u3001\u65CB\u8F6C\u7684\u65B9\u5411\u76F8\u53CD
    pi = -pi;
  }
  highp float angle_sin = sin(pi);
  highp float angle_cos = cos(pi);
  // \u8BA1\u7B97\u5782\u76F4\u4E0E\u7EBF\u65B9\u5411\u7684\u65CB\u8F6C\u77E9\u9635
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float arrowWidth = u_arrowWidth;
  float arrowHeight = u_arrowHeight;

  vec2 arrowOffset = vec2(0.0);
  /*
  * a_DistanceAndIndex.y \u7528\u4E8E\u6807\u8BB0\u5F53\u524D\u9876\u70B9\u5C5E\u4E8E\u54EA\u4E00\u7EC4\uFF08\u4E24\u4E2A\u9876\u70B9\u4E00\u7EC4\uFF0C\u6784\u6210\u7EBF\u7684\u5176\u5B9E\u662F\u77E9\u5F62\uFF0C\u6700\u7B80\u9700\u8981\u56DB\u4E2A\u9876\u70B9\u3001\u4E24\u7EC4\u9876\u70B9\u6784\u6210\uFF09
  */
  if(a_DistanceAndIndex.y == 0.0) {
    // \u7BAD\u5934\u5C16\u90E8
    offset = vec2(0.0);
  } else if(a_DistanceAndIndex.y == 1.0) {
    // \u7BAD\u5934\u4E24\u4FA7
    arrowOffset = rotation_matrix*(offset * arrowHeight);
    offset += arrowOffset; // \u6CBF\u7EBF\u504F\u79FB
    offset = offset * arrowWidth; // \u5782\u76F4\u7EBF\u5411\u5916\u504F\u79FB\uFF08\u662F\u6784\u5EFA\u7BAD\u5934\u4E24\u4FA7\u7684\u9876\u70B9\uFF09
  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {
    // \u504F\u79FB\u5176\u4F59\u7684\u70B9\u4F4D\uFF08\u5C06\u957F\u5EA6\u8BA9\u4F4D\u7ED9\u7BAD\u5934\uFF09
    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;
    offset += arrowOffset;// \u6CBF\u7EBF\u504F\u79FB
  }

  return offset;
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  v_color = a_Color;
  v_color.a *= opacity;
  v_stroke = stroke;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 
  if(u_arrow > 0.0) {
      //  \u8BA1\u7B97\u7BAD\u5934
    offset = calculateArrow(offset);

    if(a_DistanceAndIndex.y > 4.0) {
      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);
    }
  }

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  
  v_texture_data = vec4(currentLinePointRatio, lineDistance, d_texPixelLen, texV);
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,N3=`varying vec4 v_color;
varying vec4 v_texture_data;
uniform float u_linearDir: 1.0;
uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"


void main() {
  float linearRadio = v_texture_data.r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  if(u_linearDir < 1.0) {
    linearRadio = v_texture_data.a;
  }

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, linearRadio);
    gl_FragColor.a *= v_color.a;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,U3={solid:0,dash:1},B1=function(e){(0,De.Z)(t,e);var r=D3(t);function t(){var n;(0,q.Z)(this,t);for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return n=r.call.apply(r,[this].concat(o)),(0,B.Z)((0,Ie.Z)(n),"textureEventFlag",!1),(0,B.Z)((0,Ie.Z)(n),"texture",n.createTexture2D({data:[0,0,0,0],mag:R.NEAREST,min:R.NEAREST,premultiplyAlpha:!1,width:1,height:1})),(0,B.Z)((0,Ie.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:R.NEAREST,min:R.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,V.Z)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),o=i.sourceColor,s=i.targetColor,l=i.textureBlend,f=l===void 0?"normal":l,v=i.lineType,y=v===void 0?"solid":v,b=i.dashArray,T=b===void 0?[10,5,0,0]:b,M=i.lineTexture,O=M===void 0?!1:M,k=i.iconStep,$=k===void 0?100:k,G=i.vertexHeightScale,oe=G===void 0?20:G,ye=i.strokeWidth,Le=ye===void 0?0:ye,$e=i.raisingHeight,ut=$e===void 0?0:$e,vt=i.heightfixed,Rt=vt===void 0?!1:vt,Jt=i.linearDir,Mr=Jt===void 0?wg.VERTICAL:Jt,br=i.blur,pn=br===void 0?[1,1,1]:br;T.length===2&&T.push(0,0),this.rendererService.getDirty()&&this.texture&&this.texture.bind();var kn=0,Pi=[0,0,0,0],xa=[0,0,0,0];return o&&s&&(Pi=fi(o),xa=fi(s),kn=1),(0,H.Z)({u_textureBlend:f===O3.NORMAL?0:1,u_line_type:U3[y],u_dash_array:T,u_blur:pn,u_texture:this.texture,u_line_texture:O?1:0,u_icon_step:$,u_textSize:[1024,this.iconService.canvasHeight||128],u_strokeWidth:Le,u_linearDir:Mr===wg.VERTICAL?1:0,u_linearColor:kn,u_sourceColor:Pi,u_targetColor:xa,u_heightfixed:Number(Rt),u_vertexScale:oe,u_raisingHeight:Number(ut)},this.getStyleAttribute())}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),o=i.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){return me().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.textureEventFlag||(this.textureEventFlag=!0,this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture)),l.abrupt("return",this.buildModels());case 2:case"end":return l.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){var s,l,f,v,y,b,T,M;return me().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return s=this.layer.getLayerConfig(),l=s.depth,f=l===void 0?!1:l,v=this.getShaders(),y=v.frag,b=v.vert,T=v.type,this.layer.triangulation=jp,k.next=5,this.layer.buildLayerModel({moduleName:"line"+T,vertexShader:b,fragmentShader:y,triangulation:jp,inject:this.getInject(),depth:{enable:f}});case 5:return M=k.sent,k.abrupt("return",[M]);case 7:case"end":return k.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getShaders",value:function(){var i=this.layer.getLayerConfig(),o=i.sourceColor,s=i.targetColor,l=i.lineType;return l==="dash"?{frag:F3,vert:B3,type:"Dash"}:o&&s?{frag:N3,vert:F1,type:"Linear"}:{frag:L3,vert:F1,type:""}}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:fn.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:R.STATIC_DRAW,data:[],type:R.FLOAT},size:2,update:function(s,l,f,v,y,b){return b===void 0?[f[3],10]:[f[3],b]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:fn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:R.STATIC_DRAW,data:[],type:R.FLOAT},size:1,update:function(s,l,f){return[f[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:fn.Attribute,descriptor:{name:"a_Size",buffer:{usage:R.DYNAMIC_DRAW,data:[],type:R.FLOAT},size:2,update:function(s){var l=s.size,f=l===void 0?1:l;return Array.isArray(f)?[f[0],f[1]]:[f,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:fn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:R.STATIC_DRAW,data:[],type:R.FLOAT},size:3,update:function(s,l,f,v,y){return y}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:fn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:R.STATIC_DRAW,data:[],type:R.FLOAT},size:1,update:function(s,l,f){return[f[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:fn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:R.DYNAMIC_DRAW,data:[],type:R.FLOAT},size:2,update:function(s){var l=i.iconService.getIconMap(),f=s.texture,v=l[f]||{x:0,y:0},y=v.x,b=v.y;return[y,b]}}})}}]),t}(Ma);function z3(e){var r=Z3();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function Z3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var V3=`
varying vec4 v_Color;
#pragma include "picking"
void main() {

  gl_FragColor = v_Color; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,j3=`
attribute float a_Miter;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;


uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;
uniform sampler2D u_texture;
uniform float u_linearDir: 1.0;
varying vec4 v_Color;


#pragma include "projection"
#pragma include "picking"


void main() {


  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  float linearRadio =currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  if(u_linearDir < 1.0) {
    linearRadio = texV;
  }

  v_Color = texture2D(u_texture, vec2(linearRadio, 0.5));

  v_Color.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6



  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,wL=ii.isNumber,H3=function(e){(0,De.Z)(t,e);var r=z3(t);function t(){var n;(0,q.Z)(this,t);for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return n=r.call.apply(r,[this].concat(o)),(0,B.Z)((0,Ie.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;n.colorTexture&&n.colorTexture.destroy();var f=n.layer.getLayerConfig(),v=f.rampColors,y=So(v);n.colorTexture=l({data:new Uint8Array(y.data),width:y.width,height:y.height,wrapS:R.CLAMP_TO_EDGE,wrapT:R.CLAMP_TO_EDGE,min:R.NEAREST,mag:R.NEAREST,flipY:!1})}),n}return(0,V.Z)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),o=i.opacity,s=o===void 0?1:o,l=i.vertexHeightScale,f=l===void 0?20:l,v=i.raisingHeight,y=v===void 0?0:v,b=i.heightfixed,T=b===void 0?!1:b,M=i.linearDir,O=M===void 0?wg.VERTICAL:M;return this.rendererService.getDirty()&&this.colorTexture.bind(),(0,H.Z)({u_linearDir:O===wg.VERTICAL?1:0,u_texture:this.colorTexture,u_heightfixed:Number(T),u_vertexScale:f,u_raisingHeight:Number(y)},this.getStyleAttribute())}},{key:"initModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){return me().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),l.abrupt("return",this.buildModels());case 2:case"end":return l.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.colorTexture)===null||i===void 0||i.destroy()}},{key:"buildModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){var s,l,f,v;return me().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return s=this.layer.getLayerConfig(),l=s.depth,f=l===void 0?!1:l,this.layer.triangulation=G0,b.next=4,this.layer.buildLayerModel({moduleName:"lineRampColors",vertexShader:j3,fragmentShader:V3,triangulation:G0,inject:this.getInject(),depth:{enable:f}});case 4:return v=b.sent,b.abrupt("return",[v]);case 6:case"end":return b.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:fn.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:R.STATIC_DRAW,data:[],type:R.FLOAT},size:2,update:function(o,s,l,f,v,y){return y===void 0?[l[3],10]:[l[3],y]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:fn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:R.STATIC_DRAW,data:[],type:R.FLOAT},size:1,update:function(o,s,l){return[l[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:fn.Attribute,descriptor:{name:"a_Size",buffer:{usage:R.DYNAMIC_DRAW,data:[],type:R.FLOAT},size:2,update:function(o){var s=o.size,l=s===void 0?1:s;return Array.isArray(l)?[l[0],l[1]]:[l,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:fn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:R.STATIC_DRAW,data:[],type:R.FLOAT},size:3,update:function(o,s,l,f,v){return v}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:fn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:R.STATIC_DRAW,data:[],type:R.FLOAT},size:1,update:function(o,s,l){return[l[4]]}}})}}]),t}(Ma);function W3(e){var r=G3();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function G3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var X3=`
varying vec4 v_color;
void main() {
  gl_FragColor = v_color;

}
`,$3=`uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
varying float v_distanceScale;
varying vec4 v_color;
void main() {
  gl_FragColor = mix(u_sourceColor, u_targetColor, v_distanceScale);
  gl_FragColor.a *= v_color.a; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,L1=`attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Position;

attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;


uniform float u_vertexScale: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;



#pragma include "projection"

varying vec4 v_color;
varying float v_distanceScale;

void main() {

  v_color = a_Color; 
  v_distanceScale = a_Distance / a_Total_Distance;
  v_color.a = v_color.a * opacity;
  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_Size.y) + h * 0.2, 1.0));
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      h *= 2.0/pow(2.0, 20.0 - u_Zoom);
    }

    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));
    gl_PointSize = 10.0;
  }
}
`,CL=ii.isNumber,Y3=function(e){(0,De.Z)(t,e);var r=W3(t);function t(){return(0,q.Z)(this,t),r.apply(this,arguments)}return(0,V.Z)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),o=i.opacity,s=o===void 0?1:o,l=i.sourceColor,f=i.targetColor,v=i.vertexHeightScale,y=v===void 0?20:v,b=0,T=[0,0,0,0],M=[0,0,0,0];return l&&f&&(T=fi(l),M=fi(f),b=1),(0,H.Z)({u_linearColor:b,u_sourceColor:T,u_targetColor:M,u_vertexScale:y},this.getStyleAttribute())}},{key:"initModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){return me().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getShaders",value:function(){var i=this.layer.getLayerConfig(),o=i.sourceColor,s=i.targetColor;return o&&s?{frag:$3,vert:L1,type:"lineSimpleLinear"}:{frag:X3,vert:L1,type:"lineSimpleNormal"}}},{key:"buildModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){var s,l,f,v,y;return me().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return s=this.getShaders(),l=s.frag,f=s.vert,v=s.type,T.next=3,this.layer.buildLayerModel({moduleName:v,vertexShader:f,fragmentShader:l,triangulation:Lw,inject:this.getInject(),primitive:R.LINES,depth:{enable:!1},pick:!1});case 3:return y=T.sent,T.abrupt("return",[y]);case 5:case"end":return T.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distance",type:fn.Attribute,descriptor:{name:"a_Distance",buffer:{usage:R.STATIC_DRAW,data:[],type:R.FLOAT},size:1,update:function(o,s,l){return[l[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:fn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:R.STATIC_DRAW,data:[],type:R.FLOAT},size:1,update:function(o,s,l){return[l[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:fn.Attribute,descriptor:{name:"a_Size",buffer:{usage:R.DYNAMIC_DRAW,data:[],type:R.FLOAT},size:2,update:function(o){var s=o.size,l=s===void 0?1:s;return Array.isArray(l)?[l[0],l[1]]:[l,0]}}})}}]),t}(Ma);function q3(e){var r=K3();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function K3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Q3=`#define Animate 0.0
#define LineTexture 1.0

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_textureBlend;
uniform float u_iconStepCount;
uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying vec2 v_iconMapUV;
varying float v_blur;
varying float v_radio;
varying vec4 v_color;
varying vec4 v_dataset;

#pragma include "picking"

void main() {
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_dataset.r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float v = v_dataset.a;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= v_color.a; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = v_dataset.g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = v_dataset.b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = v_dataset.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 start
    float flag = 0.0;
    if(u > 1.0/u_iconStepCount) {
      flag = 1.0;
    }
    u = fract(u*u_iconStepCount);
    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 end

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    // Tip: \u5224\u65AD\u7EB9\u7406\u95F4\u9694
    if(flag > 0.0) {
      pattern = vec4(0.0);
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  }
  

  // blur - AA
  if(v < v_blur) {
    gl_FragColor.a = mix(0.0, gl_FragColor.a, v/v_blur);
  } else if(v > 1.0 - v_blur) {
    gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,J3=`#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;
attribute vec2 a_iconMapUV;
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;

uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;
uniform float u_heightfixed;
uniform float u_linearColor: 0;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;
varying vec4 v_color;
varying float v_blur;
varying float v_radio;
varying vec4 v_dataset;

void main() {


  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    d_texPixelLen = project_pixel(u_icon_step);
  } else {
    d_texPixelLen = u_icon_step;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_animate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }

  float miter = (a_Miter + 1.0)/2.0;
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  v_dataset[0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  v_dataset[1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  v_dataset[2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  v_dataset[3] = miter;          // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C 0 - 1

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float originSize = a_Size.x;  // \u56FA\u5B9A\u9AD8\u5EA6
  if(u_heightfixed < 1.0) {    
     originSize = project_float_meter(a_Size.x); // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
  }


  float wallHeight = originSize * miter;
  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));

  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);
  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w * opacity);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,eR=function(e){(0,De.Z)(t,e);var r=q3(t);function t(){var n;(0,q.Z)(this,t);for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return n=r.call.apply(r,[this].concat(o)),(0,B.Z)((0,Ie.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:R.NEAREST,min:R.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,V.Z)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),o=i.sourceColor,s=i.targetColor,l=i.textureBlend,f=l===void 0?"normal":l,v=i.heightfixed,y=v===void 0?!1:v,b=i.lineTexture,T=b===void 0?!1:b,M=i.iconStep,O=M===void 0?100:M,k=i.iconStepCount,$=k===void 0?1:k;this.rendererService.getDirty()&&this.texture.bind();var G=0,oe=[0,0,0,0],ye=[0,0,0,0];return o&&s&&(oe=fi(o),ye=fi(s),G=1),(0,H.Z)({u_heightfixed:Number(y),u_textureBlend:f==="normal"?0:1,u_texture:this.texture,u_line_texture:T?1:0,u_iconStepCount:$,u_icon_step:O,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:G,u_sourceColor:oe,u_targetColor:ye},this.getStyleAttribute())}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),o=i.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){return me().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){var s;return me().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,this.layer.buildLayerModel({moduleName:"lineWall",vertexShader:J3,fragmentShader:Q3,triangulation:G0,inject:this.getInject(),depth:{enable:!1},blend:this.getBlend()});case 2:return s=f.sent,f.abrupt("return",[s]);case 4:case"end":return f.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"distance",type:fn.Attribute,descriptor:{name:"a_Distance",buffer:{usage:R.STATIC_DRAW,data:[],type:R.FLOAT},size:1,update:function(s,l,f){return[f[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:fn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:R.STATIC_DRAW,data:[],type:R.FLOAT},size:1,update:function(s,l,f){return[f[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:fn.Attribute,descriptor:{name:"a_Size",buffer:{usage:R.DYNAMIC_DRAW,data:[],type:R.FLOAT},size:2,update:function(s){var l=s.size,f=l===void 0?1:l;return Array.isArray(f)?[f[0],f[1]]:[f,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:fn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:R.STATIC_DRAW,data:[],type:R.FLOAT},size:3,update:function(s,l,f,v,y){return y}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:fn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:R.STATIC_DRAW,data:[],type:R.FLOAT},size:1,update:function(s,l,f){return[f[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:fn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:R.DYNAMIC_DRAW,data:[],type:R.FLOAT},size:2,update:function(s){var l=i.iconService.getIconMap(),f=s.texture,v=l[f]||{x:0,y:0},y=v.x,b=v.y;return[y,b]}}})}}]),t}(Ma),tR={arc:XC,arc3d:t3,greatcircle:P3,wall:eR,line:B1,simple:Y3,linearline:H3,earthArc3d:l3,flowline:T3},rR=tR;function nR(e){var r=iR();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function iR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var q0=function(e){(0,De.Z)(t,e);var r=nR(t);function t(){var n;(0,q.Z)(this,t);for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return n=r.call.apply(r,[this].concat(o)),(0,B.Z)((0,Ie.Z)(n),"type","LineLayer"),(0,B.Z)((0,Ie.Z)(n),"enableShaderEncodeStyles",["opacity","offsets","stroke","thetaOffset"]),(0,B.Z)((0,Ie.Z)(n),"arrowInsertCount",0),(0,B.Z)((0,Ie.Z)(n),"defaultSourceConfig",{data:[{lng1:100,lat1:30,lng2:130,lat2:30}],options:{parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}}}),n}return(0,V.Z)(t,[{key:"buildModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){var s;return me().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return s=this.getModelType(),this.layerModel=new rR[s](this),f.next=4,this.initLayerModels();case 4:case"end":return f.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getDefaultConfig",value:function(){var i=this.getModelType(),o={line:{},linearline:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"},tileLine:{},earthArc3d:{},flowline:{},arrow:{}};return o[i]}},{key:"getModelType",value:function(){var i;if(this.layerType)return this.layerType;var o=this.styleAttributeService.getLayerStyleAttribute("shape"),s=o==null||(i=o.scale)===null||i===void 0?void 0:i.field;return s||"line"}},{key:"processData",value:function(i){if(this.getModelType()!=="simple")return i;var o=[];return i.map(function(s){if(Array.isArray(s.coordinates)&&Array.isArray(s.coordinates[0])&&Array.isArray(s.coordinates[0][0])){var l=(0,H.Z)({},s);s.coordinates.map(function(f){o.push((0,H.Z)((0,H.Z)({},l),{},{coordinates:f}))})}else o.push(s)}),o}}]),t}(Ip);function aR(e){var r=oR();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function oR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var sR=`
uniform float u_additive;
uniform float u_stroke_opacity : 1;

uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

varying vec4 v_color;
varying float v_blur;
varying float v_innerRadius;

#pragma include "picking"
void main() {
  vec2 center = vec2(0.5);

  // Tip: \u7247\u5143\u5230\u4E2D\u5FC3\u70B9\u7684\u8DDD\u79BB 0 - 1
  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;
  // Tip: \u7247\u5143\u7684\u526A\u5207\u6210\u5706\u5F62
  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);


  if(v_innerRadius < 0.99) {
    // \u5F53\u5B58\u5728 stroke \u4E14 stroke > 0.01
    float blurWidth = (1.0 - v_blur)/2.0;
    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);
    if(fragmengTocenter > v_innerRadius + blurWidth) {
      gl_FragColor = stroke;
    } else if(fragmengTocenter > v_innerRadius - blurWidth){
      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);
      gl_FragColor = mix(v_color, stroke, mixR);
    } else {
      gl_FragColor = v_color;
    }
  } else {
    // \u5F53\u4E0D\u5B58\u5728 stroke \u6216 stroke <= 0.01
    gl_FragColor = v_color;
  }

  gl_FragColor = filterColor(gl_FragColor);
  
  if(u_additive > 0.0) {
    gl_FragColor *= circleClipOpacity;
  } else {
    gl_FragColor.a *= circleClipOpacity;
  }

}
`,uR=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;

attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_stroke_width;

varying float v_blur;
varying float v_innerRadius;



#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = vec4(a_Color.xyz, a_Color.w * u_opacity);
  v_blur = 1.0 - max(2.0/a_Size, 0.05);
  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);
  
  vec2 offset = project_pixel(u_offsets);
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }
  
  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function N1(e){var r=e.coordinates;return{vertices:(0,Wt.Z)(r),indices:[0],size:r.length}}var lR=function(e){(0,De.Z)(t,e);var r=aR(t);function t(){return(0,q.Z)(this,t),r.apply(this,arguments)}return(0,V.Z)(t,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),o=i.opacity,s=o===void 0?1:o,l=i.offsets,f=l===void 0?[0,0]:l,v=i.blend,y=i.strokeOpacity,b=y===void 0?1:y,T=i.strokeWidth,M=T===void 0?0:T,O=i.stroke,k=O===void 0?"#fff":O;return{u_additive:v==="additive"?1:0,u_opacity:s,u_offsets:f,u_stroke_opacity:b,u_stroke_width:M,u_stroke_color:fi(k)}}},{key:"initModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){return me().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){var s;return me().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.layer.triangulation=N1,f.next=3,this.layer.buildLayerModel({moduleName:"pointSimple",vertexShader:uR,fragmentShader:sR,triangulation:N1,depth:{enable:!1},primitive:R.POINTS});case 3:return s=f.sent,f.abrupt("return",[s]);case 5:case"end":return f.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:fn.Attribute,descriptor:{name:"a_Size",buffer:{usage:R.DYNAMIC_DRAW,data:[],type:R.FLOAT},size:1,update:function(o){var s=o.size,l=s===void 0?1:s;return Array.isArray(l)?[l[0]]:[l]}}})}}]),t}(Ma);function cR(e){var r=fR();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function fR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var hR=`varying vec4 v_color;
uniform float u_opacity: 1.0;

uniform float u_pickLight: 0.0;

#pragma include "picking"


uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;
varying float v_lightWeight;
varying float v_barLinearZ;
void main() {

   gl_FragColor = v_color;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - v_barLinearZ): v_barLinearZ;
  }

  // picking
  if(u_pickLight > 0.0) {
    gl_FragColor = filterColorAlpha(gl_FragColor, v_lightWeight);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,pR=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_globel;
uniform float u_r;
uniform mat4 u_ModelMatrix;

varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;
varying float v_lightWeight;
varying float v_barLinearZ;
// \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143


#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  v_barLinearZ =  a_Position.z;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  v_lightWeight = lightWeight;
  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    v_color = mix(u_sourceColor, u_targetColor, barLinearZ);
    v_color.rgb *= lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     v_color = a_Color;
  }
  v_color.a *= u_opacity;

    
  // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
  //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
  float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
  float xRadian = getXRadian(a_Pos.y, r);
  float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
  float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
  mat4 mx = mat4(
    1,0,0,0,  
    0,xcos,-xsin,0,  
    0,xsin,xcos,0,  
    0,0,0,1);

  //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
  float yRadian = getYRadian(a_Pos.x, a_Pos.z);
  float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
  float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
  mat4 my = mat4(
    ycos,0,-ysin,0,  
    0,1,0,0,  
    ysin,0,ycos,0,  
    0,0,0,1);

  gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);
  

  setPickingColor(a_PickingColor);
}
`,dR=ii.isNumber,vR=function(e){(0,De.Z)(t,e);var r=cR(t);function t(){var n;(0,q.Z)(this,t);for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return n=r.call.apply(r,[this].concat(o)),(0,B.Z)((0,Ie.Z)(n),"raiseCount",0),(0,B.Z)((0,Ie.Z)(n),"raiseRepeat",0),n}return(0,V.Z)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),o=i.animateOption,s=o===void 0?{enable:!1,speed:.01,repeat:!1}:o,l=i.opacity,f=l===void 0?1:l,v=i.sourceColor,y=i.targetColor,b=i.pickLight,T=b===void 0?!1:b,M=i.heightfixed,O=M===void 0?!1:M,k=i.opacityLinear,$=k===void 0?{enable:!1,dir:"up"}:k,G=i.lightEnable,oe=G===void 0?!0:G,ye=0,Le=[0,0,0,0],$e=[0,0,0,0];if(v&&y&&(Le=fi(v),$e=fi(y),ye=1),this.raiseCount<1&&this.raiseRepeat>0&&s.enable){var ut=s.speed,vt=ut===void 0?.01:ut;this.raiseCount+=vt,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}return{u_pickLight:Number(T),u_heightfixed:Number(O),u_r:s.enable&&this.raiseRepeat>0?this.raiseCount:1,u_opacity:dR(f)?f:1,u_linearColor:ye,u_sourceColor:Le,u_targetColor:$e,u_opacitylinear:Number($.enable),u_opacitylinear_dir:$.dir==="up"?1:0,u_lightEnable:Number(oe)}}},{key:"initModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){return me().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){var s,l,f,v;return me().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return s=this.layer.getLayerConfig(),l=s.animateOption.repeat,f=l===void 0?1:l,this.raiseRepeat=f,b.next=4,this.layer.buildLayerModel({moduleName:"pointEarthExtrude",vertexShader:pR,fragmentShader:hR,triangulation:W0,depth:{enable:!0},cull:{enable:!0,face:Qi(this.mapService.version)},blend:this.getBlend()});case 4:return v=b.sent,b.abrupt("return",[v]);case 6:case"end":return b.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:fn.Attribute,descriptor:{name:"a_Size",buffer:{usage:R.DYNAMIC_DRAW,data:[],type:R.FLOAT},size:3,update:function(o){var s=o.size;if(s){var l=[];return Array.isArray(s)&&(l=s.length===2?[s[0],s[0],s[1]]:s),Array.isArray(s)||(l=[s,s,s]),l}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:fn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:R.STATIC_DRAW,data:[],type:R.FLOAT},size:3,update:function(o,s,l,f,v){return v}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:fn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:R.DYNAMIC_DRAW,data:[],type:R.FLOAT},size:3,update:function(o){var s=Ds(o.coordinates);return _1([s[0],s[1]])}}})}}]),t}(Ma);function mR(e){var r=gR();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function gR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _R=`uniform float u_additive;
uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(outer_df > antialiasblur + 0.018) discard;

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * u_opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), u_stroke_color * u_stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,yR=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;
uniform mat4 u_ModelMatrix;


varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  */
  float newSize = setPickingSize(a_Size);
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1 + u_offsets, 1.0);

  setPickingColor(a_PickingColor);
}
`,xR=function(e){(0,De.Z)(t,e);var r=mR(t);function t(){return(0,q.Z)(this,t),r.apply(this,arguments)}return(0,V.Z)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),o=i.opacity,s=o===void 0?1:o,l=i.strokeOpacity,f=l===void 0?1:l,v=i.strokeWidth,y=v===void 0?0:v,b=i.stroke,T=b===void 0?"rgba(0,0,0,0)":b,M=i.blend,O=i.blur,k=O===void 0?0:O;return{u_blur:k,u_additive:M==="additive"?1:0,u_opacity:s,u_stroke_opacity:f,u_stroke_width:y,u_stroke_color:fi(T)}}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),o=i.animateOption,s=o===void 0?{enable:!1}:o;return{u_animate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){return me().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){var s;return me().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.layer.triangulation=A1,f.next=3,this.layer.buildLayerModel({moduleName:"pointEarthFill",vertexShader:yR,fragmentShader:_R,triangulation:A1,depth:{enable:!0},blend:this.getBlend()});case 3:return s=f.sent,f.abrupt("return",[s]);case 5:case"end":return f.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"animateOption2Array",value:function(i){return[i.enable?0:1,i.speed||1,i.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:fn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:R.DYNAMIC_DRAW,data:[],type:R.FLOAT},size:3,update:function(s,l,f,v){var y=(0,yn.Z)(f,3),b=y[0],T=y[1],M=y[2],O=La.fromValues(0,0,1),k=La.fromValues(b,0,M),$=b>=0?La.angle(O,k):Math.PI*2-La.angle(O,k),G=Math.PI*2-Math.asin(T/100),oe=ve.create();ve.rotateY(oe,oe,$),ve.rotateX(oe,oe,G);var ye=La.fromValues(1,1,0);La.transformMat4(ye,ye,oe),La.normalize(ye,ye);var Le=La.fromValues(-1,1,0);La.transformMat4(Le,Le,oe),La.normalize(Le,Le);var $e=La.fromValues(-1,-1,0);La.transformMat4($e,$e,oe),La.normalize($e,$e);var ut=La.fromValues(1,-1,0);La.transformMat4(ut,ut,oe),La.normalize(ut,ut);var vt=[].concat((0,Wt.Z)(ye),(0,Wt.Z)(Le),(0,Wt.Z)($e),(0,Wt.Z)(ut)),Rt=v%4*3;return[vt[Rt],vt[Rt+1],vt[Rt+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:fn.Attribute,descriptor:{name:"a_Size",buffer:{usage:R.DYNAMIC_DRAW,data:[],type:R.FLOAT},size:1,update:function(s){var l=s.size,f=l===void 0?5:l;return Array.isArray(f)?[f[0]]:[f]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:fn.Attribute,descriptor:{name:"a_Shape",buffer:{usage:R.DYNAMIC_DRAW,data:[],type:R.FLOAT},size:1,update:function(s){var l=s.shape,f=l===void 0?2:l,v=i.layer.getLayerConfig().shape2d,y=v.indexOf(f);return[y]}}})}}]),t}(Ma);function bR(e){var r=ER();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function ER(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var SR=`in vec4 v_color;
in float v_lightWeight;
out vec4 outputColor;


layout(std140) uniform commonUniforms {
  float u_pickLight;
  float u_heightfixed;
  float u_r;
  float u_linearColor;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_opacitylinear;
  float u_opacitylinear_dir;
  float u_lightEnable;
};

#pragma include "picking"

void main() {

  outputColor = v_color;
  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  // picking
  if(u_pickLight > 0.0) {
    outputColor = filterColorAlpha(outputColor, v_lightWeight);
  } else {
    outputColor = filterColor(outputColor);
  }
}
`,AR=`#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in vec3 a_Size;
layout(location = 11) in vec3 a_Extrude;
layout(location = 13) in vec3 a_Normal;

layout(std140) uniform commonUniforms {
  float u_pickLight;
  float u_heightfixed;
  float u_r;
  float u_linearColor;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_opacitylinear;
  float u_opacitylinear_dir;
  float u_lightEnable;
};
out vec4 v_color;
out float v_lightWeight;
out float v_barLinearZ;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {


  vec3 size = a_Size * a_Position;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB

  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Extrude.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;

  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }

  v_lightWeight = lightWeight;

  v_color = a_Color;

    // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    v_color = mix(u_sourceColor, u_targetColor, a_Position.z);
    v_color.a =  v_color.a * opacity;
  } else {
    v_color = vec4(a_Color.rgb * lightWeight, a_Color.w * opacity);
  }

    if(u_opacitylinear > 0.0) {
    v_color.a *= u_opacitylinear_dir > 0.0 ? (1.0 - a_Position.z): a_Position.z;
  }


  gl_Position = project_common_position_to_clipspace_v2(pos);

  setPickingColor(a_PickingColor);
}
`,U1=function(e){(0,De.Z)(t,e);var r=bR(t);function t(){var n;(0,q.Z)(this,t);for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return n=r.call.apply(r,[this].concat(o)),(0,B.Z)((0,Ie.Z)(n),"raiseCount",0),(0,B.Z)((0,Ie.Z)(n),"raiseRepeat",0),n}return(0,V.Z)(t,[{key:"getUninforms",value:function(){var i=this.getCommonUniformsInfo(),o=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,H.Z)((0,H.Z)({},i.uniformsOption),o.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),o=i.animateOption,s=o===void 0?{enable:!1,speed:.01,repeat:!1}:o,l=i.sourceColor,f=i.targetColor,v=i.pickLight,y=v===void 0?!1:v,b=i.heightfixed,T=b===void 0?!1:b,M=i.opacityLinear,O=M===void 0?{enable:!1,dir:"up"}:M,k=i.lightEnable,$=k===void 0?!0:k,G=0,oe=[0,0,0,0],ye=[0,0,0,0];if(l&&f&&(oe=fi(l),ye=fi(f),G=1),this.raiseCount<1&&this.raiseRepeat>0&&s.enable){var Le=s.speed,$e=Le===void 0?.01:Le;this.raiseCount+=$e,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}var ut={u_pickLight:Number(y),u_heightfixed:Number(T),u_r:s.enable&&this.raiseRepeat>0?this.raiseCount:1,u_linearColor:G,u_sourceColor:oe,u_targetColor:ye,u_opacitylinear:Number(O.enable),u_opacitylinear_dir:O.dir==="up"?1:0,u_lightEnable:Number($)},vt=this.getUniformsBufferInfo(ut);return vt}},{key:"initModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){return me().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){var s,l,f,v,y,b;return me().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return s=this.layer.getLayerConfig(),l=s.depth,f=l===void 0?!0:l,v=s.animateOption.repeat,y=v===void 0?1:v,this.raiseRepeat=y,this.initUniformsBuffer(),M.next=5,this.layer.buildLayerModel({moduleName:"pointExtrude",vertexShader:AR,fragmentShader:SR,triangulation:W0,inject:this.getInject(),cull:{enable:!0,face:Qi(this.mapService.version)},depth:{enable:f}});case 5:return b=M.sent,M.abrupt("return",[b]);case 7:case"end":return M.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:fn.Attribute,descriptor:{name:"a_Size",shaderLocation:Ms.SIZE,buffer:{usage:R.DYNAMIC_DRAW,data:[],type:R.FLOAT},size:3,update:function(o){var s=o.size;if(s){var l=[];return Array.isArray(s)&&(l=s.length===2?[s[0],s[0],s[1]]:s),Array.isArray(s)||(l=[s,s,s]),l}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:fn.Attribute,descriptor:{name:"a_Normal",shaderLocation:Ms.NORMAL,buffer:{usage:R.STATIC_DRAW,data:[],type:R.FLOAT},size:3,update:function(o,s,l,f,v){return v}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:fn.Attribute,descriptor:{name:"a_Extrude",shaderLocation:Ms.EXTRUDE,buffer:{usage:R.DYNAMIC_DRAW,data:[],type:R.FLOAT},size:3,update:function(o){var s=Ds(o.coordinates);return[s[0],s[1],0]}}})}}]),t}(Ma);function TR(e){var r=wR();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function wR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var z1=`
uniform float u_additive;


varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"

void main() {

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  
  outer_df = sdCircle(v_data.xy, 1.0);
  inner_df = sdCircle(v_data.xy, r);


  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

  gl_FragColor = v_color;

  float d = length(v_data.xy);
  if(d > 0.5) {
    discard;
  }
  float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_animate.z - u_animate.y * u_time)), 0.0, 1.0);
  
  // \u6839\u636E\u53E0\u52A0\u6A21\u5F0F\u9009\u62E9\u6548\u679C
  if(u_additive > 0.0) {
    gl_FragColor *= intensity;
    // \u4F18\u5316\u6C34\u6CE2\u70B9 blend additive \u6A21\u5F0F\u4E0B\u6709\u7684\u62FE\u53D6\u6548\u679C 
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor = vec4(gl_FragColor.xyz, gl_FragColor.a * intensity);
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,CR=`
layout(std140) uniform commonUniforms {
  vec3 u_blur_height_fixed;
  float u_stroke_width;
  float u_additive;
  float u_stroke_opacity;
  float u_size_unit;
};

in vec4 v_color;
in vec4 v_stroke;
in vec4 v_data;
in float v_radius;

#pragma include "scene_uniforms"
#pragma include "sdf_2d"
#pragma include "picking"

out vec4 outputColor;

void main() {
  int shape = int(floor(v_data.w + 0.5));
  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + u_stroke_width);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(u_stroke_width < 0.01) {
    outputColor = v_color;
  } else {
    outputColor = mix(v_color, v_stroke * u_stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    outputColor *= opacity_t;
    outputColor = filterColorAlpha(outputColor, outputColor.a);
  } else {
    outputColor.a *= opacity_t;
    outputColor = filterColor(outputColor);
  }
   // \u4F5C\u4E3A mask \u6A21\u677F\u65F6\u9700\u8981\u4E22\u5F03\u900F\u660E\u7684\u50CF\u7D20
  if(outputColor.a < 0.01) {
    discard;
  } 
}
`,K0=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 11) in vec3 a_Extrude;
layout(location = 10) in float a_Shape;

layout(std140) uniform commonUniforms {
  vec3 u_blur_height_fixed;
  float u_stroke_width;
  float u_additive;
  float u_stroke_opacity;
  float u_size_unit;
};

out vec4 v_color;
out vec4 v_stroke;
out vec4 v_data;
out float v_radius;

#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"

void main() {
  // \u900F\u660E\u5EA6\u8BA1\u7B97
   v_stroke = stroke;  
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  *  u_meter2coord \u5728\u7B49\u9762\u79EF\u5927\u5C0F\u7684\u65F6\u5019\u8BBE\u7F6E\u5355\u4F4D
  */
  float newSize = setPickingSize(a_Size);
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;



  // unpack color(vec2)
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);

  if(u_size_unit == 1.0) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }

   v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur_height_fixed.x);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + u_offsets);
  vec3 aPosition = a_Position;

  offset = project_pixel(offset);
  offset = rotate_matrix(offset,rotation);
  
  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  float raisingHeight = u_blur_height_fixed.y;

  if(u_blur_height_fixed.z < 1.0) { // false
    raisingHeight = project_pixel(u_blur_height_fixed.y);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_blur_height_fixed.y * mapboxZoomScale;
    }
  }
  
  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, raisingHeight, 1.0));

  setPickingColor(a_PickingColor);
}
`,Z1=function(e){(0,De.Z)(t,e);var r=TR(t);function t(){return(0,q.Z)(this,t),r.apply(this,arguments)}return(0,V.Z)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),o=i.strokeOpacity,s=o===void 0?1:o,l=i.strokeWidth,f=l===void 0?0:l,v=i.blend,y=i.blur,b=y===void 0?0:y,T=i.raisingHeight,M=T===void 0?0:T,O=i.heightfixed,k=O===void 0?!1:O,$=i.unit,G=$===void 0?"pixel":$,oe=(0,H.Z)({u_blur_height_fixed:[b,Number(M),Number(k)],u_additive:v==="additive"?1:0,u_stroke_opacity:s,u_stroke_width:f,u_size_unit:Y0[G]},this.getStyleAttribute()),ye=this.getStyleAttribute();return this.uniformBuffers[0].subData({offset:0,data:new Uint8Array(new Float32Array([].concat((0,Wt.Z)(ye.u_stroke),(0,Wt.Z)(ye.u_offsets),[ye.u_opacity,ye.u_rotation])).buffer)}),this.uniformBuffers[1].subData({offset:0,data:new Uint8Array(new Float32Array([].concat((0,Wt.Z)(oe.u_blur_height_fixed),[oe.u_stroke_width,oe.u_stroke_opacity,oe.u_additive,oe.u_size_unit])).buffer)}),oe}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),o=i.animateOption,s=o===void 0?{enable:!1}:o;return{u_animate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),pf)}},{key:"initModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){return me().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){var s,l,f,v,y,b,T,M,O,k;return me().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return s=this.layer.getLayerConfig(),l=s.animateOption,f=l===void 0?{enable:!1}:l,v=this.getShaders(f),y=v.frag,b=v.vert,T=v.type,this.layer.triangulation=pf,M=this.rendererService.createBuffer({data:new Float32Array(8),isUBO:!0}),O=this.rendererService.createBuffer({data:new Float32Array(8),isUBO:!0}),this.uniformBuffers.push(M,O),G.next=8,this.layer.buildLayerModel({moduleName:T,vertexShader:b,fragmentShader:y,inject:this.getInject(),triangulation:pf,depth:{enable:!1}});case 8:return k=G.sent,G.abrupt("return",[k]);case 10:case"end":return G.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getShaders",value:function(i){if(i.enable)switch(i.type){case"wave":return{frag:z1,vert:K0,type:"pointWave"};default:return{frag:z1,vert:K0,type:"pointWave"}}else return{frag:CR,vert:K0,type:"pointFill"}}},{key:"animateOption2Array",value:function(i){return[i.enable?0:1,i.speed||1,i.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var i=this.layer.getLayerConfig().shape2d;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:fn.Attribute,descriptor:{name:"a_Extrude",shaderLocation:Ms.EXTRUDE,buffer:{usage:R.DYNAMIC_DRAW,data:[],type:R.FLOAT},size:3,update:function(s,l,f,v){var y=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],b=v%4*3;return[y[b],y[b+1],y[b+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:fn.Attribute,descriptor:{name:"a_Size",shaderLocation:Ms.SIZE,buffer:{usage:R.DYNAMIC_DRAW,data:[],type:R.FLOAT},size:1,update:function(s){var l=s.size,f=l===void 0?5:l;return Array.isArray(f)?[f[0]]:[f]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:fn.Attribute,descriptor:{name:"a_Shape",shaderLocation:Ms.SHAPE,buffer:{usage:R.DYNAMIC_DRAW,data:[],type:R.FLOAT},size:1,update:function(s){var l=s.shape,f=l===void 0?2:l,v=i.indexOf(f);return[v]}}})}}]),t}(Ma);function RR(e){var r=MR();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function MR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var IR=`uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

#pragma include "sdf_2d"
#pragma include "picking"
varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv;
varying float v_opacity;

void main() {

  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;
  gl_FragColor = texture2D(u_texture, pos);
  gl_FragColor.a *= v_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,PR=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute vec2 a_Uv;

uniform mat4 u_ModelMatrix;

uniform mat2 u_RotateMatrix;
uniform int u_size_unit;

varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv; // icon \u8D34\u56FE\u7684 uv \u5750\u6807

uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;
varying float v_opacity;
// uniform vec2 u_offsets; // shader \u6CE8\u5165


#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"

void main() {
  vec3 extrude = a_Extrude;
  v_uv = (a_Extrude.xy + 1.0)/2.0;
  v_uv.y = 1.0 - v_uv.y;
  v_Iconuv = a_Uv;
  v_opacity = opacity;
  float newSize = a_Size;
  if(u_size_unit == 1) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }
  
  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec2 offset = (extrude.xy * (newSize) + offsets);

  offset = rotate_matrix(offset,rotation);

  vec3 aPosition = a_Position;

  offset = project_pixel(offset);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  float raisingHeight = u_raisingHeight;
  if(u_heightfixed < 1.0) { // height fixed
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,OR=function(e){(0,De.Z)(t,e);var r=RR(t);function t(){var n;(0,q.Z)(this,t);for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return n=r.call.apply(r,[this].concat(o)),(0,B.Z)((0,Ie.Z)(n),"meter2coord",1),(0,B.Z)((0,Ie.Z)(n),"isMeter",!1),(0,B.Z)((0,Ie.Z)(n),"radian",0),(0,B.Z)((0,Ie.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),n.layerService.throttleRenderLayers();return}n.texture=l({data:n.iconService.getCanvas(),mag:R.LINEAR,min:R.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,V.Z)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),o=i.raisingHeight,s=o===void 0?0:o,l=i.heightfixed,f=l===void 0?!1:l,v=i.unit,y=v===void 0?"pixel":v;return this.rendererService.getDirty()&&this.texture.bind(),(0,H.Z)({u_raisingHeight:Number(s),u_heightfixed:Number(f),u_size_unit:Y0[y],u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]},this.getStyleAttribute())}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Eg)}},{key:"initModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){return me().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.iconService.on("imageUpdate",this.updateTexture),this.updateTexture(),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){var s;return me().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,this.layer.buildLayerModel({moduleName:"pointFillImage",vertexShader:PR,fragmentShader:IR,triangulation:Eg,depth:{enable:!1},inject:this.getInject(),cull:{enable:!0,face:Qi(this.mapService.version)}});case 2:return s=f.sent,f.abrupt("return",[s]);case 4:case"end":return f.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;this.iconService.off("imageUpdate",this.updateTexture),(i=this.texture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"uv",type:fn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:R.DYNAMIC_DRAW,data:[],type:R.FLOAT},size:2,update:function(s){var l=i.iconService.getIconMap(),f=s.shape,v=l[f]||{x:-64,y:-64},y=v.x,b=v.y;return[y,b]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:fn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:R.DYNAMIC_DRAW,data:[],type:R.FLOAT},size:3,update:function(s,l,f,v){var y=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],b=v%4*3;return[y[b],y[b+1],y[b+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:fn.Attribute,descriptor:{name:"a_Size",buffer:{usage:R.DYNAMIC_DRAW,data:[],type:R.FLOAT},size:1,update:function(s){var l=s.size,f=l===void 0?5:l;return Array.isArray(f)?[f[0]]:[f]}}})}}]),t}(Ma);function DR(e){var r=kR();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function kR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var FR=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
varying float v_opacity;
uniform vec2 u_textSize;

#pragma include "picking"

void main(){
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }
      gl_FragColor.a *= v_opacity;
      if (gl_FragColor.a < 0.01) {
         discard;
      }
      gl_FragColor = filterColor(gl_FragColor);
}
`,BR=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
varying float v_opacity;
uniform mat4 u_ModelMatrix;


uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;

#pragma include "projection"
#pragma include "picking"

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  v_color = a_Color;
  v_opacity = opacity;
  v_uv = a_Uv;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  vec2 offset = project_pixel(offsets);

  float raisingHeight = u_raisingHeight;
  if(u_heightfixed < 1.0) { // false
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }


  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, raisingHeight, 1.0));

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`,V1=function(e){(0,De.Z)(t,e);var r=DR(t);function t(){var n;(0,q.Z)(this,t);for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return n=r.call.apply(r,[this].concat(o)),(0,B.Z)((0,Ie.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),setTimeout(function(){n.layerService.throttleRenderLayers()});return}n.texture=l({data:n.iconService.getCanvas(),mag:R.LINEAR,min:R.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,V.Z)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),o=i.raisingHeight,s=o===void 0?0:o,l=i.heightfixed,f=l===void 0?!1:l;return this.rendererService.getDirty()&&this.texture.bind(),(0,H.Z)({u_raisingHeight:Number(s),u_heightfixed:Number(f),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]},this.getStyleAttribute())}},{key:"initModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){return me().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.iconService.on("imageUpdate",this.updateTexture),this.updateTexture(),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){var s;return me().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:BR,fragmentShader:FR,triangulation:Bw,inject:this.getInject(),depth:{enable:!1},primitive:R.POINTS});case 2:return s=f.sent,f.abrupt("return",[s]);case 4:case"end":return f.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:fn.Attribute,descriptor:{name:"a_Size",buffer:{usage:R.DYNAMIC_DRAW,data:[],type:R.FLOAT},size:1,update:function(s){var l=s.size,f=l===void 0?5:l;return Array.isArray(f)?[f[0]]:[f]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:fn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:R.DYNAMIC_DRAW,data:[],type:R.FLOAT},size:2,update:function(s){var l=i.iconService.getIconMap(),f=s.shape,v=l[f]||{x:-64,y:-64},y=v.x,b=v.y;return[y,b]}}})}}]),t}(Ma);function LR(e){var r=NR();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function NR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var UR=`in vec4 v_color;
out vec4 outputColor;
void main() {
  outputColor = v_color;
}`,zR=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;

layout(std140) uniform u_Common {
  float u_size_scale;
};

out vec4 v_color;

#pragma include "projection"
#pragma include "project"

void main() {
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(a_Position, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2., -a_Size /2., 0., 0.);
    gl_Position = project_common_position_to_clipspace(project_pos);
  }

  gl_PointSize = a_Size * u_size_scale *  2.0  * u_DevicePixelRatio;
}
`;function j1(e){var r=e.coordinates;return{vertices:(0,Wt.Z)(r),indices:[0],size:r.length}}var H1=function(e){(0,De.Z)(t,e);var r=LR(t);function t(){return(0,q.Z)(this,t),r.apply(this,arguments)}return(0,V.Z)(t,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var i=this.getStyleAttribute();return this.uniformBuffers[0].subData({offset:0,data:new Uint8Array(new Float32Array([].concat((0,Wt.Z)(i.u_stroke),(0,Wt.Z)(i.u_offsets),[i.u_opacity,i.u_rotation])).buffer)}),this.uniformBuffers[1].subData({offset:0,data:new Uint8Array(new Float32Array([.5]).buffer)}),(0,H.Z)({u_size_scale:.5},i)}},{key:"initModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){return me().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){var s,l,f;return me().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return this.layer.triangulation=j1,s=this.rendererService.createBuffer({data:new Float32Array(8),isUBO:!0}),l=this.rendererService.createBuffer({data:new Float32Array(4),isUBO:!0}),this.uniformBuffers.push(s,l),y.next=6,this.layer.buildLayerModel({moduleName:"pointNormal",vertexShader:zR,fragmentShader:UR,triangulation:j1,inject:this.getInject(),depth:{enable:!1},primitive:R.POINTS,pick:!1});case 6:return f=y.sent,y.abrupt("return",[f]);case 8:case"end":return y.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:fn.Attribute,descriptor:{name:"a_Size",shaderLocation:Ms.SIZE,buffer:{usage:R.DYNAMIC_DRAW,data:[],type:R.FLOAT},size:1,update:function(o){var s=o.size,l=s===void 0?1:s;return Array.isArray(l)?[l[0]]:[l]}}})}}]),t}(Ma);function ZR(e){var r=VR();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function VR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var jR=`
uniform float u_additive;
uniform float u_opacity: 1.0;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
varying vec2 v_exteude;
#pragma include "sdf_2d"
#pragma include "picking"

void main() {

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df = sdCircle(v_data.xy, 1.0);
  float inner_df = sdCircle(v_data.xy, r);

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  gl_FragColor = vec4(v_color.rgb, v_color.a * u_opacity);

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
  } else {
    gl_FragColor.a *= opacity_t;
  }

  if(gl_FragColor.a > 0.0) {
    gl_FragColor = filterColor(gl_FragColor);
  }

  vec2 extrude =  v_exteude;
  vec2 dir = normalize(extrude);
  vec2 baseDir = vec2(1.0, 0.0);
  float pi = 3.14159265359;
  float flag = sign(dir.y);
  float rades = dot(dir, baseDir);
  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;
  // simple AA
  if(radar_v > 0.99) {
    radar_v = 1.0 - (radar_v - 0.99)/0.01;
  }

  gl_FragColor.a *= radar_v;
}
`,HR=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
uniform float u_speed: 1.0;
uniform float u_time;

uniform mat4 u_ModelMatrix;

uniform int u_size_unit;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
varying vec2 v_exteude;

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;
  float newSize = setPickingSize(a_Size);

  float time = u_time * u_speed;
  mat2 rotateMatrix = mat2( 
    cos(time), sin(time), 
    -sin(time), cos(time)
  );
  v_exteude = rotateMatrix * a_Extrude.xy;

  // unpack color(vec2)
  v_color = a_Color;

  // anti-alias
  float blur = 0.0;
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, blur);

  if(u_size_unit == 1) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }
  // radius(16-bit)
  v_radius = newSize;

  vec2 offset = (extrude.xy * (newSize));
  vec3 aPosition = a_Position;
  
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
  offset = project_pixel(offset);
  
  v_data = vec4(extrude.x, extrude.y, antialiasblur, -1.0);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  setPickingColor(a_PickingColor);
}
`,WR=function(e){(0,De.Z)(t,e);var r=ZR(t);function t(){return(0,q.Z)(this,t),r.apply(this,arguments)}return(0,V.Z)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),o=i.opacity,s=o===void 0?1:o,l=i.blend,f=i.speed,v=f===void 0?1:f,y=i.unit,b=y===void 0?"pixel":y;return{u_size_unit:Y0[b],u_speed:v,u_additive:l==="additive"?1:0,u_opacity:s}}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),o=i.animateOption,s=o===void 0?{enable:!1}:o;return{u_animate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Eg)}},{key:"initModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){return me().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){var s;return me().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,this.layer.buildLayerModel({moduleName:"pointRadar",vertexShader:HR,fragmentShader:jR,triangulation:Eg,depth:{enable:!1}});case 2:return s=f.sent,f.abrupt("return",[s]);case 4:case"end":return f.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"animateOption2Array",value:function(i){return[i.enable?0:1,i.speed||1,i.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"extrude",type:fn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:R.DYNAMIC_DRAW,data:[],type:R.FLOAT},size:3,update:function(o,s,l,f){var v=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],y=f%4*3;return[v[y],v[y+1],v[y+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:fn.Attribute,descriptor:{name:"a_Size",buffer:{usage:R.DYNAMIC_DRAW,data:[],type:R.FLOAT},size:1,update:function(o){var s=o.size,l=s===void 0?5:s;return Array.isArray(l)?[l[0]]:[l]}}})}}]),t}(Ma);function GR(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=XR(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var v=t.next();return o=v.done,v},e:function(v){s=!0,l=v},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function XR(e,r){if(e){if(typeof e=="string")return W1(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return W1(e,r)}}function W1(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var $R=function(){function e(r,t,n){(0,q.Z)(this,e),(0,B.Z)(this,"boxCells",[]);var i=this.boxCells;this.xCellCount=Math.ceil(r/n),this.yCellCount=Math.ceil(t/n);for(var o=0;o<this.xCellCount*this.yCellCount;o++)i.push([]);this.boxKeys=[],this.bboxes=[],this.width=r,this.height=t,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/t,this.boxUid=0}return(0,V.Z)(e,[{key:"insert",value:function(t,n,i,o,s){this.forEachCell(n,i,o,s,this.insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(o),this.bboxes.push(s)}},{key:"query",value:function(t,n,i,o,s){return this.queryHitTest(t,n,i,o,!1,s)}},{key:"hitTest",value:function(t,n,i,o,s){return this.queryHitTest(t,n,i,o,!0,s)}},{key:"insertBoxCell",value:function(t,n,i,o,s,l){this.boxCells[s].push(l)}},{key:"queryHitTest",value:function(t,n,i,o,s,l){if(i<0||t>this.width||o<0||n>this.height)return s?!1:[];var f=[];if(t<=0&&n<=0&&this.width<=i&&this.height<=o){if(s)return!0;for(var v=0;v<this.boxKeys.length;v++)f.push({key:this.boxKeys[v],x1:this.bboxes[v*4],y1:this.bboxes[v*4+1],x2:this.bboxes[v*4+2],y2:this.bboxes[v*4+3]});return l?f.filter(l):f}var y={hitTest:s,seenUids:{box:{},circle:{}}};return this.forEachCell(t,n,i,o,this.queryCell,f,y,l),s?f.length>0:f}},{key:"queryCell",value:function(t,n,i,o,s,l,f,v){var y=f.seenUids,b=this.boxCells[s];if(b!==null){var T=this.bboxes,M=GR(b),O;try{for(M.s();!(O=M.n()).done;){var k=O.value;if(!y.box[k]){y.box[k]=!0;var $=k*4;if(t<=T[$+2]&&n<=T[$+3]&&i>=T[$+0]&&o>=T[$+1]&&(!v||v(this.boxKeys[k]))){if(f.hitTest)return l.push(!0),!0;l.push({key:this.boxKeys[k],x1:T[$],y1:T[$+1],x2:T[$+2],y2:T[$+3]})}}}}catch(G){M.e(G)}finally{M.f()}}return!1}},{key:"forEachCell",value:function(t,n,i,o,s,l,f,v){for(var y=this.convertToXCellCoord(t),b=this.convertToYCellCoord(n),T=this.convertToXCellCoord(i),M=this.convertToYCellCoord(o),O=y;O<=T;O++)for(var k=b;k<=M;k++){var $=this.xCellCount*k+O;if(s.call(this,t,n,i,o,$,l,f,v))return}}},{key:"convertToXCellCoord",value:function(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}},{key:"convertToYCellCoord",value:function(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}}]),e}(),YR=$R,qR=function(){function e(r,t){(0,q.Z)(this,e),(0,B.Z)(this,"viewportPadding",100),this.width=r,this.height=t,this.viewportPadding=Math.max(r,t),this.grid=new YR(r+this.viewportPadding,t+this.viewportPadding,25),this.screenRightBoundary=r+this.viewportPadding,this.screenBottomBoundary=t+this.viewportPadding,this.gridRightBoundary=r+2*this.viewportPadding,this.gridBottomBoundary=t+2*this.viewportPadding}return(0,V.Z)(e,[{key:"placeCollisionBox",value:function(t){var n=t.x1+t.anchorPointX+this.viewportPadding,i=t.y1+t.anchorPointY+this.viewportPadding,o=t.x2+t.anchorPointX+this.viewportPadding,s=t.y2+t.anchorPointY+this.viewportPadding;return!this.isInsideGrid(n,i,o,s)||this.grid.hitTest(n,i,o,s)?{box:[]}:{box:[n,i,o,s]}}},{key:"insertCollisionBox",value:function(t,n){var i={featureIndex:n};this.grid.insert(i,t[0],t[1],t[2],t[3])}},{key:"project",value:function(t,n,i){var o=kh.al(n,i,0,1),s=kh.Ue(),l=ve.fromValues.apply(ve,(0,Wt.Z)(t));return kh.fF(s,o,l),{x:(s[0]/s[3]+1)/2*this.width+this.viewportPadding,y:(-s[1]/s[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(t,n,i,o){return i>=0&&t<this.gridRightBoundary&&o>=0&&n<this.gridBottomBoundary}}]),e}();function G1(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=KR(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var v=t.next();return o=v.done,v},e:function(v){s=!0,l=v},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function KR(e,r){if(e){if(typeof e=="string")return X1(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return X1(e,r)}}function X1(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function $1(e){var r=.5,t=.5;switch(e){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0;break;default:r=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":t=1;break;case"top":case"top-right":case"top-left":t=0;break;default:t=.5}return{horizontalAlign:r,verticalAlign:t}}function Y1(e,r,t,n,i){if(i){var o=e[n],s=o.glyph;if(s)for(var l=r[s].advance*o.scale,f=(e[n].x+l)*i,v=t;v<=n;v++)e[v].x-=f}}function q1(e,r,t,n,i,o,s){var l=(r-t)*i,f=(-n*s+.5)*o,v=G1(e),y;try{for(v.s();!(y=v.n()).done;){var b=y.value;b.x+=l,b.y+=f}}catch(T){v.e(T)}finally{v.f()}}function QR(e,r,t,n,i,o,s){var l=-8,f=0,v=l,y=0,b=e.positionedGlyphs,T=o==="right"?1:o==="left"?0:.5,M=b.length;t.forEach(function(oe){if(oe.split("").forEach(function(Le){var $e=r[Le],ut=0;$e&&(b.push({glyph:Le,x:f,y:v+ut,vertical:!1,scale:1,metrics:$e}),f+=$e.advance+s)}),b.length!==M){var ye=f-s;y=Math.max(ye,y),Y1(b,r,M,b.length-1,T)}f=0,v-=n+5});var O=$1(i),k=O.horizontalAlign,$=O.verticalAlign;q1(b,T,k,$,y,n,t.length);var G=v-l;e.top+=-$*G,e.bottom=e.top-G,e.left+=-k*y,e.right=e.left+y}function JR(e,r,t,n,i,o,s){var l=-8,f=0,v=l,y=0,b=e.positionedGlyphs,T=o==="right"?1:o==="left"?0:.5,M=b.length;t.forEach(function(oe){var ye=r[oe],Le=0;if(ye&&(b.push({glyph:oe,x:ye.advance/2,y:v+Le,vertical:!1,scale:1,metrics:ye}),f+=ye.advance+s),b.length!==M){var $e=f-s;y=Math.max($e,y),Y1(b,r,M,b.length-1,T)}f=0,v-=n+5});var O=$1(i),k=O.horizontalAlign,$=O.verticalAlign;q1(b,T,k,$,y,n,t.length);var G=v-l;e.top+=-$*G,e.bottom=e.top-G,e.left+=-k*y,e.right=e.left+y}function eM(e,r,t,n,i,o){var s=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],l=arguments.length>7?arguments[7]:void 0,f=e.split(`
`),v=[],y={positionedGlyphs:v,top:s[1],bottom:s[1],left:s[0],right:s[0],lineCount:f.length,text:e};return l?JR(y,r,f,t,n,i,o):QR(y,r,f,t,n,i,o),v.length?y:!1}function tM(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],t=arguments.length>2?arguments[2]:void 0,n=e.positionedGlyphs,i=n===void 0?[]:n,o=[],s=G1(i),l;try{for(s.s();!(l=s.n()).done;){var f=l.value,v=f.metrics,y=4,b=v.advance*f.scale/2,T=t?[f.x+b,f.y]:[0,0],M=t?[0,0]:[f.x+b+r[0],f.y+r[1]],O=(0-y)*f.scale-b+M[0],k=(0-y)*f.scale+M[1],$=O+v.width*f.scale,G=k+v.height*f.scale,oe={x:O,y:k},ye={x:$,y:k},Le={x:O,y:G},$e={x:$,y:G};o.push({tl:oe,tr:ye,bl:Le,br:$e,tex:v,glyphOffset:T})}}catch(ut){s.e(ut)}finally{s.f()}return o}function rM(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=nM(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var v=t.next();return o=v.done,v},e:function(v){s=!0,l=v},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function nM(e,r){if(e){if(typeof e=="string")return K1(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return K1(e,r)}}function K1(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function iM(e){var r=aM();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function aM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Q1=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec4 v_stroke_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;


#pragma include "picking"
void main() {
  // get style data mapping

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);

  gl_FragColor = mix(v_color, v_stroke_color, smoothstep(0., 0.5, 1.- dist));

  gl_FragColor.a *= alpha;
   // \u4F5C\u4E3A mask \u6A21\u677F\u65F6\u9700\u8981\u4E22\u5F03\u900F\u660E\u7684\u50CF\u7D20
  if (gl_FragColor.a < 0.01) {
    discard;
  }
  gl_FragColor = filterColor(gl_FragColor);
}
`,J1=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;

uniform float u_raisingHeight: 0.0;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying vec4 v_stroke_color;
varying float v_fontScale;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];



#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  
  v_uv = a_tex / u_sdf_map_size;



  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  v_stroke_color = vec4(u_stroke_color.xyz, u_stroke_color.w * opacity);

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  vec2 offset = rotate_matrix(a_textOffsets,rotation);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  vec4 projected_position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));

  gl_Position = vec4(
    projected_position.xy / projected_position.w + offset * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`,pm=ii.isEqual;function ex(e){var r=this,t=e.id,n=[],i=[];if(!r.glyphInfoMap||!r.glyphInfoMap[t])return{vertices:[],indices:[],size:7};var o=r.glyphInfoMap[t].centroid,s=o.length===2?[o[0],o[1],0]:o;return r.glyphInfoMap[t].glyphQuads.forEach(function(l,f){n.push.apply(n,(0,Wt.Z)(s).concat([l.tex.x,l.tex.y+l.tex.height,l.tl.x,l.tl.y],(0,Wt.Z)(s),[l.tex.x+l.tex.width,l.tex.y+l.tex.height,l.tr.x,l.tr.y],(0,Wt.Z)(s),[l.tex.x+l.tex.width,l.tex.y,l.br.x,l.br.y],(0,Wt.Z)(s),[l.tex.x,l.tex.y,l.bl.x,l.bl.y])),i.push(0+f*4,1+f*4,2+f*4,2+f*4,3+f*4,0+f*4)}),{vertices:n,indices:i,size:7}}var tx=function(e){(0,De.Z)(t,e);var r=iM(t);function t(){var n;(0,q.Z)(this,t);for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return n=r.call.apply(r,[this].concat(o)),(0,B.Z)((0,Ie.Z)(n),"glyphInfoMap",{}),(0,B.Z)((0,Ie.Z)(n),"currentZoom",-1),(0,B.Z)((0,Ie.Z)(n),"textureHeight",0),(0,B.Z)((0,Ie.Z)(n),"textCount",0),(0,B.Z)((0,Ie.Z)(n),"preTextStyle",{}),(0,B.Z)((0,Ie.Z)(n),"mapping",(0,Ct.Z)(me().mark(function l(){return me().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return n.initGlyph(),n.updateTexture(),v.next=4,n.reBuildModel();case 4:case"end":return v.stop()}},l)}))),n}return(0,V.Z)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),o=i.stroke,s=o===void 0?"#fff":o,l=i.strokeWidth,f=l===void 0?0:l,v=i.halo,y=v===void 0?.5:v,b=i.gamma,T=b===void 0?2:b,M=i.raisingHeight,O=M===void 0?0:M,k=this.getFontServiceMapping(),$=this.getFontServiceCanvas();return k&&Object.keys(k).length!==this.textCount&&$&&(this.updateTexture(),this.textCount=Object.keys(k).length),this.preTextStyle=this.getTextStyle(),(0,H.Z)({u_raisingHeight:Number(O),u_stroke_width:f,u_stroke_color:fi(s),u_sdf_map:this.texture,u_halo_blur:y,u_gamma_scale:T,u_sdf_map_size:[($==null?void 0:$.width)||1,($==null?void 0:$.height)||1]},this.getStyleAttribute())}},{key:"initModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){return me().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.bindEvent(),this.extent=this.textExtent(),this.rawEncodeData=this.layer.getEncodedData(),this.preTextStyle=this.getTextStyle(),l.abrupt("return",this.buildModels());case 5:case"end":return l.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){var s,l,f,v;return me().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return s=this.layer.getLayerConfig(),l=s.textAllowOverlap,f=l===void 0?!1:l,this.initGlyph(),this.updateTexture(),f||this.filterGlyphs(),b.next=6,this.layer.buildLayerModel({moduleName:"pointText",vertexShader:J1,fragmentShader:Q1,inject:this.getInject(),triangulation:ex.bind(this),depth:{enable:!1}});case 6:return v=b.sent,b.abrupt("return",[v]);case 8:case"end":return b.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"needUpdate",value:function(){var n=(0,Ct.Z)(me().mark(function o(){var s,l,f,v,y,b,T,M,O,k,$,G;return me().wrap(function(ye){for(;;)switch(ye.prev=ye.next){case 0:if(s=this.getTextStyle(),l=s.textAllowOverlap,f=l===void 0?!1:l,v=s.textAnchor,y=v===void 0?"center":v,b=s.textOffset,T=s.padding,M=s.fontFamily,O=s.fontWeight,!(!pm(T,this.preTextStyle.padding)||!pm(b,this.preTextStyle.textOffset)||!pm(y,this.preTextStyle.textAnchor)||!pm(M,this.preTextStyle.fontFamily)||!pm(O,this.preTextStyle.fontWeight))){ye.next=5;break}return ye.next=4,this.mapping();case 4:return ye.abrupt("return",!0);case 5:if(!f){ye.next=7;break}return ye.abrupt("return",!1);case 7:if(k=this.mapService.getZoom(),$=this.mapService.getBounds(),G=il(this.extent,$),!(Math.abs(this.currentZoom-k)>.5||!G||f!==this.preTextStyle.textAllowOverlap)){ye.next=14;break}return ye.next=13,this.reBuildModel();case 13:return ye.abrupt("return",!0);case 14:return ye.abrupt("return",!1);case 15:case"end":return ye.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.layer.off("remapping",this.mapping)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:fn.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:R.STATIC_DRAW,data:[],type:R.FLOAT},size:2,update:function(o,s,l){return[l[5],l[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:fn.Attribute,descriptor:{name:"a_Size",buffer:{usage:R.DYNAMIC_DRAW,data:[],type:R.FLOAT},size:1,update:function(o){var s=o.size,l=s===void 0?12:s;return Array.isArray(l)?[l[0]]:[l]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:fn.Attribute,descriptor:{name:"a_tex",buffer:{usage:R.DYNAMIC_DRAW,data:[],type:R.FLOAT},size:2,update:function(o,s,l){return[l[3],l[4]]}}})}},{key:"bindEvent",value:function(){this.layer.isTileLayer||this.layer.on("remapping",this.mapping)}},{key:"textExtent",value:function(){var i=this.mapService.getBounds();return of(i,.5)}},{key:"initTextFont",value:function(){var i=this.getTextStyle(),o=i.fontWeight,s=i.fontFamily,l=this.rawEncodeData,f=[];l.forEach(function(v){var y=v.shape,b=y===void 0?"":y;b=b.toString();var T=rM(b),M;try{for(T.s();!(M=T.n()).done;){var O=M.value;f.indexOf(O)===-1&&f.push(O)}}catch(k){T.e(k)}finally{T.f()}}),this.fontService.setFontOptions({characterSet:f,fontWeight:o,fontFamily:s,iconfont:!1})}},{key:"initIconFontTex",value:function(){var i=this.getTextStyle(),o=i.fontWeight,s=i.fontFamily,l=this.rawEncodeData,f=[];l.forEach(function(v){var y=v.shape,b=y===void 0?"":y;b="".concat(b),f.indexOf(b)===-1&&f.push(b)}),this.fontService.setFontOptions({characterSet:f,fontWeight:o,fontFamily:s,iconfont:!0})}},{key:"getTextStyle",value:function(){var i=this.layer.getLayerConfig(),o=i.fontWeight,s=o===void 0?"400":o,l=i.fontFamily,f=l===void 0?"sans-serif":l,v=i.textAllowOverlap,y=v===void 0?!1:v,b=i.padding,T=b===void 0?[0,0]:b,M=i.textAnchor,O=M===void 0?"center":M,k=i.textOffset,$=k===void 0?[0,0]:k,G=i.opacity,oe=G===void 0?1:G,ye=i.strokeOpacity,Le=ye===void 0?1:ye,$e=i.strokeWidth,ut=$e===void 0?0:$e,vt=i.stroke,Rt=vt===void 0?"#000":vt;return{fontWeight:s,fontFamily:f,textAllowOverlap:y,padding:T,textAnchor:O,textOffset:$,opacity:oe,strokeOpacity:Le,strokeWidth:ut,stroke:Rt}}},{key:"generateGlyphLayout",value:function(i){var o=this,s=this.getFontServiceMapping(),l=this.layer.getLayerConfig(),f=l.spacing,v=f===void 0?2:f,y=l.textAnchor,b=y===void 0?"center":y,T=l.textOffset,M=this.rawEncodeData;this.glyphInfo=M.map(function(O){var k=O.shape,$=k===void 0?"":k,G=O.id,oe=O.size,ye=oe===void 0?1:oe,Le=O.textOffset?O.textOffset:T||[0,0],$e=O.textAnchor?O.textAnchor:b||"center",ut=eM($.toString(),s,ye,$e,"left",v,Le,i),vt=tM(ut,Le,!1);return O.shaping=ut,O.glyphQuads=vt,O.centroid=Ds(O.coordinates),O.originCentroid=O.version==="GAODE2.x"?Ds(O.originCoordinates):O.originCentroid=O.centroid,o.glyphInfoMap[G]={shaping:ut,glyphQuads:vt,centroid:Ds(O.coordinates)},O})}},{key:"getFontServiceMapping",value:function(){var i=this.layer.getLayerConfig(),o=i.fontWeight,s=o===void 0?"400":o,l=i.fontFamily,f=l===void 0?"sans-serif":l;return this.fontService.getMappingByKey("".concat(f,"_").concat(s))}},{key:"getFontServiceCanvas",value:function(){var i=this.layer.getLayerConfig(),o=i.fontWeight,s=o===void 0?"400":o,l=i.fontFamily,f=l===void 0?"sans-serif":l;return this.fontService.getCanvasByKey("".concat(f,"_").concat(s))}},{key:"filterGlyphs",value:function(){var i=this,o=this.layer.getLayerConfig(),s=o.padding,l=s===void 0?[0,0]:s,f=o.textAllowOverlap,v=f===void 0?!1:f;if(!v){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var y=this.rendererService.getViewportSize(),b=y.width,T=y.height,M=new qR(b,T),O=this.glyphInfo.filter(function(k){var $=k.shaping,G=k.id,oe=G===void 0?0:G,ye=k.version==="GAODE2.x"?k.originCentroid:k.centroid,Le=k.size,$e=Le/16,ut=i.mapService.lngLatToContainer(ye),vt=M.placeCollisionBox({x1:$.left*$e-l[0],x2:$.right*$e+l[0],y1:$.top*$e-l[1],y2:$.bottom*$e+l[1],anchorPointX:ut.x,anchorPointY:ut.y}),Rt=vt.box;return Rt&&Rt.length?(M.insertCollisionBox(Rt,oe),!0):!1});O.forEach(function(k){i.glyphInfoMap[k.id]=k})}}},{key:"initGlyph",value:function(){var i=this.layer.getLayerConfig(),o=i.iconfont,s=o===void 0?!1:o;s?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(s)}},{key:"updateTexture",value:function(){var i=this.rendererService.createTexture2D,o=this.getFontServiceCanvas();this.textureHeight=o.height,this.texture&&this.texture.destroy(),this.texture=i({data:o,mag:R.LINEAR,min:R.LINEAR,width:o.width,height:o.height})}},{key:"reBuildModel",value:function(){var n=(0,Ct.Z)(me().mark(function o(){var s;return me().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.filterGlyphs(),f.next=3,this.layer.buildLayerModel({moduleName:"pointText",vertexShader:J1,fragmentShader:Q1,triangulation:ex.bind(this),inject:this.getInject(),depth:{enable:!1}});case 3:s=f.sent,this.layer.models=[s];case 5:case"end":return f.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()}]),t}(Ma),oM={fillImage:OR,fill:Z1,radar:WR,image:V1,normal:H1,simplePoint:lR,extrude:U1,text:tx,earthFill:xR,earthExtrude:vR},sM=oM;function uM(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=lM(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var v=t.next();return o=v.done,v},e:function(v){s=!0,l=v},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function lM(e,r){if(e){if(typeof e=="string")return rx(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return rx(e,r)}}function rx(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function cM(e){var r=fM();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function fM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Cg=function(e){(0,De.Z)(t,e);var r=cM(t);function t(){var n;(0,q.Z)(this,t);for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return n=r.call.apply(r,[this].concat(o)),(0,B.Z)((0,Ie.Z)(n),"type","PointLayer"),(0,B.Z)((0,Ie.Z)(n),"enableShaderEncodeStyles",["stroke","offsets","opacity","rotation"]),(0,B.Z)((0,Ie.Z)(n),"enableDataEncodeStyles",["textOffset","textAnchor"]),(0,B.Z)((0,Ie.Z)(n),"defaultSourceConfig",{data:[],options:{parser:{type:"json",x:"lng",y:"lat"}}}),n}return(0,V.Z)(t,[{key:"buildModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){var s;return me().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return s=this.getModelType(),this.layerModel&&this.layerModel.clearModels(),this.layerModel=new sM[s](this),f.next=5,this.initLayerModels();case 5:case"end":return f.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"rebuildModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){return me().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:case"end":return l.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getModelTypeWillEmptyData",value:function(){if(this.shapeOption){var i=this.shapeOption,o=i.field,s=i.values,l=this.getLayerConfig(),f=l.shape2d,v=this.iconService.getIconMap();if(o&&(f==null?void 0:f.indexOf(o))!==-1)return"fill";if(s==="text")return"text";if(s&&s instanceof Array){var y=uM(s),b;try{for(y.s();!(b=y.n()).done;){var T=b.value;if(typeof T=="string"&&v.hasOwnProperty(T))return"image"}}catch(M){y.e(M)}finally{y.f()}}}return"normal"}},{key:"getDefaultConfig",value:function(){var i=this.getModelType(),o={fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},text:{blend:"normal"},tile:{},tileText:{},earthFill:{},earthExtrude:{}};return o[i]}},{key:"getModelType",value:function(){var i=this.getEncodedData(),o=this.getLayerConfig(),s=o.shape2d,l=o.shape3d,f=o.billboard,v=f===void 0?!0:f,y=this.iconService.getIconMap(),b=i.find(function(M){return M.hasOwnProperty("shape")});if(b){var T=b.shape;return T==="dot"?"normal":T==="simple"?"simplePoint":T==="radar"?"radar":this.layerType==="fillImage"||v===!1?"fillImage":(s==null?void 0:s.indexOf(T))!==-1?this.mapService.version==="GLOBEL"?"earthFill":"fill":(l==null?void 0:l.indexOf(T))!==-1?this.mapService.version==="GLOBEL"?"earthExtrude":"extrude":y.hasOwnProperty(T)?"image":"text"}else return this.getModelTypeWillEmptyData()}}]),t}(Ip);function hM(e){var r=pM();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function pM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var dM=`uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;

#pragma include "picking"

void main() {


     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = v_Color;
  

  gl_FragColor = filterColor(gl_FragColor);
}
`,vM=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;

uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
 
  float isSide = a_Position.z;
 float topU = a_uvs[0];
 float topV = 1.0 - a_uvs[1];
 float sidey = a_uvs[2];

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  float lightWeight = calc_lighting(pos);

  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }


 gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));

  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if(isSide < 0.999) {
    // side face
    // if(u_sidesurface < 1.0) {
    //   discard;
    // }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      v_Color = linearColor;
    } else {
      v_Color = a_Color;
    }

  } else {
    v_Color = a_Color;
  }

  v_Color = vec4(v_Color.rgb * lightWeight, v_Color.w * opacity);


  setPickingColor(a_PickingColor);
}
`,mM=`uniform sampler2D u_texture;
uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying vec3 v_uvs;
varying vec2 v_texture_data;


#pragma include "picking"

void main() {
  float opacity = u_opacity;
  float isSide = v_texture_data.x;
  float lightWeight = v_texture_data.y;
  float topU = v_uvs[0];
  float topV = 1.0 - v_uvs[1];
  float sidey = v_uvs[2];
  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if(isSide < 0.999) {// \u662F\u5426\u662F\u8FB9\u7F18
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }
  } else {

     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = texture2D(u_texture, vec2(topU, topV));
    // gl_FragColor = vec4(1.0, 0., 0., 1.0);
  }
  

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,gM=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;

uniform sampler2D u_texture;


uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;
varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_linearColor: 0.0;

varying vec2 v_texture_data;
varying vec3 v_uvs;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
 
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  float lightWeight = calc_lighting(pos);
  vec4 project_pos = project_position(pos);
  v_uvs = a_uvs;

  v_texture_data = vec2(a_Position.z, lightWeight);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }


    gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));



  setPickingColor(a_PickingColor);
}
`,_M=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying vec3 v_uvs;
varying vec2 v_texture_data;

#pragma include "picking"

void main() {
  float opacity = u_opacity;
  float isSide =  v_texture_data.x;
  float sidey = v_uvs[2];
  float lightWeight = v_texture_data.y;

  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if(isSide < 0.999) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }
    
    if( u_linearColor == 1.0) {
      // side use linear
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      // side notuse linear
       gl_FragColor = v_Color;
    }
  } else {
    // top face
    if(u_topsurface < 1.0) {
      discard;
    }
    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
}
`,yM=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;


uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;

varying vec2 v_texture_data;
varying vec3 v_uvs;
varying vec4 v_Color;


#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {


  v_uvs = a_uvs;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));
  float lightWeight = calc_lighting(pos);
  v_texture_data = vec2(a_Position.z,lightWeight);

  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,xM=function(e){(0,De.Z)(t,e);var r=hM(t);function t(){return(0,q.Z)(this,t),r.apply(this,arguments)}return(0,V.Z)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),o=i.heightfixed,s=o===void 0?!1:o,l=i.raisingHeight,f=l===void 0?0:l,v=i.topsurface,y=v===void 0?!0:v,b=i.sidesurface,T=b===void 0?!0:b,M=i.sourceColor,O=i.targetColor,k=0,$=[1,1,1,1],G=[1,1,1,1];return M&&O&&($=fi(M),G=fi(O),k=1),(0,H.Z)({u_topsurface:Number(y),u_sidesurface:Number(T),u_heightfixed:Number(s),u_raisingHeight:Number(f),u_linearColor:k,u_sourceColor:$,u_targetColor:G,u_texture:this.texture},this.getStyleAttribute())}},{key:"initModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){return me().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.loadTexture();case 2:return l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){var s,l,f,v,y;return me().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return s=this.getShaders(),l=s.frag,f=s.vert,v=s.type,T.next=3,this.layer.buildLayerModel({moduleName:v,vertexShader:f,fragmentShader:l,inject:this.getInject(),triangulation:$0});case 3:return y=T.sent,T.abrupt("return",[y]);case 5:case"end":return T.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getShaders",value:function(){var i=this.layer.getLayerConfig(),o=i.pickLight,s=i.mapTexture;return s?{frag:mM,vert:gM,type:"polygonExtrudeTexture"}:o?{frag:_M,vert:yM,type:"polygonExtrudePickLight"}:{frag:dM,vert:vM,type:"polygonExtrude"}}},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){var i=this.layer.getSource().extent,o=i,s=this.layer.coordCenter||this.layer.getSource().center,l=o[2]-o[0],f=o[3]-o[1];if(this.mapService.version==="GAODE2.x"){var v=this.mapService.coordToAMap2RelativeCoordinates([i[0],i[1]],s),y=(0,yn.Z)(v,2),b=y[0],T=y[1],M=this.mapService.coordToAMap2RelativeCoordinates([i[2],i[3]],s),O=(0,yn.Z)(M,2),k=O[0],$=O[1];l=k-b,f=$-T,o=[b,T,k,$]}this.styleAttributeService.registerStyleAttribute({name:"uvs",type:fn.Attribute,descriptor:{name:"a_uvs",buffer:{usage:R.STATIC_DRAW,data:[],type:R.FLOAT},size:3,update:function(oe,ye,Le){var $e=Le[0],ut=Le[1];return[($e-o[0])/l,(ut-o[1])/f,Le[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:fn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:R.STATIC_DRAW,data:[],type:R.FLOAT},size:3,update:function(oe,ye,Le,$e,ut){return ut}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:fn.Attribute,descriptor:{name:"a_Size",buffer:{usage:R.DYNAMIC_DRAW,data:[],type:R.FLOAT},size:1,update:function(oe){var ye=oe.size,Le=ye===void 0?10:ye;return Array.isArray(Le)?[Le[0]]:[Le]}}})}},{key:"loadTexture",value:function(){var n=(0,Ct.Z)(me().mark(function o(){var s=this,l,f,v;return me().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(l=this.layer.getLayerConfig(),f=l.mapTexture,v=this.rendererService.createTexture2D,this.texture=v({height:0,width:0}),!f){b.next=5;break}return b.abrupt("return",new Promise(function(T,M){var O=new Image;O.crossOrigin="anonymous",O.src=f,O.onload=function(){return s.texture=v({data:O,width:O.width,height:O.height,wrapS:R.CLAMP_TO_EDGE,wrapT:R.CLAMP_TO_EDGE,min:R.LINEAR,mag:R.LINEAR}),T(null)},O.onerror=function(){M(new Error("image load error"))}}));case 5:case"end":return b.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()}]),t}(Ma);function bM(e){var r=EM();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function EM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var SM=`
uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying vec2 v_texture_data;


#pragma include "picking"

void main() {

  gl_FragColor = v_Color;
  gl_FragColor = filterColor(gl_FragColor);
}
`,AM=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;




varying vec4 v_Color;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
 
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size + (1.0 - a_Position.z) * extrusionBase, 1.0);
  float lightWeight = calc_lighting(pos);
  vec4 project_pos = project_position(pos);
  v_Color = a_Color;
  v_Color = vec4(v_Color.rgb * lightWeight, v_Color.w * opacity);

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));

  setPickingColor(a_PickingColor);
}
`,TM=function(e){(0,De.Z)(t,e);var r=bM(t);function t(){return(0,q.Z)(this,t),r.apply(this,arguments)}return(0,V.Z)(t,[{key:"getUninforms",value:function(){return(0,H.Z)({},this.getStyleAttribute())}},{key:"initModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){return me().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){var s,l,f,v,y;return me().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return s=this.getShaders(),l=s.frag,f=s.vert,v=s.type,T.next=3,this.layer.buildLayerModel({moduleName:v,vertexShader:f,fragmentShader:l,inject:this.getInject(),triangulation:$0});case 3:return y=T.sent,T.abrupt("return",[y]);case 5:case"end":return T.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getShaders",value:function(){return{frag:SM,vert:AM,type:"polygonExtrude"}}},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:fn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:R.STATIC_DRAW,data:[],type:R.FLOAT},size:3,update:function(o,s,l,f,v){return v}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:fn.Attribute,descriptor:{name:"a_Size",buffer:{usage:R.DYNAMIC_DRAW,data:[],type:R.FLOAT},size:1,update:function(o){var s=o.size,l=s===void 0?10:s;return Array.isArray(l)?[l[0]]:[l]}}})}}]),t}(Ma);function wM(e){var r=CM();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function CM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var RM=`varying vec4 v_color;
#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor = filterColor(gl_FragColor);
}
`,MM=`#pragma include "picking"
uniform float u_opacitylinear: 0.0;
uniform float u_dir: 1.0;
varying vec3 v_linear;
varying vec2 v_pos;
varying vec4 v_Color;


void main() {
   gl_FragColor = v_Color;
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;
  }
  gl_FragColor = filterColor(gl_FragColor);
}
`,IM=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;

uniform float u_raisingHeight: 0.0;

varying vec4 v_Color;


#pragma include "projection"
#pragma include "picking"

uniform float u_opacitylinear: 0.0;

attribute vec3 a_linear;
varying vec3 v_linear;
varying vec2 v_pos;

void main() {
  if(u_opacitylinear > 0.0) {
    v_linear = a_linear;
    v_pos = a_Position.xy;
  }
  v_Color = vec4(a_Color.xyz, a_Color.w * opacity);
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

   gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));
  setPickingColor(a_PickingColor);
}`,PM=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;


uniform float u_raisingHeight: 0.0;

varying vec4 v_color;


#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

 
  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));

  setPickingColor(a_PickingColor);
}

`,OM=function(e){(0,De.Z)(t,e);var r=wM(t);function t(){return(0,q.Z)(this,t),r.apply(this,arguments)}return(0,V.Z)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),o=i.raisingHeight,s=o===void 0?0:o,l=i.opacityLinear,f=l===void 0?{enable:!1,dir:"in"}:l;return(0,H.Z)({u_raisingHeight:Number(s),u_opacitylinear:Number(f.enable),u_dir:f.dir==="in"?1:0},this.getStyleAttribute())}},{key:"initModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){return me().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){var s,l,f,v,y,b;return me().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return s=this.getModelParams(),l=s.frag,f=s.vert,v=s.triangulation,y=s.type,this.layer.triangulation=v,M.next=4,this.layer.buildLayerModel({moduleName:y,vertexShader:f,fragmentShader:l,inject:this.getInject(),triangulation:v,primitive:R.TRIANGLES,depth:{enable:!1}});case 4:return b=M.sent,M.abrupt("return",[b]);case 6:case"end":return M.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this.layer.getLayerConfig(),o=i.opacityLinear,s=o===void 0?{enable:!1,dir:"in"}:o;s.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:fn.Attribute,descriptor:{name:"a_linear",buffer:{usage:R.STATIC_DRAW,data:[],type:R.FLOAT},size:3,update:function(f,v,y){return[y[3],y[4],y[5]]}}})}},{key:"getModelParams",value:function(){var i=this.layer.getLayerConfig(),o=i.opacityLinear,s=o===void 0?{enable:!1}:o;return s.enable?{frag:MM,vert:IM,type:"polygonLinear",triangulation:zw}:{frag:RM,vert:PM,type:"polygonFill",triangulation:Id}}}]),t}(Ma);function DM(e){var r=kM();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function kM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var FM=`
uniform float u_time: 0.0;
uniform float u_opacity: 1.0;

varying vec2 v_uv;

float coast2water_fadedepth = 0.10;
float large_waveheight      = .750; // change to adjust the "heavy" waves
float large_wavesize        = 3.4;  // factor to adjust the large wave size
float small_waveheight      = 0.6;  // change to adjust the small random waves
float small_wavesize        = 0.5;   // factor to ajust the small wave size
float water_softlight_fact  = 15.;  // range [1..200] (should be << smaller than glossy-fact)
float water_glossylight_fact= 120.; // range [1..200]
float particle_amount       = 70.;
// vec3 watercolor             = vec3(0.43, 0.60, 0.66); // 'transparent' low-water color (RGB)
// vec3 watercolor2            = vec3(0.06, 0.07, 0.11); // deep-water color (RGB, should be darker than the low-water color)
uniform vec4 u_watercolor;
uniform vec4 u_watercolor2;
vec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);    // specular Color (RGB) of the water-highlights
#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8) // position of the sun

uniform sampler2D u_texture1;
uniform sampler2D u_texture2;
uniform sampler2D u_texture3;

  

float hash( float n ) {
    return fract(sin(n)*43758.5453123);
}

// 2d noise function
float noise1( in vec2 x ) {
  vec2 p  = floor(x);
  vec2 f  = smoothstep(0.0, 1.0, fract(x));
  float n = p.x + p.y*57.0;
  return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),
    mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);
}

float noise(vec2 p) {
    return texture2D(u_texture2,p*vec2(1./256.)).x;
}

vec4 highness(vec2 p) {
    vec4 t = texture2D(u_texture1,fract(p));
    float clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;
    return clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);
}

float height_map( vec2 p ) {
    vec4 height=highness(p);
    /*
    height = -0.5+
        0.5*smoothstep(-100.,0.,-height)+
        2.75*smoothstep(0.,2.,height)+
        1.75*smoothstep(2.,4.,height)+
        2.75*smoothstep(4.,16.,height)+
        1.5*smoothstep(16.,1000.,height);
    */

    mat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );
    //p = p*6.;
    float f = 0.6000*noise1( p ); p = m*p*1.1*6.;
    f += 0.2500*noise( p ); p = m*p*1.32;
    f += 0.1666*noise( p ); p = m*p*1.11;
    f += 0.0834*noise( p ); p = m*p*1.12;
    f += 0.0634*noise( p ); p = m*p*1.13;
    f += 0.0444*noise( p ); p = m*p*1.14;
    f += 0.0274*noise( p ); p = m*p*1.15;
    f += 0.0134*noise( p ); p = m*p*1.16;
    f += 0.0104*noise( p ); p = m*p*1.17;
    f += 0.0084*noise( p );
    f = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;
        const float FLAT_LEVEL = 0.92525;
        //f = f*0.25+height*0.75;
    if (f<FLAT_LEVEL)
        f = f;
    else
        f = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL; // makes a smooth coast-increase
    return clamp(f, 0., 10.);
}

vec3 plasma_quintic( float x ) {
    x = clamp( x, 0.0, 1.0);
    vec4 x1 = vec4( 1.0, x, x * x, x * x * x ); // 1 x x2 x3
    vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7
    return vec3(
        dot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),
        dot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),
        dot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );
}

vec4 color(vec2 p){
    vec4 c1 = vec4(1.7,1.6,.9,1);
    vec4 c2 = vec4(.2,.94,.1,1);
    vec4 c3 = vec4(.3,.2,.0,1);
    vec4 c4 = vec4(.99,.99,1.6,1);
    vec4 v = highness(p);
    float los = smoothstep(0.1,1.1,v.b);
    float his = smoothstep(3.5,6.5,v.b);
    float ces = smoothstep(1.,5.,v.a);
    vec4 lo = mix(c1,c2,los);
    vec4 hi = mix(c3,c4,his);
    vec4 ce = mix(lo,hi,ces);

    return vec4(plasma_quintic(ces),1).ragb;
}

vec3 terrain_map( vec2 p )
{
  return color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture2D(u_texture3, fract(p*5.)).rgb*.5; // test-terrain is simply 'sandstone'
}

const mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );

float water_map( vec2 p, float height ) {
    vec2 p2 = p*large_wavesize;
    vec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );
    vec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );

    // coarse crossing 'ocean' waves...
    float f = 0.6000*noise( p );
    f += 0.2500*noise( p*m );
    f += 0.1666*noise( p*m*m );
    float wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;

    p *= small_wavesize;
    f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<9; i++)
    { p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }
    
    return wave+f*small_waveheight;
}

float nautic(vec2 p) {
    p *= 18.;
    float f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }
    return pow(1.-f, 5.);
}

float particles(vec2 p) {
    p *= 200.;
    float f = 0.;
    float amp = 1.0, s = 1.5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }
    return pow(f*.35, 7.)*particle_amount;
}

float test_shadow( vec2 xy, float height) {
    vec3 r0 = vec3(xy, height);
    vec3 rd = normalize( light - r0 );
    
    float hit = 1.0;
    float t   = 0.001;
    for (int j=1; j<25; j++)
    {
        vec3 p = r0 + t*rd;
        float h = height_map( p.xy );
        float height_diff = p.z - h;
        if (height_diff<0.0)
        {
            return 0.0;
        }
        t += 0.01+height_diff*.02;
        hit = min(hit, 2.*height_diff/t); // soft shaddow   
    }
    return hit;
}

vec3 CalcTerrain(vec2 uv, float height) {
    vec3 col = terrain_map( uv );
    vec2 iResolution = vec2(512.);
    float h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);
    float h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);
    float h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);
    float h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);
    vec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));
    vec3 r0 = vec3(uv, height);
    vec3 rd = normalize( light - r0 );
    float grad = dot(norm, rd);
    col *= grad+pow(grad, 8.);
    float terrainshade = test_shadow( uv, height );
    col = mix(col*.25, col, terrainshade);
    return col;
}


void main() {
  vec3 watercolor = u_watercolor.rgb;
  vec3 watercolor2 = u_watercolor2.rgb;
  vec2 uv = v_uv;
  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)
  float deepwater_fadedepth   = 0.4 + coast2water_fadedepth;
  float height = height_map( uv );
  vec3 col;

    float waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);
    float level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);
    if (height > level)
    {
        col = CalcTerrain(uv, height);
    }
    if (height <= level)
    {
        vec2 dif = vec2(.0, .01);
        vec2 pos = uv*15. + vec2(u_time*.01);
        float h1 = water_map(pos-dif,waveheight);
        float h2 = water_map(pos+dif,waveheight);
        float h3 = water_map(pos-dif.yx,waveheight);
        float h4 = water_map(pos+dif.yx,waveheight);
        vec3 normwater = normalize(vec3(h3-h4, h1-h2, .125)); // norm-vector of the 'bumpy' water-plane
        uv += normwater.xy*.002*(level-height);
        
        col = CalcTerrain(uv, height);

        float coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);
        float coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);
        float intensity = col.r*.2126+col.g*.7152+col.b*.0722;
        watercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));

        vec3 r0 = vec3(uv, WATER_LEVEL);
        vec3 rd = normalize( light - r0 ); // ray-direction to the light from water-position
        float grad     = dot(normwater, rd); // dot-product of norm-vector and light-direction
        float specular = pow(grad, water_softlight_fact);  // used for soft highlights                          
        float specular2= pow(grad, water_glossylight_fact); // used for glossy highlights
        float gradpos  = dot(vec3(0., 0., 1.), rd);
        float specular1= smoothstep(0., 1., pow(gradpos, 5.));  // used for diffusity (some darker corona around light's specular reflections...)                          
        float watershade  = test_shadow( uv, level );
        watercolor *= 2.2+watershade;
        watercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;
        watercolor /= (1.+specular1*1.25);
        watercolor += watershade*specular2*water_specularcolor;
        watercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));
        
        col = mix(col, watercolor, coastfade);
    }
    

  float opacity = u_opacity;
  gl_FragColor = vec4(col, opacity);  
}
`,BM=`attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;


varying vec2 v_uv;

#pragma include "projection"

void main() {
  v_uv = a_uv;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));
}

`,LM=ii.isNumber,NM=function(e){(0,De.Z)(t,e);var r=DM(t);function t(){return(0,q.Z)(this,t),r.apply(this,arguments)}return(0,V.Z)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),o=i.opacity,s=o===void 0?1:o,l=i.watercolor,f=l===void 0?"#6D99A8":l,v=i.watercolor2,y=v===void 0?"#0F121C":v;return{u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3,u_watercolor:fi(f),u_watercolor2:fi(y),u_opacity:LM(s)?s:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){return me().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.loadTexture(),l.abrupt("return",this.buildModels());case 2:case"end":return l.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){var s;return me().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,this.layer.buildLayerModel({moduleName:"polygonOcean",vertexShader:BM,fragmentShader:FM,triangulation:X0,primitive:R.TRIANGLES,depth:{enable:!1}});case 2:return s=f.sent,f.abrupt("return",[s]);case 4:case"end":return f.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i,o,s;(i=this.texture1)===null||i===void 0||i.destroy(),(o=this.texture2)===null||o===void 0||o.destroy(),(s=this.texture3)===null||s===void 0||s.destroy()}},{key:"registerBuiltinAttributes",value:function(){var i=this.layer.getSource().extent,o=(0,yn.Z)(i,4),s=o[0],l=o[1],f=o[2],v=o[3],y=f-s,b=v-l;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:fn.Attribute,descriptor:{name:"a_uv",buffer:{usage:R.STATIC_DRAW,data:[],type:R.FLOAT},size:2,update:function(M,O,k,$){var G=M.version==="GAODE2.x"?M.originCoordinates[0][$]:k,oe=(0,yn.Z)(G,2),ye=oe[0],Le=oe[1];return[(ye-s)/y,(Le-l)/b]}}})}},{key:"loadTexture",value:function(){var i=this,o=this.rendererService.createTexture2D,s={height:0,width:0};this.texture1=o(s),this.texture2=o(s),this.texture3=o(s),l(function(v){i.texture1=f(v[0]),i.texture2=f(v[1]),i.texture3=f(v[2]),i.layerService.reRender()});function l(v){var y=0,b=[],T=["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"];T.map(function(M){var O=new Image;O.crossOrigin="",O.src=M,b.push(O),O.onload=function(){y++,y===3&&v(b)}})}function f(v){return o({data:v,width:v.width,height:v.height,wrapS:R.MIRRORED_REPEAT,wrapT:R.MIRRORED_REPEAT,min:R.LINEAR,mag:R.LINEAR})}}}]),t}(Ma);function UM(e){var r=zM();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function zM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ZM=`uniform sampler2D u_texture;
uniform float u_time: 0.0;
uniform float u_speed: 1.0;
uniform float u_opacity: 1.0;

varying vec4 v_Color;
varying vec2 v_uv;

float rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }

float water(vec3 p) {
  float t = u_time * u_speed;
  p.z += t * 2.; p.x += t * 2.;
  vec3 c1 = texture2D(u_texture, p.xz / 30.).xyz;
  p.z += t * 3.; p.x += t * 0.52;
  vec3 c2 = texture2D(u_texture, p.xz / 30.).xyz;
  p.z += t * 4.; p.x += t * 0.8;
  vec3 c3 = texture2D(u_texture, p.xz / 30.).xyz;
  c1 += c2 - c3;
  float z = (c1.x + c1.y + c1.z) / 3.;
  return p.y + z / 4.;
}

float map(vec3 p) {
  float d = 100.0;
  d = water(p);
  return d;
}

float intersect(vec3 ro, vec3 rd) {
  float d = 0.0;
  for (int i = 0; i <= 100; i++) {
    float h = map(ro + rd * d);
    if (h < 0.1) return  d;
    d += h;
  }
  return 0.0;
}

vec3 norm(vec3 p) {
  float eps = .1;
  return normalize(vec3(
    map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),
    map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),
    map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))
  ));
} 

float calSpc() {
  vec3 l1 = normalize(vec3(1, 1, 1));
  vec3 ro = vec3(-3, 20, -8);
  vec3 rc = vec3(0, 0, 0);
  vec3 ww = normalize(rc - ro);
  vec3 uu = normalize(cross(vec3(0,1,0), ww));
  vec3 vv = normalize(cross(rc - ro, uu));
  vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);
  float d = intersect(ro, rd);
  vec3 p = ro + rd * d;
  vec3 n = norm(p);
  float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);
  return spc;
}

void main() {
  float opacity = u_opacity;
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;

  float spc = calSpc();
  gl_FragColor += spc * 0.4;
}
`,VM=`attribute vec4 a_Color;
attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;


varying vec4 v_Color;
varying vec2 v_uv;
uniform float u_opacity: 1.0;


#pragma include "projection"

void main() {
  v_uv = a_uv;

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));
}

`,jM=ii.isNumber,HM=function(e){(0,De.Z)(t,e);var r=UM(t);function t(){return(0,q.Z)(this,t),r.apply(this,arguments)}return(0,V.Z)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),o=i.opacity,s=o===void 0?1:o,l=i.speed,f=l===void 0?.5:l;return{u_texture:this.texture,u_speed:f,u_opacity:jM(s)?s:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){return me().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.loadTexture(),l.abrupt("return",this.buildModels());case 2:case"end":return l.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){var s;return me().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,this.layer.buildLayerModel({moduleName:"polygonWater",vertexShader:VM,fragmentShader:ZM,triangulation:X0,primitive:R.TRIANGLES,depth:{enable:!1}});case 2:return s=f.sent,f.abrupt("return",[s]);case 4:case"end":return f.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){var i=this.layer.getSource().extent,o=(0,yn.Z)(i,4),s=o[0],l=o[1],f=o[2],v=o[3],y=f-s,b=v-l;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:fn.Attribute,descriptor:{name:"a_uv",buffer:{usage:R.STATIC_DRAW,data:[],type:R.FLOAT},size:2,update:function(M,O,k,$){var G=M.version==="GAODE2.x"?M.originCoordinates[0][$]:k,oe=(0,yn.Z)(G,2),ye=oe[0],Le=oe[1];return[(ye-s)/y,(Le-l)/b]}}})}},{key:"loadTexture",value:function(){var i=this,o=this.layer.getLayerConfig(),s=o.waterTexture,l=this.rendererService.createTexture2D;this.texture=l({height:0,width:0});var f=new Image;f.crossOrigin="",s?(console.warn("L7 recommend\uFF1Ahttps://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),f.src=s):f.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",f.onload=function(){i.texture=l({data:f,width:f.width,height:f.height,wrapS:R.MIRRORED_REPEAT,wrapT:R.MIRRORED_REPEAT,min:R.LINEAR,mag:R.LINEAR}),i.layerService.reRender()}}}]),t}(Ma),WM={fill:OM,line:B1,extrude:xM,text:tx,point_fill:Z1,point_image:V1,point_normal:H1,point_extrude:U1,water:HM,ocean:NM,extrusion:TM},GM=WM;function XM(e){var r=$M();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function $M(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Rg=function(e){(0,De.Z)(t,e);var r=XM(t);function t(){var n;(0,q.Z)(this,t);for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return n=r.call.apply(r,[this].concat(o)),(0,B.Z)((0,Ie.Z)(n),"type","PolygonLayer"),(0,B.Z)((0,Ie.Z)(n),"enableShaderEncodeStyles",["opacity","extrusionBase","rotation","offsets","stroke"]),n}return(0,V.Z)(t,[{key:"buildModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){var s;return me().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return s=this.getModelType(),this.layerModel=new GM[s](this),f.next=4,this.initLayerModels();case 4:case"end":return f.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getModelType",value:function(){var i,o=this.styleAttributeService.getLayerStyleAttribute("shape"),s=o==null||(i=o.scale)===null||i===void 0?void 0:i.field;return s==="fill"||!s?"fill":s==="extrude"?"extrude":s==="extrusion"?"extrusion":s==="water"?"water":s==="ocean"?"ocean":s==="line"?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var i=this.getEncodedData(),o=this.getLayerConfig(),s=o.shape2d,l=o.shape3d,f=this.iconService.getIconMap(),v=i.find(function(b){return b.hasOwnProperty("shape")});if(v){var y=v.shape;return y==="dot"?"point_normal":(s==null?void 0:s.indexOf(y))!==-1?"point_fill":(l==null?void 0:l.indexOf(y))!==-1?"point_extrude":f.hasOwnProperty(y)?"point_image":"text"}else return"fill"}}]),t}(Ip);function YM(e){var r=qM();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function qM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var KM=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;
bool isnan_emu(float x) { return (x > 0.0 || x < 0.0) ? x != x : x != 0.0; }


void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue || isnan_emu(value))
      discard;
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
     discard;
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
    if(gl_FragColor.a < 0.01)
      discard;
   
  }
}
`,QM=`precision highp float;
uniform mat4 u_ModelMatrix;

attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));

    gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));
}
`,nx=function(e){(0,De.Z)(t,e);var r=YM(t);function t(){return(0,q.Z)(this,t),r.apply(this,arguments)}return(0,V.Z)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),o=i.opacity,s=o===void 0?1:o,l=i.clampLow,f=l===void 0?!0:l,v=i.clampHigh,y=v===void 0?!0:v,b=i.noDataValue,T=b===void 0?-9999999:b,M=i.domain,O=i.rampColors,k=M||Cc(O);return this.colorTexture=this.layer.textureService.getColorTexture(O,k),{u_opacity:s||1,u_texture:this.texture,u_domain:k,u_clampLow:f,u_clampHigh:typeof y!="undefined"?y:f,u_noDataValue:T,u_colorTexture:this.colorTexture}}},{key:"getRasterData",value:function(){var n=(0,Ct.Z)(me().mark(function o(s){var l,f,v,y;return me().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:if(!Array.isArray(s.data)){T.next=4;break}return T.abrupt("return",{data:s.data,width:s.width,height:s.height});case 4:return T.next=6,s.data;case 6:return l=T.sent,f=l.rasterData,v=l.width,y=l.height,T.abrupt("return",{data:Array.from(f),width:v,height:y});case 11:case"end":return T.stop()}},o)}));function i(o){return n.apply(this,arguments)}return i}()},{key:"initModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){var s,l,f,v,y,b,T,M;return me().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return s=this.layer.getSource(),l=this.rendererService.createTexture2D,f=s.data.dataArray[0],k.next=5,this.getRasterData(f);case 5:return v=k.sent,y=v.data,b=v.width,T=v.height,this.texture=l({data:y,width:b,height:T,format:R.LUMINANCE,type:R.FLOAT}),k.next=12,this.layer.buildLayerModel({moduleName:"rasterImageData",vertexShader:QM,fragmentShader:KM,triangulation:Sg,primitive:R.TRIANGLES,depth:{enable:!1}});case 12:return M=k.sent,k.abrupt("return",[M]);case 14:case"end":return k.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){return me().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.initModels());case 1:case"end":return l.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i,o;(i=this.texture)===null||i===void 0||i.destroy(),(o=this.colorTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:fn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:R.DYNAMIC_DRAW,data:[],type:R.FLOAT},size:2,update:function(o,s,l){return[l[3],l[4]]}}})}}]),t}(Ma),JM=["data"],eI=["rasterData"];function tI(e){var r=rI();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function rI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var nI=`precision highp float;
uniform mat4 u_ModelMatrix;

attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));

    gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));
}
`,iI=`precision mediump float;
uniform vec2 u_rminmax: vec2(0,255); 
uniform vec2 u_gminmax: vec2(0,255);
uniform vec2 u_bminmax: vec2(0,255);
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform float u_noDataValue : 0.0;
varying vec2 v_texCoord;

void main() {
  vec3 rgb = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).rgb;
  if(rgb == vec3(u_noDataValue)) {
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  } else {
    gl_FragColor = vec4(rgb.r / (u_rminmax.y -u_rminmax.x), rgb.g /(u_gminmax.y -u_gminmax.x), rgb.b/ (u_bminmax.y - u_bminmax.x), u_opacity);
  }
  if(gl_FragColor.a < 0.01)
    discard;
 
}`,aI=function(e){(0,De.Z)(t,e);var r=tI(t);function t(){var n;(0,q.Z)(this,t);for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return n=r.call.apply(r,[this].concat(o)),(0,B.Z)((0,Ie.Z)(n),"dataOption",{}),n}return(0,V.Z)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),o=i.opacity,s=o===void 0?1:o,l=i.noDataValue,f=l===void 0?0:l,v=this.dataOption,y=v.rMinMax,b=v.gMinMax,T=v.bMinMax;return{u_opacity:s||1,u_texture:this.texture,u_noDataValue:f,u_rminmax:y,u_gminmax:b,u_bminmax:T}}},{key:"getRasterData",value:function(){var n=(0,Ct.Z)(me().mark(function o(s){var l,f,v,y,b;return me().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:if(!Array.isArray(s.data)){M.next=4;break}return l=s.data,f=(0,Fa.Z)(s,JM),this.dataOption=f,M.abrupt("return",(0,H.Z)({data:l},f));case 4:return M.next=6,s.data;case 6:if(v=M.sent,y=v.rasterData,b=(0,Fa.Z)(v,eI),this.dataOption=b,!Array.isArray(y)){M.next=14;break}return M.abrupt("return",(0,H.Z)({data:y},b));case 14:return M.abrupt("return",(0,H.Z)({data:Array.from(y)},b));case 15:case"end":return M.stop()}},o,this)}));function i(o){return n.apply(this,arguments)}return i}()},{key:"initModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){var s,l,f,v,y,b,T,M;return me().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return s=this.layer.getSource(),l=this.rendererService.createTexture2D,f=s.data.dataArray[0],k.next=5,this.getRasterData(f);case 5:return v=k.sent,y=v.data,b=v.width,T=v.height,this.texture=l({data:y,width:b,height:T,format:R.RGB,type:R.FLOAT}),k.next=12,this.layer.buildLayerModel({moduleName:"rasterImageDataRGBA",vertexShader:nI,fragmentShader:iI,triangulation:Sg,primitive:R.TRIANGLES,depth:{enable:!1}});case 12:return M=k.sent,k.abrupt("return",[M]);case 14:case"end":return k.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){return me().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.initModels());case 1:case"end":return l.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:fn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:R.DYNAMIC_DRAW,data:[],type:R.FLOAT},size:2,update:function(o,s,l){return[l[3],l[4]]}}})}}]),t}(Ma);function oI(e){var r=sI();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function sI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var uI=`precision mediump float;
uniform float u_opacity: 1.0;

uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

varying vec2 v_texCoord;

uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
uniform vec4 u_unpack;

float getElevation(vec2 coord, float bias) {
    // Convert encoded elevation value to meters
    vec4 data = texture2D(u_texture, coord,bias) * 255.0;
    data.a = -1.0;
    return dot(data, u_unpack);
}

vec4 getColor(float value) {
   float normalisedValue =(value- u_domain[0]) / (u_domain[1] - u_domain[0]);
    vec2 coord = vec2(normalisedValue, 0);
    return texture2D(u_colorTexture, coord);
}

void main() {
  float value = getElevation(v_texCoord,0.0);
  if (value == u_noDataValue) {
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  } else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1])) {
     gl_FragColor = vec4(0.0, 0, 0, 0.0);
  } else {
   
    gl_FragColor = getColor(value);
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
      if(gl_FragColor.a < 0.01)
      discard;
  }
}
`,lI=`precision highp float;
uniform mat4 u_ModelMatrix;

attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));
}
`,cI=function(e){(0,De.Z)(t,e);var r=oI(t);function t(){return(0,q.Z)(this,t),r.apply(this,arguments)}return(0,V.Z)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),o=i.opacity,s=i.clampLow,l=s===void 0?!0:s,f=i.clampHigh,v=f===void 0?!0:f,y=i.noDataValue,b=y===void 0?-9999999:y,T=i.domain,M=i.rampColors,O=i.colorTexture,k=i.rScaler,$=k===void 0?6553.6:k,G=i.gScaler,oe=G===void 0?25.6:G,ye=i.bScaler,Le=ye===void 0?.1:ye,$e=i.offset,ut=$e===void 0?1e4:$e,vt=T||Cc(M),Rt=O;return O?this.layer.textureService.setColorTexture(O,M,vt):Rt=this.layer.textureService.getColorTexture(M,vt),{u_opacity:o||1,u_texture:this.texture,u_domain:vt,u_clampLow:l,u_clampHigh:typeof v!="undefined"?v:l,u_noDataValue:b,u_unpack:[$,oe,Le,ut],u_colorTexture:Rt}}},{key:"initModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){var s,l,f,v;return me().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return s=this.layer.getSource(),l=this.rendererService.createTexture2D,b.next=4,s.data.images;case 4:return f=b.sent,this.texture=l({data:f[0],width:f[0].width,height:f[0].height,min:R.LINEAR,mag:R.LINEAR}),b.next=8,this.layer.buildLayerModel({moduleName:"RasterTileDataImage",vertexShader:lI,fragmentShader:uI,triangulation:Sg,primitive:R.TRIANGLES,depth:{enable:!1}});case 8:return v=b.sent,b.abrupt("return",[v]);case 10:case"end":return b.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy()}},{key:"buildModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){return me().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.initModels());case 1:case"end":return l.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:fn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:R.DYNAMIC_DRAW,data:[],type:R.FLOAT},size:2,update:function(o,s,l){return[l[3],l[4]]}}})}}]),t}(Ma),fI={raster:nx,rasterRgb:aI,raster3d:nx,rasterTerrainRgb:cI},hI=fI;function pI(e){var r=dI();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function dI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Mg=function(e){(0,De.Z)(t,e);var r=pI(t);function t(){var n;(0,q.Z)(this,t);for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return n=r.call.apply(r,[this].concat(o)),(0,B.Z)((0,Ie.Z)(n),"type","RasterLayer"),n}return(0,V.Z)(t,[{key:"buildModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){var s;return me().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return s=this.getModelType(),this.layerModel=new hI[s](this),f.next=4,this.initLayerModels();case 4:case"end":return f.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getDefaultConfig",value:function(){var i=this.getModelType(),o={raster:{},rasterRgb:{},raster3d:{},rasterTerrainRgb:{}};return o[i]}},{key:"getModelType",value:function(){var i=this.layerSource.getParserType();switch(i){case"raster":return"raster";case"rasterRgb":return"rasterRgb";case"image":return"rasterTerrainRgb";default:return"raster"}}}]),t}(Ip);function vI(e){var r=mI();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function mI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var gI=`uniform float u_opacity : 1.0;
uniform vec4 u_color;

void main() {
  gl_FragColor = u_color;
  gl_FragColor.a *= u_opacity;
}
`,_I=`attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;


#pragma include "projection"

void main() {
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,yI=ii.isNumber,xI=function(e){(0,De.Z)(t,e);var r=vI(t);function t(){return(0,q.Z)(this,t),r.apply(this,arguments)}return(0,V.Z)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),o=i.opacity,s=o===void 0?1:o,l=i.color,f=l===void 0?"#000":l;return{u_opacity:yI(s)?s:0,u_color:fi(f)}}},{key:"initModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){return me().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){var s;return me().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,this.layer.buildLayerModel({moduleName:"mask",vertexShader:_I,fragmentShader:gI,triangulation:X0,depth:{enable:!1},pick:!1});case 2:return s=f.sent,f.abrupt("return",[s]);case 4:case"end":return f.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;i&&this.layerService.clear()}},{key:"registerBuiltinAttributes",value:function(){return""}}]),t}(Ma),bI={fill:xI},EI=bI;function SI(e){var r=AI();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function AI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ix=function(e){(0,De.Z)(t,e);var r=SI(t);function t(){var n;(0,q.Z)(this,t);for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return n=r.call.apply(r,[this].concat(o)),(0,B.Z)((0,Ie.Z)(n),"type","MaskLayer"),n}return(0,V.Z)(t,[{key:"buildModels",value:function(){var n=(0,Ct.Z)(me().mark(function o(){var s;return me().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return s=this.getModelType(),this.layerModel=new EI[s](this),f.next=4,this.initLayerModels();case 4:case"end":return f.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getModelType",value:function(){return"fill"}}]),t}(Ip),ax,ox,sx,ux,Ig,lx,cx,TI=ii.cloneDeep,wI=(ax=(0,gt.b2)(),ox=(0,gt.f3)(tt.IMapService),sx=(0,gt.f3)(tt.IFontService),ax(ux=(Ig=function(){function e(){(0,q.Z)(this,e),Fi(this,"mapService",lx,this),Fi(this,"fontService",cx,this)}return(0,V.Z)(e,[{key:"apply",value:function(t,n){var i=this,o=n.styleAttributeService;t.hooks.init.tapPromise("DataMappingPlugin",(0,Ct.Z)(me().mark(function s(){return me().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:t.log(Rs.MappingStart,ds.INIT),i.generateMaping(t,{styleAttributeService:o}),t.log(Rs.MappingEnd,ds.INIT);case 3:case"end":return f.stop()}},s)}))),t.hooks.beforeRenderData.tapPromise("DataMappingPlugin",function(){var s=(0,Ct.Z)(me().mark(function l(f){var v;return me().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(f){b.next=2;break}return b.abrupt("return",f);case 2:return t.dataState.dataMappingNeedUpdate=!1,t.log(Rs.MappingStart,ds.UPDATE),v=i.generateMaping(t,{styleAttributeService:o}),t.log(Rs.MappingEnd,ds.UPDATE),b.abrupt("return",v);case 7:case"end":return b.stop()}},l)}));return function(l){return s.apply(this,arguments)}}()),t.hooks.beforeRender.tap("DataMappingPlugin",function(){var s=t.getSource();if(!(t.layerModelNeedUpdate||!s||!s.inited)){var l=o.getLayerStyleAttributes()||[],f=o.getLayerStyleAttribute("filter"),v=s.data.dataArray;if(!(Array.isArray(v)&&v.length===0)){var y=l.filter(function(M){return M.needRemapping}),b=v;if(f!=null&&f.needRemapping&&f!==null&&f!==void 0&&f.scale&&(b=v.filter(function(M){return i.applyAttributeMapping(f,M)[0]})),y.length){var T=i.mapping(t,y,b,t.getEncodedData());t.setEncodedData(T)}}}})}},{key:"generateMaping",value:function(t,n){var i=this,o=n.styleAttributeService,s=o.getLayerStyleAttributes()||[],l=o.getLayerStyleAttribute("filter"),f=t.getSource().data.dataArray,v=f;l!=null&&l.scale&&(v=f.filter(function(b){return i.applyAttributeMapping(l,b)[0]})),v=t.processData(v);var y=this.mapping(t,s,v,void 0);return t.setEncodedData(y),f.length===0&&t.encodeDataLength===0?!1:(t.emit("dataUpdate",null),!0)}},{key:"mapping",value:function(t,n,i,o){var s=this,l=n.filter(function(v){return v.scale!==void 0}).filter(function(v){return v.name!=="filter"}),f=i.map(function(v,y){var b=o?o[y]:{},T=(0,H.Z)({id:v._id,coordinates:v.coordinates},b);return l.forEach(function(M){var O=s.applyAttributeMapping(M,v);(M.name==="color"||M.name==="stroke")&&(O=O.map(function(k){return fi(k)})),T[M.name]=Array.isArray(O)&&O.length===1?O[0]:O,M.name==="shape"&&(T.shape=s.fontService.getIconFontKey(T[M.name]))}),T});return n.forEach(function(v){v.needRemapping=!1}),this.adjustData2Amap2Coordinates(f,t),this.adjustData2SimpleCoordinates(f),f}},{key:"adjustData2Amap2Coordinates",value:function(t,n){var i=this;if(t.length>0&&this.mapService.version==="GAODE2.x"){var o=n.coordCenter||n.getSource().center;t.filter(function(s){return!s.originCoordinates}).map(function(s){s.version="GAODE2.x",s.originCoordinates=TI(s.coordinates),s.coordinates=i.mapService.coordToAMap2RelativeCoordinates(s.coordinates,o)})}}},{key:"adjustData2SimpleCoordinates",value:function(t){var n=this;t.length>0&&this.mapService.version==="SIMPLE"&&t.map(function(i){i.simpleCoordinate||(i.coordinates=n.unProjectCoordinates(i.coordinates),i.simpleCoordinate=!0)})}},{key:"unProjectCoordinates",value:function(t){var n=this;if(typeof t[0]=="number")return this.mapService.simpleMapCoord.unproject(t);if(t[0]&&t[0][0]instanceof Array){var i=[];return t.map(function(s){var l=[];s.map(function(f){l.push(n.mapService.simpleMapCoord.unproject(f))}),i.push(l)}),i}else{var o=[];return t.map(function(s){o.push(n.mapService.simpleMapCoord.unproject(s))}),o}}},{key:"applyAttributeMapping",value:function(t,n){var i;if(!t.scale)return[];var o=(t==null||(i=t.scale)===null||i===void 0?void 0:i.scalers)||[],s=[];o.forEach(function(f){var v,y=f.field;(n.hasOwnProperty(y)||((v=t.scale)===null||v===void 0?void 0:v.type)==="variable")&&s.push(n[y])});var l=t.mapping?t.mapping(s):[];return l}},{key:"getArrowPoints",value:function(t,n){var i=[n[0]-t[0],n[1]-t[1]],o=Ff(i),s=[t[0]+o[0]*1e-4,t[1]+o[1]*1e-4];return s}}]),e}(),lx=Oi(Ig.prototype,"mapService",[ox],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cx=Oi(Ig.prototype,"fontService",[sx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ig))||ux),fx,hx,CI=(fx=(0,gt.b2)(),fx(hx=function(){function e(){(0,q.Z)(this,e)}return(0,V.Z)(e,[{key:"apply",value:function(t){var n=this;this.mapService=t.getContainer().get(tt.IMapService),t.hooks.init.tapPromise("DataSourcePlugin",(0,Ct.Z)(me().mark(function i(){var o,s,l,f;return me().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(t.log(Rs.SourceInitStart,ds.INIT),o=t.getSource(),o||(s=t.sourceOption||t.defaultSourceConfig,l=s.data,f=s.options,o=new Xy(l,f),t.setSource(o)),!o.inited){y.next=8;break}n.updateClusterData(t),t.log(Rs.SourceInitEnd,ds.INIT),y.next=10;break;case 8:return y.next=10,new Promise(function(b){o.on("update",function(T){T.type==="inited"&&(n.updateClusterData(t),t.log(Rs.SourceInitEnd,ds.INIT)),b(null)})});case 10:case"end":return y.stop()}},i)}))),t.hooks.beforeRenderData.tapPromise("DataSourcePlugin",(0,Ct.Z)(me().mark(function i(){var o,s,l;return me().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return o=n.updateClusterData(t),s=t.dataState.dataSourceNeedUpdate,t.dataState.dataSourceNeedUpdate=!1,l=o||s,v.abrupt("return",l);case 5:case"end":return v.stop()}},i)})))}},{key:"updateClusterData",value:function(t){if(t.isTileLayer||t.tileLayer||!t.getSource())return!1;var n=t.getSource(),i=n.cluster,o=n.clusterOptions.zoom,s=o===void 0?0:o,l=this.mapService.getZoom()-1,f=t.dataState.dataSourceNeedUpdate;return i&&f&&n.updateClusterData(Math.floor(l)),i&&Math.abs(t.clusterZoom-l)>=1?(s!==Math.floor(l)&&n.updateClusterData(Math.floor(l)),t.clusterZoom=l,!0):!1}}]),e}())||hx);function Q0(e,r){return e<r?-1:e>r?1:e>=r?0:NaN}function px(e){return e.length===1&&(e=RI(e)),{left:function(r,t,n,i){for(n==null&&(n=0),i==null&&(i=r.length);n<i;){var o=n+i>>>1;e(r[o],t)<0?n=o+1:i=o}return n},right:function(r,t,n,i){for(n==null&&(n=0),i==null&&(i=r.length);n<i;){var o=n+i>>>1;e(r[o],t)>0?i=o:n=o+1}return n}}}function RI(e){return function(r,t){return Q0(e(r),t)}}var dx=px(Q0),MI=dx.right,RL=dx.left,Pg=MI;function vx(e,r){var t=e.length,n=-1,i,o,s;if(r==null){for(;++n<t;)if((i=e[n])!=null&&i>=i)for(o=s=i;++n<t;)(i=e[n])!=null&&(o>i&&(o=i),s<i&&(s=i))}else for(;++n<t;)if((i=r(e[n],n,e))!=null&&i>=i)for(o=s=i;++n<t;)(i=r(e[n],n,e))!=null&&(o>i&&(o=i),s<i&&(s=i));return[o,s]}var mx=Array.prototype,ML=mx.slice,IL=mx.map,J0=Math.sqrt(50),e_=Math.sqrt(10),t_=Math.sqrt(2);function gx(e,r,t){var n,i=-1,o,s,l;if(r=+r,e=+e,t=+t,e===r&&t>0)return[e];if((n=r<e)&&(o=e,e=r,r=o),(l=Og(e,r,t))===0||!isFinite(l))return[];if(l>0)for(e=Math.ceil(e/l),r=Math.floor(r/l),s=new Array(o=Math.ceil(r-e+1));++i<o;)s[i]=(e+i)*l;else for(e=Math.floor(e*l),r=Math.ceil(r*l),s=new Array(o=Math.ceil(e-r+1));++i<o;)s[i]=(e-i)/l;return n&&s.reverse(),s}function Og(e,r,t){var n=(r-e)/Math.max(0,t),i=Math.floor(Math.log(n)/Math.LN10),o=n/Math.pow(10,i);return i>=0?(o>=J0?10:o>=e_?5:o>=t_?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(o>=J0?10:o>=e_?5:o>=t_?2:1)}function r_(e,r,t){var n=Math.abs(r-e)/Math.max(0,t),i=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),o=n/i;return o>=J0?i*=10:o>=e_?i*=5:o>=t_&&(i*=2),r<e?-i:i}function PL(){var e=identity,r=extent,t=sturges;function n(i){var o,s=i.length,l,f=new Array(s);for(o=0;o<s;++o)f[o]=e(i[o],o,i);var v=r(f),y=v[0],b=v[1],T=t(f,y,b);Array.isArray(T)||(T=tickStep(y,b,T),T=range(Math.ceil(y/T)*T,b,T));for(var M=T.length;T[0]<=y;)T.shift(),--M;for(;T[M-1]>b;)T.pop(),--M;var O=new Array(M+1),k;for(o=0;o<=M;++o)k=O[o]=[],k.x0=o>0?T[o-1]:y,k.x1=o<M?T[o]:b;for(o=0;o<s;++o)l=f[o],y<=l&&l<=b&&O[bisect(T,l,0,M)].push(i[o]);return O}return n.value=function(i){return arguments.length?(e=typeof i=="function"?i:constant(i),n):e},n.domain=function(i){return arguments.length?(r=typeof i=="function"?i:constant([i[0],i[1]]),n):r},n.thresholds=function(i){return arguments.length?(t=typeof i=="function"?i:Array.isArray(i)?constant(slice.call(i)):constant(i),n):t},n}function OL(e,r,t){return e=map.call(e,number).sort(ascending),Math.ceil((t-r)/(2*(quantile(e,.75)-quantile(e,.25))*Math.pow(e.length,-1/3)))}function II(e){return e===null?NaN:+e}function PI(e,r,t){if(t==null&&(t=II),!!(n=e.length)){if((r=+r)<=0||n<2)return+t(e[0],0,e);if(r>=1)return+t(e[n-1],n-1,e);var n,i=(n-1)*r,o=Math.floor(i),s=+t(e[o],o,e),l=+t(e[o+1],o+1,e);return s+(l-s)*(i-o)}}function _x(e,r,t,n,i){var o=e*e,s=o*e;return((1-3*e+3*o-s)*r+(4-6*o+3*s)*t+(1+3*e+3*o-3*s)*n+s*i)/6}function OI(e){var r=e.length-1;return function(t){var n=t<=0?t=0:t>=1?(t=1,r-1):Math.floor(t*r),i=e[n],o=e[n+1],s=n>0?e[n-1]:2*i-o,l=n<r-1?e[n+2]:2*o-i;return _x((t-n/r)*r,s,i,o,l)}}function DI(e){var r=e.length;return function(t){var n=Math.floor(((t%=1)<0?++t:t)*r),i=e[(n+r-1)%r],o=e[n%r],s=e[(n+1)%r],l=e[(n+2)%r];return _x((t-n/r)*r,i,o,s,l)}}function n_(e){return function(){return e}}function yx(e,r){return function(t){return e+t*r}}function kI(e,r,t){return e=Math.pow(e,t),r=Math.pow(r,t)-e,t=1/t,function(n){return Math.pow(e+n*r,t)}}function DL(e,r){var t=r-e;return t?yx(e,t>180||t<-180?t-360*Math.round(t/360):t):constant(isNaN(e)?r:e)}function FI(e){return(e=+e)==1?xx:function(r,t){return t-r?kI(r,t,e):n_(isNaN(r)?t:r)}}function xx(e,r){var t=r-e;return t?yx(e,t):n_(isNaN(e)?r:e)}var bx=function e(r){var t=FI(r);function n(i,o){var s=t((i=(0,os.B8)(i)).r,(o=(0,os.B8)(o)).r),l=t(i.g,o.g),f=t(i.b,o.b),v=xx(i.opacity,o.opacity);return function(y){return i.r=s(y),i.g=l(y),i.b=f(y),i.opacity=v(y),i+""}}return n.gamma=e,n}(1);function Ex(e){return function(r){var t=r.length,n=new Array(t),i=new Array(t),o=new Array(t),s,l;for(s=0;s<t;++s)l=(0,os.B8)(r[s]),n[s]=l.r||0,i[s]=l.g||0,o[s]=l.b||0;return n=e(n),i=e(i),o=e(o),l.opacity=1,function(f){return l.r=n(f),l.g=i(f),l.b=o(f),l+""}}}var BI=Ex(OI),kL=Ex(DI),qc="$";function Dg(){}Dg.prototype=Sx.prototype={constructor:Dg,has:function(e){return qc+e in this},get:function(e){return this[qc+e]},set:function(e,r){return this[qc+e]=r,this},remove:function(e){var r=qc+e;return r in this&&delete this[r]},clear:function(){for(var e in this)e[0]===qc&&delete this[e]},keys:function(){var e=[];for(var r in this)r[0]===qc&&e.push(r.slice(1));return e},values:function(){var e=[];for(var r in this)r[0]===qc&&e.push(this[r]);return e},entries:function(){var e=[];for(var r in this)r[0]===qc&&e.push({key:r.slice(1),value:this[r]});return e},size:function(){var e=0;for(var r in this)r[0]===qc&&++e;return e},empty:function(){for(var e in this)if(e[0]===qc)return!1;return!0},each:function(e){for(var r in this)r[0]===qc&&e(this[r],r.slice(1),this)}};function Sx(e,r){var t=new Dg;if(e instanceof Dg)e.each(function(l,f){t.set(f,l)});else if(Array.isArray(e)){var n=-1,i=e.length,o;if(r==null)for(;++n<i;)t.set(n,e[n]);else for(;++n<i;)t.set(r(o=e[n],n,e),o)}else if(e)for(var s in e)t.set(s,e[s]);return t}var i_=Sx;function FL(){var e=[],r=[],t,n,i;function o(l,f,v,y){if(f>=e.length)return t!=null&&l.sort(t),n!=null?n(l):l;for(var b=-1,T=l.length,M=e[f++],O,k,$=map(),G,oe=v();++b<T;)(G=$.get(O=M(k=l[b])+""))?G.push(k):$.set(O,[k]);return $.each(function(ye,Le){y(oe,Le,o(ye,f,v,y))}),oe}function s(l,f){if(++f>e.length)return l;var v,y=r[f-1];return n!=null&&f>=e.length?v=l.entries():(v=[],l.each(function(b,T){v.push({key:T,values:s(b,f)})})),y!=null?v.sort(function(b,T){return y(b.key,T.key)}):v}return i={object:function(l){return o(l,0,LI,NI)},map:function(l){return o(l,0,Ax,Tx)},entries:function(l){return s(o(l,0,Ax,Tx),0)},key:function(l){return e.push(l),i},sortKeys:function(l){return r[e.length-1]=l,i},sortValues:function(l){return t=l,i},rollup:function(l){return n=l,i}}}function LI(){return{}}function NI(e,r,t){e[r]=t}function Ax(){return map()}function Tx(e,r,t){e.set(r,t)}function kg(){}var md=i_.prototype;kg.prototype=UI.prototype={constructor:kg,has:md.has,add:function(e){return e+="",this[qc+e]=e,this},remove:md.remove,clear:md.clear,values:md.keys,size:md.size,empty:md.empty,each:md.each};function UI(e,r){var t=new kg;if(e instanceof kg)e.each(function(o){t.add(o)});else if(e){var n=-1,i=e.length;if(r==null)for(;++n<i;)t.add(e[n]);else for(;++n<i;)t.add(r(e[n],n,e))}return t}var BL=null,Cx=Array.prototype,Rx=Cx.map,gd=Cx.slice;function Dp(e,r){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(r).domain(e);break}return this}function Mx(e,r){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(r).domain(e);break}return this}var Ix={name:"implicit"};function Fg(){var e=i_(),r=[],t=[],n=Ix;function i(o){var s=o+"",l=e.get(s);if(!l){if(n!==Ix)return n;e.set(s,l=r.push(o))}return t[(l-1)%t.length]}return i.domain=function(o){if(!arguments.length)return r.slice();r=[],e=i_();for(var s=-1,l=o.length,f,v;++s<l;)e.has(v=(f=o[s])+"")||e.set(v,r.push(f));return i},i.range=function(o){return arguments.length?(t=gd.call(o),i):t.slice()},i.unknown=function(o){return arguments.length?(n=o,i):n},i.copy=function(){return Fg(r,t).unknown(n)},Dp.apply(i,arguments),i}function Px(){var e=ordinal().unknown(void 0),r=e.domain,t=e.range,n=[0,1],i,o,s=!1,l=0,f=0,v=.5;delete e.unknown;function y(){var b=r().length,T=n[1]<n[0],M=n[T-0],O=n[1-T];i=(O-M)/Math.max(1,b-l+f*2),s&&(i=Math.floor(i)),M+=(O-M-i*(b-l))*v,o=i*(1-l),s&&(M=Math.round(M),o=Math.round(o));var k=sequence(b).map(function($){return M+i*$});return t(T?k.reverse():k)}return e.domain=function(b){return arguments.length?(r(b),y()):r()},e.range=function(b){return arguments.length?(n=[+b[0],+b[1]],y()):n.slice()},e.rangeRound=function(b){return n=[+b[0],+b[1]],s=!0,y()},e.bandwidth=function(){return o},e.step=function(){return i},e.round=function(b){return arguments.length?(s=!!b,y()):s},e.padding=function(b){return arguments.length?(l=Math.min(1,f=+b),y()):l},e.paddingInner=function(b){return arguments.length?(l=Math.min(1,b),y()):l},e.paddingOuter=function(b){return arguments.length?(f=+b,y()):f},e.align=function(b){return arguments.length?(v=Math.max(0,Math.min(1,b)),y()):v},e.copy=function(){return Px(r(),n).round(s).paddingInner(l).paddingOuter(f).align(v)},initRange.apply(y(),arguments)}function Ox(e){var r=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return Ox(r())},e}function LL(){return Ox(Px.apply(null,arguments).paddingInner(1))}function NL(e,r){return(isNumberArray(r)?numberArray:Dx)(e,r)}function Dx(e,r){var t=r?r.length:0,n=e?Math.min(t,e.length):0,i=new Array(n),o=new Array(t),s;for(s=0;s<n;++s)i[s]=s_(e[s],r[s]);for(;s<t;++s)o[s]=r[s];return function(l){for(s=0;s<n;++s)o[s]=i[s](l);return o}}function zI(e,r){var t=new Date;return e=+e,r=+r,function(n){return t.setTime(e*(1-n)+r*n),t}}function Bg(e,r){return e=+e,r=+r,function(t){return e*(1-t)+r*t}}function ZI(e,r){var t={},n={},i;(e===null||typeof e!="object")&&(e={}),(r===null||typeof r!="object")&&(r={});for(i in r)i in e?t[i]=s_(e[i],r[i]):n[i]=r[i];return function(o){for(i in t)n[i]=t[i](o);return n}}var a_=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,o_=new RegExp(a_.source,"g");function VI(e){return function(){return e}}function jI(e){return function(r){return e(r)+""}}function HI(e,r){var t=a_.lastIndex=o_.lastIndex=0,n,i,o,s=-1,l=[],f=[];for(e=e+"",r=r+"";(n=a_.exec(e))&&(i=o_.exec(r));)(o=i.index)>t&&(o=r.slice(t,o),l[s]?l[s]+=o:l[++s]=o),(n=n[0])===(i=i[0])?l[s]?l[s]+=i:l[++s]=i:(l[++s]=null,f.push({i:s,x:Bg(n,i)})),t=o_.lastIndex;return t<r.length&&(o=r.slice(t),l[s]?l[s]+=o:l[++s]=o),l.length<2?f[0]?jI(f[0].x):VI(r):(r=f.length,function(v){for(var y=0,b;y<r;++y)l[(b=f[y]).i]=b.x(v);return l.join("")})}function WI(e,r){r||(r=[]);var t=e?Math.min(r.length,e.length):0,n=r.slice(),i;return function(o){for(i=0;i<t;++i)n[i]=e[i]*(1-o)+r[i]*o;return n}}function GI(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function s_(e,r){var t=typeof r,n;return r==null||t==="boolean"?n_(r):(t==="number"?Bg:t==="string"?(n=(0,os.ZP)(r))?(r=n,bx):HI:r instanceof os.ZP?bx:r instanceof Date?zI:GI(r)?WI:Array.isArray(r)?Dx:typeof r.valueOf!="function"&&typeof r.toString!="function"||isNaN(r)?ZI:Bg)(e,r)}function XI(e,r){return e=+e,r=+r,function(t){return Math.round(e*(1-t)+r*t)}}function $I(e){return function(){return e}}function YI(e){return+e}var kx=[0,1];function Yu(e){return e}function u_(e,r){return(r-=e=+e)?function(t){return(t-e)/r}:$I(isNaN(r)?NaN:.5)}function Fx(e){var r=e[0],t=e[e.length-1],n;return r>t&&(n=r,r=t,t=n),function(i){return Math.max(r,Math.min(t,i))}}function qI(e,r,t){var n=e[0],i=e[1],o=r[0],s=r[1];return i<n?(n=u_(i,n),o=t(s,o)):(n=u_(n,i),o=t(o,s)),function(l){return o(n(l))}}function KI(e,r,t){var n=Math.min(e.length,r.length)-1,i=new Array(n),o=new Array(n),s=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),r=r.slice().reverse());++s<n;)i[s]=u_(e[s],e[s+1]),o[s]=t(r[s],r[s+1]);return function(l){var f=Pg(e,l,1,n)-1;return o[f](i[f](l))}}function Lg(e,r){return r.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function l_(){var e=kx,r=kx,t=s_,n,i,o,s=Yu,l,f,v;function y(){return l=Math.min(e.length,r.length)>2?KI:qI,f=v=null,b}function b(T){return isNaN(T=+T)?o:(f||(f=l(e.map(n),r,t)))(n(s(T)))}return b.invert=function(T){return s(i((v||(v=l(r,e.map(n),Bg)))(T)))},b.domain=function(T){return arguments.length?(e=Rx.call(T,YI),s===Yu||(s=Fx(e)),y()):e.slice()},b.range=function(T){return arguments.length?(r=gd.call(T),y()):r.slice()},b.rangeRound=function(T){return r=gd.call(T),t=XI,y()},b.clamp=function(T){return arguments.length?(s=T?Fx(e):Yu,b):s!==Yu},b.interpolate=function(T){return arguments.length?(t=T,y()):t},b.unknown=function(T){return arguments.length?(o=T,b):o},function(T,M){return n=T,i=M,y()}}function Bx(e,r){return l_()(e,r)}var QI=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Ng(e){if(!(r=QI.exec(e)))throw new Error("invalid format: "+e);var r;return new c_({fill:r[1],align:r[2],sign:r[3],symbol:r[4],zero:r[5],width:r[6],comma:r[7],precision:r[8]&&r[8].slice(1),trim:r[9],type:r[10]})}Ng.prototype=c_.prototype;function c_(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}c_.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function JI(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function Ug(e,r){if((t=(e=r?e.toExponential(r-1):e.toExponential()).indexOf("e"))<0)return null;var t,n=e.slice(0,t);return[n.length>1?n[0]+n.slice(2):n,+e.slice(t+1)]}function pv(e){return e=Ug(Math.abs(e)),e?e[1]:NaN}function eP(e,r){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(pv(r)/3)))*3-pv(Math.abs(e)))}function tP(e,r){return function(t,n){for(var i=t.length,o=[],s=0,l=e[0],f=0;i>0&&l>0&&(f+l+1>n&&(l=Math.max(1,n-f)),o.push(t.substring(i-=l,i+l)),!((f+=l+1)>n));)l=e[s=(s+1)%e.length];return o.reverse().join(r)}}function rP(e){return function(r){return r.replace(/[0-9]/g,function(t){return e[+t]})}}function nP(e){e:for(var r=e.length,t=1,n=-1,i;t<r;++t)switch(e[t]){case".":n=i=t;break;case"0":n===0&&(n=t),i=t;break;default:if(!+e[t])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(i+1):e}var Lx;function iP(e,r){var t=Ug(e,r);if(!t)return e+"";var n=t[0],i=t[1],o=i-(Lx=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,s=n.length;return o===s?n:o>s?n+new Array(o-s+1).join("0"):o>0?n.slice(0,o)+"."+n.slice(o):"0."+new Array(1-o).join("0")+Ug(e,Math.max(0,r+o-1))[0]}function Nx(e,r){var t=Ug(e,r);if(!t)return e+"";var n=t[0],i=t[1];return i<0?"0."+new Array(-i).join("0")+n:n.length>i+1?n.slice(0,i+1)+"."+n.slice(i+1):n+new Array(i-n.length+2).join("0")}var Ux={"%":function(e,r){return(e*100).toFixed(r)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:JI,e:function(e,r){return e.toExponential(r)},f:function(e,r){return e.toFixed(r)},g:function(e,r){return e.toPrecision(r)},o:function(e){return Math.round(e).toString(8)},p:function(e,r){return Nx(e*100,r)},r:Nx,s:iP,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function zx(e){return e}var Zx=Array.prototype.map,Vx=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function aP(e){var r=e.grouping===void 0||e.thousands===void 0?zx:tP(Zx.call(e.grouping,Number),e.thousands+""),t=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",i=e.decimal===void 0?".":e.decimal+"",o=e.numerals===void 0?zx:rP(Zx.call(e.numerals,String)),s=e.percent===void 0?"%":e.percent+"",l=e.minus===void 0?"-":e.minus+"",f=e.nan===void 0?"NaN":e.nan+"";function v(b){b=Ng(b);var T=b.fill,M=b.align,O=b.sign,k=b.symbol,$=b.zero,G=b.width,oe=b.comma,ye=b.precision,Le=b.trim,$e=b.type;$e==="n"?(oe=!0,$e="g"):Ux[$e]||(ye===void 0&&(ye=12),Le=!0,$e="g"),($||T==="0"&&M==="=")&&($=!0,T="0",M="=");var ut=k==="$"?t:k==="#"&&/[boxX]/.test($e)?"0"+$e.toLowerCase():"",vt=k==="$"?n:/[%p]/.test($e)?s:"",Rt=Ux[$e],Jt=/[defgprs%]/.test($e);ye=ye===void 0?6:/[gprs]/.test($e)?Math.max(1,Math.min(21,ye)):Math.max(0,Math.min(20,ye));function Mr(br){var pn=ut,kn=vt,Pi,xa,is;if($e==="c")kn=Rt(br)+kn,br="";else{br=+br;var _s=br<0||1/br<0;if(br=isNaN(br)?f:Rt(Math.abs(br),ye),Le&&(br=nP(br)),_s&&+br==0&&O!=="+"&&(_s=!1),pn=(_s?O==="("?O:l:O==="-"||O==="("?"":O)+pn,kn=($e==="s"?Vx[8+Lx/3]:"")+kn+(_s&&O==="("?")":""),Jt){for(Pi=-1,xa=br.length;++Pi<xa;)if(is=br.charCodeAt(Pi),48>is||is>57){kn=(is===46?i+br.slice(Pi+1):br.slice(Pi))+kn,br=br.slice(0,Pi);break}}}oe&&!$&&(br=r(br,1/0));var as=pn.length+br.length+kn.length,lu=as<G?new Array(G-as+1).join(T):"";switch(oe&&$&&(br=r(lu+br,lu.length?G-kn.length:1/0),lu=""),M){case"<":br=pn+br+kn+lu;break;case"=":br=pn+lu+br+kn;break;case"^":br=lu.slice(0,as=lu.length>>1)+pn+br+kn+lu.slice(as);break;default:br=lu+pn+br+kn;break}return o(br)}return Mr.toString=function(){return b+""},Mr}function y(b,T){var M=v((b=Ng(b),b.type="f",b)),O=Math.max(-8,Math.min(8,Math.floor(pv(T)/3)))*3,k=Math.pow(10,-O),$=Vx[8+O/3];return function(G){return M(k*G)+$}}return{format:v,formatPrefix:y}}var zg,f_,jx;oP({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function oP(e){return zg=aP(e),f_=zg.format,jx=zg.formatPrefix,zg}function sP(e,r){return e=Math.abs(e),r=Math.abs(r)-e,Math.max(0,pv(r)-pv(e))+1}function uP(e){return Math.max(0,-pv(Math.abs(e)))}function lP(e,r,t,n){var i=r_(e,r,t),o;switch(n=Ng(n==null?",f":n),n.type){case"s":{var s=Math.max(Math.abs(e),Math.abs(r));return n.precision==null&&!isNaN(o=eP(i,s))&&(n.precision=o),jx(n,s)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(o=sP(i,Math.max(Math.abs(e),Math.abs(r))))&&(n.precision=o-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(o=uP(i))&&(n.precision=o-(n.type==="%")*2);break}}return f_(n)}function dm(e){var r=e.domain;return e.ticks=function(t){var n=r();return gx(n[0],n[n.length-1],t==null?10:t)},e.tickFormat=function(t,n){var i=r();return lP(i[0],i[i.length-1],t==null?10:t,n)},e.nice=function(t){t==null&&(t=10);var n=r(),i=0,o=n.length-1,s=n[i],l=n[o],f;return l<s&&(f=s,s=l,l=f,f=i,i=o,o=f),f=Og(s,l,t),f>0?(s=Math.floor(s/f)*f,l=Math.ceil(l/f)*f,f=Og(s,l,t)):f<0&&(s=Math.ceil(s*f)/f,l=Math.floor(l*f)/f,f=Og(s,l,t)),f>0?(n[i]=Math.floor(s/f)*f,n[o]=Math.ceil(l/f)*f,r(n)):f<0&&(n[i]=Math.ceil(s*f)/f,n[o]=Math.floor(l*f)/f,r(n)),e},e}function Hx(){var e=Bx(Yu,Yu);return e.copy=function(){return Lg(e,Hx())},Dp.apply(e,arguments),dm(e)}function cP(e){var r;function t(n){return isNaN(n=+n)?r:n}return t.invert=t,t.domain=t.range=function(n){return arguments.length?(e=map.call(n,number),t):e.slice()},t.unknown=function(n){return arguments.length?(r=n,t):r},t.copy=function(){return cP(e).unknown(r)},e=arguments.length?map.call(e,number):[0,1],linearish(t)}function Wx(e,r){e=e.slice();var t=0,n=e.length-1,i=e[t],o=e[n],s;return o<i&&(s=t,t=n,n=s,s=i,i=o,o=s),e[t]=r.floor(i),e[n]=r.ceil(o),e}function Gx(e){return Math.log(e)}function Xx(e){return Math.exp(e)}function fP(e){return-Math.log(-e)}function hP(e){return-Math.exp(-e)}function pP(e){return isFinite(e)?+("1e"+e):e<0?0:e}function dP(e){return e===10?pP:e===Math.E?Math.exp:function(r){return Math.pow(e,r)}}function vP(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(r){return Math.log(r)/e})}function $x(e){return function(r){return-e(-r)}}function mP(e){var r=e(Gx,Xx),t=r.domain,n=10,i,o;function s(){return i=vP(n),o=dP(n),t()[0]<0?(i=$x(i),o=$x(o),e(fP,hP)):e(Gx,Xx),r}return r.base=function(l){return arguments.length?(n=+l,s()):n},r.domain=function(l){return arguments.length?(t(l),s()):t()},r.ticks=function(l){var f=t(),v=f[0],y=f[f.length-1],b;(b=y<v)&&(T=v,v=y,y=T);var T=i(v),M=i(y),O,k,$,G=l==null?10:+l,oe=[];if(!(n%1)&&M-T<G){if(T=Math.round(T)-1,M=Math.round(M)+1,v>0){for(;T<M;++T)for(k=1,O=o(T);k<n;++k)if($=O*k,!($<v)){if($>y)break;oe.push($)}}else for(;T<M;++T)for(k=n-1,O=o(T);k>=1;--k)if($=O*k,!($<v)){if($>y)break;oe.push($)}}else oe=gx(T,M,Math.min(M-T,G)).map(o);return b?oe.reverse():oe},r.tickFormat=function(l,f){if(f==null&&(f=n===10?".0e":","),typeof f!="function"&&(f=f_(f)),l===1/0)return f;l==null&&(l=10);var v=Math.max(1,n*l/r.ticks().length);return function(y){var b=y/o(Math.round(i(y)));return b*n<n-.5&&(b*=n),b<=v?f(y):""}},r.nice=function(){return t(Wx(t(),{floor:function(l){return o(Math.floor(i(l)))},ceil:function(l){return o(Math.ceil(i(l)))}}))},r}function Yx(){var e=mP(l_()).domain([1,10]);return e.copy=function(){return Lg(e,Yx()).base(e.base())},Dp.apply(e,arguments),e}function qx(e){return function(r){return Math.sign(r)*Math.log1p(Math.abs(r/e))}}function Kx(e){return function(r){return Math.sign(r)*Math.expm1(Math.abs(r))*e}}function gP(e){var r=1,t=e(qx(r),Kx(r));return t.constant=function(n){return arguments.length?e(qx(r=+n),Kx(r)):r},linearish(t)}function _P(){var e=gP(transformer());return e.copy=function(){return copy(e,_P()).constant(e.constant())},initRange.apply(e,arguments)}function Qx(e){return function(r){return r<0?-Math.pow(-r,e):Math.pow(r,e)}}function yP(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function xP(e){return e<0?-e*e:e*e}function bP(e){var r=e(Yu,Yu),t=1;function n(){return t===1?e(Yu,Yu):t===.5?e(yP,xP):e(Qx(t),Qx(1/t))}return r.exponent=function(i){return arguments.length?(t=+i,n()):t},dm(r)}function h_(){var e=bP(l_());return e.copy=function(){return Lg(e,h_()).exponent(e.exponent())},Dp.apply(e,arguments),e}function UL(){return h_.apply(null,arguments).exponent(.5)}function Jx(){var e=[],r=[],t=[],n;function i(){var s=0,l=Math.max(1,r.length);for(t=new Array(l-1);++s<l;)t[s-1]=PI(e,s/l);return o}function o(s){return isNaN(s=+s)?n:r[Pg(t,s)]}return o.invertExtent=function(s){var l=r.indexOf(s);return l<0?[NaN,NaN]:[l>0?t[l-1]:e[0],l<t.length?t[l]:e[e.length-1]]},o.domain=function(s){if(!arguments.length)return e.slice();e=[];for(var l=0,f=s.length,v;l<f;++l)v=s[l],v!=null&&!isNaN(v=+v)&&e.push(v);return e.sort(Q0),i()},o.range=function(s){return arguments.length?(r=gd.call(s),i()):r.slice()},o.unknown=function(s){return arguments.length?(n=s,o):n},o.quantiles=function(){return t.slice()},o.copy=function(){return Jx().domain(e).range(r).unknown(n)},Dp.apply(o,arguments)}function eb(){var e=0,r=1,t=1,n=[.5],i=[0,1],o;function s(f){return f<=f?i[Pg(n,f,0,t)]:o}function l(){var f=-1;for(n=new Array(t);++f<t;)n[f]=((f+1)*r-(f-t)*e)/(t+1);return s}return s.domain=function(f){return arguments.length?(e=+f[0],r=+f[1],l()):[e,r]},s.range=function(f){return arguments.length?(t=(i=gd.call(f)).length-1,l()):i.slice()},s.invertExtent=function(f){var v=i.indexOf(f);return v<0?[NaN,NaN]:v<1?[e,n[0]]:v>=t?[n[t-1],r]:[n[v-1],n[v]]},s.unknown=function(f){return arguments.length&&(o=f),s},s.thresholds=function(){return n.slice()},s.copy=function(){return eb().domain([e,r]).range(i).unknown(o)},Dp.apply(dm(s),arguments)}function tb(){var e=[.5],r=[0,1],t,n=1;function i(o){return o<=o?r[Pg(e,o,0,n)]:t}return i.domain=function(o){return arguments.length?(e=gd.call(o),n=Math.min(e.length,r.length-1),i):e.slice()},i.range=function(o){return arguments.length?(r=gd.call(o),n=Math.min(e.length,r.length-1),i):r.slice()},i.invertExtent=function(o){var s=r.indexOf(o);return[e[s-1],e[s]]},i.unknown=function(o){return arguments.length?(t=o,i):t},i.copy=function(){return tb().domain(e).range(r).unknown(t)},Dp.apply(i,arguments)}var p_=new Date,d_=new Date;function ml(e,r,t,n){function i(o){return e(o=arguments.length===0?new Date:new Date(+o)),o}return i.floor=function(o){return e(o=new Date(+o)),o},i.ceil=function(o){return e(o=new Date(o-1)),r(o,1),e(o),o},i.round=function(o){var s=i(o),l=i.ceil(o);return o-s<l-o?s:l},i.offset=function(o,s){return r(o=new Date(+o),s==null?1:Math.floor(s)),o},i.range=function(o,s,l){var f=[],v;if(o=i.ceil(o),l=l==null?1:Math.floor(l),!(o<s)||!(l>0))return f;do f.push(v=new Date(+o)),r(o,l),e(o);while(v<o&&o<s);return f},i.filter=function(o){return ml(function(s){if(s>=s)for(;e(s),!o(s);)s.setTime(s-1)},function(s,l){if(s>=s)if(l<0)for(;++l<=0;)for(;r(s,-1),!o(s););else for(;--l>=0;)for(;r(s,1),!o(s););})},t&&(i.count=function(o,s){return p_.setTime(+o),d_.setTime(+s),e(p_),e(d_),Math.floor(t(p_,d_))},i.every=function(o){return o=Math.floor(o),!isFinite(o)||!(o>0)?null:o>1?i.filter(n?function(s){return n(s)%o===0}:function(s){return i.count(0,s)%o===0}):i}),i}var v_=ml(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,r){e.setFullYear(e.getFullYear()+r)},function(e,r){return r.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});v_.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:ml(function(r){r.setFullYear(Math.floor(r.getFullYear()/e)*e),r.setMonth(0,1),r.setHours(0,0,0,0)},function(r,t){r.setFullYear(r.getFullYear()+t*e)})};var dv=v_,zL=v_.range,rb=ml(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,r){e.setMonth(e.getMonth()+r)},function(e,r){return r.getMonth()-e.getMonth()+(r.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()}),EP=rb,ZL=rb.range,Zg=1e3,vm=6e4,nb=36e5,ib=864e5,ab=6048e5;function _d(e){return ml(function(r){r.setDate(r.getDate()-(r.getDay()+7-e)%7),r.setHours(0,0,0,0)},function(r,t){r.setDate(r.getDate()+t*7)},function(r,t){return(t-r-(t.getTimezoneOffset()-r.getTimezoneOffset())*vm)/ab})}var m_=_d(0),Vg=_d(1),SP=_d(2),AP=_d(3),vv=_d(4),TP=_d(5),wP=_d(6),VL=m_.range,jL=Vg.range,HL=SP.range,WL=AP.range,GL=vv.range,XL=TP.range,$L=wP.range,ob=ml(function(e){e.setHours(0,0,0,0)},function(e,r){e.setDate(e.getDate()+r)},function(e,r){return(r-e-(r.getTimezoneOffset()-e.getTimezoneOffset())*vm)/ib},function(e){return e.getDate()-1}),g_=ob,YL=ob.range,sb=ml(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*Zg-e.getMinutes()*vm)},function(e,r){e.setTime(+e+r*nb)},function(e,r){return(r-e)/nb},function(e){return e.getHours()}),CP=sb,qL=sb.range,ub=ml(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*Zg)},function(e,r){e.setTime(+e+r*vm)},function(e,r){return(r-e)/vm},function(e){return e.getMinutes()}),RP=ub,KL=ub.range,lb=ml(function(e){e.setTime(e-e.getMilliseconds())},function(e,r){e.setTime(+e+r*Zg)},function(e,r){return(r-e)/Zg},function(e){return e.getUTCSeconds()}),MP=lb,QL=lb.range,jg=ml(function(){},function(e,r){e.setTime(+e+r)},function(e,r){return r-e});jg.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?ml(function(r){r.setTime(Math.floor(r/e)*e)},function(r,t){r.setTime(+r+t*e)},function(r,t){return(t-r)/e}):jg};var IP=jg,JL=jg.range;function yd(e){return ml(function(r){r.setUTCDate(r.getUTCDate()-(r.getUTCDay()+7-e)%7),r.setUTCHours(0,0,0,0)},function(r,t){r.setUTCDate(r.getUTCDate()+t*7)},function(r,t){return(t-r)/ab})}var cb=yd(0),Hg=yd(1),PP=yd(2),OP=yd(3),mv=yd(4),DP=yd(5),kP=yd(6),eN=cb.range,tN=Hg.range,rN=PP.range,nN=OP.range,iN=mv.range,aN=DP.range,oN=kP.range,fb=ml(function(e){e.setUTCHours(0,0,0,0)},function(e,r){e.setUTCDate(e.getUTCDate()+r)},function(e,r){return(r-e)/ib},function(e){return e.getUTCDate()-1}),hb=fb,sN=fb.range,__=ml(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,r){e.setUTCFullYear(e.getUTCFullYear()+r)},function(e,r){return r.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});__.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:ml(function(r){r.setUTCFullYear(Math.floor(r.getUTCFullYear()/e)*e),r.setUTCMonth(0,1),r.setUTCHours(0,0,0,0)},function(r,t){r.setUTCFullYear(r.getUTCFullYear()+t*e)})};var mm=__,uN=__.range;function y_(e){if(0<=e.y&&e.y<100){var r=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return r.setFullYear(e.y),r}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function x_(e){if(0<=e.y&&e.y<100){var r=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return r.setUTCFullYear(e.y),r}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function gm(e,r,t){return{y:e,m:r,d:t,H:0,M:0,S:0,L:0}}function FP(e){var r=e.dateTime,t=e.date,n=e.time,i=e.periods,o=e.days,s=e.shortDays,l=e.months,f=e.shortMonths,v=_m(i),y=ym(i),b=_m(o),T=ym(o),M=_m(s),O=ym(s),k=_m(l),$=ym(l),G=_m(f),oe=ym(f),ye={a:_s,A:as,b:lu,B:Ac,c:null,d:_b,e:_b,f:i5,g:d5,G:m5,H:t5,I:r5,j:n5,L:yb,m:a5,M:o5,p:BB,q:LB,Q:Tb,s:wb,S:s5,u:u5,U:l5,V:c5,w:f5,W:h5,x:null,X:null,y:p5,Y:v5,Z:g5,"%":Ab},Le={a:NB,A:UB,b:zB,B:ZB,c:null,d:bb,e:bb,f:b5,g:P5,G:D5,H:_5,I:y5,j:x5,L:Eb,m:E5,M:S5,p:VB,q:jB,Q:Tb,s:wb,S:A5,u:T5,U:w5,V:C5,w:R5,W:M5,x:null,X:null,y:I5,Y:O5,Z:k5,"%":Ab},$e={a:Mr,A:br,b:pn,B:kn,c:Pi,d:mb,e:mb,f:KP,g:vb,G:db,H:gb,I:gb,j:XP,L:qP,m:GP,M:$P,p:Jt,q:WP,Q:JP,s:e5,S:YP,u:zP,U:ZP,V:VP,w:UP,W:jP,x:xa,X:is,y:vb,Y:db,Z:HP,"%":QP};ye.x=ut(t,ye),ye.X=ut(n,ye),ye.c=ut(r,ye),Le.x=ut(t,Le),Le.X=ut(n,Le),Le.c=ut(r,Le);function ut(ni,ba){return function(Va){var dn=[],Xl=-1,Oo=0,Tc=ni.length,wc,Rd,Q2;for(Va instanceof Date||(Va=new Date(+Va));++Xl<Tc;)ni.charCodeAt(Xl)===37&&(dn.push(ni.slice(Oo,Xl)),(Rd=pb[wc=ni.charAt(++Xl)])!=null?wc=ni.charAt(++Xl):Rd=wc==="e"?" ":"0",(Q2=ba[wc])&&(wc=Q2(Va,Rd)),dn.push(wc),Oo=Xl+1);return dn.push(ni.slice(Oo,Xl)),dn.join("")}}function vt(ni,ba){return function(Va){var dn=gm(1900,void 0,1),Xl=Rt(dn,ni,Va+="",0),Oo,Tc;if(Xl!=Va.length)return null;if("Q"in dn)return new Date(dn.Q);if("s"in dn)return new Date(dn.s*1e3+("L"in dn?dn.L:0));if(ba&&!("Z"in dn)&&(dn.Z=0),"p"in dn&&(dn.H=dn.H%12+dn.p*12),dn.m===void 0&&(dn.m="q"in dn?dn.q:0),"V"in dn){if(dn.V<1||dn.V>53)return null;"w"in dn||(dn.w=1),"Z"in dn?(Oo=x_(gm(dn.y,0,1)),Tc=Oo.getUTCDay(),Oo=Tc>4||Tc===0?Hg.ceil(Oo):Hg(Oo),Oo=hb.offset(Oo,(dn.V-1)*7),dn.y=Oo.getUTCFullYear(),dn.m=Oo.getUTCMonth(),dn.d=Oo.getUTCDate()+(dn.w+6)%7):(Oo=y_(gm(dn.y,0,1)),Tc=Oo.getDay(),Oo=Tc>4||Tc===0?Vg.ceil(Oo):Vg(Oo),Oo=g_.offset(Oo,(dn.V-1)*7),dn.y=Oo.getFullYear(),dn.m=Oo.getMonth(),dn.d=Oo.getDate()+(dn.w+6)%7)}else("W"in dn||"U"in dn)&&("w"in dn||(dn.w="u"in dn?dn.u%7:"W"in dn?1:0),Tc="Z"in dn?x_(gm(dn.y,0,1)).getUTCDay():y_(gm(dn.y,0,1)).getDay(),dn.m=0,dn.d="W"in dn?(dn.w+6)%7+dn.W*7-(Tc+5)%7:dn.w+dn.U*7-(Tc+6)%7);return"Z"in dn?(dn.H+=dn.Z/100|0,dn.M+=dn.Z%100,x_(dn)):y_(dn)}}function Rt(ni,ba,Va,dn){for(var Xl=0,Oo=ba.length,Tc=Va.length,wc,Rd;Xl<Oo;){if(dn>=Tc)return-1;if(wc=ba.charCodeAt(Xl++),wc===37){if(wc=ba.charAt(Xl++),Rd=$e[wc in pb?ba.charAt(Xl++):wc],!Rd||(dn=Rd(ni,Va,dn))<0)return-1}else if(wc!=Va.charCodeAt(dn++))return-1}return dn}function Jt(ni,ba,Va){var dn=v.exec(ba.slice(Va));return dn?(ni.p=y[dn[0].toLowerCase()],Va+dn[0].length):-1}function Mr(ni,ba,Va){var dn=M.exec(ba.slice(Va));return dn?(ni.w=O[dn[0].toLowerCase()],Va+dn[0].length):-1}function br(ni,ba,Va){var dn=b.exec(ba.slice(Va));return dn?(ni.w=T[dn[0].toLowerCase()],Va+dn[0].length):-1}function pn(ni,ba,Va){var dn=G.exec(ba.slice(Va));return dn?(ni.m=oe[dn[0].toLowerCase()],Va+dn[0].length):-1}function kn(ni,ba,Va){var dn=k.exec(ba.slice(Va));return dn?(ni.m=$[dn[0].toLowerCase()],Va+dn[0].length):-1}function Pi(ni,ba,Va){return Rt(ni,r,ba,Va)}function xa(ni,ba,Va){return Rt(ni,t,ba,Va)}function is(ni,ba,Va){return Rt(ni,n,ba,Va)}function _s(ni){return s[ni.getDay()]}function as(ni){return o[ni.getDay()]}function lu(ni){return f[ni.getMonth()]}function Ac(ni){return l[ni.getMonth()]}function BB(ni){return i[+(ni.getHours()>=12)]}function LB(ni){return 1+~~(ni.getMonth()/3)}function NB(ni){return s[ni.getUTCDay()]}function UB(ni){return o[ni.getUTCDay()]}function zB(ni){return f[ni.getUTCMonth()]}function ZB(ni){return l[ni.getUTCMonth()]}function VB(ni){return i[+(ni.getUTCHours()>=12)]}function jB(ni){return 1+~~(ni.getUTCMonth()/3)}return{format:function(ni){var ba=ut(ni+="",ye);return ba.toString=function(){return ni},ba},parse:function(ni){var ba=vt(ni+="",!1);return ba.toString=function(){return ni},ba},utcFormat:function(ni){var ba=ut(ni+="",Le);return ba.toString=function(){return ni},ba},utcParse:function(ni){var ba=vt(ni+="",!0);return ba.toString=function(){return ni},ba}}}var pb={"-":"",_:" ",0:"0"},uu=/^\s*\d+/,BP=/^%/,LP=/[\\^$*+?|[\]().{}]/g;function Za(e,r,t){var n=e<0?"-":"",i=(n?-e:e)+"",o=i.length;return n+(o<t?new Array(t-o+1).join(r)+i:i)}function NP(e){return e.replace(LP,"\\$&")}function _m(e){return new RegExp("^(?:"+e.map(NP).join("|")+")","i")}function ym(e){for(var r={},t=-1,n=e.length;++t<n;)r[e[t].toLowerCase()]=t;return r}function UP(e,r,t){var n=uu.exec(r.slice(t,t+1));return n?(e.w=+n[0],t+n[0].length):-1}function zP(e,r,t){var n=uu.exec(r.slice(t,t+1));return n?(e.u=+n[0],t+n[0].length):-1}function ZP(e,r,t){var n=uu.exec(r.slice(t,t+2));return n?(e.U=+n[0],t+n[0].length):-1}function VP(e,r,t){var n=uu.exec(r.slice(t,t+2));return n?(e.V=+n[0],t+n[0].length):-1}function jP(e,r,t){var n=uu.exec(r.slice(t,t+2));return n?(e.W=+n[0],t+n[0].length):-1}function db(e,r,t){var n=uu.exec(r.slice(t,t+4));return n?(e.y=+n[0],t+n[0].length):-1}function vb(e,r,t){var n=uu.exec(r.slice(t,t+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),t+n[0].length):-1}function HP(e,r,t){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(r.slice(t,t+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),t+n[0].length):-1}function WP(e,r,t){var n=uu.exec(r.slice(t,t+1));return n?(e.q=n[0]*3-3,t+n[0].length):-1}function GP(e,r,t){var n=uu.exec(r.slice(t,t+2));return n?(e.m=n[0]-1,t+n[0].length):-1}function mb(e,r,t){var n=uu.exec(r.slice(t,t+2));return n?(e.d=+n[0],t+n[0].length):-1}function XP(e,r,t){var n=uu.exec(r.slice(t,t+3));return n?(e.m=0,e.d=+n[0],t+n[0].length):-1}function gb(e,r,t){var n=uu.exec(r.slice(t,t+2));return n?(e.H=+n[0],t+n[0].length):-1}function $P(e,r,t){var n=uu.exec(r.slice(t,t+2));return n?(e.M=+n[0],t+n[0].length):-1}function YP(e,r,t){var n=uu.exec(r.slice(t,t+2));return n?(e.S=+n[0],t+n[0].length):-1}function qP(e,r,t){var n=uu.exec(r.slice(t,t+3));return n?(e.L=+n[0],t+n[0].length):-1}function KP(e,r,t){var n=uu.exec(r.slice(t,t+6));return n?(e.L=Math.floor(n[0]/1e3),t+n[0].length):-1}function QP(e,r,t){var n=BP.exec(r.slice(t,t+1));return n?t+n[0].length:-1}function JP(e,r,t){var n=uu.exec(r.slice(t));return n?(e.Q=+n[0],t+n[0].length):-1}function e5(e,r,t){var n=uu.exec(r.slice(t));return n?(e.s=+n[0],t+n[0].length):-1}function _b(e,r){return Za(e.getDate(),r,2)}function t5(e,r){return Za(e.getHours(),r,2)}function r5(e,r){return Za(e.getHours()%12||12,r,2)}function n5(e,r){return Za(1+g_.count(dv(e),e),r,3)}function yb(e,r){return Za(e.getMilliseconds(),r,3)}function i5(e,r){return yb(e,r)+"000"}function a5(e,r){return Za(e.getMonth()+1,r,2)}function o5(e,r){return Za(e.getMinutes(),r,2)}function s5(e,r){return Za(e.getSeconds(),r,2)}function u5(e){var r=e.getDay();return r===0?7:r}function l5(e,r){return Za(m_.count(dv(e)-1,e),r,2)}function xb(e){var r=e.getDay();return r>=4||r===0?vv(e):vv.ceil(e)}function c5(e,r){return e=xb(e),Za(vv.count(dv(e),e)+(dv(e).getDay()===4),r,2)}function f5(e){return e.getDay()}function h5(e,r){return Za(Vg.count(dv(e)-1,e),r,2)}function p5(e,r){return Za(e.getFullYear()%100,r,2)}function d5(e,r){return e=xb(e),Za(e.getFullYear()%100,r,2)}function v5(e,r){return Za(e.getFullYear()%1e4,r,4)}function m5(e,r){var t=e.getDay();return e=t>=4||t===0?vv(e):vv.ceil(e),Za(e.getFullYear()%1e4,r,4)}function g5(e){var r=e.getTimezoneOffset();return(r>0?"-":(r*=-1,"+"))+Za(r/60|0,"0",2)+Za(r%60,"0",2)}function bb(e,r){return Za(e.getUTCDate(),r,2)}function _5(e,r){return Za(e.getUTCHours(),r,2)}function y5(e,r){return Za(e.getUTCHours()%12||12,r,2)}function x5(e,r){return Za(1+hb.count(mm(e),e),r,3)}function Eb(e,r){return Za(e.getUTCMilliseconds(),r,3)}function b5(e,r){return Eb(e,r)+"000"}function E5(e,r){return Za(e.getUTCMonth()+1,r,2)}function S5(e,r){return Za(e.getUTCMinutes(),r,2)}function A5(e,r){return Za(e.getUTCSeconds(),r,2)}function T5(e){var r=e.getUTCDay();return r===0?7:r}function w5(e,r){return Za(cb.count(mm(e)-1,e),r,2)}function Sb(e){var r=e.getUTCDay();return r>=4||r===0?mv(e):mv.ceil(e)}function C5(e,r){return e=Sb(e),Za(mv.count(mm(e),e)+(mm(e).getUTCDay()===4),r,2)}function R5(e){return e.getUTCDay()}function M5(e,r){return Za(Hg.count(mm(e)-1,e),r,2)}function I5(e,r){return Za(e.getUTCFullYear()%100,r,2)}function P5(e,r){return e=Sb(e),Za(e.getUTCFullYear()%100,r,2)}function O5(e,r){return Za(e.getUTCFullYear()%1e4,r,4)}function D5(e,r){var t=e.getUTCDay();return e=t>=4||t===0?mv(e):mv.ceil(e),Za(e.getUTCFullYear()%1e4,r,4)}function k5(){return"+0000"}function Ab(){return"%"}function Tb(e){return+e}function wb(e){return Math.floor(+e/1e3)}var gv,Cb,F5,B5,L5;N5({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function N5(e){return gv=FP(e),Cb=gv.format,F5=gv.parse,B5=gv.utcFormat,L5=gv.utcParse,gv}var xm=1e3,bm=xm*60,Em=bm*60,Sm=Em*24,U5=Sm*7,Rb=Sm*30,b_=Sm*365;function z5(e){return new Date(e)}function Z5(e){return e instanceof Date?+e:+new Date(+e)}function Mb(e,r,t,n,i,o,s,l,f){var v=Bx(Yu,Yu),y=v.invert,b=v.domain,T=f(".%L"),M=f(":%S"),O=f("%I:%M"),k=f("%I %p"),$=f("%a %d"),G=f("%b %d"),oe=f("%B"),ye=f("%Y"),Le=[[s,1,xm],[s,5,5*xm],[s,15,15*xm],[s,30,30*xm],[o,1,bm],[o,5,5*bm],[o,15,15*bm],[o,30,30*bm],[i,1,Em],[i,3,3*Em],[i,6,6*Em],[i,12,12*Em],[n,1,Sm],[n,2,2*Sm],[t,1,U5],[r,1,Rb],[r,3,3*Rb],[e,1,b_]];function $e(vt){return(s(vt)<vt?T:o(vt)<vt?M:i(vt)<vt?O:n(vt)<vt?k:r(vt)<vt?t(vt)<vt?$:G:e(vt)<vt?oe:ye)(vt)}function ut(vt,Rt,Jt,Mr){if(vt==null&&(vt=10),typeof vt=="number"){var br=Math.abs(Jt-Rt)/vt,pn=px(function(kn){return kn[2]}).right(Le,br);pn===Le.length?(Mr=r_(Rt/b_,Jt/b_,vt),vt=e):pn?(pn=Le[br/Le[pn-1][2]<Le[pn][2]/br?pn-1:pn],Mr=pn[1],vt=pn[0]):(Mr=Math.max(r_(Rt,Jt,vt),1),vt=l)}return Mr==null?vt:vt.every(Mr)}return v.invert=function(vt){return new Date(y(vt))},v.domain=function(vt){return arguments.length?b(Rx.call(vt,Z5)):b().map(z5)},v.ticks=function(vt,Rt){var Jt=b(),Mr=Jt[0],br=Jt[Jt.length-1],pn=br<Mr,kn;return pn&&(kn=Mr,Mr=br,br=kn),kn=ut(vt,Mr,br,Rt),kn=kn?kn.range(Mr,br+1):[],pn?kn.reverse():kn},v.tickFormat=function(vt,Rt){return Rt==null?$e:f(Rt)},v.nice=function(vt,Rt){var Jt=b();return(vt=ut(vt,Jt[0],Jt[Jt.length-1],Rt))?b(Wx(Jt,vt)):v},v.copy=function(){return Lg(v,Mb(e,r,t,n,i,o,s,l,f))},v}function V5(){return Dp.apply(Mb(dv,EP,m_,g_,CP,RP,MP,IP,Cb).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function lN(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function Wg(){var e=0,r=1,t,n,i,o,s=Yu,l=!1,f;function v(y){return isNaN(y=+y)?f:s(i===0?.5:(y=(o(y)-t)*i,l?Math.max(0,Math.min(1,y)):y))}return v.domain=function(y){return arguments.length?(t=o(e=+y[0]),n=o(r=+y[1]),i=t===n?0:1/(n-t),v):[e,r]},v.clamp=function(y){return arguments.length?(l=!!y,v):l},v.interpolator=function(y){return arguments.length?(s=y,v):s},v.unknown=function(y){return arguments.length?(f=y,v):f},function(y){return o=y,t=y(e),n=y(r),i=t===n?0:1/(n-t),v}}function Am(e,r){return r.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function Ib(){var e=dm(Wg()(Yu));return e.copy=function(){return Am(e,Ib())},Mx.apply(e,arguments)}function j5(){var e=loggish(Wg()).domain([1,10]);return e.copy=function(){return Am(e,j5()).base(e.base())},initInterpolator.apply(e,arguments)}function H5(){var e=symlogish(Wg());return e.copy=function(){return Am(e,H5()).constant(e.constant())},initInterpolator.apply(e,arguments)}function Pb(){var e=powish(Wg());return e.copy=function(){return Am(e,Pb()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function cN(){return Pb.apply(null,arguments).exponent(.5)}function W5(){var e=[],r=identity;function t(n){if(!isNaN(n=+n))return r((bisect(e,n)-1)/(e.length-1))}return t.domain=function(n){if(!arguments.length)return e.slice();e=[];for(var i=0,o=n.length,s;i<o;++i)s=n[i],s!=null&&!isNaN(s=+s)&&e.push(s);return e.sort(ascending),t},t.interpolator=function(n){return arguments.length?(r=n,t):r},t.copy=function(){return W5(r).domain(e)},initInterpolator.apply(t,arguments)}function Gg(){var e=0,r=.5,t=1,n,i,o,s,l,f=Yu,v,y=!1,b;function T(M){return isNaN(M=+M)?b:(M=.5+((M=+v(M))-i)*(M<i?s:l),f(y?Math.max(0,Math.min(1,M)):M))}return T.domain=function(M){return arguments.length?(n=v(e=+M[0]),i=v(r=+M[1]),o=v(t=+M[2]),s=n===i?0:.5/(i-n),l=i===o?0:.5/(o-i),T):[e,r,t]},T.clamp=function(M){return arguments.length?(y=!!M,T):y},T.interpolator=function(M){return arguments.length?(f=M,T):f},T.unknown=function(M){return arguments.length?(b=M,T):b},function(M){return v=M,n=M(e),i=M(r),o=M(t),s=n===i?0:.5/(i-n),l=i===o?0:.5/(o-i),T}}function Ob(){var e=dm(Gg()(Yu));return e.copy=function(){return Am(e,Ob())},Mx.apply(e,arguments)}function G5(){var e=loggish(Gg()).domain([.1,1,10]);return e.copy=function(){return copy(e,G5()).base(e.base())},initInterpolator.apply(e,arguments)}function X5(){var e=symlogish(Gg());return e.copy=function(){return copy(e,X5()).constant(e.constant())},initInterpolator.apply(e,arguments)}function Db(){var e=powish(Gg());return e.copy=function(){return copy(e,Db()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function fN(){return Db.apply(null,arguments).exponent(.5)}function kb(e){var r,t=[];function n(i){return i==null?r:i}return n.invert=n,n.domain=n.range=function(i){return i?(t=i,i):t},n.unknown=function(i){return i?(r=i,i):r},n.copy=function(){return kb(e).unknown(r)},n}var bc,Fb,Bb,E_=ii.isNil,$5=ii.isString,Y5=ii.uniq,q5=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,K5=(bc={},(0,B.Z)(bc,to.LINEAR,Hx),(0,B.Z)(bc,to.POWER,h_),(0,B.Z)(bc,to.LOG,Yx),(0,B.Z)(bc,to.IDENTITY,kb),(0,B.Z)(bc,to.SEQUENTIAL,Ib),(0,B.Z)(bc,to.TIME,V5),(0,B.Z)(bc,to.QUANTILE,Jx),(0,B.Z)(bc,to.QUANTIZE,eb),(0,B.Z)(bc,to.THRESHOLD,tb),(0,B.Z)(bc,to.CAT,Fg),(0,B.Z)(bc,to.DIVERGING,Ob),bc),Q5=(Fb=(0,gt.b2)(),Fb(Bb=function(){function e(){(0,q.Z)(this,e),(0,B.Z)(this,"scaleOptions",{})}return(0,V.Z)(e,[{key:"apply",value:function(t,n){var i=this,o=n.styleAttributeService;t.hooks.init.tapPromise("FeatureScalePlugin",(0,Ct.Z)(me().mark(function s(){var l,f,v;return me().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(t.log(Rs.ScaleInitStart,ds.INIT),i.scaleOptions=t.getScaleOptions(),f=o.getLayerStyleAttributes(),v=(l=t.getSource())===null||l===void 0?void 0:l.data.dataArray,!(Array.isArray(v)&&v.length===0)){b.next=8;break}return b.abrupt("return");case 8:i.caculateScalesForAttributes(f||[],v);case 9:t.log(Rs.ScaleInitEnd,ds.INIT);case 10:case"end":return b.stop()}},s)}))),t.hooks.beforeRenderData.tapPromise("FeatureScalePlugin",function(){var s=(0,Ct.Z)(me().mark(function l(f){var v,y;return me().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:if(f){T.next=2;break}return T.abrupt("return",f);case 2:if(t.log(Rs.ScaleInitStart,ds.UPDATE),i.scaleOptions=t.getScaleOptions(),v=o.getLayerStyleAttributes(),y=t.getSource().data.dataArray,!(Array.isArray(y)&&y.length===0)){T.next=8;break}return T.abrupt("return",!0);case 8:return i.caculateScalesForAttributes(v||[],y),t.log(Rs.ScaleInitEnd,ds.UPDATE),t.layerModelNeedUpdate=!0,T.abrupt("return",!0);case 12:case"end":return T.stop()}},l)}));return function(l){return s.apply(this,arguments)}}()),t.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!t.layerModelNeedUpdate){i.scaleOptions=t.getScaleOptions();var s=o.getLayerStyleAttributes(),l=t.getSource().data.dataArray;if(!(Array.isArray(l)&&l.length===0)&&s){var f=s.filter(function(v){return v.needRescale});f.length&&i.caculateScalesForAttributes(f,l)}}})}},{key:"isNumber",value:function(t){return!isNaN(parseFloat(t))&&isFinite(t)}},{key:"caculateScalesForAttributes",value:function(t,n){var i=this;t.forEach(function(o){if(o.scale){var s=o.scale,l=o.scale.field;s.names=i.parseFields(E_(l)?[]:l);var f=[];s.names.forEach(function(v){var y;f.push(i.createScale(v,o.name,(y=o.scale)===null||y===void 0?void 0:y.values,n))}),f.some(function(v){return v.type===ov.VARIABLE})?(s.type=ov.VARIABLE,f.forEach(function(v){if(!s.callback&&s.values!=="text"){var y;switch((y=v.option)===null||y===void 0?void 0:y.type){case to.LOG:case to.LINEAR:case to.POWER:if(s.values&&s.values.length>2){var b=v.scale.ticks(s.values.length);v.scale.domain(b)}s.values?v.scale.range(s.values):v.scale.range(v.option.domain);break;case to.QUANTILE:case to.QUANTIZE:case to.THRESHOLD:v.scale.range(s.values);break;case to.IDENTITY:break;case to.CAT:s.values?v.scale.range(s.values):v.scale.range(v.option.domain);break;case to.DIVERGING:case to.SEQUENTIAL:v.scale.interpolator(BI(s.values));break}}if(s.values==="text"){var T;v.scale.range((T=v.option)===null||T===void 0?void 0:T.domain)}})):(s.type=ov.CONSTANT,s.defaultValues=f.map(function(v,y){return v.scale(s.names[y])})),s.scalers=f.map(function(v){return{field:v.field,func:v.scale,option:v.option}}),o.needRescale=!1}})}},{key:"parseFields",value:function(t){return Array.isArray(t)?t:$5(t)?t.split("*"):[t]}},{key:"createScale",value:function(t,n,i,o){var s,l,f=this.scaleOptions[n]&&((s=this.scaleOptions[n])===null||s===void 0?void 0:s.field)===t?this.scaleOptions[n]:this.scaleOptions[t],v={field:t,scale:void 0,type:ov.VARIABLE,option:f};if(!o||!o.length)return f&&f.type?v.scale=this.createDefaultScale(f):(v.scale=Fg([t]),v.type=ov.CONSTANT),v;var y=(l=o.find(function(M){return!E_(M[t])}))===null||l===void 0?void 0:l[t];if(this.isNumber(t)||E_(y)&&!f)v.scale=Fg([t]),v.type=ov.CONSTANT;else{var b=f&&f.type||this.getDefaultType(y);i==="text"&&(b=to.CAT),i===void 0&&(b=to.IDENTITY);var T=this.createScaleConfig(b,t,f,o);v.scale=this.createDefaultScale(T),v.option=T}return v}},{key:"getDefaultType",value:function(t){var n=to.LINEAR;return typeof t=="string"&&(n=q5.test(t)?to.TIME:to.CAT),n}},{key:"createScaleConfig",value:function(t,n,i,o){var s={type:t},l=(o==null?void 0:o.map(function(y){return y[n]}))||[];if(i!=null&&i.domain)s.domain=i==null?void 0:i.domain;else if(t===to.CAT||t===to.IDENTITY)s.domain=Y5(l);else if(t===to.QUANTILE)s.domain=l;else if(t===to.DIVERGING){var f=vx(l),v=(i==null?void 0:i.neutral)!==void 0?i==null?void 0:i.neutral:(f[0]+f[1])/2;s.domain=[f[0],v,f[1]]}else s.domain=vx(l);return(0,H.Z)((0,H.Z)({},s),i)}},{key:"createDefaultScale",value:function(t){var n=t.type,i=t.domain,o=t.unknown,s=t.clamp,l=t.nice,f=K5[n]();return i&&f.domain&&f.domain(i),o&&f.unknown(o),s!==void 0&&f.clamp&&f.clamp(s),l!==void 0&&f.nice&&f.nice(l),f}}]),e}())||Bb),Lb,Nb,J5=(Lb=(0,gt.b2)(),Lb(Nb=function(){function e(){(0,q.Z)(this,e)}return(0,V.Z)(e,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){var n=t.animateStatus;n&&t.models.forEach(function(i){i.addUniforms((0,H.Z)({},t.layerModel.getAnimateUniforms()))})})}}]),e}())||Nb),Ub,zb,e4=(Ub=(0,gt.b2)(),Ub(zb=function(){function e(){(0,q.Z)(this,e)}return(0,V.Z)(e,[{key:"apply",value:function(t){t.hooks.afterInit.tap("LayerMaskPlugin",function(){var n=t.getLayerConfig(),i=n.maskLayers,o=n.enableMask;if(!t.tileLayer&&i&&i.length>0){var s;(s=t.masks).push.apply(s,(0,Wt.Z)(i)),t.updateLayerConfig({mask:o})}})}}]),e}())||zb),t4=function(){function e(r){var t=r.rendererService,n=r.layerService,i=r.parent;(0,q.Z)(this,e),(0,B.Z)(this,"tileResource",new Map),(0,B.Z)(this,"layerTiles",[]),this.rendererService=t,this.layerService=n,this.parent=i}return(0,V.Z)(e,[{key:"tiles",get:function(){return this.layerTiles}},{key:"hasTile",value:function(t){return this.layerTiles.some(function(n){return n.key===t})}},{key:"addTile",value:function(t){this.layerTiles.push(t)}},{key:"getTile",value:function(t){return this.layerTiles.find(function(n){return n.key===t})}},{key:"getVisibleTileBylngLat",value:function(t){return this.layerTiles.find(function(n){return n.isLoaded&&n.visible&&n.lnglatInBounds(t)})}},{key:"removeTile",value:function(t){var n=this.layerTiles.findIndex(function(o){return o.key===t}),i=this.layerTiles.splice(n,1);i[0]&&i[0].destroy()}},{key:"updateTileVisible",value:function(t){var n=this.getTile(t.key);if(t.isVisible)if(t.parent){var i=this.isChildrenLoaded(t.parent);n==null||n.updateVisible(i)}else n==null||n.updateVisible(!0);else if(t.parent){var o=this.isChildrenLoaded(t.parent);n==null||n.updateVisible(!o)}else n==null||n.updateVisible(!1)}},{key:"isParentLoaded",value:function(t){var n=t.parent;if(!n)return!0;var i=this.getTile(n==null?void 0:n.key);return!!(i!=null&&i.isLoaded)}},{key:"isChildrenLoaded",value:function(t){var n=this,i=t==null?void 0:t.children;return i.length===0?!0:i.every(function(o){var s=n.getTile(o==null?void 0:o.key);return s?(s==null?void 0:s.isLoaded)===!0:!0})}},{key:"render",value:function(){var r=(0,Ct.Z)(me().mark(function n(){var i=this,o,s;return me().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return o=this.getRenderLayers(),s=o.map(function(){var v=(0,Ct.Z)(me().mark(function y(b){return me().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return M.next=2,i.layerService.renderTileLayer(b);case 2:case"end":return M.stop()}},y)}));return function(y){return v.apply(this,arguments)}}()),f.next=4,Promise.all(s);case 4:case"end":return f.stop()}},n,this)}));function t(){return r.apply(this,arguments)}return t}()},{key:"getRenderLayers",value:function(){var t=this.layerTiles.filter(function(i){return i.visible&&i.isLoaded}),n=[];return t.map(function(i){return n.push.apply(n,(0,Wt.Z)(i.getLayers()))}),n}},{key:"getLayers",value:function(){var t=this.layerTiles.filter(function(i){return i.isLoaded}),n=[];return t.map(function(i){return n.push.apply(n,(0,Wt.Z)(i.getLayers()))}),n}},{key:"getTiles",value:function(){return this.layerTiles}},{key:"destroy",value:function(){this.layerTiles.forEach(function(t){return t.destroy()}),this.tileResource.clear()}}]),e}(),r4=L(23167);function n4(e,r,t){t===void 0&&(t={});var n=Vr(e),i=Vr(r),o=r4.union(n.coordinates,i.coordinates);return o.length===0?null:o.length===1?yr(o[0],t.properties):rn(o,t.properties)}var i4=n4,a4=function(){function e(){(0,q.Z)(this,e)}return(0,V.Z)(e,[{key:"getCombineFeature",value:function(t){var n=null,i=t[0];return t.map(function(o){var s=yr(o.coordinates);n===null?n=s:n=i4(n,s)}),i&&(n.properties=(0,H.Z)({},i)),n}}]),e}(),Tm="select",wm="active",o4=function(){function e(r){var t=r.layerService,n=r.tileLayerService,i=r.parent;(0,q.Z)(this,e),(0,B.Z)(this,"tilePickID",new Map),this.layerService=t,this.tileLayerService=n,this.parent=i,this.tileSourceService=new a4}return(0,V.Z)(e,[{key:"pickRender",value:function(t){var n=this.tileLayerService.getVisibleTileBylngLat(t.lngLat);if(n){var i=n.getMainLayer();i==null||i.layerPickService.pickRender(t)}}},{key:"pick",value:function(t,n){var i=this.parent.getContainer(),o=i.get(tt.IPickingService);if(t.type==="RasterLayer"){var s=this.tileLayerService.getVisibleTileBylngLat(n.lngLat);if(s&&s.getMainLayer()!==void 0){var l=s.getMainLayer();return l.layerPickService.pickRasterLayer(l,n,this.parent)}return!1}return this.pickRender(n),o.pickFromPickingFBO(t,n)}},{key:"selectFeature",value:function(t){var n=(0,yn.Z)(t,3),i=n[0],o=n[1],s=n[2],l=this.color2PickId(i,o,s);this.tilePickID.set(Tm,l),this.updateHighLight(i,o,s,Tm)}},{key:"highlightPickedFeature",value:function(t){var n=(0,yn.Z)(t,3),i=n[0],o=n[1],s=n[2],l=this.color2PickId(i,o,s);this.tilePickID.set(wm,l),this.updateHighLight(i,o,s,wm)}},{key:"updateHighLight",value:function(t,n,i,o){this.tileLayerService.tiles.map(function(s){var l=s.getMainLayer();switch(o){case Tm:l==null||l.hooks.beforeSelect.call([t,n,i]);break;case wm:l==null||l.hooks.beforeHighlight.call([t,n,i]);break}})}},{key:"setPickState",value:function(){var t=this.tilePickID.get(Tm),n=this.tilePickID.get(wm);if(t){var i=this.pickId2Color(t),o=(0,yn.Z)(i,3),s=o[0],l=o[1],f=o[2];this.updateHighLight(s,l,f,Tm);return}if(n){var v=this.pickId2Color(n),y=(0,yn.Z)(v,3),b=y[0],T=y[1],M=y[2];this.updateHighLight(b,T,M,wm);return}}},{key:"color2PickId",value:function(t,n,i){return Oa(new Uint8Array([t,n,i]))}},{key:"pickId2Color",value:function(t){return ia(t)}},{key:"getFeatureById",value:function(t){var n=this.tileLayerService.getTiles().filter(function(o){return o.visible}),i=[];return n.forEach(function(o){i.push.apply(i,(0,Wt.Z)(o.getFeatureById(t)))}),i}},{key:"pickRasterLayer",value:function(t,n,i){return!1}}]),e}();function s4(e){return e==="PolygonLayer"?Rg:e==="LineLayer"?q0:Cg}function u4(e){return["PolygonLayer","LineLayer"].indexOf(e)!==-1}function l4(e){var r=c4();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function c4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xd=function(e){(0,De.Z)(t,e);var r=l4(t);function t(n,i){var o;return(0,q.Z)(this,t),o=r.call(this),(0,B.Z)((0,Ie.Z)(o),"visible",!0),(0,B.Z)((0,Ie.Z)(o),"layers",[]),(0,B.Z)((0,Ie.Z)(o),"isLoaded",!1),(0,B.Z)((0,Ie.Z)(o),"tileMaskLayers",[]),o.parent=i,o.sourceTile=n,o.x=n.x,o.y=n.y,o.z=n.z,o.key="".concat(o.x,"_").concat(o.y,"_").concat(o.z),o}return(0,V.Z)(t,[{key:"getLayers",value:function(){return this.layers}},{key:"styleUpdate",value:function(){}},{key:"lnglatInBounds",value:function(i){var o=(0,yn.Z)(this.sourceTile.bounds,4),s=o[0],l=o[1],f=o[2],v=o[3],y=i.lng,b=i.lat;return y>=s&&y<=f&&b>=l&&b<=v}},{key:"getLayerOptions",value:function(){var i,o=this.parent.getLayerConfig();return(0,H.Z)((0,H.Z)({},o),{},{textAllowOverlap:!0,autoFit:!1,maskLayers:this.getMaskLayer(),tileMask:u4(this.parent.type),mask:o.mask||((i=o.maskLayers)===null||i===void 0?void 0:i.length)!==0&&o.enableMask})}},{key:"getMaskLayer",value:function(){var i=this,o=this.parent.getLayerConfig(),s=o.maskLayers,l=[];return s==null||s.forEach(function(f){if(!f.tileLayer)return l.push(f),f;var v=f.tileLayer,y=v.getTile(i.sourceTile.key),b=y==null?void 0:y.getLayers()[0];b&&l.push(b)}),l}},{key:"addTileMask",value:function(){var n=(0,Ct.Z)(me().mark(function o(){var s,l,f;return me().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return s=new Rg({visible:!1,enablePicking:!1}).source({type:"FeatureCollection",features:[this.sourceTile.bboxPolygon]},{parser:{type:"geojson",featureId:"id"}}).shape("fill").style({opacity:.5}),l=lm(this.parent.sceneContainer),s.setContainer(l,this.parent.sceneContainer),y.next=5,s.init();case 5:return this.tileMask=s,f=this.getMainLayer(),f!==void 0&&(f.tileMask=s),y.abrupt("return",s);case 9:case"end":return y.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"addMask",value:function(){var n=(0,Ct.Z)(me().mark(function o(s,l){var f;return me().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return f=lm(this.parent.sceneContainer),l.setContainer(f,this.parent.sceneContainer),y.next=4,l.init();case 4:s.addMask(l),this.tileMaskLayers.push(l);case 6:case"end":return y.stop()}},o,this)}));function i(o,s){return n.apply(this,arguments)}return i}()},{key:"addLayer",value:function(){var n=(0,Ct.Z)(me().mark(function o(s){var l;return me().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return s.isTileLayer=!0,l=lm(this.parent.sceneContainer),s.setContainer(l,this.parent.sceneContainer),this.layers.push(s),v.next=6,s.init();case 6:case"end":return v.stop()}},o,this)}));function i(o){return n.apply(this,arguments)}return i}()},{key:"updateVisible",value:function(i){this.visible=i,this.updateOptions("visible",i)}},{key:"updateOptions",value:function(i,o){this.layers.forEach(function(s){s.updateLayerConfig((0,B.Z)({},i,o))})}},{key:"getMainLayer",value:function(){return this.layers[0]}},{key:"getFeatures",value:function(i){return[]}},{key:"getFeatureById",value:function(i){return[]}},{key:"destroy",value:function(){var i;(i=this.tileMask)===null||i===void 0||i.destroy(),this.layers.forEach(function(o){return o.destroy()})}}]),t}(no.EventEmitter);function f4(e){var r=h4();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function h4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var p4=function(e){(0,De.Z)(t,e);var r=f4(t);function t(){return(0,q.Z)(this,t),r.apply(this,arguments)}return(0,V.Z)(t,[{key:"initTileLayer",value:function(){var n=(0,Ct.Z)(me().mark(function o(){var s,l,f,v;return me().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return s=this.getSourceOption(),l=s.data.features[0].properties,f=new q0().source(s.data,s.options).size(1).shape("line").color("red"),v=new Cg({minZoom:this.z-1,maxZoom:this.z+1,textAllowOverlap:!0}).source([l],{parser:{type:"json",x:"x",y:"y"}}).size(20).color("red").shape(this.key).style({stroke:"#fff",strokeWidth:2}),b.next=6,this.addLayer(f);case 6:return b.next=8,this.addLayer(v);case 8:this.isLoaded=!0;case 9:case"end":return b.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSourceOption",value:function(){var i=this.parent.getSource(),o=this.sourceTile.data.layers.testTile.features;return{data:{type:"FeatureCollection",features:o},options:{parser:{type:"geojson"},transforms:i.transforms}}}}]),t}(xd);function d4(e){var r=v4();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function v4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var m4=function(e){(0,De.Z)(t,e);var r=d4(t);function t(){return(0,q.Z)(this,t),r.apply(this,arguments)}return(0,V.Z)(t,[{key:"initTileLayer",value:function(){var n=(0,Ct.Z)(me().mark(function o(){var s,l,f,v;return me().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return s=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),f=this.getSourceOption(),v=new P1((0,H.Z)({},l)).source(f.data,f.options),s&&Object.keys(s).forEach(function(T){var M,O,k=T;v[k]((M=s[k])===null||M===void 0?void 0:M.field,(O=s[k])===null||O===void 0?void 0:O.values)}),b.next=7,this.addLayer(v);case 7:this.isLoaded=!0;case 8:case"end":return b.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSourceOption",value:function(){var i=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:i.transforms}}}}]),t}(xd);function g4(e){var r=_4();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function _4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var y4=function(e){(0,De.Z)(t,e);var r=g4(t);function t(){return(0,q.Z)(this,t),r.apply(this,arguments)}return(0,V.Z)(t,[{key:"initTileLayer",value:function(){var n=(0,Ct.Z)(me().mark(function o(){var s,l,f,v;return me().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return s=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),f=this.getSourceOption(),v=new ix((0,H.Z)({},l)).source(f.data,f.options),s&&Object.keys(s).forEach(function(T){var M,O,k=T;v[k]((M=s[k])===null||M===void 0?void 0:M.field,(O=s[k])===null||O===void 0?void 0:O.values)}),b.next=7,this.addLayer(v);case 7:this.isLoaded=!0;case 8:case"end":return b.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getFeatures",value:function(i){if(!i)return[];var o=this.sourceTile.data;return o.getTileData(i)}},{key:"getSourceOption",value:function(){var i=this.parent.getSource(),o=this.parent.getLayerConfig(),s=o.sourceLayer,l=o.featureId,f=this.getFeatures(s);return{data:{type:"FeatureCollection",features:f},options:{parser:{type:"geojson",featureId:l},transforms:i.transforms}}}}]),t}(xd),x4=["rasterData"];function b4(e){var r=E4();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function E4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var S4=function(e){(0,De.Z)(t,e);var r=b4(t);function t(){return(0,q.Z)(this,t),r.apply(this,arguments)}return(0,V.Z)(t,[{key:"initTileLayer",value:function(){var n=(0,Ct.Z)(me().mark(function o(){var s,l,f,v;return me().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return s=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),f=this.getSourceOption(),v=new Mg((0,H.Z)({},l)).source(f.data,f.options),s&&Object.keys(s).forEach(function(T){var M,O,k=T;v[k]((M=s[k])===null||M===void 0?void 0:M.field,(O=s[k])===null||O===void 0?void 0:O.values)}),b.next=7,this.addLayer(v);case 7:this.isLoaded=!0;case 8:case"end":return b.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSourceOption",value:function(){var i=this.parent.getSource(),o=this.sourceTile.data.data,s=o.rasterData,l=(0,Fa.Z)(o,x4);return{data:s,options:{parser:(0,H.Z)({type:"rasterRgb",extent:this.sourceTile.bounds},l),transforms:i.transforms}}}}]),t}(xd);function A4(e){var r=T4();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function T4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var w4=function(e){(0,De.Z)(t,e);var r=A4(t);function t(){return(0,q.Z)(this,t),r.apply(this,arguments)}return(0,V.Z)(t,[{key:"initTileLayer",value:function(){var n=(0,Ct.Z)(me().mark(function o(){var s,l,f,v;return me().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return s=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),f=this.getSourceOption(),v=new Mg((0,H.Z)({},l)).source(f.data,f.options),s&&Object.keys(s).forEach(function(T){var M,O,k=T;v[k]((M=s[k])===null||M===void 0?void 0:M.field,(O=s[k])===null||O===void 0?void 0:O.values)}),b.next=7,this.addLayer(v);case 7:this.isLoaded=!0;case 8:case"end":return b.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSourceOption",value:function(){var i=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:i.transforms}}}}]),t}(xd),C4=["rasterData"];function R4(e){var r=M4();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function M4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var I4={positions:[0,1],colors:["#000","#fff"]},P4=function(e){(0,De.Z)(t,e);var r=R4(t);function t(){return(0,q.Z)(this,t),r.apply(this,arguments)}return(0,V.Z)(t,[{key:"initTileLayer",value:function(){var n=(0,Ct.Z)(me().mark(function o(){var s,l,f,v,y,b,T;return me().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return s=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),f=this.getSourceOption(),v=this.getLayerOptions(),y=v.rampColors,b=v.domain,this.colorTexture=this.parent.textureService.getColorTexture(y,b),T=new Mg((0,H.Z)((0,H.Z)({},l),{},{colorTexture:this.colorTexture})).source(f.data,f.options),s&&Object.keys(s).forEach(function(k){var $,G,oe=k;T[oe](($=s[oe])===null||$===void 0?void 0:$.field,(G=s[oe])===null||G===void 0?void 0:G.values)}),O.next=9,this.addLayer(T);case 9:this.isLoaded=!0;case 10:case"end":return O.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSourceOption",value:function(){var i=this.parent.getSource(),o=this.sourceTile.data.data,s=o.rasterData,l=(0,Fa.Z)(o,C4);return{data:s,options:{parser:(0,H.Z)({type:"raster",extent:this.sourceTile.bounds},l),transforms:i.transforms}}}},{key:"styleUpdate",value:function(){for(var i=this,o=arguments.length,s=new Array(o),l=0;l<o;l++)s[l]=arguments[l];var f=s,v=f.rampColors,y=v===void 0?I4:v,b=f.domain;this.colorTexture=this.parent.textureService.getColorTexture(y,b||Cc(y)),this.layers.forEach(function(T){return T.style({colorTexture:i.colorTexture})})}},{key:"destroy",value:function(){this.layers.forEach(function(i){return i.destroy()})}}]),t}(xd);function O4(e){var r=D4();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function D4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Xg=function(e){(0,De.Z)(t,e);var r=O4(t);function t(){return(0,q.Z)(this,t),r.apply(this,arguments)}return(0,V.Z)(t,[{key:"initTileLayer",value:function(){var n=(0,Ct.Z)(me().mark(function o(){var s,l,f,v,y;return me().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:if(s=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),f=s4(this.parent.type),v=this.getSourceOption(),v){T.next=8;break}return this.isLoaded=!0,this.emit("loaded"),T.abrupt("return");case 8:return y=new f((0,H.Z)({},l)).source(v.data,v.options),Object.keys(s).forEach(function(M){var O,k,$=M;y[$]((O=s[$])===null||O===void 0?void 0:O.field,(k=s[$])===null||k===void 0?void 0:k.values)}),T.next=12,this.addLayer(y);case 12:if(!l.tileMask){T.next=15;break}return T.next=15,this.addTileMask();case 15:this.setLayerMinMaxZoom(y),this.isLoaded=!0,this.emit("loaded");case 18:case"end":return T.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSourceOption",value:function(){var i=this.parent.getSource(),o=this.parent.getLayerConfig(),s=o.sourceLayer,l=s===void 0?"defaultLayer":s,f=o.featureId,v=f===void 0?"id":f,y=this.getFeatures(l);return{data:{type:"FeatureCollection",features:y},options:{parser:{type:"geojson",featureId:v},transforms:i.transforms}}}},{key:"setLayerMinMaxZoom",value:function(i){i.getModelType()==="text"&&i.updateLayerConfig({maxZoom:this.z+1,minZoom:this.z-1})}},{key:"getFeatures",value:function(i){var o=this.sourceTile.data;return o.getTileData(i)}},{key:"getFeatureById",value:function(i){var o=this.getMainLayer();if(!o)return[];var s=o.getSource().data.dataArray.filter(function(l){return l._id===i});return s}}]),t}(xd);function k4(e){var r=e.type;switch(r){case"PolygonLayer":return Xg;case"LineLayer":return Xg;case"PointLayer":return Xg;case"TileDebugLayer":return p4;case"MaskLayer":return y4;case"RasterLayer":var t=e.getSource().parser.dataType;switch(t){case Eu.RGB:case Eu.CUSTOMRGB:return S4;case Eu.ARRAYBUFFER:case Eu.CUSTOMARRAYBUFFER:return P4;case Eu.TERRAINRGB:case Eu.CUSTOMTERRAINRGB:return w4;default:return m4}default:return Xg}}var F4=["shape","color","size","style","animate","filter","rotate","scale","setBlend","setSelect","setActive","disableMask","enableMask"],B4=ii.debounce,Zb=function(){function e(r){var t=this;(0,q.Z)(this,e),(0,B.Z)(this,"initedTileset",!1),(0,B.Z)(this,"mapchange",function(){var i;if(t.parent.isVisible()!==!1){var o=t.getCurrentView(),s=o.latLonBounds,l=o.zoom;if(t.mapService.version==="GAODE1.x"){var f=t.parent.getLayerConfig(),v=f.visible;l<2&&v?(t.parent.updateLayerConfig({visible:!1}),t.layerService.reRender()):l>=2&&!v&&(t.parent.updateLayerConfig({visible:!0}),t.layerService.reRender())}t.lastViewStates&&t.lastViewStates.zoom===l&&t.lastViewStates.latLonBounds.toString()===s.toString()||(t.lastViewStates={zoom:l,latLonBounds:s},(i=t.tilesetManager)===null||i===void 0||i.throttleUpdate(l,s))}}),(0,B.Z)(this,"viewchange",B4(this.mapchange,24)),this.parent=r;var n=this.parent.getContainer();this.rendererService=n.get(tt.IRendererService),this.layerService=n.get(tt.ILayerService),this.mapService=n.get(tt.IMapService),this.pickingService=n.get(tt.IPickingService),this.tileLayerService=new t4({rendererService:this.rendererService,layerService:this.layerService,parent:r}),this.tilePickService=new o4({tileLayerService:this.tileLayerService,layerService:this.layerService,parent:r}),this.parent.setLayerPickService(this.tilePickService),this.proxy(r),this.initTileSetManager()}return(0,V.Z)(e,[{key:"initTileSetManager",value:function(){var t,n=this.parent.getSource();if(this.tilesetManager=n.tileset,this.initedTileset||(this.bindTilesetEvent(),this.initedTileset=!0),this.parent.isVisible()!==!1){var i=this.getCurrentView(),o=i.latLonBounds,s=i.zoom;(t=this.tilesetManager)===null||t===void 0||t.update(s,o)}}},{key:"getCurrentView",value:function(){var t=this.mapService.getBounds(),n=[t[0][0],t[0][1],t[1][0],t[1][1]],i=this.mapService.getZoom();return{latLonBounds:n,zoom:i}}},{key:"bindTilesetEvent",value:function(){var t=this;this.tilesetManager.on("tile-loaded",function(n){}),this.tilesetManager.on("tile-unload",function(n){t.tileUnLoad(n)}),this.tilesetManager.on("tile-error",function(n,i){t.tileError(n)}),this.tilesetManager.on("tile-update",function(){t.tileUpdate()}),this.mapService.on("zoomend",this.mapchange),this.mapService.on("moveend",this.viewchange)}},{key:"render",value:function(){this.tileLayerService.render()}},{key:"getLayers",value:function(){return this.tileLayerService.getLayers()}},{key:"getTiles",value:function(){return this.tileLayerService.getTiles()}},{key:"getTile",value:function(t){return this.tileLayerService.getTile(t)}},{key:"tileLoaded",value:function(t){}},{key:"tileError",value:function(t){console.warn("error:",t)}},{key:"destroy",value:function(){var t;this.mapService.off("zoomend",this.mapchange),this.mapService.off("moveend",this.viewchange),(t=this.tilesetManager)===null||t===void 0||t.destroy(),this.tileLayerService.destroy()}},{key:"reload",value:function(){var t;this.tilesetManager.clear();var n=this.getCurrentView(),i=n.latLonBounds,o=n.zoom;(t=this.tilesetManager)===null||t===void 0||t.update(o,i)}},{key:"tileUnLoad",value:function(t){this.tileLayerService.removeTile(t.key)}},{key:"tileUpdate",value:function(){var r=(0,Ct.Z)(me().mark(function n(){var i=this,o,s;return me().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(this.tilesetManager){f.next=2;break}return f.abrupt("return");case 2:return o=this.parent.getMinZoom(),s=this.parent.getMaxZoom(),f.next=6,Promise.all(this.tilesetManager.tiles.filter(function(v){return v.isLoaded}).filter(function(v){return v.isVisibleChange}).filter(function(v){return v.data}).filter(function(v){return v.z>=o&&v.z<s}).map(function(){var v=(0,Ct.Z)(me().mark(function y(b){var T,M;return me().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:if(i.tileLayerService.hasTile(b.key)){k.next=9;break}return T=k4(i.parent),M=new T(b,i.parent),k.next=5,M.initTileLayer();case 5:i.tilePickService.setPickState(),M.getLayers().length!==0&&(i.tileLayerService.addTile(M),i.tileLayerService.updateTileVisible(b),i.layerService.reRender()),k.next=12;break;case 9:i.tileLayerService.updateTileVisible(b),i.tilePickService.setPickState(),i.layerService.reRender();case 12:case"end":return k.stop()}},y)}));return function(y){return v.apply(this,arguments)}}()));case 6:this.tilesetManager.isLoaded&&this.parent.emit("tiles-loaded",this.tilesetManager.currentTiles);case 7:case"end":return f.stop()}},n,this)}));function t(){return r.apply(this,arguments)}return t}()},{key:"setPickState",value:function(t){}},{key:"pickRender",value:function(t){this.tilePickService.pickRender(t)}},{key:"selectFeature",value:function(t){this.tilePickService.selectFeature(t)}},{key:"highlightPickedFeature",value:function(t){this.tilePickService.highlightPickedFeature(t)}},{key:"proxy",value:function(t){var n=this;F4.forEach(function(i){var o=t[i].bind(t);t[i]=function(){for(var s=arguments.length,l=new Array(s),f=0;f<s;f++)l[f]=arguments[f];return o.apply(void 0,l),n.getLayers().map(function(v){v[i].apply(v,l)}),i==="style"&&n.getTiles().forEach(function(v){return v.styleUpdate.apply(v,l)}),t}})}}]),e}(),Vb,jb,L4=(Vb=(0,gt.b2)(),Vb(jb=function(){function e(){(0,q.Z)(this,e)}return(0,V.Z)(e,[{key:"build",value:function(){var r=(0,Ct.Z)(me().mark(function n(i){return me().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return i.prepareBuildModel(),s.next=3,i.buildModels();case 3:case"end":return s.stop()}},n)}));function t(n){return r.apply(this,arguments)}return t}()},{key:"initLayerModel",value:function(){var r=(0,Ct.Z)(me().mark(function n(i){return me().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,this.build(i);case 2:i.styleNeedUpdate=!1;case 3:case"end":return s.stop()}},n,this)}));function t(n){return r.apply(this,arguments)}return t}()},{key:"prepareLayerModel",value:function(){var r=(0,Ct.Z)(me().mark(function n(i){return me().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,this.build(i);case 2:i.styleNeedUpdate=!1;case 3:case"end":return s.stop()}},n,this)}));function t(n){return r.apply(this,arguments)}return t}()},{key:"apply",value:function(t){var n=this;t.hooks.init.tapPromise("LayerModelPlugin",(0,Ct.Z)(me().mark(function i(){return me().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(!t.getSource().isTile){s.next=4;break}return t.prepareBuildModel(),t.tileLayer=new Zb(t),s.abrupt("return");case 4:return t.log(Rs.BuildModelStart,ds.INIT),s.next=7,n.initLayerModel(t);case 7:t.log(Rs.BuildModelEnd,ds.INIT);case 8:case"end":return s.stop()}},i)}))),t.hooks.beforeRenderData.tapPromise("LayerModelPlugin",function(){var i=(0,Ct.Z)(me().mark(function o(s){return me().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(s){f.next=2;break}return f.abrupt("return",!1);case 2:if(!t.getSource().isTile){f.next=5;break}return t.tileLayer=new Zb(t),f.abrupt("return",!1);case 5:return t.log(Rs.BuildModelStart,ds.UPDATE),f.next=8,n.prepareLayerModel(t);case 8:return t.log(Rs.BuildModelEnd,ds.UPDATE),f.abrupt("return",!0);case 10:case"end":return f.stop()}},o)}));return function(o){return i.apply(this,arguments)}}())}}]),e}())||jb),Hb,Wb,N4=(Hb=(0,gt.b2)(),Hb(Wb=function(){function e(){(0,q.Z)(this,e)}return(0,V.Z)(e,[{key:"apply",value:function(t){t.hooks.afterInit.tap("LayerStylePlugin",function(){var n=t.getLayerConfig(),i=n.autoFit,o=n.fitBoundsOptions;i&&t.fitBounds(o),t.styleNeedUpdate=!1})}}]),e}())||Wb),Gb,Xb,U4=["type"],$b={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},z4={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},Z4={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},V4={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5};function j4(e){var r={u_DirectionalLights:new Array(3).fill((0,H.Z)({},Z4)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill((0,H.Z)({},V4)),u_NumOfSpotLights:0};return(!e||!e.length)&&(e=[z4]),e.forEach(function(t){var n=t.type,i=n===void 0?"directional":n,o=(0,Fa.Z)(t,U4),s=$b[i].lights,l=$b[i].num,f=r[l];r[s][f]=(0,H.Z)((0,H.Z)({},r[s][f]),o),r[l]++}),r}var H4=(Gb=(0,gt.b2)(),Gb(Xb=function(){function e(){(0,q.Z)(this,e)}return(0,V.Z)(e,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("LightingPlugin",function(){var n=t.getLayerConfig(),i=n.enableLighting;i&&t.models.forEach(function(o){return o.addUniforms((0,H.Z)({},j4()))})})}}]),e}())||Xb),Yb,qb,W4=(Yb=(0,gt.b2)(),Yb(qb=function(){function e(){(0,q.Z)(this,e)}return(0,V.Z)(e,[{key:"apply",value:function(t,n){var i=this,o=n.rendererService,s=n.postProcessingPassFactory,l=n.normalPassFactory;t.hooks.init.tapPromise("MultiPassRendererPlugin",function(){var f=t.getLayerConfig(),v=f.enableMultiPassRenderer,y=f.passes,b=y===void 0?[]:y;i.enabled=!!v&&t.getLayerConfig().enableMultiPassRenderer!==!1,i.enabled&&(t.multiPassRenderer=a1(t,b,s,l),t.multiPassRenderer.setRenderFlag(!0))}),t.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){if(i.enabled){var f=o.getViewportSize(),v=f.width,y=f.height;t.multiPassRenderer.resize(v,y)}})}}]),e}())||qb),Kb,Qb,_v={NONE:0,ENCODE:1,HIGHLIGHT:2},G4=(Kb=(0,gt.b2)(),Kb(Qb=function(){function e(){(0,q.Z)(this,e),(0,B.Z)(this,"PickOption",{u_HighlightColor:[1,0,0,1],u_SelectColor:[1,0,0,1],u_PickingColor:[0,0,0],u_PickingStage:0,u_CurrentSelectedId:[0,0,0],u_PickingThreshold:10,u_PickingBuffer:0,u_shaderPick:0,u_EnableSelect:0,u_activeMix:0})}return(0,V.Z)(e,[{key:"pickOption2Array",value:function(){return Object.values(this.PickOption).flat()}},{key:"updatePickOption",value:function(t,n){var i=this;Object.keys(t).forEach(function(o){i.PickOption[o]=t[o]}),n.uniformBuffers[1].subData({offset:0,data:new Uint8Array(new Float32Array(this.pickOption2Array()))})}},{key:"apply",value:function(t,n){var i=this,o=n.rendererService,s=n.styleAttributeService;if(!o.uniformBuffers[1]){var l=o.createBuffer({data:new Float32Array(this.pickOption2Array().length),isUBO:!0});o.uniformBuffers[1]=l,this.updatePickOption({},o)}t.hooks.init.tapPromise("PixelPickingPlugin",function(){var f=t.getLayerConfig(),v=f.enablePicking;s.registerStyleAttribute({name:"pickingColor",type:fn.Attribute,descriptor:{name:"a_PickingColor",shaderLocation:Ms.PICKING_COLOR,buffer:{data:[],type:R.FLOAT},size:3,update:function(b){var T=b.id;return v?ia(T):[0,0,0]}}})}),t.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var f=t.getLayerConfig(),v=f.enablePicking;v&&t.isVisible()&&(i.updatePickOption({u_PickingStage:_v.ENCODE},o),t.models.forEach(function(y){return y.addUniforms({u_PickingStage:_v.ENCODE})}))}),t.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var f=t.getLayerConfig(),v=f.enablePicking;v&&t.isVisible()&&(i.updatePickOption({u_PickingStage:_v.HIGHLIGHT},o),t.models.forEach(function(y){return y.addUniforms({u_PickingStage:_v.HIGHLIGHT})}))}),t.hooks.beforeHighlight.tap("PixelPickingPlugin",function(f){var v=t.getLayerConfig(),y=v.highlightColor,b=v.activeMix,T=b===void 0?0:b,M=typeof y=="string"?fi(y):y||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:Oa(new Uint8Array(f))});var O={u_PickingStage:_v.HIGHLIGHT,u_PickingColor:f,u_HighlightColor:M.map(function(k){return k*255}),u_activeMix:T};i.updatePickOption(O,o),t.models.forEach(function(k){return k.addUniforms(O)})}),t.hooks.beforeSelect.tap("PixelPickingPlugin",function(f){var v=t.getLayerConfig(),y=v.selectColor,b=v.selectMix,T=b===void 0?0:b,M=typeof y=="string"?fi(y):y||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:Oa(new Uint8Array(f))});var O={u_PickingStage:_v.HIGHLIGHT,u_PickingColor:f,u_HighlightColor:M.map(function(k){return k*255}),u_activeMix:T,u_CurrentSelectedId:f,u_SelectColor:M.map(function(k){return k*255}),u_EnableSelect:1};console.log(O),i.updatePickOption(O,o),t.models.forEach(function(k){return k.addUniforms(O)})})}}]),e}())||Qb),X4=["mvt","geojsonvt","testTile"];function $4(e){var r=e.getSource();return X4.includes(r.parser.type)}function hN(e){return e.getContext?{width:e.width/DOM.DPR,height:e.height/DOM.DPR}:e.getBoundingClientRect()}var Jb,eE,Y4=(Jb=(0,gt.b2)(),Jb(eE=function(){function e(){(0,q.Z)(this,e)}return(0,V.Z)(e,[{key:"apply",value:function(t,n){var i=this,o=n.styleAttributeService;t.hooks.init.tapPromise("RegisterStyleAttributePlugin",function(){$4(t)||i.registerBuiltinAttributes(o,t)})}},{key:"registerBuiltinAttributes",value:function(t,n){if(n.type==="MaskLayer"){this.registerPositionAttribute(t);return}this.registerPositionAttribute(t),this.registerColorAttribute(t),this.registerVertexIdAttribute(t)}},{key:"registerPositionAttribute",value:function(t){t.registerStyleAttribute({name:"position",type:fn.Attribute,descriptor:{name:"a_Position",shaderLocation:Ms.POSITION,buffer:{data:[],type:R.FLOAT},size:3,update:function(i,o,s){return s.length===2?[s[0],s[1],0]:[s[0],s[1],s[2]]}}})}},{key:"registerColorAttribute",value:function(t){t.registerStyleAttribute({name:"color",type:fn.Attribute,descriptor:{name:"a_Color",shaderLocation:Ms.COLOR,buffer:{usage:R.DYNAMIC_DRAW,data:[],type:R.FLOAT},size:4,update:function(i){var o=i.color;return!o||!o.length?[1,1,1,1]:o}}})}},{key:"registerVertexIdAttribute",value:function(t){t.registerStyleAttribute({name:"vertexId",type:fn.Attribute,descriptor:{name:"a_vertexId",shaderLocation:Ms.VERTEX_ID,buffer:{usage:R.DYNAMIC_DRAW,data:[],type:R.FLOAT},size:1,update:function(i,o){return[o]}}})}}]),e}())||eE),tE,rE,nE,iE,aE,oE,sE,bd,uE,lE,cE,fE,hE,q4=(tE=(0,gt.b2)(),rE=(0,gt.f3)(tt.ICameraService),nE=(0,gt.f3)(tt.ICoordinateSystemService),iE=(0,gt.f3)(tt.IRendererService),aE=(0,gt.f3)(tt.IMapService),oE=(0,gt.f3)(tt.ILayerService),tE(sE=(bd=function(){function e(){(0,q.Z)(this,e),Fi(this,"cameraService",uE,this),Fi(this,"coordinateSystemService",lE,this),Fi(this,"rendererService",cE,this),Fi(this,"mapService",fE,this),Fi(this,"layerService",hE,this)}return(0,V.Z)(e,[{key:"apply",value:function(t){var n=this,i=this.mapService.version,o=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],s=[0,0],l;this.rendererService.uniformBuffers[0]||(l=this.rendererService.createBuffer({data:new Float32Array(16*5+4*6+4),isUBO:!0}),this.rendererService.uniformBuffers[0]=l),t.hooks.beforeRender.tap("ShaderUniformPlugin",function(){var f=t.getLayerConfig().tileOrigin;n.coordinateSystemService.refresh(f),i==="GAODE2.x"&&(n.setLayerCenter(t),o=n.mapService.map.customCoords.getMVPMatrix(),s=n.mapService.getCustomCoordCenter());var v=n.rendererService.getViewportSize(),y=v.width,b=v.height,T=n.generateUBO(o,s,y,b),M=T.data,O=T.uniforms;n.layerService.alreadyInRendering&&l&&l.subData({offset:0,data:M}),t.models.forEach(function(k){k.addUniforms((0,H.Z)((0,H.Z)({},O),{},{u_PickingBuffer:t.getLayerConfig().pickingBuffer||0,u_shaderPick:Number(t.getShaderPickStat())}))})})}},{key:"setLayerCenter",value:function(t){t.coordCenter===void 0&&(t.coordCenter=t.getSource().center),this.mapService.setCoordCenter&&this.mapService.setCoordCenter(t.coordCenter)}},{key:"generateUBO",value:function(t,n,i,o){var s,l=this.cameraService.getProjectionMatrix(),f=this.cameraService.getViewMatrix(),v=this.cameraService.getViewProjectionMatrix(),y=this.cameraService.getModelMatrix(),b=this.coordinateSystemService.getViewportCenterProjection(),T=this.coordinateSystemService.getPixelsPerDegree(),M=this.cameraService.getZoom(),O=this.coordinateSystemService.getPixelsPerDegree2(),k=this.cameraService.getZoomScale(),$=this.coordinateSystemService.getPixelsPerMeter(),G=this.coordinateSystemService.getCoordinateSystem(),oe=this.cameraService.getCameraPosition(),ye=window.devicePixelRatio,Le=this.coordinateSystemService.getViewportCenter(),$e=[i,o],ut=this.cameraService.getFocalDistance(),vt=[].concat((0,Wt.Z)(f),(0,Wt.Z)(l),(0,Wt.Z)(v),(0,Wt.Z)(y),(0,Wt.Z)(t),(0,Wt.Z)(b),(0,Wt.Z)(T),[M],(0,Wt.Z)(O),[k],(0,Wt.Z)($),[G],(0,Wt.Z)(oe),[ye],(0,Wt.Z)(Le),$e,(0,Wt.Z)(n),[ut,0]);return{data:vt,uniforms:(s={},(0,B.Z)(s,vd.ProjectionMatrix,l),(0,B.Z)(s,vd.ViewMatrix,f),(0,B.Z)(s,vd.ViewProjectionMatrix,v),(0,B.Z)(s,vd.Zoom,M),(0,B.Z)(s,vd.ZoomScale,k),(0,B.Z)(s,vd.FocalDistance,ut),(0,B.Z)(s,vd.CameraPosition,oe),(0,B.Z)(s,Kf.CoordinateSystem,G),(0,B.Z)(s,Kf.ViewportCenter,Le),(0,B.Z)(s,Kf.ViewportCenterProjection,b),(0,B.Z)(s,Kf.PixelsPerDegree,T),(0,B.Z)(s,Kf.PixelsPerDegree2,O),(0,B.Z)(s,Kf.PixelsPerMeter,$),(0,B.Z)(s,Kf.Mvp,t),(0,B.Z)(s,"u_sceneCenterMercator",n),(0,B.Z)(s,"u_ViewportSize",$e),(0,B.Z)(s,"u_ModelMatrix",y),(0,B.Z)(s,"u_DevicePixelRatio",ye),s)}}}]),e}(),uE=Oi(bd.prototype,"cameraService",[rE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lE=Oi(bd.prototype,"coordinateSystemService",[nE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cE=Oi(bd.prototype,"rendererService",[iE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fE=Oi(bd.prototype,"mapService",[aE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hE=Oi(bd.prototype,"layerService",[oE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bd))||sE),pE,dE,K4=(pE=(0,gt.b2)(),pE(dE=function(){function e(){(0,q.Z)(this,e)}return(0,V.Z)(e,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("UpdateModelPlugin",function(){t.layerModel&&t.layerModel.needUpdate().then(function(n){n&&t.renderLayers()})}),t.hooks.afterRender.tap("UpdateModelPlugin",function(){t.layerModelNeedUpdate=!1})}}]),e}())||dE),vE,mE,Q4=(vE=(0,gt.b2)(),vE(mE=function(){function e(){(0,q.Z)(this,e)}return(0,V.Z)(e,[{key:"apply",value:function(t,n){var i=this,o=n.styleAttributeService;t.hooks.init.tapPromise("UpdateStyleAttributePlugin",function(){i.initStyleAttribute(t,{styleAttributeService:o})}),t.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){t.layerModelNeedUpdate||t.inited&&i.updateStyleAttribute(t,{styleAttributeService:o})})}},{key:"updateStyleAttribute",value:function(t,n){var i=n.styleAttributeService,o=i.getLayerStyleAttributes()||[],s=i.getLayerStyleAttribute("filter");if(s&&s.needRegenerateVertices){t.layerModelNeedUpdate=!0,o.forEach(function(l){return l.needRegenerateVertices=!1});return}o.filter(function(l){return l.needRegenerateVertices}).forEach(function(l){i.updateAttributeByFeatureRange(l.name,t.getEncodedData(),l.featureRange.startIndex,l.featureRange.endIndex,t),l.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(t,n){var i=n.styleAttributeService,o=i.getLayerStyleAttributes()||[];o.filter(function(s){return s.needRegenerateVertices}).forEach(function(s){i.updateAttributeByFeatureRange(s.name,t.getEncodedData(),s.featureRange.startIndex,s.featureRange.endIndex),s.needRegenerateVertices=!1})}}]),e}())||mE);jl.bind(tt.ILayerPlugin).to(CI).inRequestScope(),jl.bind(tt.ILayerPlugin).to(Y4).inRequestScope(),jl.bind(tt.ILayerPlugin).to(Q5).inRequestScope(),jl.bind(tt.ILayerPlugin).to(wI).inRequestScope(),jl.bind(tt.ILayerPlugin).to(N4).inRequestScope(),jl.bind(tt.ILayerPlugin).to(e4).inRequestScope(),jl.bind(tt.ILayerPlugin).to(Q4).inRequestScope(),jl.bind(tt.ILayerPlugin).to(K4).inRequestScope(),jl.bind(tt.ILayerPlugin).to(W4).inRequestScope(),jl.bind(tt.ILayerPlugin).to(q4).inRequestScope(),jl.bind(tt.ILayerPlugin).to(J5).inRequestScope(),jl.bind(tt.ILayerPlugin).to(H4).inRequestScope(),jl.bind(tt.ILayerPlugin).to(G4).inRequestScope(),jl.bind(tt.ILayerPlugin).to(L4).inRequestScope();var J4=L(79801),eO=L.n(J4),tO=function(){function e(r,t){(0,q.Z)(this,e);var n=t.buffer,i=t.offset,o=t.stride,s=t.normalized,l=t.size,f=t.divisor;this.buffer=n,this.attribute={buffer:n.get(),offset:i||0,stride:o||0,normalized:s||!1,divisor:f||0},l&&(this.attribute.size=l)}return(0,V.Z)(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(t){this.buffer.subData(t)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),Gh,Cm,kp,Kc,Rm,Fp,Mm,$g,sh,Ed,Au,uh,lh,Yg,rO=(Gh={},(0,B.Z)(Gh,R.POINTS,"points"),(0,B.Z)(Gh,R.LINES,"lines"),(0,B.Z)(Gh,R.LINE_LOOP,"line loop"),(0,B.Z)(Gh,R.LINE_STRIP,"line strip"),(0,B.Z)(Gh,R.TRIANGLES,"triangles"),(0,B.Z)(Gh,R.TRIANGLE_FAN,"triangle fan"),(0,B.Z)(Gh,R.TRIANGLE_STRIP,"triangle strip"),Gh),gE=(Cm={},(0,B.Z)(Cm,R.STATIC_DRAW,"static"),(0,B.Z)(Cm,R.DYNAMIC_DRAW,"dynamic"),(0,B.Z)(Cm,R.STREAM_DRAW,"stream"),Cm),S_=(kp={},(0,B.Z)(kp,R.BYTE,"int8"),(0,B.Z)(kp,R.INT,"int32"),(0,B.Z)(kp,R.UNSIGNED_BYTE,"uint8"),(0,B.Z)(kp,R.UNSIGNED_SHORT,"uint16"),(0,B.Z)(kp,R.UNSIGNED_INT,"uint32"),(0,B.Z)(kp,R.FLOAT,"float"),kp),nO=(Kc={},(0,B.Z)(Kc,R.ALPHA,"alpha"),(0,B.Z)(Kc,R.LUMINANCE,"luminance"),(0,B.Z)(Kc,R.LUMINANCE_ALPHA,"luminance alpha"),(0,B.Z)(Kc,R.RGB,"rgb"),(0,B.Z)(Kc,R.RGBA,"rgba"),(0,B.Z)(Kc,R.RGBA4,"rgba4"),(0,B.Z)(Kc,R.RGB5_A1,"rgb5 a1"),(0,B.Z)(Kc,R.RGB565,"rgb565"),(0,B.Z)(Kc,R.DEPTH_COMPONENT,"depth"),(0,B.Z)(Kc,R.DEPTH_STENCIL,"depth stencil"),Kc),iO=(Rm={},(0,B.Z)(Rm,R.DONT_CARE,"dont care"),(0,B.Z)(Rm,R.NICEST,"nice"),(0,B.Z)(Rm,R.FASTEST,"fast"),Rm),_E=(Fp={},(0,B.Z)(Fp,R.NEAREST,"nearest"),(0,B.Z)(Fp,R.LINEAR,"linear"),(0,B.Z)(Fp,R.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,B.Z)(Fp,R.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,B.Z)(Fp,R.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,B.Z)(Fp,R.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),Fp),yE=(Mm={},(0,B.Z)(Mm,R.REPEAT,"repeat"),(0,B.Z)(Mm,R.CLAMP_TO_EDGE,"clamp"),(0,B.Z)(Mm,R.MIRRORED_REPEAT,"mirror"),Mm),aO=($g={},(0,B.Z)($g,R.NONE,"none"),(0,B.Z)($g,R.BROWSER_DEFAULT_WEBGL,"browser"),$g),oO=(sh={},(0,B.Z)(sh,R.NEVER,"never"),(0,B.Z)(sh,R.ALWAYS,"always"),(0,B.Z)(sh,R.LESS,"less"),(0,B.Z)(sh,R.LEQUAL,"lequal"),(0,B.Z)(sh,R.GREATER,"greater"),(0,B.Z)(sh,R.GEQUAL,"gequal"),(0,B.Z)(sh,R.EQUAL,"equal"),(0,B.Z)(sh,R.NOTEQUAL,"notequal"),sh),xE=(Ed={},(0,B.Z)(Ed,R.FUNC_ADD,"add"),(0,B.Z)(Ed,R.MIN_EXT,"min"),(0,B.Z)(Ed,R.MAX_EXT,"max"),(0,B.Z)(Ed,R.FUNC_SUBTRACT,"subtract"),(0,B.Z)(Ed,R.FUNC_REVERSE_SUBTRACT,"reverse subtract"),Ed),qg=(Au={},(0,B.Z)(Au,R.ZERO,"zero"),(0,B.Z)(Au,R.ONE,"one"),(0,B.Z)(Au,R.SRC_COLOR,"src color"),(0,B.Z)(Au,R.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,B.Z)(Au,R.SRC_ALPHA,"src alpha"),(0,B.Z)(Au,R.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,B.Z)(Au,R.DST_COLOR,"dst color"),(0,B.Z)(Au,R.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,B.Z)(Au,R.DST_ALPHA,"dst alpha"),(0,B.Z)(Au,R.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,B.Z)(Au,R.CONSTANT_COLOR,"constant color"),(0,B.Z)(Au,R.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,B.Z)(Au,R.CONSTANT_ALPHA,"constant alpha"),(0,B.Z)(Au,R.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,B.Z)(Au,R.SRC_ALPHA_SATURATE,"src alpha saturate"),Au),sO=(uh={},(0,B.Z)(uh,R.NEVER,"never"),(0,B.Z)(uh,R.ALWAYS,"always"),(0,B.Z)(uh,R.LESS,"less"),(0,B.Z)(uh,R.LEQUAL,"lequal"),(0,B.Z)(uh,R.GREATER,"greater"),(0,B.Z)(uh,R.GEQUAL,"gequal"),(0,B.Z)(uh,R.EQUAL,"equal"),(0,B.Z)(uh,R.NOTEQUAL,"notequal"),uh),yv=(lh={},(0,B.Z)(lh,R.ZERO,"zero"),(0,B.Z)(lh,R.KEEP,"keep"),(0,B.Z)(lh,R.REPLACE,"replace"),(0,B.Z)(lh,R.INVERT,"invert"),(0,B.Z)(lh,R.INCR,"increment"),(0,B.Z)(lh,R.DECR,"decrement"),(0,B.Z)(lh,R.INCR_WRAP,"increment wrap"),(0,B.Z)(lh,R.DECR_WRAP,"decrement wrap"),lh),uO=(Yg={},(0,B.Z)(Yg,R.FRONT,"front"),(0,B.Z)(Yg,R.BACK,"back"),Yg),lO=function(){function e(r,t){(0,q.Z)(this,e),(0,B.Z)(this,"isDestroyed",!1);var n=t.data,i=t.usage,o=t.type;this.buffer=r.buffer({data:n,usage:gE[i||R.STATIC_DRAW],type:S_[o||R.UNSIGNED_BYTE]})}return(0,V.Z)(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.isDestroyed||this.buffer.destroy(),this.isDestroyed=!0}},{key:"subData",value:function(t){var n=t.data,i=t.offset;this.buffer.subdata(n,i)}}]),e}(),cO=function(){function e(r,t){(0,q.Z)(this,e);var n=t.data,i=t.usage,o=t.type,s=t.count;this.elements=r.elements({data:n,usage:gE[i||R.STATIC_DRAW],type:S_[o||R.UNSIGNED_BYTE],count:s})}return(0,V.Z)(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(t){var n=t.data;this.elements.subdata(n)}},{key:"destroy",value:function(){}}]),e}(),fO=function(){function e(r,t){(0,q.Z)(this,e);var n=t.width,i=t.height,o=t.color,s=t.colors,l={width:n,height:i};Array.isArray(s)&&(l.colors=s.map(function(f){return f.get()})),o&&typeof o!="boolean"&&(l.color=o.get()),this.framebuffer=r.framebuffer(l)}return(0,V.Z)(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(t){var n=t.width,i=t.height;this.framebuffer.resize(n,i)}}]),e}(),xv=L(39696),Bp=L(58622),hO=L(39083),wn=L(99938),bE=L(73983),je;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",e[e.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.CULL_FACE=2884]="CULL_FACE",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.BLEND=3042]="BLEND",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.DITHER=3024]="DITHER",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DOUBLE=5130]="DOUBLE",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.ALWAYS=519]="ALWAYS",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.GEQUAL=518]="GEQUAL",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",e[e.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",e[e.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.READ_BUFFER=3074]="READ_BUFFER",e[e.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",e[e.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",e[e.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",e[e.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",e[e.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",e[e.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",e[e.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",e[e.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",e[e.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",e[e.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",e[e.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",e[e.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",e[e.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",e[e.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",e[e.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",e[e.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",e[e.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",e[e.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",e[e.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",e[e.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",e[e.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",e[e.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",e[e.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",e[e.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",e[e.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",e[e.RED=6403]="RED",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.RGB10_A2=32857]="RGB10_A2",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",e[e.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",e[e.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",e[e.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",e[e.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",e[e.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",e[e.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",e[e.SRGB=35904]="SRGB",e[e.SRGB8=35905]="SRGB8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",e[e.RGBA32F=34836]="RGBA32F",e[e.RGB32F=34837]="RGB32F",e[e.RGBA16F=34842]="RGBA16F",e[e.RGB16F=34843]="RGB16F",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",e[e.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGB32UI=36209]="RGB32UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGB16UI=36215]="RGB16UI",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA32I=36226]="RGBA32I",e[e.RGB32I=36227]="RGB32I",e[e.RGBA16I=36232]="RGBA16I",e[e.RGB16I=36233]="RGB16I",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB8I=36239]="RGB8I",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER",e[e.R8=33321]="R8",e[e.RG8=33323]="RG8",e[e.R16F=33325]="R16F",e[e.R32F=33326]="R32F",e[e.RG16F=33327]="RG16F",e[e.RG32F=33328]="RG32F",e[e.R8I=33329]="R8I",e[e.R8UI=33330]="R8UI",e[e.R16I=33331]="R16I",e[e.R16UI=33332]="R16UI",e[e.R32I=33333]="R32I",e[e.R32UI=33334]="R32UI",e[e.RG8I=33335]="RG8I",e[e.RG8UI=33336]="RG8UI",e[e.RG16I=33337]="RG16I",e[e.RG16UI=33338]="RG16UI",e[e.RG32I=33339]="RG32I",e[e.RG32UI=33340]="RG32UI",e[e.R8_SNORM=36756]="R8_SNORM",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGB10_A2UI=36975]="RGB10_A2UI",e[e.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",e[e.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.RG=33319]="RG",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",e[e.CURRENT_QUERY=34917]="CURRENT_QUERY",e[e.QUERY_RESULT=34918]="QUERY_RESULT",e[e.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",e[e.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",e[e.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",e[e.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",e[e.DRAW_BUFFER0=34853]="DRAW_BUFFER0",e[e.DRAW_BUFFER1=34854]="DRAW_BUFFER1",e[e.DRAW_BUFFER2=34855]="DRAW_BUFFER2",e[e.DRAW_BUFFER3=34856]="DRAW_BUFFER3",e[e.DRAW_BUFFER4=34857]="DRAW_BUFFER4",e[e.DRAW_BUFFER5=34858]="DRAW_BUFFER5",e[e.DRAW_BUFFER6=34859]="DRAW_BUFFER6",e[e.DRAW_BUFFER7=34860]="DRAW_BUFFER7",e[e.DRAW_BUFFER8=34861]="DRAW_BUFFER8",e[e.DRAW_BUFFER9=34862]="DRAW_BUFFER9",e[e.DRAW_BUFFER10=34863]="DRAW_BUFFER10",e[e.DRAW_BUFFER11=34864]="DRAW_BUFFER11",e[e.DRAW_BUFFER12=34865]="DRAW_BUFFER12",e[e.DRAW_BUFFER13=34866]="DRAW_BUFFER13",e[e.DRAW_BUFFER14=34867]="DRAW_BUFFER14",e[e.DRAW_BUFFER15=34868]="DRAW_BUFFER15",e[e.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",e[e.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",e[e.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",e[e.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",e[e.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",e[e.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",e[e.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",e[e.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",e[e.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",e[e.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",e[e.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",e[e.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",e[e.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",e[e.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",e[e.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",e[e.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",e[e.SAMPLER_3D=35679]="SAMPLER_3D",e[e.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",e[e.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",e[e.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",e[e.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",e[e.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",e[e.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",e[e.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",e[e.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",e[e.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",e[e.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",e[e.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",e[e.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",e[e.MAX_SAMPLES=36183]="MAX_SAMPLES",e[e.SAMPLER_BINDING=35097]="SAMPLER_BINDING",e[e.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",e[e.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",e[e.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",e[e.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",e[e.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",e[e.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",e[e.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",e[e.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",e[e.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",e[e.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",e[e.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",e[e.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",e[e.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",e[e.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",e[e.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",e[e.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",e[e.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",e[e.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",e[e.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",e[e.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",e[e.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",e[e.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",e[e.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",e[e.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",e[e.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",e[e.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",e[e.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",e[e.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",e[e.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",e[e.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",e[e.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",e[e.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",e[e.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",e[e.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",e[e.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",e[e.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",e[e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e[e.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",e[e.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",e[e.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",e[e.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",e[e.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",e[e.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",e[e.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",e[e.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",e[e.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",e[e.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",e[e.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",e[e.UNIFORM_TYPE=35383]="UNIFORM_TYPE",e[e.UNIFORM_SIZE=35384]="UNIFORM_SIZE",e[e.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",e[e.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",e[e.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",e[e.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",e[e.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",e[e.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",e[e.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",e[e.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",e[e.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",e[e.OBJECT_TYPE=37138]="OBJECT_TYPE",e[e.SYNC_CONDITION=37139]="SYNC_CONDITION",e[e.SYNC_STATUS=37140]="SYNC_STATUS",e[e.SYNC_FLAGS=37141]="SYNC_FLAGS",e[e.SYNC_FENCE=37142]="SYNC_FENCE",e[e.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",e[e.UNSIGNALED=37144]="UNSIGNALED",e[e.SIGNALED=37145]="SIGNALED",e[e.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",e[e.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",e[e.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",e[e.WAIT_FAILED=37149]="WAIT_FAILED",e[e.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",e[e.COLOR=6144]="COLOR",e[e.DEPTH=6145]="DEPTH",e[e.STENCIL=6146]="STENCIL",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STREAM_COPY=35042]="STREAM_COPY",e[e.STATIC_READ=35045]="STATIC_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",e[e.INVALID_INDEX=4294967295]="INVALID_INDEX",e[e.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",e[e.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",e[e.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE",e[e.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",e[e.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",e[e.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",e[e.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",e[e.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",e[e.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",e[e.UNSIGNED_INT_24_8_WEBGL=34042]="UNSIGNED_INT_24_8_WEBGL",e[e.HALF_FLOAT_OES=36193]="HALF_FLOAT_OES",e[e.RGBA32F_EXT=34836]="RGBA32F_EXT",e[e.RGB32F_EXT=34837]="RGB32F_EXT",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT",e[e.UNSIGNED_NORMALIZED_EXT=35863]="UNSIGNED_NORMALIZED_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.SRGB_EXT=35904]="SRGB_EXT",e[e.SRGB_ALPHA_EXT=35906]="SRGB_ALPHA_EXT",e[e.SRGB8_ALPHA8_EXT=35907]="SRGB8_ALPHA8_EXT",e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT",e[e.FRAGMENT_SHADER_DERIVATIVE_HINT_OES=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT_OES",e[e.COLOR_ATTACHMENT0_WEBGL=36064]="COLOR_ATTACHMENT0_WEBGL",e[e.COLOR_ATTACHMENT1_WEBGL=36065]="COLOR_ATTACHMENT1_WEBGL",e[e.COLOR_ATTACHMENT2_WEBGL=36066]="COLOR_ATTACHMENT2_WEBGL",e[e.COLOR_ATTACHMENT3_WEBGL=36067]="COLOR_ATTACHMENT3_WEBGL",e[e.COLOR_ATTACHMENT4_WEBGL=36068]="COLOR_ATTACHMENT4_WEBGL",e[e.COLOR_ATTACHMENT5_WEBGL=36069]="COLOR_ATTACHMENT5_WEBGL",e[e.COLOR_ATTACHMENT6_WEBGL=36070]="COLOR_ATTACHMENT6_WEBGL",e[e.COLOR_ATTACHMENT7_WEBGL=36071]="COLOR_ATTACHMENT7_WEBGL",e[e.COLOR_ATTACHMENT8_WEBGL=36072]="COLOR_ATTACHMENT8_WEBGL",e[e.COLOR_ATTACHMENT9_WEBGL=36073]="COLOR_ATTACHMENT9_WEBGL",e[e.COLOR_ATTACHMENT10_WEBGL=36074]="COLOR_ATTACHMENT10_WEBGL",e[e.COLOR_ATTACHMENT11_WEBGL=36075]="COLOR_ATTACHMENT11_WEBGL",e[e.COLOR_ATTACHMENT12_WEBGL=36076]="COLOR_ATTACHMENT12_WEBGL",e[e.COLOR_ATTACHMENT13_WEBGL=36077]="COLOR_ATTACHMENT13_WEBGL",e[e.COLOR_ATTACHMENT14_WEBGL=36078]="COLOR_ATTACHMENT14_WEBGL",e[e.COLOR_ATTACHMENT15_WEBGL=36079]="COLOR_ATTACHMENT15_WEBGL",e[e.DRAW_BUFFER0_WEBGL=34853]="DRAW_BUFFER0_WEBGL",e[e.DRAW_BUFFER1_WEBGL=34854]="DRAW_BUFFER1_WEBGL",e[e.DRAW_BUFFER2_WEBGL=34855]="DRAW_BUFFER2_WEBGL",e[e.DRAW_BUFFER3_WEBGL=34856]="DRAW_BUFFER3_WEBGL",e[e.DRAW_BUFFER4_WEBGL=34857]="DRAW_BUFFER4_WEBGL",e[e.DRAW_BUFFER5_WEBGL=34858]="DRAW_BUFFER5_WEBGL",e[e.DRAW_BUFFER6_WEBGL=34859]="DRAW_BUFFER6_WEBGL",e[e.DRAW_BUFFER7_WEBGL=34860]="DRAW_BUFFER7_WEBGL",e[e.DRAW_BUFFER8_WEBGL=34861]="DRAW_BUFFER8_WEBGL",e[e.DRAW_BUFFER9_WEBGL=34862]="DRAW_BUFFER9_WEBGL",e[e.DRAW_BUFFER10_WEBGL=34863]="DRAW_BUFFER10_WEBGL",e[e.DRAW_BUFFER11_WEBGL=34864]="DRAW_BUFFER11_WEBGL",e[e.DRAW_BUFFER12_WEBGL=34865]="DRAW_BUFFER12_WEBGL",e[e.DRAW_BUFFER13_WEBGL=34866]="DRAW_BUFFER13_WEBGL",e[e.DRAW_BUFFER14_WEBGL=34867]="DRAW_BUFFER14_WEBGL",e[e.DRAW_BUFFER15_WEBGL=34868]="DRAW_BUFFER15_WEBGL",e[e.MAX_COLOR_ATTACHMENTS_WEBGL=36063]="MAX_COLOR_ATTACHMENTS_WEBGL",e[e.MAX_DRAW_BUFFERS_WEBGL=34852]="MAX_DRAW_BUFFERS_WEBGL",e[e.VERTEX_ARRAY_BINDING_OES=34229]="VERTEX_ARRAY_BINDING_OES",e[e.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",e[e.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",e[e.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",e[e.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",e[e.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",e[e.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",e[e.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT"})(je||(je={}));var ya;(function(e){e[e.Buffer=0]="Buffer",e[e.Texture=1]="Texture",e[e.RenderTarget=2]="RenderTarget",e[e.Sampler=3]="Sampler",e[e.Program=4]="Program",e[e.Bindings=5]="Bindings",e[e.InputLayout=6]="InputLayout",e[e.RenderPipeline=7]="RenderPipeline",e[e.ComputePipeline=8]="ComputePipeline",e[e.Readback=9]="Readback",e[e.QueryPool=10]="QueryPool"})(ya||(ya={}));var _a;(function(e){e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS"})(_a||(_a={}));var Im;(function(e){e[e.CCW=2305]="CCW",e[e.CW=2304]="CW"})(Im||(Im={}));var Wl;(function(e){e[e.NONE=0]="NONE",e[e.FRONT=1]="FRONT",e[e.BACK=2]="BACK",e[e.FRONT_AND_BACK=3]="FRONT_AND_BACK"})(Wl||(Wl={}));var ua;(function(e){e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC=768]="SRC",e[e.ONE_MINUS_SRC=769]="ONE_MINUS_SRC",e[e.DST=774]="DST",e[e.ONE_MINUS_DST=775]="ONE_MINUS_DST",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.CONST=32769]="CONST",e[e.ONE_MINUS_CONSTANT=32770]="ONE_MINUS_CONSTANT",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE"})(ua||(ua={}));var Tu;(function(e){e[e.ADD=32774]="ADD",e[e.SUBSTRACT=32778]="SUBSTRACT",e[e.REVERSE_SUBSTRACT=32779]="REVERSE_SUBSTRACT",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX"})(Tu||(Tu={}));var gl;(function(e){e[e.CLAMP_TO_EDGE=0]="CLAMP_TO_EDGE",e[e.REPEAT=1]="REPEAT",e[e.MIRRORED_REPEAT=2]="MIRRORED_REPEAT"})(gl||(gl={}));var vs;(function(e){e[e.POINT=0]="POINT",e[e.BILINEAR=1]="BILINEAR"})(vs||(vs={}));var Gs;(function(e){e[e.NO_MIP=0]="NO_MIP",e[e.NEAREST=1]="NEAREST",e[e.LINEAR=2]="LINEAR"})(Gs||(Gs={}));var ms;(function(e){e[e.POINTS=0]="POINTS",e[e.TRIANGLES=1]="TRIANGLES",e[e.TRIANGLE_STRIP=2]="TRIANGLE_STRIP",e[e.LINES=3]="LINES",e[e.LINE_STRIP=4]="LINE_STRIP"})(ms||(ms={}));var ro;(function(e){e[e.MAP_READ=1]="MAP_READ",e[e.MAP_WRITE=2]="MAP_WRITE",e[e.COPY_SRC=4]="COPY_SRC",e[e.COPY_DST=8]="COPY_DST",e[e.INDEX=16]="INDEX",e[e.VERTEX=32]="VERTEX",e[e.UNIFORM=64]="UNIFORM",e[e.STORAGE=128]="STORAGE",e[e.INDIRECT=256]="INDIRECT",e[e.QUERY_RESOLVE=512]="QUERY_RESOLVE"})(ro||(ro={}));var Af;(function(e){e[e.STATIC=1]="STATIC",e[e.DYNAMIC=2]="DYNAMIC"})(Af||(Af={}));var Sd;(function(e){e[e.VERTEX=1]="VERTEX",e[e.INSTANCE=2]="INSTANCE"})(Sd||(Sd={}));var EE;(function(e){e.LOADED="loaded"})(EE||(EE={}));var Hi;(function(e){e[e.TEXTURE_2D=0]="TEXTURE_2D",e[e.TEXTURE_2D_ARRAY=1]="TEXTURE_2D_ARRAY",e[e.TEXTURE_3D=2]="TEXTURE_3D",e[e.TEXTURE_CUBE_MAP=3]="TEXTURE_CUBE_MAP"})(Hi||(Hi={}));var Ec;(function(e){e[e.SAMPLED=1]="SAMPLED",e[e.RENDER_TARGET=2]="RENDER_TARGET"})(Ec||(Ec={}));var wu;(function(e){e[e.NONE=0]="NONE",e[e.RED=1]="RED",e[e.GREEN=2]="GREEN",e[e.BLUE=4]="BLUE",e[e.ALPHA=8]="ALPHA",e[e.RGB=7]="RGB",e[e.ALL=15]="ALL"})(wu||(wu={}));var qu;(function(e){e[e.KEEP=7680]="KEEP",e[e.ZERO=0]="ZERO",e[e.REPLACE=7681]="REPLACE",e[e.INVERT=5386]="INVERT",e[e.INCREMENT_CLAMP=7682]="INCREMENT_CLAMP",e[e.DECREMENT_CLAMP=7683]="DECREMENT_CLAMP",e[e.INCREMENT_WRAP=34055]="INCREMENT_WRAP",e[e.DECREMENT_WRAP=34056]="DECREMENT_WRAP"})(qu||(qu={}));function pN(e,r,t,n){var i=Hi.TEXTURE_2D,o=1,s=Ec.SAMPLED;return{dimension:i,format:e,width:r,height:t,depthOrArrayLayers:o,mipLevelCount:n,usage:s}}var zo;(function(e){e[e.Float=0]="Float",e[e.Uint=1]="Uint",e[e.Sint=2]="Sint",e[e.Depth=3]="Depth"})(zo||(zo={}));var bv;(function(e){e[e.LOWER_LEFT=0]="LOWER_LEFT",e[e.UPPER_LEFT=1]="UPPER_LEFT"})(bv||(bv={}));var Ev;(function(e){e[e.NEGATIVE_ONE=0]="NEGATIVE_ONE",e[e.ZERO=1]="ZERO"})(Ev||(Ev={}));var Kg;(function(e){e[e.OcclusionConservative=0]="OcclusionConservative"})(Kg||(Kg={}));var Cr;(function(e){e[e.U8=1]="U8",e[e.U16=2]="U16",e[e.U32=3]="U32",e[e.S8=4]="S8",e[e.S16=5]="S16",e[e.S32=6]="S32",e[e.F16=7]="F16",e[e.F32=8]="F32",e[e.BC1=65]="BC1",e[e.BC2=66]="BC2",e[e.BC3=67]="BC3",e[e.BC4_UNORM=68]="BC4_UNORM",e[e.BC4_SNORM=69]="BC4_SNORM",e[e.BC5_UNORM=70]="BC5_UNORM",e[e.BC5_SNORM=71]="BC5_SNORM",e[e.U16_PACKED_5551=97]="U16_PACKED_5551",e[e.U16_PACKED_565=98]="U16_PACKED_565",e[e.D24=129]="D24",e[e.D32F=130]="D32F",e[e.D24S8=131]="D24S8",e[e.D32FS8=132]="D32FS8"})(Cr||(Cr={}));var Hn;(function(e){e[e.R=1]="R",e[e.RG=2]="RG",e[e.RGB=3]="RGB",e[e.RGBA=4]="RGBA",e[e.A=5]="A"})(Hn||(Hn={}));function dN(e){return e}var An;(function(e){e[e.None=0]="None",e[e.Normalized=1]="Normalized",e[e.sRGB=2]="sRGB",e[e.Depth=4]="Depth",e[e.Stencil=8]="Stencil",e[e.RenderTarget=16]="RenderTarget"})(An||(An={}));function li(e,r,t){return e<<16|r<<8|t}var Tt;(function(e){e[e.ALPHA=li(Cr.U8,Hn.A,An.None)]="ALPHA",e[e.U8_LUMINANCE=li(Cr.U8,Hn.A,An.None)]="U8_LUMINANCE",e[e.F16_LUMINANCE=li(Cr.F16,Hn.A,An.None)]="F16_LUMINANCE",e[e.F32_LUMINANCE=li(Cr.F32,Hn.A,An.None)]="F32_LUMINANCE",e[e.F16_R=li(Cr.F16,Hn.R,An.None)]="F16_R",e[e.F16_RG=li(Cr.F16,Hn.RG,An.None)]="F16_RG",e[e.F16_RGB=li(Cr.F16,Hn.RGB,An.None)]="F16_RGB",e[e.F16_RGBA=li(Cr.F16,Hn.RGBA,An.None)]="F16_RGBA",e[e.F32_R=li(Cr.F32,Hn.R,An.None)]="F32_R",e[e.F32_RG=li(Cr.F32,Hn.RG,An.None)]="F32_RG",e[e.F32_RGB=li(Cr.F32,Hn.RGB,An.None)]="F32_RGB",e[e.F32_RGBA=li(Cr.F32,Hn.RGBA,An.None)]="F32_RGBA",e[e.U8_R=li(Cr.U8,Hn.R,An.None)]="U8_R",e[e.U8_R_NORM=li(Cr.U8,Hn.R,An.Normalized)]="U8_R_NORM",e[e.U8_RG=li(Cr.U8,Hn.RG,An.None)]="U8_RG",e[e.U8_RG_NORM=li(Cr.U8,Hn.RG,An.Normalized)]="U8_RG_NORM",e[e.U8_RGB=li(Cr.U8,Hn.RGB,An.None)]="U8_RGB",e[e.U8_RGB_NORM=li(Cr.U8,Hn.RGB,An.Normalized)]="U8_RGB_NORM",e[e.U8_RGB_SRGB=li(Cr.U8,Hn.RGB,An.sRGB|An.Normalized)]="U8_RGB_SRGB",e[e.U8_RGBA=li(Cr.U8,Hn.RGBA,An.None)]="U8_RGBA",e[e.U8_RGBA_NORM=li(Cr.U8,Hn.RGBA,An.Normalized)]="U8_RGBA_NORM",e[e.U8_RGBA_SRGB=li(Cr.U8,Hn.RGBA,An.sRGB|An.Normalized)]="U8_RGBA_SRGB",e[e.U16_R=li(Cr.U16,Hn.R,An.None)]="U16_R",e[e.U16_R_NORM=li(Cr.U16,Hn.R,An.Normalized)]="U16_R_NORM",e[e.U16_RG_NORM=li(Cr.U16,Hn.RG,An.Normalized)]="U16_RG_NORM",e[e.U16_RGBA_NORM=li(Cr.U16,Hn.RGBA,An.Normalized)]="U16_RGBA_NORM",e[e.U16_RGB=li(Cr.U16,Hn.RGB,An.None)]="U16_RGB",e[e.U32_R=li(Cr.U32,Hn.R,An.None)]="U32_R",e[e.U32_RG=li(Cr.U32,Hn.RG,An.None)]="U32_RG",e[e.S8_R=li(Cr.S8,Hn.R,An.None)]="S8_R",e[e.S8_R_NORM=li(Cr.S8,Hn.R,An.Normalized)]="S8_R_NORM",e[e.S8_RG_NORM=li(Cr.S8,Hn.RG,An.Normalized)]="S8_RG_NORM",e[e.S8_RGB_NORM=li(Cr.S8,Hn.RGB,An.Normalized)]="S8_RGB_NORM",e[e.S8_RGBA_NORM=li(Cr.S8,Hn.RGBA,An.Normalized)]="S8_RGBA_NORM",e[e.S16_R=li(Cr.S16,Hn.R,An.None)]="S16_R",e[e.S16_RG=li(Cr.S16,Hn.RG,An.None)]="S16_RG",e[e.S16_RG_NORM=li(Cr.S16,Hn.RG,An.Normalized)]="S16_RG_NORM",e[e.S16_RGB_NORM=li(Cr.S16,Hn.RGB,An.Normalized)]="S16_RGB_NORM",e[e.S16_RGBA=li(Cr.S16,Hn.RGBA,An.None)]="S16_RGBA",e[e.S16_RGBA_NORM=li(Cr.S16,Hn.RGBA,An.Normalized)]="S16_RGBA_NORM",e[e.S32_R=li(Cr.S32,Hn.R,An.None)]="S32_R",e[e.U16_RGBA_5551=li(Cr.U16_PACKED_5551,Hn.RGBA,An.Normalized)]="U16_RGBA_5551",e[e.U16_RGB_565=li(Cr.U16_PACKED_565,Hn.RGB,An.Normalized)]="U16_RGB_565",e[e.BC1=li(Cr.BC1,Hn.RGBA,An.Normalized)]="BC1",e[e.BC1_SRGB=li(Cr.BC1,Hn.RGBA,An.Normalized|An.sRGB)]="BC1_SRGB",e[e.BC2=li(Cr.BC2,Hn.RGBA,An.Normalized)]="BC2",e[e.BC2_SRGB=li(Cr.BC2,Hn.RGBA,An.Normalized|An.sRGB)]="BC2_SRGB",e[e.BC3=li(Cr.BC3,Hn.RGBA,An.Normalized)]="BC3",e[e.BC3_SRGB=li(Cr.BC3,Hn.RGBA,An.Normalized|An.sRGB)]="BC3_SRGB",e[e.BC4_UNORM=li(Cr.BC4_UNORM,Hn.R,An.Normalized)]="BC4_UNORM",e[e.BC4_SNORM=li(Cr.BC4_SNORM,Hn.R,An.Normalized)]="BC4_SNORM",e[e.BC5_UNORM=li(Cr.BC5_UNORM,Hn.RG,An.Normalized)]="BC5_UNORM",e[e.BC5_SNORM=li(Cr.BC5_SNORM,Hn.RG,An.Normalized)]="BC5_SNORM",e[e.D24=li(Cr.D24,Hn.R,An.Depth)]="D24",e[e.D24_S8=li(Cr.D24S8,Hn.RG,An.Depth|An.Stencil)]="D24_S8",e[e.D32F=li(Cr.D32F,Hn.R,An.Depth)]="D32F",e[e.D32F_S8=li(Cr.D32FS8,Hn.RG,An.Depth|An.Stencil)]="D32F_S8",e[e.U8_RGB_RT=li(Cr.U8,Hn.RGB,An.RenderTarget|An.Normalized)]="U8_RGB_RT",e[e.U8_RGBA_RT=li(Cr.U8,Hn.RGBA,An.RenderTarget|An.Normalized)]="U8_RGBA_RT",e[e.U8_RGBA_RT_SRGB=li(Cr.U8,Hn.RGBA,An.RenderTarget|An.Normalized|An.sRGB)]="U8_RGBA_RT_SRGB"})(Tt||(Tt={}));function Qg(e){return e>>>8&255}function ch(e){return e>>>16&255}function Sv(e){return e&255}function SE(e){switch(e){case Cr.F32:case Cr.U32:case Cr.S32:return 4;case Cr.U16:case Cr.S16:case Cr.F16:return 2;case Cr.U8:case Cr.S8:return 1;default:throw new Error("whoops")}}function AE(e){return SE(ch(e))}function vN(e){return Qg(e)}function pO(e){var r=SE(ch(e)),t=Qg(e);return r*t}function mN(e,r){return e&4294967040|r}function gN(e,r){return e&4294902015|r<<8}function TE(e){var r=Sv(e);if(r&An.Depth)return zo.Depth;if(r&An.Normalized)return zo.Float;var t=ch(e);if(t===Cr.F16||t===Cr.F32)return zo.Float;if(t===Cr.U8||t===Cr.U16||t===Cr.U32)return zo.Uint;if(t===Cr.S8||t===Cr.S16||t===Cr.S32)return zo.Sint;throw new Error("whoops")}function Di(e,r){if(r===void 0&&(r=""),!e)throw new Error("Assert fail: ".concat(r))}function Ad(e){if(e!=null)return e;throw new Error("Missing object")}function wE(e,r){return e.r===r.r&&e.g===r.g&&e.b===r.b&&e.a===r.a}function CE(e,r){e.r=r.r,e.g=r.g,e.b=r.b,e.a=r.a}function RE(e){var r=e.r,t=e.g,n=e.b,i=e.a;return{r,g:t,b:n,a:i}}function Jg(e,r,t,n){return n===void 0&&(n=1),{r:e,g:r,b:t,a:n}}var A_=Jg(0,0,0,0),_N=Jg(0,0,0,1),dO=Jg(1,1,1,0),yN=Jg(1,1,1,1),Av=!0;function xN(e,r){r===void 0&&(r=Av),r&&(e[10]=-e[10],e[14]=-e[14])}function bN(e,r){r===void 0&&(r=Av),r&&(e[10]=-e[10],e[14]=-e[14]+1)}function vO(e,r){if(r===void 0&&(r=Av),r)switch(e){case _a.LESS:return _a.GREATER;case _a.LEQUAL:return _a.GEQUAL;case _a.GEQUAL:return _a.LEQUAL;case _a.GREATER:return _a.LESS;default:return e}else return e}function EN(e,r){return r===void 0&&(r=Av),r?1-e:e}function SN(e,r){return r===void 0&&(r=Av),r?-e:e}function AN(e,r,t,n){if(n===void 0&&(n=Av),t=vO(t,n),t===_a.LESS)return e<r;if(t===_a.LEQUAL)return e<=r;if(t===_a.GREATER)return e>r;if(t===_a.GEQUAL)return e>=r;throw new Error("whoops")}function e0(e){return!!(e&&!(e&e-1))}function Tv(e,r){return e!=null?e:r}function mO(e){return e===void 0?null:e}function TN(e,r,t){e.length=r,e.fill(t)}function t0(e,r){var t=r-1;return e+t&~t}function wN(e,r){return((e+r-1)/r|0)*r}function gO(e,r,t){for(var n=0,i=e.length;n<i;){var o=n+(i-n>>>1),s=t(r,e[o]);s<0?i=o:n=o+1}return n}function CN(e,r,t){var n=gO(e,r,t);e.splice(n,0,r)}function RN(e,r,t){return t?e|=r:e&=~r,e}function _O(e,r){for(var t=new Array(e),n=0;n<e;n++)t[n]=r();return t}function yO(e,r){r===void 0&&(r=1);var t=e.split(`
`);return t.map(function(n,i){return"".concat(xO(""+(r+i),4," "),"  ").concat(n)}).join(`
`)}function xO(e,r,t){for(t===void 0&&(t="0");e.length<r;)e="".concat(t).concat(e);return e}function MN(e,r){for(var t=[],n=e;n<e+r;n++)t.push(n);return t}function ME(e,r){e.blendDstFactor=r.blendDstFactor,e.blendSrcFactor=r.blendSrcFactor,e.blendMode=r.blendMode}function r0(e,r){return e===void 0&&(e={}),e.compare=r.compare,e.depthFailOp=r.depthFailOp,e.passOp=r.passOp,e.failOp=r.failOp,e}function IE(e,r){return e===void 0&&(e={rgbBlendState:{},alphaBlendState:{},channelWriteMask:0}),ME(e.rgbBlendState,r.rgbBlendState),ME(e.alphaBlendState,r.alphaBlendState),e.channelWriteMask=r.channelWriteMask,e}function T_(e,r){e.length!==r.length&&(e.length=r.length);for(var t=0;t<r.length;t++)e[t]=IE(e[t],r[t])}function bO(e,r){r.attachmentsState!==void 0&&T_(e.attachmentsState,r.attachmentsState),e.blendConstant&&r.blendConstant&&CE(e.blendConstant,r.blendConstant),e.depthCompare=Tv(r.depthCompare,e.depthCompare),e.depthWrite=Tv(r.depthWrite,e.depthWrite),e.stencilWrite=Tv(r.stencilWrite,e.stencilWrite),e.stencilFront&&r.stencilFront&&r0(e.stencilFront,r.stencilFront),e.stencilBack&&r.stencilBack&&r0(e.stencilBack,r.stencilBack),e.cullMode=Tv(r.cullMode,e.cullMode),e.frontFace=Tv(r.frontFace,e.frontFace),e.polygonOffset=Tv(r.polygonOffset,e.polygonOffset)}function wv(e){var r=Object.assign({},e);return r.attachmentsState=[],T_(r.attachmentsState,e.attachmentsState),r.blendConstant=r.blendConstant&&RE(r.blendConstant),r.stencilFront=r0(void 0,e.stencilFront),r.stencilBack=r0(void 0,e.stencilBack),r}function EO(e,r){r.channelWriteMask!==void 0&&(e.channelWriteMask=r.channelWriteMask),r.rgbBlendMode!==void 0&&(e.rgbBlendState.blendMode=r.rgbBlendMode),r.alphaBlendMode!==void 0&&(e.alphaBlendState.blendMode=r.alphaBlendMode),r.rgbBlendSrcFactor!==void 0&&(e.rgbBlendState.blendSrcFactor=r.rgbBlendSrcFactor),r.alphaBlendSrcFactor!==void 0&&(e.alphaBlendState.blendSrcFactor=r.alphaBlendSrcFactor),r.rgbBlendDstFactor!==void 0&&(e.rgbBlendState.blendDstFactor=r.rgbBlendDstFactor),r.alphaBlendDstFactor!==void 0&&(e.alphaBlendState.blendDstFactor=r.alphaBlendDstFactor)}var PE={blendMode:Tu.ADD,blendSrcFactor:ua.ONE,blendDstFactor:ua.ZERO},Td={attachmentsState:[{channelWriteMask:wu.ALL,rgbBlendState:PE,alphaBlendState:PE}],blendConstant:RE(A_),depthWrite:!0,depthCompare:_a.LEQUAL,stencilWrite:!1,stencilFront:{compare:_a.ALWAYS,passOp:qu.KEEP,depthFailOp:qu.KEEP,failOp:qu.KEEP},stencilBack:{compare:_a.ALWAYS,passOp:qu.KEEP,depthFailOp:qu.KEEP,failOp:qu.KEEP},cullMode:Wl.NONE,frontFace:Im.CCW,polygonOffset:!1};function SO(e,r){e===void 0&&(e=null),r===void 0&&(r=Td);var t=wv(r);return e!==null&&bO(t,e),t}var IN=SO({depthCompare:_a.ALWAYS,depthWrite:!1},Td);function PN(e,r){return e.attachmentsState===void 0&&(e.attachmentsState=[],T_(e.attachmentsState,Td.attachmentsState)),EO(e.attachmentsState[0],r),e}var OE={texture:null,sampler:null,formatKind:zo.Float,dimension:Hi.TEXTURE_2D};function Cv(e,r,t){if(e.length!==r.length)return!1;for(var n=0;n<e.length;n++)if(!t(e[n],r[n]))return!1;return!0}function Pm(e,r){for(var t=Array(e.length),n=0;n<e.length;n++)t[n]=r(e[n]);return t}function AO(e,r){return e.buffer===r.buffer&&e.size===r.size&&e.binding===r.binding&&e.offset===r.offset}function TO(e,r){return e===null?r===null:r===null?!1:e.sampler===r.sampler&&e.texture===r.texture&&e.dimension===r.dimension&&e.formatKind===r.formatKind&&e.comparison===r.comparison}function ON(e,r){return e.samplerBindings=e.samplerBindings||[],e.uniformBufferBindings=e.uniformBufferBindings||[],r.samplerBindings=r.samplerBindings||[],r.uniformBufferBindings=r.uniformBufferBindings||[],!(e.samplerBindings.length!==r.samplerBindings.length||!Cv(e.samplerBindings,r.samplerBindings,TO)||!Cv(e.uniformBufferBindings,r.uniformBufferBindings,AO))}function DE(e,r){return e.blendMode==r.blendMode&&e.blendSrcFactor===r.blendSrcFactor&&e.blendDstFactor===r.blendDstFactor}function wO(e,r){return!(!DE(e.rgbBlendState,r.rgbBlendState)||!DE(e.alphaBlendState,r.alphaBlendState)||e.channelWriteMask!==r.channelWriteMask)}function n0(e,r){return e.compare==r.compare&&e.depthFailOp===r.depthFailOp&&e.failOp===r.failOp&&e.passOp===r.passOp}function CO(e,r){return!Cv(e.attachmentsState,r.attachmentsState,wO)||e.blendConstant&&r.blendConstant&&!wE(e.blendConstant,r.blendConstant)||e.stencilFront&&r.stencilFront&&!n0(e.stencilFront,r.stencilFront)||e.stencilBack&&r.stencilBack&&!n0(e.stencilBack,r.stencilBack)?!1:e.depthCompare===r.depthCompare&&e.depthWrite===r.depthWrite&&e.stencilWrite===r.stencilWrite&&e.cullMode===r.cullMode&&e.frontFace===r.frontFace&&e.polygonOffset===r.polygonOffset}function kE(e,r){return e.id===r.id}function RO(e,r){return e===r}function DN(e,r){return!(e.topology!==r.topology||e.inputLayout!==r.inputLayout||e.sampleCount!==r.sampleCount||e.megaStateDescriptor&&r.megaStateDescriptor&&!CO(e.megaStateDescriptor,r.megaStateDescriptor)||!kE(e.program,r.program)||!Cv(e.colorAttachmentFormats,r.colorAttachmentFormats,RO)||e.depthStencilAttachmentFormat!==r.depthStencilAttachmentFormat)}function MO(e,r){return e.offset===r.offset&&e.shaderLocation===r.shaderLocation&&e.format===r.format&&e.divisor===r.divisor}function IO(e,r){return isNil(e)?isNil(r):isNil(r)?!1:e.arrayStride===r.arrayStride&&e.stepMode===r.stepMode&&Cv(e.attributes,r.attributes,MO)}function kN(e,r){return!(e.indexBufferFormat!==r.indexBufferFormat||!Cv(e.vertexBufferDescriptors,r.vertexBufferDescriptors,IO)||!kE(e.program,r.program))}function FN(e,r){return e.addressModeU===r.addressModeU&&e.addressModeV===r.addressModeV&&e.minFilter===r.minFilter&&e.magFilter===r.magFilter&&e.mipmapFilter===r.mipmapFilter&&e.lodMinClamp===r.lodMinClamp&&e.lodMaxClamp===r.lodMaxClamp&&e.maxAnisotropy===r.maxAnisotropy&&e.compareFunction===r.compareFunction}function PO(e){var r=e.sampler,t=e.texture,n=e.dimension,i=e.formatKind,o=e.comparison;return{sampler:r,texture:t,dimension:n,formatKind:i,comparison:o}}function FE(e){var r=e.buffer,t=e.size,n=e.binding,i=e.offset;return{binding:n,buffer:r,offset:i,size:t}}function BN(e){var r=e.samplerBindings&&Pm(e.samplerBindings,PO),t=e.uniformBufferBindings&&Pm(e.uniformBufferBindings,FE),n=e.storageBufferBindings&&Pm(e.storageBufferBindings,FE);return{samplerBindings:r,uniformBufferBindings:t,storageBufferBindings:n,pipeline:e.pipeline}}function LN(e){var r=e.inputLayout,t=e.program,n=e.topology,i=e.megaStateDescriptor&&wv(e.megaStateDescriptor),o=e.colorAttachmentFormats.slice(),s=e.depthStencilAttachmentFormat,l=e.sampleCount;return{inputLayout:r,megaStateDescriptor:i,program:t,topology:n,colorAttachmentFormats:o,depthStencilAttachmentFormat:s,sampleCount:l}}function OO(e){var r=e.shaderLocation,t=e.format,n=e.offset,i=e.divisor;return{shaderLocation:r,format:t,offset:n,divisor:i}}function DO(e){if(isNil(e))return e;var r=e.arrayStride,t=e.stepMode,n=Pm(e.attributes,OO);return{arrayStride:r,stepMode:t,attributes:n}}function NN(e){var r=Pm(e.vertexBufferDescriptors,DO),t=e.indexBufferFormat,n=e.program;return{vertexBufferDescriptors:r,indexBufferFormat:t,program:n}}var na,kO=/([^[]*)(\[[0-9]+\])?/;function FO(e){if(e[e.length-1]!=="]")return{name:e,length:1,isArray:!1};var r=e.match(kO);if(!r||r.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(e));return{name:r[1],length:Number(r[2])||1,isArray:!!r[2]}}function _l(){var e=null;return function(r,t,n){var i=e!==n;return i&&(r.uniform1i(t,n),e=n),i}}function Zo(e,r,t,n){var i=null,o=null;return function(s,l,f){var v=r(f,t),y=v.length,b=!1;if(i===null)i=new Float32Array(y),o=y,b=!0;else{Di(o===y,"Uniform length cannot change.");for(var T=0;T<y;++T)if(v[T]!==i[T]){b=!0;break}}return b&&(n(s,e,l,v),i.set(v)),b}}function Ku(e,r,t,n){e[r](t,n)}function Xh(e,r,t,n){e[r](t,!1,n)}var BO={},LO={},NO={},BE=[0];function w_(e,r,t,n){r===1&&typeof e=="boolean"&&(e=e?1:0),Number.isFinite(e)&&(BE[0]=e,e=BE);var i=e.length;if(e instanceof t)return e;var o=n[i];o||(o=new t(i),n[i]=o);for(var s=0;s<i;s++)o[s]=e[s];return o}function Sc(e,r){return w_(e,r,Float32Array,BO)}function Lp(e,r){return w_(e,r,Int32Array,LO)}function i0(e,r){return w_(e,r,Uint32Array,NO)}var UO=(na={},na[je.FLOAT]=Zo.bind(null,"uniform1fv",Sc,1,Ku),na[je.FLOAT_VEC2]=Zo.bind(null,"uniform2fv",Sc,2,Ku),na[je.FLOAT_VEC3]=Zo.bind(null,"uniform3fv",Sc,3,Ku),na[je.FLOAT_VEC4]=Zo.bind(null,"uniform4fv",Sc,4,Ku),na[je.INT]=Zo.bind(null,"uniform1iv",Lp,1,Ku),na[je.INT_VEC2]=Zo.bind(null,"uniform2iv",Lp,2,Ku),na[je.INT_VEC3]=Zo.bind(null,"uniform3iv",Lp,3,Ku),na[je.INT_VEC4]=Zo.bind(null,"uniform4iv",Lp,4,Ku),na[je.BOOL]=Zo.bind(null,"uniform1iv",Lp,1,Ku),na[je.BOOL_VEC2]=Zo.bind(null,"uniform2iv",Lp,2,Ku),na[je.BOOL_VEC3]=Zo.bind(null,"uniform3iv",Lp,3,Ku),na[je.BOOL_VEC4]=Zo.bind(null,"uniform4iv",Lp,4,Ku),na[je.FLOAT_MAT2]=Zo.bind(null,"uniformMatrix2fv",Sc,4,Xh),na[je.FLOAT_MAT3]=Zo.bind(null,"uniformMatrix3fv",Sc,9,Xh),na[je.FLOAT_MAT4]=Zo.bind(null,"uniformMatrix4fv",Sc,16,Xh),na[je.UNSIGNED_INT]=Zo.bind(null,"uniform1uiv",i0,1,Ku),na[je.UNSIGNED_INT_VEC2]=Zo.bind(null,"uniform2uiv",i0,2,Ku),na[je.UNSIGNED_INT_VEC3]=Zo.bind(null,"uniform3uiv",i0,3,Ku),na[je.UNSIGNED_INT_VEC4]=Zo.bind(null,"uniform4uiv",i0,4,Ku),na[je.FLOAT_MAT2x3]=Zo.bind(null,"uniformMatrix2x3fv",Sc,6,Xh),na[je.FLOAT_MAT2x4]=Zo.bind(null,"uniformMatrix2x4fv",Sc,8,Xh),na[je.FLOAT_MAT3x2]=Zo.bind(null,"uniformMatrix3x2fv",Sc,6,Xh),na[je.FLOAT_MAT3x4]=Zo.bind(null,"uniformMatrix3x4fv",Sc,12,Xh),na[je.FLOAT_MAT4x2]=Zo.bind(null,"uniformMatrix4x2fv",Sc,8,Xh),na[je.FLOAT_MAT4x3]=Zo.bind(null,"uniformMatrix4x3fv",Sc,12,Xh),na[je.SAMPLER_2D]=_l,na[je.SAMPLER_CUBE]=_l,na[je.SAMPLER_3D]=_l,na[je.SAMPLER_2D_SHADOW]=_l,na[je.SAMPLER_2D_ARRAY]=_l,na[je.SAMPLER_2D_ARRAY_SHADOW]=_l,na[je.SAMPLER_CUBE_SHADOW]=_l,na[je.INT_SAMPLER_2D]=_l,na[je.INT_SAMPLER_3D]=_l,na[je.INT_SAMPLER_CUBE]=_l,na[je.INT_SAMPLER_2D_ARRAY]=_l,na[je.UNSIGNED_INT_SAMPLER_2D]=_l,na[je.UNSIGNED_INT_SAMPLER_3D]=_l,na[je.UNSIGNED_INT_SAMPLER_CUBE]=_l,na[je.UNSIGNED_INT_SAMPLER_2D_ARRAY]=_l,na);function LE(e,r,t){var n=UO[t.type];if(!n)throw new Error("Unknown GLSL uniform type ".concat(t.type));return n().bind(null,e,r)}var zO={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121};function ZO(e){return Object.prototype.toString.call(e)in zO}function Om(e,r){return"#define ".concat(e," ").concat(r)}function VO(e){var r={};return e.replace(/^\s*#define\s*(\S*)\s*(\S*)\s*$/gm,function(t,n,i){var o=Number(i);return r[n]=isNaN(o)?i:o,""}),r}function jO(e,r){var t=[];return e.replace(/^\s*layout\(location\s*=\s*(\S*)\)\s*in\s+\S+\s*(.*);$/gm,function(n,i,o){var s=Number(i);return t.push({location:isNaN(s)?r[i]:s,name:o}),""}),t}function UN(e){var r=[],t=[];return e.replace(/\s*struct\s*(.*)\s*{((?:\s*.*\s*)*?)};/g,function(n,i,o){var s=[];return o.trim().replace(`\r
`,`
`).split(`
`).forEach(function(l){var f=__read(l.trim().split(/\s+/),2),v=f[0],y=f[1];s.push({type:v.trim(),name:y.replace(";","").trim()})}),t.push({type:i.trim(),uniforms:s}),""}),e.replace(/\s*uniform\s*.*\s*{((?:\s*.*\s*)*?)};/g,function(n,i){return i.trim().replace(`\r
`,`
`).split(`
`).forEach(function(o){var s=o.trim().split(" "),l=s[0]||"",f=s[1]||"",v=f.indexOf("[")>-1;if(f=f.replace(";","").replace("[","").trim(),!l.startsWith("#")){if(l){var y=t.find(function(M){return l===M.type});if(y)if(v)for(var b=function(M){y.uniforms.forEach(function(O){r.push("".concat(f,"[").concat(M,"].").concat(O.name))})},T=0;T<5;T++)b(T);else y.uniforms.forEach(function(M){r.push("".concat(f,".").concat(M.name))})}f&&r.push(f)}}),""}),r}function NE(e){if(e===void 0)return null;var r=/binding\s*=\s*(\d+)/.exec(e);if(r!==null){var t=parseInt(r[1],10);if(!Number.isNaN(t))return t}return null}function HO(e){var r="",t=e;return[t,r]}function Np(e,r,t,n,i){var o;n===void 0&&(n=null),i===void 0&&(i=!0);var s=e.glslVersion==="#version 100",l=r==="frag"&&((o=t.match(/^\s*layout\(location\s*=\s*\d*\)\s*out\s+vec4\s*(.*);$/gm))===null||o===void 0?void 0:o.length)>1,f=t.replace(`\r
`,`
`).split(`
`).map(function(ut){return ut.replace(/[/][/].*$/,"")}).filter(function(ut){var vt=!ut||/^\s+$/.test(ut);return!vt}),v="";n!==null&&(v=Object.keys(n).map(function(ut){return Om(ut,n[ut])}).join(`
`));var y=f.find(function(ut){return ut.startsWith("precision")})||"precision mediump float;",b=i?f.filter(function(ut){return!ut.startsWith("precision")}).join(`
`):f.join(`
`),T="";if(e.viewportOrigin===bv.UPPER_LEFT&&(T+="".concat(Om("VIEWPORT_ORIGIN_TL","1"),`
`)),e.clipSpaceNearZ===Ev.ZERO&&(T+="".concat(Om("CLIPSPACE_NEAR_ZERO","1"),`
`)),e.explicitBindingLocations){var M=0,O=0,k=0;b=b.replace(/^(layout\((.*)\))?\s*uniform(.+{)$/gm,function(ut,vt,Rt,Jt){var Mr=Rt?"".concat(Rt,", "):"";return"layout(".concat(Mr,"set = ").concat(M,", binding = ").concat(O++,") uniform ").concat(Jt)}),M++,O=0,Di(e.separateSamplerTextures),b=b.replace(/^(layout\((.*)\))?\s*uniform sampler(\w+) (.*);/gm,function(ut,vt,Rt,Jt,Mr){var br=NE(Rt);br===null&&(br=O++);var pn=(0,wn.CR)(HO(Jt),2),kn=pn[0],Pi=pn[1];return r==="frag"?`
layout(set = `.concat(M,", binding = ").concat(br*2+0,") uniform texture").concat(kn," T_").concat(Mr,`;
layout(set = `).concat(M,", binding = ").concat(br*2+1,") uniform sampler").concat(Pi," S_").concat(Mr,";").trim():""}),b=b.replace(r==="frag"?/^\s*\b(varying|in)\b/gm:/^\s*\b(varying|out)\b/gm,function(ut,vt){return"layout(location = ".concat(k++,") ").concat(vt)}),T+="".concat(Om("gl_VertexID","gl_VertexIndex"),`
`),T+="".concat(Om("gl_InstanceID","gl_InstanceIndex"),`
`),y=y.replace(/^precision (.*) sampler(.*);$/gm,"")}else{var $=0;b=b.replace(/^(layout\((.*)\))?\s*uniform sampler(\w+) (.*);/gm,function(ut,vt,Rt,Jt,Mr){var br=NE(Rt);return br===null&&(br=$++),"uniform sampler".concat(Jt," ").concat(Mr,"; // BINDING=").concat(br)})}if(e.separateSamplerTextures)b=b.replace(/\bSAMPLER_(\w+)\((.*?)\)/g,function(ut,vt,Rt){return"sampler".concat(vt,"(T_").concat(Rt,", S_").concat(Rt,")")}),b=b.replace(/\bTEXTURE\((.*?)\)/g,function(ut,vt){return"T_".concat(vt)});else{var G=[];b=b.replace(/\bSAMPLER_(\w+)\((.*?)\)/g,function(ut,vt,Rt){return G.push([Rt,vt]),Rt}),s&&G.forEach(function(ut){var vt=(0,wn.CR)(ut,2),Rt=vt[0],Jt=vt[1];b=b.replace(new RegExp("texture\\(".concat(Rt),"g"),function(){return"texture".concat(Jt,"(").concat(Rt)})}),b=b.replace(/\bTEXTURE\((.*?)\)/g,function(ut,vt){return vt})}var oe="".concat(s?"":e.glslVersion,`
`).concat(s&&l?`#extension GL_EXT_draw_buffers : require
`:"",`
`).concat(s&&r==="frag"?`#extension GL_OES_standard_derivatives : enable
`:"").concat(i?y:"",`
`).concat(T||"").concat(v?v+`
`:"",`
`).concat(b,`
`).trim();if(e.explicitBindingLocations&&r==="frag"&&(oe=oe.replace(/^\b(out)\b/g,function(ut,vt){return"layout(location = 0) ".concat(vt)})),s){if(r==="frag"&&(oe=oe.replace(/^\s*in\s+(\S+)\s*(.*);$/gm,function(ut,vt,Rt){return"varying ".concat(vt," ").concat(Rt,`;
`)})),r==="vert"&&(oe=oe.replace(/^\s*out\s+(\S+)\s*(.*);$/gm,function(ut,vt,Rt){return"varying ".concat(vt," ").concat(Rt,`;
`)}),oe=oe.replace(/^\s*layout\(location\s*=\s*\S*\)\s*in\s+(\S+)\s*(.*);$/gm,function(ut,vt,Rt){return"attribute ".concat(vt," ").concat(Rt,`;
`)})),oe=oe.replace(/\s*uniform\s*.*\s*{((?:\s*.*\s*)*?)};/g,function(ut,vt){return vt.trim().replace(/^.*$/gm,function(Rt){var Jt=Rt.trim();return Jt.startsWith("#")?Jt:Rt?"uniform ".concat(Jt):""})}),r==="frag")if(l){var ye=[];oe=oe.replace(/^\s*layout\(location\s*=\s*\d*\)\s*out\s+vec4\s*(.*);$/gm,function(ut,vt){return ye.push(vt),"vec4 ".concat(vt,`;
`)});var Le=oe.lastIndexOf("}");oe=oe.substring(0,Le)+`
    `.concat(ye.map(function(ut,vt){return"gl_FragData[".concat(vt,"] = ").concat(ut,`;
    `)}).join(`
`))+oe.substring(Le)}else{var $e;if(oe=oe.replace(/^\s*out\s+(\S+)\s*(.*);$/gm,function(ut,vt,Rt){return $e=Rt,"".concat(vt," ").concat(Rt,`;
`)}),$e){var Le=oe.lastIndexOf("}");oe=oe.substring(0,Le)+`
  gl_FragColor = vec4(`.concat($e,`);
`)+oe.substring(Le)}}oe=oe.replace(/^\s*layout\((.*)\)/gm,"")}return oe}function zN(e,r,t,n){n===void 0&&(n=null);var i=Np(e,"vert",r,n),o=Np(e,"frag",t,n);return{vert:r,frag:t,preprocessedVert:i,preprocessedFrag:o}}var Tf=function(e){(0,wn.ZT)(r,e);function r(t){var n=t.id,i=t.device,o=e.call(this)||this;return o.id=n,o.device=i,o.device.resourceCreationTracker!==null&&o.device.resourceCreationTracker.trackResourceCreated(o),o}return r.prototype.destroy=function(){this.device.resourceCreationTracker!==null&&this.device.resourceCreationTracker.trackResourceDestroyed(this)},r}(bE.Z),WO=function(e){(0,wn.ZT)(r,e);function r(t){var n=t.id,i=t.device,o=t.descriptor,s=e.call(this,{id:n,device:i})||this;s.type=ya.Bindings;var l=o.uniformBufferBindings,f=o.samplerBindings;return s.uniformBufferBindings=l||[],s.samplerBindings=f||[],s.bindingLayouts=s.createBindingLayouts(),s}return r.prototype.createBindingLayouts=function(){var t=0,n=0,i=[],o=this.uniformBufferBindings.length,s=this.samplerBindings.length;return i.push({firstUniformBuffer:t,numUniformBuffers:o,firstSampler:n,numSamplers:s}),t+=o,n+=s,{numUniformBuffers:t,numSamplers:n,bindingLayoutTables:i}},r}(Tf);function Vn(e){return typeof WebGL2RenderingContext!="undefined"&&e instanceof WebGL2RenderingContext?!0:!!(e&&e._version===2)}function UE(e){var r=ch(e);switch(r){case Cr.BC1:case Cr.BC2:case Cr.BC3:case Cr.BC4_UNORM:case Cr.BC4_SNORM:case Cr.BC5_UNORM:case Cr.BC5_SNORM:return!0;default:return!1}}function zE(e){var r=Sv(e);if(r&An.Normalized)return!1;var t=ch(e);return t===Cr.S8||t===Cr.S16||t===Cr.S32||t===Cr.U8||t===Cr.U16||t===Cr.U32}function GO(e){switch(e){case Af.STATIC:return je.STATIC_DRAW;case Af.DYNAMIC:return je.DYNAMIC_DRAW}}function ZE(e){if(e&ro.INDEX)return je.ELEMENT_ARRAY_BUFFER;if(e&ro.VERTEX)return je.ARRAY_BUFFER;if(e&ro.UNIFORM)return je.UNIFORM_BUFFER}function XO(e){switch(e){case ms.TRIANGLES:return je.TRIANGLES;case ms.POINTS:return je.POINTS;case ms.TRIANGLE_STRIP:return je.TRIANGLE_STRIP;case ms.LINES:return je.LINES;case ms.LINE_STRIP:return je.LINE_STRIP;default:throw new Error("Unknown primitive topology mode")}}function $O(e){switch(e){case Cr.U8:return je.UNSIGNED_BYTE;case Cr.U16:return je.UNSIGNED_SHORT;case Cr.U32:return je.UNSIGNED_INT;case Cr.S8:return je.BYTE;case Cr.S16:return je.SHORT;case Cr.S32:return je.INT;case Cr.F16:return je.HALF_FLOAT;case Cr.F32:return je.FLOAT;default:throw new Error("whoops")}}function YO(e){switch(e){case Hn.R:return 1;case Hn.RG:return 2;case Hn.RGB:return 3;case Hn.RGBA:return 4;default:return 1}}function qO(e){var r=ch(e),t=Qg(e),n=Sv(e),i=$O(r),o=YO(t),s=!!(n&An.Normalized);return{size:o,type:i,normalized:s}}function KO(e){switch(e){case Tt.U8_R:return je.UNSIGNED_BYTE;case Tt.U16_R:return je.UNSIGNED_SHORT;case Tt.U32_R:return je.UNSIGNED_INT;default:throw new Error("whoops")}}function Dm(e){switch(e){case gl.CLAMP_TO_EDGE:return je.CLAMP_TO_EDGE;case gl.REPEAT:return je.REPEAT;case gl.MIRRORED_REPEAT:return je.MIRRORED_REPEAT;default:throw new Error("whoops")}}function a0(e,r){if(r===Gs.LINEAR&&e===vs.BILINEAR)return je.LINEAR_MIPMAP_LINEAR;if(r===Gs.LINEAR&&e===vs.POINT)return je.NEAREST_MIPMAP_LINEAR;if(r===Gs.NEAREST&&e===vs.BILINEAR)return je.LINEAR_MIPMAP_NEAREST;if(r===Gs.NEAREST&&e===vs.POINT)return je.NEAREST_MIPMAP_NEAREST;if(r===Gs.NO_MIP&&e===vs.BILINEAR)return je.LINEAR;if(r===Gs.NO_MIP&&e===vs.POINT)return je.NEAREST;throw new Error("Unknown texture filter mode")}function Rv(e,r){r===void 0&&(r=0);var t=e;return t.gl_buffer_pages[r/t.pageByteSize|0]}function Mv(e){var r=e;return r.gl_texture}function C_(e){var r=e;return r.gl_sampler}function km(e,r){e.name=r,e.__SPECTOR_Metadata={name:r}}function VE(e,r){for(var t=[];;){var n=r.exec(e);if(!n)break;t.push(n)}return t}function Up(e){return e.blendMode==Tu.ADD&&e.blendSrcFactor==ua.ONE&&e.blendDstFactor===ua.ZERO}function QO(e){switch(e){case Kg.OcclusionConservative:return je.ANY_SAMPLES_PASSED_CONSERVATIVE;default:throw new Error("whoops")}}function JO(e){if(e===Hi.TEXTURE_2D)return je.TEXTURE_2D;if(e===Hi.TEXTURE_2D_ARRAY)return je.TEXTURE_2D_ARRAY;if(e===Hi.TEXTURE_CUBE_MAP)return je.TEXTURE_CUBE_MAP;if(e===Hi.TEXTURE_3D)return je.TEXTURE_3D;throw new Error("whoops")}function R_(e,r,t,n){return!(e%t!==0||r%n!==0)}var eD=function(e){(0,wn.ZT)(r,e);function r(t){var n=t.id,i=t.device,o=t.descriptor,s=e.call(this,{id:n,device:i})||this;s.type=ya.Buffer;var l=o.viewOrSize,f=o.usage,v=o.hint,y=v===void 0?Af.STATIC:v,b=i.uniformBufferMaxPageByteSize,T=i.gl,M=f&ro.UNIFORM;M||(Vn(T)?T.bindVertexArray(null):i.OES_vertex_array_object.bindVertexArrayOES(null));var O=(0,xv.Z)(l)?t0(l,4):t0(l.byteLength,4);s.gl_buffer_pages=[];var k;if(M){for(var $=O;$>0;)s.gl_buffer_pages.push(s.createBufferPage(Math.min($,b),f,y)),$-=b;k=b}else s.gl_buffer_pages.push(s.createBufferPage(O,f,y)),k=O;return s.pageByteSize=k,s.byteSize=O,s.usage=f,s.gl_target=ZE(f),(0,xv.Z)(l)||s.setSubData(0,new Uint8Array(l.buffer)),M||(Vn(T)?T.bindVertexArray(s.device.currentBoundVAO):i.OES_vertex_array_object.bindVertexArrayOES(s.device.currentBoundVAO)),s}return r.prototype.setSubData=function(t,n,i,o){i===void 0&&(i=0),o===void 0&&(o=n.byteLength-i);for(var s=this.device.gl,l=this.pageByteSize,f=t+o,v=t,y=t%l;v<f;){var b=Vn(s)?s.COPY_WRITE_BUFFER:this.gl_target,T=Rv(this,v);if(T.ubo)return;s.bindBuffer(b,T),Vn(s)?s.bufferSubData(b,y,n,i,Math.min(f-v,l)):s.bufferSubData(b,y,n),v+=l,y=0,i+=l,this.device.debugGroupStatisticsBufferUpload()}},r.prototype.destroy=function(){e.prototype.destroy.call(this);for(var t=0;t<this.gl_buffer_pages.length;t++)this.gl_buffer_pages[t].ubo||this.device.gl.deleteBuffer(this.gl_buffer_pages[t]);this.gl_buffer_pages=[]},r.prototype.createBufferPage=function(t,n,i){var o=this.device.gl,s=n&ro.UNIFORM;if(!Vn(o)&&s)return{ubo:!0};var l=this.device.ensureResourceExists(o.createBuffer()),f=ZE(n),v=GO(i);return o.bindBuffer(f,l),o.bufferData(f,t,v),l},r}(Tf),tD=function(e){(0,wn.ZT)(r,e);function r(t){var n,i,o,s,l=t.id,f=t.device,v=t.descriptor,y,b=e.call(this,{id:l,device:f})||this;b.type=ya.InputLayout;var T=v.vertexBufferDescriptors,M=v.indexBufferFormat,O=v.program;Di(M===Tt.U16_R||M===Tt.U32_R||M===null);var k=M!==null?KO(M):null,$=M!==null?AE(M):null,G=b.device.gl,oe=b.device.ensureResourceExists(Vn(G)?G.createVertexArray():f.OES_vertex_array_object.createVertexArrayOES());Vn(G)?G.bindVertexArray(oe):f.OES_vertex_array_object.bindVertexArrayOES(oe),G.bindBuffer(G.ARRAY_BUFFER,Rv(b.device.fallbackVertexBuffer));try{for(var ye=(0,wn.XA)(v.vertexBufferDescriptors),Le=ye.next();!Le.done;Le=ye.next()){var $e=Le.value,ut=$e.stepMode,vt=$e.attributes;try{for(var Rt=(o=void 0,(0,wn.XA)(vt)),Jt=Rt.next();!Jt.done;Jt=Rt.next()){var Mr=Jt.value,br=Mr.shaderLocation,pn=Mr.format,kn=Mr.divisor,Pi=kn===void 0?1:kn,xa=Vn(G)?br:(y=O.attributes[br])===null||y===void 0?void 0:y.location,is=qO(pn);if(Mr.vertexFormat=is,!(0,Bp.Z)(xa)){zE(pn);var _s=is.size,as=is.type,lu=is.normalized;G.vertexAttribPointer(xa,_s,as,lu,0,0),ut===Sd.INSTANCE&&(Vn(G)?G.vertexAttribDivisor(xa,Pi):f.ANGLE_instanced_arrays.vertexAttribDivisorANGLE(xa,Pi)),G.enableVertexAttribArray(xa)}}}catch(Ac){o={error:Ac}}finally{try{Jt&&!Jt.done&&(s=Rt.return)&&s.call(Rt)}finally{if(o)throw o.error}}}}catch(Ac){n={error:Ac}}finally{try{Le&&!Le.done&&(i=ye.return)&&i.call(ye)}finally{if(n)throw n.error}}return Vn(G)?G.bindVertexArray(null):f.OES_vertex_array_object.bindVertexArrayOES(null),b.vertexBufferDescriptors=T,b.vao=oe,b.indexBufferFormat=M,b.indexBufferType=k,b.indexBufferCompByteSize=$,b.program=O,b}return r.prototype.destroy=function(){e.prototype.destroy.call(this),this.device.currentBoundVAO===this.vao&&(Vn(this.device.gl)?(this.device.gl.bindVertexArray(null),this.device.gl.deleteVertexArray(this.vao)):(this.device.OES_vertex_array_object.bindVertexArrayOES(null),this.device.OES_vertex_array_object.deleteVertexArrayOES(this.vao)),this.device.currentBoundVAO=null)},r}(Tf),M_=function(e){(0,wn.ZT)(r,e);function r(t){var n=t.id,i=t.device,o=t.descriptor,s=t.fake,l=e.call(this,{id:n,device:i})||this;l.type=ya.Texture,o=(0,wn.pi)({dimension:Hi.TEXTURE_2D,depthOrArrayLayers:1,mipLevelCount:1},o);var f=l.device.gl,v,y,b=l.clampmipLevelCount(o);if(l.immutable=o.usage===Ec.RENDER_TARGET,l.pixelStore=o.pixelStore,l.format=o.format,l.dimension=o.dimension,l.formatKind=TE(o.format),l.width=o.width,l.height=o.height,l.depthOrArrayLayers=o.depthOrArrayLayers,l.mipmaps=b>=1,!s){y=l.device.ensureResourceExists(f.createTexture());var T=l.device.translateTextureType(o.format),M=l.device.translateTextureInternalFormat(o.format);if(l.device.setActiveTexture(f.TEXTURE0),l.device.currentTextures[0]=null,l.preprocessImage(),o.dimension===Hi.TEXTURE_2D){if(v=je.TEXTURE_2D,f.bindTexture(v,y),l.immutable)if(Vn(f))f.texStorage2D(v,b,M,o.width,o.height);else{var O=(M===je.DEPTH_COMPONENT||l.isNPOT(),0);(l.format===Tt.D32F||l.format===Tt.D24_S8)&&!Vn(f)&&!i.WEBGL_depth_texture||(f.texImage2D(v,O,M,o.width,o.height,0,M,T,null),l.mipmaps&&(l.mipmaps=!1,f.texParameteri(je.TEXTURE_2D,je.TEXTURE_MIN_FILTER,je.LINEAR),f.texParameteri(je.TEXTURE_2D,je.TEXTURE_WRAP_S,je.CLAMP_TO_EDGE),f.texParameteri(je.TEXTURE_2D,je.TEXTURE_WRAP_T,je.CLAMP_TO_EDGE)))}Di(o.depthOrArrayLayers===1)}else if(o.dimension===Hi.TEXTURE_2D_ARRAY)v=je.TEXTURE_2D_ARRAY,f.bindTexture(v,y),l.immutable&&Vn(f)&&f.texStorage3D(v,b,M,o.width,o.height,o.depthOrArrayLayers);else if(o.dimension===Hi.TEXTURE_3D)v=je.TEXTURE_3D,f.bindTexture(v,y),l.immutable&&Vn(f)&&f.texStorage3D(v,b,M,o.width,o.height,o.depthOrArrayLayers);else if(o.dimension===Hi.TEXTURE_CUBE_MAP)v=je.TEXTURE_CUBE_MAP,f.bindTexture(v,y),l.immutable&&Vn(f)&&f.texStorage2D(v,b,M,o.width,o.height),Di(o.depthOrArrayLayers===6);else throw new Error("whoops")}return l.gl_texture=y,l.gl_target=v,l.mipLevelCount=b,l}return r.prototype.setImageData=function(t,n){n===void 0&&(n=0);var i=this.device.gl;UE(this.format);var o=this.gl_target===je.TEXTURE_3D||this.gl_target===je.TEXTURE_2D_ARRAY,s=this.gl_target===je.TEXTURE_CUBE_MAP,l=ZO(t[0]);this.device.setActiveTexture(i.TEXTURE0),this.device.currentTextures[0]=null;var f=t[0],v,y;l?(v=this.width,y=this.height):(v=f.width,y=f.height,this.width=v,this.height=y),i.bindTexture(this.gl_target,this.gl_texture);var b=this.device.translateTextureFormat(this.format),T=this.device.translateTextureType(this.format);this.preprocessImage();for(var M=0;M<this.depthOrArrayLayers;M++){var O=t[M],k=this.gl_target;s&&(k=je.TEXTURE_CUBE_MAP_POSITIVE_X+M%6),this.immutable?i.texSubImage2D(k,n,0,0,v,y,b,T,O):Vn(i)?o?i.texImage3D(k,n,b,v,y,this.depthOrArrayLayers,0,b,T,O):i.texImage2D(k,n,b,v,y,0,b,T,O):l?i.texImage2D(k,n,b,v,y,0,b,T,O):i.texImage2D(k,n,b,b,T,O)}this.mipmaps&&this.generateMipmap(o)},r.prototype.destroy=function(){e.prototype.destroy.call(this),this.device.gl.deleteTexture(Mv(this))},r.prototype.clampmipLevelCount=function(t){if(t.dimension===Hi.TEXTURE_2D_ARRAY&&t.depthOrArrayLayers>1){var n=ch(t.format);if(n===Cr.BC1)for(var i=t.width,o=t.height,s=0;s<t.mipLevelCount;s++){if(i<=2||o<=2)return s-1;i=Math.max(i/2|0,1),o=Math.max(o/2|0,1)}}return t.mipLevelCount},r.prototype.preprocessImage=function(){var t=this.device.gl;this.pixelStore&&(this.pixelStore.unpackFlipY&&t.pixelStorei(je.UNPACK_FLIP_Y_WEBGL,!0),this.pixelStore.packAlignment&&t.pixelStorei(je.PACK_ALIGNMENT,this.pixelStore.packAlignment),this.pixelStore.unpackAlignment&&t.pixelStorei(je.UNPACK_ALIGNMENT,this.pixelStore.unpackAlignment))},r.prototype.generateMipmap=function(t){t===void 0&&(t=!1);var n=this.device.gl;return!Vn(n)&&this.isNPOT()?this:(this.gl_texture&&this.gl_target&&(n.bindTexture(this.gl_target,this.gl_texture),t?(n.texParameteri(this.gl_target,je.TEXTURE_BASE_LEVEL,0),n.texParameteri(this.gl_target,je.TEXTURE_MAX_LEVEL,Math.log2(this.width)),n.texParameteri(this.gl_target,je.TEXTURE_MIN_FILTER,je.LINEAR_MIPMAP_LINEAR),n.texParameteri(this.gl_target,je.TEXTURE_MAG_FILTER,je.LINEAR)):n.texParameteri(je.TEXTURE_2D,je.TEXTURE_MIN_FILTER,je.NEAREST_MIPMAP_LINEAR),n.generateMipmap(this.gl_target),n.bindTexture(this.gl_target,null)),this)},r.prototype.isNPOT=function(){var t=this.device.gl;return Vn(t)?!1:!e0(this.width)||!e0(this.height)},r}(Tf),rD=function(e){(0,wn.ZT)(r,e);function r(t){var n=t.id,i=t.device,o=t.descriptor,s=e.call(this,{id:n,device:i})||this;s.type=ya.RenderTarget,s.gl_renderbuffer=null,s.texture=null;var l=s.device.gl,f=o.format,v=o.width,y=o.height,b=o.sampleCount,T=b===void 0?1:b,M=o.texture,O=!1;if((f===Tt.D32F||f===Tt.D24_S8)&&M&&!Vn(l)&&!i.WEBGL_depth_texture&&(M.destroy(),s.texture=null,O=!0),!O&&M)s.texture=M;else{s.gl_renderbuffer=s.device.ensureResourceExists(l.createRenderbuffer()),l.bindRenderbuffer(l.RENDERBUFFER,s.gl_renderbuffer);var k=s.device.translateTextureInternalFormat(f,!0);Vn(l)&&T>1?l.renderbufferStorageMultisample(je.RENDERBUFFER,T,k,v,y):l.renderbufferStorage(je.RENDERBUFFER,k,v,y)}return s.format=f,s.width=v,s.height=y,s.sampleCount=T,s}return r.prototype.destroy=function(){e.prototype.destroy.call(this),this.gl_renderbuffer!==null&&this.device.gl.deleteRenderbuffer(this.gl_renderbuffer),this.texture&&this.texture.destroy()},r}(Tf),Gl;(function(e){e[e.NeedsCompile=0]="NeedsCompile",e[e.Compiling=1]="Compiling",e[e.NeedsBind=2]="NeedsBind",e[e.ReadyToUse=3]="ReadyToUse"})(Gl||(Gl={}));var nD=function(e){(0,wn.ZT)(r,e);function r(t,n){var i=t.id,o=t.device,s=t.descriptor,l=e.call(this,{id:i,device:o})||this;l.rawVertexGLSL=n,l.type=ya.Program,l.uniformSetters={},l.attributes=[];var f=l.device.gl;return l.descriptor=s,l.gl_program=l.device.ensureResourceExists(f.createProgram()),l.gl_shader_vert=null,l.gl_shader_frag=null,l.compileState=Gl.NeedsCompile,l.tryCompileProgram(),l}return r.prototype.destroy=function(){e.prototype.destroy.call(this),this.device.gl.deleteProgram(this.gl_program),this.device.gl.deleteShader(this.gl_shader_vert),this.device.gl.deleteShader(this.gl_shader_frag)},r.prototype.tryCompileProgram=function(){var t,n;Di(this.compileState===Gl.NeedsCompile);var i=this.descriptor,o=this.device.gl;!((t=i.vertex)===null||t===void 0)&&t.glsl&&(!((n=i.fragment)===null||n===void 0)&&n.glsl)&&(this.gl_shader_vert=this.compileShader(i.vertex.glsl,o.VERTEX_SHADER),this.gl_shader_frag=this.compileShader(i.fragment.glsl,o.FRAGMENT_SHADER),o.attachShader(this.gl_program,this.gl_shader_vert),o.attachShader(this.gl_program,this.gl_shader_frag),o.linkProgram(this.gl_program),this.compileState=Gl.Compiling,Vn(o)||(this.readUniformLocationsFromLinkedProgram(),this.readAttributesFromLinkedProgram()))},r.prototype.readAttributesFromLinkedProgram=function(){for(var t,n=this.device.gl,i=n.getProgramParameter(this.gl_program,n.ACTIVE_ATTRIBUTES),o=VO(this.descriptor.vertex.glsl),s=jO(this.rawVertexGLSL,o),l=function(y){var b=n.getActiveAttrib(f.gl_program,y),T=b.name,M=b.type,O=b.size,k=n.getAttribLocation(f.gl_program,T),$=(t=s.find(function(G){return G.name===T}))===null||t===void 0?void 0:t.location;k>=0&&!(0,Bp.Z)($)&&(f.attributes[$]={name:T,location:k,type:M,size:O})},f=this,v=0;v<i;v++)l(v)},r.prototype.readUniformLocationsFromLinkedProgram=function(){for(var t=this.device.gl,n=t.getProgramParameter(this.gl_program,t.ACTIVE_UNIFORMS),i=0;i<n;i++){var o=t.getActiveUniform(this.gl_program,i),s=FO(o.name).name,l=t.getUniformLocation(this.gl_program,s);if(this.uniformSetters[s]=LE(t,l,o),o&&o.size>1)for(var f=0;f<o.size;f++)l=t.getUniformLocation(this.gl_program,"".concat(s,"[").concat(f,"]")),this.uniformSetters["".concat(s,"[").concat(f,"]")]=LE(t,l,o)}},r.prototype.compileShader=function(t,n){var i=this.device.gl,o=this.device.ensureResourceExists(i.createShader(n));return i.shaderSource(o,t),i.compileShader(o),o},r.prototype.setUniformsLegacy=function(t){t===void 0&&(t={});var n=this.device.gl;if(!Vn(n)){var i=!1;for(var o in t){i||(n.useProgram(this.gl_program),i=!0);var s=t[o],l=this.uniformSetters[o];if(l){var f=s;f instanceof M_&&(f=f.textureIndex),l(f)}}}return this},r}(Tf),iD=function(e){(0,wn.ZT)(r,e);function r(t){var n=t.id,i=t.device,o=t.descriptor,s=e.call(this,{id:n,device:i})||this;s.type=ya.QueryPool;var l=s.device.gl;if(Vn(l)){var f=o.elemCount,v=o.type;s.gl_query=_O(f,function(){return s.device.ensureResourceExists(l.createQuery())}),s.gl_query_type=QO(v)}return s}return r.prototype.queryResultOcclusion=function(t){var n=this.device.gl;if(Vn(n)){var i=this.gl_query[t];return n.getQueryParameter(i,n.QUERY_RESULT_AVAILABLE)?!!n.getQueryParameter(i,n.QUERY_RESULT):null}return null},r.prototype.destroy=function(){e.prototype.destroy.call(this);var t=this.device.gl;if(Vn(t))for(var n=0;n<this.gl_query.length;n++)t.deleteQuery(this.gl_query[n])},r}(Tf),aD=function(e){(0,wn.ZT)(r,e);function r(t){var n=t.id,i=t.device,o=e.call(this,{id:n,device:i})||this;return o.type=ya.Readback,o.gl_pbo=null,o.gl_sync=null,o}return r.prototype.clientWaitAsync=function(t,n,i){n===void 0&&(n=0),i===void 0&&(i=10);var o=this.device.gl;return new Promise(function(s,l){function f(){var v=o.clientWaitSync(t,n,0);if(v==o.WAIT_FAILED){l();return}if(v==o.TIMEOUT_EXPIRED){setTimeout(f,(0,hO.Z)(i,0,o.MAX_CLIENT_WAIT_TIMEOUT_WEBGL));return}s()}f()})},r.prototype.getBufferSubDataAsync=function(t,n,i,o,s,l){return(0,wn.mG)(this,void 0,void 0,function(){var f;return(0,wn.Jh)(this,function(v){switch(v.label){case 0:return f=this.device.gl,Vn(f)?(this.gl_sync=f.fenceSync(f.SYNC_GPU_COMMANDS_COMPLETE,0),f.flush(),[4,this.clientWaitAsync(this.gl_sync,0,10)]):[3,2];case 1:return v.sent(),f.bindBuffer(t,n),f.getBufferSubData(t,i,o,s,l),f.bindBuffer(t,null),[2,o];case 2:return[2]}})})},r.prototype.readTexture=function(t,n,i,o,s,l,f,v){return f===void 0&&(f=0),v===void 0&&(v=l.byteLength||0),(0,wn.mG)(this,void 0,void 0,function(){var y,b,T,M,O;return(0,wn.Jh)(this,function(k){return y=this.device.gl,b=t,T=this.device.translateTextureFormat(b.format),M=this.device.translateTextureType(b.format),O=pO(b.format),Vn(y)?(this.gl_pbo=this.device.ensureResourceExists(y.createBuffer()),y.bindBuffer(y.PIXEL_PACK_BUFFER,this.gl_pbo),y.bufferData(y.PIXEL_PACK_BUFFER,v,y.STREAM_READ),y.bindBuffer(y.PIXEL_PACK_BUFFER,null),y.bindFramebuffer(je.READ_FRAMEBUFFER,this.device.readbackFramebuffer),y.framebufferTexture2D(je.READ_FRAMEBUFFER,je.COLOR_ATTACHMENT0,je.TEXTURE_2D,b.gl_texture,0),y.bindBuffer(y.PIXEL_PACK_BUFFER,this.gl_pbo),y.readPixels(n,i,o,s,T,M,f*O),y.bindBuffer(y.PIXEL_PACK_BUFFER,null),[2,this.getBufferSubDataAsync(y.PIXEL_PACK_BUFFER,this.gl_pbo,0,l,f,0)]):[2,this.readTextureSync(t,n,i,o,s,l,f,v)]})})},r.prototype.readTextureSync=function(t,n,i,o,s,l,f,v){v===void 0&&(v=l.byteLength||0);var y=this.device.gl,b=t,T=this.device.translateTextureType(b.format);return y.bindFramebuffer(je.FRAMEBUFFER,this.device.readbackFramebuffer),y.framebufferTexture2D(je.FRAMEBUFFER,je.COLOR_ATTACHMENT0,je.TEXTURE_2D,b.gl_texture,0),y.pixelStorei(y.PACK_ALIGNMENT,4),y.readPixels(n,i,o,s,y.RGBA,T,l),l},r.prototype.readBuffer=function(t,n,i,o,s){return(0,wn.mG)(this,void 0,void 0,function(){var l;return(0,wn.Jh)(this,function(f){return l=this.device.gl,Vn(l)?[2,this.getBufferSubDataAsync(l.ARRAY_BUFFER,Rv(t,n),n,i,o,s)]:[2,Promise.reject()]})})},r.prototype.destroy=function(){e.prototype.destroy.call(this),Vn(this.device.gl)&&(this.gl_sync!==null&&this.device.gl.deleteSync(this.gl_sync),this.gl_pbo!==null&&this.device.gl.deleteBuffer(this.gl_pbo))},r}(Tf),oD=function(e){(0,wn.ZT)(r,e);function r(t){var n=t.id,i=t.device,o=t.descriptor,s,l,f=e.call(this,{id:n,device:i})||this;return f.type=ya.RenderPipeline,f.drawMode=XO((s=o.topology)!==null&&s!==void 0?s:ms.TRIANGLES),f.program=o.program,f.inputLayout=o.inputLayout,f.megaState=(0,wn.pi)((0,wn.pi)({},wv(Td)),o.megaStateDescriptor),f.colorAttachmentFormats=o.colorAttachmentFormats.slice(),f.depthStencilAttachmentFormat=o.depthStencilAttachmentFormat,f.sampleCount=(l=o.sampleCount)!==null&&l!==void 0?l:1,f}return r}(Tf),sD=function(e){(0,wn.ZT)(r,e);function r(t){var n=t.id,i=t.device,o=t.descriptor,s=e.call(this,{id:n,device:i})||this;return s.type=ya.ComputePipeline,s.descriptor=o,s}return r}(Tf),uD=function(){function e(){this.liveObjects=new Set,this.creationStacks=new Map,this.deletionStacks=new Map}return e.prototype.trackResourceCreated=function(r){this.creationStacks.set(r,new Error().stack),this.liveObjects.add(r)},e.prototype.trackResourceDestroyed=function(r){this.deletionStacks.has(r)&&console.warn("Object double freed:",r,`

Creation stack: `,this.creationStacks.get(r),`

Deletion stack: `,this.deletionStacks.get(r),`

This stack: `,new Error().stack),this.deletionStacks.set(r,new Error().stack),this.liveObjects.delete(r)},e.prototype.checkForLeaks=function(){var r,t;try{for(var n=(0,wn.XA)(this.liveObjects.values()),i=n.next();!i.done;i=n.next()){var o=i.value;console.warn("Object leaked:",o,"Creation stack:",this.creationStacks.get(o))}}catch(s){r={error:s}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(r)throw r.error}}},e.prototype.setResourceLeakCheck=function(r,t){t?this.liveObjects.add(r):this.liveObjects.delete(r)},e}(),lD=function(e){(0,wn.ZT)(r,e);function r(t){var n=t.id,i=t.device,o=t.descriptor,s,l,f=e.call(this,{id:n,device:i})||this;f.type=ya.Sampler;var v=f.device.gl;if(Vn(v)){var y=f.device.ensureResourceExists(v.createSampler());v.samplerParameteri(y,je.TEXTURE_WRAP_S,Dm(o.addressModeU)),v.samplerParameteri(y,je.TEXTURE_WRAP_T,Dm(o.addressModeV)),v.samplerParameteri(y,je.TEXTURE_WRAP_R,Dm((s=o.addressModeW)!==null&&s!==void 0?s:o.addressModeU)),v.samplerParameteri(y,je.TEXTURE_MIN_FILTER,a0(o.minFilter,o.mipmapFilter)),v.samplerParameteri(y,je.TEXTURE_MAG_FILTER,a0(o.magFilter,Gs.NO_MIP)),o.lodMinClamp!==void 0&&v.samplerParameterf(y,je.TEXTURE_MIN_LOD,o.lodMinClamp),o.lodMaxClamp!==void 0&&v.samplerParameterf(y,je.TEXTURE_MAX_LOD,o.lodMaxClamp),o.compareFunction!==void 0&&(v.samplerParameteri(y,v.TEXTURE_COMPARE_MODE,v.COMPARE_REF_TO_TEXTURE),v.samplerParameteri(y,v.TEXTURE_COMPARE_FUNC,o.compareFunction));var b=(l=o.maxAnisotropy)!==null&&l!==void 0?l:1;b>1&&f.device.EXT_texture_filter_anisotropic!==null&&(Di(o.minFilter===vs.BILINEAR&&o.magFilter===vs.BILINEAR&&o.mipmapFilter===Gs.LINEAR),v.samplerParameterf(y,f.device.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,b)),f.gl_sampler=y}else f.descriptor=o;return f}return r.prototype.setTextureParameters=function(t,n,i){var o,s=this.device.gl,l=this.descriptor;this.isNPOT(n,i)?s.texParameteri(je.TEXTURE_2D,je.TEXTURE_MIN_FILTER,je.LINEAR):s.texParameteri(t,je.TEXTURE_MIN_FILTER,a0(l.minFilter,l.mipmapFilter)),s.texParameteri(je.TEXTURE_2D,je.TEXTURE_WRAP_S,Dm(l.addressModeU)),s.texParameteri(je.TEXTURE_2D,je.TEXTURE_WRAP_T,Dm(l.addressModeV)),s.texParameteri(t,je.TEXTURE_MAG_FILTER,a0(l.magFilter,Gs.NO_MIP));var f=(o=l.maxAnisotropy)!==null&&o!==void 0?o:1;f>1&&this.device.EXT_texture_filter_anisotropic!==null&&(Di(l.minFilter===vs.BILINEAR&&l.magFilter===vs.BILINEAR&&l.mipmapFilter===Gs.LINEAR),s.texParameteri(t,this.device.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,f))},r.prototype.destroy=function(){e.prototype.destroy.call(this),Vn(this.device.gl)&&this.device.gl.deleteSampler(C_(this))},r.prototype.isNPOT=function(t,n){return!e0(t)||!e0(n)},r}(Tf),cD=function(){function e(){}return e.prototype.dispatchWorkgroups=function(r,t,n){},e.prototype.dispatchWorkgroupsIndirect=function(r,t){},e.prototype.setPipeline=function(r){},e.prototype.setBindings=function(r){},e.prototype.pushDebugGroup=function(r){},e.prototype.popDebugGroup=function(){},e.prototype.insertDebugMarker=function(r){},e}(),jE=65536,fD=function(){function e(r,t){this.shaderDebug=!1,this.OES_vertex_array_object=null,this.ANGLE_instanced_arrays=null,this.OES_texture_float=null,this.OES_draw_buffers_indexed=null,this.WEBGL_draw_buffers=null,this.WEBGL_depth_texture=null,this.WEBGL_color_buffer_float=null,this.EXT_color_buffer_half_float=null,this.WEBGL_compressed_texture_s3tc=null,this.WEBGL_compressed_texture_s3tc_srgb=null,this.EXT_texture_compression_rgtc=null,this.EXT_texture_filter_anisotropic=null,this.KHR_parallel_shader_compile=null,this.EXT_texture_norm16=null,this.EXT_color_buffer_float=null,this.OES_texture_float_linear=null,this.OES_texture_half_float_linear=null,this.scTexture=null,this.scPlatformFramebuffer=null,this.currentActiveTexture=null,this.currentBoundVAO=null,this.currentProgram=null,this.resourceCreationTracker=null,this.resourceUniqueId=0,this.currentColorAttachments=[],this.currentColorAttachmentLevels=[],this.currentColorResolveTos=[],this.currentColorResolveToLevels=[],this.currentSampleCount=-1,this.currentIndexBufferByteOffset=null,this.currentMegaState=wv(Td),this.currentSamplers=[],this.currentTextures=[],this.currentUniformBuffers=[],this.currentUniformBufferByteOffsets=[],this.currentUniformBufferByteSizes=[],this.currentScissorEnabled=!1,this.currentStencilRef=null,this.currentRenderPassDescriptor=null,this.currentRenderPassDescriptorStack=[],this.debugGroupStack=[],this.resolveColorAttachmentsChanged=!1,this.resolveDepthStencilAttachmentsChanged=!1,this.explicitBindingLocations=!1,this.separateSamplerTextures=!1,this.viewportOrigin=bv.LOWER_LEFT,this.clipSpaceNearZ=Ev.NEGATIVE_ONE,this.supportMRT=!1,this.inBlitRenderPass=!1,this.supportedSampleCounts=[],this.occlusionQueriesRecommended=!1,this.computeShadersSupported=!1,this.gl=r,this.contextAttributes=Ad(r.getContextAttributes()),Vn(r)?(this.EXT_texture_norm16=r.getExtension("EXT_texture_norm16"),this.EXT_color_buffer_float=r.getExtension("EXT_color_buffer_float")):(this.OES_vertex_array_object=r.getExtension("OES_vertex_array_object"),this.ANGLE_instanced_arrays=r.getExtension("ANGLE_instanced_arrays"),this.OES_texture_float=r.getExtension("OES_texture_float"),this.WEBGL_draw_buffers=r.getExtension("WEBGL_draw_buffers"),this.WEBGL_depth_texture=r.getExtension("WEBGL_depth_texture"),this.WEBGL_color_buffer_float=r.getExtension("WEBGL_color_buffer_float"),this.EXT_color_buffer_half_float=r.getExtension("EXT_color_buffer_half_float"),r.getExtension("EXT_frag_depth"),r.getExtension("OES_element_index_uint"),r.getExtension("OES_standard_derivatives")),this.WEBGL_compressed_texture_s3tc=r.getExtension("WEBGL_compressed_texture_s3tc"),this.WEBGL_compressed_texture_s3tc_srgb=r.getExtension("WEBGL_compressed_texture_s3tc_srgb"),this.EXT_texture_compression_rgtc=r.getExtension("EXT_texture_compression_rgtc"),this.EXT_texture_filter_anisotropic=r.getExtension("EXT_texture_filter_anisotropic"),this.EXT_texture_norm16=r.getExtension("EXT_texture_norm16"),this.OES_texture_float_linear=r.getExtension("OES_texture_float_linear"),this.OES_texture_half_float_linear=r.getExtension("OES_texture_half_float_linear"),this.KHR_parallel_shader_compile=r.getExtension("KHR_parallel_shader_compile"),Vn(r)?(this.platformString="WebGL2",this.glslVersion="#version 300 es"):(this.platformString="WebGL1",this.glslVersion="#version 100"),this.scTexture=new M_({id:this.getNextUniqueId(),device:this,descriptor:{width:0,height:0,depthOrArrayLayers:1,dimension:Hi.TEXTURE_2D,mipLevelCount:1,usage:Ec.RENDER_TARGET,format:this.contextAttributes.alpha===!1?Tt.U8_RGB_RT:Tt.U8_RGBA_RT},fake:!0}),this.scTexture.formatKind=zo.Float,this.scTexture.gl_target=null,this.scTexture.gl_texture=null,this.resolveColorReadFramebuffer=this.ensureResourceExists(r.createFramebuffer()),this.resolveColorDrawFramebuffer=this.ensureResourceExists(r.createFramebuffer()),this.resolveDepthStencilReadFramebuffer=this.ensureResourceExists(r.createFramebuffer()),this.resolveDepthStencilDrawFramebuffer=this.ensureResourceExists(r.createFramebuffer()),this.renderPassDrawFramebuffer=this.ensureResourceExists(r.createFramebuffer()),this.readbackFramebuffer=this.ensureResourceExists(r.createFramebuffer()),this.fallbackTexture2D=this.createFallbackTexture(Hi.TEXTURE_2D,zo.Float),this.fallbackTexture2DDepth=this.createFallbackTexture(Hi.TEXTURE_2D,zo.Depth),this.fallbackVertexBuffer=this.createBuffer({viewOrSize:1,usage:ro.VERTEX,hint:Af.STATIC}),Vn(r)&&(this.fallbackTexture2DArray=this.createFallbackTexture(Hi.TEXTURE_2D_ARRAY,zo.Float),this.fallbackTexture3D=this.createFallbackTexture(Hi.TEXTURE_3D,zo.Float),this.fallbackTextureCube=this.createFallbackTexture(Hi.TEXTURE_CUBE_MAP,zo.Float)),this.currentMegaState.depthCompare=_a.LESS,this.currentMegaState.depthWrite=!1,this.currentMegaState.attachmentsState[0].channelWriteMask=wu.ALL,r.enable(r.DEPTH_TEST),r.enable(r.STENCIL_TEST),this.checkLimits(),t.shaderDebug&&(this.shaderDebug=!0),t.trackResources&&(this.resourceCreationTracker=new uD)}return e.prototype.destroy=function(){this.blitBindings&&this.blitBindings.destroy(),this.blitInputLayout&&this.blitInputLayout.destroy(),this.blitRenderPipeline&&this.blitRenderPipeline.destroy(),this.blitVertexBuffer&&this.blitVertexBuffer.destroy(),this.blitProgram&&this.blitProgram.destroy()},e.prototype.createFallbackTexture=function(r,t){var n=r===Hi.TEXTURE_CUBE_MAP?6:1,i=t===zo.Depth?Tt.D32F:Tt.U8_RGBA_NORM,o=this.createTexture({dimension:r,format:i,usage:Ec.SAMPLED,width:1,height:1,depthOrArrayLayers:n,mipLevelCount:1});return t===zo.Float&&o.setImageData([new Uint8Array(4*n)]),Mv(o)},e.prototype.getNextUniqueId=function(){return++this.resourceUniqueId},e.prototype.checkLimits=function(){var r=this.gl;if(this.maxVertexAttribs=r.getParameter(je.MAX_VERTEX_ATTRIBS),Vn(r)){this.uniformBufferMaxPageByteSize=Math.min(r.getParameter(je.MAX_UNIFORM_BLOCK_SIZE),jE),this.uniformBufferWordAlignment=r.getParameter(r.UNIFORM_BUFFER_OFFSET_ALIGNMENT)/4;var t=r.getInternalformatParameter(r.RENDERBUFFER,r.DEPTH32F_STENCIL8,r.SAMPLES);this.supportedSampleCounts=t?(0,wn.ev)([],(0,wn.CR)(t),!1):[],this.occlusionQueriesRecommended=!0}else this.uniformBufferWordAlignment=64,this.uniformBufferMaxPageByteSize=jE;this.uniformBufferMaxPageWordSize=this.uniformBufferMaxPageByteSize/4,this.supportedSampleCounts.includes(1)||this.supportedSampleCounts.push(1),this.supportedSampleCounts.sort(function(n,i){return n-i})},e.prototype.configureSwapChain=function(r,t,n){var i=this.scTexture;i.width=r,i.height=t,this.scPlatformFramebuffer=mO(n)},e.prototype.getDevice=function(){return this},e.prototype.getCanvas=function(){return this.gl.canvas},e.prototype.getOnscreenTexture=function(){return this.scTexture},e.prototype.beginFrame=function(){},e.prototype.endFrame=function(){},e.prototype.translateTextureInternalFormat=function(r,t){switch(t===void 0&&(t=!1),r){case Tt.ALPHA:return je.ALPHA;case Tt.U8_LUMINANCE:case Tt.F16_LUMINANCE:case Tt.F32_LUMINANCE:return je.LUMINANCE;case Tt.F16_R:return je.R16F;case Tt.F16_RG:return je.RG16F;case Tt.F16_RGB:return je.RGB16F;case Tt.F16_RGBA:return je.RGBA16F;case Tt.F32_R:return je.R32F;case Tt.F32_RG:return je.RG32F;case Tt.F32_RGB:return je.RGB32F;case Tt.F32_RGBA:return Vn(this.gl)?je.RGBA32F:t?this.WEBGL_color_buffer_float.RGBA32F_EXT:je.RGBA;case Tt.U8_R_NORM:return je.R8;case Tt.U8_RG_NORM:return je.RG8;case Tt.U8_RGB_NORM:case Tt.U8_RGB_RT:return je.RGB8;case Tt.U8_RGB_SRGB:return je.SRGB8;case Tt.U8_RGBA_NORM:case Tt.U8_RGBA_RT:return Vn(this.gl)?je.RGBA8:t?je.RGBA4:je.RGBA;case Tt.U8_RGBA:return je.RGBA;case Tt.U8_RGBA_SRGB:case Tt.U8_RGBA_RT_SRGB:return je.SRGB8_ALPHA8;case Tt.U16_R:return je.R16UI;case Tt.U16_R_NORM:return this.EXT_texture_norm16.R16_EXT;case Tt.U16_RG_NORM:return this.EXT_texture_norm16.RG16_EXT;case Tt.U16_RGBA_NORM:return this.EXT_texture_norm16.RGBA16_EXT;case Tt.U16_RGBA_5551:return je.RGB5_A1;case Tt.U16_RGB_565:return je.RGB565;case Tt.U32_R:return je.R32UI;case Tt.S8_RGBA_NORM:return je.RGBA8_SNORM;case Tt.S8_RG_NORM:return je.RG8_SNORM;case Tt.BC1:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT1_EXT;case Tt.BC1_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;case Tt.BC2:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT3_EXT;case Tt.BC2_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;case Tt.BC3:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT5_EXT;case Tt.BC3_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;case Tt.BC4_UNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_RED_RGTC1_EXT;case Tt.BC4_SNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_SIGNED_RED_RGTC1_EXT;case Tt.BC5_UNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_RED_GREEN_RGTC2_EXT;case Tt.BC5_SNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT;case Tt.D32F_S8:return Vn(this.gl)?je.DEPTH32F_STENCIL8:this.WEBGL_depth_texture?je.DEPTH_STENCIL:je.DEPTH_COMPONENT16;case Tt.D24_S8:return Vn(this.gl)?je.DEPTH24_STENCIL8:this.WEBGL_depth_texture?je.DEPTH_STENCIL:je.DEPTH_COMPONENT16;case Tt.D32F:return Vn(this.gl)?je.DEPTH_COMPONENT32F:this.WEBGL_depth_texture?je.DEPTH_COMPONENT:je.DEPTH_COMPONENT16;case Tt.D24:return Vn(this.gl)?je.DEPTH_COMPONENT24:this.WEBGL_depth_texture?je.DEPTH_COMPONENT:je.DEPTH_COMPONENT16;default:throw new Error("whoops")}},e.prototype.translateTextureType=function(r){var t=ch(r);switch(t){case Cr.U8:return je.UNSIGNED_BYTE;case Cr.U16:return je.UNSIGNED_SHORT;case Cr.U32:return je.UNSIGNED_INT;case Cr.S8:return je.BYTE;case Cr.F16:return je.HALF_FLOAT;case Cr.F32:return je.FLOAT;case Cr.U16_PACKED_5551:return je.UNSIGNED_SHORT_5_5_5_1;case Cr.D32F:return Vn(this.gl)?je.FLOAT:this.WEBGL_depth_texture?je.UNSIGNED_INT:je.UNSIGNED_BYTE;case Cr.D24:return Vn(this.gl)?je.UNSIGNED_INT_24_8:this.WEBGL_depth_texture?je.UNSIGNED_SHORT:je.UNSIGNED_BYTE;case Cr.D24S8:return Vn(this.gl)?je.UNSIGNED_INT_24_8:this.WEBGL_depth_texture?je.UNSIGNED_INT_24_8_WEBGL:je.UNSIGNED_BYTE;case Cr.D32FS8:return je.FLOAT_32_UNSIGNED_INT_24_8_REV;default:throw new Error("whoops")}},e.prototype.translateTextureFormat=function(r){if(UE(r)||r===Tt.F32_LUMINANCE||r===Tt.U8_LUMINANCE)return this.translateTextureInternalFormat(r);var t=Vn(this.gl)||!Vn(this.gl)&&!!this.WEBGL_depth_texture;switch(r){case Tt.D24_S8:case Tt.D32F_S8:return t?je.DEPTH_STENCIL:je.RGBA;case Tt.D24:case Tt.D32F:return t?je.DEPTH_COMPONENT:je.RGBA}var n=zE(r),i=Qg(r);switch(i){case Hn.A:return je.ALPHA;case Hn.R:return n?je.RED_INTEGER:je.RED;case Hn.RG:return n?je.RG_INTEGER:je.RG;case Hn.RGB:return n?je.RGB_INTEGER:je.RGB;case Hn.RGBA:return je.RGBA}},e.prototype.setActiveTexture=function(r){this.currentActiveTexture!==r&&(this.gl.activeTexture(r),this.currentActiveTexture=r)},e.prototype.bindVAO=function(r){this.currentBoundVAO!==r&&(Vn(this.gl)?this.gl.bindVertexArray(r):this.OES_vertex_array_object.bindVertexArrayOES(r),this.currentBoundVAO=r)},e.prototype.programCompiled=function(r){Di(r.compileState!==Gl.NeedsCompile),r.compileState===Gl.Compiling&&(r.compileState=Gl.NeedsBind,this.shaderDebug&&this.checkProgramCompilationForErrors(r))},e.prototype.useProgram=function(r){this.currentProgram!==r&&(this.programCompiled(r),this.gl.useProgram(r.gl_program),this.currentProgram=r)},e.prototype.ensureResourceExists=function(r){if(r===null){var t=this.gl.getError();throw new Error("Created resource is null; GL error encountered: ".concat(t))}else return r},e.prototype.createBuffer=function(r){return new eD({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createTexture=function(r){return new M_({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createSampler=function(r){return new lD({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createRenderTarget=function(r){return new rD({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createRenderTargetFromTexture=function(r){var t=r,n=t.format,i=t.width,o=t.height,s=t.mipLevelCount;return Di(s===1),this.createRenderTarget({format:n,width:i,height:o,sampleCount:1,texture:r})},e.prototype.createProgram=function(r){var t,n,i,o=(t=r.vertex)===null||t===void 0?void 0:t.glsl;return!((n=r.vertex)===null||n===void 0)&&n.glsl&&(r.vertex.glsl=Np(this.queryVendorInfo(),"vert",r.vertex.glsl)),!((i=r.fragment)===null||i===void 0)&&i.glsl&&(r.fragment.glsl=Np(this.queryVendorInfo(),"frag",r.fragment.glsl)),this.createProgramSimple(r,o)},e.prototype.createProgramSimple=function(r,t){var n=new nD({id:this.getNextUniqueId(),device:this,descriptor:r},t);return n},e.prototype.createBindings=function(r){return new WO({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createInputLayout=function(r){return new tD({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createRenderPipeline=function(r){return new oD({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createComputePass=function(){return new cD},e.prototype.createComputePipeline=function(r){return new sD({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createReadback=function(){return new aD({id:this.getNextUniqueId(),device:this})},e.prototype.createQueryPool=function(r,t){return new iD({id:this.getNextUniqueId(),device:this,descriptor:{type:r,elemCount:t}})},e.prototype.formatRenderPassDescriptor=function(r){var t,n,i,o,s,l,f=r.colorAttachment;r.depthClearValue=(t=r.depthClearValue)!==null&&t!==void 0?t:"load",r.stencilClearValue=(n=r.stencilClearValue)!==null&&n!==void 0?n:"load";for(var v=0;v<f.length;v++)r.colorAttachmentLevel||(r.colorAttachmentLevel=[]),r.colorAttachmentLevel[v]=(i=r.colorAttachmentLevel[v])!==null&&i!==void 0?i:0,r.colorResolveToLevel||(r.colorResolveToLevel=[]),r.colorResolveToLevel[v]=(o=r.colorResolveToLevel[v])!==null&&o!==void 0?o:0,r.colorClearColor||(r.colorClearColor=[]),r.colorClearColor[v]=(s=r.colorClearColor[v])!==null&&s!==void 0?s:"load",r.colorStore||(r.colorStore=[]),r.colorStore[v]=(l=r.colorStore[v])!==null&&l!==void 0?l:!1},e.prototype.createRenderPass=function(r){this.currentRenderPassDescriptor!==null&&this.currentRenderPassDescriptorStack.push(this.currentRenderPassDescriptor),this.currentRenderPassDescriptor=r,this.formatRenderPassDescriptor(r);var t=r.colorAttachment,n=r.colorAttachmentLevel,i=r.colorClearColor,o=r.colorResolveTo,s=r.colorResolveToLevel,l=r.depthStencilAttachment,f=r.depthClearValue,v=r.stencilClearValue,y=r.depthStencilResolveTo;this.setRenderPassParametersBegin(t.length);for(var b=0;b<t.length;b++)this.setRenderPassParametersColor(b,t[b],n[b],o[b],s[b]);this.setRenderPassParametersDepthStencil(l,y),this.validateCurrentAttachments();for(var b=0;b<t.length;b++){var T=i[b];T!=="load"&&this.setRenderPassParametersClearColor(b,T.r,T.g,T.b,T.a)}return this.setRenderPassParametersClearDepthStencil(f,v),this},e.prototype.submitPass=function(r){Di(this.currentRenderPassDescriptor!==null),this.endPass(),this.currentRenderPassDescriptorStack.length?this.currentRenderPassDescriptor=this.currentRenderPassDescriptorStack.pop():this.currentRenderPassDescriptor=null},e.prototype.copySubTexture2D=function(r,t,n,i,o,s){var l=this.gl,f=r,v=i;if(Di(v.mipLevelCount===1),Di(f.mipLevelCount===1),Vn(l))f===this.scTexture?l.bindFramebuffer(l.DRAW_FRAMEBUFFER,this.scPlatformFramebuffer):(l.bindFramebuffer(l.DRAW_FRAMEBUFFER,this.resolveColorDrawFramebuffer),this.bindFramebufferAttachment(l.DRAW_FRAMEBUFFER,l.COLOR_ATTACHMENT0,f,0)),l.bindFramebuffer(l.READ_FRAMEBUFFER,this.resolveColorReadFramebuffer),this.bindFramebufferAttachment(l.READ_FRAMEBUFFER,l.COLOR_ATTACHMENT0,v,0),l.blitFramebuffer(o,s,o+v.width,s+v.height,t,n,t+v.width,n+v.height,l.COLOR_BUFFER_BIT,l.LINEAR),l.bindFramebuffer(l.READ_FRAMEBUFFER,null),l.bindFramebuffer(l.DRAW_FRAMEBUFFER,null);else if(f===this.scTexture){var y=this.createRenderTargetFromTexture(i);this.submitBlitRenderPass(y,f)}},e.prototype.queryLimits=function(){return this},e.prototype.queryTextureFormatSupported=function(r,t,n){switch(r){case Tt.BC1_SRGB:case Tt.BC2_SRGB:case Tt.BC3_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb!==null?R_(t,n,4,4):!1;case Tt.BC1:case Tt.BC2:case Tt.BC3:return this.WEBGL_compressed_texture_s3tc!==null?R_(t,n,4,4):!1;case Tt.BC4_UNORM:case Tt.BC4_SNORM:case Tt.BC5_UNORM:case Tt.BC5_SNORM:return this.EXT_texture_compression_rgtc!==null?R_(t,n,4,4):!1;case Tt.U16_R_NORM:case Tt.U16_RG_NORM:case Tt.U16_RGBA_NORM:return this.EXT_texture_norm16!==null;case Tt.F32_R:case Tt.F32_RG:case Tt.F32_RGB:case Tt.F32_RGBA:return this.OES_texture_float_linear!==null;case Tt.F16_R:case Tt.F16_RG:case Tt.F16_RGB:case Tt.F16_RGBA:return this.OES_texture_half_float_linear!==null;default:return!0}},e.prototype.queryProgramReady=function(r){var t=this.gl;if(r.compileState===Gl.NeedsCompile)throw new Error("whoops");if(r.compileState===Gl.Compiling){var n=void 0;return this.KHR_parallel_shader_compile!==null?n=t.getProgramParameter(r.gl_program,this.KHR_parallel_shader_compile.COMPLETION_STATUS_KHR):n=!0,n&&this.programCompiled(r),n}return r.compileState===Gl.NeedsBind||r.compileState===Gl.ReadyToUse},e.prototype.queryPlatformAvailable=function(){return this.gl.isContextLost()},e.prototype.queryVendorInfo=function(){return this},e.prototype.queryRenderPass=function(r){return this.currentRenderPassDescriptor},e.prototype.queryRenderTarget=function(r){var t=r;return t},e.prototype.setResourceName=function(r,t){if(r.name=t,r.type===ya.Buffer)for(var n=r.gl_buffer_pages,i=0;i<n.length;i++)km(n[i],"".concat(t," Page ").concat(i));else if(r.type===ya.Texture)km(Mv(r),t);else if(r.type===ya.Sampler)km(C_(r),t);else if(r.type===ya.RenderTarget){var o=r.gl_renderbuffer;o!==null&&km(o,t)}else r.type===ya.InputLayout&&km(r.vao,t)},e.prototype.setResourceLeakCheck=function(r,t){this.resourceCreationTracker!==null&&this.resourceCreationTracker.setResourceLeakCheck(r,t)},e.prototype.checkForLeaks=function(){this.resourceCreationTracker!==null&&this.resourceCreationTracker.checkForLeaks()},e.prototype.pushDebugGroup=function(r){},e.prototype.popDebugGroup=function(){},e.prototype.insertDebugMarker=function(r){},e.prototype.programPatched=function(r,t){Di(this.shaderDebug)},e.prototype.getBufferData=function(r,t,n){n===void 0&&(n=0);var i=this.gl;Vn(i)&&(i.bindBuffer(i.COPY_READ_BUFFER,Rv(r,n*4)),i.getBufferSubData(i.COPY_READ_BUFFER,n*4,t))},e.prototype.debugGroupStatisticsDrawCall=function(r){r===void 0&&(r=1);for(var t=this.debugGroupStack.length-1;t>=0;t--)this.debugGroupStack[t].drawCallCount+=r},e.prototype.debugGroupStatisticsBufferUpload=function(r){r===void 0&&(r=1);for(var t=this.debugGroupStack.length-1;t>=0;t--)this.debugGroupStack[t].bufferUploadCount+=r},e.prototype.debugGroupStatisticsTextureBind=function(r){r===void 0&&(r=1);for(var t=this.debugGroupStack.length-1;t>=0;t--)this.debugGroupStack[t].textureBindCount+=r},e.prototype.debugGroupStatisticsTriangles=function(r){for(var t=this.debugGroupStack.length-1;t>=0;t--)this.debugGroupStack[t].triangleCount+=r},e.prototype.reportShaderError=function(r,t){var n=this.gl,i=n.getShaderParameter(r,n.COMPILE_STATUS);if(!i){console.error(yO(t));var o=n.getExtension("WEBGL_debug_shaders");o&&console.error(o.getTranslatedShaderSource(r)),console.error(n.getShaderInfoLog(r))}return i},e.prototype.checkProgramCompilationForErrors=function(r){var t=this.gl,n=r.gl_program;if(!t.getProgramParameter(n,t.LINK_STATUS)){var i=r.descriptor;if(!this.reportShaderError(r.gl_shader_vert,i.vertex.glsl)||!this.reportShaderError(r.gl_shader_frag,i.fragment.glsl))return;console.error(t.getProgramInfoLog(r.gl_program))}},e.prototype.bindFramebufferAttachment=function(r,t,n,i){var o=this.gl;if((0,Bp.Z)(n))o.framebufferRenderbuffer(r,t,o.RENDERBUFFER,null);else if(n.type===ya.RenderTarget)n.gl_renderbuffer!==null?o.framebufferRenderbuffer(r,t,o.RENDERBUFFER,n.gl_renderbuffer):n.texture!==null&&o.framebufferTexture2D(r,t,je.TEXTURE_2D,Mv(n.texture),i);else if(n.type===ya.Texture){var s=Mv(n);n.dimension===Hi.TEXTURE_2D?o.framebufferTexture2D(r,t,je.TEXTURE_2D,s,i):Vn(o)&&(n.dimension,Hi.TEXTURE_2D_ARRAY)}},e.prototype.bindFramebufferDepthStencilAttachment=function(r,t){var n=this.gl,i=(0,Bp.Z)(t)?An.Depth|An.Stencil:Sv(t.format),o=!!(i&An.Depth),s=!!(i&An.Stencil);if(o&&s){var l=Vn(this.gl)||!Vn(this.gl)&&!!this.WEBGL_depth_texture;l?this.bindFramebufferAttachment(r,n.DEPTH_STENCIL_ATTACHMENT,t,0):this.bindFramebufferAttachment(r,n.DEPTH_ATTACHMENT,t,0)}else o?(this.bindFramebufferAttachment(r,n.DEPTH_ATTACHMENT,t,0),this.bindFramebufferAttachment(r,n.STENCIL_ATTACHMENT,null,0)):s&&(this.bindFramebufferAttachment(r,n.STENCIL_ATTACHMENT,t,0),this.bindFramebufferAttachment(r,n.DEPTH_ATTACHMENT,null,0))},e.prototype.validateCurrentAttachments=function(){for(var r=-1,t=-1,n=-1,i=0;i<this.currentColorAttachments.length;i++){var o=this.currentColorAttachments[i];o!==null&&(r===-1?(r=o.sampleCount,t=o.width,n=o.height):(Di(r===o.sampleCount),Di(t===o.width),Di(n===o.height)))}this.currentDepthStencilAttachment&&(r===-1?r=this.currentDepthStencilAttachment.sampleCount:(Di(r===this.currentDepthStencilAttachment.sampleCount),Di(t===this.currentDepthStencilAttachment.width),Di(n===this.currentDepthStencilAttachment.height))),this.currentSampleCount=r},e.prototype.setRenderPassParametersBegin=function(r){var t=this.gl;if(Vn(t)?t.bindFramebuffer(je.DRAW_FRAMEBUFFER,this.renderPassDrawFramebuffer):this.inBlitRenderPass||t.bindFramebuffer(je.FRAMEBUFFER,this.renderPassDrawFramebuffer),Vn(t)?t.drawBuffers([je.COLOR_ATTACHMENT0,je.COLOR_ATTACHMENT1,je.COLOR_ATTACHMENT2,je.COLOR_ATTACHMENT3]):!this.inBlitRenderPass&&this.WEBGL_draw_buffers&&this.WEBGL_draw_buffers.drawBuffersWEBGL([je.COLOR_ATTACHMENT0_WEBGL,je.COLOR_ATTACHMENT1_WEBGL,je.COLOR_ATTACHMENT2_WEBGL,je.COLOR_ATTACHMENT3_WEBGL]),!this.inBlitRenderPass)for(var n=r;n<this.currentColorAttachments.length;n++){var i=Vn(t)?je.DRAW_FRAMEBUFFER:je.FRAMEBUFFER,o=Vn(t)?je.COLOR_ATTACHMENT0:je.COLOR_ATTACHMENT0_WEBGL;t.framebufferRenderbuffer(i,o+n,je.RENDERBUFFER,null),t.framebufferTexture2D(i,o+n,je.TEXTURE_2D,null,0)}this.currentColorAttachments.length=r},e.prototype.setRenderPassParametersColor=function(r,t,n,i,o){var s=this.gl,l=Vn(s);(this.currentColorAttachments[r]!==t||this.currentColorAttachmentLevels[r]!==n)&&(this.currentColorAttachments[r]=t,this.currentColorAttachmentLevels[r]=n,(l||!l&&this.WEBGL_draw_buffers)&&this.bindFramebufferAttachment(l?je.DRAW_FRAMEBUFFER:je.FRAMEBUFFER,(l?je.COLOR_ATTACHMENT0:je.COLOR_ATTACHMENT0_WEBGL)+r,t,n),this.resolveColorAttachmentsChanged=!0),(this.currentColorResolveTos[r]!==i||this.currentColorResolveToLevels[r]!==o)&&(this.currentColorResolveTos[r]=i,this.currentColorResolveToLevels[r]=o,i!==null&&(this.resolveColorAttachmentsChanged=!0))},e.prototype.setRenderPassParametersDepthStencil=function(r,t){var n=this.gl;this.currentDepthStencilAttachment!==r&&(this.currentDepthStencilAttachment=r,this.inBlitRenderPass||this.bindFramebufferDepthStencilAttachment(Vn(n)?je.DRAW_FRAMEBUFFER:je.FRAMEBUFFER,this.currentDepthStencilAttachment),this.resolveDepthStencilAttachmentsChanged=!0),this.currentDepthStencilResolveTo!==t&&(this.currentDepthStencilResolveTo=t,t&&(this.resolveDepthStencilAttachmentsChanged=!0))},e.prototype.setRenderPassParametersClearColor=function(r,t,n,i,o){var s=this.gl;if(this.OES_draw_buffers_indexed!==null){var l=this.currentMegaState.attachmentsState[r];l&&l.channelWriteMask!==wu.ALL&&(this.OES_draw_buffers_indexed.colorMaskiOES(r,!0,!0,!0,!0),l.channelWriteMask=wu.ALL)}else{var l=this.currentMegaState.attachmentsState[0];l&&l.channelWriteMask!==wu.ALL&&(s.colorMask(!0,!0,!0,!0),l.channelWriteMask=wu.ALL)}this.setScissorRectEnabled(!1),Vn(s)?s.clearBufferfv(s.COLOR,r,[t,n,i,o]):(s.clearColor(t,n,i,o),s.clear(s.COLOR_BUFFER_BIT))},e.prototype.setRenderPassParametersClearDepthStencil=function(r,t){r===void 0&&(r="load"),t===void 0&&(t="load");var n=this.gl;r!=="load"&&(Di(!!this.currentDepthStencilAttachment),this.currentMegaState.depthWrite||(n.depthMask(!0),this.currentMegaState.depthWrite=!0),Vn(n)?n.clearBufferfv(n.DEPTH,0,[r]):(n.clearDepth(r),n.clear(n.DEPTH_BUFFER_BIT))),t!=="load"&&(Di(!!this.currentDepthStencilAttachment),this.currentMegaState.stencilWrite||(n.enable(n.STENCIL_TEST),n.stencilMask(255),this.currentMegaState.stencilWrite=!0),Vn(n)?n.clearBufferiv(n.STENCIL,0,[t]):(n.clearStencil(t),n.clear(n.STENCIL_BUFFER_BIT)))},e.prototype.setBindings=function(r){var t,n=this.gl,i=r,o=i.uniformBufferBindings,s=i.samplerBindings,l=i.bindingLayouts;Di(0<l.bindingLayoutTables.length);var f=l.bindingLayoutTables[0];Di(o.length>=f.numUniformBuffers),Di(s.length>=f.numSamplers);for(var v=0;v<o.length;v++){var y=o[v];if(y.size!==0){var b=f.firstUniformBuffer+v,T=y.buffer,M=y.offset||0,O=y.size||T.byteSize;if(T!==this.currentUniformBuffers[b]||M!==this.currentUniformBufferByteOffsets[b]||O!==this.currentUniformBufferByteSizes[b]){var k=M%T.pageByteSize,$=T.gl_buffer_pages[M/T.pageByteSize|0];Di(k+O<=T.pageByteSize),Vn(n)&&n.bindBufferRange(n.UNIFORM_BUFFER,b,$,k,O),this.currentUniformBuffers[b]=T,this.currentUniformBufferByteOffsets[b]=M,this.currentUniformBufferByteSizes[b]=O}}}for(var v=0;v<f.numSamplers;v++){var y=s[v],G=f.firstSampler+v,oe=y!==null&&y.sampler!==null?C_(y.sampler):null,ye=y!==null&&y.texture!==null?Mv(y.texture):null;if(this.currentSamplers[G]!==oe&&(Vn(n)&&n.bindSampler(G,oe),this.currentSamplers[G]=oe),this.currentTextures[G]!==ye){if(this.setActiveTexture(n.TEXTURE0+G),ye!==null){var Le=Ad(y).texture,$e=Le.gl_target,ut=Le.width,vt=Le.height;y.texture.textureIndex=G,n.bindTexture($e,ye),Vn(n)||(t=y.sampler)===null||t===void 0||t.setTextureParameters($e,ut,vt),this.debugGroupStatisticsTextureBind()}else{var Rt=(0,wn.pi)((0,wn.pi)({},y),OE),Jt=Rt.dimension,Mr=Rt.formatKind,$e=JO(Jt);n.bindTexture($e,this.getFallbackTexture((0,wn.pi)({gl_target:$e,formatKind:Mr},Rt)))}this.currentTextures[G]=ye}}},e.prototype.setViewport=function(r,t,n,i){var o=this.gl;o.viewport(r,t,n,i)},e.prototype.setScissorRect=function(r,t,n,i){var o=this.gl;this.setScissorRectEnabled(!0),o.scissor(r,t,n,i)},e.prototype.applyAttachmentStateIndexed=function(r,t,n){var i=this.gl,o=this.OES_draw_buffers_indexed;t.channelWriteMask!==n.channelWriteMask&&(o.colorMaskiOES(r,!!(n.channelWriteMask&wu.RED),!!(n.channelWriteMask&wu.GREEN),!!(n.channelWriteMask&wu.BLUE),!!(n.channelWriteMask&wu.ALPHA)),t.channelWriteMask=n.channelWriteMask);var s=t.rgbBlendState.blendMode!==n.rgbBlendState.blendMode||t.alphaBlendState.blendMode!==n.alphaBlendState.blendMode,l=t.rgbBlendState.blendSrcFactor!==n.rgbBlendState.blendSrcFactor||t.alphaBlendState.blendSrcFactor!==n.alphaBlendState.blendSrcFactor||t.rgbBlendState.blendDstFactor!==n.rgbBlendState.blendDstFactor||t.alphaBlendState.blendDstFactor!==n.alphaBlendState.blendDstFactor;(l||s)&&(Up(t.rgbBlendState)&&Up(t.alphaBlendState)?o.enableiOES(r,i.BLEND):Up(n.rgbBlendState)&&Up(n.alphaBlendState)&&o.disableiOES(r,i.BLEND)),s&&(o.blendEquationSeparateiOES(r,n.rgbBlendState.blendMode,n.alphaBlendState.blendMode),t.rgbBlendState.blendMode=n.rgbBlendState.blendMode,t.alphaBlendState.blendMode=n.alphaBlendState.blendMode),l&&(o.blendFuncSeparateiOES(r,n.rgbBlendState.blendSrcFactor,n.rgbBlendState.blendDstFactor,n.alphaBlendState.blendSrcFactor,n.alphaBlendState.blendDstFactor),t.rgbBlendState.blendSrcFactor=n.rgbBlendState.blendSrcFactor,t.alphaBlendState.blendSrcFactor=n.alphaBlendState.blendSrcFactor,t.rgbBlendState.blendDstFactor=n.rgbBlendState.blendDstFactor,t.alphaBlendState.blendDstFactor=n.alphaBlendState.blendDstFactor)},e.prototype.applyAttachmentState=function(r,t){var n=this.gl;r.channelWriteMask!==t.channelWriteMask&&(n.colorMask(!!(t.channelWriteMask&wu.RED),!!(t.channelWriteMask&wu.GREEN),!!(t.channelWriteMask&wu.BLUE),!!(t.channelWriteMask&wu.ALPHA)),r.channelWriteMask=t.channelWriteMask);var i=r.rgbBlendState.blendMode!==t.rgbBlendState.blendMode||r.alphaBlendState.blendMode!==t.alphaBlendState.blendMode,o=r.rgbBlendState.blendSrcFactor!==t.rgbBlendState.blendSrcFactor||r.alphaBlendState.blendSrcFactor!==t.alphaBlendState.blendSrcFactor||r.rgbBlendState.blendDstFactor!==t.rgbBlendState.blendDstFactor||r.alphaBlendState.blendDstFactor!==t.alphaBlendState.blendDstFactor;(o||i)&&(Up(r.rgbBlendState)&&Up(r.alphaBlendState)?n.enable(n.BLEND):Up(t.rgbBlendState)&&Up(t.alphaBlendState)&&n.disable(n.BLEND)),i&&(n.blendEquationSeparate(t.rgbBlendState.blendMode,t.alphaBlendState.blendMode),r.rgbBlendState.blendMode=t.rgbBlendState.blendMode,r.alphaBlendState.blendMode=t.alphaBlendState.blendMode),o&&(n.blendFuncSeparate(t.rgbBlendState.blendSrcFactor,t.rgbBlendState.blendDstFactor,t.alphaBlendState.blendSrcFactor,t.alphaBlendState.blendDstFactor),r.rgbBlendState.blendSrcFactor=t.rgbBlendState.blendSrcFactor,r.alphaBlendState.blendSrcFactor=t.alphaBlendState.blendSrcFactor,r.rgbBlendState.blendDstFactor=t.rgbBlendState.blendDstFactor,r.alphaBlendState.blendDstFactor=t.alphaBlendState.blendDstFactor)},e.prototype.setMegaState=function(r){var t=this.gl,n=this.currentMegaState;if(this.OES_draw_buffers_indexed!==null)for(var i=0;i<r.attachmentsState.length;i++)this.applyAttachmentStateIndexed(i,n.attachmentsState[0],r.attachmentsState[0]);else Di(r.attachmentsState.length===1),this.applyAttachmentState(n.attachmentsState[0],r.attachmentsState[0]);if(wE(n.blendConstant,r.blendConstant)||(t.blendColor(r.blendConstant.r,r.blendConstant.g,r.blendConstant.b,r.blendConstant.a),CE(n.blendConstant,r.blendConstant)),n.depthCompare!==r.depthCompare&&(t.depthFunc(r.depthCompare),n.depthCompare=r.depthCompare),!!n.depthWrite!=!!r.depthWrite&&(t.depthMask(r.depthWrite),n.depthWrite=r.depthWrite),!!n.stencilWrite!=!!r.stencilWrite&&(t.stencilMask(r.stencilWrite?255:0),n.stencilWrite=r.stencilWrite),!n0(n.stencilFront,r.stencilFront)){var o=r.stencilFront,s=o.passOp,l=o.failOp,f=o.depthFailOp,v=o.compare;(n.stencilFront.passOp!==s||n.stencilFront.failOp!==l||n.stencilFront.depthFailOp!==f)&&(t.stencilOpSeparate(t.FRONT,l,f,s),n.stencilFront.passOp=s,n.stencilFront.failOp=l,n.stencilFront.depthFailOp=f),n.stencilFront.compare!==v&&(this.setStencilReference(0),n.stencilFront.compare=v)}if(!n0(n.stencilBack,r.stencilBack)){var y=r.stencilBack,s=y.passOp,l=y.failOp,f=y.depthFailOp,v=y.compare;(n.stencilBack.passOp!==s||n.stencilBack.failOp!==l||n.stencilBack.depthFailOp!==f)&&(t.stencilOpSeparate(t.BACK,l,f,s),n.stencilBack.passOp=s,n.stencilBack.failOp=l,n.stencilBack.depthFailOp=f),n.stencilBack.compare!==v&&(this.setStencilReference(0),n.stencilBack.compare=v)}n.cullMode!==r.cullMode&&(n.cullMode===Wl.NONE?t.enable(t.CULL_FACE):r.cullMode===Wl.NONE&&t.disable(t.CULL_FACE),r.cullMode===Wl.BACK?t.cullFace(t.BACK):r.cullMode===Wl.FRONT?t.cullFace(t.FRONT):r.cullMode===Wl.FRONT_AND_BACK&&t.cullFace(t.FRONT_AND_BACK),n.cullMode=r.cullMode),n.frontFace!==r.frontFace&&(t.frontFace(r.frontFace),n.frontFace=r.frontFace),n.polygonOffset!==r.polygonOffset&&(r.polygonOffset?(t.polygonOffset(1,1),t.enable(t.POLYGON_OFFSET_FILL)):t.disable(t.POLYGON_OFFSET_FILL),n.polygonOffset=r.polygonOffset)},e.prototype.validatePipelineFormats=function(r){for(var t=0;t<this.currentColorAttachments.length;t++)var n=this.currentColorAttachments[t];this.currentDepthStencilAttachment&&Di(this.currentDepthStencilAttachment.format===r.depthStencilAttachmentFormat),this.currentSampleCount!==-1&&Di(this.currentSampleCount===r.sampleCount)},e.prototype.setPipeline=function(r){this.currentPipeline=r,this.validatePipelineFormats(this.currentPipeline),this.setMegaState(this.currentPipeline.megaState);var t=this.currentPipeline.program;if(this.useProgram(t),t.compileState===Gl.NeedsBind){var n=this.gl,i=t.gl_program,o=t.descriptor,s=VE(o.vertex.glsl,/uniform (\w+) {([^]*?)}/g);if(Vn(n))for(var l=0;l<s.length;l++){var f=(0,wn.CR)(s[l],2),v=f[1],y=n.getUniformBlockIndex(i,v);y!==-1&&y!==4294967295&&n.uniformBlockBinding(i,y,l)}for(var b=VE(o.fragment.glsl,/^uniform .*sampler\S+ (\w+);\s* \/\/ BINDING=(\d+)$/gm),l=0;l<b.length;l++){var T=(0,wn.CR)(b[l],3),M=T[1],O=T[2],k=n.getUniformLocation(i,M);n.uniform1i(k,parseInt(O))}t.compileState=Gl.ReadyToUse}},e.prototype.setVertexInput=function(r,t,n){var i,o,s;if(r!==null){Di(this.currentPipeline.inputLayout===r);var l=r;this.bindVAO(l.vao);for(var f=this.gl,v=0;v<l.vertexBufferDescriptors.length;v++){var y=l.vertexBufferDescriptors[v],b=y.arrayStride,T=y.attributes;try{for(var M=(i=void 0,(0,wn.XA)(T)),O=M.next();!O.done;O=M.next()){var k=O.value,$=k.shaderLocation,G=k.offset,oe=Vn(f)?$:(s=l.program.attributes[$])===null||s===void 0?void 0:s.location;if(!(0,Bp.Z)(oe)){var ye=t[v];if(ye===null)continue;var Le=k.vertexFormat;f.bindBuffer(f.ARRAY_BUFFER,Rv(ye.buffer));var $e=(ye.offset||0)+G;f.vertexAttribPointer(oe,Le.size,Le.type,Le.normalized,b,$e)}}}catch(vt){i={error:vt}}finally{try{O&&!O.done&&(o=M.return)&&o.call(M)}finally{if(i)throw i.error}}}if(Di(n!==null==(l.indexBufferFormat!==null)),n!==null){var ut=n.buffer;Di(ut.usage===ro.INDEX),f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,Rv(ut)),this.currentIndexBufferByteOffset=n.offset||0}else this.currentIndexBufferByteOffset=null}else Di(this.currentPipeline.inputLayout===null),Di(n===null),this.bindVAO(null),this.currentIndexBufferByteOffset=0},e.prototype.setStencilReference=function(r){this.currentStencilRef!==r&&(this.currentStencilRef=r,this.applyStencil())},e.prototype.draw=function(r,t,n,i){var o,s=this.gl,l=this.currentPipeline;if(t){var f=[l.drawMode,n||0,r,t];Vn(s)?s.drawArraysInstanced.apply(s,(0,wn.ev)([],(0,wn.CR)(f),!1)):(o=this.ANGLE_instanced_arrays).drawArraysInstancedANGLE.apply(o,(0,wn.ev)([],(0,wn.CR)(f),!1))}else s.drawArrays(l.drawMode,n,r);this.debugGroupStatisticsDrawCall(),this.debugGroupStatisticsTriangles(r/3*Math.max(t,1))},e.prototype.drawIndexed=function(r,t,n,i,o){var s,l=this.gl,f=this.currentPipeline,v=Ad(f.inputLayout),y=Ad(this.currentIndexBufferByteOffset)+n*v.indexBufferCompByteSize;if(t){var b=[f.drawMode,r,v.indexBufferType,y,t];Vn(l)?l.drawElementsInstanced.apply(l,(0,wn.ev)([],(0,wn.CR)(b),!1)):(s=this.ANGLE_instanced_arrays).drawElementsInstancedANGLE.apply(s,(0,wn.ev)([],(0,wn.CR)(b),!1))}else l.drawElements(f.drawMode,r,v.indexBufferType,y);this.debugGroupStatisticsDrawCall(),this.debugGroupStatisticsTriangles(r/3*Math.max(t,1))},e.prototype.drawIndirect=function(r,t){},e.prototype.drawIndexedIndirect=function(r,t){},e.prototype.beginOcclusionQuery=function(r){var t=this.gl;if(Vn(t)){var n=this.currentRenderPassDescriptor.occlusionQueryPool;t.beginQuery(n.gl_query_type,n.gl_query[r])}},e.prototype.endOcclusionQuery=function(){var r=this.gl;if(Vn(r)){var t=this.currentRenderPassDescriptor.occlusionQueryPool;r.endQuery(t.gl_query_type)}},e.prototype.pipelineQueryReady=function(r){var t=r;return this.queryProgramReady(t.program)},e.prototype.pipelineForceReady=function(r){},e.prototype.endPass=function(){for(var r=this.gl,t=Vn(r),n=!1,i=0;i<this.currentColorAttachments.length;i++){var o=this.currentColorAttachments[i];if(o!==null){var s=this.currentColorResolveTos[i],l=!1;s!==null&&(Di(o.width===s.width&&o.height===s.height),this.setScissorRectEnabled(!1),t&&r.bindFramebuffer(r.READ_FRAMEBUFFER,this.resolveColorReadFramebuffer),this.resolveColorAttachmentsChanged&&t&&this.bindFramebufferAttachment(r.READ_FRAMEBUFFER,r.COLOR_ATTACHMENT0,o,this.currentColorAttachmentLevels[i]),l=!0,s===this.scTexture?r.bindFramebuffer(t?je.DRAW_FRAMEBUFFER:je.FRAMEBUFFER,this.scPlatformFramebuffer):(r.bindFramebuffer(t?je.DRAW_FRAMEBUFFER:je.FRAMEBUFFER,this.resolveColorDrawFramebuffer),this.resolveColorAttachmentsChanged&&r.framebufferTexture2D(t?je.DRAW_FRAMEBUFFER:je.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,s.gl_texture,this.currentColorResolveToLevels[i])),t?(r.blitFramebuffer(0,0,o.width,o.height,0,0,s.width,s.height,r.COLOR_BUFFER_BIT,r.LINEAR),r.bindFramebuffer(r.DRAW_FRAMEBUFFER,null)):this.submitBlitRenderPass(o,s),n=!0),this.currentRenderPassDescriptor.colorStore[i]||l||(r.bindFramebuffer(t?je.READ_FRAMEBUFFER:je.FRAMEBUFFER,this.resolveColorReadFramebuffer),this.resolveColorAttachmentsChanged&&this.bindFramebufferAttachment(t?je.READ_FRAMEBUFFER:je.FRAMEBUFFER,r.COLOR_ATTACHMENT0,o,this.currentColorAttachmentLevels[i])),r.bindFramebuffer(t?je.READ_FRAMEBUFFER:je.FRAMEBUFFER,null)}}this.resolveColorAttachmentsChanged=!1;var f=this.currentDepthStencilAttachment;if(f){var v=this.currentDepthStencilResolveTo,l=!1;v&&(Di(f.width===v.width&&f.height===v.height),this.setScissorRectEnabled(!1),r.bindFramebuffer(t?je.READ_FRAMEBUFFER:je.FRAMEBUFFER,this.resolveDepthStencilReadFramebuffer),r.bindFramebuffer(t?je.DRAW_FRAMEBUFFER:je.FRAMEBUFFER,this.resolveDepthStencilDrawFramebuffer),this.resolveDepthStencilAttachmentsChanged&&(this.bindFramebufferDepthStencilAttachment(t?je.READ_FRAMEBUFFER:je.FRAMEBUFFER,f),this.bindFramebufferDepthStencilAttachment(t?je.DRAW_FRAMEBUFFER:je.FRAMEBUFFER,v)),l=!0,t&&r.blitFramebuffer(0,0,f.width,f.height,0,0,v.width,v.height,r.DEPTH_BUFFER_BIT,r.NEAREST),r.bindFramebuffer(t?je.DRAW_FRAMEBUFFER:je.FRAMEBUFFER,null),n=!0),this.currentRenderPassDescriptor.depthStencilStore||(l||(r.bindFramebuffer(t?je.READ_FRAMEBUFFER:je.FRAMEBUFFER,this.resolveDepthStencilReadFramebuffer),this.resolveDepthStencilAttachmentsChanged&&this.bindFramebufferDepthStencilAttachment(t?je.READ_FRAMEBUFFER:je.FRAMEBUFFER,f),l=!0),t&&r.invalidateFramebuffer(r.READ_FRAMEBUFFER,[r.DEPTH_STENCIL_ATTACHMENT])),l&&r.bindFramebuffer(t?je.READ_FRAMEBUFFER:je.FRAMEBUFFER,null),this.resolveDepthStencilAttachmentsChanged=!1}n||r.bindFramebuffer(t?je.DRAW_FRAMEBUFFER:je.FRAMEBUFFER,null)},e.prototype.setScissorRectEnabled=function(r){if(this.currentScissorEnabled!==r){var t=this.gl;r?t.enable(t.SCISSOR_TEST):t.disable(t.SCISSOR_TEST),this.currentScissorEnabled=r}},e.prototype.applyStencil=function(){(0,Bp.Z)(this.currentStencilRef)||(this.gl.stencilFuncSeparate(je.FRONT,this.currentMegaState.stencilFront.compare,this.currentStencilRef,255),this.gl.stencilFuncSeparate(je.BACK,this.currentMegaState.stencilBack.compare,this.currentStencilRef,255))},e.prototype.getFallbackTexture=function(r){var t=r.gl_target,n=r.formatKind;if(t===je.TEXTURE_2D)return n===zo.Depth?this.fallbackTexture2DDepth:this.fallbackTexture2D;if(t===je.TEXTURE_2D_ARRAY)return this.fallbackTexture2DArray;if(t===je.TEXTURE_3D)return this.fallbackTexture3D;if(t===je.TEXTURE_CUBE_MAP)return this.fallbackTextureCube;throw new Error("whoops")},e.prototype.submitBlitRenderPass=function(r,t){this.blitRenderPipeline||(this.blitProgram=this.createProgram({vertex:{glsl:`layout(location = 0) in vec2 a_Position;
out vec2 v_TexCoord;
void main() {
  v_TexCoord = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);

  #ifdef VIEWPORT_ORIGIN_TL
    v_TexCoord.y = 1.0 - v_TexCoord.y;
  #endif
}`},fragment:{glsl:`uniform sampler2D u_Texture;
in vec2 v_TexCoord;
out vec4 outputColor;
void main() {
  outputColor = texture(SAMPLER_2D(u_Texture), v_TexCoord);
}`}}),this.blitVertexBuffer=this.createBuffer({usage:ro.VERTEX|ro.COPY_DST,viewOrSize:new Float32Array([-4,-4,4,-4,0,4])}),this.blitInputLayout=this.createInputLayout({vertexBufferDescriptors:[{arrayStride:4*2,stepMode:Sd.VERTEX,attributes:[{format:Tt.F32_RG,offset:4*0,shaderLocation:0}]}],indexBufferFormat:null,program:this.blitProgram}),this.blitRenderPipeline=this.createRenderPipeline({topology:ms.TRIANGLES,sampleCount:1,program:this.blitProgram,colorAttachmentFormats:[Tt.U8_RGBA_RT],depthStencilAttachmentFormat:null,inputLayout:this.blitInputLayout,megaStateDescriptor:wv(Td)}),this.blitBindings=this.createBindings({samplerBindings:[{sampler:null,texture:r.texture}],uniformBufferBindings:[]}),this.blitProgram.setUniformsLegacy({u_Texture:r}));var n=this.currentRenderPassDescriptor;this.currentRenderPassDescriptor=null,this.inBlitRenderPass=!0;var i=this.createRenderPass({colorAttachment:[r],colorResolveTo:[t],colorClearColor:[dO]}),o=this.getCanvas(),s=o.width,l=o.height;i.setPipeline(this.blitRenderPipeline),i.setBindings(this.blitBindings),i.setVertexInput(this.blitInputLayout,[{buffer:this.blitVertexBuffer}],null),i.setViewport(0,0,s,l),this.gl.disable(this.gl.BLEND),i.draw(3,0),this.gl.enable(this.gl.BLEND),this.currentRenderPassDescriptor=n,this.inBlitRenderPass=!1},e}(),hD=function(){function e(r){this.pluginOptions=r}return e.prototype.createSwapChain=function(r){return(0,wn.mG)(this,void 0,void 0,function(){var t,n,i,o,s,l,f,v,y,b,T;return(0,wn.Jh)(this,function(M){return t=this.pluginOptions,n=t.targets,i=t.xrCompatible,o=t.antialias,s=o===void 0?!1:o,l=t.preserveDrawingBuffer,f=l===void 0?!1:l,v=t.premultipliedAlpha,y=v===void 0?!0:v,b={antialias:s,preserveDrawingBuffer:f,stencil:!0,premultipliedAlpha:y,xrCompatible:i},this.handleContextEvents(r),n.includes("webgl2")&&(T=r.getContext("webgl2",b)||r.getContext("experimental-webgl2",b)),!T&&n.includes("webgl1")&&(T=r.getContext("webgl",b)||r.getContext("experimental-webgl",b)),[2,new fD(T,{shaderDebug:!0,trackResources:!0})]})})},e.prototype.handleContextEvents=function(r){var t=this.pluginOptions,n=t.onContextLost,i=t.onContextRestored,o=t.onContextCreationError;o&&r.addEventListener("webglcontextcreationerror",o,!1),n&&r.addEventListener("webglcontextlost",n,!1),i&&r.addEventListener("webglcontextrestored",i,!1)},e}();let gs;const HE=typeof TextDecoder!="undefined"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder!="undefined"&&HE.decode();let Fm=null;function o0(){return(Fm===null||Fm.byteLength===0)&&(Fm=new Uint8Array(gs.memory.buffer)),Fm}function s0(e,r){return e=e>>>0,HE.decode(o0().subarray(e,e+r))}const $h=new Array(128).fill(void 0);$h.push(void 0,null,!0,!1);let Bm=$h.length;function pD(e){Bm===$h.length&&$h.push($h.length+1);const r=Bm;return Bm=$h[r],$h[r]=e,r}function u0(e){return $h[e]}function dD(e){e<132||($h[e]=Bm,Bm=e)}function vD(e){const r=u0(e);return dD(e),r}let Lm=0;const l0=typeof TextEncoder!="undefined"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},mD=typeof l0.encodeInto=="function"?function(e,r){return l0.encodeInto(e,r)}:function(e,r){const t=l0.encode(e);return r.set(t),{read:e.length,written:t.length}};function I_(e,r,t){if(t===void 0){const l=l0.encode(e),f=r(l.length,1)>>>0;return o0().subarray(f,f+l.length).set(l),Lm=l.length,f}let n=e.length,i=r(n,1)>>>0;const o=o0();let s=0;for(;s<n;s++){const l=e.charCodeAt(s);if(l>127)break;o[i+s]=l}if(s!==n){s!==0&&(e=e.slice(s)),i=t(i,n,n=s+e.length*3,1)>>>0;const l=o0().subarray(i+s,i+n),f=mD(e,l);s+=f.written}return Lm=s,i}let Nm=null;function c0(){return(Nm===null||Nm.byteLength===0)&&(Nm=new Int32Array(gs.memory.buffer)),Nm}function gD(e,r,t){let n,i;try{const l=gs.__wbindgen_add_to_stack_pointer(-16),f=I_(e,gs.__wbindgen_malloc,gs.__wbindgen_realloc),v=Lm,y=I_(r,gs.__wbindgen_malloc,gs.__wbindgen_realloc),b=Lm;gs.glsl_compile(l,f,v,y,b,t);var o=c0()[l/4+0],s=c0()[l/4+1];return n=o,i=s,s0(o,s)}finally{gs.__wbindgen_add_to_stack_pointer(16),gs.__wbindgen_free(n,i,1)}}class Um{static __wrap(r){r=r>>>0;const t=Object.create(Um.prototype);return t.__wbg_ptr=r,t}__destroy_into_raw(){const r=this.__wbg_ptr;return this.__wbg_ptr=0,r}free(){const r=this.__destroy_into_raw();gs.__wbg_wgslcomposer_free(r)}constructor(){const r=gs.wgslcomposer_new();return Um.__wrap(r)}wgsl_compile(r){let t,n;try{const s=gs.__wbindgen_add_to_stack_pointer(-16),l=I_(r,gs.__wbindgen_malloc,gs.__wbindgen_realloc),f=Lm;gs.wgslcomposer_wgsl_compile(s,this.__wbg_ptr,l,f);var i=c0()[s/4+0],o=c0()[s/4+1];return t=i,n=o,s0(i,o)}finally{gs.__wbindgen_add_to_stack_pointer(16),gs.__wbindgen_free(t,n,1)}}}function _D(e,r){return Z_(this,null,function*(){if(typeof Response=="function"&&e instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return yield WebAssembly.instantiateStreaming(e,r)}catch(n){if(e.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=yield e.arrayBuffer();return yield WebAssembly.instantiate(t,r)}else{const t=yield WebAssembly.instantiate(e,r);return t instanceof WebAssembly.Instance?{instance:t,module:e}:t}})}function yD(){const e={};return e.wbg={},e.wbg.__wbindgen_string_new=function(r,t){const n=s0(r,t);return pD(n)},e.wbg.__wbindgen_object_drop_ref=function(r){vD(r)},e.wbg.__wbg_log_1d3ae0273d8f4f8a=function(r){console.log(u0(r))},e.wbg.__wbg_log_576ca876af0d4a77=function(r,t){console.log(u0(r),u0(t))},e.wbg.__wbindgen_throw=function(r,t){throw new Error(s0(r,t))},e}function xD(e,r){return gs=e.exports,WE.__wbindgen_wasm_module=r,Nm=null,Fm=null,gs}function WE(e){return Z_(this,null,function*(){if(gs!==void 0)return gs;const r=yD();(typeof e=="string"||typeof Request=="function"&&e instanceof Request||typeof URL=="function"&&e instanceof URL)&&(e=fetch(e));const{instance:t,module:n}=yield _D(yield e,r);return xD(t,n)})}var yl;(function(e){e[e.COPY_SRC=1]="COPY_SRC",e[e.COPY_DST=2]="COPY_DST",e[e.TEXTURE_BINDING=4]="TEXTURE_BINDING",e[e.STORAGE_BINDING=8]="STORAGE_BINDING",e[e.STORAGE=8]="STORAGE",e[e.RENDER_ATTACHMENT=16]="RENDER_ATTACHMENT"})(yl||(yl={}));var P_;(function(e){e[e.READ=1]="READ",e[e.WRITE=2]="WRITE"})(P_||(P_={}));function bD(e){var r=0;return e&Ec.SAMPLED&&(r|=yl.TEXTURE_BINDING|yl.COPY_DST),e&Ec.RENDER_TARGET&&(r|=yl.RENDER_ATTACHMENT|yl.TEXTURE_BINDING|yl.COPY_SRC|yl.COPY_DST),r}function O_(e){if(e===Tt.U8_R_NORM)return"r8unorm";if(e===Tt.U8_RG_NORM)return"rg8unorm";if(e===Tt.U8_RGBA_RT)return"bgra8unorm";if(e===Tt.U8_RGBA_RT_SRGB)return"bgra8unorm-srgb";if(e===Tt.U8_RGBA_NORM)return"rgba8unorm";if(e===Tt.U8_RGBA_SRGB)return"rgba8unorm-srgb";if(e===Tt.S8_R_NORM)return"r8snorm";if(e===Tt.S8_RG_NORM)return"rg8snorm";if(e===Tt.S8_RGBA_NORM)return"rgba8snorm";if(e===Tt.U32_R)return"r32uint";if(e===Tt.F16_RGBA)return"rgba16float";if(e===Tt.F32_RGBA)return"rgba32float";if(e===Tt.D24)return"depth24plus";if(e===Tt.D24_S8)return"depth24plus-stencil8";if(e===Tt.D32F)return"depth32float";if(e===Tt.D32F_S8)return"depth32float-stencil8";if(e===Tt.BC1)return"bc1-rgba-unorm";if(e===Tt.BC1_SRGB)return"bc1-rgba-unorm-srgb";if(e===Tt.BC2)return"bc2-rgba-unorm";if(e===Tt.BC2_SRGB)return"bc2-rgba-unorm-srgb";if(e===Tt.BC3)return"bc3-rgba-unorm";if(e===Tt.BC3_SRGB)return"bc3-rgba-unorm-srgb";if(e===Tt.BC4_SNORM)return"bc4-r-snorm";if(e===Tt.BC4_UNORM)return"bc4-r-unorm";if(e===Tt.BC5_SNORM)return"bc5-rg-snorm";if(e===Tt.BC5_UNORM)return"bc5-rg-unorm";throw"whoops"}function ED(e){if(e===Hi.TEXTURE_2D)return"2d";if(e===Hi.TEXTURE_CUBE_MAP)return"2d";if(e===Hi.TEXTURE_2D_ARRAY)return"2d";if(e===Hi.TEXTURE_3D)return"3d";throw new Error("whoops")}function SD(e){if(e===Hi.TEXTURE_2D)return"2d";if(e===Hi.TEXTURE_CUBE_MAP)return"cube";if(e===Hi.TEXTURE_2D_ARRAY)return"2d-array";if(e===Hi.TEXTURE_3D)return"3d";throw new Error("whoops")}function AD(e){var r=0;return e&ro.INDEX&&(r|=GPUBufferUsage.INDEX),e&ro.VERTEX&&(r|=GPUBufferUsage.VERTEX),e&ro.UNIFORM&&(r|=GPUBufferUsage.UNIFORM),e&ro.STORAGE&&(r|=GPUBufferUsage.STORAGE),e&ro.COPY_SRC&&(r|=GPUBufferUsage.COPY_SRC),r|=GPUBufferUsage.COPY_DST,r}function D_(e){if(e===gl.CLAMP_TO_EDGE)return"clamp-to-edge";if(e===gl.REPEAT)return"repeat";if(e===gl.MIRRORED_REPEAT)return"mirror-repeat";throw new Error("whoops")}function GE(e){if(e===vs.BILINEAR)return"linear";if(e===vs.POINT)return"nearest";throw new Error("whoops")}function TD(e){if(e===Gs.LINEAR)return"linear";if(e===Gs.NEAREST)return"nearest";if(e===Gs.NO_MIP)return"nearest";throw new Error("whoops")}function Iv(e){var r=e;return r.gpuBuffer}function wD(e){var r=e;return r.gpuSampler}function CD(e){var r=e;return r.querySet}function RD(e){if(e===Kg.OcclusionConservative)return"occlusion";throw new Error("whoops")}function MD(e){switch(e){case ms.TRIANGLES:return"triangle-list";case ms.POINTS:return"point-list";case ms.TRIANGLE_STRIP:return"triangle-strip";case ms.LINES:return"line-list";case ms.LINE_STRIP:return"line-strip";default:throw new Error("Unknown primitive topology mode")}}function ID(e){if(e===Wl.NONE)return"none";if(e===Wl.FRONT)return"front";if(e===Wl.BACK)return"back";throw new Error("whoops")}function PD(e){if(e===Im.CCW)return"ccw";if(e===Im.CW)return"cw";throw new Error("whoops")}function OD(e,r){return{topology:MD(e),cullMode:ID(r.cullMode),frontFace:PD(r.frontFace)}}function XE(e){if(e===ua.ZERO)return"zero";if(e===ua.ONE)return"one";if(e===ua.SRC)return"src";if(e===ua.ONE_MINUS_SRC)return"one-minus-src";if(e===ua.DST)return"dst";if(e===ua.ONE_MINUS_DST)return"one-minus-dst";if(e===ua.SRC_ALPHA)return"src-alpha";if(e===ua.ONE_MINUS_SRC_ALPHA)return"one-minus-src-alpha";if(e===ua.DST_ALPHA)return"dst-alpha";if(e===ua.ONE_MINUS_DST_ALPHA)return"one-minus-dst-alpha";if(e===ua.CONST)return"constant";if(e===ua.ONE_MINUS_CONSTANT)return"one-minus-constant";if(e===ua.SRC_ALPHA_SATURATE)return"src-alpha-saturated";throw new Error("whoops")}function DD(e){if(e===Tu.ADD)return"add";if(e===Tu.SUBSTRACT)return"subtract";if(e===Tu.REVERSE_SUBSTRACT)return"reverse-subtract";if(e===Tu.MIN)return"min";if(e===Tu.MAX)return"max";throw new Error("whoops")}function $E(e){return{operation:DD(e.blendMode),srcFactor:XE(e.blendSrcFactor),dstFactor:XE(e.blendDstFactor)}}function YE(e){return e.blendMode===Tu.ADD&&e.blendSrcFactor===ua.ONE&&e.blendDstFactor===ua.ZERO}function kD(e){if(!(YE(e.rgbBlendState)&&YE(e.alphaBlendState)))return{color:$E(e.rgbBlendState),alpha:$E(e.alphaBlendState)}}function FD(e,r){return{format:O_(r),blend:kD(e),writeMask:e.channelWriteMask}}function BD(e,r){return r.attachmentsState.map(function(t,n){return FD(t,e[n])})}function f0(e){if(e===_a.NEVER)return"never";if(e===_a.LESS)return"less";if(e===_a.EQUAL)return"equal";if(e===_a.LEQUAL)return"less-equal";if(e===_a.GREATER)return"greater";if(e===_a.NOTEQUAL)return"not-equal";if(e===_a.GEQUAL)return"greater-equal";if(e===_a.ALWAYS)return"always";throw new Error("whoops")}function Pv(e){if(e===qu.KEEP)return"keep";if(e===qu.REPLACE)return"replace";if(e===qu.ZERO)return"zero";if(e===qu.DECREMENT_CLAMP)return"decrement-clamp";if(e===qu.DECREMENT_WRAP)return"decrement-wrap";if(e===qu.INCREMENT_CLAMP)return"increment-clamp";if(e===qu.INCREMENT_WRAP)return"increment-wrap";if(e===qu.INVERT)return"invert";throw new Error("whoops")}function LD(e,r){if(!(0,Bp.Z)(e))return{format:O_(e),depthWriteEnabled:!!r.depthWrite,depthCompare:f0(r.depthCompare),depthBias:r.polygonOffset?1:0,depthBiasSlopeScale:r.polygonOffset?1:0,stencilFront:{compare:f0(r.stencilFront.compare),passOp:Pv(r.stencilFront.passOp),failOp:Pv(r.stencilFront.failOp),depthFailOp:Pv(r.stencilFront.depthFailOp)},stencilBack:{compare:f0(r.stencilBack.compare),passOp:Pv(r.stencilBack.passOp),failOp:Pv(r.stencilBack.failOp),depthFailOp:Pv(r.stencilBack.depthFailOp)},stencilReadMask:1,stencilWriteMask:1}}function ND(e){if(e!==null){if(e===Tt.U16_R)return"uint16";if(e===Tt.U32_R)return"uint32";throw new Error("whoops")}}function UD(e){if(e===Sd.VERTEX)return"vertex";if(e===Sd.INSTANCE)return"instance";throw new Error("whoops")}function zD(e){if(e===Tt.U8_R)return"uint8x2";if(e===Tt.U8_RG)return"uint8x2";if(e===Tt.U8_RGB)return"uint8x4";if(e===Tt.U8_RGBA)return"uint8x4";if(e===Tt.U8_RG_NORM)return"unorm8x2";if(e===Tt.U8_RGBA_NORM)return"unorm8x4";if(e===Tt.S8_RGB_NORM)return"snorm8x4";if(e===Tt.S8_RGBA_NORM)return"snorm8x4";if(e===Tt.U16_RG_NORM)return"unorm16x2";if(e===Tt.U16_RGBA_NORM)return"unorm16x4";if(e===Tt.S16_RG_NORM)return"snorm16x2";if(e===Tt.S16_RGBA_NORM)return"snorm16x4";if(e===Tt.S16_RG)return"uint16x2";if(e===Tt.F16_RG)return"float16x2";if(e===Tt.F16_RGBA)return"float16x4";if(e===Tt.F32_R)return"float32";if(e===Tt.F32_RG)return"float32x2";if(e===Tt.F32_RGB)return"float32x3";if(e===Tt.F32_RGBA)return"float32x4";throw"whoops"}function ZD(e){var r=ch(e);switch(r){case Cr.BC1:case Cr.BC2:case Cr.BC3:case Cr.BC4_SNORM:case Cr.BC4_UNORM:case Cr.BC5_SNORM:case Cr.BC5_UNORM:return!0;default:return!1}}function VD(e){var r=ch(e);switch(r){case Cr.BC1:case Cr.BC2:case Cr.BC3:case Cr.BC4_SNORM:case Cr.BC4_UNORM:case Cr.BC5_SNORM:case Cr.BC5_UNORM:return 4;default:return 1}}function qE(e,r,t,n){switch(t===void 0&&(t=!1),e){case Tt.S8_R:case Tt.S8_R_NORM:case Tt.S8_RG_NORM:case Tt.S8_RGB_NORM:case Tt.S8_RGBA_NORM:{var i=r instanceof ArrayBuffer?new Int8Array(r):new Int8Array(r);return n&&i.set(new Int8Array(n)),i}case Tt.U8_R:case Tt.U8_R_NORM:case Tt.U8_RG:case Tt.U8_RG_NORM:case Tt.U8_RGB:case Tt.U8_RGB_NORM:case Tt.U8_RGB_SRGB:case Tt.U8_RGBA:case Tt.U8_RGBA_NORM:case Tt.U8_RGBA_SRGB:{var o=r instanceof ArrayBuffer?new Uint8Array(r):new Uint8Array(r);return n&&o.set(new Uint8Array(n)),o}case Tt.S16_R:case Tt.S16_RG:case Tt.S16_RG_NORM:case Tt.S16_RGB_NORM:case Tt.S16_RGBA:case Tt.S16_RGBA_NORM:{var s=r instanceof ArrayBuffer?new Int16Array(r):new Int16Array(t?r/2:r);return n&&s.set(new Int16Array(n)),s}case Tt.U16_R:case Tt.U16_RGB:case Tt.U16_RGBA_5551:case Tt.U16_RGBA_NORM:case Tt.U16_RG_NORM:case Tt.U16_R_NORM:{var l=r instanceof ArrayBuffer?new Uint16Array(r):new Uint16Array(t?r/2:r);return n&&l.set(new Uint16Array(n)),l}case Tt.S32_R:{var f=r instanceof ArrayBuffer?new Int32Array(r):new Int32Array(t?r/4:r);return n&&f.set(new Int32Array(n)),f}case Tt.U32_R:case Tt.U32_RG:{var v=r instanceof ArrayBuffer?new Uint32Array(r):new Uint32Array(t?r/4:r);return n&&v.set(new Uint32Array(n)),v}case Tt.F32_R:case Tt.F32_RG:case Tt.F32_RGB:case Tt.F32_RGBA:{var y=r instanceof ArrayBuffer?new Float32Array(r):new Float32Array(t?r/4:r);return n&&y.set(new Float32Array(n)),y}}var b=r instanceof ArrayBuffer?new Uint8Array(r):new Uint8Array(r);return n&&b.set(new Uint8Array(n)),b}function jD(e){var r=(e&32768)>>15,t=(e&31744)>>10,n=e&1023;return t===0?(r?-1:1)*Math.pow(2,-14)*(n/Math.pow(2,10)):t==31?n?NaN:(r?-1:1)*(1/0):(r?-1:1)*Math.pow(2,t-15)*(1+n/Math.pow(2,10))}var fh=function(e){(0,wn.ZT)(r,e);function r(t){var n=t.id,i=t.device,o=e.call(this)||this;return o.id=n,o.device=i,o}return r.prototype.destroy=function(){},r}(bE.Z),HD=function(e){(0,wn.ZT)(r,e);function r(t){var n=t.id,i=t.device,o=t.descriptor,s=e.call(this,{id:n,device:i})||this;s.type=ya.Bindings;var l=o.pipeline;Di(!!l);var f=o.uniformBufferBindings,v=o.storageBufferBindings,y=o.samplerBindings;s.numUniformBuffers=(f==null?void 0:f.length)||0;var b=[[],[]],T=0;if(v&&v.length)for(var M=0;M<v.length;M++){var O=o.storageBufferBindings[M],k=O.binding,$=O.size,G=O.offset,oe=O.buffer,ye={buffer:Iv(oe),offset:G!=null?G:0,size:$};b[0].push({binding:k!=null?k:T++,resource:ye})}if(f&&f.length)for(var M=0;M<f.length;M++){var Le=o.uniformBufferBindings[M],k=Le.binding,$=Le.size,G=Le.offset,oe=Le.buffer,ye={buffer:Iv(oe),offset:G!=null?G:0,size:$};b[0].push({binding:k!=null?k:T++,resource:ye})}if(y&&y.length){T=0;for(var M=0;M<y.length;M++){var $e=(0,wn.pi)((0,wn.pi)({},y[M]),OE),k=o.samplerBindings[M],ut=k.texture!==null?k.texture:s.device.getFallbackTexture($e);$e.dimension=ut.dimension,$e.formatKind=TE(ut.format);var vt=ut.gpuTextureView;b[1].push({binding:T++,resource:vt});var Rt=k.sampler!==null?k.sampler:s.device.getFallbackSampler($e),Jt=wD(Rt);b[1].push({binding:T++,resource:Jt})}}return s.gpuBindGroup=b.filter(function(Mr){return Mr.length>0}).map(function(Mr,br){return s.device.device.createBindGroup({layout:l.getBindGroupLayout(br),entries:Mr})}),s}return r}(fh),WD=function(e){(0,wn.ZT)(r,e);function r(t){var n=t.id,i=t.device,o=t.descriptor,s=e.call(this,{id:n,device:i})||this;s.type=ya.Buffer;var l=o.usage,f=o.viewOrSize,v=!!(l&ro.MAP_READ);s.usage=AD(l),v&&(s.usage=ro.MAP_READ|ro.COPY_DST);var y=!(0,xv.Z)(f);if(s.view=(0,xv.Z)(f)?null:f,s.size=(0,xv.Z)(f)?t0(f,4):t0(f.byteLength,4),(0,xv.Z)(f))s.gpuBuffer=s.device.device.createBuffer({usage:s.usage,size:s.size,mappedAtCreation:v?y:!1});else{s.gpuBuffer=s.device.device.createBuffer({usage:s.usage,size:s.size,mappedAtCreation:!0});var b=f&&f.constructor||Float32Array;new b(s.gpuBuffer.getMappedRange()).set(f),s.gpuBuffer.unmap()}return s}return r.prototype.setSubData=function(t,n,i,o){i===void 0&&(i=0),o===void 0&&(o=0);var s=this.gpuBuffer;o=o||n.byteLength,o=Math.min(o,this.size-t);var l=n.byteOffset+i,f=l+o,v=o+3&-4;if(v!==o){var y=new Uint8Array(n.buffer.slice(l,f));n=new Uint8Array(v),n.set(y),i=0,l=0,f=v,o=v}for(var b=1024*1024*15,T=0;f-(l+T)>b;)this.device.device.queue.writeBuffer(s,t+T,n.buffer,l+T,b),T+=b;this.device.device.queue.writeBuffer(s,t+T,n.buffer,l+T,o-T)},r.prototype.destroy=function(){e.prototype.destroy.call(this),this.gpuBuffer.destroy()},r}(fh),GD=function(){function e(){this.commandEncoder=null,this.gpuComputePassEncoder=null}return e.prototype.dispatchWorkgroups=function(r,t,n){this.gpuComputePassEncoder.dispatchWorkgroups(r,t,n)},e.prototype.dispatchWorkgroupsIndirect=function(r,t){this.gpuComputePassEncoder.dispatchWorkgroupsIndirect(r.gpuBuffer,t)},e.prototype.finish=function(){return this.gpuComputePassEncoder.end(),this.gpuComputePassEncoder=null,this.commandEncoder.finish()},e.prototype.beginComputePass=function(){Di(this.gpuComputePassEncoder===null),this.gpuComputePassEncoder=this.commandEncoder.beginComputePass(this.gpuComputePassDescriptor)},e.prototype.setPipeline=function(r){var t=r,n=Ad(t.gpuComputePipeline);this.gpuComputePassEncoder.setPipeline(n)},e.prototype.setBindings=function(r){var t=r;this.gpuComputePassEncoder.setBindGroup(0,t.gpuBindGroup[0])},e.prototype.pushDebugGroup=function(r){this.gpuComputePassEncoder.pushDebugGroup(r)},e.prototype.popDebugGroup=function(){this.gpuComputePassEncoder.popDebugGroup()},e.prototype.insertDebugMarker=function(r){this.gpuComputePassEncoder.insertDebugMarker(r)},e}(),XD=function(e){(0,wn.ZT)(r,e);function r(t){var n=t.id,i=t.device,o=t.descriptor,s=e.call(this,{id:n,device:i})||this;s.type=ya.ComputePipeline,s.gpuComputePipeline=null,s.descriptor=o;var l=o.program,f=l.computeStage;if(f===null)return s;var v={layout:"auto",compute:(0,wn.pi)({},f)};return s.gpuComputePipeline=s.device.device.createComputePipeline(v),s.name!==void 0&&(s.gpuComputePipeline.label=s.name),s}return r.prototype.getBindGroupLayout=function(t){return this.gpuComputePipeline.getBindGroupLayout(t)},r}(fh),$D=function(e){(0,wn.ZT)(r,e);function r(t){var n,i,o,s,l=t.id,f=t.device,v=t.descriptor,y=e.call(this,{id:l,device:f})||this;y.type=ya.InputLayout;var b=[];try{for(var T=(0,wn.XA)(v.vertexBufferDescriptors),M=T.next();!M.done;M=T.next()){var O=M.value,k=O.arrayStride,$=O.stepMode,G=O.attributes;b.push({arrayStride:k,stepMode:UD($),attributes:[]});try{for(var oe=(o=void 0,(0,wn.XA)(G)),ye=oe.next();!ye.done;ye=oe.next()){var Le=ye.value,$e=Le.shaderLocation,ut=Le.format,vt=Le.offset;b[b.length-1].attributes.push({shaderLocation:$e,format:zD(ut),offset:vt})}}catch(Rt){o={error:Rt}}finally{try{ye&&!ye.done&&(s=oe.return)&&s.call(oe)}finally{if(o)throw o.error}}}}catch(Rt){n={error:Rt}}finally{try{M&&!M.done&&(i=T.return)&&i.call(T)}finally{if(n)throw n.error}}return y.indexFormat=ND(v.indexBufferFormat),y.buffers=b,y}return r}(fh),KE=function(e){(0,wn.ZT)(r,e);function r(t){var n=t.id,i=t.device,o=t.descriptor,s=e.call(this,{id:n,device:i})||this;return s.type=ya.Program,s.vertexStage=null,s.fragmentStage=null,s.computeStage=null,s.descriptor=o,o.vertex&&(s.vertexStage=s.createShaderStage(o.vertex,"vertex")),o.fragment&&(s.fragmentStage=s.createShaderStage(o.fragment,"fragment")),o.compute&&(s.computeStage=s.createShaderStage(o.compute,"compute")),s}return r.prototype.setUniformsLegacy=function(t){},r.prototype.createShaderStage=function(t,n){var i,o,s=t.glsl,l=t.wgsl,f=t.entryPoint,v=!1,y=l;if(!y)try{y=this.device.glsl_compile(s,n,v)}catch($){throw console.error($,s),new Error("whoops")}var b=function($){if(!y.includes($))return"continue";y=y.replace("var T_".concat($,": texture_2d<f32>;"),"var T_".concat($,": texture_depth_2d;")),y=y.replace(new RegExp("textureSample\\(T_".concat($,"(.*)\\);$"),"gm"),function(G,oe){return"vec4<f32>(textureSample(T_".concat($).concat(oe,"), 0.0, 0.0, 0.0);")})};try{for(var T=(0,wn.XA)(["u_TextureFramebufferDepth"]),M=T.next();!M.done;M=T.next()){var O=M.value;b(O)}}catch($){i={error:$}}finally{try{M&&!M.done&&(o=T.return)&&o.call(T)}finally{if(i)throw i.error}}var k=this.device.device.createShaderModule({code:y});return{module:k,entryPoint:f||"main"}},r}(fh),YD=function(e){(0,wn.ZT)(r,e);function r(t){var n=t.id,i=t.device,o=t.descriptor,s=e.call(this,{id:n,device:i})||this;s.type=ya.QueryPool;var l=o.elemCount,f=o.type;return s.querySet=s.device.device.createQuerySet({type:RD(f),count:l}),s.resolveBuffer=s.device.device.createBuffer({size:l*8,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),s.cpuBuffer=s.device.device.createBuffer({size:l*8,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),s.results=null,s}return r.prototype.queryResultOcclusion=function(t){return this.results===null?null:this.results[t]!==BigInt(0)},r.prototype.destroy=function(){e.prototype.destroy.call(this),this.querySet.destroy(),this.resolveBuffer.destroy(),this.cpuBuffer.destroy()},r}(fh),qD=function(e){(0,wn.ZT)(r,e);function r(t){var n=t.id,i=t.device,o=e.call(this,{id:n,device:i})||this;return o.type=ya.Readback,o}return r.prototype.readTexture=function(t,n,i,o,s,l,f,v){return f===void 0&&(f=0),(0,wn.mG)(this,void 0,void 0,function(){var y,b,T,M,O,k,$,G;return(0,wn.Jh)(this,function(oe){return y=t,b=0,T=this.getBlockInformationFromFormat(y.gpuTextureformat),M=Math.ceil(o/T.width)*T.length,O=Math.ceil(M/256)*256,k=O*s,$=this.device.createBuffer({usage:ro.STORAGE|ro.MAP_READ|ro.COPY_DST,hint:Af.STATIC,viewOrSize:k}),G=this.device.device.createCommandEncoder(),G.copyTextureToBuffer({texture:y.gpuTexture,mipLevel:0,origin:{x:n,y:i,z:Math.max(b,0)}},{buffer:$.gpuBuffer,offset:0,bytesPerRow:O},{width:o,height:s,depthOrArrayLayers:1}),this.device.device.queue.submit([G.finish()]),[2,this.readBuffer($,0,l.byteLength===k?l:null,f,k,y.format)]})})},r.prototype.readTextureSync=function(t,n,i,o,s,l,f,v){throw new Error("ERROR_MSG_METHOD_NOT_IMPLEMENTED")},r.prototype.readBuffer=function(t,n,i,o,s,l,f,v){var y=this;n===void 0&&(n=0),i===void 0&&(i=null),s===void 0&&(s=0),l===void 0&&(l=Tt.U8_RGB),f===void 0&&(f=!1);var b=t,T=s||b.size,M=i||b.view,O=M&&M.constructor&&M.constructor.BYTES_PER_ELEMENT||AE(l),k=b;if(!(b.usage&ro.MAP_READ&&b.usage&ro.COPY_DST)){var $=this.device.device.createCommandEncoder();k=this.device.createBuffer({usage:ro.STORAGE|ro.MAP_READ|ro.COPY_DST,hint:Af.STATIC,viewOrSize:T}),$.copyBufferToBuffer(b.gpuBuffer,n,k.gpuBuffer,0,T),this.device.device.queue.submit([$.finish()])}return new Promise(function(G,oe){k.gpuBuffer.mapAsync(P_.READ,n,T).then(function(){var ye=k.gpuBuffer.getMappedRange(n,T),Le=M;if(f)Le===null?Le=qE(l,T,!0,ye):Le=qE(l,Le.buffer,void 0,ye);else if(Le===null)switch(O){case 1:Le=new Uint8Array(T),Le.set(new Uint8Array(ye));break;case 2:Le=y.getHalfFloatAsFloatRGBAArrayBuffer(T/2,ye);break;case 4:Le=new Float32Array(T/4),Le.set(new Float32Array(ye));break}else switch(O){case 1:Le=new Uint8Array(Le.buffer),Le.set(new Uint8Array(ye));break;case 2:Le=y.getHalfFloatAsFloatRGBAArrayBuffer(T/2,ye,M);break;case 4:var $e=M&&M.constructor||Float32Array;Le=new $e(Le.buffer),Le.set(new $e(ye));break}k.gpuBuffer.unmap(),G(Le)},function(ye){return oe(ye)})})},r.prototype.getHalfFloatAsFloatRGBAArrayBuffer=function(t,n,i){i||(i=new Float32Array(t));for(var o=new Uint16Array(n);t--;)i[t]=jD(o[t]);return i},r.prototype.getBlockInformationFromFormat=function(t){switch(t){case"r8unorm":case"r8snorm":case"r8uint":case"r8sint":return{width:1,height:1,length:1};case"r16uint":case"r16sint":case"r16float":case"rg8unorm":case"rg8snorm":case"rg8uint":case"rg8sint":return{width:1,height:1,length:2};case"r32uint":case"r32sint":case"r32float":case"rg16uint":case"rg16sint":case"rg16float":case"rgba8unorm":case"rgba8unorm-srgb":case"rgba8snorm":case"rgba8uint":case"rgba8sint":case"bgra8unorm":case"bgra8unorm-srgb":case"rgb9e5ufloat":case"rgb10a2unorm":case"rg11b10ufloat":return{width:1,height:1,length:4};case"rg32uint":case"rg32sint":case"rg32float":case"rgba16uint":case"rgba16sint":case"rgba16float":return{width:1,height:1,length:8};case"rgba32uint":case"rgba32sint":case"rgba32float":return{width:1,height:1,length:16};case"stencil8":throw new Error("No fixed size for Stencil8 format!");case"depth16unorm":return{width:1,height:1,length:2};case"depth24plus":throw new Error("No fixed size for Depth24Plus format!");case"depth24plus-stencil8":throw new Error("No fixed size for Depth24PlusStencil8 format!");case"depth32float":return{width:1,height:1,length:4};case"depth32float-stencil8":return{width:1,height:1,length:5};case"bc7-rgba-unorm":case"bc7-rgba-unorm-srgb":case"bc6h-rgb-ufloat":case"bc6h-rgb-float":case"bc2-rgba-unorm":case"bc2-rgba-unorm-srgb":case"bc3-rgba-unorm":case"bc3-rgba-unorm-srgb":case"bc5-rg-unorm":case"bc5-rg-snorm":return{width:4,height:4,length:16};case"bc4-r-unorm":case"bc4-r-snorm":case"bc1-rgba-unorm":case"bc1-rgba-unorm-srgb":return{width:4,height:4,length:8};default:return{width:1,height:1,length:4}}},r}(fh),KD=function(){function e(r){this.device=r,this.commandEncoder=null,this.gpuRenderPassEncoder=null,this.gfxColorAttachment=[],this.gfxColorAttachmentLevel=[],this.gfxColorResolveTo=[],this.gfxColorResolveToLevel=[],this.gfxDepthStencilAttachment=null,this.gfxDepthStencilResolveTo=null,this.gpuColorAttachments=[],this.gpuDepthStencilAttachment={view:null,depthLoadOp:"load",depthStoreOp:"store",stencilLoadOp:"load",stencilStoreOp:"store"},this.gpuRenderPassDescriptor={colorAttachments:this.gpuColorAttachments,depthStencilAttachment:this.gpuDepthStencilAttachment}}return e.prototype.getTextureView=function(r,t){return Di(t<r.mipLevelCount),r.mipLevelCount===1?r.gpuTextureView:r.gpuTexture.createView({baseMipLevel:t,mipLevelCount:1})},e.prototype.setRenderPassDescriptor=function(r){var t,n,i,o,s,l;this.descriptor=r,this.gpuRenderPassDescriptor.colorAttachments=this.gpuColorAttachments;var f=r.colorAttachment.length;this.gfxColorAttachment.length=f,this.gfxColorResolveTo.length=f;for(var v=0;v<r.colorAttachment.length;v++){var y=r.colorAttachment[v],b=r.colorResolveTo[v];if(y===null&&b!==null&&(y=b,b=null),this.gfxColorAttachment[v]=y,this.gfxColorResolveTo[v]=b,this.gfxColorAttachmentLevel[v]=((t=r.colorAttachmentLevel)===null||t===void 0?void 0:t[v])||0,this.gfxColorResolveToLevel[v]=((n=r.colorResolveToLevel)===null||n===void 0?void 0:n[v])||0,y!==null){this.gpuColorAttachments[v]===void 0&&(this.gpuColorAttachments[v]={});var T=this.gpuColorAttachments[v];T.view=this.getTextureView(y,((i=this.gfxColorAttachmentLevel)===null||i===void 0?void 0:i[v])||0);var M=(s=(o=r.colorClearColor)===null||o===void 0?void 0:o[v])!==null&&s!==void 0?s:"load";M==="load"?T.loadOp="load":(T.loadOp="clear",T.clearValue=M),T.storeOp=!((l=r.colorStore)===null||l===void 0)&&l[v]?"store":"discard",T.resolveTarget=void 0,b!==null&&(y.sampleCount>1?T.resolveTarget=this.getTextureView(b,this.gfxColorResolveToLevel[v]):T.storeOp="store")}else{this.gpuColorAttachments.length=v,this.gfxColorAttachment.length=v,this.gfxColorResolveTo.length=v;break}}if(this.gfxDepthStencilAttachment=r.depthStencilAttachment,this.gfxDepthStencilResolveTo=r.depthStencilResolveTo,r.depthStencilAttachment){var O=r.depthStencilAttachment,T=this.gpuDepthStencilAttachment;T.view=O.gpuTextureView;var k=!!(Sv(O.format)&An.Depth);k?(r.depthClearValue==="load"?T.depthLoadOp="load":(T.depthLoadOp="clear",T.depthClearValue=r.depthClearValue),r.depthStencilStore||this.gfxDepthStencilResolveTo!==null?T.depthStoreOp="store":T.depthStoreOp="discard"):(T.depthLoadOp=void 0,T.depthStoreOp=void 0);var $=!!(Sv(O.format)&An.Stencil);$?(r.stencilClearValue==="load"?T.stencilLoadOp="load":(T.stencilLoadOp="clear",T.stencilClearValue=r.stencilClearValue),r.depthStencilStore||this.gfxDepthStencilResolveTo!==null?T.stencilStoreOp="store":T.stencilStoreOp="discard"):(T.stencilLoadOp=void 0,T.stencilStoreOp=void 0),this.gpuRenderPassDescriptor.depthStencilAttachment=this.gpuDepthStencilAttachment}else this.gpuRenderPassDescriptor.depthStencilAttachment=void 0;this.gpuRenderPassDescriptor.occlusionQuerySet=(0,Bp.Z)(r.occlusionQueryPool)?void 0:CD(r.occlusionQueryPool)},e.prototype.beginRenderPass=function(r){Di(this.gpuRenderPassEncoder===null),this.setRenderPassDescriptor(r),this.gpuRenderPassEncoder=this.commandEncoder.beginRenderPass(this.gpuRenderPassDescriptor)},e.prototype.flipY=function(r,t){var n=this.device.swapChainHeight;return n-r-t},e.prototype.setViewport=function(r,t,n,i,o,s){o===void 0&&(o=0),s===void 0&&(s=1),this.gpuRenderPassEncoder.setViewport(r,this.flipY(t,i),n,i,o,s)},e.prototype.setScissorRect=function(r,t,n,i){this.gpuRenderPassEncoder.setScissorRect(r,this.flipY(t,i),n,i)},e.prototype.setPipeline=function(r){var t=r,n=Ad(t.gpuRenderPipeline);this.gpuRenderPassEncoder.setPipeline(n)},e.prototype.setVertexInput=function(r,t,n){if(r!==null){var i=r;n!==null&&this.gpuRenderPassEncoder.setIndexBuffer(Iv(n.buffer),Ad(i.indexFormat),n.offset);for(var o=0;o<t.length;o++){var s=t[o];s!==null&&this.gpuRenderPassEncoder.setVertexBuffer(o,Iv(s.buffer),s.offset)}}},e.prototype.setBindings=function(r){var t=r;this.gpuRenderPassEncoder.setBindGroup(0,t.gpuBindGroup[0]),t.gpuBindGroup[1]&&this.gpuRenderPassEncoder.setBindGroup(1,t.gpuBindGroup[1])},e.prototype.setStencilReference=function(r){this.gpuRenderPassEncoder.setStencilReference(r)},e.prototype.draw=function(r,t,n,i){this.gpuRenderPassEncoder.draw(r,t,n,i)},e.prototype.drawIndexed=function(r,t,n,i,o){this.gpuRenderPassEncoder.drawIndexed(r,t,n,i,o)},e.prototype.drawIndirect=function(r,t){this.gpuRenderPassEncoder.drawIndirect(Iv(r),t)},e.prototype.drawIndexedIndirect=function(r,t){this.gpuRenderPassEncoder.drawIndexedIndirect(Iv(r),t)},e.prototype.beginOcclusionQuery=function(r){this.gpuRenderPassEncoder.beginOcclusionQuery(r)},e.prototype.endOcclusionQuery=function(){this.gpuRenderPassEncoder.endOcclusionQuery()},e.prototype.pushDebugGroup=function(r){this.gpuRenderPassEncoder.pushDebugGroup(r)},e.prototype.popDebugGroup=function(){this.gpuRenderPassEncoder.popDebugGroup()},e.prototype.insertDebugMarker=function(r){this.gpuRenderPassEncoder.insertDebugMarker(r)},e.prototype.finish=function(){this.gpuRenderPassEncoder.end(),this.gpuRenderPassEncoder=null;for(var r=0;r<this.gfxColorAttachment.length;r++){var t=this.gfxColorAttachment[r],n=this.gfxColorResolveTo[r];t!==null&&n!==null&&t.sampleCount===1&&this.copyAttachment(n,this.gfxColorAttachmentLevel[r],t,this.gfxColorResolveToLevel[r])}return this.gfxDepthStencilAttachment&&this.gfxDepthStencilResolveTo&&(this.gfxDepthStencilAttachment.sampleCount>1||this.copyAttachment(this.gfxDepthStencilResolveTo,0,this.gfxDepthStencilAttachment,0)),this.commandEncoder.finish()},e.prototype.copyAttachment=function(r,t,n,i){Di(n.sampleCount===1);var o={texture:n.gpuTexture,mipLevel:i},s={texture:r.gpuTexture,mipLevel:t};Di(n.width>>>i===r.width>>>t),Di(n.height>>>i===r.height>>>t),Di(!!(n.usage&yl.COPY_SRC)),Di(!!(r.usage&yl.COPY_DST)),this.commandEncoder.copyTextureToTexture(o,s,[r.width,r.height,1])},e}(),QD=function(e){(0,wn.ZT)(r,e);function r(t){var n=t.id,i=t.device,o=t.descriptor,s=e.call(this,{id:n,device:i})||this;return s.type=ya.RenderPipeline,s.isCreatingAsync=!1,s.gpuRenderPipeline=null,s.descriptor=o,s.device.createRenderPipelineInternal(s,!1),s}return r.prototype.getBindGroupLayout=function(t){return this.gpuRenderPipeline.getBindGroupLayout(t)},r}(fh),JD=function(e){(0,wn.ZT)(r,e);function r(t){var n=t.id,i=t.device,o=t.descriptor,s,l,f=e.call(this,{id:n,device:i})||this;f.type=ya.Sampler;var v=o.lodMinClamp,y=o.mipmapFilter===Gs.NO_MIP?o.lodMinClamp:o.lodMaxClamp,b=(s=o.maxAnisotropy)!==null&&s!==void 0?s:1;return b>1&&Di(o.minFilter===vs.BILINEAR&&o.magFilter===vs.BILINEAR&&o.mipmapFilter===Gs.LINEAR),f.gpuSampler=f.device.device.createSampler({addressModeU:D_(o.addressModeU),addressModeV:D_(o.addressModeV),addressModeW:D_((l=o.addressModeW)!==null&&l!==void 0?l:o.addressModeU),lodMinClamp:v,lodMaxClamp:y,minFilter:GE(o.minFilter),magFilter:GE(o.magFilter),mipmapFilter:TD(o.mipmapFilter),compare:o.compareFunction!==void 0?f0(o.compareFunction):void 0,maxAnisotropy:b}),f}return r}(fh),h0=function(e){(0,wn.ZT)(r,e);function r(t){var n=t.id,i=t.device,o=t.descriptor,s=t.skipCreate,l=t.sampleCount,f=e.call(this,{id:n,device:i})||this;f.type=ya.Texture;var v=o.format,y=o.dimension,b=o.width,T=o.height,M=o.depthOrArrayLayers,O=o.mipLevelCount,k=o.usage;return f.device.createTextureShared({format:v,dimension:y!=null?y:Hi.TEXTURE_2D,width:b,height:T,depthOrArrayLayers:M!=null?M:1,mipLevelCount:O!=null?O:1,usage:k,sampleCount:l!=null?l:1},f,s),f}return r.prototype.textureFromImageBitmapOrCanvas=function(t,n,i){for(var o=n[0].width,s=n[0].height,l={size:{width:o,height:s,depthOrArrayLayers:i},format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT},f=t.createTexture(l),v=0;v<n.length;v++)t.queue.copyExternalImageToTexture({source:n[v]},{texture:f,origin:[0,0,v]},[o,s]);return[f,o,s]},r.prototype.isImageBitmapOrCanvases=function(t){var n=t[0];return n instanceof ImageBitmap||n instanceof HTMLCanvasElement||n instanceof OffscreenCanvas},r.prototype.isVideo=function(t){var n=t[0];return n instanceof HTMLVideoElement},r.prototype.setImageData=function(t,n){var i,o=this.device.device,s,l,f;this.isImageBitmapOrCanvases(t)?(i=(0,wn.CR)(this.textureFromImageBitmapOrCanvas(o,t,this.depthOrArrayLayers),3),s=i[0],l=i[1],f=i[2]):this.isVideo(t)&&(s=o.importExternalTexture({source:t[0]})),this.width=l,this.height=f,this.gpuTexture=s,this.gpuTextureView=s.createView({dimension:SD(this.dimension)})},r.prototype.destroy=function(){e.prototype.destroy.call(this),this.gpuTexture.destroy()},r}(fh),ek=function(){function e(r,t,n,i,o,s){this.swapChainWidth=0,this.swapChainHeight=0,this.swapChainTextureUsage=yl.RENDER_ATTACHMENT|yl.COPY_DST,this._resourceUniqueId=0,this.renderPassPool=[],this.computePassPool=[],this.featureTextureCompressionBC=!1,this.platformString="WebGPU",this.glslVersion="#version 440",this.explicitBindingLocations=!0,this.separateSamplerTextures=!0,this.viewportOrigin=bv.UPPER_LEFT,this.clipSpaceNearZ=Ev.ZERO,this.supportsSyncPipelineCompilation=!1,this.supportMRT=!0,this.device=t,this.canvas=n,this.canvasContext=i,this.glsl_compile=o,this.WGSLComposer=s,this.fallbackTexture2D=this.createFallbackTexture(Hi.TEXTURE_2D,zo.Float),this.setResourceName(this.fallbackTexture2D,"Fallback Texture2D"),this.fallbackTexture2DDepth=this.createFallbackTexture(Hi.TEXTURE_2D,zo.Depth),this.setResourceName(this.fallbackTexture2DDepth,"Fallback Depth Texture2D"),this.fallbackTexture2DArray=this.createFallbackTexture(Hi.TEXTURE_2D_ARRAY,zo.Float),this.setResourceName(this.fallbackTexture2DArray,"Fallback Texture2DArray"),this.fallbackTexture3D=this.createFallbackTexture(Hi.TEXTURE_3D,zo.Float),this.setResourceName(this.fallbackTexture3D,"Fallback Texture3D"),this.fallbackTextureCube=this.createFallbackTexture(Hi.TEXTURE_CUBE_MAP,zo.Float),this.setResourceName(this.fallbackTextureCube,"Fallback TextureCube"),this.fallbackSamplerFiltering=this.createSampler({addressModeU:gl.REPEAT,addressModeV:gl.REPEAT,minFilter:vs.POINT,magFilter:vs.POINT,mipmapFilter:Gs.NEAREST}),this.setResourceName(this.fallbackSamplerFiltering,"Fallback Sampler Filtering"),this.fallbackSamplerComparison=this.createSampler({addressModeU:gl.REPEAT,addressModeV:gl.REPEAT,minFilter:vs.POINT,magFilter:vs.POINT,mipmapFilter:Gs.NEAREST,compareFunction:_a.ALWAYS}),this.setResourceName(this.fallbackSamplerComparison,"Fallback Sampler Comparison Filtering"),this.device.features&&(this.featureTextureCompressionBC=this.device.features.has("texture-compression-bc")),this.device.onuncapturederror=function(l){console.error(l.error)},this.swapChainFormat=navigator.gpu.getPreferredCanvasFormat(),this.canvasContext.configure({device:this.device,format:this.swapChainFormat,usage:this.swapChainTextureUsage,alphaMode:"premultiplied"})}return e.prototype.destroy=function(){},e.prototype.configureSwapChain=function(r,t){this.swapChainWidth===r&&this.swapChainHeight===t||(this.swapChainWidth=r,this.swapChainHeight=t)},e.prototype.getOnscreenTexture=function(){var r=this.canvasContext.getCurrentTexture(),t=r.createView(),n=new h0({id:0,device:this,descriptor:{format:Tt.U8_RGBA_RT,width:this.swapChainWidth,height:this.swapChainHeight,depthOrArrayLayers:0,dimension:Hi.TEXTURE_2D,mipLevelCount:1,usage:this.swapChainTextureUsage},skipCreate:!0});return n.depthOrArrayLayers=1,n.sampleCount=1,n.gpuTexture=r,n.gpuTextureView=t,n.name="Onscreen",this.setResourceName(n,"Onscreen Texture"),n},e.prototype.getDevice=function(){return this},e.prototype.getCanvas=function(){return this.canvas},e.prototype.beginFrame=function(){},e.prototype.endFrame=function(){},e.prototype.getNextUniqueId=function(){return++this._resourceUniqueId},e.prototype.createBuffer=function(r){return new WD({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createTexture=function(r){return new h0({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createSampler=function(r){return new JD({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createRenderTarget=function(r){var t=new h0({id:this.getNextUniqueId(),device:this,descriptor:(0,wn.pi)((0,wn.pi)({},r),{dimension:Hi.TEXTURE_2D,mipLevelCount:1,depthOrArrayLayers:1,usage:Ec.RENDER_TARGET}),sampleCount:r.sampleCount});return t.depthOrArrayLayers=1,t.type=ya.RenderTarget,t},e.prototype.createRenderTargetFromTexture=function(r){var t=r,n=t.format,i=t.width,o=t.height,s=t.depthOrArrayLayers,l=t.sampleCount,f=t.mipLevelCount,v=t.gpuTexture,y=t.gpuTextureView,b=t.usage;Di(!!(b&yl.RENDER_ATTACHMENT));var T=new h0({id:this.getNextUniqueId(),device:this,descriptor:{format:n,width:i,height:o,depthOrArrayLayers:s,dimension:Hi.TEXTURE_2D,mipLevelCount:f,usage:b},skipCreate:!0});return T.depthOrArrayLayers=s,T.sampleCount=l,T.gpuTexture=v,T.gpuTextureView=y,T},e.prototype.createProgram=function(r){var t,n;return!((t=r.vertex)===null||t===void 0)&&t.glsl&&(r.vertex.glsl=Np(this.queryVendorInfo(),"vert",r.vertex.glsl)),!((n=r.fragment)===null||n===void 0)&&n.glsl&&(r.fragment.glsl=Np(this.queryVendorInfo(),"frag",r.fragment.glsl)),new KE({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createProgramSimple=function(r){return new KE({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createTextureShared=function(r,t,n){var i={width:r.width,height:r.height,depthOrArrayLayers:r.depthOrArrayLayers},o=r.mipLevelCount,s=O_(r.format),l=ED(r.dimension),f=bD(r.usage);if(t.gpuTextureformat=s,t.dimension=r.dimension,t.format=r.format,t.width=r.width,t.height=r.height,t.depthOrArrayLayers=r.depthOrArrayLayers,t.mipLevelCount=o,t.usage=f,t.sampleCount=r.sampleCount,!n){var v=this.device.createTexture({size:i,mipLevelCount:o,format:s,dimension:l,sampleCount:r.sampleCount,usage:f}),y=v.createView();t.gpuTexture=v,t.gpuTextureView=y}},e.prototype.getFallbackSampler=function(r){var t=r.formatKind;return t===zo.Depth&&r.comparison?this.fallbackSamplerComparison:this.fallbackSamplerFiltering},e.prototype.getFallbackTexture=function(r){var t=r.dimension,n=r.formatKind;if(t===Hi.TEXTURE_2D)return n===zo.Depth?this.fallbackTexture2DDepth:this.fallbackTexture2D;if(t===Hi.TEXTURE_2D_ARRAY)return this.fallbackTexture2DArray;if(t===Hi.TEXTURE_3D)return this.fallbackTexture3D;if(t===Hi.TEXTURE_CUBE_MAP)return this.fallbackTextureCube;throw new Error("whoops")},e.prototype.createFallbackTexture=function(r,t){var n=r===Hi.TEXTURE_CUBE_MAP?6:1,i=t===zo.Float?Tt.U8_RGBA_NORM:Tt.D24;return this.createTexture({dimension:r,format:i,usage:Ec.SAMPLED,width:1,height:1,depthOrArrayLayers:n,mipLevelCount:1})},e.prototype.createBindings=function(r){return new HD({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createInputLayout=function(r){return new $D({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createComputePipeline=function(r){return new XD({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createRenderPipeline=function(r){return new QD({id:this.getNextUniqueId(),device:this,descriptor:(0,wn.pi)({},r)})},e.prototype.createQueryPool=function(r,t){return new YD({id:this.getNextUniqueId(),device:this,descriptor:{type:r,elemCount:t}})},e.prototype.createRenderPipelineInternal=function(r,t){var n;if(r.gpuRenderPipeline===null){var i=r.descriptor,o=i.program,s=o.vertexStage,l=o.fragmentStage;if(!(s===null||l===null)){var f=i.megaStateDescriptor||{},v=f.stencilBack,y=f.stencilFront,b=(0,wn._T)(f,["stencilBack","stencilFront"]),T=wv(Td);i.megaStateDescriptor=(0,wn.pi)((0,wn.pi)((0,wn.pi)({},T),{stencilBack:(0,wn.pi)((0,wn.pi)({},T.stencilBack),v),stencilFront:(0,wn.pi)((0,wn.pi)({},T.stencilFront),y)}),b);var M=i.megaStateDescriptor.attachmentsState[0];i.colorAttachmentFormats.forEach(function(Le,$e){i.megaStateDescriptor.attachmentsState[$e]||(i.megaStateDescriptor.attachmentsState[$e]=IE(void 0,M))});var O=OD((n=i.topology)!==null&&n!==void 0?n:ms.TRIANGLES,i.megaStateDescriptor),k=BD(i.colorAttachmentFormats,i.megaStateDescriptor),$=LD(i.depthStencilAttachmentFormat,i.megaStateDescriptor),G=void 0;i.inputLayout!==null&&(G=i.inputLayout.buffers);var oe=i.sampleCount,ye={layout:"auto",vertex:(0,wn.pi)((0,wn.pi)({},s),{buffers:G}),primitive:O,depthStencil:$,multisample:{count:oe},fragment:(0,wn.pi)((0,wn.pi)({},l),{targets:k})};r.gpuRenderPipeline=this.device.createRenderPipeline(ye)}}},e.prototype.createReadback=function(){return new qD({id:this.getNextUniqueId(),device:this})},e.prototype.createRenderPass=function(r){var t=this.renderPassPool.pop();return t===void 0&&(t=new KD(this)),t.commandEncoder=this.device.createCommandEncoder(),t.beginRenderPass(r),t},e.prototype.createComputePass=function(){var r=this.computePassPool.pop();return r===void 0&&(r=new GD),r.commandEncoder=this.device.createCommandEncoder(),r.beginComputePass(),r},e.prototype.submitPass=function(r){var t=this.device.queue,n=r,i=n.finish();t.submit([i]),n.commandEncoder=null},e.prototype.copySubTexture2D=function(r,t,n,i,o,s){var l=this.device.createCommandEncoder(),f=r,v=i,y={texture:v.gpuTexture,origin:[o,s,0]},b={texture:f.gpuTexture,origin:[t,n,0]};Di(!!(v.usage&yl.COPY_SRC)),Di(!!(f.usage&yl.COPY_DST)),l.copyTextureToTexture(y,b,[v.width,v.height,1]),this.device.queue.submit([l.finish()])},e.prototype.queryLimits=function(){return{uniformBufferMaxPageWordSize:this.device.limits.maxUniformBufferBindingSize>>>2,uniformBufferWordAlignment:this.device.limits.minUniformBufferOffsetAlignment>>>2,supportedSampleCounts:[1],occlusionQueriesRecommended:!0,computeShadersSupported:!0}},e.prototype.queryTextureFormatSupported=function(r,t,n){if(ZD(r)){if(!this.featureTextureCompressionBC)return!1;var i=VD(r);return t%i!==0||n%i!==0?!1:this.featureTextureCompressionBC}switch(r){case Tt.U16_RGBA_NORM:return!1;case Tt.F32_RGBA:return!1}return!0},e.prototype.queryPlatformAvailable=function(){return!0},e.prototype.queryVendorInfo=function(){return this},e.prototype.queryRenderPass=function(r){var t=r;return t.descriptor},e.prototype.queryRenderTarget=function(r){var t=r;return t},e.prototype.setResourceName=function(r,t){if(r.name=t,r.type===ya.Buffer){var n=r;n.gpuBuffer.label=t}else if(r.type===ya.Texture){var n=r;n.gpuTexture.label=t,n.gpuTextureView.label=t}else if(r.type===ya.RenderTarget){var n=r;n.gpuTexture.label=t,n.gpuTextureView.label=t}else if(r.type===ya.Sampler){var n=r;n.gpuSampler.label=t}else if(r.type===ya.RenderPipeline){var n=r;n.gpuRenderPipeline!==null&&(n.gpuRenderPipeline.label=t)}},e.prototype.setResourceLeakCheck=function(r,t){},e.prototype.checkForLeaks=function(){},e.prototype.programPatched=function(r){},e.prototype.pipelineQueryReady=function(r){var t=r;return t.gpuRenderPipeline!==null},e.prototype.pipelineForceReady=function(r){var t=r;this.createRenderPipelineInternal(t,!1)},e}(),tk=function(){function e(r){this.pluginOptions=r}return e.prototype.createSwapChain=function(r){return(0,wn.mG)(this,void 0,void 0,function(){var t,n,i,o,s,l,f,v;return(0,wn.Jh)(this,function(y){switch(y.label){case 0:if(globalThis.navigator.gpu===void 0)return[2,null];t=null,y.label=1;case 1:return y.trys.push([1,3,,4]),n=this.pluginOptions.xrCompatible,[4,globalThis.navigator.gpu.requestAdapter({xrCompatible:n})];case 2:return t=y.sent(),[3,4];case 3:return i=y.sent(),console.log(i),[3,4];case 4:return t===null?[2,null]:(o=["depth32float-stencil8","texture-compression-bc"],s=o.filter(function(b){return t.features.has(b)}),[4,t.requestDevice({requiredFeatures:s})]);case 5:if(l=y.sent(),l&&(f=this.pluginOptions.onContextLost,l.lost.then(function(){f&&f()})),l===null)return[2,null];if(v=r.getContext("webgpu"),!v)return[2,null];y.label=6;case 6:return y.trys.push([6,8,,9]),[4,WE(this.pluginOptions.shaderCompilerPath)];case 7:return y.sent(),[3,9];case 8:return y.sent(),[3,9];case 9:return[2,new ek(t,l,r,v,gD,Um&&new Um)]}})})},e}(),rk=ii.isPlainObject,nk=ii.isTypedArray,ik=function(){function e(r,t){(0,q.Z)(this,e),(0,B.Z)(this,"destroyed",!1),(0,B.Z)(this,"uniforms",{}),this.reGl=r;var n=t.vs,i=t.fs,o=t.attributes,s=t.uniforms,l=t.primitive,f=t.count,v=t.elements,y=t.depth,b=t.cull,T=t.instances,M={platformString:"WebGL1",glslVersion:"#version 100",explicitBindingLocations:!1,separateSamplerTextures:!1,viewportOrigin:bv.LOWER_LEFT,clipSpaceNearZ:Ev.NEGATIVE_ONE,supportMRT:!1},O={};this.options=t,s&&(this.uniforms=this.extractUniforms(s),Object.keys(s).forEach(function(G){O[G]=r.prop(G)}));var k={};Object.keys(o).forEach(function(G){k[G]=o[G].get()});var $={attributes:k,frag:om(Np(M,"frag",i,null,!1)),uniforms:O,vert:om(Np(M,"vert",n,null,!1)),colorMask:r.prop("colorMask"),lineWidth:1,blend:{enable:r.prop("blend.enable"),func:r.prop("blend.func"),equation:r.prop("blend.equation"),color:r.prop("blend.color")},stencil:{enable:r.prop("stencil.enable"),mask:r.prop("stencil.mask"),func:r.prop("stencil.func"),opFront:r.prop("stencil.opFront"),opBack:r.prop("stencil.opBack")},primitive:rO[l===void 0?R.TRIANGLES:l]};T&&($.instances=T),f?$.count=f:v&&($.elements=v.get()),this.initDepthDrawParams({depth:y},$),this.initCullDrawParams({cull:b},$),this.drawCommand=r($),this.drawParams=$}return(0,V.Z)(e,[{key:"updateAttributesAndElements",value:function(t,n){var i={};Object.keys(t).forEach(function(o){i[o]=t[o].get()}),this.drawParams.attributes=i,this.drawParams.elements=n.get(),this.drawCommand=this.reGl(this.drawParams)}},{key:"updateAttributes",value:function(t){var n={};Object.keys(t).forEach(function(i){n[i]=t[i].get()}),this.drawParams.attributes=n,this.drawCommand=this.reGl(this.drawParams)}},{key:"addUniforms",value:function(t){this.uniforms=(0,H.Z)((0,H.Z)({},this.uniforms),this.extractUniforms(t))}},{key:"draw",value:function(t,n){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var i=(0,H.Z)((0,H.Z)({},this.uniforms),this.extractUniforms(t.uniforms||{})),o={};Object.keys(i).forEach(function(s){var l=(0,cl.Z)(i[s]);l==="boolean"||l==="number"||Array.isArray(i[s])||i[s].BYTES_PER_ELEMENT?o[s]=i[s]:o[s]=i[s].get()}),o.blend=n?this.getBlendDrawParams({blend:{enable:!1}}):this.getBlendDrawParams(t),o.stencil=this.getStencilDrawParams(t),o.colorMask=this.getColorMaskDrawParams(t,n),this.drawCommand(o)}}},{key:"destroy",value:function(){var t;(t=this.drawParams)===null||t===void 0||(t=t.elements)===null||t===void 0||t.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(n){n==null||n.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(t,n){var i=t.depth;i&&(n.depth={enable:i.enable===void 0?!0:!!i.enable,mask:i.mask===void 0?!0:!!i.mask,func:oO[i.func||R.LESS],range:i.range||[0,1]})}},{key:"getBlendDrawParams",value:function(t){var n=t.blend,i=n||{},o=i.enable,s=i.func,l=i.equation,f=i.color,v=f===void 0?[0,0,0,0]:f;return{enable:!!o,func:{srcRGB:qg[s&&s.srcRGB||R.SRC_ALPHA],srcAlpha:qg[s&&s.srcAlpha||R.SRC_ALPHA],dstRGB:qg[s&&s.dstRGB||R.ONE_MINUS_SRC_ALPHA],dstAlpha:qg[s&&s.dstAlpha||R.ONE_MINUS_SRC_ALPHA]},equation:{rgb:xE[l&&l.rgb||R.FUNC_ADD],alpha:xE[l&&l.alpha||R.FUNC_ADD]},color:v}}},{key:"getStencilDrawParams",value:function(t){var n=t.stencil,i=n||{},o=i.enable,s=i.mask,l=s===void 0?-1:s,f=i.func,v=f===void 0?{cmp:R.ALWAYS,ref:0,mask:-1}:f,y=i.opFront,b=y===void 0?{fail:R.KEEP,zfail:R.KEEP,zpass:R.KEEP}:y,T=i.opBack,M=T===void 0?{fail:R.KEEP,zfail:R.KEEP,zpass:R.KEEP}:T;return{enable:!!o,mask:l,func:(0,H.Z)((0,H.Z)({},v),{},{cmp:sO[v.cmp]}),opFront:{fail:yv[b.fail],zfail:yv[b.zfail],zpass:yv[b.zpass]},opBack:{fail:yv[M.fail],zfail:yv[M.zfail],zpass:yv[M.zpass]}}}},{key:"getColorMaskDrawParams",value:function(t,n){var i=t.stencil,o=i!=null&&i.enable&&i.opFront&&!n?[!1,!1,!1,!1]:[!0,!0,!0,!0];return o}},{key:"initCullDrawParams",value:function(t,n){var i=t.cull;if(i){var o=i.enable,s=i.face,l=s===void 0?R.BACK:s;n.cull={enable:!!o,face:uO[l]}}}},{key:"extractUniforms",value:function(t){var n=this,i={};return Object.keys(t).forEach(function(o){n.extractUniformsRecursively(o,t[o],i,"")}),i}},{key:"extractUniformsRecursively",value:function(t,n,i,o){var s=this;if(n===null||typeof n=="number"||typeof n=="boolean"||Array.isArray(n)&&typeof n[0]=="number"||nk(n)||n===""||"resize"in n){i["".concat(o&&o+".").concat(t)]=n;return}rk(n)&&Object.keys(n).forEach(function(l){s.extractUniformsRecursively(l,n[l],i,"".concat(o&&o+".").concat(t))}),Array.isArray(n)&&n.forEach(function(l,f){Object.keys(l).forEach(function(v){s.extractUniformsRecursively(v,l[v],i,"".concat(o&&o+".").concat(t,"[").concat(f,"]"))})})}}]),e}(),ak=function(){function e(r,t){(0,q.Z)(this,e),(0,B.Z)(this,"isDestroy",!1);var n=t.data,i=t.type,o=i===void 0?R.UNSIGNED_BYTE:i,s=t.width,l=t.height,f=t.flipY,v=f===void 0?!1:f,y=t.format,b=y===void 0?R.RGBA:y,T=t.mipmap,M=T===void 0?!1:T,O=t.wrapS,k=O===void 0?R.CLAMP_TO_EDGE:O,$=t.wrapT,G=$===void 0?R.CLAMP_TO_EDGE:$,oe=t.aniso,ye=oe===void 0?0:oe,Le=t.alignment,$e=Le===void 0?1:Le,ut=t.premultiplyAlpha,vt=ut===void 0?!1:ut,Rt=t.mag,Jt=Rt===void 0?R.NEAREST:Rt,Mr=t.min,br=Mr===void 0?R.NEAREST:Mr,pn=t.colorSpace,kn=pn===void 0?R.BROWSER_DEFAULT_WEBGL:pn,Pi=t.x,xa=Pi===void 0?0:Pi,is=t.y,_s=is===void 0?0:is,as=t.copy,lu=as===void 0?!1:as;this.width=s,this.height=l;var Ac={width:s,height:l,type:S_[o],format:nO[b],wrapS:yE[k],wrapT:yE[G],mag:_E[Jt],min:_E[br],alignment:$e,flipY:v,colorSpace:aO[kn],premultiplyAlpha:vt,aniso:ye,x:xa,y:_s,copy:lu};n&&(Ac.data=n),typeof M=="number"?Ac.mipmap=iO[M]:typeof M=="boolean"&&(Ac.mipmap=M),this.texture=r.texture(Ac)}return(0,V.Z)(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(t)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(t){var n=t.width,i=t.height;this.texture.resize(n,i),this.width=n,this.height=i}},{key:"getSize",value:function(){return[this.width,this.height]}},{key:"destroy",value:function(){if(!this.isDestroy){var t;(t=this.texture)===null||t===void 0||t.destroy()}this.isDestroy=!0}}]),e}(),QE,JE,ok=(QE=(0,gt.b2)(),QE(JE=function(){function e(){var r=this;(0,q.Z)(this,e),(0,B.Z)(this,"uniformBuffers",[]),(0,B.Z)(this,"createModel",function(t){return new ik(r.gl,t)}),(0,B.Z)(this,"createAttribute",function(t){return new tO(r.gl,t)}),(0,B.Z)(this,"createBuffer",function(t){return new lO(r.gl,t)}),(0,B.Z)(this,"createElements",function(t){return new cO(r.gl,t)}),(0,B.Z)(this,"createTexture2D",function(t){return new ak(r.gl,t)}),(0,B.Z)(this,"createFramebuffer",function(t){return new fO(r.gl,t)}),(0,B.Z)(this,"useFramebuffer",function(t,n){r.gl({framebuffer:t?t.get():null})(n)}),(0,B.Z)(this,"clear",function(t){var n,i=t.color,o=t.depth,s=t.stencil,l=t.framebuffer,f=l===void 0?null:l,v={color:i,depth:o,stencil:s};v.framebuffer=f===null?f:f.get(),(n=r.gl)===null||n===void 0||n.clear(v)}),(0,B.Z)(this,"viewport",function(t){var n=t.x,i=t.y,o=t.width,s=t.height;r.gl._gl.viewport(n,i,o,s),r.width=o,r.height=s,r.gl._refresh()}),(0,B.Z)(this,"readPixels",function(t){var n=t.framebuffer,i=t.x,o=t.y,s=t.width,l=t.height,f={x:i,y:o,width:s,height:l};return n&&(f.framebuffer=n.get()),r.gl.read(f)}),(0,B.Z)(this,"getViewportSize",function(){return{width:r.gl._gl.drawingBufferWidth,height:r.gl._gl.drawingBufferHeight}}),(0,B.Z)(this,"getContainer",function(){var t;return(t=r.canvas)===null||t===void 0?void 0:t.parentElement}),(0,B.Z)(this,"getCanvas",function(){return r.canvas}),(0,B.Z)(this,"getGLContext",function(){return r.gl._gl}),(0,B.Z)(this,"destroy",function(){var t;r.canvas=null,(t=r.gl)===null||t===void 0||(t=t._gl)===null||t===void 0||(t=t.getExtension("WEBGL_lose_context"))===null||t===void 0||t.loseContext(),r.gl.destroy(),r.gl=null})}return(0,V.Z)(e,[{key:"init",value:function(){var r=(0,Ct.Z)(me().mark(function n(i,o,s){var l=this;return me().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(this.canvas=i,!s){v.next=5;break}this.gl=s,v.next=8;break;case 5:return v.next=7,new Promise(function(y,b){eO()({canvas:l.canvas,attributes:{alpha:!0,antialias:o.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:o.preserveDrawingBuffer,stencil:o.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture","WEBGL_lose_context"],profile:!0,onDone:function(M,O){(M||!O)&&b(M),y(O)}})});case 7:this.gl=v.sent;case 8:this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 9:case"end":return v.stop()}},n,this)}));function t(n,i,o){return r.apply(this,arguments)}return t}()},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(t){return!!this.getGLContext().getExtension(t)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var t=this.getGLContext();t.disable(t.CULL_FACE)}},{key:"setDirty",value:function(t){this.isDirty=t}},{key:"getDirty",value:function(){return this.isDirty}},{key:"beginFrame",value:function(){}},{key:"endFrame",value:function(){}}]),e}())||JE),sk=function(){function e(r,t){(0,q.Z)(this,e);var n=t.buffer,i=t.offset,o=t.stride,s=t.normalized,l=t.size,f=t.divisor,v=t.shaderLocation;this.buffer=n,this.attribute={shaderLocation:v,buffer:n.get(),offset:i||0,stride:o||0,normalized:s||!1,divisor:f||0},l&&(this.attribute.size=l)}return(0,V.Z)(e,[{key:"get",value:function(){return this.buffer}},{key:"updateBuffer",value:function(t){this.buffer.subData(t)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),zp,Yh,Ov,zm,Zm,hh,p0,wd,Cu,d0=(zp={},(0,B.Z)(zp,R.FLOAT,Float32Array),(0,B.Z)(zp,R.UNSIGNED_BYTE,Uint8Array),(0,B.Z)(zp,R.SHORT,Int16Array),(0,B.Z)(zp,R.UNSIGNED_SHORT,Uint16Array),(0,B.Z)(zp,R.INT,Int32Array),(0,B.Z)(zp,R.UNSIGNED_INT,Uint32Array),zp),uk=(Yh={},(0,B.Z)(Yh,R.POINTS,ms.POINTS),(0,B.Z)(Yh,R.LINES,ms.LINES),(0,B.Z)(Yh,R.LINE_LOOP,ms.LINES),(0,B.Z)(Yh,R.LINE_STRIP,ms.LINE_STRIP),(0,B.Z)(Yh,R.TRIANGLES,ms.TRIANGLES),(0,B.Z)(Yh,R.TRIANGLE_FAN,ms.TRIANGLES),(0,B.Z)(Yh,R.TRIANGLE_STRIP,ms.TRIANGLE_STRIP),Yh),lk=(Ov={},(0,B.Z)(Ov,1,Tt.F32_R),(0,B.Z)(Ov,2,Tt.F32_RG),(0,B.Z)(Ov,3,Tt.F32_RGB),(0,B.Z)(Ov,4,Tt.F32_RGBA),Ov),ck=(zm={},(0,B.Z)(zm,R.STATIC_DRAW,Af.STATIC),(0,B.Z)(zm,R.DYNAMIC_DRAW,Af.DYNAMIC),(0,B.Z)(zm,R.STREAM_DRAW,Af.DYNAMIC),zm),e2=(Zm={},(0,B.Z)(Zm,R.REPEAT,gl.REPEAT),(0,B.Z)(Zm,R.CLAMP_TO_EDGE,gl.CLAMP_TO_EDGE),(0,B.Z)(Zm,R.MIRRORED_REPEAT,gl.MIRRORED_REPEAT),Zm),fk=(hh={},(0,B.Z)(hh,R.NEVER,_a.NEVER),(0,B.Z)(hh,R.ALWAYS,_a.ALWAYS),(0,B.Z)(hh,R.LESS,_a.LESS),(0,B.Z)(hh,R.LEQUAL,_a.LEQUAL),(0,B.Z)(hh,R.GREATER,_a.GREATER),(0,B.Z)(hh,R.GEQUAL,_a.GEQUAL),(0,B.Z)(hh,R.EQUAL,_a.EQUAL),(0,B.Z)(hh,R.NOTEQUAL,_a.NOTEQUAL),hh),hk=(p0={},(0,B.Z)(p0,R.FRONT,Wl.FRONT),(0,B.Z)(p0,R.BACK,Wl.BACK),p0),t2=(wd={},(0,B.Z)(wd,R.FUNC_ADD,Tu.ADD),(0,B.Z)(wd,R.MIN_EXT,Tu.MIN),(0,B.Z)(wd,R.MAX_EXT,Tu.MAX),(0,B.Z)(wd,R.FUNC_SUBTRACT,Tu.SUBSTRACT),(0,B.Z)(wd,R.FUNC_REVERSE_SUBTRACT,Tu.REVERSE_SUBSTRACT),wd),v0=(Cu={},(0,B.Z)(Cu,R.ZERO,ua.ZERO),(0,B.Z)(Cu,R.ONE,ua.ONE),(0,B.Z)(Cu,R.SRC_COLOR,ua.SRC),(0,B.Z)(Cu,R.ONE_MINUS_SRC_COLOR,ua.ONE_MINUS_SRC),(0,B.Z)(Cu,R.SRC_ALPHA,ua.SRC_ALPHA),(0,B.Z)(Cu,R.ONE_MINUS_SRC_ALPHA,ua.ONE_MINUS_SRC_ALPHA),(0,B.Z)(Cu,R.DST_COLOR,ua.DST),(0,B.Z)(Cu,R.ONE_MINUS_DST_COLOR,ua.ONE_MINUS_DST),(0,B.Z)(Cu,R.DST_ALPHA,ua.DST_ALPHA),(0,B.Z)(Cu,R.ONE_MINUS_DST_ALPHA,ua.ONE_MINUS_DST_ALPHA),(0,B.Z)(Cu,R.CONSTANT_COLOR,ua.CONST),(0,B.Z)(Cu,R.ONE_MINUS_CONSTANT_COLOR,ua.ONE_MINUS_CONSTANT),(0,B.Z)(Cu,R.CONSTANT_ALPHA,ua.CONST),(0,B.Z)(Cu,R.ONE_MINUS_CONSTANT_ALPHA,ua.ONE_MINUS_CONSTANT),(0,B.Z)(Cu,R.SRC_ALPHA_SATURATE,ua.SRC_ALPHA_SATURATE),Cu),pk={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121};function m0(e){return Object.prototype.toString.call(e)in pk}var dk=function(){function e(r,t){(0,q.Z)(this,e),(0,B.Z)(this,"isDestroyed",!1);var n=t.data,i=t.usage,o=t.type,s=t.isUBO,l;m0(n)?l=n:l=new d0[this.type||R.FLOAT](n),this.type=o,this.size=l.byteLength,this.buffer=r.createBuffer({viewOrSize:l,usage:s?ro.UNIFORM:ro.VERTEX,hint:ck[i||R.STATIC_DRAW]})}return(0,V.Z)(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.isDestroyed||this.buffer.destroy(),this.isDestroyed=!0}},{key:"subData",value:function(t){var n=t.data,i=t.offset,o;m0(n)?o=n:o=new d0[this.type||R.FLOAT](n),this.buffer.setSubData(i,new Uint8Array(o.buffer))}}]),e}(),vk=function(){function e(r,t){(0,q.Z)(this,e);var n=t.data,i=t.type,o=t.count,s=o===void 0?0:o,l;m0(n)?l=n:l=new d0[this.type||R.UNSIGNED_INT](n),this.type=i,this.count=s,this.indexBuffer=r.createBuffer({viewOrSize:l,usage:ro.INDEX})}return(0,V.Z)(e,[{key:"get",value:function(){return this.indexBuffer}},{key:"subData",value:function(t){var n=t.data,i;m0(n)?i=n:i=new d0[this.type||R.UNSIGNED_INT](n),this.indexBuffer.setSubData(0,new Uint8Array(i.buffer))}},{key:"destroy",value:function(){this.indexBuffer.destroy()}}]),e}();function mk(e){return!1}var gk=function(){function e(r,t){(0,q.Z)(this,e),(0,B.Z)(this,"isDestroy",!1);var n=t.data,i=t.type,o=i===void 0?R.UNSIGNED_BYTE:i,s=t.width,l=t.height,f=t.flipY,v=f===void 0?!1:f,y=t.format,b=y===void 0?R.RGBA:y,T=t.wrapS,M=T===void 0?R.CLAMP_TO_EDGE:T,O=t.wrapT,k=O===void 0?R.CLAMP_TO_EDGE:O,$=t.alignment,G=$===void 0?1:$;this.width=s,this.height=l;var oe=Tt.U8_RGBA_RT;if(o===R.UNSIGNED_BYTE&&b===R.RGBA)oe=Tt.U8_RGBA_RT;else if(b===R.LUMINANCE&&o===R.FLOAT)oe=Tt.F32_LUMINANCE;else if(b===R.LUMINANCE&&o===R.UNSIGNED_BYTE)oe=Tt.U8_LUMINANCE;else throw new Error("create texture error, type: ".concat(o,", format: ").concat(b));this.texture=r.createTexture({format:oe,width:s,height:l,usage:Ec.SAMPLED,pixelStore:{unpackFlipY:v,packAlignment:G}}),n&&this.texture.setImageData([n]),this.sampler=r.createSampler({addressModeU:e2[M],addressModeV:e2[k],minFilter:vs.POINT,magFilter:vs.BILINEAR,mipmapFilter:Gs.NO_MIP,lodMinClamp:0,lodMaxClamp:0})}return(0,V.Z)(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(t){var n=t.data;this.texture.setImageData([n])}},{key:"bind",value:function(){}},{key:"resize",value:function(t){var n=t.width,i=t.height;this.width=n,this.height=i}},{key:"getSize",value:function(){return[this.width,this.height]}},{key:"destroy",value:function(){if(!this.isDestroy){var t;(t=this.texture)===null||t===void 0||t.destroy()}this.isDestroy=!0}}]),e}(),_k=function(){function e(r,t){(0,q.Z)(this,e),this.device=r;var n=t.width,i=t.height,o=t.color;mk(o)?(this.renderTarget=r.createRenderTargetFromTexture(o.get()),this.width=o.width,this.height=o.height):n&&i&&(this.renderTarget=r.createRenderTarget({format:Tt.U8_RGBA_RT,width:n,height:i}),this.width=n,this.height=i)}return(0,V.Z)(e,[{key:"get",value:function(){return this.renderTarget}},{key:"destroy",value:function(){this.renderTarget.destroy()}},{key:"resize",value:function(t){var n=t.width,i=t.height;(this.width!==n||this.height!==i)&&(this.renderTarget&&this.renderTarget.destroy(),this.renderTarget=this.device.createRenderTarget({format:Tt.U8_RGBA_RT,width:n,height:i}),this.width=n,this.height=i)}}]),e}(),yk=ii.isPlainObject,xk=ii.isTypedArray,bk=function(){function e(r,t){var n=this;(0,q.Z)(this,e),(0,B.Z)(this,"destroyed",!1),(0,B.Z)(this,"uniforms",{}),(0,B.Z)(this,"vertexBuffers",[]),this.device=r,this.options=t;var i=t.vs,o=t.fs,s=t.attributes,l=t.uniforms,f=t.count,v=t.elements;this.options=t;var y=r.createProgram({vertex:{glsl:i},fragment:{glsl:o}});this.program=y,l&&(this.uniforms=this.extractUniforms(l));var b=[],T=0;Object.keys(s).forEach(function(O){var k=s[O],$=k.get();n.vertexBuffers.push($.get());var G=k.attribute,oe=G.offset,ye=oe===void 0?0:oe,Le=G.stride,$e=Le===void 0?0:Le,ut=G.size,vt=ut===void 0?1:ut,Rt=G.divisor,Jt=Rt===void 0?0:Rt,Mr=G.shaderLocation,br=Mr===void 0?0:Mr;b.push({arrayStride:$e||vt*4,stepMode:Sd.VERTEX,attributes:[{format:lk[vt],shaderLocation:br,offset:ye,divisor:Jt}]}),T=$.size/vt}),f||(this.options.count=T),v&&(this.indexBuffer=v.get());var M=r.createInputLayout({vertexBufferDescriptors:b,indexBufferFormat:v?Tt.U32_R:null,program:y});this.inputLayout=M,this.pipeline=this.createPipeline(t)}return(0,V.Z)(e,[{key:"createPipeline",value:function(t){var n=t.primitive,i=n===void 0?R.TRIANGLES:n,o=t.depth,s=t.cull,l=t.blend,f=this.initDepthDrawParams({depth:o}),v=!!(f&&f.enable),y=this.initCullDrawParams({cull:s}),b=!!(y&&y.enable),T=this.getBlendDrawParams({blend:l}),M=!!(T&&T.enable);return this.device.createRenderPipeline({inputLayout:this.inputLayout,program:this.program,topology:uk[i],colorAttachmentFormats:[Tt.U8_RGBA_RT],depthStencilAttachmentFormat:Tt.D24_S8,megaStateDescriptor:{attachmentsState:[{channelWriteMask:wu.ALL,rgbBlendState:{blendMode:M&&T.equation.rgb||Tu.ADD,blendSrcFactor:M&&T.func.srcRGB||ua.SRC_ALPHA,blendDstFactor:M&&T.func.dstRGB||ua.ONE_MINUS_SRC_ALPHA},alphaBlendState:{blendMode:M&&T.equation.alpha||Tu.ADD,blendSrcFactor:M&&T.func.srcAlpha||ua.ONE,blendDstFactor:M&&T.func.dstAlpha||ua.ONE_MINUS_SRC_ALPHA}}],blendConstant:A_,depthWrite:v,depthCompare:v&&f.func||_a.LESS,cullMode:b&&y.face||Wl.NONE,stencilWrite:!1}})}},{key:"updateAttributesAndElements",value:function(){}},{key:"updateAttributes",value:function(){}},{key:"addUniforms",value:function(t){this.uniforms=(0,H.Z)((0,H.Z)({},this.uniforms),this.extractUniforms(t))}},{key:"draw",value:function(t){var n=(0,H.Z)((0,H.Z)({},this.options),t),i=n.count,o=i===void 0?0:i,s=n.instances,l=n.elements,f=n.uniforms,v=f===void 0?{}:f,y=n.uniformBuffers,b=n.textures;this.uniforms=(0,H.Z)((0,H.Z)({},this.uniforms),this.extractUniforms(v));var T=this.device,M=T.width,O=T.height,k=this.device.renderPass;if(this.pipeline=this.createPipeline(n),k.setPipeline(this.pipeline),k.setVertexInput(this.inputLayout,this.vertexBuffers.map(function(G){return{buffer:G}}),l?{buffer:this.indexBuffer,offset:0}:null),k.setViewport(0,0,M,O),y&&(this.bindings=this.device.createBindings({pipeline:this.pipeline,uniformBufferBindings:y.map(function(G,oe){var ye=G;return{binding:oe,buffer:ye.get(),size:ye.size}}),samplerBindings:b==null?void 0:b.map(function(G){return{texture:G.texture,sampler:G.sampler}})})),this.bindings&&(k.setBindings(this.bindings),this.program.setUniformsLegacy(this.uniforms)),l){var $=l.count;$===0?k.draw(o,s):k.drawIndexed($,s)}else k.draw(o,s)}},{key:"destroy",value:function(){var t,n,i;this.program.destroy(),(t=this.vertexBuffers)===null||t===void 0||t.forEach(function(o){return o.destroy()}),(n=this.indexBuffer)===null||n===void 0||n.destroy(),(i=this.bindings)===null||i===void 0||i.destroy(),this.inputLayout.destroy(),this.pipeline.destroy(),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(t){var n=t.depth;if(n)return{enable:n.enable===void 0?!0:!!n.enable,mask:n.mask===void 0?!0:!!n.mask,func:fk[n.func||R.LESS],range:n.range||[0,1]}}},{key:"getBlendDrawParams",value:function(t){var n=t.blend,i=n||{},o=i.enable,s=i.func,l=i.equation,f=i.color,v=f===void 0?[0,0,0,0]:f;return{enable:!!o,func:{srcRGB:v0[s&&s.srcRGB||R.SRC_ALPHA],srcAlpha:v0[s&&s.srcAlpha||R.SRC_ALPHA],dstRGB:v0[s&&s.dstRGB||R.ONE_MINUS_SRC_ALPHA],dstAlpha:v0[s&&s.dstAlpha||R.ONE_MINUS_SRC_ALPHA]},equation:{rgb:t2[l&&l.rgb||R.FUNC_ADD],alpha:t2[l&&l.alpha||R.FUNC_ADD]},color:v}}},{key:"initCullDrawParams",value:function(t){var n=t.cull;if(n){var i=n.enable,o=n.face,s=o===void 0?R.BACK:o;return{enable:!!i,face:hk[s]}}}},{key:"extractUniforms",value:function(t){var n=this,i={};return Object.keys(t).forEach(function(o){n.extractUniformsRecursively(o,t[o],i,"")}),i}},{key:"extractUniformsRecursively",value:function(t,n,i,o){var s=this;if(n===null||typeof n=="number"||typeof n=="boolean"||Array.isArray(n)&&typeof n[0]=="number"||xk(n)||n===""||"resize"in n){i["".concat(o&&o+".").concat(t)]=n;return}yk(n)&&Object.keys(n).forEach(function(l){s.extractUniformsRecursively(l,n[l],i,"".concat(o&&o+".").concat(t))}),Array.isArray(n)&&n.forEach(function(l,f){Object.keys(l).forEach(function(v){s.extractUniformsRecursively(v,l[v],i,"".concat(o&&o+".").concat(t,"[").concat(f,"]"))})})}}]),e}();function Ek(e){return typeof WebGL2RenderingContext!="undefined"&&e instanceof WebGL2RenderingContext?!0:!!(e&&e._version===2)}var r2,n2,Sk=(r2=(0,gt.b2)(),r2(n2=function(){function e(){var r=this;(0,q.Z)(this,e),(0,B.Z)(this,"uniformBuffers",[]),(0,B.Z)(this,"createModel",function(t){return new bk(r.device,t)}),(0,B.Z)(this,"createAttribute",function(t){return new sk(r.device,t)}),(0,B.Z)(this,"createBuffer",function(t){return new dk(r.device,t)}),(0,B.Z)(this,"createElements",function(t){return new vk(r.device,t)}),(0,B.Z)(this,"createTexture2D",function(t){return new gk(r.device,t)}),(0,B.Z)(this,"createFramebuffer",function(t){return new _k(r.device,t)}),(0,B.Z)(this,"useFramebuffer",function(){}),(0,B.Z)(this,"clear",function(){}),(0,B.Z)(this,"viewport",function(t){var n=t.width,i=t.height;r.width=n,r.height=i,r.device.width=n,r.device.height=i}),(0,B.Z)(this,"readPixels",function(){return new Uint8Array}),(0,B.Z)(this,"getViewportSize",function(){return{width:r.device.width,height:r.device.height}}),(0,B.Z)(this,"getContainer",function(){var t;return(t=r.canvas)===null||t===void 0?void 0:t.parentElement}),(0,B.Z)(this,"getCanvas",function(){return r.canvas}),(0,B.Z)(this,"getGLContext",function(){return r.device.gl}),(0,B.Z)(this,"destroy",function(){var t;r.canvas=null,(t=r.uniformBuffers)===null||t===void 0||t.forEach(function(n){n.destroy()}),r.device.destroy()})}return(0,V.Z)(e,[{key:"init",value:function(){var r=(0,Ct.Z)(me().mark(function n(i,o){var s,l,f,v,y,b;return me().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return s=o.enableWebGPU,l=o.shaderCompilerPath,this.canvas=i,f=s?new tk({shaderCompilerPath:l}):new hD({targets:["webgl2","webgl1"],onContextLost:function(k){console.warn("context lost",k)},onContextCreationError:function(k){console.warn("context creation error",k)},onContextRestored:function(k){console.warn("context restored",k)}}),M.next=5,f.createSwapChain(i);case 5:v=M.sent,v.configureSwapChain(i.width,i.height),this.device=v.getDevice(),this.swapChain=v,y=this.device.gl,this.extensionObject={OES_texture_float:!Ek(y)&&this.device.OES_texture_float},b=this.device.createTexture({format:Tt.U8_RGBA_RT,width:i.width,height:i.height,usage:Ec.RENDER_TARGET}),this.renderTarget=this.device.createRenderTargetFromTexture(b),this.mainDepthRT=this.device.createRenderTargetFromTexture(this.device.createTexture({format:Tt.D24_S8,width:i.width,height:i.height,usage:Ec.RENDER_TARGET}));case 14:case"end":return M.stop()}},n,this)}));function t(n,i){return r.apply(this,arguments)}return t}()},{key:"beginFrame",value:function(){var t=this.swapChain.getOnscreenTexture();this.renderPass=this.device.createRenderPass({colorAttachment:[this.renderTarget],colorResolveTo:[t],colorClearColor:[A_],depthStencilAttachment:this.mainDepthRT,depthClearValue:1}),this.device.renderPass=this.renderPass}},{key:"endFrame",value:function(){this.device.submitPass(this.renderPass)}},{key:"getPointSizeRange",value:function(){var t=this.device.gl;return t.getParameter(t.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(t){return!!this.getGLContext().getExtension(t)}},{key:"setState",value:function(){}},{key:"setBaseState",value:function(){}},{key:"setCustomLayerDefaults",value:function(){}},{key:"setDirty",value:function(t){this.isDirty=t}},{key:"getDirty",value:function(){return this.isDirty}}]),e}())||n2);function Ak(e){var r=Tk();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function Tk(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var k_=["selectstart","selecting","selectend"],wk=function(e){(0,De.Z)(t,e);var r=Ak(t);function t(n){var i,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return(0,q.Z)(this,t),i=r.call(this),(0,B.Z)((0,Ie.Z)(i),"isEnable",!1),(0,B.Z)((0,Ie.Z)(i),"onDragStart",function(s){i.box.style.display="block",i.startEvent=i.endEvent=s,i.syncBoxBound(),i.emit("selectstart",i.getLngLatBox(),i.startEvent,i.endEvent)}),(0,B.Z)((0,Ie.Z)(i),"onDragging",function(s){i.endEvent=s,i.syncBoxBound(),i.emit("selecting",i.getLngLatBox(),i.startEvent,i.endEvent)}),(0,B.Z)((0,Ie.Z)(i),"onDragEnd",function(s){i.endEvent=s,i.box.style.display="none",i.emit("selectend",i.getLngLatBox(),i.startEvent,i.endEvent)}),i.scene=n,i.options=o,i}return(0,V.Z)(t,[{key:"container",get:function(){return this.scene.getMapService().getMarkerContainer()}},{key:"enable",value:function(){if(!this.isEnable){var i=this.options.className;if(this.scene.setMapStatus({dragEnable:!1}),this.container.style.cursor="crosshair",!this.box){var o=Ji("div",void 0,this.container);o.classList.add("l7-select-box"),i&&o.classList.add(i),o.style.display="none",this.box=o}this.scene.on("dragstart",this.onDragStart),this.scene.on("dragging",this.onDragging),this.scene.on("dragend",this.onDragEnd),this.isEnable=!0}}},{key:"disable",value:function(){this.isEnable&&(this.scene.setMapStatus({dragEnable:!0}),this.container.style.cursor="auto",this.scene.off("dragstart",this.onDragStart),this.scene.off("dragging",this.onDragging),this.scene.off("dragend",this.onDragEnd),this.isEnable=!1)}},{key:"syncBoxBound",value:function(){var i=this.startEvent,o=i.x,s=i.y,l=this.endEvent,f=l.x,v=l.y,y=Math.min(o,f),b=Math.min(s,v),T=Math.abs(o-f),M=Math.abs(s-v);this.box.style.top="".concat(b,"px"),this.box.style.left="".concat(y,"px"),this.box.style.width="".concat(T,"px"),this.box.style.height="".concat(M,"px")}},{key:"getLngLatBox",value:function(){var i=this.startEvent.lngLat,o=i.lng,s=i.lat,l=this.endEvent.lngLat,f=l.lng,v=l.lat;return op([[o,s],[f,v]])}}]),t}(no.EventEmitter),Ck=function(){function e(r){(0,q.Z)(this,e);var t=r.id,n=r.map,i=r.canvas,o=r.hasBaseMap,s=r.renderer,l=s===void 0?"regl":s,f=xA();this.container=f,n.setContainer(f,t,i,o),f.bind(tt.IRendererService).to(l==="regl"?ok:Sk).inSingletonScope(),this.sceneService=f.get(tt.ISceneService),this.mapService=f.get(tt.IMapService),this.iconService=f.get(tt.IIconService),this.fontService=f.get(tt.IFontService),this.controlService=f.get(tt.IControlService),this.layerService=f.get(tt.ILayerService),this.debugService=f.get(tt.IDebugService),this.debugService.setEnable(r.debug),this.markerService=f.get(tt.IMarkerService),this.interactionService=f.get(tt.IInteractionService),this.popupService=f.get(tt.IPopupService),this.boxSelect=new wk(this,{}),this.initComponent(t),this.sceneService.init(r),this.initControl()}return(0,V.Z)(e,[{key:"map",get:function(){return this.mapService.map}},{key:"loaded",get:function(){return this.sceneService.loaded}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"getDebugService",value:function(){return this.debugService}},{key:"exportPng",value:function(){var r=(0,Ct.Z)(me().mark(function n(i){return me().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",this.sceneService.exportPng(i));case 1:case"end":return s.stop()}},n,this)}));function t(n){return r.apply(this,arguments)}return t}()},{key:"exportMap",value:function(){var r=(0,Ct.Z)(me().mark(function n(i){return me().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",this.sceneService.exportPng(i));case 1:case"end":return s.stop()}},n,this)}));function t(n){return r.apply(this,arguments)}return t}()},{key:"registerRenderService",value:function(t){var n=this;if(this.sceneService.loaded){var i=new t(this);i.init()}else this.on("loaded",function(){var o=new t(n);o.init()})}},{key:"setBgColor",value:function(t){this.mapService.setBgColor(t)}},{key:"addLayer",value:function(t){var n=this,i=lm(this.container);if(t.setContainer(i,this.container),this.sceneService.addLayer(t),t.inited){var o=this.initMask(t);this.addMask(o,t.id)}else t.on("inited",function(){var s=n.initMask(t);n.addMask(s,t.id)})}},{key:"initMask",value:function(t){var n=t.getLayerConfig(),i=n.mask,o=n.maskfence,s=n.maskColor,l=s===void 0?"#000":s,f=n.maskOpacity,v=f===void 0?0:f;if(!(!i||!o)){var y=new ix().source(o).shape("fill").style({color:l,opacity:v});return y}}},{key:"addMask",value:function(t,n){if(t){var i=this.getLayer(n);if(i){var o=lm(this.container);t.setContainer(o,this.container),i.addMaskLayer(t),this.sceneService.addMask(t)}else console.warn("parent layer not find!")}}},{key:"getPickedLayer",value:function(){return this.layerService.pickedLayerId}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(t){return this.layerService.getLayer(t)}},{key:"getLayerByName",value:function(t){return this.layerService.getLayerByName(t)}},{key:"removeLayer",value:function(){var r=(0,Ct.Z)(me().mark(function n(i,o){return me().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.layerService.remove(i,o);case 2:case"end":return l.stop()}},n,this)}));function t(n,i){return r.apply(this,arguments)}return t}()},{key:"removeAllLayer",value:function(){var r=(0,Ct.Z)(me().mark(function n(){return me().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.layerService.removeAllLayers();case 2:case"end":return o.stop()}},n,this)}));function t(){return r.apply(this,arguments)}return t}()},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(t){this.layerService.setEnableRender(t)}},{key:"addIconFont",value:function(t,n){this.fontService.addIconFont(t,n)}},{key:"addIconFonts",value:function(t){var n=this;t.forEach(function(i){var o=(0,yn.Z)(i,2),s=o[0],l=o[1];n.fontService.addIconFont(s,l)})}},{key:"addFontFace",value:function(t,n){var i=this;this.fontService.once("fontloaded",function(o){i.emit("fontloaded",o)}),this.fontService.addFontFace(t,n)}},{key:"addImage",value:function(){var r=(0,Ct.Z)(me().mark(function n(i,o){return me().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.iconService.addImage(i,o);case 2:case"end":return l.stop()}},n,this)}));function t(n,i){return r.apply(this,arguments)}return t}()},{key:"hasImage",value:function(t){return this.iconService.hasImage(t)}},{key:"removeImage",value:function(t){this.iconService.removeImage(t)}},{key:"addIconFontGlyphs",value:function(t,n){this.fontService.addIconGlyphs(n)}},{key:"addControl",value:function(t){this.controlService.addControl(t,this.container)}},{key:"removeControl",value:function(t){this.controlService.removeControl(t)}},{key:"getControlByName",value:function(t){return this.controlService.getControlByName(t)}},{key:"addMarker",value:function(t){this.markerService.addMarker(t)}},{key:"addMarkerLayer",value:function(t){this.markerService.addMarkerLayer(t)}},{key:"removeMarkerLayer",value:function(t){this.markerService.removeMarkerLayer(t)}},{key:"removeAllMarkers",value:function(){this.markerService.removeAllMarkers()}},{key:"removeAllMakers",value:function(){console.warn("removeAllMakers \u5DF2\u5E9F\u5F03\uFF0C\u8BF7\u4F7F\u7528 removeAllMarkers"),this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(t){this.popupService.addPopup(t)}},{key:"removePopup",value:function(t){this.popupService.removePopup(t)}},{key:"on",value:function(t,n){if(k_.includes(t)){var i;(i=this.boxSelect)===null||i===void 0||i.on(t,n)}else gg.includes(t)?this.sceneService.on(t,n):this.mapService.on(t,n)}},{key:"once",value:function(t,n){if(k_.includes(t)){var i;(i=this.boxSelect)===null||i===void 0||i.once(t,n)}else gg.includes(t)?this.sceneService.once(t,n):this.mapService.once(t,n)}},{key:"emit",value:function(t,n){gg.indexOf(t)===-1?this.mapService.on(t,n):this.sceneService.emit(t,n)}},{key:"off",value:function(t,n){if(k_.includes(t)){var i;(i=this.boxSelect)===null||i===void 0||i.off(t,n)}else gg.includes(t)?this.sceneService.off(t,n):this.mapService.off(t,n)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(t){return this.mapService.getCenter(t)}},{key:"setCenter",value:function(t,n){return this.mapService.setCenter(t,n)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(t){return this.mapService.setPitch(t)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(t){this.mapService.setRotation(t)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(t){this.mapService.panTo(t)}},{key:"panBy",value:function(t,n){this.mapService.panBy(t,n)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(t){this.mapService.setZoom(t)}},{key:"fitBounds",value:function(t,n){var i=this.sceneService.getSceneConfig(),o=i.fitBoundsOptions,s=i.animate;this.mapService.fitBounds(t,n||(0,H.Z)((0,H.Z)({},o),{},{animate:s}))}},{key:"setZoomAndCenter",value:function(t,n){this.mapService.setZoomAndCenter(t,n)}},{key:"setMapStyle",value:function(t){this.mapService.setMapStyle(t)}},{key:"setMapStatus",value:function(t){this.mapService.setMapStatus(t)}},{key:"pixelToLngLat",value:function(t){return this.mapService.pixelToLngLat(t)}},{key:"lngLatToPixel",value:function(t){return this.mapService.lngLatToPixel(t)}},{key:"containerToLngLat",value:function(t){return this.mapService.containerToLngLat(t)}},{key:"lngLatToContainer",value:function(t){return this.mapService.lngLatToContainer(t)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(t,n){this.container.bind(tt.IPostProcessingPass).to(t).whenTargetNamed(n)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"enableBoxSelect",value:function(){var t=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.boxSelect.enable(),n&&this.boxSelect.once("selectend",function(){t.disableBoxSelect()})}},{key:"disableBoxSelect",value:function(){this.boxSelect.disable()}},{key:"getProtocol",value:function(t){return Kr.REGISTERED_PROTOCOLS[t]}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(t){this.controlService.init({container:Os(t)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var t=this.sceneService.getSceneConfig(),n=t.logoVisible,i=t.logoPosition;n&&this.addControl(new t1({position:i}))}}],[{key:"addProtocol",value:function(t,n){Kr.REGISTERED_PROTOCOLS[t]=n}},{key:"removeProtocol",value:function(t){delete Kr.REGISTERED_PROTOCOLS[t]}}]),e}(),ZN="2.20.5";function Vm(e){"@babel/helpers - typeof";return Vm=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},Vm(e)}function i2(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function VN(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?i2(Object(t),!0).forEach(function(n){Rk(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i2(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Rk(e,r,t){return r=Mk(r),r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function Mk(e){var r=Ik(e,"string");return Vm(r)==="symbol"?r:String(r)}function Ik(e,r){if(Vm(e)!=="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var n=t.call(e,r||"default");if(Vm(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(e)}function jN(e,r){return kk(e)||Dk(e,r)||Ok(e,r)||Pk()}function Pk(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ok(e,r){if(e){if(typeof e=="string")return a2(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return a2(e,r)}}function a2(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function Dk(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n,i,o,s,l=[],f=!0,v=!1;try{if(o=(t=t.call(e)).next,r===0){if(Object(t)!==t)return;f=!1}else for(;!(f=(n=o.call(t)).done)&&(l.push(n.value),l.length!==r);f=!0);}catch(y){v=!0,i=y}finally{try{if(!f&&t.return!=null&&(s=t.return(),Object(s)!==s))return}finally{if(v)throw i}}return l}}function kk(e){if(Array.isArray(e))return e}var HN=null,WN=null,o2,F_,s2,Fk=(o2=k0(tt.IGlobalConfigService),F_=function(){function e(r){(0,q.Z)(this,e),Fi(this,"configService",s2,this),this.config=r}return(0,V.Z)(e,[{key:"setContainer",value:function(t,n,i,o){t.bind(tt.MapConfig).toConstantValue((0,H.Z)((0,H.Z)({},this.config),{},{id:n,canvas:i,hasBaseMap:o})),t.bind(tt.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),e}(),s2=Oi(F_.prototype,"configService",[o2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),F_),Bk=L(86463),jm=L.n(Bk),Lk=function(){function e(r){(0,q.Z)(this,e),(0,B.Z)(this,"size",1e4),this.size=r||1e4}return(0,V.Z)(e,[{key:"setSize",value:function(t){this.size=t}},{key:"getSize",value:function(){return[this.size,this.size]}},{key:"mercatorXfromLng",value:function(t){return(180+t)/360*this.size}},{key:"mercatorYfromLat",value:function(t){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360)*this.size}},{key:"lngFromMercatorX",value:function(t){return t/this.size*360-180}},{key:"latFromMercatorY",value:function(t){var n=180-(1-t/this.size)*360;return 360/Math.PI*Math.atan(Math.exp(n*Math.PI/180))-90}},{key:"project",value:function(t){var n=this.mercatorXfromLng(t[0]),i=this.mercatorYfromLat(t[1]);return[n,i]}},{key:"unproject",value:function(t){var n=this.lngFromMercatorX(t[0]),i=this.latFromMercatorY(t[1]);return[n,i]}}]),e}(),Nk={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},u2,l2,c2,f2,h2,p2,Dv,d2,v2,m2,g2,_2={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},Uk=12,zk=(u2=(0,gt.b2)(),l2=(0,gt.f3)(tt.MapConfig),c2=(0,gt.f3)(tt.IGlobalConfigService),f2=(0,gt.f3)(tt.ICoordinateSystemService),h2=(0,gt.f3)(tt.IEventEmitter),u2(p2=(Dv=function(){function e(){var r=this;(0,q.Z)(this,e),(0,B.Z)(this,"version","DEFAUlTMAP"),(0,B.Z)(this,"simpleMapCoord",new Lk),(0,B.Z)(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),Fi(this,"config",d2,this),Fi(this,"configService",v2,this),Fi(this,"coordinateSystemService",m2,this),Fi(this,"eventEmitter",g2,this),(0,B.Z)(this,"handleCameraChanged",function(t){var n=r.map.getCenter(),i=n.lat,o=n.lng;r.emit("mapchange"),r.viewport.syncWithMapCamera({bearing:r.map.getBearing(),center:[o,i],viewportHeight:r.map.transform.height,pitch:r.map.getPitch(),viewportWidth:r.map.transform.width,zoom:r.map.getZoom(),cameraHeight:0}),r.updateCoordinateSystemService(),r.cameraChangedCallback(r.viewport)})}return(0,V.Z)(e,[{key:"setBgColor",value:function(t){this.bgColor=t}},{key:"addMarkerContainer",value:function(){var t=this.map.getCanvasContainer();this.markerContainer=Ji("div","l7-marker-container",t),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"getOverlayContainer",value:function(){}},{key:"on",value:function(t,n){OA.indexOf(t)!==-1?this.eventEmitter.on(t,n):this.map.on(_2[t]||t,n)}},{key:"off",value:function(t,n){this.map.off(_2[t]||t,n),this.eventEmitter.off(t,n)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){if(this.version==="SIMPLE")return this.simpleMapCoord.getSize();var t=this.map.transform;return[t.width,t.height]}},{key:"getType",value:function(){return"default"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(t){return this.map.setZoom(t)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(t){this.map.setCenter(t)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(t){this.map.setBearing(t)}},{key:"zoomIn",value:function(t,n){this.map.zoomIn(t,n)}},{key:"zoomOut",value:function(t,n){this.map.zoomOut(t,n)}},{key:"setPitch",value:function(t){return this.map.setPitch(t)}},{key:"panTo",value:function(t){this.map.panTo(t)}},{key:"panBy",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;this.map.panBy([t,n])}},{key:"fitBounds",value:function(t,n){this.map.fitBounds(t,n)}},{key:"setMaxZoom",value:function(t){this.map.setMaxZoom(t)}},{key:"setMinZoom",value:function(t){this.map.setMinZoom(t)}},{key:"setMapStatus",value:function(t){t.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),t.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),t.dragEnable===!1&&this.map.dragPan.disable(),t.dragEnable===!0&&this.map.dragPan.enable(),t.rotateEnable===!1&&this.map.dragRotate.disable(),t.dragEnable===!0&&this.map.dragRotate.enable(),t.keyboardEnable===!1&&this.map.keyboard.disable(),t.keyboardEnable===!0&&this.map.keyboard.enable(),t.zoomEnable===!1&&this.map.scrollZoom.disable(),t.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(t,n){this.map.flyTo({zoom:t,center:n})}},{key:"setMapStyle",value:function(t){this.map.setStyle(this.getMapStyleValue(t))}},{key:"meterToCoord",value:function(t,n){return 1}},{key:"pixelToLngLat",value:function(t){return this.map.unproject(t)}},{key:"lngLatToPixel",value:function(t){return this.map.project(t)}},{key:"containerToLngLat",value:function(t){return this.map.unproject(t)}},{key:"lngLatToContainer",value:function(t){return this.map.project(t)}},{key:"getMapStyle",value:function(){try{var t,n=(t=this.map.getStyle().sprite)!==null&&t!==void 0?t:"";return/^mapbox:\/\/sprites\/zcxduo\/\w+\/\w+$/.test(n)?n==null?void 0:n.replace(/\/\w+$/,"").replace(/sprites/,"styles"):n}catch(i){return""}}},{key:"getMapStyleConfig",value:function(){return Nk}},{key:"getMapStyleValue",value:function(t){var n;return(n=this.getMapStyleConfig()[t])!==null&&n!==void 0?n:t}},{key:"destroy",value:function(){this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(t){for(var n,i=arguments.length,o=new Array(i>1?i-1:0),s=1;s<i;s++)o[s-1]=arguments[s];(n=this.eventEmitter).emit.apply(n,[t].concat(o))}},{key:"once",value:function(t){for(var n,i=arguments.length,o=new Array(i>1?i-1:0),s=1;s<i;s++)o[s-1]=arguments[s];(n=this.eventEmitter).once.apply(n,[t].concat(o))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(t){var n=this.map.getCanvas(),i=t==="jpg"?n==null?void 0:n.toDataURL("image/jpeg"):n==null?void 0:n.toDataURL("image/png");return i}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"creatMapContainer",value:function(t){var n=t;return typeof t=="string"&&(n=document.getElementById(t)),n}},{key:"updateView",value:function(t){this.emit("mapchange"),this.viewport.syncWithMapCamera({bearing:t.bearing,center:t.center,viewportHeight:t.viewportHeight,pitch:t.pitch,viewportWidth:t.viewportWidth,zoom:t.zoom,cameraHeight:0}),this.updateCoordinateSystemService(),this.cameraChangedCallback(this.viewport)}},{key:"updateCoordinateSystemService",value:function(){var t=this.config.offsetCoordinate,n=t===void 0?!0:t;this.viewport.getZoom()>Uk&&n?this.coordinateSystemService.setCoordinateSystem(zl.LNGLAT_OFFSET):this.coordinateSystemService.setCoordinateSystem(zl.LNGLAT)}}]),e}(),d2=Oi(Dv.prototype,"config",[l2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),v2=Oi(Dv.prototype,"configService",[c2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),m2=Oi(Dv.prototype,"coordinateSystemService",[f2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),g2=Oi(Dv.prototype,"eventEmitter",[h2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dv))||p2);function Hm(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function g0(e,r){var t=kh.fF([],r,e);return kh.bA(t,t,1/t[3]),t}function GN(e,r){var t=e%r;return t<0?r+t:t}function XN(e,r,t){return t*r+(1-t)*e}function Cd(e,r){if(!e)throw new Error(r||"viewport-mercator-project: assertion failed.")}var wf=Math.PI,y2=wf/4,qh=wf/180,x2=180/wf,B_=512,L_=4003e4,Zk=1.5;function b2(e){return Math.pow(2,e)}function Vk(e){return Math.log2(e)}function _0(e,r){var t=(0,yn.Z)(e,2),n=t[0],i=t[1];Cd(Number.isFinite(n)&&Number.isFinite(r)),Cd(Number.isFinite(i)&&i>=-90&&i<=90,"invalid latitude"),r*=B_;var o=n*qh,s=i*qh,l=r*(o+wf)/(2*wf),f=r*(wf-Math.log(Math.tan(y2+s*.5)))/(2*wf);return[l,f]}function N_(e,r){var t=(0,yn.Z)(e,2),n=t[0],i=t[1];r*=B_;var o=n/r*(2*wf)-wf,s=2*(Math.atan(Math.exp(wf-i/r*(2*wf)))-y2);return[o*x2,s*x2]}function $N(e){var r=e.latitude;assert(Number.isFinite(r));var t=Math.cos(r*qh);return Vk(L_*t)-9}function E2(e){var r=e.latitude,t=e.longitude,n=e.zoom,i=e.scale,o=e.highPrecision,s=o===void 0?!1:o;i=i!==void 0?i:b2(n),Cd(Number.isFinite(r)&&Number.isFinite(t)&&Number.isFinite(i));var l={},f=B_*i,v=Math.cos(r*qh),y=f/360,b=y/v,T=f/L_/v;if(l.pixelsPerMeter=[T,-T,T],l.metersPerPixel=[1/T,-1/T,1/T],l.pixelsPerDegree=[y,-b,T],l.degreesPerPixel=[1/y,-1/b,1/T],s){var M=qh*Math.tan(r*qh)/v,O=y*M/2,k=f/L_*M,$=k/b*T;l.pixelsPerDegree2=[0,-O,k],l.pixelsPerMeter2=[$,0,$]}return l}function YN(e,r){var t=_slicedToArray(e,3),n=t[0],i=t[1],o=t[2],s=_slicedToArray(r,3),l=s[0],f=s[1],v=s[2],y=1,b=E2({longitude:n,latitude:i,scale:y,highPrecision:!0}),T=b.pixelsPerMeter,M=b.pixelsPerMeter2,O=_0(e,y);O[0]+=l*(T[0]+M[0]*f),O[1]+=f*(T[1]+M[1]*f);var k=N_(O,y),$=(o||0)+(v||0);return Number.isFinite(o)||Number.isFinite(v)?[k[0],k[1],$]:k}function jk(e){var r=e.height,t=e.pitch,n=e.bearing,i=e.altitude,o=e.center,s=o===void 0?null:o,l=e.flipY,f=l===void 0?!1:l,v=Hm();return ve.translate(v,v,[0,0,-i]),ve.scale(v,v,[1,1,1/r]),ve.rotateX(v,v,-t*qh),ve.rotateZ(v,v,n*qh),f&&ve.scale(v,v,[1,-1,1]),s&&ve.translate(v,v,La.negate([],s)),v}function Hk(e){var r=e.width,t=e.height,n=e.altitude,i=n===void 0?Zk:n,o=e.pitch,s=o===void 0?0:o,l=e.nearZMultiplier,f=l===void 0?1:l,v=e.farZMultiplier,y=v===void 0?1:v,b=s*qh,T=Math.atan(.5/i),M=Math.sin(T)*i/Math.sin(Math.PI/2-b-T),O=Math.cos(Math.PI/2-b)*M+i;return{fov:2*Math.atan(t/2/i),aspect:r/t,focalDistance:i,near:f,far:O*y}}function Wk(e){var r=e.width,t=e.height,n=e.pitch,i=e.altitude,o=e.nearZMultiplier,s=e.farZMultiplier,l=Hk({width:r,height:t,altitude:i,pitch:n,nearZMultiplier:o,farZMultiplier:s}),f=l.fov,v=l.aspect,y=l.near,b=l.far,T=ve.perspective([],f,v,y,b);return T}function Gk(e,r){var t=(0,yn.Z)(e,3),n=t[0],i=t[1],o=t[2],s=o===void 0?0:o;return Cd(Number.isFinite(n)&&Number.isFinite(i)&&Number.isFinite(s)),g0(r,[n,i,s,1])}function S2(e,r){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=(0,yn.Z)(e,3),i=n[0],o=n[1],s=n[2];if(Cd(Number.isFinite(i)&&Number.isFinite(o),"invalid pixel coordinate"),Number.isFinite(s)){var l=g0(r,[i,o,s,1]);return l}var f=g0(r,[i,o,0,1]),v=g0(r,[i,o,1,1]),y=f[2],b=v[2],T=y===b?0:((t||0)-y)/(b-y);return Or.t7([],f,v,T)}var A2=Hm(),Xk=function(){function e(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=r.width,n=r.height,i=r.viewMatrix,o=i===void 0?A2:i,s=r.projectionMatrix,l=s===void 0?A2:s;(0,q.Z)(this,e),this.width=t||1,this.height=n||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=o,this.projectionMatrix=l;var f=Hm();ve.multiply(f,f,this.projectionMatrix),ve.multiply(f,f,this.viewMatrix),this.viewProjectionMatrix=f;var v=Hm();ve.scale(v,v,[this.width/2,-this.height/2,1]),ve.translate(v,v,[1,-1,0]),ve.multiply(v,v,this.viewProjectionMatrix);var y=ve.invert(Hm(),v);if(!y)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=v,this.pixelUnprojectionMatrix=y,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,V.Z)(e,[{key:"equals",value:function(t){return t instanceof e?t.width===this.width&&t.height===this.height&&ve.equals(t.projectionMatrix,this.projectionMatrix)&&ve.equals(t.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=n.topLeft,o=i===void 0?!0:i,s=this.projectPosition(t),l=Gk(s,this.pixelProjectionMatrix),f=(0,yn.Z)(l,2),v=f[0],y=f[1],b=o?y:this.height-y;return t.length===2?[v,b]:[v,b,l[2]]}},{key:"unproject",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=n.topLeft,o=i===void 0?!0:i,s=n.targetZ,l=(0,yn.Z)(t,3),f=l[0],v=l[1],y=l[2],b=o?v:this.height-v,T=s&&s*this.pixelsPerMeter,M=S2([f,b,y],this.pixelUnprojectionMatrix,T),O=this.unprojectPosition(M),k=(0,yn.Z)(O,3),$=k[0],G=k[1],oe=k[2];return Number.isFinite(y)?[$,G,oe]:Number.isFinite(s)?[$,G,s]:[$,G]}},{key:"projectPosition",value:function(t){var n=this.projectFlat(t),i=(0,yn.Z)(n,2),o=i[0],s=i[1],l=(t[2]||0)*this.pixelsPerMeter;return[o,s,l]}},{key:"unprojectPosition",value:function(t){var n=this.unprojectFlat(t),i=(0,yn.Z)(n,2),o=i[0],s=i[1],l=(t[2]||0)/this.pixelsPerMeter;return[o,s,l]}},{key:"projectFlat",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return t}},{key:"unprojectFlat",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return t}}]),e}();function $k(e){var r=e.width,t=e.height,n=e.bounds,i=e.minExtent,o=i===void 0?0:i,s=e.maxZoom,l=s===void 0?24:s,f=e.padding,v=f===void 0?0:f,y=e.offset,b=y===void 0?[0,0]:y,T=(0,yn.Z)(n,2),M=(0,yn.Z)(T[0],2),O=M[0],k=M[1],$=(0,yn.Z)(T[1],2),G=$[0],oe=$[1];if(Number.isFinite(v)){var ye=v;v={top:ye,bottom:ye,left:ye,right:ye}}else Cd(Number.isFinite(v.top)&&Number.isFinite(v.bottom)&&Number.isFinite(v.left)&&Number.isFinite(v.right));var Le=new T2({width:r,height:t,longitude:0,latitude:0,zoom:0}),$e=Le.project([O,oe]),ut=Le.project([G,k]),vt=[Math.max(Math.abs(ut[0]-$e[0]),o),Math.max(Math.abs(ut[1]-$e[1]),o)],Rt=[r-v.left-v.right-Math.abs(b[0])*2,t-v.top-v.bottom-Math.abs(b[1])*2];Cd(Rt[0]>0&&Rt[1]>0);var Jt=Rt[0]/vt[0],Mr=Rt[1]/vt[1],br=(v.right-v.left)/2/Jt,pn=(v.bottom-v.top)/2/Mr,kn=[(ut[0]+$e[0])/2+br,(ut[1]+$e[1])/2+pn],Pi=Le.unproject(kn),xa=Le.zoom+Math.log2(Math.abs(Math.min(Jt,Mr)));return{longitude:Pi[0],latitude:Pi[1],zoom:Math.min(xa,l)}}var T2=function(e){(0,De.Z)(r,e);function r(){var t,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=n.width,o=n.height,s=n.latitude,l=s===void 0?0:s,f=n.longitude,v=f===void 0?0:f,y=n.zoom,b=y===void 0?0:y,T=n.pitch,M=T===void 0?0:T,O=n.bearing,k=O===void 0?0:O,$=n.altitude,G=$===void 0?1.5:$,oe=n.nearZMultiplier,ye=n.farZMultiplier;(0,q.Z)(this,r),i=i||1,o=o||1;var Le=b2(b);G=Math.max(.75,G);var $e=_0([v,l],Le);$e[2]=0;var ut=Wk({width:i,height:o,pitch:M,bearing:k,altitude:G,nearZMultiplier:oe||1/o,farZMultiplier:ye||1.01}),vt=jk({height:o,center:$e,pitch:M,bearing:k,altitude:G,flipY:!0});return t=(0,et.Z)(this,(0,be.Z)(r).call(this,{width:i,height:o,viewMatrix:vt,projectionMatrix:ut})),t.latitude=l,t.longitude=v,t.zoom=b,t.pitch=M,t.bearing=k,t.altitude=G,t.scale=Le,t.center=$e,t.pixelsPerMeter=E2((0,Ie.Z)((0,Ie.Z)(t))).pixelsPerMeter[2],Object.freeze((0,Ie.Z)((0,Ie.Z)(t))),t}return(0,V.Z)(r,[{key:"projectFlat",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return _0(n,i)}},{key:"unprojectFlat",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return N_(n,i)}},{key:"getMapCenterByLngLatPosition",value:function(n){var i=n.lngLat,o=n.pos,s=S2(o,this.pixelUnprojectionMatrix),l=_0(i,this.scale),f=Or.IH([],l,Or.tk([],s)),v=Or.IH([],this.center,f);return N_(v,this.scale)}},{key:"getLocationAtPoint",value:function(n){var i=n.lngLat,o=n.pos;return this.getMapCenterByLngLatPosition({lngLat:i,pos:o})}},{key:"fitBounds",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=this.width,s=this.height,l=$k(Object.assign({width:o,height:s,bounds:n},i)),f=l.longitude,v=l.latitude,y=l.zoom;return new r({width:o,height:s,longitude:f,latitude:v,zoom:y})}}]),r}(Xk),Yk=function(){function e(){(0,q.Z)(this,e)}return(0,V.Z)(e,[{key:"syncWithMapCamera",value:function(t){var n=t.center,i=t.zoom,o=t.pitch,s=t.bearing,l=t.viewportHeight,f=t.viewportWidth;this.viewport=new T2({width:f,height:l,longitude:n&&n[0],latitude:n&&n[1],zoom:i,pitch:o,bearing:s})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(t,n){return this.viewport.projectFlat(t,n)}}]),e}(),qk=["id","attributionControl","style","token","rotation","mapInstance"],w2,C2;function Kk(e){var r=Qk();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function Qk(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Jk(e,r){var t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(t||n)&&(r||(r=document),!!r)){var i=r.head||r.getElementsByTagName("head")[0];if(!i){i=r.createElement("head");var o=r.body||r.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):r.documentElement.appendChild(i)}var s=r.createElement("style");return s.type="text/css",s.styleSheet?s.styleSheet.cssText=e:s.appendChild(r.createTextNode(e)),i.appendChild(s),s}}Jk(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=jm();var eF=0,R2="101MlGsZ2AmmA&access_token=pk.eyJ1IjoiZXhhbXBsZXMiLCJhIjoiY2p0MG01MXRqMW45cjQzb2R6b2ptc3J4MSJ9.zA2W0IkI0c6KaAhJfk9bWg",tF=(w2=(0,gt.b2)(),w2(C2=function(e){(0,De.Z)(t,e);var r=Kk(t);function t(){var n;(0,q.Z)(this,t);for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return n=r.call.apply(r,[this].concat(o)),(0,B.Z)((0,Ie.Z)(n),"version","MAPBOX"),n}return(0,V.Z)(t,[{key:"getType",value:function(){return"mapbox"}},{key:"lngLatToCoord",value:function(i){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{x:0,y:0,z:0},s=this.lngLatToMercator(i,0),l=s.x,f=s.y;return[l-o.x,f-o.y]}},{key:"lngLatToMercator",value:function(i,o){var s=window.mapboxgl.MercatorCoordinate.fromLngLat(i,o),l=s.x,f=l===void 0?0:l,v=s.y,y=v===void 0?0:v,b=s.z,T=b===void 0?0:b;return{x:f,y,z:T}}},{key:"getModelMatrix",value:function(i,o,s){var l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],f=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},v=window.mapboxgl.MercatorCoordinate.fromLngLat(i,o),y=v.meterInMercatorCoordinateUnits(),b=ve.create();return ve.translate(b,b,La.fromValues(v.x-f.x,v.y-f.y,v.z||0-f.z)),ve.scale(b,b,La.fromValues(y*l[0],-y*l[1],y*l[2])),ve.rotateX(b,b,s[0]),ve.rotateY(b,b,s[1]),ve.rotateZ(b,b,s[2]),b}},{key:"init",value:function(){var n=(0,Ct.Z)(me().mark(function o(){var s=this,l,f,v,y,b,T,M,O,k,$,G,oe,ye;return me().wrap(function($e){for(;;)switch($e.prev=$e.next){case 0:l=this.config,f=l.id,v=f===void 0?"map":f,y=l.attributionControl,b=y===void 0?!1:y,T=l.style,M=T===void 0?"light":T,O=l.token,k=O===void 0?R2:O,$=l.rotation,G=$===void 0?0:$,oe=l.mapInstance,ye=(0,Fa.Z)(l,qk),this.viewport=new Yk,!oe&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),k===R2&&M!=="blank"&&!window.mapboxgl.accessToken&&!oe&&console.warn(this.configService.getSceneWarninfo("MapToken")),!oe&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=k),oe?(this.map=oe,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatMapContainer(v),this.map=new window.mapboxgl.Map((0,H.Z)({container:this.$mapContainer,style:this.getMapStyleValue(M),attributionControl:b,bearing:G},ye))),this.map.on("load",function(){s.handleCameraChanged()}),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return $e.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"destroy",value:function(){var i;(i=this.$mapContainer)===null||i===void 0||(i=i.parentNode)===null||i===void 0||i.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(i){for(var o,s=arguments.length,l=new Array(s>1?s-1:0),f=1;f<s;f++)l[f-1]=arguments[f];(o=this.eventEmitter).emit.apply(o,[i].concat(l))}},{key:"once",value:function(i){for(var o,s=arguments.length,l=new Array(s>1?s-1:0),f=1;f<s;f++)l[f-1]=arguments[f];(o=this.eventEmitter).once.apply(o,[i].concat(l))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(i,o){var s=new(jm()).LngLat(i[0],i[1]),l=new(jm()).LngLat(o[0],o[1]),f=s.distanceTo(l),v=jm().MercatorCoordinate.fromLngLat({lng:i[0],lat:i[1]}),y=jm().MercatorCoordinate.fromLngLat({lng:o[0],lat:o[1]}),b=v.x,T=v.y,M=y.x,O=y.y,k=Math.sqrt(Math.pow(b-M,2)+Math.pow(T-O,2))*4194304*2;return k/f}},{key:"exportMap",value:function(i){var o=this.map.getCanvas(),s=i==="jpg"?o==null?void 0:o.toDataURL("image/jpeg"):o==null?void 0:o.toDataURL("image/png");return s}},{key:"creatMapContainer",value:function(i){var o=i;typeof i=="string"&&(o=document.getElementById(i));var s=document.createElement("div");return s.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,s.id="l7_mapbox_div"+eF++,o.appendChild(s),s}}]),t}(zk))||C2);function rF(e){var r=nF();return function(){var n=(0,be.Z)(e),i;if(r){var o=(0,be.Z)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,et.Z)(this,i)}}function nF(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function iF(e,r){var t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(t||n)&&(r||(r=document),!!r)){var i=r.head||r.getElementsByTagName("head")[0];if(!i){i=r.createElement("head");var o=r.body||r.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):r.documentElement.appendChild(i)}var s=r.createElement("style");return s.type="text/css",s.styleSheet?s.styleSheet.cssText=e:s.appendChild(r.createTextNode(e)),i.appendChild(s),s}}iF(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var aF=function(e){(0,De.Z)(t,e);var r=rF(t);function t(){return(0,q.Z)(this,t),r.apply(this,arguments)}return(0,V.Z)(t,[{key:"getServiceConstructor",value:function(){return tF}}]),t}(Fk);function Wm(e){"@babel/helpers - typeof";return Wm=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},Wm(e)}function M2(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function I2(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?M2(Object(t),!0).forEach(function(n){oF(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):M2(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function oF(e,r,t){return r=sF(r),r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function sF(e){var r=uF(e,"string");return Wm(r)==="symbol"?r:String(r)}function uF(e,r){if(Wm(e)!=="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var n=t.call(e,r||"default");if(Wm(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(e)}function lF(e,r){return pF(e)||hF(e,r)||fF(e,r)||cF()}function cF(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function fF(e,r){if(e){if(typeof e=="string")return P2(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return P2(e,r)}}function P2(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function hF(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n,i,o,s,l=[],f=!0,v=!1;try{if(o=(t=t.call(e)).next,r===0){if(Object(t)!==t)return;f=!1}else for(;!(f=(n=o.call(t)).done)&&(l.push(n.value),l.length!==r);f=!0);}catch(y){v=!0,i=y}finally{try{if(!f&&t.return!=null&&(s=t.return(),Object(s)!==s))return}finally{if(v)throw i}}return l}}function pF(e){if(Array.isArray(e))return e}var dF=re.memo(function(e){var r=e.style,t=e.className,n=e.map,i=e.option,o=e.onSceneLoaded,s=(0,re.createRef)(),l=(0,re.useState)(),f=lF(l,2),v=f[0],y=f[1];return(0,re.useEffect)(function(){var b=new Ck(I2(I2({id:s.current},i),{},{map:new aF(n)}));return b.on("loaded",function(){y(b),o&&o(b)}),function(){b.destroy()}},[]),(0,re.useEffect)(function(){v&&n.style&&v.setMapStyle(n.style)},[JSON.stringify(n.style)]),(0,re.useEffect)(function(){v&&n.zoom&&v.setZoom(n.zoom)},[n.zoom]),(0,re.useEffect)(function(){v&&n.center&&v.setCenter(n.center)},[JSON.stringify(n.center)]),(0,re.useEffect)(function(){v&&n.pitch!==void 0&&v.setPitch(n.pitch||0)},[n.pitch]),(0,re.useEffect)(function(){v&&n.rotation&&v.setRotation(n.rotation)},[n.rotation]),re.createElement(pe.Provider,{value:v},(0,re.createElement)("div",{ref:s,style:r,className:t},v&&e.children))}),vF=dF;function Gm(e){"@babel/helpers - typeof";return Gm=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},Gm(e)}function O2(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function qN(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?O2(Object(t),!0).forEach(function(n){mF(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):O2(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function mF(e,r,t){return r=gF(r),r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function gF(e){var r=_F(e,"string");return Gm(r)==="symbol"?r:String(r)}function _F(e,r){if(Gm(e)!=="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var n=t.call(e,r||"default");if(Gm(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(e)}function KN(e,r){return EF(e)||bF(e,r)||xF(e,r)||yF()}function yF(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function xF(e,r){if(e){if(typeof e=="string")return D2(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return D2(e,r)}}function D2(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function bF(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n,i,o,s,l=[],f=!0,v=!1;try{if(o=(t=t.call(e)).next,r===0){if(Object(t)!==t)return;f=!1}else for(;!(f=(n=o.call(t)).done)&&(l.push(n.value),l.length!==r);f=!0);}catch(y){v=!0,i=y}finally{try{if(!f&&t.return!=null&&(s=t.return(),Object(s)!==s))return}finally{if(v)throw i}}return l}}function EF(e){if(Array.isArray(e))return e}var QN=null,JN=null;function Xm(e){"@babel/helpers - typeof";return Xm=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},Xm(e)}function k2(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function e6(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?k2(Object(t),!0).forEach(function(n){SF(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):k2(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function SF(e,r,t){return r=AF(r),r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function AF(e){var r=TF(e,"string");return Xm(r)==="symbol"?r:String(r)}function TF(e,r){if(Xm(e)!=="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var n=t.call(e,r||"default");if(Xm(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(e)}function t6(e,r){return MF(e)||RF(e,r)||CF(e,r)||wF()}function wF(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function CF(e,r){if(e){if(typeof e=="string")return F2(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return F2(e,r)}}function F2(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function RF(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n,i,o,s,l=[],f=!0,v=!1;try{if(o=(t=t.call(e)).next,r===0){if(Object(t)!==t)return;f=!1}else for(;!(f=(n=o.call(t)).done)&&(l.push(n.value),l.length!==r);f=!0);}catch(y){v=!0,i=y}finally{try{if(!f&&t.return!=null&&(s=t.return(),Object(s)!==s))return}finally{if(v)throw i}}return l}}function MF(e){if(Array.isArray(e))return e}var r6=null,n6=null;function $m(e){"@babel/helpers - typeof";return $m=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},$m(e)}function B2(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function i6(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?B2(Object(t),!0).forEach(function(n){IF(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):B2(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function IF(e,r,t){return r=PF(r),r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function PF(e){var r=OF(e,"string");return $m(r)==="symbol"?r:String(r)}function OF(e,r){if($m(e)!=="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var n=t.call(e,r||"default");if($m(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(e)}function a6(e,r){return BF(e)||FF(e,r)||kF(e,r)||DF()}function DF(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function kF(e,r){if(e){if(typeof e=="string")return L2(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return L2(e,r)}}function L2(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function FF(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n,i,o,s,l=[],f=!0,v=!1;try{if(o=(t=t.call(e)).next,r===0){if(Object(t)!==t)return;f=!1}else for(;!(f=(n=o.call(t)).done)&&(l.push(n.value),l.length!==r);f=!0);}catch(y){v=!0,i=y}finally{try{if(!f&&t.return!=null&&(s=t.return(),Object(s)!==s))return}finally{if(v)throw i}}return l}}function BF(e){if(Array.isArray(e))return e}var o6=null,s6=null;function u6(e,r){return zF(e)||UF(e,r)||NF(e,r)||LF()}function LF(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function NF(e,r){if(e){if(typeof e=="string")return N2(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return N2(e,r)}}function N2(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function UF(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n,i,o,s,l=[],f=!0,v=!1;try{if(o=(t=t.call(e)).next,r===0){if(Object(t)!==t)return;f=!1}else for(;!(f=(n=o.call(t)).done)&&(l.push(n.value),l.length!==r);f=!0);}catch(y){v=!0,i=y}finally{try{if(!f&&t.return!=null&&(s=t.return(),Object(s)!==s))return}finally{if(v)throw i}}return l}}function zF(e){if(Array.isArray(e))return e}var l6=null;function Ym(e){"@babel/helpers - typeof";return Ym=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},Ym(e)}var c6=null;function U2(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function f6(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?U2(Object(t),!0).forEach(function(n){ZF(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):U2(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function ZF(e,r,t){return r=VF(r),r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function VF(e){var r=jF(e,"string");return Ym(r)==="symbol"?r:String(r)}function jF(e,r){if(Ym(e)!=="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var n=t.call(e,r||"default");if(Ym(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(e)}function h6(e,r){if(e==null)return{};var t=HF(e,r),n,i;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],!(r.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(t[n]=e[n])}return t}function HF(e,r){if(e==null)return{};var t={},n=Object.keys(e),i,o;for(o=0;o<n.length;o++)i=n[o],!(r.indexOf(i)>=0)&&(t[i]=e[i]);return t}var p6={exportImage:VT,fullscreen:XT,geoLocate:qT,layer:e1,layerSwitch:e1,logo:t1,mapTheme:aw,mouseLocation:uw,zoom:dw,scale:fw},d6=null,z2=L(10422);function Z2(e,r){return $F(e)||XF(e,r)||GF(e,r)||WF()}function WF(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function GF(e,r){if(e){if(typeof e=="string")return V2(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return V2(e,r)}}function V2(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function XF(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n,i,o,s,l=[],f=!0,v=!1;try{if(o=(t=t.call(e)).next,r===0){if(Object(t)!==t)return;f=!1}else for(;!(f=(n=o.call(t)).done)&&(l.push(n.value),l.length!==r);f=!0);}catch(y){v=!0,i=y}finally{try{if(!f&&t.return!=null&&(s=t.return(),Object(s)!==s))return}finally{if(v)throw i}}return l}}function $F(e){if(Array.isArray(e))return e}var j2=re.useEffect,H2=re.useState,YF=/\B([A-Z])/g,qF=function(r){return r.replace(YF,"-$1").toLowerCase()};function v6(e){var r=e.className,t=e.style,n=e.children,i=e.position,o=H2(),s=Z2(o,2),l=s[0],f=s[1],v=useSceneValue(),y=H2(function(){return document.createElement("div")}),b=Z2(y,1),T=b[0];return j2(function(){var M=new Control({position:i});return M.onAdd=function(){if(r&&(T.className=r),t){var O=Object.keys(t).map(function(k){return"".concat(qF(k),":").concat(t[k])}).join(";");T.style.cssText=O}return T},M.onRemove=function(){},f(M),v.addControl(M),function(){v.removeControl(M)}},[]),j2(function(){l&&l.setPosition(i||"bottomleft")},[i]),createPortal(n,T)}var W2=(0,re.createContext)({});function m6(){return useContext(W2)}var KF=re.memo(function(r){var t=r.layer,n=r.active;return t.active(n.option),null},ys()),QF=re.memo(function(r){var t=r.layer,n=r.animate;return t.animate(n),null},ys()),JF=re.memo(function(r){var t=r.layer,n=r.color;return n.field?t.color(n.field,n.values):t.color(n.values),null},ys()),eB=re.memo(function(r){var t=r.layer,n=r.filter;return n.field&&t.filter(n.field,n.values),null},ys()),tB=re.memo(function(r){var t=r.layer,n=r.scale;return t.scale(n.values),null},ys()),rB=re.memo(function(r){var t=r.layer,n=r.select;return t.select(n.option),null},ys()),nB=re.memo(function(r){var t=r.layer,n=r.shape;return n.field?t.shape(n.field,n.values):t.shape(n.values),null},ys()),iB=re.memo(function(r){var t=r.layer,n=r.size;return n.field?t.size(n.field,n.values):t.size(n.values),null},ys()),aB=["data"];function oB(e,r){if(e==null)return{};var t=sB(e,r),n,i;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],!(r.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(t[n]=e[n])}return t}function sB(e,r){if(e==null)return{};var t={},n=Object.keys(e),i,o;for(o=0;o<n.length;o++)i=n[o],!(r.indexOf(i)>=0)&&(t[i]=e[i]);return t}var uB=re.memo(function(r){var t=r.layer,n=r.source,i=n.data,o=oB(n,aB);return t.inited?t.setData(i,o):t.source(i,o),o.autoFit&&t.fitBounds(o&&o.fitBoundsOptions),null},ys()),g6=re.useEffect,lB=re.memo(function(r){var t=r.layer,n=r.style;return t.style(n),null},ys());function cB(e,r){return dB(e)||pB(e,r)||hB(e,r)||fB()}function fB(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function hB(e,r){if(e){if(typeof e=="string")return G2(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return G2(e,r)}}function G2(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function pB(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n,i,o,s,l=[],f=!0,v=!1;try{if(o=(t=t.call(e)).next,r===0){if(Object(t)!==t)return;f=!1}else for(;!(f=(n=o.call(t)).done)&&(l.push(n.value),l.length!==r);f=!0);}catch(y){v=!0,i=y}finally{try{if(!f&&t.return!=null&&(s=t.return(),Object(s)!==s))return}finally{if(v)throw i}}return l}}function dB(e){if(Array.isArray(e))return e}var qm=re.useEffect,vB=re.useState;function X2(e,r){var t=r.source,n=r.color,i=r.shape,o=r.style,s=r.size,l=r.scale,f=r.active,v=r.select,y=r.filter,b=r.animate,T=r.options,M=r.onLayerLoaded,O=_(),k=vB(function(){var oe;switch(e){case"polygonLayer":oe=new Rg(T);break;case"lineLayer":oe=new q0(T);break;case"pointLayer":oe=new Cg(T);break;case"heatmapLayer":oe=new RC(T);break;case"rasterLayer":oe=new Mg(T);break;case"imageLayer":oe=new P1(T);break;case"citybuildingLayer":oe=new Qw(T);break;default:oe=new Rg(T)}return oe.on("inited",function(){M&&M(oe,O)}),oe}),$=cB(k,1),G=$[0];return qm(function(){return O.addLayer(G),function(){O.removeLayer(G)}},[]),qm(function(){G.inited&&T&&G.updateLayerConfig(T)},[T==null?void 0:T.minZoom,T==null?void 0:T.maxZoom,T==null?void 0:T.visible]),qm(function(){G.inited&&(T!=null&&T.zIndex)&&G.setIndex(T.zIndex)},[T==null?void 0:T.zIndex]),qm(function(){G.inited&&(T!=null&&T.blend)&&G.setBlend(T.blend)},[T==null?void 0:T.blend]),qm(function(){O.render()}),re.createElement(W2.Provider,{value:G},re.createElement(uB,{layer:G,source:t}),l&&re.createElement(tB,{layer:G,scale:l}),n&&re.createElement(JF,{layer:G,color:n}),s&&re.createElement(iB,{layer:G,size:s}),i&&re.createElement(nB,{layer:G,shape:i}),o&&re.createElement(lB,{layer:G,style:o}),f&&re.createElement(KF,{layer:G,active:f}),v&&re.createElement(rB,{layer:G,select:v}),y&&re.createElement(eB,{layer:G,filter:y}),b&&re.createElement(QF,{layer:G,animate:b}),r.children)}var _6=null,y6=null,mB=re.memo(function(r){return X2("pointLayer",r)}),gB=re.memo(function(r){return X2("heatmapLayer",r)}),x6=null,b6=null,E6=null,S6=re.useEffect,A6=null,T6=null;function kv(e){"@babel/helpers - typeof";return kv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},kv(e)}function $2(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function y0(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?$2(Object(t),!0).forEach(function(n){_B(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):$2(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function _B(e,r,t){return r=q2(r),r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function yB(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function Y2(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,q2(n.key),n)}}function xB(e,r,t){return r&&Y2(e.prototype,r),t&&Y2(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function q2(e){var r=bB(e,"string");return kv(r)==="symbol"?r:String(r)}function bB(e,r){if(kv(e)!=="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var n=t.call(e,r||"default");if(kv(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(e)}function EB(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),r&&U_(e,r)}function U_(e,r){return U_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},U_(e,r)}function SB(e){var r=wB();return function(){var n=x0(e),i;if(r){var o=x0(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return AB(this,i)}}function AB(e,r){if(r&&(kv(r)==="object"||typeof r=="function"))return r;if(r!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return TB(e)}function TB(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function wB(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function x0(e){return x0=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},x0(e)}var w6=function(e){EB(t,e);var r=SB(t);function t(n){var i;return yB(this,t),i=r.call(this,n),i.el=void 0,i.scene=void 0,i.popup=void 0,i.el=document.createElement("div"),i}return xB(t,[{key:"componentDidMount",value:function(){var i,o=this.props,s=o.lnglat,l=o.children,f=o.option,v=o.lngLat,y=new r1(y0(y0({},f),{},{stopPropagation:(i=this.props.option)===null||i===void 0?void 0:i.stopPropagation}));s&&y.setLnglat(s),v&&y.setLnglat(v),l&&y.setHTML(this.el),this.popup=y,this.scene.addPopup(y)}},{key:"componentDidUpdate",value:function(i){var o,s,l,f,v,y,b=Array.isArray(i.lnglat)?i.lnglat:[i==null||(o=i.lnglat)===null||o===void 0?void 0:o.lng,i==null||(s=i.lnglat)===null||s===void 0?void 0:s.lat],T=Array.isArray(this.props.lnglat)?this.props.lnglat:[(l=this.props)===null||l===void 0||(f=l.lnglat)===null||f===void 0?void 0:f.lng,(v=this.props)===null||v===void 0||(y=v.lnglat)===null||y===void 0?void 0:y.lat],M=b.toString()!==T.toString();if(M){var O;this.popup.remove(),this.popup=new r1(y0(y0({},this.props.option),{},{stopPropagation:(O=this.props.option)===null||O===void 0?void 0:O.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setHTML(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var i=this;return re.createElement(pe.Consumer,{},function(o){return o&&(i.scene=o),(0,z2.createPortal)(i.props.children,i.el)})}}]),t}(re.PureComponent);function Fv(e){"@babel/helpers - typeof";return Fv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},Fv(e)}function CB(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function K2(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,MB(n.key),n)}}function RB(e,r,t){return r&&K2(e.prototype,r),t&&K2(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function MB(e){var r=IB(e,"string");return Fv(r)==="symbol"?r:String(r)}function IB(e,r){if(Fv(e)!=="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var n=t.call(e,r||"default");if(Fv(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(e)}function PB(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),r&&z_(e,r)}function z_(e,r){return z_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},z_(e,r)}function OB(e){var r=FB();return function(){var n=b0(e),i;if(r){var o=b0(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return DB(this,i)}}function DB(e,r){if(r&&(Fv(r)==="object"||typeof r=="function"))return r;if(r!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return kB(e)}function kB(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function FB(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function b0(e){return b0=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},b0(e)}var C6=function(e){PB(t,e);var r=OB(t);function t(n){var i;return CB(this,t),i=r.call(this,n),i.el=void 0,i.scene=void 0,i.marker=void 0,i.el=document.createElement("div"),i}return RB(t,[{key:"componentDidMount",value:function(){var i=this.props,o=i.lnglat,s=i.children,l=i.option,f=i.onMarkerLoaded,v=new wT(l);o&&v.setLnglat(o),s&&v.setElement(this.el),this.marker=v,f&&f(v),this.scene.addMarker(v)}},{key:"componentDidUpdate",value:function(i){var o,s=JSON.stringify(i==null?void 0:i.lnglat)!==JSON.stringify((o=this.props)===null||o===void 0?void 0:o.lnglat);s&&this.props.lnglat&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var i=this;return re.createElement(pe.Consumer,{},function(o){return o&&(i.scene=o),(0,z2.createPortal)(i.props.children,i.el)})}}]),t}(re.PureComponent),R6=re.useEffect,M6=null,I6=null,P6=re.useEffect,O6=null},47903:function(rr){rr.exports=J;function J(pe,_){var le=pe&&pe.type,U;if(le==="FeatureCollection")for(U=0;U<pe.features.length;U++)J(pe.features[U],_);else if(le==="GeometryCollection")for(U=0;U<pe.geometries.length;U++)J(pe.geometries[U],_);else if(le==="Feature")J(pe.geometry,_);else if(le==="Polygon")L(pe.coordinates,_);else if(le==="MultiPolygon")for(U=0;U<pe.coordinates.length;U++)L(pe.coordinates[U],_);return pe}function L(pe,_){if(pe.length!==0){re(pe[0],_);for(var le=1;le<pe.length;le++)re(pe[le],!_)}}function re(pe,_){for(var le=0,U=0,he=0,ae=pe.length,qe=ae-1;he<ae;qe=he++){var ie=(pe[he][0]-pe[qe][0])*(pe[qe][1]+pe[he][1]),Ke=le+ie;U+=Math.abs(le)>=Math.abs(ie)?le-Ke+ie:ie-Ke+le,le=Ke}le+U>=0!=!!_&&pe.reverse()}},96542:function(rr){"use strict";rr.exports=J;function J(L,re){this.x=L,this.y=re}J.prototype={clone:function(){return new J(this.x,this.y)},add:function(L){return this.clone()._add(L)},sub:function(L){return this.clone()._sub(L)},multByPoint:function(L){return this.clone()._multByPoint(L)},divByPoint:function(L){return this.clone()._divByPoint(L)},mult:function(L){return this.clone()._mult(L)},div:function(L){return this.clone()._div(L)},rotate:function(L){return this.clone()._rotate(L)},rotateAround:function(L,re){return this.clone()._rotateAround(L,re)},matMult:function(L){return this.clone()._matMult(L)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(L){return this.x===L.x&&this.y===L.y},dist:function(L){return Math.sqrt(this.distSqr(L))},distSqr:function(L){var re=L.x-this.x,pe=L.y-this.y;return re*re+pe*pe},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(L){return Math.atan2(this.y-L.y,this.x-L.x)},angleWith:function(L){return this.angleWithSep(L.x,L.y)},angleWithSep:function(L,re){return Math.atan2(this.x*re-this.y*L,this.x*L+this.y*re)},_matMult:function(L){var re=L[0]*this.x+L[1]*this.y,pe=L[2]*this.x+L[3]*this.y;return this.x=re,this.y=pe,this},_add:function(L){return this.x+=L.x,this.y+=L.y,this},_sub:function(L){return this.x-=L.x,this.y-=L.y,this},_mult:function(L){return this.x*=L,this.y*=L,this},_div:function(L){return this.x/=L,this.y/=L,this},_multByPoint:function(L){return this.x*=L.x,this.y*=L.y,this},_divByPoint:function(L){return this.x/=L.x,this.y/=L.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var L=this.y;return this.y=this.x,this.x=-L,this},_rotate:function(L){var re=Math.cos(L),pe=Math.sin(L),_=re*this.x-pe*this.y,le=pe*this.x+re*this.y;return this.x=_,this.y=le,this},_rotateAround:function(L,re){var pe=Math.cos(L),_=Math.sin(L),le=re.x+pe*(this.x-re.x)-_*(this.y-re.y),U=re.y+_*(this.x-re.x)+pe*(this.y-re.y);return this.x=le,this.y=U,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},J.convert=function(L){return L instanceof J?L:Array.isArray(L)?new J(L[0],L[1]):L}},25865:function(rr){"use strict";rr.exports=L,rr.exports.default=L;var J=1e20;function L(U,he,ae,qe,ie,Ke){this.fontSize=U||24,this.buffer=he===void 0?3:he,this.cutoff=qe||.25,this.fontFamily=ie||"sans-serif",this.fontWeight=Ke||"normal",this.radius=ae||8;var ht=this.size=this.fontSize+this.buffer*2,mt=ht+this.buffer*2;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=ht,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(mt*mt),this.gridInner=new Float64Array(mt*mt),this.f=new Float64Array(mt),this.z=new Float64Array(mt+1),this.v=new Uint16Array(mt),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,this.middle=Math.round(ht/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function re(U,he,ae,qe,ie,Ke,ht){Ke.fill(J,0,he*ae),ht.fill(0,0,he*ae);for(var mt=(he-qe)/2,Dt=0;Dt<ie;Dt++)for(var Yt=0;Yt<qe;Yt++){var Ht=(Dt+mt)*he+Yt+mt,ir=U.data[4*(Dt*qe+Yt)+3]/255;if(ir===1)Ke[Ht]=0,ht[Ht]=J;else if(ir===0)Ke[Ht]=J,ht[Ht]=0;else{var Xt=Math.max(0,.5-ir),yt=Math.max(0,ir-.5);Ke[Ht]=Xt*Xt,ht[Ht]=yt*yt}}}function pe(U,he,ae,qe,ie,Ke,ht){for(var mt=0;mt<he*ae;mt++){var Dt=Math.sqrt(qe[mt])-Math.sqrt(ie[mt]);U[mt]=Math.round(255-255*(Dt/Ke+ht))}}L.prototype._draw=function(U,he){var ae=this.ctx.measureText(U),qe=ae.width,ie=2*this.buffer,Ke,ht,mt,Dt,Yt,Ht,ir,Xt;he&&this.useMetrics?(Yt=Math.floor(ae.actualBoundingBoxAscent),Xt=this.buffer+Math.ceil(ae.actualBoundingBoxAscent),Ht=this.buffer,ir=this.buffer,ht=Math.min(this.size,Math.ceil(ae.actualBoundingBoxRight-ae.actualBoundingBoxLeft)),Dt=Math.min(this.size-Ht,Math.ceil(ae.actualBoundingBoxAscent+ae.actualBoundingBoxDescent)),Ke=ht+ie,mt=Dt+ie,this.ctx.textBaseline="alphabetic"):(Ke=ht=this.size,mt=Dt=this.size,Yt=19*this.fontSize/24,Ht=ir=0,Xt=this.middle,this.ctx.textBaseline="middle");var yt;ht&&Dt&&(this.ctx.clearRect(ir,Ht,ht,Dt),this.ctx.fillText(U,this.buffer,Xt),yt=this.ctx.getImageData(ir,Ht,ht,Dt));var bt=new Uint8ClampedArray(Ke*mt);return re(yt,Ke,mt,ht,Dt,this.gridOuter,this.gridInner),_(this.gridOuter,Ke,mt,this.f,this.v,this.z),_(this.gridInner,Ke,mt,this.f,this.v,this.z),pe(bt,Ke,mt,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:bt,metrics:{width:ht,height:Dt,sdfWidth:Ke,sdfHeight:mt,top:Yt,left:0,advance:qe}}},L.prototype.draw=function(U){return this._draw(U,!1).data},L.prototype.drawWithMetrics=function(U){return this._draw(U,!0)};function _(U,he,ae,qe,ie,Ke){for(var ht=0;ht<he;ht++)le(U,ht,he,ae,qe,ie,Ke);for(var mt=0;mt<ae;mt++)le(U,mt*he,1,he,qe,ie,Ke)}function le(U,he,ae,qe,ie,Ke,ht){var mt,Dt,Yt,Ht;for(Ke[0]=0,ht[0]=-J,ht[1]=J,mt=0;mt<qe;mt++)ie[mt]=U[he+mt*ae];for(mt=1,Dt=0,Yt=0;mt<qe;mt++){do Ht=Ke[Dt],Yt=(ie[mt]-ie[Ht]+mt*mt-Ht*Ht)/(mt-Ht)/2;while(Yt<=ht[Dt]&&--Dt>-1);Dt++,Ke[Dt]=mt,ht[Dt]=Yt,ht[Dt+1]=J}for(mt=0,Dt=0;mt<qe;mt++){for(;ht[Dt+1]<mt;)Dt++;Ht=Ke[Dt],U[he+mt*ae]=ie[Ht]+(mt-Ht)*(mt-Ht)}}},99996:function(rr,J,L){rr.exports.VectorTile=L(14253),L(35752),L(143)},14253:function(rr,J,L){"use strict";var re=L(143);rr.exports=pe;function pe(le,U){this.layers=le.readFields(_,{},U)}function _(le,U,he){if(le===3){var ae=new re(he,he.readVarint()+he.pos);ae.length&&(U[ae.name]=ae)}}},35752:function(rr,J,L){"use strict";var re=L(96542);rr.exports=pe;function pe(ae,qe,ie,Ke,ht){this.properties={},this.extent=ie,this.type=0,this._pbf=ae,this._geometry=-1,this._keys=Ke,this._values=ht,ae.readFields(_,this,qe)}function _(ae,qe,ie){ae==1?qe.id=ie.readVarint():ae==2?le(ie,qe):ae==3?qe.type=ie.readVarint():ae==4&&(qe._geometry=ie.pos)}function le(ae,qe){for(var ie=ae.readVarint()+ae.pos;ae.pos<ie;){var Ke=qe._keys[ae.readVarint()],ht=qe._values[ae.readVarint()];qe.properties[Ke]=ht}}pe.types=["Unknown","Point","LineString","Polygon"],pe.prototype.loadGeometry=function(){var ae=this._pbf;ae.pos=this._geometry;for(var qe=ae.readVarint()+ae.pos,ie=1,Ke=0,ht=0,mt=0,Dt=[],Yt;ae.pos<qe;){if(Ke<=0){var Ht=ae.readVarint();ie=Ht&7,Ke=Ht>>3}if(Ke--,ie===1||ie===2)ht+=ae.readSVarint(),mt+=ae.readSVarint(),ie===1&&(Yt&&Dt.push(Yt),Yt=[]),Yt.push(new re(ht,mt));else if(ie===7)Yt&&Yt.push(Yt[0].clone());else throw new Error("unknown command "+ie)}return Yt&&Dt.push(Yt),Dt},pe.prototype.bbox=function(){var ae=this._pbf;ae.pos=this._geometry;for(var qe=ae.readVarint()+ae.pos,ie=1,Ke=0,ht=0,mt=0,Dt=1/0,Yt=-1/0,Ht=1/0,ir=-1/0;ae.pos<qe;){if(Ke<=0){var Xt=ae.readVarint();ie=Xt&7,Ke=Xt>>3}if(Ke--,ie===1||ie===2)ht+=ae.readSVarint(),mt+=ae.readSVarint(),ht<Dt&&(Dt=ht),ht>Yt&&(Yt=ht),mt<Ht&&(Ht=mt),mt>ir&&(ir=mt);else if(ie!==7)throw new Error("unknown command "+ie)}return[Dt,Ht,Yt,ir]},pe.prototype.toGeoJSON=function(ae,qe,ie){var Ke=this.extent*Math.pow(2,ie),ht=this.extent*ae,mt=this.extent*qe,Dt=this.loadGeometry(),Yt=pe.types[this.type],Ht,ir;function Xt(Pr){for(var hr=0;hr<Pr.length;hr++){var ur=Pr[hr],Et=180-(ur.y+mt)*360/Ke;Pr[hr]=[(ur.x+ht)*360/Ke-180,360/Math.PI*Math.atan(Math.exp(Et*Math.PI/180))-90]}}switch(this.type){case 1:var yt=[];for(Ht=0;Ht<Dt.length;Ht++)yt[Ht]=Dt[Ht][0];Dt=yt,Xt(Dt);break;case 2:for(Ht=0;Ht<Dt.length;Ht++)Xt(Dt[Ht]);break;case 3:for(Dt=U(Dt),Ht=0;Ht<Dt.length;Ht++)for(ir=0;ir<Dt[Ht].length;ir++)Xt(Dt[Ht][ir]);break}Dt.length===1?Dt=Dt[0]:Yt="Multi"+Yt;var bt={type:"Feature",geometry:{type:Yt,coordinates:Dt},properties:this.properties};return"id"in this&&(bt.id=this.id),bt};function U(ae){var qe=ae.length;if(qe<=1)return[ae];for(var ie=[],Ke,ht,mt=0;mt<qe;mt++){var Dt=he(ae[mt]);Dt!==0&&(ht===void 0&&(ht=Dt<0),ht===Dt<0?(Ke&&ie.push(Ke),Ke=[ae[mt]]):Ke.push(ae[mt]))}return Ke&&ie.push(Ke),ie}function he(ae){for(var qe=0,ie=0,Ke=ae.length,ht=Ke-1,mt,Dt;ie<Ke;ht=ie++)mt=ae[ie],Dt=ae[ht],qe+=(Dt.x-mt.x)*(mt.y+Dt.y);return qe}},143:function(rr,J,L){"use strict";var re=L(35752);rr.exports=pe;function pe(U,he){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=U,this._keys=[],this._values=[],this._features=[],U.readFields(_,this,he),this.length=this._features.length}function _(U,he,ae){U===15?he.version=ae.readVarint():U===1?he.name=ae.readString():U===5?he.extent=ae.readVarint():U===2?he._features.push(ae.pos):U===3?he._keys.push(ae.readString()):U===4&&he._values.push(le(ae))}function le(U){for(var he=null,ae=U.readVarint()+U.pos;U.pos<ae;){var qe=U.readVarint()>>3;he=qe===1?U.readString():qe===2?U.readFloat():qe===3?U.readDouble():qe===4?U.readVarint64():qe===5?U.readVarint():qe===6?U.readSVarint():qe===7?U.readBoolean():null}return he}pe.prototype.feature=function(U){if(U<0||U>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[U];var he=this._pbf.readVarint()+this._pbf.pos;return new re(this._pbf,he,this.extent,this._keys,this._values)}},75734:function(rr){"use strict";rr.exports=J,rr.exports.default=J;function J(K,Be,Ae){Ae=Ae||2;var dt=Be&&Be.length,Ue=dt?Be[0]*Ae:K.length,We=L(K,0,Ue,Ae,!0),it=[];if(!We||We.next===We.prev)return it;var Mt,yr,lr,Cn,mn,un,oi;if(dt&&(We=ae(K,Be,We,Ae)),K.length>80*Ae){Mt=lr=K[0],yr=Cn=K[1];for(var jn=Ae;jn<Ue;jn+=Ae)mn=K[jn],un=K[jn+1],mn<Mt&&(Mt=mn),un<yr&&(yr=un),mn>lr&&(lr=mn),un>Cn&&(Cn=un);oi=Math.max(lr-Mt,Cn-yr),oi=oi!==0?32767/oi:0}return pe(We,it,Ae,Mt,yr,oi,0),it}function L(K,Be,Ae,dt,Ue){var We,it;if(Ue===H(K,Be,Ae,dt)>0)for(We=Be;We<Ae;We+=dt)it=qt(We,K[We],K[We+1],it);else for(We=Ae-dt;We>=Be;We-=dt)it=qt(We,K[We],K[We+1],it);return it&&bt(it,it.next)&&(Sr(it),it=it.next),it}function re(K,Be){if(!K)return K;Be||(Be=K);var Ae=K,dt;do if(dt=!1,!Ae.steiner&&(bt(Ae,Ae.next)||yt(Ae.prev,Ae,Ae.next)===0)){if(Sr(Ae),Ae=Be=Ae.prev,Ae===Ae.next)break;dt=!0}else Ae=Ae.next;while(dt||Ae!==Be);return Be}function pe(K,Be,Ae,dt,Ue,We,it){if(K){!it&&We&&mt(K,dt,Ue,We);for(var Mt=K,yr,lr;K.prev!==K.next;){if(yr=K.prev,lr=K.next,We?le(K,dt,Ue,We):_(K)){Be.push(yr.i/Ae|0),Be.push(K.i/Ae|0),Be.push(lr.i/Ae|0),Sr(K),K=lr.next,Mt=lr.next;continue}if(K=lr,K===Mt){it?it===1?(K=U(re(K),Be,Ae),pe(K,Be,Ae,dt,Ue,We,2)):it===2&&he(K,Be,Ae,dt,Ue,We):pe(re(K),Be,Ae,dt,Ue,We,1);break}}}}function _(K){var Be=K.prev,Ae=K,dt=K.next;if(yt(Be,Ae,dt)>=0)return!1;for(var Ue=Be.x,We=Ae.x,it=dt.x,Mt=Be.y,yr=Ae.y,lr=dt.y,Cn=Ue<We?Ue<it?Ue:it:We<it?We:it,mn=Mt<yr?Mt<lr?Mt:lr:yr<lr?yr:lr,un=Ue>We?Ue>it?Ue:it:We>it?We:it,oi=Mt>yr?Mt>lr?Mt:lr:yr>lr?yr:lr,jn=dt.next;jn!==Be;){if(jn.x>=Cn&&jn.x<=un&&jn.y>=mn&&jn.y<=oi&&ir(Ue,Mt,We,yr,it,lr,jn.x,jn.y)&&yt(jn.prev,jn,jn.next)>=0)return!1;jn=jn.next}return!0}function le(K,Be,Ae,dt){var Ue=K.prev,We=K,it=K.next;if(yt(Ue,We,it)>=0)return!1;for(var Mt=Ue.x,yr=We.x,lr=it.x,Cn=Ue.y,mn=We.y,un=it.y,oi=Mt<yr?Mt<lr?Mt:lr:yr<lr?yr:lr,jn=Cn<mn?Cn<un?Cn:un:mn<un?mn:un,rn=Mt>yr?Mt>lr?Mt:lr:yr>lr?yr:lr,$i=Cn>mn?Cn>un?Cn:un:mn>un?mn:un,Wi=Yt(oi,jn,Be,Ae,dt),Zi=Yt(rn,$i,Be,Ae,dt),Jn=K.prevZ,Bn=K.nextZ;Jn&&Jn.z>=Wi&&Bn&&Bn.z<=Zi;){if(Jn.x>=oi&&Jn.x<=rn&&Jn.y>=jn&&Jn.y<=$i&&Jn!==Ue&&Jn!==it&&ir(Mt,Cn,yr,mn,lr,un,Jn.x,Jn.y)&&yt(Jn.prev,Jn,Jn.next)>=0||(Jn=Jn.prevZ,Bn.x>=oi&&Bn.x<=rn&&Bn.y>=jn&&Bn.y<=$i&&Bn!==Ue&&Bn!==it&&ir(Mt,Cn,yr,mn,lr,un,Bn.x,Bn.y)&&yt(Bn.prev,Bn,Bn.next)>=0))return!1;Bn=Bn.nextZ}for(;Jn&&Jn.z>=Wi;){if(Jn.x>=oi&&Jn.x<=rn&&Jn.y>=jn&&Jn.y<=$i&&Jn!==Ue&&Jn!==it&&ir(Mt,Cn,yr,mn,lr,un,Jn.x,Jn.y)&&yt(Jn.prev,Jn,Jn.next)>=0)return!1;Jn=Jn.prevZ}for(;Bn&&Bn.z<=Zi;){if(Bn.x>=oi&&Bn.x<=rn&&Bn.y>=jn&&Bn.y<=$i&&Bn!==Ue&&Bn!==it&&ir(Mt,Cn,yr,mn,lr,un,Bn.x,Bn.y)&&yt(Bn.prev,Bn,Bn.next)>=0)return!1;Bn=Bn.nextZ}return!0}function U(K,Be,Ae){var dt=K;do{var Ue=dt.prev,We=dt.next.next;!bt(Ue,We)&&Pr(Ue,dt,dt.next,We)&&nt(Ue,We)&&nt(We,Ue)&&(Be.push(Ue.i/Ae|0),Be.push(dt.i/Ae|0),Be.push(We.i/Ae|0),Sr(dt),Sr(dt.next),dt=K=We),dt=dt.next}while(dt!==K);return re(dt)}function he(K,Be,Ae,dt,Ue,We){var it=K;do{for(var Mt=it.next.next;Mt!==it.prev;){if(it.i!==Mt.i&&Xt(it,Mt)){var yr=ft(it,Mt);it=re(it,it.next),yr=re(yr,yr.next),pe(it,Be,Ae,dt,Ue,We,0),pe(yr,Be,Ae,dt,Ue,We,0);return}Mt=Mt.next}it=it.next}while(it!==K)}function ae(K,Be,Ae,dt){var Ue=[],We,it,Mt,yr,lr;for(We=0,it=Be.length;We<it;We++)Mt=Be[We]*dt,yr=We<it-1?Be[We+1]*dt:K.length,lr=L(K,Mt,yr,dt,!1),lr===lr.next&&(lr.steiner=!0),Ue.push(Ht(lr));for(Ue.sort(qe),We=0;We<Ue.length;We++)Ae=ie(Ue[We],Ae);return Ae}function qe(K,Be){return K.x-Be.x}function ie(K,Be){var Ae=Ke(K,Be);if(!Ae)return Be;var dt=ft(Ae,K);return re(dt,dt.next),re(Ae,Ae.next)}function Ke(K,Be){var Ae=Be,dt=K.x,Ue=K.y,We=-1/0,it;do{if(Ue<=Ae.y&&Ue>=Ae.next.y&&Ae.next.y!==Ae.y){var Mt=Ae.x+(Ue-Ae.y)*(Ae.next.x-Ae.x)/(Ae.next.y-Ae.y);if(Mt<=dt&&Mt>We&&(We=Mt,it=Ae.x<Ae.next.x?Ae:Ae.next,Mt===dt))return it}Ae=Ae.next}while(Ae!==Be);if(!it)return null;var yr=it,lr=it.x,Cn=it.y,mn=1/0,un;Ae=it;do dt>=Ae.x&&Ae.x>=lr&&dt!==Ae.x&&ir(Ue<Cn?dt:We,Ue,lr,Cn,Ue<Cn?We:dt,Ue,Ae.x,Ae.y)&&(un=Math.abs(Ue-Ae.y)/(dt-Ae.x),nt(Ae,K)&&(un<mn||un===mn&&(Ae.x>it.x||Ae.x===it.x&&ht(it,Ae)))&&(it=Ae,mn=un)),Ae=Ae.next;while(Ae!==yr);return it}function ht(K,Be){return yt(K.prev,K,Be.prev)<0&&yt(Be.next,K,K.next)<0}function mt(K,Be,Ae,dt){var Ue=K;do Ue.z===0&&(Ue.z=Yt(Ue.x,Ue.y,Be,Ae,dt)),Ue.prevZ=Ue.prev,Ue.nextZ=Ue.next,Ue=Ue.next;while(Ue!==K);Ue.prevZ.nextZ=null,Ue.prevZ=null,Dt(Ue)}function Dt(K){var Be,Ae,dt,Ue,We,it,Mt,yr,lr=1;do{for(Ae=K,K=null,We=null,it=0;Ae;){for(it++,dt=Ae,Mt=0,Be=0;Be<lr&&(Mt++,dt=dt.nextZ,!!dt);Be++);for(yr=lr;Mt>0||yr>0&&dt;)Mt!==0&&(yr===0||!dt||Ae.z<=dt.z)?(Ue=Ae,Ae=Ae.nextZ,Mt--):(Ue=dt,dt=dt.nextZ,yr--),We?We.nextZ=Ue:K=Ue,Ue.prevZ=We,We=Ue;Ae=dt}We.nextZ=null,lr*=2}while(it>1);return K}function Yt(K,Be,Ae,dt,Ue){return K=(K-Ae)*Ue|0,Be=(Be-dt)*Ue|0,K=(K|K<<8)&16711935,K=(K|K<<4)&252645135,K=(K|K<<2)&858993459,K=(K|K<<1)&1431655765,Be=(Be|Be<<8)&16711935,Be=(Be|Be<<4)&252645135,Be=(Be|Be<<2)&858993459,Be=(Be|Be<<1)&1431655765,K|Be<<1}function Ht(K){var Be=K,Ae=K;do(Be.x<Ae.x||Be.x===Ae.x&&Be.y<Ae.y)&&(Ae=Be),Be=Be.next;while(Be!==K);return Ae}function ir(K,Be,Ae,dt,Ue,We,it,Mt){return(Ue-it)*(Be-Mt)>=(K-it)*(We-Mt)&&(K-it)*(dt-Mt)>=(Ae-it)*(Be-Mt)&&(Ae-it)*(We-Mt)>=(Ue-it)*(dt-Mt)}function Xt(K,Be){return K.next.i!==Be.i&&K.prev.i!==Be.i&&!Et(K,Be)&&(nt(K,Be)&&nt(Be,K)&&Pt(K,Be)&&(yt(K.prev,K,Be.prev)||yt(K,Be.prev,Be))||bt(K,Be)&&yt(K.prev,K,K.next)>0&&yt(Be.prev,Be,Be.next)>0)}function yt(K,Be,Ae){return(Be.y-K.y)*(Ae.x-Be.x)-(Be.x-K.x)*(Ae.y-Be.y)}function bt(K,Be){return K.x===Be.x&&K.y===Be.y}function Pr(K,Be,Ae,dt){var Ue=ur(yt(K,Be,Ae)),We=ur(yt(K,Be,dt)),it=ur(yt(Ae,dt,K)),Mt=ur(yt(Ae,dt,Be));return!!(Ue!==We&&it!==Mt||Ue===0&&hr(K,Ae,Be)||We===0&&hr(K,dt,Be)||it===0&&hr(Ae,K,dt)||Mt===0&&hr(Ae,Be,dt))}function hr(K,Be,Ae){return Be.x<=Math.max(K.x,Ae.x)&&Be.x>=Math.min(K.x,Ae.x)&&Be.y<=Math.max(K.y,Ae.y)&&Be.y>=Math.min(K.y,Ae.y)}function ur(K){return K>0?1:K<0?-1:0}function Et(K,Be){var Ae=K;do{if(Ae.i!==K.i&&Ae.next.i!==K.i&&Ae.i!==Be.i&&Ae.next.i!==Be.i&&Pr(Ae,Ae.next,K,Be))return!0;Ae=Ae.next}while(Ae!==K);return!1}function nt(K,Be){return yt(K.prev,K,K.next)<0?yt(K,Be,K.next)>=0&&yt(K,K.prev,Be)>=0:yt(K,Be,K.prev)<0||yt(K,K.next,Be)<0}function Pt(K,Be){var Ae=K,dt=!1,Ue=(K.x+Be.x)/2,We=(K.y+Be.y)/2;do Ae.y>We!=Ae.next.y>We&&Ae.next.y!==Ae.y&&Ue<(Ae.next.x-Ae.x)*(We-Ae.y)/(Ae.next.y-Ae.y)+Ae.x&&(dt=!dt),Ae=Ae.next;while(Ae!==K);return dt}function ft(K,Be){var Ae=new te(K.i,K.x,K.y),dt=new te(Be.i,Be.x,Be.y),Ue=K.next,We=Be.prev;return K.next=Be,Be.prev=K,Ae.next=Ue,Ue.prev=Ae,dt.next=Ae,Ae.prev=dt,We.next=dt,dt.prev=We,dt}function qt(K,Be,Ae,dt){var Ue=new te(K,Be,Ae);return dt?(Ue.next=dt.next,Ue.prev=dt,dt.next.prev=Ue,dt.next=Ue):(Ue.prev=Ue,Ue.next=Ue),Ue}function Sr(K){K.next.prev=K.prev,K.prev.next=K.next,K.prevZ&&(K.prevZ.nextZ=K.nextZ),K.nextZ&&(K.nextZ.prevZ=K.prevZ)}function te(K,Be,Ae){this.i=K,this.x=Be,this.y=Ae,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}J.deviation=function(K,Be,Ae,dt){var Ue=Be&&Be.length,We=Ue?Be[0]*Ae:K.length,it=Math.abs(H(K,0,We,Ae));if(Ue)for(var Mt=0,yr=Be.length;Mt<yr;Mt++){var lr=Be[Mt]*Ae,Cn=Mt<yr-1?Be[Mt+1]*Ae:K.length;it-=Math.abs(H(K,lr,Cn,Ae))}var mn=0;for(Mt=0;Mt<dt.length;Mt+=3){var un=dt[Mt]*Ae,oi=dt[Mt+1]*Ae,jn=dt[Mt+2]*Ae;mn+=Math.abs((K[un]-K[jn])*(K[oi+1]-K[un+1])-(K[un]-K[oi])*(K[jn+1]-K[un+1]))}return it===0&&mn===0?0:Math.abs((mn-it)/it)};function H(K,Be,Ae,dt){for(var Ue=0,We=Be,it=Ae-dt;We<Ae;We+=dt)Ue+=(K[it]-K[We])*(K[We+1]+K[it+1]),it=We;return Ue}J.flatten=function(K){for(var Be=K[0][0].length,Ae={vertices:[],holes:[],dimensions:Be},dt=0,Ue=0;Ue<K.length;Ue++){for(var We=0;We<K[Ue].length;We++)for(var it=0;it<Be;it++)Ae.vertices.push(K[Ue][We][it]);Ue>0&&(dt+=K[Ue-1].length,Ae.holes.push(dt))}return Ae}},31204:function(rr){function J(re){var pe=re.target||re.srcElement;pe.__resizeRAF__&&cancelAnimationFrame(pe.__resizeRAF__),pe.__resizeRAF__=requestAnimationFrame(function(){var _=pe.__resizeTrigger__,le=_&&_.__resizeListeners__;le&&le.forEach(function(U){U.call(_,re)})})}var L=function(pe,_){var le=this,U=le.document,he,ae=U.attachEvent;typeof navigator!="undefined"&&(he=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function qe(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",J)}if(!pe.__resizeListeners__)if(pe.__resizeListeners__=[],ae)pe.__resizeTrigger__=pe,pe.attachEvent("onresize",J);else{getComputedStyle(pe).position==="static"&&(pe.style.position="relative");var ie=pe.__resizeTrigger__=U.createElement("object");ie.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),ie.setAttribute("class","resize-sensor"),ie.setAttribute("tabindex","-1"),ie.setAttribute("title",""),ie.__resizeElement__=pe,ie.onload=qe,ie.type="text/html",he&&pe.appendChild(ie),ie.data="about:blank",he||pe.appendChild(ie)}pe.__resizeListeners__.push(_)};rr.exports=typeof window=="undefined"?L:L.bind(window),rr.exports.unbind=function(re,pe){var _=document.attachEvent,le=re.__resizeListeners__||[];if(pe){var U=le.indexOf(pe);U!==-1&&le.splice(U,1)}else le=re.__resizeListeners__=[];if(!le.length){if(_)re.detachEvent("onresize",J);else if(re.__resizeTrigger__){var he=re.__resizeTrigger__.contentDocument,ae=he&&he.defaultView;ae&&(ae.removeEventListener("resize",J),delete ae.__resizeTrigger__),re.__resizeTrigger__=!re.removeChild(re.__resizeTrigger__)}delete re.__resizeListeners__}}},11312:function(rr){"use strict";var J=Object.prototype.hasOwnProperty,L="~";function re(){}Object.create&&(re.prototype=Object.create(null),new re().__proto__||(L=!1));function pe(he,ae,qe){this.fn=he,this.context=ae,this.once=qe||!1}function _(he,ae,qe,ie,Ke){if(typeof qe!="function")throw new TypeError("The listener must be a function");var ht=new pe(qe,ie||he,Ke),mt=L?L+ae:ae;return he._events[mt]?he._events[mt].fn?he._events[mt]=[he._events[mt],ht]:he._events[mt].push(ht):(he._events[mt]=ht,he._eventsCount++),he}function le(he,ae){--he._eventsCount===0?he._events=new re:delete he._events[ae]}function U(){this._events=new re,this._eventsCount=0}U.prototype.eventNames=function(){var ae=[],qe,ie;if(this._eventsCount===0)return ae;for(ie in qe=this._events)J.call(qe,ie)&&ae.push(L?ie.slice(1):ie);return Object.getOwnPropertySymbols?ae.concat(Object.getOwnPropertySymbols(qe)):ae},U.prototype.listeners=function(ae){var qe=L?L+ae:ae,ie=this._events[qe];if(!ie)return[];if(ie.fn)return[ie.fn];for(var Ke=0,ht=ie.length,mt=new Array(ht);Ke<ht;Ke++)mt[Ke]=ie[Ke].fn;return mt},U.prototype.listenerCount=function(ae){var qe=L?L+ae:ae,ie=this._events[qe];return ie?ie.fn?1:ie.length:0},U.prototype.emit=function(ae,qe,ie,Ke,ht,mt){var Dt=L?L+ae:ae;if(!this._events[Dt])return!1;var Yt=this._events[Dt],Ht=arguments.length,ir,Xt;if(Yt.fn){switch(Yt.once&&this.removeListener(ae,Yt.fn,void 0,!0),Ht){case 1:return Yt.fn.call(Yt.context),!0;case 2:return Yt.fn.call(Yt.context,qe),!0;case 3:return Yt.fn.call(Yt.context,qe,ie),!0;case 4:return Yt.fn.call(Yt.context,qe,ie,Ke),!0;case 5:return Yt.fn.call(Yt.context,qe,ie,Ke,ht),!0;case 6:return Yt.fn.call(Yt.context,qe,ie,Ke,ht,mt),!0}for(Xt=1,ir=new Array(Ht-1);Xt<Ht;Xt++)ir[Xt-1]=arguments[Xt];Yt.fn.apply(Yt.context,ir)}else{var yt=Yt.length,bt;for(Xt=0;Xt<yt;Xt++)switch(Yt[Xt].once&&this.removeListener(ae,Yt[Xt].fn,void 0,!0),Ht){case 1:Yt[Xt].fn.call(Yt[Xt].context);break;case 2:Yt[Xt].fn.call(Yt[Xt].context,qe);break;case 3:Yt[Xt].fn.call(Yt[Xt].context,qe,ie);break;case 4:Yt[Xt].fn.call(Yt[Xt].context,qe,ie,Ke);break;default:if(!ir)for(bt=1,ir=new Array(Ht-1);bt<Ht;bt++)ir[bt-1]=arguments[bt];Yt[Xt].fn.apply(Yt[Xt].context,ir)}}return!0},U.prototype.on=function(ae,qe,ie){return _(this,ae,qe,ie,!1)},U.prototype.once=function(ae,qe,ie){return _(this,ae,qe,ie,!0)},U.prototype.removeListener=function(ae,qe,ie,Ke){var ht=L?L+ae:ae;if(!this._events[ht])return this;if(!qe)return le(this,ht),this;var mt=this._events[ht];if(mt.fn)mt.fn===qe&&(!Ke||mt.once)&&(!ie||mt.context===ie)&&le(this,ht);else{for(var Dt=0,Yt=[],Ht=mt.length;Dt<Ht;Dt++)(mt[Dt].fn!==qe||Ke&&!mt[Dt].once||ie&&mt[Dt].context!==ie)&&Yt.push(mt[Dt]);Yt.length?this._events[ht]=Yt.length===1?Yt[0]:Yt:le(this,ht)}return this},U.prototype.removeAllListeners=function(ae){var qe;return ae?(qe=L?L+ae:ae,this._events[qe]&&le(this,qe)):(this._events=new re,this._eventsCount=0),this},U.prototype.off=U.prototype.removeListener,U.prototype.addListener=U.prototype.on,U.prefixed=L,U.EventEmitter=U,rr.exports=U},11553:function(rr,J,L){var re;(function(pe,_,le,U){"use strict";var he=["","webkit","Moz","MS","ms","o"],ae=_.createElement("div"),qe="function",ie=Math.round,Ke=Math.abs,ht=Date.now;function mt(fe,Te,ot){return setTimeout(Pr(fe,ot),Te)}function Dt(fe,Te,ot){return Array.isArray(fe)?(Yt(fe,ot[Te],ot),!0):!1}function Yt(fe,Te,ot){var nr;if(fe)if(fe.forEach)fe.forEach(Te,ot);else if(fe.length!==U)for(nr=0;nr<fe.length;)Te.call(ot,fe[nr],nr,fe),nr++;else for(nr in fe)fe.hasOwnProperty(nr)&&Te.call(ot,fe[nr],nr,fe)}function Ht(fe,Te,ot){var nr="DEPRECATED METHOD: "+Te+`
`+ot+` AT 
`;return function(){var jr=new Error("get-stack-trace"),Mn=jr&&jr.stack?jr.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Vi=pe.console&&(pe.console.warn||pe.console.log);return Vi&&Vi.call(pe.console,nr,Mn),fe.apply(this,arguments)}}var ir;typeof Object.assign!="function"?ir=function(Te){if(Te===U||Te===null)throw new TypeError("Cannot convert undefined or null to object");for(var ot=Object(Te),nr=1;nr<arguments.length;nr++){var jr=arguments[nr];if(jr!==U&&jr!==null)for(var Mn in jr)jr.hasOwnProperty(Mn)&&(ot[Mn]=jr[Mn])}return ot}:ir=Object.assign;var Xt=Ht(function(Te,ot,nr){for(var jr=Object.keys(ot),Mn=0;Mn<jr.length;)(!nr||nr&&Te[jr[Mn]]===U)&&(Te[jr[Mn]]=ot[jr[Mn]]),Mn++;return Te},"extend","Use `assign`."),yt=Ht(function(Te,ot){return Xt(Te,ot,!0)},"merge","Use `assign`.");function bt(fe,Te,ot){var nr=Te.prototype,jr;jr=fe.prototype=Object.create(nr),jr.constructor=fe,jr._super=nr,ot&&ir(jr,ot)}function Pr(fe,Te){return function(){return fe.apply(Te,arguments)}}function hr(fe,Te){return typeof fe==qe?fe.apply(Te&&Te[0]||U,Te):fe}function ur(fe,Te){return fe===U?Te:fe}function Et(fe,Te,ot){Yt(qt(Te),function(nr){fe.addEventListener(nr,ot,!1)})}function nt(fe,Te,ot){Yt(qt(Te),function(nr){fe.removeEventListener(nr,ot,!1)})}function Pt(fe,Te){for(;fe;){if(fe==Te)return!0;fe=fe.parentNode}return!1}function ft(fe,Te){return fe.indexOf(Te)>-1}function qt(fe){return fe.trim().split(/\s+/g)}function Sr(fe,Te,ot){if(fe.indexOf&&!ot)return fe.indexOf(Te);for(var nr=0;nr<fe.length;){if(ot&&fe[nr][ot]==Te||!ot&&fe[nr]===Te)return nr;nr++}return-1}function te(fe){return Array.prototype.slice.call(fe,0)}function H(fe,Te,ot){for(var nr=[],jr=[],Mn=0;Mn<fe.length;){var Vi=Te?fe[Mn][Te]:fe[Mn];Sr(jr,Vi)<0&&nr.push(fe[Mn]),jr[Mn]=Vi,Mn++}return ot&&(Te?nr=nr.sort(function(Ao,uo){return Ao[Te]>uo[Te]}):nr=nr.sort()),nr}function K(fe,Te){for(var ot,nr,jr=Te[0].toUpperCase()+Te.slice(1),Mn=0;Mn<he.length;){if(ot=he[Mn],nr=ot?ot+jr:Te,nr in fe)return nr;Mn++}return U}var Be=1;function Ae(){return Be++}function dt(fe){var Te=fe.ownerDocument||fe;return Te.defaultView||Te.parentWindow||pe}var Ue=/mobile|tablet|ip(ad|hone|od)|android/i,We="ontouchstart"in pe,it=K(pe,"PointerEvent")!==U,Mt=We&&Ue.test(navigator.userAgent),yr="touch",lr="pen",Cn="mouse",mn="kinect",un=25,oi=1,jn=2,rn=4,$i=8,Wi=1,Zi=2,Jn=4,Bn=8,Do=16,oa=Zi|Jn,$a=Bn|Do,Ot=oa|$a,F=["x","y"],ne=["clientX","clientY"];function de(fe,Te){var ot=this;this.manager=fe,this.callback=Te,this.element=fe.element,this.target=fe.options.inputTarget,this.domHandler=function(nr){hr(fe.options.enable,[fe])&&ot.handler(nr)},this.init()}de.prototype={handler:function(){},init:function(){this.evEl&&Et(this.element,this.evEl,this.domHandler),this.evTarget&&Et(this.target,this.evTarget,this.domHandler),this.evWin&&Et(dt(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&nt(this.element,this.evEl,this.domHandler),this.evTarget&&nt(this.target,this.evTarget,this.domHandler),this.evWin&&nt(dt(this.element),this.evWin,this.domHandler)}};function Ne(fe){var Te,ot=fe.options.inputClass;return ot?Te=ot:it?Te=Q:Mt?Te=De:We?Te=Tr:Te=sa,new Te(fe,_t)}function _t(fe,Te,ot){var nr=ot.pointers.length,jr=ot.changedPointers.length,Mn=Te&oi&&nr-jr===0,Vi=Te&(rn|$i)&&nr-jr===0;ot.isFirst=!!Mn,ot.isFinal=!!Vi,Mn&&(fe.session={}),ot.eventType=Te,Kt(fe,ot),fe.emit("hammer.input",ot),fe.recognize(ot),fe.session.prevInput=ot}function Kt(fe,Te){var ot=fe.session,nr=Te.pointers,jr=nr.length;ot.firstInput||(ot.firstInput=wt(Te)),jr>1&&!ot.firstMultiple?ot.firstMultiple=wt(Te):jr===1&&(ot.firstMultiple=!1);var Mn=ot.firstInput,Vi=ot.firstMultiple,ho=Vi?Vi.center:Mn.center,Ao=Te.center=sr(nr);Te.timeStamp=ht(),Te.deltaTime=Te.timeStamp-Mn.timeStamp,Te.angle=En(ho,Ao),Te.distance=Ln(ho,Ao),Ar(ot,Te),Te.offsetDirection=Vr(Te.deltaX,Te.deltaY);var uo=dr(Te.deltaTime,Te.deltaX,Te.deltaY);Te.overallVelocityX=uo.x,Te.overallVelocityY=uo.y,Te.overallVelocity=Ke(uo.x)>Ke(uo.y)?uo.x:uo.y,Te.scale=Vi?xn(Vi.pointers,nr):1,Te.rotation=Vi?Rn(Vi.pointers,nr):0,Te.maxPointers=ot.prevInput?Te.pointers.length>ot.prevInput.maxPointers?Te.pointers.length:ot.prevInput.maxPointers:Te.pointers.length,Ve(ot,Te);var Is=fe.element;Pt(Te.srcEvent.target,Is)&&(Is=Te.srcEvent.target),Te.target=Is}function Ar(fe,Te){var ot=Te.center,nr=fe.offsetDelta||{},jr=fe.prevDelta||{},Mn=fe.prevInput||{};(Te.eventType===oi||Mn.eventType===rn)&&(jr=fe.prevDelta={x:Mn.deltaX||0,y:Mn.deltaY||0},nr=fe.offsetDelta={x:ot.x,y:ot.y}),Te.deltaX=jr.x+(ot.x-nr.x),Te.deltaY=jr.y+(ot.y-nr.y)}function Ve(fe,Te){var ot=fe.lastInterval||Te,nr=Te.timeStamp-ot.timeStamp,jr,Mn,Vi,ho;if(Te.eventType!=$i&&(nr>un||ot.velocity===U)){var Ao=Te.deltaX-ot.deltaX,uo=Te.deltaY-ot.deltaY,Is=dr(nr,Ao,uo);Mn=Is.x,Vi=Is.y,jr=Ke(Is.x)>Ke(Is.y)?Is.x:Is.y,ho=Vr(Ao,uo),fe.lastInterval=Te}else jr=ot.velocity,Mn=ot.velocityX,Vi=ot.velocityY,ho=ot.direction;Te.velocity=jr,Te.velocityX=Mn,Te.velocityY=Vi,Te.direction=ho}function wt(fe){for(var Te=[],ot=0;ot<fe.pointers.length;)Te[ot]={clientX:ie(fe.pointers[ot].clientX),clientY:ie(fe.pointers[ot].clientY)},ot++;return{timeStamp:ht(),pointers:Te,center:sr(Te),deltaX:fe.deltaX,deltaY:fe.deltaY}}function sr(fe){var Te=fe.length;if(Te===1)return{x:ie(fe[0].clientX),y:ie(fe[0].clientY)};for(var ot=0,nr=0,jr=0;jr<Te;)ot+=fe[jr].clientX,nr+=fe[jr].clientY,jr++;return{x:ie(ot/Te),y:ie(nr/Te)}}function dr(fe,Te,ot){return{x:Te/fe||0,y:ot/fe||0}}function Vr(fe,Te){return fe===Te?Wi:Ke(fe)>=Ke(Te)?fe<0?Zi:Jn:Te<0?Bn:Do}function Ln(fe,Te,ot){ot||(ot=F);var nr=Te[ot[0]]-fe[ot[0]],jr=Te[ot[1]]-fe[ot[1]];return Math.sqrt(nr*nr+jr*jr)}function En(fe,Te,ot){ot||(ot=F);var nr=Te[ot[0]]-fe[ot[0]],jr=Te[ot[1]]-fe[ot[1]];return Math.atan2(jr,nr)*180/Math.PI}function Rn(fe,Te){return En(Te[1],Te[0],ne)+En(fe[1],fe[0],ne)}function xn(fe,Te){return Ln(Te[0],Te[1],ne)/Ln(fe[0],fe[1],ne)}var si={mousedown:oi,mousemove:jn,mouseup:rn},ei="mousedown",la="mousemove mouseup";function sa(){this.evEl=ei,this.evWin=la,this.pressed=!1,de.apply(this,arguments)}bt(sa,de,{handler:function(Te){var ot=si[Te.type];ot&oi&&Te.button===0&&(this.pressed=!0),ot&jn&&Te.which!==1&&(ot=rn),this.pressed&&(ot&rn&&(this.pressed=!1),this.callback(this.manager,ot,{pointers:[Te],changedPointers:[Te],pointerType:Cn,srcEvent:Te}))}});var Eo={pointerdown:oi,pointermove:jn,pointerup:rn,pointercancel:$i,pointerout:$i},Ks={2:yr,3:lr,4:Cn,5:mn},di="pointerdown",W="pointermove pointerup pointercancel";pe.MSPointerEvent&&!pe.PointerEvent&&(di="MSPointerDown",W="MSPointerMove MSPointerUp MSPointerCancel");function Q(){this.evEl=di,this.evWin=W,de.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}bt(Q,de,{handler:function(Te){var ot=this.store,nr=!1,jr=Te.type.toLowerCase().replace("ms",""),Mn=Eo[jr],Vi=Ks[Te.pointerType]||Te.pointerType,ho=Vi==yr,Ao=Sr(ot,Te.pointerId,"pointerId");Mn&oi&&(Te.button===0||ho)?Ao<0&&(ot.push(Te),Ao=ot.length-1):Mn&(rn|$i)&&(nr=!0),!(Ao<0)&&(ot[Ao]=Te,this.callback(this.manager,Mn,{pointers:ot,changedPointers:[Te],pointerType:Vi,srcEvent:Te}),nr&&ot.splice(Ao,1))}});var se={touchstart:oi,touchmove:jn,touchend:rn,touchcancel:$i},xe="touchstart",Re="touchstart touchmove touchend touchcancel";function Je(){this.evTarget=xe,this.evWin=Re,this.started=!1,de.apply(this,arguments)}bt(Je,de,{handler:function(Te){var ot=se[Te.type];if(ot===oi&&(this.started=!0),!!this.started){var nr=lt.call(this,Te,ot);ot&(rn|$i)&&nr[0].length-nr[1].length===0&&(this.started=!1),this.callback(this.manager,ot,{pointers:nr[0],changedPointers:nr[1],pointerType:yr,srcEvent:Te})}}});function lt(fe,Te){var ot=te(fe.touches),nr=te(fe.changedTouches);return Te&(rn|$i)&&(ot=H(ot.concat(nr),"identifier",!0)),[ot,nr]}var V={touchstart:oi,touchmove:jn,touchend:rn,touchcancel:$i},q="touchstart touchmove touchend touchcancel";function De(){this.evTarget=q,this.targetIds={},de.apply(this,arguments)}bt(De,de,{handler:function(Te){var ot=V[Te.type],nr=et.call(this,Te,ot);nr&&this.callback(this.manager,ot,{pointers:nr[0],changedPointers:nr[1],pointerType:yr,srcEvent:Te})}});function et(fe,Te){var ot=te(fe.touches),nr=this.targetIds;if(Te&(oi|jn)&&ot.length===1)return nr[ot[0].identifier]=!0,[ot,ot];var jr,Mn,Vi=te(fe.changedTouches),ho=[],Ao=this.target;if(Mn=ot.filter(function(uo){return Pt(uo.target,Ao)}),Te===oi)for(jr=0;jr<Mn.length;)nr[Mn[jr].identifier]=!0,jr++;for(jr=0;jr<Vi.length;)nr[Vi[jr].identifier]&&ho.push(Vi[jr]),Te&(rn|$i)&&delete nr[Vi[jr].identifier],jr++;if(ho.length)return[H(Mn.concat(ho),"identifier",!0),ho]}var be=2500,er=25;function Tr(){de.apply(this,arguments);var fe=Pr(this.handler,this);this.touch=new De(this.manager,fe),this.mouse=new sa(this.manager,fe),this.primaryTouch=null,this.lastTouches=[]}bt(Tr,de,{handler:function(Te,ot,nr){var jr=nr.pointerType==yr,Mn=nr.pointerType==Cn;if(!(Mn&&nr.sourceCapabilities&&nr.sourceCapabilities.firesTouchEvents)){if(jr)bn.call(this,ot,nr);else if(Mn&&ar.call(this,nr))return;this.callback(Te,ot,nr)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function bn(fe,Te){fe&oi?(this.primaryTouch=Te.changedPointers[0].identifier,nn.call(this,Te)):fe&(rn|$i)&&nn.call(this,Te)}function nn(fe){var Te=fe.changedPointers[0];if(Te.identifier===this.primaryTouch){var ot={x:Te.clientX,y:Te.clientY};this.lastTouches.push(ot);var nr=this.lastTouches,jr=function(){var Mn=nr.indexOf(ot);Mn>-1&&nr.splice(Mn,1)};setTimeout(jr,be)}}function ar(fe){for(var Te=fe.srcEvent.clientX,ot=fe.srcEvent.clientY,nr=0;nr<this.lastTouches.length;nr++){var jr=this.lastTouches[nr],Mn=Math.abs(Te-jr.x),Vi=Math.abs(ot-jr.y);if(Mn<=er&&Vi<=er)return!0}return!1}var Kr=K(ae.style,"touchAction"),Hr=Kr!==U,$r="compute",hi="auto",Qr="manipulation",vi="none",Yi="pan-x",ci="pan-y",Li=Ki();function Si(fe,Te){this.manager=fe,this.set(Te)}Si.prototype={set:function(fe){fe==$r&&(fe=this.compute()),Hr&&this.manager.element.style&&Li[fe]&&(this.manager.element.style[Kr]=fe),this.actions=fe.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var fe=[];return Yt(this.manager.recognizers,function(Te){hr(Te.options.enable,[Te])&&(fe=fe.concat(Te.getTouchAction()))}),Xo(fe.join(" "))},preventDefaults:function(fe){var Te=fe.srcEvent,ot=fe.offsetDirection;if(this.manager.session.prevented){Te.preventDefault();return}var nr=this.actions,jr=ft(nr,vi)&&!Li[vi],Mn=ft(nr,ci)&&!Li[ci],Vi=ft(nr,Yi)&&!Li[Yi];if(jr){var ho=fe.pointers.length===1,Ao=fe.distance<2,uo=fe.deltaTime<250;if(ho&&Ao&&uo)return}if(!(Vi&&Mn)&&(jr||Mn&&ot&oa||Vi&&ot&$a))return this.preventSrc(Te)},preventSrc:function(fe){this.manager.session.prevented=!0,fe.preventDefault()}};function Xo(fe){if(ft(fe,vi))return vi;var Te=ft(fe,Yi),ot=ft(fe,ci);return Te&&ot?vi:Te||ot?Te?Yi:ci:ft(fe,Qr)?Qr:hi}function Ki(){if(!Hr)return!1;var fe={},Te=pe.CSS&&pe.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(ot){fe[ot]=Te?pe.CSS.supports("touch-action",ot):!0}),fe}var Ia=1,Ai=2,mi=4,Ti=8,Pa=Ti,cu=16,ma=32;function Aa(fe){this.options=ir({},this.defaults,fe||{}),this.id=Ae(),this.manager=null,this.options.enable=ur(this.options.enable,!0),this.state=Ia,this.simultaneous={},this.requireFail=[]}Aa.prototype={defaults:{},set:function(fe){return ir(this.options,fe),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(fe){if(Dt(fe,"recognizeWith",this))return this;var Te=this.simultaneous;return fe=Ta(fe,this),Te[fe.id]||(Te[fe.id]=fe,fe.recognizeWith(this)),this},dropRecognizeWith:function(fe){return Dt(fe,"dropRecognizeWith",this)?this:(fe=Ta(fe,this),delete this.simultaneous[fe.id],this)},requireFailure:function(fe){if(Dt(fe,"requireFailure",this))return this;var Te=this.requireFail;return fe=Ta(fe,this),Sr(Te,fe)===-1&&(Te.push(fe),fe.requireFailure(this)),this},dropRequireFailure:function(fe){if(Dt(fe,"dropRequireFailure",this))return this;fe=Ta(fe,this);var Te=Sr(this.requireFail,fe);return Te>-1&&this.requireFail.splice(Te,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(fe){return!!this.simultaneous[fe.id]},emit:function(fe){var Te=this,ot=this.state;function nr(jr){Te.manager.emit(jr,fe)}ot<Ti&&nr(Te.options.event+$l(ot)),nr(Te.options.event),fe.additionalEvent&&nr(fe.additionalEvent),ot>=Ti&&nr(Te.options.event+$l(ot))},tryEmit:function(fe){if(this.canEmit())return this.emit(fe);this.state=ma},canEmit:function(){for(var fe=0;fe<this.requireFail.length;){if(!(this.requireFail[fe].state&(ma|Ia)))return!1;fe++}return!0},recognize:function(fe){var Te=ir({},fe);if(!hr(this.options.enable,[this,Te])){this.reset(),this.state=ma;return}this.state&(Pa|cu|ma)&&(this.state=Ia),this.state=this.process(Te),this.state&(Ai|mi|Ti|cu)&&this.tryEmit(Te)},process:function(fe){},getTouchAction:function(){},reset:function(){}};function $l(fe){return fe&cu?"cancel":fe&Ti?"end":fe&mi?"move":fe&Ai?"start":""}function os(fe){return fe==Do?"down":fe==Bn?"up":fe==Zi?"left":fe==Jn?"right":""}function Ta(fe,Te){var ot=Te.manager;return ot?ot.get(fe):fe}function fi(){Aa.apply(this,arguments)}bt(fi,Aa,{defaults:{pointers:1},attrTest:function(fe){var Te=this.options.pointers;return Te===0||fe.pointers.length===Te},process:function(fe){var Te=this.state,ot=fe.eventType,nr=Te&(Ai|mi),jr=this.attrTest(fe);return nr&&(ot&$i||!jr)?Te|cu:nr||jr?ot&rn?Te|Ti:Te&Ai?Te|mi:Ai:ma}});function Oa(){fi.apply(this,arguments),this.pX=null,this.pY=null}bt(Oa,fi,{defaults:{event:"pan",threshold:10,pointers:1,direction:Ot},getTouchAction:function(){var fe=this.options.direction,Te=[];return fe&oa&&Te.push(ci),fe&$a&&Te.push(Yi),Te},directionTest:function(fe){var Te=this.options,ot=!0,nr=fe.distance,jr=fe.direction,Mn=fe.deltaX,Vi=fe.deltaY;return jr&Te.direction||(Te.direction&oa?(jr=Mn===0?Wi:Mn<0?Zi:Jn,ot=Mn!=this.pX,nr=Math.abs(fe.deltaX)):(jr=Vi===0?Wi:Vi<0?Bn:Do,ot=Vi!=this.pY,nr=Math.abs(fe.deltaY))),fe.direction=jr,ot&&nr>Te.threshold&&jr&Te.direction},attrTest:function(fe){return fi.prototype.attrTest.call(this,fe)&&(this.state&Ai||!(this.state&Ai)&&this.directionTest(fe))},emit:function(fe){this.pX=fe.deltaX,this.pY=fe.deltaY;var Te=os(fe.direction);Te&&(fe.additionalEvent=this.options.event+Te),this._super.emit.call(this,fe)}});function ia(){fi.apply(this,arguments)}bt(ia,fi,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[vi]},attrTest:function(fe){return this._super.attrTest.call(this,fe)&&(Math.abs(fe.scale-1)>this.options.threshold||this.state&Ai)},emit:function(fe){if(fe.scale!==1){var Te=fe.scale<1?"in":"out";fe.additionalEvent=this.options.event+Te}this._super.emit.call(this,fe)}});function So(){Aa.apply(this,arguments),this._timer=null,this._input=null}bt(So,Aa,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[hi]},process:function(fe){var Te=this.options,ot=fe.pointers.length===Te.pointers,nr=fe.distance<Te.threshold,jr=fe.deltaTime>Te.time;if(this._input=fe,!nr||!ot||fe.eventType&(rn|$i)&&!jr)this.reset();else if(fe.eventType&oi)this.reset(),this._timer=mt(function(){this.state=Pa,this.tryEmit()},Te.time,this);else if(fe.eventType&rn)return Pa;return ma},reset:function(){clearTimeout(this._timer)},emit:function(fe){this.state===Pa&&(fe&&fe.eventType&rn?this.manager.emit(this.options.event+"up",fe):(this._input.timeStamp=ht(),this.manager.emit(this.options.event,this._input)))}});function ha(){fi.apply(this,arguments)}bt(ha,fi,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[vi]},attrTest:function(fe){return this._super.attrTest.call(this,fe)&&(Math.abs(fe.rotation)>this.options.threshold||this.state&Ai)}});function $o(){fi.apply(this,arguments)}bt($o,fi,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:oa|$a,pointers:1},getTouchAction:function(){return Oa.prototype.getTouchAction.call(this)},attrTest:function(fe){var Te=this.options.direction,ot;return Te&(oa|$a)?ot=fe.overallVelocity:Te&oa?ot=fe.overallVelocityX:Te&$a&&(ot=fe.overallVelocityY),this._super.attrTest.call(this,fe)&&Te&fe.offsetDirection&&fe.distance>this.options.threshold&&fe.maxPointers==this.options.pointers&&Ke(ot)>this.options.velocity&&fe.eventType&rn},emit:function(fe){var Te=os(fe.offsetDirection);Te&&this.manager.emit(this.options.event+Te,fe),this.manager.emit(this.options.event,fe)}});function Vo(){Aa.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}bt(Vo,Aa,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Qr]},process:function(fe){var Te=this.options,ot=fe.pointers.length===Te.pointers,nr=fe.distance<Te.threshold,jr=fe.deltaTime<Te.time;if(this.reset(),fe.eventType&oi&&this.count===0)return this.failTimeout();if(nr&&jr&&ot){if(fe.eventType!=rn)return this.failTimeout();var Mn=this.pTime?fe.timeStamp-this.pTime<Te.interval:!0,Vi=!this.pCenter||Ln(this.pCenter,fe.center)<Te.posThreshold;this.pTime=fe.timeStamp,this.pCenter=fe.center,!Vi||!Mn?this.count=1:this.count+=1,this._input=fe;var ho=this.count%Te.taps;if(ho===0)return this.hasRequireFailures()?(this._timer=mt(function(){this.state=Pa,this.tryEmit()},Te.interval,this),Ai):Pa}return ma},failTimeout:function(){return this._timer=mt(function(){this.state=ma},this.options.interval,this),ma},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Pa&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Ru(fe,Te){return Te=Te||{},Te.recognizers=ur(Te.recognizers,Ru.defaults.preset),new Ea(fe,Te)}Ru.VERSION="2.0.7",Ru.defaults={domEvents:!1,touchAction:$r,enable:!0,inputTarget:null,inputClass:null,preset:[[ha,{enable:!1}],[ia,{enable:!1},["rotate"]],[$o,{direction:oa}],[Oa,{direction:oa},["swipe"]],[Vo],[Vo,{event:"doubletap",taps:2},["tap"]],[So]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var ss=1,Cc=2;function Ea(fe,Te){this.options=ir({},Ru.defaults,Te||{}),this.options.inputTarget=this.options.inputTarget||fe,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=fe,this.input=Ne(this),this.touchAction=new Si(this,this.options.touchAction),Qi(this,!0),Yt(this.options.recognizers,function(ot){var nr=this.add(new ot[0](ot[1]));ot[2]&&nr.recognizeWith(ot[2]),ot[3]&&nr.requireFailure(ot[3])},this)}Ea.prototype={set:function(fe){return ir(this.options,fe),fe.touchAction&&this.touchAction.update(),fe.inputTarget&&(this.input.destroy(),this.input.target=fe.inputTarget,this.input.init()),this},stop:function(fe){this.session.stopped=fe?Cc:ss},recognize:function(fe){var Te=this.session;if(!Te.stopped){this.touchAction.preventDefaults(fe);var ot,nr=this.recognizers,jr=Te.curRecognizer;(!jr||jr&&jr.state&Pa)&&(jr=Te.curRecognizer=null);for(var Mn=0;Mn<nr.length;)ot=nr[Mn],Te.stopped!==Cc&&(!jr||ot==jr||ot.canRecognizeWith(jr))?ot.recognize(fe):ot.reset(),!jr&&ot.state&(Ai|mi|Ti)&&(jr=Te.curRecognizer=ot),Mn++}},get:function(fe){if(fe instanceof Aa)return fe;for(var Te=this.recognizers,ot=0;ot<Te.length;ot++)if(Te[ot].options.event==fe)return Te[ot];return null},add:function(fe){if(Dt(fe,"add",this))return this;var Te=this.get(fe.options.event);return Te&&this.remove(Te),this.recognizers.push(fe),fe.manager=this,this.touchAction.update(),fe},remove:function(fe){if(Dt(fe,"remove",this))return this;if(fe=this.get(fe),fe){var Te=this.recognizers,ot=Sr(Te,fe);ot!==-1&&(Te.splice(ot,1),this.touchAction.update())}return this},on:function(fe,Te){if(fe!==U&&Te!==U){var ot=this.handlers;return Yt(qt(fe),function(nr){ot[nr]=ot[nr]||[],ot[nr].push(Te)}),this}},off:function(fe,Te){if(fe!==U){var ot=this.handlers;return Yt(qt(fe),function(nr){Te?ot[nr]&&ot[nr].splice(Sr(ot[nr],Te),1):delete ot[nr]}),this}},emit:function(fe,Te){this.options.domEvents&&Wt(fe,Te);var ot=this.handlers[fe]&&this.handlers[fe].slice();if(!(!ot||!ot.length)){Te.type=fe,Te.preventDefault=function(){Te.srcEvent.preventDefault()};for(var nr=0;nr<ot.length;)ot[nr](Te),nr++}},destroy:function(){this.element&&Qi(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Qi(fe,Te){var ot=fe.element;if(ot.style){var nr;Yt(fe.options.cssProps,function(jr,Mn){nr=K(ot.style,Mn),Te?(fe.oldCssProps[nr]=ot.style[nr],ot.style[nr]=jr):ot.style[nr]=fe.oldCssProps[nr]||""}),Te||(fe.oldCssProps={})}}function Wt(fe,Te){var ot=_.createEvent("Event");ot.initEvent(fe,!0,!0),ot.gesture=Te,Te.target.dispatchEvent(ot)}ir(Ru,{INPUT_START:oi,INPUT_MOVE:jn,INPUT_END:rn,INPUT_CANCEL:$i,STATE_POSSIBLE:Ia,STATE_BEGAN:Ai,STATE_CHANGED:mi,STATE_ENDED:Ti,STATE_RECOGNIZED:Pa,STATE_CANCELLED:cu,STATE_FAILED:ma,DIRECTION_NONE:Wi,DIRECTION_LEFT:Zi,DIRECTION_RIGHT:Jn,DIRECTION_UP:Bn,DIRECTION_DOWN:Do,DIRECTION_HORIZONTAL:oa,DIRECTION_VERTICAL:$a,DIRECTION_ALL:Ot,Manager:Ea,Input:de,TouchAction:Si,TouchInput:De,MouseInput:sa,PointerEventInput:Q,TouchMouseInput:Tr,SingleTouchInput:Je,Recognizer:Aa,AttrRecognizer:fi,Tap:Vo,Pan:Oa,Swipe:$o,Pinch:ia,Rotate:ha,Press:So,on:Et,off:nt,each:Yt,merge:yt,extend:Xt,assign:ir,inherit:bt,bindFn:Pr,prefixed:K});var yn=typeof pe!="undefined"?pe:typeof self!="undefined"?self:{};yn.Hammer=Ru,re=function(){return Ru}.call(J,L,J,rr),re!==U&&(rr.exports=re)})(window,document,"Hammer")},84530:function(rr,J){"use strict";Object.defineProperty(J,"__esModule",{value:!0});var L=Symbol.for("INJECTION");function re(he,ae,qe,ie){function Ke(){return ie&&!Reflect.hasMetadata(L,this,ae)&&Reflect.defineMetadata(L,qe(),this,ae),Reflect.hasMetadata(L,this,ae)?Reflect.getMetadata(L,this,ae):qe()}function ht(mt){Reflect.defineMetadata(L,mt,this,ae)}Object.defineProperty(he,ae,{configurable:!0,enumerable:!0,get:Ke,set:ht})}function pe(he,ae){return function(qe){return function(ie,Ke){var ht=function(){return he.get(qe)};re(ie,Ke,ht,ae)}}}J.makePropertyInjectDecorator=pe;function _(he,ae){return function(qe,ie){return function(Ke,ht){var mt=function(){return he.getNamed(qe,ie)};re(Ke,ht,mt,ae)}}}J.makePropertyInjectNamedDecorator=_;function le(he,ae){return function(qe,ie,Ke){return function(ht,mt){var Dt=function(){return he.getTagged(qe,ie,Ke)};re(ht,mt,Dt,ae)}}}J.makePropertyInjectTaggedDecorator=le;function U(he,ae){return function(qe){return function(ie,Ke){var ht=function(){return he.getAll(qe)};re(ie,Ke,ht,ae)}}}J.makePropertyMultiInjectDecorator=U},67754:function(rr,J,L){"use strict";var re;re={value:!0};var pe=L(84530);function _(le,U){U===void 0&&(U=!0);var he=pe.makePropertyInjectDecorator(le,U),ae=pe.makePropertyInjectNamedDecorator(le,U),qe=pe.makePropertyInjectTaggedDecorator(le,U),ie=pe.makePropertyMultiInjectDecorator(le,U);return{lazyInject:he,lazyInjectNamed:ae,lazyInjectTagged:qe,lazyMultiInject:ie}}J.Z=_},38362:function(rr,J,L){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.tagProperty=J.tagParameter=J.decorate=void 0;var re=L(81463),pe=L(17597);function _(ie,Ke,ht,mt){var Dt=pe.TAGGED;U(Dt,ie,Ke,mt,ht)}J.tagParameter=_;function le(ie,Ke,ht){var mt=pe.TAGGED_PROP;U(mt,ie.constructor,Ke,ht)}J.tagProperty=le;function U(ie,Ke,ht,mt,Dt){var Yt={},Ht=typeof Dt=="number",ir=Dt!==void 0&&Ht?Dt.toString():ht;if(Ht&&ht!==void 0)throw new Error(re.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(ie,Ke)&&(Yt=Reflect.getMetadata(ie,Ke));var Xt=Yt[ir];if(!Array.isArray(Xt))Xt=[];else for(var yt=0,bt=Xt;yt<bt.length;yt++){var Pr=bt[yt];if(Pr.key===mt.key)throw new Error(re.DUPLICATED_METADATA+" "+Pr.key.toString())}Xt.push(mt),Yt[ir]=Xt,Reflect.defineMetadata(ie,Yt,Ke)}function he(ie,Ke){Reflect.decorate(ie,Ke)}function ae(ie,Ke){return function(ht,mt){Ke(ht,mt,ie)}}function qe(ie,Ke,ht){typeof ht=="number"?he([ae(ht,ie)],Ke):typeof ht=="string"?Reflect.decorate([ie],Ke,ht):he([ie],Ke)}J.decorate=qe},71791:function(rr,J,L){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.inject=J.LazyServiceIdentifer=void 0;var re=L(81463),pe=L(17597),_=L(4957),le=L(38362),U=function(){function ae(qe){this._cb=qe}return ae.prototype.unwrap=function(){return this._cb()},ae}();J.LazyServiceIdentifer=U;function he(ae){return function(qe,ie,Ke){if(ae===void 0)throw new Error(re.UNDEFINED_INJECT_ANNOTATION(qe.name));var ht=new _.Metadata(pe.INJECT_TAG,ae);typeof Ke=="number"?le.tagParameter(qe,ie,Ke,ht):le.tagProperty(qe,ie,ht)}}J.inject=he},66733:function(rr,J,L){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.injectable=void 0;var re=L(81463),pe=L(17597);function _(){return function(le){if(Reflect.hasOwnMetadata(pe.PARAM_TYPES,le))throw new Error(re.DUPLICATED_INJECTABLE_DECORATOR);var U=Reflect.getMetadata(pe.DESIGN_PARAM_TYPES,le)||[];return Reflect.defineMetadata(pe.PARAM_TYPES,U,le),le}}J.injectable=_},33406:function(rr,J,L){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.multiInject=void 0;var re=L(17597),pe=L(4957),_=L(38362);function le(U){return function(he,ae,qe){var ie=new pe.Metadata(re.MULTI_INJECT_TAG,U);typeof qe=="number"?_.tagParameter(he,ae,qe,ie):_.tagProperty(he,ae,ie)}}J.multiInject=le},23769:function(rr,J,L){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.named=void 0;var re=L(17597),pe=L(4957),_=L(38362);function le(U){return function(he,ae,qe){var ie=new pe.Metadata(re.NAMED_TAG,U);typeof qe=="number"?_.tagParameter(he,ae,qe,ie):_.tagProperty(he,ae,ie)}}J.named=le},57758:function(rr,J,L){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.optional=void 0;var re=L(17597),pe=L(4957),_=L(38362);function le(){return function(U,he,ae){var qe=new pe.Metadata(re.OPTIONAL_TAG,!0);typeof ae=="number"?_.tagParameter(U,he,ae,qe):_.tagProperty(U,he,qe)}}J.optional=le},82935:function(rr,J,L){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.postConstruct=void 0;var re=L(81463),pe=L(17597),_=L(4957);function le(){return function(U,he,ae){var qe=new _.Metadata(pe.POST_CONSTRUCT,he);if(Reflect.hasOwnMetadata(pe.POST_CONSTRUCT,U.constructor))throw new Error(re.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(pe.POST_CONSTRUCT,qe,U.constructor)}}J.postConstruct=le},76316:function(rr,J,L){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.tagged=void 0;var re=L(4957),pe=L(38362);function _(le,U){return function(he,ae,qe){var ie=new re.Metadata(le,U);typeof qe=="number"?pe.tagParameter(he,ae,qe,ie):pe.tagProperty(he,ae,ie)}}J.tagged=_},26805:function(rr,J,L){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.targetName=void 0;var re=L(17597),pe=L(4957),_=L(38362);function le(U){return function(he,ae,qe){var ie=new pe.Metadata(re.NAME_TAG,U);_.tagParameter(he,ae,qe,ie)}}J.targetName=le},39868:function(rr,J,L){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.unmanaged=void 0;var re=L(17597),pe=L(4957),_=L(38362);function le(){return function(U,he,ae){var qe=new pe.Metadata(re.UNMANAGED_TAG,!0);_.tagParameter(U,he,ae,qe)}}J.unmanaged=le},55047:function(rr,J,L){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.Binding=void 0;var re=L(71297),pe=L(92452),_=function(){function le(U,he){this.id=pe.id(),this.activated=!1,this.serviceIdentifier=U,this.scope=he,this.type=re.BindingTypeEnum.Invalid,this.constraint=function(ae){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return le.prototype.clone=function(){var U=new le(this.serviceIdentifier,this.scope);return U.activated=U.scope===re.BindingScopeEnum.Singleton?this.activated:!1,U.implementationType=this.implementationType,U.dynamicValue=this.dynamicValue,U.scope=this.scope,U.type=this.type,U.factory=this.factory,U.provider=this.provider,U.constraint=this.constraint,U.onActivation=this.onActivation,U.cache=this.cache,U},le}();J.Binding=_},53837:function(rr,J){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.BindingCount=void 0;var L={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};J.BindingCount=L},81463:function(rr,J){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.STACK_OVERFLOW=J.CIRCULAR_DEPENDENCY_IN_FACTORY=J.POST_CONSTRUCT_ERROR=J.MULTIPLE_POST_CONSTRUCT_METHODS=J.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=J.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=J.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=J.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=J.ARGUMENTS_LENGTH_MISMATCH=J.INVALID_DECORATOR_OPERATION=J.INVALID_TO_SELF_VALUE=J.INVALID_FUNCTION_BINDING=J.INVALID_MIDDLEWARE_RETURN=J.NO_MORE_SNAPSHOTS_AVAILABLE=J.INVALID_BINDING_TYPE=J.NOT_IMPLEMENTED=J.CIRCULAR_DEPENDENCY=J.UNDEFINED_INJECT_ANNOTATION=J.MISSING_INJECT_ANNOTATION=J.MISSING_INJECTABLE_ANNOTATION=J.NOT_REGISTERED=J.CANNOT_UNBIND=J.AMBIGUOUS_MATCH=J.KEY_NOT_FOUND=J.NULL_ARGUMENT=J.DUPLICATED_METADATA=J.DUPLICATED_INJECTABLE_DECORATOR=void 0,J.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",J.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",J.NULL_ARGUMENT="NULL argument",J.KEY_NOT_FOUND="Key Not Found",J.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",J.CANNOT_UNBIND="Could not unbind serviceIdentifier:",J.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",J.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",J.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var L=function(le){return"@inject called with undefined this could mean that the class "+le+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};J.UNDEFINED_INJECT_ANNOTATION=L,J.CIRCULAR_DEPENDENCY="Circular dependency found:",J.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",J.INVALID_BINDING_TYPE="Invalid binding type:",J.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",J.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",J.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",J.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",J.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var re=function(){for(var le=[],U=0;U<arguments.length;U++)le[U]=arguments[U];return"The number of constructor arguments in the derived class "+(le[0]+" must be >= than the number of constructor arguments of its base class.")};J.ARGUMENTS_LENGTH_MISMATCH=re,J.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",J.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",J.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",J.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",J.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var pe=function(){for(var le=[],U=0;U<arguments.length;U++)le[U]=arguments[U];return"@postConstruct error in class "+le[0]+": "+le[1]};J.POST_CONSTRUCT_ERROR=pe;var _=function(){for(var le=[],U=0;U<arguments.length;U++)le[U]=arguments[U];return"It looks like there is a circular dependency "+("in one of the '"+le[0]+"' bindings. Please investigate bindings with")+("service identifier '"+le[1]+"'.")};J.CIRCULAR_DEPENDENCY_IN_FACTORY=_,J.STACK_OVERFLOW="Maximum call stack size exceeded"},71297:function(rr,J){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.TargetTypeEnum=J.BindingTypeEnum=J.BindingScopeEnum=void 0;var L={Request:"Request",Singleton:"Singleton",Transient:"Transient"};J.BindingScopeEnum=L;var re={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};J.BindingTypeEnum=re;var pe={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};J.TargetTypeEnum=pe},17597:function(rr,J){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.NON_CUSTOM_TAG_KEYS=J.POST_CONSTRUCT=J.DESIGN_PARAM_TYPES=J.PARAM_TYPES=J.TAGGED_PROP=J.TAGGED=J.MULTI_INJECT_TAG=J.INJECT_TAG=J.OPTIONAL_TAG=J.UNMANAGED_TAG=J.NAME_TAG=J.NAMED_TAG=void 0,J.NAMED_TAG="named",J.NAME_TAG="name",J.UNMANAGED_TAG="unmanaged",J.OPTIONAL_TAG="optional",J.INJECT_TAG="inject",J.MULTI_INJECT_TAG="multi_inject",J.TAGGED="inversify:tagged",J.TAGGED_PROP="inversify:tagged_props",J.PARAM_TYPES="inversify:paramtypes",J.DESIGN_PARAM_TYPES="design:paramtypes",J.POST_CONSTRUCT="post_construct";function L(){return[J.INJECT_TAG,J.MULTI_INJECT_TAG,J.NAME_TAG,J.UNMANAGED_TAG,J.NAMED_TAG,J.OPTIONAL_TAG]}J.NON_CUSTOM_TAG_KEYS=L()},27877:function(rr,J,L){"use strict";var re=this&&this.__awaiter||function(Xt,yt,bt,Pr){function hr(ur){return ur instanceof bt?ur:new bt(function(Et){Et(ur)})}return new(bt||(bt=Promise))(function(ur,Et){function nt(qt){try{ft(Pr.next(qt))}catch(Sr){Et(Sr)}}function Pt(qt){try{ft(Pr.throw(qt))}catch(Sr){Et(Sr)}}function ft(qt){qt.done?ur(qt.value):hr(qt.value).then(nt,Pt)}ft((Pr=Pr.apply(Xt,yt||[])).next())})},pe=this&&this.__generator||function(Xt,yt){var bt={label:0,sent:function(){if(ur[0]&1)throw ur[1];return ur[1]},trys:[],ops:[]},Pr,hr,ur,Et;return Et={next:nt(0),throw:nt(1),return:nt(2)},typeof Symbol=="function"&&(Et[Symbol.iterator]=function(){return this}),Et;function nt(ft){return function(qt){return Pt([ft,qt])}}function Pt(ft){if(Pr)throw new TypeError("Generator is already executing.");for(;bt;)try{if(Pr=1,hr&&(ur=ft[0]&2?hr.return:ft[0]?hr.throw||((ur=hr.return)&&ur.call(hr),0):hr.next)&&!(ur=ur.call(hr,ft[1])).done)return ur;switch(hr=0,ur&&(ft=[ft[0]&2,ur.value]),ft[0]){case 0:case 1:ur=ft;break;case 4:return bt.label++,{value:ft[1],done:!1};case 5:bt.label++,hr=ft[1],ft=[0];continue;case 7:ft=bt.ops.pop(),bt.trys.pop();continue;default:if(ur=bt.trys,!(ur=ur.length>0&&ur[ur.length-1])&&(ft[0]===6||ft[0]===2)){bt=0;continue}if(ft[0]===3&&(!ur||ft[1]>ur[0]&&ft[1]<ur[3])){bt.label=ft[1];break}if(ft[0]===6&&bt.label<ur[1]){bt.label=ur[1],ur=ft;break}if(ur&&bt.label<ur[2]){bt.label=ur[2],bt.ops.push(ft);break}ur[2]&&bt.ops.pop(),bt.trys.pop();continue}ft=yt.call(Xt,bt)}catch(qt){ft=[6,qt],hr=0}finally{Pr=ur=0}if(ft[0]&5)throw ft[1];return{value:ft[0]?ft[1]:void 0,done:!0}}},_=this&&this.__spreadArray||function(Xt,yt){for(var bt=0,Pr=yt.length,hr=Xt.length;bt<Pr;bt++,hr++)Xt[hr]=yt[bt];return Xt};Object.defineProperty(J,"__esModule",{value:!0}),J.Container=void 0;var le=L(55047),U=L(81463),he=L(71297),ae=L(17597),qe=L(51288),ie=L(14346),Ke=L(50857),ht=L(98e3),mt=L(92452),Dt=L(96783),Yt=L(527),Ht=L(7026),ir=function(){function Xt(yt){this._appliedMiddleware=[];var bt=yt||{};if(typeof bt!="object")throw new Error(""+U.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(bt.defaultScope===void 0)bt.defaultScope=he.BindingScopeEnum.Transient;else if(bt.defaultScope!==he.BindingScopeEnum.Singleton&&bt.defaultScope!==he.BindingScopeEnum.Transient&&bt.defaultScope!==he.BindingScopeEnum.Request)throw new Error(""+U.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(bt.autoBindInjectable===void 0)bt.autoBindInjectable=!1;else if(typeof bt.autoBindInjectable!="boolean")throw new Error(""+U.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(bt.skipBaseClassChecks===void 0)bt.skipBaseClassChecks=!1;else if(typeof bt.skipBaseClassChecks!="boolean")throw new Error(""+U.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:bt.autoBindInjectable,defaultScope:bt.defaultScope,skipBaseClassChecks:bt.skipBaseClassChecks},this.id=mt.id(),this._bindingDictionary=new Ht.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new qe.MetadataReader}return Xt.merge=function(yt,bt){for(var Pr=[],hr=2;hr<arguments.length;hr++)Pr[hr-2]=arguments[hr];var ur=new Xt,Et=_([yt,bt],Pr).map(function(ft){return ie.getBindingDictionary(ft)}),nt=ie.getBindingDictionary(ur);function Pt(ft,qt){ft.traverse(function(Sr,te){te.forEach(function(H){qt.add(H.serviceIdentifier,H.clone())})})}return Et.forEach(function(ft){Pt(ft,nt)}),ur},Xt.prototype.load=function(){for(var yt=[],bt=0;bt<arguments.length;bt++)yt[bt]=arguments[bt];for(var Pr=this._getContainerModuleHelpersFactory(),hr=0,ur=yt;hr<ur.length;hr++){var Et=ur[hr],nt=Pr(Et.id);Et.registry(nt.bindFunction,nt.unbindFunction,nt.isboundFunction,nt.rebindFunction)}},Xt.prototype.loadAsync=function(){for(var yt=[],bt=0;bt<arguments.length;bt++)yt[bt]=arguments[bt];return re(this,void 0,void 0,function(){var Pr,hr,ur,Et,nt;return pe(this,function(Pt){switch(Pt.label){case 0:Pr=this._getContainerModuleHelpersFactory(),hr=0,ur=yt,Pt.label=1;case 1:return hr<ur.length?(Et=ur[hr],nt=Pr(Et.id),[4,Et.registry(nt.bindFunction,nt.unbindFunction,nt.isboundFunction,nt.rebindFunction)]):[3,4];case 2:Pt.sent(),Pt.label=3;case 3:return hr++,[3,1];case 4:return[2]}})})},Xt.prototype.unload=function(){for(var yt=this,bt=[],Pr=0;Pr<arguments.length;Pr++)bt[Pr]=arguments[Pr];var hr=function(ur){return function(Et){return Et.moduleId===ur}};bt.forEach(function(ur){var Et=hr(ur.id);yt._bindingDictionary.removeByCondition(Et)})},Xt.prototype.bind=function(yt){var bt=this.options.defaultScope||he.BindingScopeEnum.Transient,Pr=new le.Binding(yt,bt);return this._bindingDictionary.add(yt,Pr),new ht.BindingToSyntax(Pr)},Xt.prototype.rebind=function(yt){return this.unbind(yt),this.bind(yt)},Xt.prototype.unbind=function(yt){try{this._bindingDictionary.remove(yt)}catch(bt){throw new Error(U.CANNOT_UNBIND+" "+Dt.getServiceIdentifierAsString(yt))}},Xt.prototype.unbindAll=function(){this._bindingDictionary=new Ht.Lookup},Xt.prototype.isBound=function(yt){var bt=this._bindingDictionary.hasKey(yt);return!bt&&this.parent&&(bt=this.parent.isBound(yt)),bt},Xt.prototype.isBoundNamed=function(yt,bt){return this.isBoundTagged(yt,ae.NAMED_TAG,bt)},Xt.prototype.isBoundTagged=function(yt,bt,Pr){var hr=!1;if(this._bindingDictionary.hasKey(yt)){var ur=this._bindingDictionary.get(yt),Et=ie.createMockRequest(this,yt,bt,Pr);hr=ur.some(function(nt){return nt.constraint(Et)})}return!hr&&this.parent&&(hr=this.parent.isBoundTagged(yt,bt,Pr)),hr},Xt.prototype.snapshot=function(){this._snapshots.push(Yt.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},Xt.prototype.restore=function(){var yt=this._snapshots.pop();if(yt===void 0)throw new Error(U.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=yt.bindings,this._middleware=yt.middleware},Xt.prototype.createChild=function(yt){var bt=new Xt(yt||this.options);return bt.parent=this,bt},Xt.prototype.applyMiddleware=function(){for(var yt=[],bt=0;bt<arguments.length;bt++)yt[bt]=arguments[bt];this._appliedMiddleware=this._appliedMiddleware.concat(yt);var Pr=this._middleware?this._middleware:this._planAndResolve();this._middleware=yt.reduce(function(hr,ur){return ur(hr)},Pr)},Xt.prototype.applyCustomMetadataReader=function(yt){this._metadataReader=yt},Xt.prototype.get=function(yt){return this._get(!1,!1,he.TargetTypeEnum.Variable,yt)},Xt.prototype.getTagged=function(yt,bt,Pr){return this._get(!1,!1,he.TargetTypeEnum.Variable,yt,bt,Pr)},Xt.prototype.getNamed=function(yt,bt){return this.getTagged(yt,ae.NAMED_TAG,bt)},Xt.prototype.getAll=function(yt){return this._get(!0,!0,he.TargetTypeEnum.Variable,yt)},Xt.prototype.getAllTagged=function(yt,bt,Pr){return this._get(!1,!0,he.TargetTypeEnum.Variable,yt,bt,Pr)},Xt.prototype.getAllNamed=function(yt,bt){return this.getAllTagged(yt,ae.NAMED_TAG,bt)},Xt.prototype.resolve=function(yt){var bt=this.createChild();return bt.bind(yt).toSelf(),this._appliedMiddleware.forEach(function(Pr){bt.applyMiddleware(Pr)}),bt.get(yt)},Xt.prototype._getContainerModuleHelpersFactory=function(){var yt=this,bt=function(nt,Pt){nt._binding.moduleId=Pt},Pr=function(nt){return function(Pt){var ft=yt.bind.bind(yt),qt=ft(Pt);return bt(qt,nt),qt}},hr=function(nt){return function(Pt){var ft=yt.unbind.bind(yt);ft(Pt)}},ur=function(nt){return function(Pt){var ft=yt.isBound.bind(yt);return ft(Pt)}},Et=function(nt){return function(Pt){var ft=yt.rebind.bind(yt),qt=ft(Pt);return bt(qt,nt),qt}};return function(nt){return{bindFunction:Pr(nt),isboundFunction:ur(nt),rebindFunction:Et(nt),unbindFunction:hr(nt)}}},Xt.prototype._get=function(yt,bt,Pr,hr,ur,Et){var nt=null,Pt={avoidConstraints:yt,contextInterceptor:function(ft){return ft},isMultiInject:bt,key:ur,serviceIdentifier:hr,targetType:Pr,value:Et};if(this._middleware){if(nt=this._middleware(Pt),nt==null)throw new Error(U.INVALID_MIDDLEWARE_RETURN)}else nt=this._planAndResolve()(Pt);return nt},Xt.prototype._planAndResolve=function(){var yt=this;return function(bt){var Pr=ie.plan(yt._metadataReader,yt,bt.isMultiInject,bt.targetType,bt.serviceIdentifier,bt.key,bt.value,bt.avoidConstraints);Pr=bt.contextInterceptor(Pr);var hr=Ke.resolve(Pr);return hr}},Xt}();J.Container=ir},66440:function(rr,J,L){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.AsyncContainerModule=J.ContainerModule=void 0;var re=L(92452),pe=function(){function le(U){this.id=re.id(),this.registry=U}return le}();J.ContainerModule=pe;var _=function(){function le(U){this.id=re.id(),this.registry=U}return le}();J.AsyncContainerModule=_},527:function(rr,J){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.ContainerSnapshot=void 0;var L=function(){function re(){}return re.of=function(pe,_){var le=new re;return le.bindings=pe,le.middleware=_,le},re}();J.ContainerSnapshot=L},7026:function(rr,J,L){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.Lookup=void 0;var re=L(81463),pe=function(){function _(){this._map=new Map}return _.prototype.getMap=function(){return this._map},_.prototype.add=function(le,U){if(le==null)throw new Error(re.NULL_ARGUMENT);if(U==null)throw new Error(re.NULL_ARGUMENT);var he=this._map.get(le);he!==void 0?(he.push(U),this._map.set(le,he)):this._map.set(le,[U])},_.prototype.get=function(le){if(le==null)throw new Error(re.NULL_ARGUMENT);var U=this._map.get(le);if(U!==void 0)return U;throw new Error(re.KEY_NOT_FOUND)},_.prototype.remove=function(le){if(le==null)throw new Error(re.NULL_ARGUMENT);if(!this._map.delete(le))throw new Error(re.KEY_NOT_FOUND)},_.prototype.removeByCondition=function(le){var U=this;this._map.forEach(function(he,ae){var qe=he.filter(function(ie){return!le(ie)});qe.length>0?U._map.set(ae,qe):U._map.delete(ae)})},_.prototype.hasKey=function(le){if(le==null)throw new Error(re.NULL_ARGUMENT);return this._map.has(le)},_.prototype.clone=function(){var le=new _;return this._map.forEach(function(U,he){U.forEach(function(ae){return le.add(he,ae.clone())})}),le},_.prototype.traverse=function(le){this._map.forEach(function(U,he){le(he,U)})},_}();J.Lookup=pe},14156:function(rr,J,L){"use strict";var re;re={value:!0},re=re=re=re=re=re=J.GW=re=re=J.zY=re=re=re=re=re=J.f3=re=re=J.b2=re=re=re=re=re=J.W2=re=void 0;var pe=L(17597);re=pe;var _=L(27877);Object.defineProperty(J,"W2",{enumerable:!0,get:function(){return _.Container}});var le=L(71297);re={enumerable:!0,get:function(){return le.BindingScopeEnum}},re={enumerable:!0,get:function(){return le.BindingTypeEnum}},re={enumerable:!0,get:function(){return le.TargetTypeEnum}};var U=L(66440);re={enumerable:!0,get:function(){return U.AsyncContainerModule}},re={enumerable:!0,get:function(){return U.ContainerModule}};var he=L(66733);Object.defineProperty(J,"b2",{enumerable:!0,get:function(){return he.injectable}});var ae=L(76316);re={enumerable:!0,get:function(){return ae.tagged}};var qe=L(23769);re={enumerable:!0,get:function(){return qe.named}};var ie=L(71791);Object.defineProperty(J,"f3",{enumerable:!0,get:function(){return ie.inject}}),re={enumerable:!0,get:function(){return ie.LazyServiceIdentifer}};var Ke=L(57758);re={enumerable:!0,get:function(){return Ke.optional}};var ht=L(39868);re={enumerable:!0,get:function(){return ht.unmanaged}};var mt=L(33406);re={enumerable:!0,get:function(){return mt.multiInject}};var Dt=L(26805);re={enumerable:!0,get:function(){return Dt.targetName}};var Yt=L(82935);Object.defineProperty(J,"zY",{enumerable:!0,get:function(){return Yt.postConstruct}});var Ht=L(51288);re={enumerable:!0,get:function(){return Ht.MetadataReader}};var ir=L(92452);re={enumerable:!0,get:function(){return ir.id}};var Xt=L(38362);Object.defineProperty(J,"GW",{enumerable:!0,get:function(){return Xt.decorate}});var yt=L(95093);re={enumerable:!0,get:function(){return yt.traverseAncerstors}},re={enumerable:!0,get:function(){return yt.taggedConstraint}},re={enumerable:!0,get:function(){return yt.namedConstraint}},re={enumerable:!0,get:function(){return yt.typeConstraint}};var bt=L(96783);re={enumerable:!0,get:function(){return bt.getServiceIdentifierAsString}};var Pr=L(6024);re={enumerable:!0,get:function(){return Pr.multiBindToService}}},68338:function(rr,J,L){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.Context=void 0;var re=L(92452),pe=function(){function _(le){this.id=re.id(),this.container=le}return _.prototype.addPlan=function(le){this.plan=le},_.prototype.setCurrentRequest=function(le){this.currentRequest=le},_}();J.Context=pe},4957:function(rr,J,L){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.Metadata=void 0;var re=L(17597),pe=function(){function _(le,U){this.key=le,this.value=U}return _.prototype.toString=function(){return this.key===re.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},_}();J.Metadata=pe},51288:function(rr,J,L){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.MetadataReader=void 0;var re=L(17597),pe=function(){function _(){}return _.prototype.getConstructorMetadata=function(le){var U=Reflect.getMetadata(re.PARAM_TYPES,le),he=Reflect.getMetadata(re.TAGGED,le);return{compilerGeneratedMetadata:U,userGeneratedMetadata:he||{}}},_.prototype.getPropertiesMetadata=function(le){var U=Reflect.getMetadata(re.TAGGED_PROP,le)||[];return U},_}();J.MetadataReader=pe},30515:function(rr,J){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.Plan=void 0;var L=function(){function re(pe,_){this.parentContext=pe,this.rootRequest=_}return re}();J.Plan=L},14346:function(rr,J,L){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.getBindingDictionary=J.createMockRequest=J.plan=void 0;var re=L(53837),pe=L(81463),_=L(71297),le=L(17597),U=L(99438),he=L(96783),ae=L(68338),qe=L(4957),ie=L(30515),Ke=L(4793),ht=L(39373),mt=L(90700);function Dt(hr){return hr._bindingDictionary}J.getBindingDictionary=Dt;function Yt(hr,ur,Et,nt,Pt,ft){var qt=hr?le.MULTI_INJECT_TAG:le.INJECT_TAG,Sr=new qe.Metadata(qt,Et),te=new mt.Target(ur,nt,Et,Sr);if(Pt!==void 0){var H=new qe.Metadata(Pt,ft);te.metadata.push(H)}return te}function Ht(hr,ur,Et,nt,Pt){var ft=yt(Et.container,Pt.serviceIdentifier),qt=[];return ft.length===re.BindingCount.NoBindingsAvailable&&Et.container.options.autoBindInjectable&&typeof Pt.serviceIdentifier=="function"&&hr.getConstructorMetadata(Pt.serviceIdentifier).compilerGeneratedMetadata&&(Et.container.bind(Pt.serviceIdentifier).toSelf(),ft=yt(Et.container,Pt.serviceIdentifier)),ur?qt=ft:qt=ft.filter(function(Sr){var te=new ht.Request(Sr.serviceIdentifier,Et,nt,Sr,Pt);return Sr.constraint(te)}),ir(Pt.serviceIdentifier,qt,Pt,Et.container),qt}function ir(hr,ur,Et,nt){switch(ur.length){case re.BindingCount.NoBindingsAvailable:if(Et.isOptional())return ur;var Pt=he.getServiceIdentifierAsString(hr),ft=pe.NOT_REGISTERED;throw ft+=he.listMetadataForTarget(Pt,Et),ft+=he.listRegisteredBindingsForServiceIdentifier(nt,Pt,yt),new Error(ft);case re.BindingCount.OnlyOneBindingAvailable:if(!Et.isArray())return ur;case re.BindingCount.MultipleBindingsAvailable:default:if(Et.isArray())return ur;var Pt=he.getServiceIdentifierAsString(hr),ft=pe.AMBIGUOUS_MATCH+" "+Pt;throw ft+=he.listRegisteredBindingsForServiceIdentifier(nt,Pt,yt),new Error(ft)}}function Xt(hr,ur,Et,nt,Pt,ft){var qt,Sr;if(Pt===null){qt=Ht(hr,ur,nt,null,ft),Sr=new ht.Request(Et,nt,null,qt,ft);var te=new ie.Plan(nt,Sr);nt.addPlan(te)}else qt=Ht(hr,ur,nt,Pt,ft),Sr=Pt.addChildRequest(ft.serviceIdentifier,qt,ft);qt.forEach(function(H){var K=null;if(ft.isArray())K=Sr.addChildRequest(H.serviceIdentifier,H,ft);else{if(H.cache)return;K=Sr}if(H.type===_.BindingTypeEnum.Instance&&H.implementationType!==null){var Be=Ke.getDependencies(hr,H.implementationType);if(!nt.container.options.skipBaseClassChecks){var Ae=Ke.getBaseClassDependencyCount(hr,H.implementationType);if(Be.length<Ae){var dt=pe.ARGUMENTS_LENGTH_MISMATCH(Ke.getFunctionName(H.implementationType));throw new Error(dt)}}Be.forEach(function(Ue){Xt(hr,!1,Ue.serviceIdentifier,nt,K,Ue)})}})}function yt(hr,ur){var Et=[],nt=Dt(hr);return nt.hasKey(ur)?Et=nt.get(ur):hr.parent!==null&&(Et=yt(hr.parent,ur)),Et}function bt(hr,ur,Et,nt,Pt,ft,qt,Sr){Sr===void 0&&(Sr=!1);var te=new ae.Context(ur),H=Yt(Et,nt,Pt,"",ft,qt);try{return Xt(hr,Sr,Pt,te,null,H),te}catch(K){throw U.isStackOverflowExeption(K)&&te.plan&&he.circularDependencyToException(te.plan.rootRequest),K}}J.plan=bt;function Pr(hr,ur,Et,nt){var Pt=new mt.Target(_.TargetTypeEnum.Variable,"",ur,new qe.Metadata(Et,nt)),ft=new ae.Context(hr),qt=new ht.Request(ur,ft,null,[],Pt);return qt}J.createMockRequest=Pr},41141:function(rr,J){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.QueryableString=void 0;var L=function(){function re(pe){this.str=pe}return re.prototype.startsWith=function(pe){return this.str.indexOf(pe)===0},re.prototype.endsWith=function(pe){var _="",le=pe.split("").reverse().join("");return _=this.str.split("").reverse().join(""),this.startsWith.call({str:_},le)},re.prototype.contains=function(pe){return this.str.indexOf(pe)!==-1},re.prototype.equals=function(pe){return this.str===pe},re.prototype.value=function(){return this.str},re}();J.QueryableString=L},4793:function(rr,J,L){"use strict";var re=this&&this.__spreadArray||function(Ht,ir){for(var Xt=0,yt=ir.length,bt=Ht.length;Xt<yt;Xt++,bt++)Ht[bt]=ir[Xt];return Ht};Object.defineProperty(J,"__esModule",{value:!0}),J.getFunctionName=J.getBaseClassDependencyCount=J.getDependencies=void 0;var pe=L(71791),_=L(81463),le=L(71297),U=L(17597),he=L(96783);Object.defineProperty(J,"getFunctionName",{enumerable:!0,get:function(){return he.getFunctionName}});var ae=L(90700);function qe(Ht,ir){var Xt=he.getFunctionName(ir),yt=ie(Ht,Xt,ir,!1);return yt}J.getDependencies=qe;function ie(Ht,ir,Xt,yt){var bt=Ht.getConstructorMetadata(Xt),Pr=bt.compilerGeneratedMetadata;if(Pr===void 0){var hr=_.MISSING_INJECTABLE_ANNOTATION+" "+ir+".";throw new Error(hr)}var ur=bt.userGeneratedMetadata,Et=Object.keys(ur),nt=Xt.length===0&&Et.length>0,Pt=Et.length>Xt.length,ft=nt||Pt?Et.length:Xt.length,qt=ht(yt,ir,Pr,ur,ft),Sr=mt(Ht,Xt),te=re(re([],qt),Sr);return te}function Ke(Ht,ir,Xt,yt,bt){var Pr=bt[Ht.toString()]||[],hr=Yt(Pr),ur=hr.unmanaged!==!0,Et=yt[Ht],nt=hr.inject||hr.multiInject;if(Et=nt||Et,Et instanceof pe.LazyServiceIdentifer&&(Et=Et.unwrap()),ur){var Pt=Et===Object,ft=Et===Function,qt=Et===void 0,Sr=Pt||ft||qt;if(!ir&&Sr){var te=_.MISSING_INJECT_ANNOTATION+" argument "+Ht+" in class "+Xt+".";throw new Error(te)}var H=new ae.Target(le.TargetTypeEnum.ConstructorArgument,hr.targetName,Et);return H.metadata=Pr,H}return null}function ht(Ht,ir,Xt,yt,bt){for(var Pr=[],hr=0;hr<bt;hr++){var ur=hr,Et=Ke(ur,Ht,ir,Xt,yt);Et!==null&&Pr.push(Et)}return Pr}function mt(Ht,ir){for(var Xt=Ht.getPropertiesMetadata(ir),yt=[],bt=Object.keys(Xt),Pr=0,hr=bt;Pr<hr.length;Pr++){var ur=hr[Pr],Et=Xt[ur],nt=Yt(Xt[ur]),Pt=nt.targetName||ur,ft=nt.inject||nt.multiInject,qt=new ae.Target(le.TargetTypeEnum.ClassProperty,Pt,ft);qt.metadata=Et,yt.push(qt)}var Sr=Object.getPrototypeOf(ir.prototype).constructor;if(Sr!==Object){var te=mt(Ht,Sr);yt=re(re([],yt),te)}return yt}function Dt(Ht,ir){var Xt=Object.getPrototypeOf(ir.prototype).constructor;if(Xt!==Object){var yt=he.getFunctionName(Xt),bt=ie(Ht,yt,Xt,!0),Pr=bt.map(function(Et){return Et.metadata.filter(function(nt){return nt.key===U.UNMANAGED_TAG})}),hr=[].concat.apply([],Pr).length,ur=bt.length-hr;return ur>0?ur:Dt(Ht,Xt)}else return 0}J.getBaseClassDependencyCount=Dt;function Yt(Ht){var ir={};return Ht.forEach(function(Xt){ir[Xt.key.toString()]=Xt.value}),{inject:ir[U.INJECT_TAG],multiInject:ir[U.MULTI_INJECT_TAG],targetName:ir[U.NAME_TAG],unmanaged:ir[U.UNMANAGED_TAG]}}},39373:function(rr,J,L){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.Request=void 0;var re=L(92452),pe=function(){function _(le,U,he,ae,qe){this.id=re.id(),this.serviceIdentifier=le,this.parentContext=U,this.parentRequest=he,this.target=qe,this.childRequests=[],this.bindings=Array.isArray(ae)?ae:[ae],this.requestScope=he===null?new Map:null}return _.prototype.addChildRequest=function(le,U,he){var ae=new _(le,this.parentContext,this,U,he);return this.childRequests.push(ae),ae},_}();J.Request=pe},90700:function(rr,J,L){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.Target=void 0;var re=L(17597),pe=L(92452),_=L(4957),le=L(41141),U=function(){function he(ae,qe,ie,Ke){this.id=pe.id(),this.type=ae,this.serviceIdentifier=ie,this.name=new le.QueryableString(qe||""),this.metadata=new Array;var ht=null;typeof Ke=="string"?ht=new _.Metadata(re.NAMED_TAG,Ke):Ke instanceof _.Metadata&&(ht=Ke),ht!==null&&this.metadata.push(ht)}return he.prototype.hasTag=function(ae){for(var qe=0,ie=this.metadata;qe<ie.length;qe++){var Ke=ie[qe];if(Ke.key===ae)return!0}return!1},he.prototype.isArray=function(){return this.hasTag(re.MULTI_INJECT_TAG)},he.prototype.matchesArray=function(ae){return this.matchesTag(re.MULTI_INJECT_TAG)(ae)},he.prototype.isNamed=function(){return this.hasTag(re.NAMED_TAG)},he.prototype.isTagged=function(){return this.metadata.some(function(ae){return re.NON_CUSTOM_TAG_KEYS.every(function(qe){return ae.key!==qe})})},he.prototype.isOptional=function(){return this.matchesTag(re.OPTIONAL_TAG)(!0)},he.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(ae){return ae.key===re.NAMED_TAG})[0]:null},he.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(ae){return re.NON_CUSTOM_TAG_KEYS.every(function(qe){return ae.key!==qe})}):null},he.prototype.matchesNamedTag=function(ae){return this.matchesTag(re.NAMED_TAG)(ae)},he.prototype.matchesTag=function(ae){var qe=this;return function(ie){for(var Ke=0,ht=qe.metadata;Ke<ht.length;Ke++){var mt=ht[Ke];if(mt.key===ae&&mt.value===ie)return!0}return!1}},he}();J.Target=U},31831:function(rr,J,L){"use strict";var re=this&&this.__spreadArray||function(ie,Ke){for(var ht=0,mt=Ke.length,Dt=ie.length;ht<mt;ht++,Dt++)ie[Dt]=Ke[ht];return ie};Object.defineProperty(J,"__esModule",{value:!0}),J.resolveInstance=void 0;var pe=L(81463),_=L(71297),le=L(17597);function U(ie,Ke,ht){var mt=Ke.filter(function(Yt){return Yt.target!==null&&Yt.target.type===_.TargetTypeEnum.ClassProperty}),Dt=mt.map(ht);return mt.forEach(function(Yt,Ht){var ir="";ir=Yt.target.name.value();var Xt=Dt[Ht];ie[ir]=Xt}),ie}function he(ie,Ke){return new(ie.bind.apply(ie,re([void 0],Ke)))}function ae(ie,Ke){if(Reflect.hasMetadata(le.POST_CONSTRUCT,ie)){var ht=Reflect.getMetadata(le.POST_CONSTRUCT,ie);try{Ke[ht.value]()}catch(mt){throw new Error(pe.POST_CONSTRUCT_ERROR(ie.name,mt.message))}}}function qe(ie,Ke,ht){var mt=null;if(Ke.length>0){var Dt=Ke.filter(function(Ht){return Ht.target!==null&&Ht.target.type===_.TargetTypeEnum.ConstructorArgument}),Yt=Dt.map(ht);mt=he(ie,Yt),mt=U(mt,Ke,ht)}else mt=new ie;return ae(ie,mt),mt}J.resolveInstance=qe},50857:function(rr,J,L){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.resolve=void 0;var re=L(81463),pe=L(71297),_=L(99438),le=L(96783),U=L(31831),he=function(ie,Ke,ht){try{return ht()}catch(mt){throw _.isStackOverflowExeption(mt)?new Error(re.CIRCULAR_DEPENDENCY_IN_FACTORY(ie,Ke.toString())):mt}},ae=function(ie){return function(Ke){Ke.parentContext.setCurrentRequest(Ke);var ht=Ke.bindings,mt=Ke.childRequests,Dt=Ke.target&&Ke.target.isArray(),Yt=!Ke.parentRequest||!Ke.parentRequest.target||!Ke.target||!Ke.parentRequest.target.matchesArray(Ke.target.serviceIdentifier);if(Dt&&Yt)return mt.map(function(Pr){var hr=ae(ie);return hr(Pr)});var Ht=null;if(Ke.target.isOptional()&&ht.length===0)return;var ir=ht[0],Xt=ir.scope===pe.BindingScopeEnum.Singleton,yt=ir.scope===pe.BindingScopeEnum.Request;if(Xt&&ir.activated)return ir.cache;if(yt&&ie!==null&&ie.has(ir.id))return ie.get(ir.id);if(ir.type===pe.BindingTypeEnum.ConstantValue)Ht=ir.cache,ir.activated=!0;else if(ir.type===pe.BindingTypeEnum.Function)Ht=ir.cache,ir.activated=!0;else if(ir.type===pe.BindingTypeEnum.Constructor)Ht=ir.implementationType;else if(ir.type===pe.BindingTypeEnum.DynamicValue&&ir.dynamicValue!==null)Ht=he("toDynamicValue",ir.serviceIdentifier,function(){return ir.dynamicValue(Ke.parentContext)});else if(ir.type===pe.BindingTypeEnum.Factory&&ir.factory!==null)Ht=he("toFactory",ir.serviceIdentifier,function(){return ir.factory(Ke.parentContext)});else if(ir.type===pe.BindingTypeEnum.Provider&&ir.provider!==null)Ht=he("toProvider",ir.serviceIdentifier,function(){return ir.provider(Ke.parentContext)});else if(ir.type===pe.BindingTypeEnum.Instance&&ir.implementationType!==null)Ht=U.resolveInstance(ir.implementationType,mt,ae(ie));else{var bt=le.getServiceIdentifierAsString(Ke.serviceIdentifier);throw new Error(re.INVALID_BINDING_TYPE+" "+bt)}return typeof ir.onActivation=="function"&&(Ht=ir.onActivation(Ke.parentContext,Ht)),Xt&&(ir.cache=Ht,ir.activated=!0),yt&&ie!==null&&!ie.has(ir.id)&&ie.set(ir.id,Ht),Ht}};function qe(ie){var Ke=ae(ie.plan.rootRequest.requestScope);return Ke(ie.plan.rootRequest)}J.resolve=qe},29664:function(rr,J,L){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.BindingInSyntax=void 0;var re=L(71297),pe=L(62923),_=function(){function le(U){this._binding=U}return le.prototype.inRequestScope=function(){return this._binding.scope=re.BindingScopeEnum.Request,new pe.BindingWhenOnSyntax(this._binding)},le.prototype.inSingletonScope=function(){return this._binding.scope=re.BindingScopeEnum.Singleton,new pe.BindingWhenOnSyntax(this._binding)},le.prototype.inTransientScope=function(){return this._binding.scope=re.BindingScopeEnum.Transient,new pe.BindingWhenOnSyntax(this._binding)},le}();J.BindingInSyntax=_},35268:function(rr,J,L){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.BindingInWhenOnSyntax=void 0;var re=L(29664),pe=L(85370),_=L(76199),le=function(){function U(he){this._binding=he,this._bindingWhenSyntax=new _.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new pe.BindingOnSyntax(this._binding),this._bindingInSyntax=new re.BindingInSyntax(he)}return U.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},U.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},U.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},U.prototype.when=function(he){return this._bindingWhenSyntax.when(he)},U.prototype.whenTargetNamed=function(he){return this._bindingWhenSyntax.whenTargetNamed(he)},U.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},U.prototype.whenTargetTagged=function(he,ae){return this._bindingWhenSyntax.whenTargetTagged(he,ae)},U.prototype.whenInjectedInto=function(he){return this._bindingWhenSyntax.whenInjectedInto(he)},U.prototype.whenParentNamed=function(he){return this._bindingWhenSyntax.whenParentNamed(he)},U.prototype.whenParentTagged=function(he,ae){return this._bindingWhenSyntax.whenParentTagged(he,ae)},U.prototype.whenAnyAncestorIs=function(he){return this._bindingWhenSyntax.whenAnyAncestorIs(he)},U.prototype.whenNoAncestorIs=function(he){return this._bindingWhenSyntax.whenNoAncestorIs(he)},U.prototype.whenAnyAncestorNamed=function(he){return this._bindingWhenSyntax.whenAnyAncestorNamed(he)},U.prototype.whenAnyAncestorTagged=function(he,ae){return this._bindingWhenSyntax.whenAnyAncestorTagged(he,ae)},U.prototype.whenNoAncestorNamed=function(he){return this._bindingWhenSyntax.whenNoAncestorNamed(he)},U.prototype.whenNoAncestorTagged=function(he,ae){return this._bindingWhenSyntax.whenNoAncestorTagged(he,ae)},U.prototype.whenAnyAncestorMatches=function(he){return this._bindingWhenSyntax.whenAnyAncestorMatches(he)},U.prototype.whenNoAncestorMatches=function(he){return this._bindingWhenSyntax.whenNoAncestorMatches(he)},U.prototype.onActivation=function(he){return this._bindingOnSyntax.onActivation(he)},U}();J.BindingInWhenOnSyntax=le},85370:function(rr,J,L){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.BindingOnSyntax=void 0;var re=L(76199),pe=function(){function _(le){this._binding=le}return _.prototype.onActivation=function(le){return this._binding.onActivation=le,new re.BindingWhenSyntax(this._binding)},_}();J.BindingOnSyntax=pe},98e3:function(rr,J,L){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.BindingToSyntax=void 0;var re=L(81463),pe=L(71297),_=L(35268),le=L(62923),U=function(){function he(ae){this._binding=ae}return he.prototype.to=function(ae){return this._binding.type=pe.BindingTypeEnum.Instance,this._binding.implementationType=ae,new _.BindingInWhenOnSyntax(this._binding)},he.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+re.INVALID_TO_SELF_VALUE);var ae=this._binding.serviceIdentifier;return this.to(ae)},he.prototype.toConstantValue=function(ae){return this._binding.type=pe.BindingTypeEnum.ConstantValue,this._binding.cache=ae,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=pe.BindingScopeEnum.Singleton,new le.BindingWhenOnSyntax(this._binding)},he.prototype.toDynamicValue=function(ae){return this._binding.type=pe.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=ae,this._binding.implementationType=null,new _.BindingInWhenOnSyntax(this._binding)},he.prototype.toConstructor=function(ae){return this._binding.type=pe.BindingTypeEnum.Constructor,this._binding.implementationType=ae,this._binding.scope=pe.BindingScopeEnum.Singleton,new le.BindingWhenOnSyntax(this._binding)},he.prototype.toFactory=function(ae){return this._binding.type=pe.BindingTypeEnum.Factory,this._binding.factory=ae,this._binding.scope=pe.BindingScopeEnum.Singleton,new le.BindingWhenOnSyntax(this._binding)},he.prototype.toFunction=function(ae){if(typeof ae!="function")throw new Error(re.INVALID_FUNCTION_BINDING);var qe=this.toConstantValue(ae);return this._binding.type=pe.BindingTypeEnum.Function,this._binding.scope=pe.BindingScopeEnum.Singleton,qe},he.prototype.toAutoFactory=function(ae){return this._binding.type=pe.BindingTypeEnum.Factory,this._binding.factory=function(qe){var ie=function(){return qe.container.get(ae)};return ie},this._binding.scope=pe.BindingScopeEnum.Singleton,new le.BindingWhenOnSyntax(this._binding)},he.prototype.toProvider=function(ae){return this._binding.type=pe.BindingTypeEnum.Provider,this._binding.provider=ae,this._binding.scope=pe.BindingScopeEnum.Singleton,new le.BindingWhenOnSyntax(this._binding)},he.prototype.toService=function(ae){this.toDynamicValue(function(qe){return qe.container.get(ae)})},he}();J.BindingToSyntax=U},62923:function(rr,J,L){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.BindingWhenOnSyntax=void 0;var re=L(85370),pe=L(76199),_=function(){function le(U){this._binding=U,this._bindingWhenSyntax=new pe.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new re.BindingOnSyntax(this._binding)}return le.prototype.when=function(U){return this._bindingWhenSyntax.when(U)},le.prototype.whenTargetNamed=function(U){return this._bindingWhenSyntax.whenTargetNamed(U)},le.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},le.prototype.whenTargetTagged=function(U,he){return this._bindingWhenSyntax.whenTargetTagged(U,he)},le.prototype.whenInjectedInto=function(U){return this._bindingWhenSyntax.whenInjectedInto(U)},le.prototype.whenParentNamed=function(U){return this._bindingWhenSyntax.whenParentNamed(U)},le.prototype.whenParentTagged=function(U,he){return this._bindingWhenSyntax.whenParentTagged(U,he)},le.prototype.whenAnyAncestorIs=function(U){return this._bindingWhenSyntax.whenAnyAncestorIs(U)},le.prototype.whenNoAncestorIs=function(U){return this._bindingWhenSyntax.whenNoAncestorIs(U)},le.prototype.whenAnyAncestorNamed=function(U){return this._bindingWhenSyntax.whenAnyAncestorNamed(U)},le.prototype.whenAnyAncestorTagged=function(U,he){return this._bindingWhenSyntax.whenAnyAncestorTagged(U,he)},le.prototype.whenNoAncestorNamed=function(U){return this._bindingWhenSyntax.whenNoAncestorNamed(U)},le.prototype.whenNoAncestorTagged=function(U,he){return this._bindingWhenSyntax.whenNoAncestorTagged(U,he)},le.prototype.whenAnyAncestorMatches=function(U){return this._bindingWhenSyntax.whenAnyAncestorMatches(U)},le.prototype.whenNoAncestorMatches=function(U){return this._bindingWhenSyntax.whenNoAncestorMatches(U)},le.prototype.onActivation=function(U){return this._bindingOnSyntax.onActivation(U)},le}();J.BindingWhenOnSyntax=_},76199:function(rr,J,L){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.BindingWhenSyntax=void 0;var re=L(85370),pe=L(95093),_=function(){function le(U){this._binding=U}return le.prototype.when=function(U){return this._binding.constraint=U,new re.BindingOnSyntax(this._binding)},le.prototype.whenTargetNamed=function(U){return this._binding.constraint=pe.namedConstraint(U),new re.BindingOnSyntax(this._binding)},le.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(U){var he=U.target!==null&&!U.target.isNamed()&&!U.target.isTagged();return he},new re.BindingOnSyntax(this._binding)},le.prototype.whenTargetTagged=function(U,he){return this._binding.constraint=pe.taggedConstraint(U)(he),new re.BindingOnSyntax(this._binding)},le.prototype.whenInjectedInto=function(U){return this._binding.constraint=function(he){return pe.typeConstraint(U)(he.parentRequest)},new re.BindingOnSyntax(this._binding)},le.prototype.whenParentNamed=function(U){return this._binding.constraint=function(he){return pe.namedConstraint(U)(he.parentRequest)},new re.BindingOnSyntax(this._binding)},le.prototype.whenParentTagged=function(U,he){return this._binding.constraint=function(ae){return pe.taggedConstraint(U)(he)(ae.parentRequest)},new re.BindingOnSyntax(this._binding)},le.prototype.whenAnyAncestorIs=function(U){return this._binding.constraint=function(he){return pe.traverseAncerstors(he,pe.typeConstraint(U))},new re.BindingOnSyntax(this._binding)},le.prototype.whenNoAncestorIs=function(U){return this._binding.constraint=function(he){return!pe.traverseAncerstors(he,pe.typeConstraint(U))},new re.BindingOnSyntax(this._binding)},le.prototype.whenAnyAncestorNamed=function(U){return this._binding.constraint=function(he){return pe.traverseAncerstors(he,pe.namedConstraint(U))},new re.BindingOnSyntax(this._binding)},le.prototype.whenNoAncestorNamed=function(U){return this._binding.constraint=function(he){return!pe.traverseAncerstors(he,pe.namedConstraint(U))},new re.BindingOnSyntax(this._binding)},le.prototype.whenAnyAncestorTagged=function(U,he){return this._binding.constraint=function(ae){return pe.traverseAncerstors(ae,pe.taggedConstraint(U)(he))},new re.BindingOnSyntax(this._binding)},le.prototype.whenNoAncestorTagged=function(U,he){return this._binding.constraint=function(ae){return!pe.traverseAncerstors(ae,pe.taggedConstraint(U)(he))},new re.BindingOnSyntax(this._binding)},le.prototype.whenAnyAncestorMatches=function(U){return this._binding.constraint=function(he){return pe.traverseAncerstors(he,U)},new re.BindingOnSyntax(this._binding)},le.prototype.whenNoAncestorMatches=function(U){return this._binding.constraint=function(he){return!pe.traverseAncerstors(he,U)},new re.BindingOnSyntax(this._binding)},le}();J.BindingWhenSyntax=_},95093:function(rr,J,L){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.typeConstraint=J.namedConstraint=J.taggedConstraint=J.traverseAncerstors=void 0;var re=L(17597),pe=L(4957),_=function(ae,qe){var ie=ae.parentRequest;return ie!==null?qe(ie)?!0:_(ie,qe):!1};J.traverseAncerstors=_;var le=function(ae){return function(qe){var ie=function(Ke){return Ke!==null&&Ke.target!==null&&Ke.target.matchesTag(ae)(qe)};return ie.metaData=new pe.Metadata(ae,qe),ie}};J.taggedConstraint=le;var U=le(re.NAMED_TAG);J.namedConstraint=U;var he=function(ae){return function(qe){var ie=null;if(qe!==null)if(ie=qe.bindings[0],typeof ae=="string"){var Ke=ie.serviceIdentifier;return Ke===ae}else{var ht=qe.bindings[0].implementationType;return ae===ht}return!1}};J.typeConstraint=he},6024:function(rr,J){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.multiBindToService=void 0;var L=function(re){return function(pe){return function(){for(var _=[],le=0;le<arguments.length;le++)_[le]=arguments[le];return _.forEach(function(U){return re.bind(U).toService(pe)})}}};J.multiBindToService=L},99438:function(rr,J,L){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.isStackOverflowExeption=void 0;var re=L(81463);function pe(_){return _ instanceof RangeError||_.message===re.STACK_OVERFLOW}J.isStackOverflowExeption=pe},92452:function(rr,J){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.id=void 0;var L=0;function re(){return L++}J.id=re},96783:function(rr,J,L){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.circularDependencyToException=J.listMetadataForTarget=J.listRegisteredBindingsForServiceIdentifier=J.getServiceIdentifierAsString=J.getFunctionName=void 0;var re=L(81463);function pe(ie){if(typeof ie=="function"){var Ke=ie;return Ke.name}else{if(typeof ie=="symbol")return ie.toString();var Ke=ie;return Ke}}J.getServiceIdentifierAsString=pe;function _(ie,Ke,ht){var mt="",Dt=ht(ie,Ke);return Dt.length!==0&&(mt=`
Registered bindings:`,Dt.forEach(function(Yt){var Ht="Object";Yt.implementationType!==null&&(Ht=qe(Yt.implementationType)),mt=mt+`
 `+Ht,Yt.constraint.metaData&&(mt=mt+" - "+Yt.constraint.metaData)})),mt}J.listRegisteredBindingsForServiceIdentifier=_;function le(ie,Ke){return ie.parentRequest===null?!1:ie.parentRequest.serviceIdentifier===Ke?!0:le(ie.parentRequest,Ke)}function U(ie){function Ke(mt,Dt){Dt===void 0&&(Dt=[]);var Yt=pe(mt.serviceIdentifier);return Dt.push(Yt),mt.parentRequest!==null?Ke(mt.parentRequest,Dt):Dt}var ht=Ke(ie);return ht.reverse().join(" --> ")}function he(ie){ie.childRequests.forEach(function(Ke){if(le(Ke,Ke.serviceIdentifier)){var ht=U(Ke);throw new Error(re.CIRCULAR_DEPENDENCY+" "+ht)}else he(Ke)})}J.circularDependencyToException=he;function ae(ie,Ke){if(Ke.isTagged()||Ke.isNamed()){var ht="",mt=Ke.getNamedTag(),Dt=Ke.getCustomTags();return mt!==null&&(ht+=mt.toString()+`
`),Dt!==null&&Dt.forEach(function(Yt){ht+=Yt.toString()+`
`})," "+ie+`
 `+ie+" - "+ht}else return" "+ie}J.listMetadataForTarget=ae;function qe(ie){if(ie.name)return ie.name;var Ke=ie.toString(),ht=Ke.match(/^function\s*([^\s(]+)/);return ht?ht[1]:"Anonymous function: "+Ke}J.getFunctionName=qe},45170:function(rr,J,L){var re=L(13807);function pe(_,le){var U=_==null?0:_.length;return!!U&&re(_,le,0)>-1}rr.exports=pe},94936:function(rr){function J(L,re,pe){for(var _=-1,le=L==null?0:L.length;++_<le;)if(pe(re,L[_]))return!0;return!1}rr.exports=J},54527:function(rr){function J(L,re,pe){return L===L&&(pe!==void 0&&(L=L<=pe?L:pe),re!==void 0&&(L=L>=re?L:re)),L}rr.exports=J},92504:function(rr){function J(L,re,pe,_){for(var le=L.length,U=pe+(_?1:-1);_?U--:++U<le;)if(re(L[U],U,L))return U;return-1}rr.exports=J},13807:function(rr,J,L){var re=L(92504),pe=L(99940),_=L(3729);function le(U,he,ae){return he===he?_(U,he,ae):re(U,pe,ae)}rr.exports=le},70525:function(rr){function J(L,re,pe,_){for(var le=pe-1,U=L.length;++le<U;)if(_(L[le],re))return le;return-1}rr.exports=J},99940:function(rr){function J(L){return L!==L}rr.exports=J},66868:function(rr,J,L){var re=L(75697),pe=L(13807),_=L(70525),le=L(58792),U=L(47165),he=Array.prototype,ae=he.splice;function qe(ie,Ke,ht,mt){var Dt=mt?_:pe,Yt=-1,Ht=Ke.length,ir=ie;for(ie===Ke&&(Ke=U(Ke)),ht&&(ir=re(ie,le(ht)));++Yt<Ht;)for(var Xt=0,yt=Ke[Yt],bt=ht?ht(yt):yt;(Xt=Dt(ir,bt,Xt,mt))>-1;)ir!==ie&&ae.call(ir,Xt,1),ae.call(ie,Xt,1);return ie}rr.exports=qe},95453:function(rr,J,L){var re=L(78188),pe=L(45170),_=L(94936),le=L(29880),U=L(17319),he=L(79967),ae=200;function qe(ie,Ke,ht){var mt=-1,Dt=pe,Yt=ie.length,Ht=!0,ir=[],Xt=ir;if(ht)Ht=!1,Dt=_;else if(Yt>=ae){var yt=Ke?null:U(ie);if(yt)return he(yt);Ht=!1,Dt=le,Xt=new re}else Xt=Ke?[]:ir;e:for(;++mt<Yt;){var bt=ie[mt],Pr=Ke?Ke(bt):bt;if(bt=ht||bt!==0?bt:0,Ht&&Pr===Pr){for(var hr=Xt.length;hr--;)if(Xt[hr]===Pr)continue e;Ke&&Xt.push(Pr),ir.push(bt)}else Dt(Xt,Pr,ht)||(Xt!==ir&&Xt.push(Pr),ir.push(bt))}return ir}rr.exports=qe},17319:function(rr,J,L){var re=L(81956),pe=L(43226),_=L(79967),le=1/0,U=re&&1/_(new re([,-0]))[1]==le?function(he){return new re(he)}:pe;rr.exports=U},3729:function(rr){function J(L,re,pe){for(var _=pe-1,le=L.length;++_<le;)if(L[_]===re)return _;return-1}rr.exports=J},35636:function(rr,J,L){var re=L(54527),pe=L(12448);function _(le,U,he){return he===void 0&&(he=U,U=void 0),he!==void 0&&(he=pe(he),he=he===he?he:0),U!==void 0&&(U=pe(U),U=U===U?U:0),re(pe(le),U,he)}rr.exports=_},98071:function(rr,J,L){var re=L(80732),pe=L(55073),_="[object Boolean]";function le(U){return U===!0||U===!1||pe(U)&&re(U)==_}rr.exports=le},31223:function(rr,J,L){var re=L(6620);function pe(_,le){return re(_,le)}rr.exports=pe},46207:function(rr){function J(L){return L==null}rr.exports=J},59933:function(rr,J,L){var re=L(80732),pe=L(55073),_="[object Number]";function le(U){return typeof U=="number"||pe(U)&&re(U)==_}rr.exports=le},89300:function(rr){function J(L){return L===void 0}rr.exports=J},53954:function(rr,J,L){var re=L(97254),pe=L(77991),_=pe(function(le,U,he,ae){re(le,U,he,ae)});rr.exports=_},43226:function(rr){function J(){}rr.exports=J},25066:function(rr,J,L){var re=L(5125),pe=L(20396),_=re(pe);rr.exports=_},20396:function(rr,J,L){var re=L(66868);function pe(_,le){return _&&_.length&&le&&le.length?re(_,le):_}rr.exports=pe},4363:function(rr,J,L){var re=L(95453);function pe(_){return _&&_.length?re(_):[]}rr.exports=pe},86463:function(rr){(function(J,L){rr.exports=L()})(this,function(){"use strict";var J,L,re;function pe(_,le){if(!J)J=le;else if(!L)L=le;else{var U="var sharedChunk = {}; ("+J+")(sharedChunk); ("+L+")(sharedChunk);",he={};J(he),re=le(he),typeof window!="undefined"&&(re.workerUrl=window.URL.createObjectURL(new Blob([U],{type:"text/javascript"})))}}return pe(["exports"],function(_){"use strict";function le(a,u){return a(u={exports:{}},u.exports),u.exports}var U=he;function he(a,u,c,m){this.cx=3*a,this.bx=3*(c-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*u,this.by=3*(m-u)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=m,this.p2x=c,this.p2y=m}he.prototype.sampleCurveX=function(a){return((this.ax*a+this.bx)*a+this.cx)*a},he.prototype.sampleCurveY=function(a){return((this.ay*a+this.by)*a+this.cy)*a},he.prototype.sampleCurveDerivativeX=function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},he.prototype.solveCurveX=function(a,u){var c,m,x,E,A;for(u===void 0&&(u=1e-6),x=a,A=0;A<8;A++){if(E=this.sampleCurveX(x)-a,Math.abs(E)<u)return x;var I=this.sampleCurveDerivativeX(x);if(Math.abs(I)<1e-6)break;x-=E/I}if((x=a)<(c=0))return c;if(x>(m=1))return m;for(;c<m;){if(E=this.sampleCurveX(x),Math.abs(E-a)<u)return x;a>E?c=x:m=x,x=.5*(m-c)+c}return x},he.prototype.solve=function(a,u){return this.sampleCurveY(this.solveCurveX(a,u))};var ae=qe;function qe(a,u){this.x=a,this.y=u}qe.prototype={clone:function(){return new qe(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,u){return this.clone()._rotateAround(a,u)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var u=a.x-this.x,c=a.y-this.y;return u*u+c*c},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,u){return Math.atan2(this.x*u-this.y*a,this.x*a+this.y*u)},_matMult:function(a){var u=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=u,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var u=Math.cos(a),c=Math.sin(a),m=c*this.x+u*this.y;return this.x=u*this.x-c*this.y,this.y=m,this},_rotateAround:function(a,u){var c=Math.cos(a),m=Math.sin(a),x=u.y+m*(this.x-u.x)+c*(this.y-u.y);return this.x=u.x+c*(this.x-u.x)-m*(this.y-u.y),this.y=x,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},qe.convert=function(a){return a instanceof qe?a:Array.isArray(a)?new qe(a[0],a[1]):a};var ie=typeof self!="undefined"?self:{},Ke=Math.pow(2,53)-1;function ht(a,u,c,m){var x=new U(a,u,c,m);return function(E){return x.solve(E)}}var mt=ht(.25,.1,.25,1);function Dt(a,u,c){return Math.min(c,Math.max(u,a))}function Yt(a,u,c){var m=c-u,x=((a-u)%m+m)%m+u;return x===u?c:x}function Ht(a){for(var u=[],c=arguments.length-1;c-- >0;)u[c]=arguments[c+1];for(var m=0,x=u;m<x.length;m+=1){var E=x[m];for(var A in E)a[A]=E[A]}return a}var ir=1;function Xt(){return ir++}function yt(){return function a(u){return u?(u^16*Math.random()>>u/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)}()}function bt(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)}function Pr(a,u){a.forEach(function(c){u[c]&&(u[c]=u[c].bind(u))})}function hr(a,u){return a.indexOf(u,a.length-u.length)!==-1}function ur(a,u,c){var m={};for(var x in a)m[x]=u.call(c||this,a[x],x,a);return m}function Et(a,u,c){var m={};for(var x in a)u.call(c||this,a[x],x,a)&&(m[x]=a[x]);return m}function nt(a){return Array.isArray(a)?a.map(nt):typeof a=="object"&&a?ur(a,nt):a}var Pt={};function ft(a){Pt[a]||(typeof console!="undefined"&&console.warn(a),Pt[a]=!0)}function qt(a,u,c){return(c.y-a.y)*(u.x-a.x)>(u.y-a.y)*(c.x-a.x)}function Sr(a){for(var u=0,c=0,m=a.length,x=m-1,E=void 0,A=void 0;c<m;x=c++)u+=((A=a[x]).x-(E=a[c]).x)*(E.y+A.y);return u}function te(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function H(a){var u={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(m,x,E,A){var I=E||A;return u[x]=!I||I.toLowerCase(),""}),u["max-age"]){var c=parseInt(u["max-age"],10);isNaN(c)?delete u["max-age"]:u["max-age"]=c}return u}var K=null;function Be(a){if(K==null){var u=a.navigator?a.navigator.userAgent:null;K=!!a.safari||!(!u||!(/\b(iPad|iPhone|iPod)\b/.test(u)||u.match("Safari")&&!u.match("Chrome")))}return K}function Ae(a){try{var u=ie[a];return u.setItem("_mapbox_test_",1),u.removeItem("_mapbox_test_"),!0}catch(c){return!1}}var dt,Ue,We,it,Mt=ie.performance&&ie.performance.now?ie.performance.now.bind(ie.performance):Date.now.bind(Date),yr=ie.requestAnimationFrame||ie.mozRequestAnimationFrame||ie.webkitRequestAnimationFrame||ie.msRequestAnimationFrame,lr=ie.cancelAnimationFrame||ie.mozCancelAnimationFrame||ie.webkitCancelAnimationFrame||ie.msCancelAnimationFrame,Cn={now:Mt,frame:function(a){var u=yr(a);return{cancel:function(){return lr(u)}}},getImageData:function(a,u){u===void 0&&(u=0);var c=ie.document.createElement("canvas"),m=c.getContext("2d");if(!m)throw new Error("failed to create canvas 2d context");return c.width=a.width,c.height=a.height,m.drawImage(a,0,0,a.width,a.height),m.getImageData(-u,-u,a.width+2*u,a.height+2*u)},resolveURL:function(a){return dt||(dt=ie.document.createElement("a")),dt.href=a,dt.href},hardwareConcurrency:ie.navigator&&ie.navigator.hardwareConcurrency||4,get devicePixelRatio(){return ie.devicePixelRatio},get prefersReducedMotion(){return!!ie.matchMedia&&(Ue==null&&(Ue=ie.matchMedia("(prefers-reduced-motion: reduce)")),Ue.matches)}},mn={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},un={supported:!1,testSupport:function(a){!oi&&it&&(jn?rn(a):We=a)}},oi=!1,jn=!1;function rn(a){var u=a.createTexture();a.bindTexture(a.TEXTURE_2D,u);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,it),a.isContextLost())return;un.supported=!0}catch(c){}a.deleteTexture(u),oi=!0}ie.document&&((it=ie.document.createElement("img")).onload=function(){We&&rn(We),We=null,jn=!0},it.onerror=function(){oi=!0,We=null},it.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var $i="01",Wi=function(a,u){this._transformRequestFn=a,this._customAccessToken=u,this._createSkuToken()};function Zi(a){return a.indexOf("mapbox:")===0}Wi.prototype._createSkuToken=function(){var a=function(){for(var u="",c=0;c<10;c++)u+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",$i,u].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=a.token,this._skuTokenExpiresAt=a.tokenExpiresAt},Wi.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},Wi.prototype.transformRequest=function(a,u){return this._transformRequestFn&&this._transformRequestFn(a,u)||{url:a}},Wi.prototype.normalizeStyleURL=function(a,u){if(!Zi(a))return a;var c=oa(a);return c.path="/styles/v1"+c.path,this._makeAPIURL(c,this._customAccessToken||u)},Wi.prototype.normalizeGlyphsURL=function(a,u){if(!Zi(a))return a;var c=oa(a);return c.path="/fonts/v1"+c.path,this._makeAPIURL(c,this._customAccessToken||u)},Wi.prototype.normalizeSourceURL=function(a,u){if(!Zi(a))return a;var c=oa(a);return c.path="/v4/"+c.authority+".json",c.params.push("secure"),this._makeAPIURL(c,this._customAccessToken||u)},Wi.prototype.normalizeSpriteURL=function(a,u,c,m){var x=oa(a);return Zi(a)?(x.path="/styles/v1"+x.path+"/sprite"+u+c,this._makeAPIURL(x,this._customAccessToken||m)):(x.path+=""+u+c,$a(x))},Wi.prototype.normalizeTileURL=function(a,u){if(this._isSkuTokenExpired()&&this._createSkuToken(),a&&!Zi(a))return a;var c=oa(a);c.path=c.path.replace(/(\.(png|jpg)\d*)(?=$)/,(Cn.devicePixelRatio>=2||u===512?"@2x":"")+(un.supported?".webp":"$1")),c.path=c.path.replace(/^.+\/v4\//,"/"),c.path="/v4"+c.path;var m=this._customAccessToken||function(x){for(var E=0,A=x;E<A.length;E+=1){var I=A[E].match(/^access_token=(.*)$/);if(I)return I[1]}return null}(c.params)||mn.ACCESS_TOKEN;return mn.REQUIRE_ACCESS_TOKEN&&m&&this._skuToken&&c.params.push("sku="+this._skuToken),this._makeAPIURL(c,m)},Wi.prototype.canonicalizeTileURL=function(a,u){var c=oa(a);if(!c.path.match(/(^\/v4\/)/)||!c.path.match(/\.[\w]+$/))return a;var m="mapbox://tiles/";m+=c.path.replace("/v4/","");var x=c.params;return u&&(x=x.filter(function(E){return!E.match(/^access_token=/)})),x.length&&(m+="?"+x.join("&")),m},Wi.prototype.canonicalizeTileset=function(a,u){for(var c=!!u&&Zi(u),m=[],x=0,E=a.tiles||[];x<E.length;x+=1){var A=E[x];Bn(A)?m.push(this.canonicalizeTileURL(A,c)):m.push(A)}return m},Wi.prototype._makeAPIURL=function(a,u){var c="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",m=oa(mn.API_URL);if(a.protocol=m.protocol,a.authority=m.authority,a.protocol==="http"){var x=a.params.indexOf("secure");x>=0&&a.params.splice(x,1)}if(m.path!=="/"&&(a.path=""+m.path+a.path),!mn.REQUIRE_ACCESS_TOKEN)return $a(a);if(!(u=u||mn.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+c);if(u[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+c);return a.params=a.params.filter(function(E){return E.indexOf("access_token")===-1}),a.params.push("access_token="+u),$a(a)};var Jn=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function Bn(a){return Jn.test(a)}var Do=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function oa(a){var u=a.match(Do);if(!u)throw new Error("Unable to parse URL object");return{protocol:u[1],authority:u[2],path:u[3]||"/",params:u[4]?u[4].split("&"):[]}}function $a(a){var u=a.params.length?"?"+a.params.join("&"):"";return a.protocol+"://"+a.authority+a.path+u}function Ot(a){if(!a)return null;var u=a.split(".");if(!u||u.length!==3)return null;try{return JSON.parse(decodeURIComponent(ie.atob(u[1]).split("").map(function(c){return"%"+("00"+c.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(c){return null}}var F=function(a){this.type=a,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};F.prototype.getStorageKey=function(a){var u,c=Ot(mn.ACCESS_TOKEN);return u=c&&c.u?ie.btoa(encodeURIComponent(c.u).replace(/%([0-9A-F]{2})/g,function(m,x){return String.fromCharCode(+("0x"+x))})):mn.ACCESS_TOKEN||"",a?"mapbox.eventData."+a+":"+u:"mapbox.eventData:"+u},F.prototype.fetchEventData=function(){var a=Ae("localStorage"),u=this.getStorageKey(),c=this.getStorageKey("uuid");if(a)try{var m=ie.localStorage.getItem(u);m&&(this.eventData=JSON.parse(m));var x=ie.localStorage.getItem(c);x&&(this.anonId=x)}catch(E){ft("Unable to read from LocalStorage")}},F.prototype.saveEventData=function(){var a=Ae("localStorage"),u=this.getStorageKey(),c=this.getStorageKey("uuid");if(a)try{ie.localStorage.setItem(c,this.anonId),Object.keys(this.eventData).length>=1&&ie.localStorage.setItem(u,JSON.stringify(this.eventData))}catch(m){ft("Unable to write to LocalStorage")}},F.prototype.processRequests=function(a){},F.prototype.postEvent=function(a,u,c,m){var x=this;if(mn.EVENTS_URL){var E=oa(mn.EVENTS_URL);E.params.push("access_token="+(m||mn.ACCESS_TOKEN||""));var A={event:this.type,created:new Date(a).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.3",skuId:$i,userId:this.anonId},I=u?Ht(A,u):A,D={url:$a(E),headers:{"Content-Type":"text/plain"},body:JSON.stringify([I])};this.pendingRequest=di(D,function(N){x.pendingRequest=null,c(N),x.saveEventData(),x.processRequests(m)})}},F.prototype.queueRequest=function(a,u){this.queue.push(a),this.processRequests(u)};var ne,de,Ne=function(a){function u(){a.call(this,"map.load"),this.success={},this.skuToken=""}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.postMapLoadEvent=function(c,m,x,E){this.skuToken=x;var A=!(!E&&!mn.ACCESS_TOKEN),I=Array.isArray(c)&&c.some(function(D){return Zi(D)||Bn(D)});mn.EVENTS_URL&&A&&I&&this.queueRequest({id:m,timestamp:Date.now()},E)},u.prototype.processRequests=function(c){var m=this;if(!this.pendingRequest&&this.queue.length!==0){var x=this.queue.shift(),E=x.id,A=x.timestamp;E&&this.success[E]||(this.anonId||this.fetchEventData(),bt(this.anonId)||(this.anonId=yt()),this.postEvent(A,{skuToken:this.skuToken},function(I){I||E&&(m.success[E]=!0)},c))}},u}(F),_t=new(function(a){function u(c){a.call(this,"appUserTurnstile"),this._customAccessToken=c}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.postTurnstileEvent=function(c,m){mn.EVENTS_URL&&mn.ACCESS_TOKEN&&Array.isArray(c)&&c.some(function(x){return Zi(x)||Bn(x)})&&this.queueRequest(Date.now(),m)},u.prototype.processRequests=function(c){var m=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var x=Ot(mn.ACCESS_TOKEN),E=x?x.u:mn.ACCESS_TOKEN,A=E!==this.eventData.tokenU;bt(this.anonId)||(this.anonId=yt(),A=!0);var I=this.queue.shift();if(this.eventData.lastSuccess){var D=new Date(this.eventData.lastSuccess),N=new Date(I),j=(I-this.eventData.lastSuccess)/864e5;A=A||j>=1||j<-1||D.getDate()!==N.getDate()}else A=!0;if(!A)return this.processRequests();this.postEvent(I,{"enabled.telemetry":!1},function(X){X||(m.eventData.lastSuccess=I,m.eventData.tokenU=E)},c)}},u}(F)),Kt=_t.postTurnstileEvent.bind(_t),Ar=new Ne,Ve=Ar.postMapLoadEvent.bind(Ar),wt=500,sr=50;function dr(){ie.caches&&!ne&&(ne=ie.caches.open("mapbox-tiles"))}function Vr(a){var u=a.indexOf("?");return u<0?a:a.slice(0,u)}var Ln,En=1/0;function Rn(){return Ln==null&&(Ln=ie.OffscreenCanvas&&new ie.OffscreenCanvas(1,1).getContext("2d")&&typeof ie.createImageBitmap=="function"),Ln}var xn={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(xn);var si=function(a){function u(c,m,x){m===401&&Bn(x)&&(c+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),a.call(this,c),this.status=m,this.url=x,this.name=this.constructor.name,this.message=c}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},u}(Error),ei=te()?function(){return self.worker&&self.worker.referrer}:function(){return(ie.location.protocol==="blob:"?ie.parent:ie).location.href},la,sa,Eo=function(a,u){if(!(/^file:/.test(c=a.url)||/^file:/.test(ei())&&!/^\w+:/.test(c))){if(ie.fetch&&ie.Request&&ie.AbortController&&ie.Request.prototype.hasOwnProperty("signal"))return function(m,x){var E,A=new ie.AbortController,I=new ie.Request(m.url,{method:m.method||"GET",body:m.body,credentials:m.credentials,headers:m.headers,referrer:ei(),signal:A.signal}),D=!1,N=!1,j=(E=I.url).indexOf("sku=")>0&&Bn(E);m.type==="json"&&I.headers.set("Accept","application/json");var X=function(R,Ce,Oe){if(!N){if(R&&R.message!=="SecurityError"&&ft(R),Ce&&Oe)return ee(Ce);var Qe=Date.now();ie.fetch(I).then(function(He){if(He.ok){var xt=j?He.clone():null;return ee(He,xt,Qe)}return x(new si(He.statusText,He.status,m.url))}).catch(function(He){He.code!==20&&x(new Error(He.message))})}},ee=function(R,Ce,Oe){(m.type==="arrayBuffer"?R.arrayBuffer():m.type==="json"?R.json():R.text()).then(function(Qe){N||(Ce&&Oe&&function(He,xt,It){if(dr(),ne){var Vt={status:xt.status,statusText:xt.statusText,headers:new ie.Headers};xt.headers.forEach(function(fr,Lr){return Vt.headers.set(Lr,fr)});var jt=H(xt.headers.get("Cache-Control")||"");jt["no-store"]||(jt["max-age"]&&Vt.headers.set("Expires",new Date(It+1e3*jt["max-age"]).toUTCString()),new Date(Vt.headers.get("Expires")).getTime()-It<42e4||function(fr,Lr){if(de===void 0)try{new Response(new ReadableStream),de=!0}catch(Gr){de=!1}de?Lr(fr.body):fr.blob().then(Lr)}(xt,function(fr){var Lr=new ie.Response(fr,Vt);dr(),ne&&ne.then(function(Gr){return Gr.put(Vr(He.url),Lr)}).catch(function(Gr){return ft(Gr.message)})}))}}(I,Ce,Oe),D=!0,x(null,Qe,R.headers.get("Cache-Control"),R.headers.get("Expires")))}).catch(function(Qe){N||x(new Error(Qe.message))})};return j?function(R,Ce){if(dr(),!ne)return Ce(null);var Oe=Vr(R.url);ne.then(function(Qe){Qe.match(Oe).then(function(He){var xt=function(It){if(!It)return!1;var Vt=new Date(It.headers.get("Expires")||0),jt=H(It.headers.get("Cache-Control")||"");return Vt>Date.now()&&!jt["no-cache"]}(He);Qe.delete(Oe),xt&&Qe.put(Oe,He.clone()),Ce(null,He,xt)}).catch(Ce)}).catch(Ce)}(I,X):X(null,null),{cancel:function(){N=!0,D||A.abort()}}}(a,u);if(te()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,u,void 0,!0)}var c;return function(m,x){var E=new ie.XMLHttpRequest;for(var A in E.open(m.method||"GET",m.url,!0),m.type==="arrayBuffer"&&(E.responseType="arraybuffer"),m.headers)E.setRequestHeader(A,m.headers[A]);return m.type==="json"&&(E.responseType="text",E.setRequestHeader("Accept","application/json")),E.withCredentials=m.credentials==="include",E.onerror=function(){x(new Error(E.statusText))},E.onload=function(){if((E.status>=200&&E.status<300||E.status===0)&&E.response!==null){var I=E.response;if(m.type==="json")try{I=JSON.parse(E.response)}catch(D){return x(D)}x(null,I,E.getResponseHeader("Cache-Control"),E.getResponseHeader("Expires"))}else x(new si(E.statusText,E.status,m.url))},E.send(m.body),{cancel:function(){return E.abort()}}}(a,u)},Ks=function(a,u){return Eo(Ht(a,{type:"arrayBuffer"}),u)},di=function(a,u){return Eo(Ht(a,{method:"POST"}),u)},W="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";la=[],sa=0;var Q=function(a,u){if(un.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),sa>=mn.MAX_PARALLEL_IMAGE_REQUESTS){var c={requestParameters:a,callback:u,cancelled:!1,cancel:function(){this.cancelled=!0}};return la.push(c),c}sa++;var m=!1,x=function(){if(!m)for(m=!0,sa--;la.length&&sa<mn.MAX_PARALLEL_IMAGE_REQUESTS;){var A=la.shift();A.cancelled||(A.cancel=Q(A.requestParameters,A.callback).cancel)}},E=Ks(a,function(A,I,D,N){x(),A?u(A):I&&(Rn()?function(j,X){var ee=new ie.Blob([new Uint8Array(j)],{type:"image/png"});ie.createImageBitmap(ee).then(function(R){X(null,R)}).catch(function(R){X(new Error("Could not load image because of "+R.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(I,u):function(j,X,ee,R){var Ce=new ie.Image,Oe=ie.URL;Ce.onload=function(){X(null,Ce),Oe.revokeObjectURL(Ce.src),Ce.onload=null,ie.requestAnimationFrame(function(){Ce.src=W})},Ce.onerror=function(){return X(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var Qe=new ie.Blob([new Uint8Array(j)],{type:"image/png"});Ce.cacheControl=ee,Ce.expires=R,Ce.src=j.byteLength?Oe.createObjectURL(Qe):W}(I,u,D,N))});return{cancel:function(){E.cancel(),x()}}};function se(a,u,c){c[a]&&c[a].indexOf(u)!==-1||(c[a]=c[a]||[],c[a].push(u))}function xe(a,u,c){if(c&&c[a]){var m=c[a].indexOf(u);m!==-1&&c[a].splice(m,1)}}var Re=function(a,u){u===void 0&&(u={}),Ht(this,u),this.type=a},Je=function(a){function u(c,m){m===void 0&&(m={}),a.call(this,"error",Ht({error:c},m))}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u}(Re),lt=function(){};lt.prototype.on=function(a,u){return this._listeners=this._listeners||{},se(a,u,this._listeners),this},lt.prototype.off=function(a,u){return xe(a,u,this._listeners),xe(a,u,this._oneTimeListeners),this},lt.prototype.once=function(a,u){return this._oneTimeListeners=this._oneTimeListeners||{},se(a,u,this._oneTimeListeners),this},lt.prototype.fire=function(a,u){typeof a=="string"&&(a=new Re(a,u||{}));var c=a.type;if(this.listens(c)){a.target=this;for(var m=0,x=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];m<x.length;m+=1)x[m].call(this,a);for(var E=0,A=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];E<A.length;E+=1){var I=A[E];xe(c,I,this._oneTimeListeners),I.call(this,a)}var D=this._eventedParent;D&&(Ht(a,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),D.fire(a))}else a instanceof Je&&console.error(a.error);return this},lt.prototype.listens=function(a){return this._listeners&&this._listeners[a]&&this._listeners[a].length>0||this._oneTimeListeners&&this._oneTimeListeners[a]&&this._oneTimeListeners[a].length>0||this._eventedParent&&this._eventedParent.listens(a)},lt.prototype.setEventedParent=function(a,u){return this._eventedParent=a,this._eventedParentData=u,this};var V={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},q=function(a,u,c,m){this.message=(a?a+": ":"")+c,m&&(this.identifier=m),u!=null&&u.__line__&&(this.line=u.__line__)};function De(a){var u=a.value;return u?[new q(a.key,u,"constants have been deprecated as of v8")]:[]}function et(a){for(var u=[],c=arguments.length-1;c-- >0;)u[c]=arguments[c+1];for(var m=0,x=u;m<x.length;m+=1){var E=x[m];for(var A in E)a[A]=E[A]}return a}function be(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function er(a){if(Array.isArray(a))return a.map(er);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){var u={};for(var c in a)u[c]=er(a[c]);return u}return be(a)}var Tr=function(a){function u(c,m){a.call(this,m),this.message=m,this.key=c}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u}(Error),bn=function(a,u){u===void 0&&(u=[]),this.parent=a,this.bindings={};for(var c=0,m=u;c<m.length;c+=1){var x=m[c];this.bindings[x[0]]=x[1]}};bn.prototype.concat=function(a){return new bn(this,a)},bn.prototype.get=function(a){if(this.bindings[a])return this.bindings[a];if(this.parent)return this.parent.get(a);throw new Error(a+" not found in scope.")},bn.prototype.has=function(a){return!!this.bindings[a]||!!this.parent&&this.parent.has(a)};var nn={kind:"null"},ar={kind:"number"},Kr={kind:"string"},Hr={kind:"boolean"},$r={kind:"color"},hi={kind:"object"},Qr={kind:"value"},vi={kind:"collator"},Yi={kind:"formatted"},ci={kind:"resolvedImage"};function Li(a,u){return{kind:"array",itemType:a,N:u}}function Si(a){if(a.kind==="array"){var u=Si(a.itemType);return typeof a.N=="number"?"array<"+u+", "+a.N+">":a.itemType.kind==="value"?"array":"array<"+u+">"}return a.kind}var Xo=[nn,ar,Kr,Hr,$r,Yi,hi,Li(Qr),ci];function Ki(a,u){if(u.kind==="error")return null;if(a.kind==="array"){if(u.kind==="array"&&(u.N===0&&u.itemType.kind==="value"||!Ki(a.itemType,u.itemType))&&(typeof a.N!="number"||a.N===u.N))return null}else{if(a.kind===u.kind)return null;if(a.kind==="value"){for(var c=0,m=Xo;c<m.length;c+=1)if(!Ki(m[c],u))return null}}return"Expected "+Si(a)+" but found "+Si(u)+" instead."}function Ia(a,u){return u.some(function(c){return c.kind===a.kind})}function Ai(a,u){return u.some(function(c){return c==="null"?a===null:c==="array"?Array.isArray(a):c==="object"?a&&!Array.isArray(a)&&typeof a=="object":c===typeof a})}var mi=le(function(a,u){var c={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function m(I){return(I=Math.round(I))<0?0:I>255?255:I}function x(I){return m(I[I.length-1]==="%"?parseFloat(I)/100*255:parseInt(I))}function E(I){return(D=I[I.length-1]==="%"?parseFloat(I)/100:parseFloat(I))<0?0:D>1?1:D;var D}function A(I,D,N){return N<0?N+=1:N>1&&(N-=1),6*N<1?I+(D-I)*N*6:2*N<1?D:3*N<2?I+(D-I)*(2/3-N)*6:I}try{u.parseCSSColor=function(I){var D,N=I.replace(/ /g,"").toLowerCase();if(N in c)return c[N].slice();if(N[0]==="#")return N.length===4?(D=parseInt(N.substr(1),16))>=0&&D<=4095?[(3840&D)>>4|(3840&D)>>8,240&D|(240&D)>>4,15&D|(15&D)<<4,1]:null:N.length===7&&(D=parseInt(N.substr(1),16))>=0&&D<=16777215?[(16711680&D)>>16,(65280&D)>>8,255&D,1]:null;var j=N.indexOf("("),X=N.indexOf(")");if(j!==-1&&X+1===N.length){var ee=N.substr(0,j),R=N.substr(j+1,X-(j+1)).split(","),Ce=1;switch(ee){case"rgba":if(R.length!==4)return null;Ce=E(R.pop());case"rgb":return R.length!==3?null:[x(R[0]),x(R[1]),x(R[2]),Ce];case"hsla":if(R.length!==4)return null;Ce=E(R.pop());case"hsl":if(R.length!==3)return null;var Oe=(parseFloat(R[0])%360+360)%360/360,Qe=E(R[1]),He=E(R[2]),xt=He<=.5?He*(Qe+1):He+Qe-He*Qe,It=2*He-xt;return[m(255*A(It,xt,Oe+1/3)),m(255*A(It,xt,Oe)),m(255*A(It,xt,Oe-1/3)),Ce];default:return null}}return null}}catch(I){}}).parseCSSColor,Ti=function(a,u,c,m){m===void 0&&(m=1),this.r=a,this.g=u,this.b=c,this.a=m};Ti.parse=function(a){if(a){if(a instanceof Ti)return a;if(typeof a=="string"){var u=mi(a);if(u)return new Ti(u[0]/255*u[3],u[1]/255*u[3],u[2]/255*u[3],u[3])}}},Ti.prototype.toString=function(){var a=this.toArray(),u=a[1],c=a[2],m=a[3];return"rgba("+Math.round(a[0])+","+Math.round(u)+","+Math.round(c)+","+m+")"},Ti.prototype.toArray=function(){var a=this.a;return a===0?[0,0,0,0]:[255*this.r/a,255*this.g/a,255*this.b/a,a]},Ti.black=new Ti(0,0,0,1),Ti.white=new Ti(1,1,1,1),Ti.transparent=new Ti(0,0,0,0),Ti.red=new Ti(1,0,0,1);var Pa=function(a,u,c){this.sensitivity=a?u?"variant":"case":u?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Pa.prototype.compare=function(a,u){return this.collator.compare(a,u)},Pa.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var cu=function(a,u,c,m,x){this.text=a,this.image=u,this.scale=c,this.fontStack=m,this.textColor=x},ma=function(a){this.sections=a};ma.fromString=function(a){return new ma([new cu(a,null,null,null,null)])},ma.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(a){return a.text.length!==0||a.image&&a.image.name.length!==0})},ma.factory=function(a){return a instanceof ma?a:ma.fromString(a)},ma.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(a){return a.text}).join("")},ma.prototype.serialize=function(){for(var a=["format"],u=0,c=this.sections;u<c.length;u+=1){var m=c[u];if(m.image)a.push(["image",m.image.name]);else{a.push(m.text);var x={};m.fontStack&&(x["text-font"]=["literal",m.fontStack.split(",")]),m.scale&&(x["font-scale"]=m.scale),m.textColor&&(x["text-color"]=["rgba"].concat(m.textColor.toArray())),a.push(x)}}return a};var Aa=function(a){this.name=a.name,this.available=a.available};function $l(a,u,c,m){return typeof a=="number"&&a>=0&&a<=255&&typeof u=="number"&&u>=0&&u<=255&&typeof c=="number"&&c>=0&&c<=255?m===void 0||typeof m=="number"&&m>=0&&m<=1?null:"Invalid rgba value ["+[a,u,c,m].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof m=="number"?[a,u,c,m]:[a,u,c]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function os(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof Ti||a instanceof Pa||a instanceof ma||a instanceof Aa)return!0;if(Array.isArray(a)){for(var u=0,c=a;u<c.length;u+=1)if(!os(c[u]))return!1;return!0}if(typeof a=="object"){for(var m in a)if(!os(a[m]))return!1;return!0}return!1}function Ta(a){if(a===null)return nn;if(typeof a=="string")return Kr;if(typeof a=="boolean")return Hr;if(typeof a=="number")return ar;if(a instanceof Ti)return $r;if(a instanceof Pa)return vi;if(a instanceof ma)return Yi;if(a instanceof Aa)return ci;if(Array.isArray(a)){for(var u,c=a.length,m=0,x=a;m<x.length;m+=1){var E=Ta(x[m]);if(u){if(u===E)continue;u=Qr;break}u=E}return Li(u||Qr,c)}return hi}function fi(a){var u=typeof a;return a===null?"":u==="string"||u==="number"||u==="boolean"?String(a):a instanceof Ti||a instanceof ma||a instanceof Aa?a.toString():JSON.stringify(a)}Aa.prototype.toString=function(){return this.name},Aa.fromString=function(a){return a?new Aa({name:a,available:!1}):null},Aa.prototype.serialize=function(){return["image",this.name]};var Oa=function(a,u){this.type=a,this.value=u};Oa.parse=function(a,u){if(a.length!==2)return u.error("'literal' expression requires exactly one argument, but found "+(a.length-1)+" instead.");if(!os(a[1]))return u.error("invalid value");var c=a[1],m=Ta(c),x=u.expectedType;return m.kind!=="array"||m.N!==0||!x||x.kind!=="array"||typeof x.N=="number"&&x.N!==0||(m=x),new Oa(m,c)},Oa.prototype.evaluate=function(){return this.value},Oa.prototype.eachChild=function(){},Oa.prototype.outputDefined=function(){return!0},Oa.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Ti?["rgba"].concat(this.value.toArray()):this.value instanceof ma?this.value.serialize():this.value};var ia=function(a){this.name="ExpressionEvaluationError",this.message=a};ia.prototype.toJSON=function(){return this.message};var So={string:Kr,number:ar,boolean:Hr,object:hi},ha=function(a,u){this.type=a,this.args=u};ha.parse=function(a,u){if(a.length<2)return u.error("Expected at least one argument.");var c,m=1,x=a[0];if(x==="array"){var E,A;if(a.length>2){var I=a[1];if(typeof I!="string"||!(I in So)||I==="object")return u.error('The item type argument of "array" must be one of string, number, boolean',1);E=So[I],m++}else E=Qr;if(a.length>3){if(a[2]!==null&&(typeof a[2]!="number"||a[2]<0||a[2]!==Math.floor(a[2])))return u.error('The length argument to "array" must be a positive integer literal',2);A=a[2],m++}c=Li(E,A)}else c=So[x];for(var D=[];m<a.length;m++){var N=u.parse(a[m],m,Qr);if(!N)return null;D.push(N)}return new ha(c,D)},ha.prototype.evaluate=function(a){for(var u=0;u<this.args.length;u++){var c=this.args[u].evaluate(a);if(!Ki(this.type,Ta(c)))return c;if(u===this.args.length-1)throw new ia("Expected value to be of type "+Si(this.type)+", but found "+Si(Ta(c))+" instead.")}return null},ha.prototype.eachChild=function(a){this.args.forEach(a)},ha.prototype.outputDefined=function(){return this.args.every(function(a){return a.outputDefined()})},ha.prototype.serialize=function(){var a=this.type,u=[a.kind];if(a.kind==="array"){var c=a.itemType;if(c.kind==="string"||c.kind==="number"||c.kind==="boolean"){u.push(c.kind);var m=a.N;(typeof m=="number"||this.args.length>1)&&u.push(m)}}return u.concat(this.args.map(function(x){return x.serialize()}))};var $o=function(a){this.type=Yi,this.sections=a};$o.parse=function(a,u){if(a.length<2)return u.error("Expected at least one argument.");var c=a[1];if(!Array.isArray(c)&&typeof c=="object")return u.error("First argument must be an image or text section.");for(var m=[],x=!1,E=1;E<=a.length-1;++E){var A=a[E];if(x&&typeof A=="object"&&!Array.isArray(A)){x=!1;var I=null;if(A["font-scale"]&&!(I=u.parse(A["font-scale"],1,ar)))return null;var D=null;if(A["text-font"]&&!(D=u.parse(A["text-font"],1,Li(Kr))))return null;var N=null;if(A["text-color"]&&!(N=u.parse(A["text-color"],1,$r)))return null;var j=m[m.length-1];j.scale=I,j.font=D,j.textColor=N}else{var X=u.parse(a[E],1,Qr);if(!X)return null;var ee=X.type.kind;if(ee!=="string"&&ee!=="value"&&ee!=="null"&&ee!=="resolvedImage")return u.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");x=!0,m.push({content:X,scale:null,font:null,textColor:null})}}return new $o(m)},$o.prototype.evaluate=function(a){return new ma(this.sections.map(function(u){var c=u.content.evaluate(a);return Ta(c)===ci?new cu("",c,null,null,null):new cu(fi(c),null,u.scale?u.scale.evaluate(a):null,u.font?u.font.evaluate(a).join(","):null,u.textColor?u.textColor.evaluate(a):null)}))},$o.prototype.eachChild=function(a){for(var u=0,c=this.sections;u<c.length;u+=1){var m=c[u];a(m.content),m.scale&&a(m.scale),m.font&&a(m.font),m.textColor&&a(m.textColor)}},$o.prototype.outputDefined=function(){return!1},$o.prototype.serialize=function(){for(var a=["format"],u=0,c=this.sections;u<c.length;u+=1){var m=c[u];a.push(m.content.serialize());var x={};m.scale&&(x["font-scale"]=m.scale.serialize()),m.font&&(x["text-font"]=m.font.serialize()),m.textColor&&(x["text-color"]=m.textColor.serialize()),a.push(x)}return a};var Vo=function(a){this.type=ci,this.input=a};Vo.parse=function(a,u){if(a.length!==2)return u.error("Expected two arguments.");var c=u.parse(a[1],1,Kr);return c?new Vo(c):u.error("No image name provided.")},Vo.prototype.evaluate=function(a){var u=this.input.evaluate(a),c=Aa.fromString(u);return c&&a.availableImages&&(c.available=a.availableImages.indexOf(u)>-1),c},Vo.prototype.eachChild=function(a){a(this.input)},Vo.prototype.outputDefined=function(){return!1},Vo.prototype.serialize=function(){return["image",this.input.serialize()]};var Ru={"to-boolean":Hr,"to-color":$r,"to-number":ar,"to-string":Kr},ss=function(a,u){this.type=a,this.args=u};ss.parse=function(a,u){if(a.length<2)return u.error("Expected at least one argument.");var c=a[0];if((c==="to-boolean"||c==="to-string")&&a.length!==2)return u.error("Expected one argument.");for(var m=Ru[c],x=[],E=1;E<a.length;E++){var A=u.parse(a[E],E,Qr);if(!A)return null;x.push(A)}return new ss(m,x)},ss.prototype.evaluate=function(a){if(this.type.kind==="boolean")return!!this.args[0].evaluate(a);if(this.type.kind==="color"){for(var u,c,m=0,x=this.args;m<x.length;m+=1){if(c=null,(u=x[m].evaluate(a))instanceof Ti)return u;if(typeof u=="string"){var E=a.parseColor(u);if(E)return E}else if(Array.isArray(u)&&!(c=u.length<3||u.length>4?"Invalid rbga value "+JSON.stringify(u)+": expected an array containing either three or four numeric values.":$l(u[0],u[1],u[2],u[3])))return new Ti(u[0]/255,u[1]/255,u[2]/255,u[3])}throw new ia(c||"Could not parse color from value '"+(typeof u=="string"?u:String(JSON.stringify(u)))+"'")}if(this.type.kind==="number"){for(var A=null,I=0,D=this.args;I<D.length;I+=1){if((A=D[I].evaluate(a))===null)return 0;var N=Number(A);if(!isNaN(N))return N}throw new ia("Could not convert "+JSON.stringify(A)+" to number.")}return this.type.kind==="formatted"?ma.fromString(fi(this.args[0].evaluate(a))):this.type.kind==="resolvedImage"?Aa.fromString(fi(this.args[0].evaluate(a))):fi(this.args[0].evaluate(a))},ss.prototype.eachChild=function(a){this.args.forEach(a)},ss.prototype.outputDefined=function(){return this.args.every(function(a){return a.outputDefined()})},ss.prototype.serialize=function(){if(this.type.kind==="formatted")return new $o([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Vo(this.args[0]).serialize();var a=["to-"+this.type.kind];return this.eachChild(function(u){a.push(u.serialize())}),a};var Cc=["Unknown","Point","LineString","Polygon"],Ea=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};Ea.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},Ea.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?Cc[this.feature.type]:this.feature.type:null},Ea.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},Ea.prototype.canonicalID=function(){return this.canonical},Ea.prototype.properties=function(){return this.feature&&this.feature.properties||{}},Ea.prototype.parseColor=function(a){var u=this._parseColorCache[a];return u||(u=this._parseColorCache[a]=Ti.parse(a)),u};var Qi=function(a,u,c,m){this.name=a,this.type=u,this._evaluate=c,this.args=m};Qi.prototype.evaluate=function(a){return this._evaluate(a,this.args)},Qi.prototype.eachChild=function(a){this.args.forEach(a)},Qi.prototype.outputDefined=function(){return!1},Qi.prototype.serialize=function(){return[this.name].concat(this.args.map(function(a){return a.serialize()}))},Qi.parse=function(a,u){var c,m=a[0],x=Qi.definitions[m];if(!x)return u.error('Unknown expression "'+m+'". If you wanted a literal array, use ["literal", [...]].',0);for(var E=Array.isArray(x)?x[0]:x.type,A=Array.isArray(x)?[[x[1],x[2]]]:x.overloads,I=A.filter(function(zn){var cn=zn[0];return!Array.isArray(cn)||cn.length===a.length-1}),D=null,N=0,j=I;N<j.length;N+=1){var X=j[N],ee=X[0],R=X[1];D=new Qu(u.registry,u.path,null,u.scope);for(var Ce=[],Oe=!1,Qe=1;Qe<a.length;Qe++){var He=a[Qe],xt=Array.isArray(ee)?ee[Qe-1]:ee.type,It=D.parse(He,1+Ce.length,xt);if(!It){Oe=!0;break}Ce.push(It)}if(!Oe)if(Array.isArray(ee)&&ee.length!==Ce.length)D.error("Expected "+ee.length+" arguments, but found "+Ce.length+" instead.");else{for(var Vt=0;Vt<Ce.length;Vt++){var jt=Array.isArray(ee)?ee[Vt]:ee.type,fr=Ce[Vt];D.concat(Vt+1).checkSubtype(jt,fr.type)}if(D.errors.length===0)return new Qi(m,E,R,Ce)}}if(I.length===1)(c=u.errors).push.apply(c,D.errors);else{for(var Lr=(I.length?I:A).map(function(zn){var cn;return cn=zn[0],Array.isArray(cn)?"("+cn.map(Si).join(", ")+")":"("+Si(cn.type)+"...)"}).join(" | "),Gr=[],Dn=1;Dn<a.length;Dn++){var sn=u.parse(a[Dn],1+Gr.length);if(!sn)return null;Gr.push(Si(sn.type))}u.error("Expected arguments of type "+Lr+", but found ("+Gr.join(", ")+") instead.")}return null},Qi.register=function(a,u){for(var c in Qi.definitions=u,u)a[c]=Qi};var Wt=function(a,u,c){this.type=vi,this.locale=c,this.caseSensitive=a,this.diacriticSensitive=u};function yn(a,u){a[0]=Math.min(a[0],u[0]),a[1]=Math.min(a[1],u[1]),a[2]=Math.max(a[2],u[0]),a[3]=Math.max(a[3],u[1])}function fe(a,u){return!(a[0]<=u[0]||a[2]>=u[2]||a[1]<=u[1]||a[3]>=u[3])}function Te(a,u){var c=(180+a[0])/360,m=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,x=Math.pow(2,u.z);return[Math.round(c*x*8192),Math.round(m*x*8192)]}function ot(a,u,c){return u[1]>a[1]!=c[1]>a[1]&&a[0]<(c[0]-u[0])*(a[1]-u[1])/(c[1]-u[1])+u[0]}function nr(a,u){for(var c,m,x,E,A,I,D,N=!1,j=0,X=u.length;j<X;j++)for(var ee=u[j],R=0,Ce=ee.length;R<Ce-1;R++){if((E=(c=a)[0]-(m=ee[R])[0])*(D=c[1]-(x=ee[R+1])[1])-(I=c[0]-x[0])*(A=c[1]-m[1])==0&&E*I<=0&&A*D<=0)return!1;ot(a,ee[R],ee[R+1])&&(N=!N)}return N}function jr(a,u){for(var c=0;c<u.length;c++)if(nr(a,u[c]))return!0;return!1}function Mn(a,u,c,m){var x=m[0]-c[0],E=m[1]-c[1],A=(a[0]-c[0])*E-x*(a[1]-c[1]),I=(u[0]-c[0])*E-x*(u[1]-c[1]);return A>0&&I<0||A<0&&I>0}function Vi(a,u,c){for(var m=0,x=c;m<x.length;m+=1)for(var E=x[m],A=0;A<E.length-1;++A)if((X=[(j=E[A+1])[0]-(N=E[A])[0],j[1]-N[1]])[0]*(ee=[(D=u)[0]-(I=a)[0],D[1]-I[1]])[1]-X[1]*ee[0]!=0&&Mn(I,D,N,j)&&Mn(N,j,I,D))return!0;var I,D,N,j,X,ee;return!1}function ho(a,u){for(var c=0;c<a.length;++c)if(!nr(a[c],u))return!1;for(var m=0;m<a.length-1;++m)if(Vi(a[m],a[m+1],u))return!1;return!0}function Ao(a,u){for(var c=0;c<u.length;c++)if(ho(a,u[c]))return!0;return!1}function uo(a,u,c){for(var m=[],x=0;x<a.length;x++){for(var E=[],A=0;A<a[x].length;A++){var I=Te(a[x][A],c);yn(u,I),E.push(I)}m.push(E)}return m}function Is(a,u,c){for(var m=[],x=0;x<a.length;x++){var E=uo(a[x],u,c);m.push(E)}return m}function ys(a,u,c,m){if(a[0]<c[0]||a[0]>c[2]){var x=.5*m,E=a[0]-c[0]>x?-m:c[0]-a[0]>x?m:0;E===0&&(E=a[0]-c[2]>x?-m:c[2]-a[0]>x?m:0),a[0]+=E}yn(u,a)}function Kh(a,u,c,m){for(var x=8192*Math.pow(2,m.z),E=[8192*m.x,8192*m.y],A=[],I=0,D=a;I<D.length;I+=1)for(var N=0,j=D[I];N<j.length;N+=1){var X=j[N],ee=[X.x+E[0],X.y+E[1]];ys(ee,u,c,x),A.push(ee)}return A}function Cf(a,u,c,m){for(var x,E=8192*Math.pow(2,m.z),A=[8192*m.x,8192*m.y],I=[],D=0,N=a;D<N.length;D+=1){for(var j=[],X=0,ee=N[D];X<ee.length;X+=1){var R=ee[X],Ce=[R.x+A[0],R.y+A[1]];yn(u,Ce),j.push(Ce)}I.push(j)}if(u[2]-u[0]<=E/2){(x=u)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(var Oe=0,Qe=I;Oe<Qe.length;Oe+=1)for(var He=0,xt=Qe[Oe];He<xt.length;He+=1)ys(xt[He],u,c,E)}return I}Wt.parse=function(a,u){if(a.length!==2)return u.error("Expected one argument.");var c=a[1];if(typeof c!="object"||Array.isArray(c))return u.error("Collator options argument must be an object.");var m=u.parse(c["case-sensitive"]!==void 0&&c["case-sensitive"],1,Hr);if(!m)return null;var x=u.parse(c["diacritic-sensitive"]!==void 0&&c["diacritic-sensitive"],1,Hr);if(!x)return null;var E=null;return c.locale&&!(E=u.parse(c.locale,1,Kr))?null:new Wt(m,x,E)},Wt.prototype.evaluate=function(a){return new Pa(this.caseSensitive.evaluate(a),this.diacriticSensitive.evaluate(a),this.locale?this.locale.evaluate(a):null)},Wt.prototype.eachChild=function(a){a(this.caseSensitive),a(this.diacriticSensitive),this.locale&&a(this.locale)},Wt.prototype.outputDefined=function(){return!1},Wt.prototype.serialize=function(){var a={};return a["case-sensitive"]=this.caseSensitive.serialize(),a["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(a.locale=this.locale.serialize()),["collator",a]};var jo=function(a,u){this.type=Hr,this.geojson=a,this.geometries=u};function xl(a){if(a instanceof Qi&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof jo)return!1;var u=!0;return a.eachChild(function(c){u&&!xl(c)&&(u=!1)}),u}function bl(a){if(a instanceof Qi&&a.name==="feature-state")return!1;var u=!0;return a.eachChild(function(c){u&&!bl(c)&&(u=!1)}),u}function Mu(a,u){if(a instanceof Qi&&u.indexOf(a.name)>=0)return!1;var c=!0;return a.eachChild(function(m){c&&!Mu(m,u)&&(c=!1)}),c}jo.parse=function(a,u){if(a.length!==2)return u.error("'within' expression requires exactly one argument, but found "+(a.length-1)+" instead.");if(os(a[1])){var c=a[1];if(c.type==="FeatureCollection")for(var m=0;m<c.features.length;++m){var x=c.features[m].geometry.type;if(x==="Polygon"||x==="MultiPolygon")return new jo(c,c.features[m].geometry)}else if(c.type==="Feature"){var E=c.geometry.type;if(E==="Polygon"||E==="MultiPolygon")return new jo(c,c.geometry)}else if(c.type==="Polygon"||c.type==="MultiPolygon")return new jo(c,c)}return u.error("'within' expression requires valid geojson object that contains polygon geometry type.")},jo.prototype.evaluate=function(a){if(a.geometry()!=null&&a.canonicalID()!=null){if(a.geometryType()==="Point")return function(u,c){var m=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],E=u.canonicalID();if(c.type==="Polygon"){var A=uo(c.coordinates,x,E),I=Kh(u.geometry(),m,x,E);if(!fe(m,x))return!1;for(var D=0,N=I;D<N.length;D+=1)if(!nr(N[D],A))return!1}if(c.type==="MultiPolygon"){var j=Is(c.coordinates,x,E),X=Kh(u.geometry(),m,x,E);if(!fe(m,x))return!1;for(var ee=0,R=X;ee<R.length;ee+=1)if(!jr(R[ee],j))return!1}return!0}(a,this.geometries);if(a.geometryType()==="LineString")return function(u,c){var m=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],E=u.canonicalID();if(c.type==="Polygon"){var A=uo(c.coordinates,x,E),I=Cf(u.geometry(),m,x,E);if(!fe(m,x))return!1;for(var D=0,N=I;D<N.length;D+=1)if(!ho(N[D],A))return!1}if(c.type==="MultiPolygon"){var j=Is(c.coordinates,x,E),X=Cf(u.geometry(),m,x,E);if(!fe(m,x))return!1;for(var ee=0,R=X;ee<R.length;ee+=1)if(!Ao(R[ee],j))return!1}return!0}(a,this.geometries)}return!1},jo.prototype.eachChild=function(){},jo.prototype.outputDefined=function(){return!0},jo.prototype.serialize=function(){return["within",this.geojson]};var Iu=function(a,u){this.type=u.type,this.name=a,this.boundExpression=u};Iu.parse=function(a,u){if(a.length!==2||typeof a[1]!="string")return u.error("'var' expression requires exactly one string literal argument.");var c=a[1];return u.scope.has(c)?new Iu(c,u.scope.get(c)):u.error('Unknown variable "'+c+'". Make sure "'+c+'" has been bound in an enclosing "let" expression before using it.',1)},Iu.prototype.evaluate=function(a){return this.boundExpression.evaluate(a)},Iu.prototype.eachChild=function(){},Iu.prototype.outputDefined=function(){return!1},Iu.prototype.serialize=function(){return["var",this.name]};var Qu=function(a,u,c,m,x){u===void 0&&(u=[]),m===void 0&&(m=new bn),x===void 0&&(x=[]),this.registry=a,this.path=u,this.key=u.map(function(E){return"["+E+"]"}).join(""),this.scope=m,this.errors=x,this.expectedType=c};function Qc(a,u){for(var c,m=a.length-1,x=0,E=m,A=0;x<=E;)if((c=a[A=Math.floor((x+E)/2)])<=u){if(A===m||u<a[A+1])return A;x=A+1}else{if(!(c>u))throw new ia("Input is not a number.");E=A-1}return 0}Qu.prototype.parse=function(a,u,c,m,x){return x===void 0&&(x={}),u?this.concat(u,c,m)._parse(a,x):this._parse(a,x)},Qu.prototype._parse=function(a,u){function c(N,j,X){return X==="assert"?new ha(j,[N]):X==="coerce"?new ss(j,[N]):N}if(a!==null&&typeof a!="string"&&typeof a!="boolean"&&typeof a!="number"||(a=["literal",a]),Array.isArray(a)){if(a.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var m=a[0];if(typeof m!="string")return this.error("Expression name must be a string, but found "+typeof m+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var x=this.registry[m];if(x){var E=x.parse(a,this);if(!E)return null;if(this.expectedType){var A=this.expectedType,I=E.type;if(A.kind!=="string"&&A.kind!=="number"&&A.kind!=="boolean"&&A.kind!=="object"&&A.kind!=="array"||I.kind!=="value")if(A.kind!=="color"&&A.kind!=="formatted"&&A.kind!=="resolvedImage"||I.kind!=="value"&&I.kind!=="string"){if(this.checkSubtype(A,I))return null}else E=c(E,A,u.typeAnnotation||"coerce");else E=c(E,A,u.typeAnnotation||"assert")}if(!(E instanceof Oa)&&E.type.kind!=="resolvedImage"&&function N(j){if(j instanceof Iu)return N(j.boundExpression);if(j instanceof Qi&&j.name==="error"||j instanceof Wt||j instanceof jo)return!1;var X=j instanceof ss||j instanceof ha,ee=!0;return j.eachChild(function(R){ee=X?ee&&N(R):ee&&R instanceof Oa}),!!ee&&xl(j)&&Mu(j,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(E)){var D=new Ea;try{E=new Oa(E.type,E.evaluate(D))}catch(N){return this.error(N.message),null}}return E}return this.error('Unknown expression "'+m+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(a===void 0?"'undefined' value invalid. Use null instead.":typeof a=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof a+" instead.")},Qu.prototype.concat=function(a,u,c){var m=typeof a=="number"?this.path.concat(a):this.path,x=c?this.scope.concat(c):this.scope;return new Qu(this.registry,m,u||null,x,this.errors)},Qu.prototype.error=function(a){for(var u=[],c=arguments.length-1;c-- >0;)u[c]=arguments[c+1];var m=""+this.key+u.map(function(x){return"["+x+"]"}).join("");this.errors.push(new Tr(m,a))},Qu.prototype.checkSubtype=function(a,u){var c=Ki(a,u);return c&&this.error(c),c};var Ps=function(a,u,c){this.type=a,this.input=u,this.labels=[],this.outputs=[];for(var m=0,x=c;m<x.length;m+=1){var E=x[m],A=E[1];this.labels.push(E[0]),this.outputs.push(A)}};function Ya(a,u,c){return a*(1-c)+u*c}Ps.parse=function(a,u){if(a.length-1<4)return u.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if((a.length-1)%2!=0)return u.error("Expected an even number of arguments.");var c=u.parse(a[1],1,ar);if(!c)return null;var m=[],x=null;u.expectedType&&u.expectedType.kind!=="value"&&(x=u.expectedType);for(var E=1;E<a.length;E+=2){var A=E===1?-1/0:a[E],I=a[E+1],D=E,N=E+1;if(typeof A!="number")return u.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(m.length&&m[m.length-1][0]>=A)return u.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',D);var j=u.parse(I,N,x);if(!j)return null;x=x||j.type,m.push([A,j])}return new Ps(x,c,m)},Ps.prototype.evaluate=function(a){var u=this.labels,c=this.outputs;if(u.length===1)return c[0].evaluate(a);var m=this.input.evaluate(a);if(m<=u[0])return c[0].evaluate(a);var x=u.length;return m>=u[x-1]?c[x-1].evaluate(a):c[Qc(u,m)].evaluate(a)},Ps.prototype.eachChild=function(a){a(this.input);for(var u=0,c=this.outputs;u<c.length;u+=1)a(c[u])},Ps.prototype.outputDefined=function(){return this.outputs.every(function(a){return a.outputDefined()})},Ps.prototype.serialize=function(){for(var a=["step",this.input.serialize()],u=0;u<this.labels.length;u++)u>0&&a.push(this.labels[u]),a.push(this.outputs[u].serialize());return a};var El=Object.freeze({__proto__:null,number:Ya,color:function(a,u,c){return new Ti(Ya(a.r,u.r,c),Ya(a.g,u.g,c),Ya(a.b,u.b,c),Ya(a.a,u.a,c))},array:function(a,u,c){return a.map(function(m,x){return Ya(m,u[x],c)})}}),Ju=6/29*3*(6/29),Rf=Math.PI/180,Qh=180/Math.PI;function Mf(a){return a>.008856451679035631?Math.pow(a,1/3):a/Ju+4/29}function ph(a){return a>6/29?a*a*a:Ju*(a-4/29)}function dh(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function vh(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function Jh(a){var u=vh(a.r),c=vh(a.g),m=vh(a.b),x=Mf((.4124564*u+.3575761*c+.1804375*m)/.95047),E=Mf((.2126729*u+.7151522*c+.072175*m)/1);return{l:116*E-16,a:500*(x-E),b:200*(E-Mf((.0193339*u+.119192*c+.9503041*m)/1.08883)),alpha:a.a}}function ep(a){var u=(a.l+16)/116,c=isNaN(a.a)?u:u+a.a/500,m=isNaN(a.b)?u:u-a.b/200;return u=1*ph(u),c=.95047*ph(c),m=1.08883*ph(m),new Ti(dh(3.2404542*c-1.5371385*u-.4985314*m),dh(-.969266*c+1.8760108*u+.041556*m),dh(.0556434*c-.2040259*u+1.0572252*m),a.alpha)}function Zp(a,u,c){var m=u-a;return a+c*(m>180||m<-180?m-360*Math.round(m/360):m)}var Jc={forward:Jh,reverse:ep,interpolate:function(a,u,c){return{l:Ya(a.l,u.l,c),a:Ya(a.a,u.a,c),b:Ya(a.b,u.b,c),alpha:Ya(a.alpha,u.alpha,c)}}},Pu={forward:function(a){var u=Jh(a),c=u.l,m=u.a,x=u.b,E=Math.atan2(x,m)*Qh;return{h:E<0?E+360:E,c:Math.sqrt(m*m+x*x),l:c,alpha:a.a}},reverse:function(a){var u=a.h*Rf,c=a.c;return ep({l:a.l,a:Math.cos(u)*c,b:Math.sin(u)*c,alpha:a.alpha})},interpolate:function(a,u,c){return{h:Zp(a.h,u.h,c),c:Ya(a.c,u.c,c),l:Ya(a.l,u.l,c),alpha:Ya(a.alpha,u.alpha,c)}}},tp=Object.freeze({__proto__:null,lab:Jc,hcl:Pu}),Ho=function(a,u,c,m,x){this.type=a,this.operator=u,this.interpolation=c,this.input=m,this.labels=[],this.outputs=[];for(var E=0,A=x;E<A.length;E+=1){var I=A[E],D=I[1];this.labels.push(I[0]),this.outputs.push(D)}};function Yl(a,u,c,m){var x=m-c,E=a-c;return x===0?0:u===1?E/x:(Math.pow(u,E)-1)/(Math.pow(u,x)-1)}Ho.interpolationFactor=function(a,u,c,m){var x=0;if(a.name==="exponential")x=Yl(u,a.base,c,m);else if(a.name==="linear")x=Yl(u,1,c,m);else if(a.name==="cubic-bezier"){var E=a.controlPoints;x=new U(E[0],E[1],E[2],E[3]).solve(Yl(u,1,c,m))}return x},Ho.parse=function(a,u){var c=a[0],m=a[1],x=a[2],E=a.slice(3);if(!Array.isArray(m)||m.length===0)return u.error("Expected an interpolation type expression.",1);if(m[0]==="linear")m={name:"linear"};else if(m[0]==="exponential"){var A=m[1];if(typeof A!="number")return u.error("Exponential interpolation requires a numeric base.",1,1);m={name:"exponential",base:A}}else{if(m[0]!=="cubic-bezier")return u.error("Unknown interpolation type "+String(m[0]),1,0);var I=m.slice(1);if(I.length!==4||I.some(function(Qe){return typeof Qe!="number"||Qe<0||Qe>1}))return u.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);m={name:"cubic-bezier",controlPoints:I}}if(a.length-1<4)return u.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if((a.length-1)%2!=0)return u.error("Expected an even number of arguments.");if(!(x=u.parse(x,2,ar)))return null;var D=[],N=null;c==="interpolate-hcl"||c==="interpolate-lab"?N=$r:u.expectedType&&u.expectedType.kind!=="value"&&(N=u.expectedType);for(var j=0;j<E.length;j+=2){var X=E[j],ee=E[j+1],R=j+3,Ce=j+4;if(typeof X!="number")return u.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',R);if(D.length&&D[D.length-1][0]>=X)return u.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',R);var Oe=u.parse(ee,Ce,N);if(!Oe)return null;N=N||Oe.type,D.push([X,Oe])}return N.kind==="number"||N.kind==="color"||N.kind==="array"&&N.itemType.kind==="number"&&typeof N.N=="number"?new Ho(N,c,m,x,D):u.error("Type "+Si(N)+" is not interpolatable.")},Ho.prototype.evaluate=function(a){var u=this.labels,c=this.outputs;if(u.length===1)return c[0].evaluate(a);var m=this.input.evaluate(a);if(m<=u[0])return c[0].evaluate(a);var x=u.length;if(m>=u[x-1])return c[x-1].evaluate(a);var E=Qc(u,m),A=Ho.interpolationFactor(this.interpolation,m,u[E],u[E+1]),I=c[E].evaluate(a),D=c[E+1].evaluate(a);return this.operator==="interpolate"?El[this.type.kind.toLowerCase()](I,D,A):this.operator==="interpolate-hcl"?Pu.reverse(Pu.interpolate(Pu.forward(I),Pu.forward(D),A)):Jc.reverse(Jc.interpolate(Jc.forward(I),Jc.forward(D),A))},Ho.prototype.eachChild=function(a){a(this.input);for(var u=0,c=this.outputs;u<c.length;u+=1)a(c[u])},Ho.prototype.outputDefined=function(){return this.outputs.every(function(a){return a.outputDefined()})},Ho.prototype.serialize=function(){var a;a=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var u=[this.operator,a,this.input.serialize()],c=0;c<this.labels.length;c++)u.push(this.labels[c],this.outputs[c].serialize());return u};var Sl=function(a,u){this.type=a,this.args=u};Sl.parse=function(a,u){if(a.length<2)return u.error("Expectected at least one argument.");var c=null,m=u.expectedType;m&&m.kind!=="value"&&(c=m);for(var x=[],E=0,A=a.slice(1);E<A.length;E+=1){var I=u.parse(A[E],1+x.length,c,void 0,{typeAnnotation:"omit"});if(!I)return null;c=c||I.type,x.push(I)}var D=m&&x.some(function(N){return Ki(m,N.type)});return new Sl(D?Qr:c,x)},Sl.prototype.evaluate=function(a){for(var u,c=null,m=0,x=0,E=this.args;x<E.length&&(m++,(c=E[x].evaluate(a))&&c instanceof Aa&&!c.available&&(u||(u=c.name),c=null,m===this.args.length&&(c=u)),c===null);x+=1);return c},Sl.prototype.eachChild=function(a){this.args.forEach(a)},Sl.prototype.outputDefined=function(){return this.args.every(function(a){return a.outputDefined()})},Sl.prototype.serialize=function(){var a=["coalesce"];return this.eachChild(function(u){a.push(u.serialize())}),a};var Xs=function(a,u){this.type=u.type,this.bindings=[].concat(a),this.result=u};Xs.prototype.evaluate=function(a){return this.result.evaluate(a)},Xs.prototype.eachChild=function(a){for(var u=0,c=this.bindings;u<c.length;u+=1)a(c[u][1]);a(this.result)},Xs.parse=function(a,u){if(a.length<4)return u.error("Expected at least 3 arguments, but found "+(a.length-1)+" instead.");for(var c=[],m=1;m<a.length-1;m+=2){var x=a[m];if(typeof x!="string")return u.error("Expected string, but found "+typeof x+" instead.",m);if(/[^a-zA-Z0-9_]/.test(x))return u.error("Variable names must contain only alphanumeric characters or '_'.",m);var E=u.parse(a[m+1],m+1);if(!E)return null;c.push([x,E])}var A=u.parse(a[a.length-1],a.length-1,u.expectedType,c);return A?new Xs(c,A):null},Xs.prototype.outputDefined=function(){return this.result.outputDefined()},Xs.prototype.serialize=function(){for(var a=["let"],u=0,c=this.bindings;u<c.length;u+=1){var m=c[u];a.push(m[0],m[1].serialize())}return a.push(this.result.serialize()),a};var Al=function(a,u,c){this.type=a,this.index=u,this.input=c};Al.parse=function(a,u){if(a.length!==3)return u.error("Expected 2 arguments, but found "+(a.length-1)+" instead.");var c=u.parse(a[1],1,ar),m=u.parse(a[2],2,Li(u.expectedType||Qr));return c&&m?new Al(m.type.itemType,c,m):null},Al.prototype.evaluate=function(a){var u=this.index.evaluate(a),c=this.input.evaluate(a);if(u<0)throw new ia("Array index out of bounds: "+u+" < 0.");if(u>=c.length)throw new ia("Array index out of bounds: "+u+" > "+(c.length-1)+".");if(u!==Math.floor(u))throw new ia("Array index must be an integer, but found "+u+" instead.");return c[u]},Al.prototype.eachChild=function(a){a(this.index),a(this.input)},Al.prototype.outputDefined=function(){return!1},Al.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var ii=function(a,u){this.type=Hr,this.needle=a,this.haystack=u};ii.parse=function(a,u){if(a.length!==3)return u.error("Expected 2 arguments, but found "+(a.length-1)+" instead.");var c=u.parse(a[1],1,Qr),m=u.parse(a[2],2,Qr);return c&&m?Ia(c.type,[Hr,Kr,ar,nn,Qr])?new ii(c,m):u.error("Expected first argument to be of type boolean, string, number or null, but found "+Si(c.type)+" instead"):null},ii.prototype.evaluate=function(a){var u=this.needle.evaluate(a),c=this.haystack.evaluate(a);if(!c)return!1;if(!Ai(u,["boolean","string","number","null"]))throw new ia("Expected first argument to be of type boolean, string, number or null, but found "+Si(Ta(u))+" instead.");if(!Ai(c,["string","array"]))throw new ia("Expected second argument to be of type array or string, but found "+Si(Ta(c))+" instead.");return c.indexOf(u)>=0},ii.prototype.eachChild=function(a){a(this.needle),a(this.haystack)},ii.prototype.outputDefined=function(){return!0},ii.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var el=function(a,u,c){this.type=ar,this.needle=a,this.haystack=u,this.fromIndex=c};el.parse=function(a,u){if(a.length<=2||a.length>=5)return u.error("Expected 3 or 4 arguments, but found "+(a.length-1)+" instead.");var c=u.parse(a[1],1,Qr),m=u.parse(a[2],2,Qr);if(!c||!m)return null;if(!Ia(c.type,[Hr,Kr,ar,nn,Qr]))return u.error("Expected first argument to be of type boolean, string, number or null, but found "+Si(c.type)+" instead");if(a.length===4){var x=u.parse(a[3],3,ar);return x?new el(c,m,x):null}return new el(c,m)},el.prototype.evaluate=function(a){var u=this.needle.evaluate(a),c=this.haystack.evaluate(a);if(!Ai(u,["boolean","string","number","null"]))throw new ia("Expected first argument to be of type boolean, string, number or null, but found "+Si(Ta(u))+" instead.");if(!Ai(c,["string","array"]))throw new ia("Expected second argument to be of type array or string, but found "+Si(Ta(c))+" instead.");if(this.fromIndex){var m=this.fromIndex.evaluate(a);return c.indexOf(u,m)}return c.indexOf(u)},el.prototype.eachChild=function(a){a(this.needle),a(this.haystack),this.fromIndex&&a(this.fromIndex)},el.prototype.outputDefined=function(){return!1},el.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var a=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),a]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var Os=function(a,u,c,m,x,E){this.inputType=a,this.type=u,this.input=c,this.cases=m,this.outputs=x,this.otherwise=E};Os.parse=function(a,u){if(a.length<5)return u.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if(a.length%2!=1)return u.error("Expected an even number of arguments.");var c,m;u.expectedType&&u.expectedType.kind!=="value"&&(m=u.expectedType);for(var x={},E=[],A=2;A<a.length-1;A+=2){var I=a[A],D=a[A+1];Array.isArray(I)||(I=[I]);var N=u.concat(A);if(I.length===0)return N.error("Expected at least one branch label.");for(var j=0,X=I;j<X.length;j+=1){var ee=X[j];if(typeof ee!="number"&&typeof ee!="string")return N.error("Branch labels must be numbers or strings.");if(typeof ee=="number"&&Math.abs(ee)>Number.MAX_SAFE_INTEGER)return N.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof ee=="number"&&Math.floor(ee)!==ee)return N.error("Numeric branch labels must be integer values.");if(c){if(N.checkSubtype(c,Ta(ee)))return null}else c=Ta(ee);if(x[String(ee)]!==void 0)return N.error("Branch labels must be unique.");x[String(ee)]=E.length}var R=u.parse(D,A,m);if(!R)return null;m=m||R.type,E.push(R)}var Ce=u.parse(a[1],1,Qr);if(!Ce)return null;var Oe=u.parse(a[a.length-1],a.length-1,m);return Oe?Ce.type.kind!=="value"&&u.concat(1).checkSubtype(c,Ce.type)?null:new Os(c,m,Ce,x,E,Oe):null},Os.prototype.evaluate=function(a){var u=this.input.evaluate(a);return(Ta(u)===this.inputType&&this.outputs[this.cases[u]]||this.otherwise).evaluate(a)},Os.prototype.eachChild=function(a){a(this.input),this.outputs.forEach(a),a(this.otherwise)},Os.prototype.outputDefined=function(){return this.outputs.every(function(a){return a.outputDefined()})&&this.otherwise.outputDefined()},Os.prototype.serialize=function(){for(var a=this,u=["match",this.input.serialize()],c=[],m={},x=0,E=Object.keys(this.cases).sort();x<E.length;x+=1){var A=E[x];(X=m[this.cases[A]])===void 0?(m[this.cases[A]]=c.length,c.push([this.cases[A],[A]])):c[X][1].push(A)}for(var I=function(R){return a.inputType.kind==="number"?Number(R):R},D=0,N=c;D<N.length;D+=1){var j=N[D],X=j[0],ee=j[1];u.push(ee.length===1?I(ee[0]):ee.map(I)),u.push(this.outputs[outputIndex$1].serialize())}return u.push(this.otherwise.serialize()),u};var Ou=function(a,u,c){this.type=a,this.branches=u,this.otherwise=c};Ou.parse=function(a,u){if(a.length<4)return u.error("Expected at least 3 arguments, but found only "+(a.length-1)+".");if(a.length%2!=0)return u.error("Expected an odd number of arguments.");var c;u.expectedType&&u.expectedType.kind!=="value"&&(c=u.expectedType);for(var m=[],x=1;x<a.length-1;x+=2){var E=u.parse(a[x],x,Hr);if(!E)return null;var A=u.parse(a[x+1],x+1,c);if(!A)return null;m.push([E,A]),c=c||A.type}var I=u.parse(a[a.length-1],a.length-1,c);return I?new Ou(c,m,I):null},Ou.prototype.evaluate=function(a){for(var u=0,c=this.branches;u<c.length;u+=1){var m=c[u],x=m[1];if(m[0].evaluate(a))return x.evaluate(a)}return this.otherwise.evaluate(a)},Ou.prototype.eachChild=function(a){for(var u=0,c=this.branches;u<c.length;u+=1){var m=c[u],x=m[1];a(m[0]),a(x)}a(this.otherwise)},Ou.prototype.outputDefined=function(){return this.branches.every(function(a){return a[1].outputDefined()})&&this.otherwise.outputDefined()},Ou.prototype.serialize=function(){var a=["case"];return this.eachChild(function(u){a.push(u.serialize())}),a};var tl=function(a,u,c,m){this.type=a,this.input=u,this.beginIndex=c,this.endIndex=m};function rp(a,u){return a==="=="||a==="!="?u.kind==="boolean"||u.kind==="string"||u.kind==="number"||u.kind==="null"||u.kind==="value":u.kind==="string"||u.kind==="number"||u.kind==="value"}function Ji(a,u,c,m){return m.compare(u,c)===0}function Ci(a,u,c){var m=a!=="=="&&a!=="!=";return function(){function x(E,A,I){this.type=Hr,this.lhs=E,this.rhs=A,this.collator=I,this.hasUntypedArgument=E.type.kind==="value"||A.type.kind==="value"}return x.parse=function(E,A){if(E.length!==3&&E.length!==4)return A.error("Expected two or three arguments.");var I=E[0],D=A.parse(E[1],1,Qr);if(!D)return null;if(!rp(I,D.type))return A.concat(1).error('"'+I+`" comparisons are not supported for type '`+Si(D.type)+"'.");var N=A.parse(E[2],2,Qr);if(!N)return null;if(!rp(I,N.type))return A.concat(2).error('"'+I+`" comparisons are not supported for type '`+Si(N.type)+"'.");if(D.type.kind!==N.type.kind&&D.type.kind!=="value"&&N.type.kind!=="value")return A.error("Cannot compare types '"+Si(D.type)+"' and '"+Si(N.type)+"'.");m&&(D.type.kind==="value"&&N.type.kind!=="value"?D=new ha(N.type,[D]):D.type.kind!=="value"&&N.type.kind==="value"&&(N=new ha(D.type,[N])));var j=null;if(E.length===4){if(D.type.kind!=="string"&&N.type.kind!=="string"&&D.type.kind!=="value"&&N.type.kind!=="value")return A.error("Cannot use collator to compare non-string types.");if(!(j=A.parse(E[3],3,vi)))return null}return new x(D,N,j)},x.prototype.evaluate=function(E){var A=this.lhs.evaluate(E),I=this.rhs.evaluate(E);if(m&&this.hasUntypedArgument){var D=Ta(A),N=Ta(I);if(D.kind!==N.kind||D.kind!=="string"&&D.kind!=="number")throw new ia('Expected arguments for "'+a+'" to be (string, string) or (number, number), but found ('+D.kind+", "+N.kind+") instead.")}if(this.collator&&!m&&this.hasUntypedArgument){var j=Ta(A),X=Ta(I);if(j.kind!=="string"||X.kind!=="string")return u(E,A,I)}return this.collator?c(E,A,I,this.collator.evaluate(E)):u(E,A,I)},x.prototype.eachChild=function(E){E(this.lhs),E(this.rhs),this.collator&&E(this.collator)},x.prototype.outputDefined=function(){return!0},x.prototype.serialize=function(){var E=[a];return this.eachChild(function(A){E.push(A.serialize())}),E},x}()}tl.parse=function(a,u){if(a.length<=2||a.length>=5)return u.error("Expected 3 or 4 arguments, but found "+(a.length-1)+" instead.");var c=u.parse(a[1],1,Qr),m=u.parse(a[2],2,ar);if(!c||!m)return null;if(!Ia(c.type,[Li(Qr),Kr,Qr]))return u.error("Expected first argument to be of type array or string, but found "+Si(c.type)+" instead");if(a.length===4){var x=u.parse(a[3],3,ar);return x?new tl(c.type,c,m,x):null}return new tl(c.type,c,m)},tl.prototype.evaluate=function(a){var u=this.input.evaluate(a),c=this.beginIndex.evaluate(a);if(!Ai(u,["string","array"]))throw new ia("Expected first argument to be of type array or string, but found "+Si(Ta(u))+" instead.");if(this.endIndex){var m=this.endIndex.evaluate(a);return u.slice(c,m)}return u.slice(c)},tl.prototype.eachChild=function(a){a(this.input),a(this.beginIndex),this.endIndex&&a(this.endIndex)},tl.prototype.outputDefined=function(){return!1},tl.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var a=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),a]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var fu=Ci("==",function(a,u,c){return u===c},Ji),Du=Ci("!=",function(a,u,c){return u!==c},function(a,u,c,m){return!Ji(0,u,c,m)}),mh=Ci("<",function(a,u,c){return u<c},function(a,u,c,m){return m.compare(u,c)<0}),ja=Ci(">",function(a,u,c){return u>c},function(a,u,c,m){return m.compare(u,c)>0}),ef=Ci("<=",function(a,u,c){return u<=c},function(a,u,c,m){return m.compare(u,c)<=0}),Vp=Ci(">=",function(a,u,c){return u>=c},function(a,u,c,m){return m.compare(u,c)>=0}),xs=function(a,u,c,m,x){this.type=Kr,this.number=a,this.locale=u,this.currency=c,this.minFractionDigits=m,this.maxFractionDigits=x};xs.parse=function(a,u){if(a.length!==3)return u.error("Expected two arguments.");var c=u.parse(a[1],1,ar);if(!c)return null;var m=a[2];if(typeof m!="object"||Array.isArray(m))return u.error("NumberFormat options argument must be an object.");var x=null;if(m.locale&&!(x=u.parse(m.locale,1,Kr)))return null;var E=null;if(m.currency&&!(E=u.parse(m.currency,1,Kr)))return null;var A=null;if(m["min-fraction-digits"]&&!(A=u.parse(m["min-fraction-digits"],1,ar)))return null;var I=null;return m["max-fraction-digits"]&&!(I=u.parse(m["max-fraction-digits"],1,ar))?null:new xs(c,x,E,A,I)},xs.prototype.evaluate=function(a){return new Intl.NumberFormat(this.locale?this.locale.evaluate(a):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(a):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(a):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(a):void 0}).format(this.number.evaluate(a))},xs.prototype.eachChild=function(a){a(this.number),this.locale&&a(this.locale),this.currency&&a(this.currency),this.minFractionDigits&&a(this.minFractionDigits),this.maxFractionDigits&&a(this.maxFractionDigits)},xs.prototype.outputDefined=function(){return!1},xs.prototype.serialize=function(){var a={};return this.locale&&(a.locale=this.locale.serialize()),this.currency&&(a.currency=this.currency.serialize()),this.minFractionDigits&&(a["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(a["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),a]};var ku=function(a){this.type=ar,this.input=a};ku.parse=function(a,u){if(a.length!==2)return u.error("Expected 1 argument, but found "+(a.length-1)+" instead.");var c=u.parse(a[1],1);return c?c.type.kind!=="array"&&c.type.kind!=="string"&&c.type.kind!=="value"?u.error("Expected argument of type string or array, but found "+Si(c.type)+" instead."):new ku(c):null},ku.prototype.evaluate=function(a){var u=this.input.evaluate(a);if(typeof u=="string"||Array.isArray(u))return u.length;throw new ia("Expected value to be of type string or array, but found "+Si(Ta(u))+" instead.")},ku.prototype.eachChild=function(a){a(this.input)},ku.prototype.outputDefined=function(){return!1},ku.prototype.serialize=function(){var a=["length"];return this.eachChild(function(u){a.push(u.serialize())}),a};var Fu={"==":fu,"!=":Du,">":ja,"<":mh,">=":Vp,"<=":ef,array:ha,at:Al,boolean:ha,case:Ou,coalesce:Sl,collator:Wt,format:$o,image:Vo,in:ii,"index-of":el,interpolate:Ho,"interpolate-hcl":Ho,"interpolate-lab":Ho,length:ku,let:Xs,literal:Oa,match:Os,number:ha,"number-format":xs,object:ha,slice:tl,step:Ps,string:ha,"to-boolean":ss,"to-color":ss,"to-number":ss,"to-string":ss,var:Iu,within:jo};function ql(a,u){var c=u[0],m=u[1],x=u[2],E=u[3];c=c.evaluate(a),m=m.evaluate(a),x=x.evaluate(a);var A=E?E.evaluate(a):1,I=$l(c,m,x,A);if(I)throw new ia(I);return new Ti(c/255*A,m/255*A,x/255*A,A)}function If(a,u){return a in u}function wa(a,u){var c=u[a];return c===void 0?null:c}function Qs(a){return{type:a}}function Rc(a){return{result:"success",value:a}}function Kl(a){return{result:"error",value:a}}function rl(a){return a["property-type"]==="data-driven"||a["property-type"]==="cross-faded-data-driven"}function gh(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function Ql(a){return!!a.expression&&a.expression.interpolated}function ca(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":a===null?"null":typeof a}function tf(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)}function np(a){return a}function Tl(a,u,c){return a!==void 0?a:u!==void 0?u:c!==void 0?c:void 0}function Jl(a,u,c,m,x){return Tl(typeof c===x?m[c]:void 0,a.default,u.default)}function _h(a,u,c){if(ca(c)!=="number")return Tl(a.default,u.default);var m=a.stops.length;if(m===1||c<=a.stops[0][0])return a.stops[0][1];if(c>=a.stops[m-1][0])return a.stops[m-1][1];var x=Qc(a.stops.map(function(E){return E[0]}),c);return a.stops[x][1]}function Pf(a,u,c){var m=a.base!==void 0?a.base:1;if(ca(c)!=="number")return Tl(a.default,u.default);var x=a.stops.length;if(x===1||c<=a.stops[0][0])return a.stops[0][1];if(c>=a.stops[x-1][0])return a.stops[x-1][1];var E=Qc(a.stops.map(function(X){return X[0]}),c),A=function(X,ee,R,Ce){var Oe=Ce-R,Qe=X-R;return Oe===0?0:ee===1?Qe/Oe:(Math.pow(ee,Qe)-1)/(Math.pow(ee,Oe)-1)}(c,m,a.stops[E][0],a.stops[E+1][0]),I=a.stops[E][1],D=a.stops[E+1][1],N=El[u.type]||np;if(a.colorSpace&&a.colorSpace!=="rgb"){var j=tp[a.colorSpace];N=function(X,ee){return j.reverse(j.interpolate(j.forward(X),j.forward(ee),A))}}return typeof I.evaluate=="function"?{evaluate:function(){for(var X=[],ee=arguments.length;ee--;)X[ee]=arguments[ee];var R=I.evaluate.apply(void 0,X),Ce=D.evaluate.apply(void 0,X);if(R!==void 0&&Ce!==void 0)return N(R,Ce,A)}}:N(I,D,A)}function wl(a,u,c){return u.type==="color"?c=Ti.parse(c):u.type==="formatted"?c=ma.fromString(c.toString()):u.type==="resolvedImage"?c=Aa.fromString(c.toString()):ca(c)===u.type||u.type==="enum"&&u.values[c]||(c=void 0),Tl(c,a.default,u.default)}Qi.register(Fu,{error:[{kind:"error"},[Kr],function(a,u){throw new ia(u[0].evaluate(a))}],typeof:[Kr,[Qr],function(a,u){return Si(Ta(u[0].evaluate(a)))}],"to-rgba":[Li(ar,4),[$r],function(a,u){return u[0].evaluate(a).toArray()}],rgb:[$r,[ar,ar,ar],ql],rgba:[$r,[ar,ar,ar,ar],ql],has:{type:Hr,overloads:[[[Kr],function(a,u){return If(u[0].evaluate(a),a.properties())}],[[Kr,hi],function(a,u){var c=u[1];return If(u[0].evaluate(a),c.evaluate(a))}]]},get:{type:Qr,overloads:[[[Kr],function(a,u){return wa(u[0].evaluate(a),a.properties())}],[[Kr,hi],function(a,u){var c=u[1];return wa(u[0].evaluate(a),c.evaluate(a))}]]},"feature-state":[Qr,[Kr],function(a,u){return wa(u[0].evaluate(a),a.featureState||{})}],properties:[hi,[],function(a){return a.properties()}],"geometry-type":[Kr,[],function(a){return a.geometryType()}],id:[Qr,[],function(a){return a.id()}],zoom:[ar,[],function(a){return a.globals.zoom}],"heatmap-density":[ar,[],function(a){return a.globals.heatmapDensity||0}],"line-progress":[ar,[],function(a){return a.globals.lineProgress||0}],accumulated:[Qr,[],function(a){return a.globals.accumulated===void 0?null:a.globals.accumulated}],"+":[ar,Qs(ar),function(a,u){for(var c=0,m=0,x=u;m<x.length;m+=1)c+=x[m].evaluate(a);return c}],"*":[ar,Qs(ar),function(a,u){for(var c=1,m=0,x=u;m<x.length;m+=1)c*=x[m].evaluate(a);return c}],"-":{type:ar,overloads:[[[ar,ar],function(a,u){var c=u[1];return u[0].evaluate(a)-c.evaluate(a)}],[[ar],function(a,u){return-u[0].evaluate(a)}]]},"/":[ar,[ar,ar],function(a,u){var c=u[1];return u[0].evaluate(a)/c.evaluate(a)}],"%":[ar,[ar,ar],function(a,u){var c=u[1];return u[0].evaluate(a)%c.evaluate(a)}],ln2:[ar,[],function(){return Math.LN2}],pi:[ar,[],function(){return Math.PI}],e:[ar,[],function(){return Math.E}],"^":[ar,[ar,ar],function(a,u){var c=u[1];return Math.pow(u[0].evaluate(a),c.evaluate(a))}],sqrt:[ar,[ar],function(a,u){return Math.sqrt(u[0].evaluate(a))}],log10:[ar,[ar],function(a,u){return Math.log(u[0].evaluate(a))/Math.LN10}],ln:[ar,[ar],function(a,u){return Math.log(u[0].evaluate(a))}],log2:[ar,[ar],function(a,u){return Math.log(u[0].evaluate(a))/Math.LN2}],sin:[ar,[ar],function(a,u){return Math.sin(u[0].evaluate(a))}],cos:[ar,[ar],function(a,u){return Math.cos(u[0].evaluate(a))}],tan:[ar,[ar],function(a,u){return Math.tan(u[0].evaluate(a))}],asin:[ar,[ar],function(a,u){return Math.asin(u[0].evaluate(a))}],acos:[ar,[ar],function(a,u){return Math.acos(u[0].evaluate(a))}],atan:[ar,[ar],function(a,u){return Math.atan(u[0].evaluate(a))}],min:[ar,Qs(ar),function(a,u){return Math.min.apply(Math,u.map(function(c){return c.evaluate(a)}))}],max:[ar,Qs(ar),function(a,u){return Math.max.apply(Math,u.map(function(c){return c.evaluate(a)}))}],abs:[ar,[ar],function(a,u){return Math.abs(u[0].evaluate(a))}],round:[ar,[ar],function(a,u){var c=u[0].evaluate(a);return c<0?-Math.round(-c):Math.round(c)}],floor:[ar,[ar],function(a,u){return Math.floor(u[0].evaluate(a))}],ceil:[ar,[ar],function(a,u){return Math.ceil(u[0].evaluate(a))}],"filter-==":[Hr,[Kr,Qr],function(a,u){var c=u[0],m=u[1];return a.properties()[c.value]===m.value}],"filter-id-==":[Hr,[Qr],function(a,u){var c=u[0];return a.id()===c.value}],"filter-type-==":[Hr,[Kr],function(a,u){var c=u[0];return a.geometryType()===c.value}],"filter-<":[Hr,[Kr,Qr],function(a,u){var c=u[0],m=u[1],x=a.properties()[c.value],E=m.value;return typeof x==typeof E&&x<E}],"filter-id-<":[Hr,[Qr],function(a,u){var c=u[0],m=a.id(),x=c.value;return typeof m==typeof x&&m<x}],"filter->":[Hr,[Kr,Qr],function(a,u){var c=u[0],m=u[1],x=a.properties()[c.value],E=m.value;return typeof x==typeof E&&x>E}],"filter-id->":[Hr,[Qr],function(a,u){var c=u[0],m=a.id(),x=c.value;return typeof m==typeof x&&m>x}],"filter-<=":[Hr,[Kr,Qr],function(a,u){var c=u[0],m=u[1],x=a.properties()[c.value],E=m.value;return typeof x==typeof E&&x<=E}],"filter-id-<=":[Hr,[Qr],function(a,u){var c=u[0],m=a.id(),x=c.value;return typeof m==typeof x&&m<=x}],"filter->=":[Hr,[Kr,Qr],function(a,u){var c=u[0],m=u[1],x=a.properties()[c.value],E=m.value;return typeof x==typeof E&&x>=E}],"filter-id->=":[Hr,[Qr],function(a,u){var c=u[0],m=a.id(),x=c.value;return typeof m==typeof x&&m>=x}],"filter-has":[Hr,[Qr],function(a,u){return u[0].value in a.properties()}],"filter-has-id":[Hr,[],function(a){return a.id()!==null&&a.id()!==void 0}],"filter-type-in":[Hr,[Li(Kr)],function(a,u){return u[0].value.indexOf(a.geometryType())>=0}],"filter-id-in":[Hr,[Li(Qr)],function(a,u){return u[0].value.indexOf(a.id())>=0}],"filter-in-small":[Hr,[Kr,Li(Qr)],function(a,u){var c=u[0];return u[1].value.indexOf(a.properties()[c.value])>=0}],"filter-in-large":[Hr,[Kr,Li(Qr)],function(a,u){var c=u[0],m=u[1];return function(x,E,A,I){for(;A<=I;){var D=A+I>>1;if(E[D]===x)return!0;E[D]>x?I=D-1:A=D+1}return!1}(a.properties()[c.value],m.value,0,m.value.length-1)}],all:{type:Hr,overloads:[[[Hr,Hr],function(a,u){var c=u[1];return u[0].evaluate(a)&&c.evaluate(a)}],[Qs(Hr),function(a,u){for(var c=0,m=u;c<m.length;c+=1)if(!m[c].evaluate(a))return!1;return!0}]]},any:{type:Hr,overloads:[[[Hr,Hr],function(a,u){var c=u[1];return u[0].evaluate(a)||c.evaluate(a)}],[Qs(Hr),function(a,u){for(var c=0,m=u;c<m.length;c+=1)if(m[c].evaluate(a))return!0;return!1}]]},"!":[Hr,[Hr],function(a,u){return!u[0].evaluate(a)}],"is-supported-script":[Hr,[Kr],function(a,u){var c=a.globals&&a.globals.isSupportedScript;return!c||c(u[0].evaluate(a))}],upcase:[Kr,[Kr],function(a,u){return u[0].evaluate(a).toUpperCase()}],downcase:[Kr,[Kr],function(a,u){return u[0].evaluate(a).toLowerCase()}],concat:[Kr,Qs(Qr),function(a,u){return u.map(function(c){return fi(c.evaluate(a))}).join("")}],"resolved-locale":[Kr,[vi],function(a,u){return u[0].evaluate(a).resolvedLocale()}]});var hu=function(a,u){this.expression=a,this._warningHistory={},this._evaluator=new Ea,this._defaultValue=u?function(c){return c.type==="color"&&tf(c.default)?new Ti(0,0,0,0):c.type==="color"?Ti.parse(c.default)||null:c.default===void 0?null:c.default}(u):null,this._enumValues=u&&u.type==="enum"?u.values:null};function Mc(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in Fu}function rf(a,u){var c=new Qu(Fu,[],u?function(x){var E={color:$r,string:Kr,number:ar,enum:Kr,boolean:Hr,formatted:Yi,resolvedImage:ci};return x.type==="array"?Li(E[x.value]||Qr,x.length):E[x.type]}(u):void 0),m=c.parse(a,void 0,void 0,void 0,u&&u.type==="string"?{typeAnnotation:"coerce"}:void 0);return m?Rc(new hu(m,u)):Kl(c.errors)}hu.prototype.evaluateWithoutErrorHandling=function(a,u,c,m,x,E){return this._evaluator.globals=a,this._evaluator.feature=u,this._evaluator.featureState=c,this._evaluator.canonical=m,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=E,this.expression.evaluate(this._evaluator)},hu.prototype.evaluate=function(a,u,c,m,x,E){this._evaluator.globals=a,this._evaluator.feature=u||null,this._evaluator.featureState=c||null,this._evaluator.canonical=m,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=E||null;try{var A=this.expression.evaluate(this._evaluator);if(A==null||typeof A=="number"&&A!=A)return this._defaultValue;if(this._enumValues&&!(A in this._enumValues))throw new ia("Expected value to be one of "+Object.keys(this._enumValues).map(function(I){return JSON.stringify(I)}).join(", ")+", but found "+JSON.stringify(A)+" instead.");return A}catch(I){return this._warningHistory[I.message]||(this._warningHistory[I.message]=!0,typeof console!="undefined"&&console.warn(I.message)),this._defaultValue}};var ec=function(a,u){this.kind=a,this._styleExpression=u,this.isStateDependent=a!=="constant"&&!bl(u.expression)};ec.prototype.evaluateWithoutErrorHandling=function(a,u,c,m,x,E){return this._styleExpression.evaluateWithoutErrorHandling(a,u,c,m,x,E)},ec.prototype.evaluate=function(a,u,c,m,x,E){return this._styleExpression.evaluate(a,u,c,m,x,E)};var tc=function(a,u,c,m){this.kind=a,this.zoomStops=c,this._styleExpression=u,this.isStateDependent=a!=="camera"&&!bl(u.expression),this.interpolationType=m};function ip(a,u){if((a=rf(a,u)).result==="error")return a;var c=a.value.expression,m=xl(c);if(!m&&!rl(u))return Kl([new Tr("","data expressions not supported")]);var x=Mu(c,["zoom"]);if(!x&&!gh(u))return Kl([new Tr("","zoom expressions not supported")]);var E=function A(I){var D=null;if(I instanceof Xs)D=A(I.result);else if(I instanceof Sl)for(var N=0,j=I.args;N<j.length&&!(D=A(j[N]));N+=1);else(I instanceof Ps||I instanceof Ho)&&I.input instanceof Qi&&I.input.name==="zoom"&&(D=I);return D instanceof Tr||I.eachChild(function(X){var ee=A(X);ee instanceof Tr?D=ee:!D&&ee?D=new Tr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):D&&ee&&D!==ee&&(D=new Tr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),D}(c);return E||x?E instanceof Tr?Kl([E]):E instanceof Ho&&!Ql(u)?Kl([new Tr("",'"interpolate" expressions cannot be used with this property')]):Rc(E?new tc(m?"camera":"composite",a.value,E.labels,E instanceof Ho?E.interpolation:void 0):new ec(m?"constant":"source",a.value)):Kl([new Tr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}tc.prototype.evaluateWithoutErrorHandling=function(a,u,c,m,x,E){return this._styleExpression.evaluateWithoutErrorHandling(a,u,c,m,x,E)},tc.prototype.evaluate=function(a,u,c,m,x,E){return this._styleExpression.evaluate(a,u,c,m,x,E)},tc.prototype.interpolationFactor=function(a,u,c){return this.interpolationType?Ho.interpolationFactor(this.interpolationType,a,u,c):0};var nl=function(a,u){this._parameters=a,this._specification=u,et(this,function c(m,x){var E,A,I,D=x.type==="color",N=m.stops&&typeof m.stops[0][0]=="object",j=N||!(N||m.property!==void 0),X=m.type||(Ql(x)?"exponential":"interval");if(D&&((m=et({},m)).stops&&(m.stops=m.stops.map(function(sn){return[sn[0],Ti.parse(sn[1])]})),m.default=Ti.parse(m.default?m.default:x.default)),m.colorSpace&&m.colorSpace!=="rgb"&&!tp[m.colorSpace])throw new Error("Unknown color space: "+m.colorSpace);if(X==="exponential")E=Pf;else if(X==="interval")E=_h;else if(X==="categorical"){E=Jl,A=Object.create(null);for(var ee=0,R=m.stops;ee<R.length;ee+=1){var Ce=R[ee];A[Ce[0]]=Ce[1]}I=typeof m.stops[0][0]}else{if(X!=="identity")throw new Error('Unknown function type "'+X+'"');E=wl}if(N){for(var Oe={},Qe=[],He=0;He<m.stops.length;He++){var xt=m.stops[He],It=xt[0].zoom;Oe[It]===void 0&&(Oe[It]={zoom:It,type:m.type,property:m.property,default:m.default,stops:[]},Qe.push(It)),Oe[It].stops.push([xt[0].value,xt[1]])}for(var Vt=[],jt=0,fr=Qe;jt<fr.length;jt+=1){var Lr=fr[jt];Vt.push([Oe[Lr].zoom,c(Oe[Lr],x)])}var Gr={name:"linear"};return{kind:"composite",interpolationType:Gr,interpolationFactor:Ho.interpolationFactor.bind(void 0,Gr),zoomStops:Vt.map(function(sn){return sn[0]}),evaluate:function(sn,zn){var cn=sn.zoom;return Pf({stops:Vt,base:m.base},x,cn).evaluate(cn,zn)}}}if(j){var Dn=X==="exponential"?{name:"exponential",base:m.base!==void 0?m.base:1}:null;return{kind:"camera",interpolationType:Dn,interpolationFactor:Ho.interpolationFactor.bind(void 0,Dn),zoomStops:m.stops.map(function(sn){return sn[0]}),evaluate:function(sn){return E(m,x,sn.zoom,A,I)}}}return{kind:"source",evaluate:function(sn,zn){var cn=zn&&zn.properties?zn.properties[m.property]:void 0;return cn===void 0?Tl(m.default,x.default):E(m,x,cn,A,I)}}}(this._parameters,this._specification))};function Js(a){var u=a.key,c=a.value,m=a.valueSpec||{},x=a.objectElementValidators||{},E=a.style,A=a.styleSpec,I=[],D=ca(c);if(D!=="object")return[new q(u,c,"object expected, "+D+" found")];for(var N in c){var j=N.split(".")[0],X=m[j]||m["*"],ee=void 0;if(x[j])ee=x[j];else if(m[j])ee=ki;else if(x["*"])ee=x["*"];else{if(!m["*"]){I.push(new q(u,c[N],'unknown property "'+N+'"'));continue}ee=ki}I=I.concat(ee({key:(u&&u+".")+N,value:c[N],valueSpec:X,style:E,styleSpec:A,object:c,objectKey:N},c))}for(var R in m)x[R]||m[R].required&&m[R].default===void 0&&c[R]===void 0&&I.push(new q(u,c,'missing required property "'+R+'"'));return I}function nf(a){var u=a.value,c=a.valueSpec,m=a.style,x=a.styleSpec,E=a.key,A=a.arrayElementValidator||ki;if(ca(u)!=="array")return[new q(E,u,"array expected, "+ca(u)+" found")];if(c.length&&u.length!==c.length)return[new q(E,u,"array length "+c.length+" expected, length "+u.length+" found")];if(c["min-length"]&&u.length<c["min-length"])return[new q(E,u,"array length at least "+c["min-length"]+" expected, length "+u.length+" found")];var I={type:c.value,values:c.values};x.$version<7&&(I.function=c.function),ca(c.value)==="object"&&(I=c.value);for(var D=[],N=0;N<u.length;N++)D=D.concat(A({array:u,arrayIndex:N,value:u[N],valueSpec:I,style:m,styleSpec:x,key:E+"["+N+"]"}));return D}function Ic(a){var u=a.key,c=a.value,m=a.valueSpec,x=ca(c);return x==="number"&&c!=c&&(x="NaN"),x!=="number"?[new q(u,c,"number expected, "+x+" found")]:"minimum"in m&&c<m.minimum?[new q(u,c,c+" is less than the minimum value "+m.minimum)]:"maximum"in m&&c>m.maximum?[new q(u,c,c+" is greater than the maximum value "+m.maximum)]:[]}function yh(a){var u,c,m,x=a.valueSpec,E=be(a.value.type),A={},I=E!=="categorical"&&a.value.property===void 0,D=!I,N=ca(a.value.stops)==="array"&&ca(a.value.stops[0])==="array"&&ca(a.value.stops[0][0])==="object",j=Js({key:a.key,value:a.value,valueSpec:a.styleSpec.function,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(R){if(E==="identity")return[new q(R.key,R.value,'identity function may not have a "stops" property')];var Ce=[],Oe=R.value;return Ce=Ce.concat(nf({key:R.key,value:Oe,valueSpec:R.valueSpec,style:R.style,styleSpec:R.styleSpec,arrayElementValidator:X})),ca(Oe)==="array"&&Oe.length===0&&Ce.push(new q(R.key,Oe,"array must have at least one stop")),Ce},default:function(R){return ki({key:R.key,value:R.value,valueSpec:x,style:R.style,styleSpec:R.styleSpec})}}});return E==="identity"&&I&&j.push(new q(a.key,a.value,'missing required property "property"')),E==="identity"||a.value.stops||j.push(new q(a.key,a.value,'missing required property "stops"')),E==="exponential"&&a.valueSpec.expression&&!Ql(a.valueSpec)&&j.push(new q(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(D&&!rl(a.valueSpec)?j.push(new q(a.key,a.value,"property functions not supported")):I&&!gh(a.valueSpec)&&j.push(new q(a.key,a.value,"zoom functions not supported"))),E!=="categorical"&&!N||a.value.property!==void 0||j.push(new q(a.key,a.value,'"property" property is required')),j;function X(R){var Ce=[],Oe=R.value,Qe=R.key;if(ca(Oe)!=="array")return[new q(Qe,Oe,"array expected, "+ca(Oe)+" found")];if(Oe.length!==2)return[new q(Qe,Oe,"array length 2 expected, length "+Oe.length+" found")];if(N){if(ca(Oe[0])!=="object")return[new q(Qe,Oe,"object expected, "+ca(Oe[0])+" found")];if(Oe[0].zoom===void 0)return[new q(Qe,Oe,"object stop key must have zoom")];if(Oe[0].value===void 0)return[new q(Qe,Oe,"object stop key must have value")];if(m&&m>be(Oe[0].zoom))return[new q(Qe,Oe[0].zoom,"stop zoom values must appear in ascending order")];be(Oe[0].zoom)!==m&&(m=be(Oe[0].zoom),c=void 0,A={}),Ce=Ce.concat(Js({key:Qe+"[0]",value:Oe[0],valueSpec:{zoom:{}},style:R.style,styleSpec:R.styleSpec,objectElementValidators:{zoom:Ic,value:ee}}))}else Ce=Ce.concat(ee({key:Qe+"[0]",value:Oe[0],valueSpec:{},style:R.style,styleSpec:R.styleSpec},Oe));return Mc(er(Oe[1]))?Ce.concat([new q(Qe+"[1]",Oe[1],"expressions are not allowed in function stops.")]):Ce.concat(ki({key:Qe+"[1]",value:Oe[1],valueSpec:x,style:R.style,styleSpec:R.styleSpec}))}function ee(R,Ce){var Oe=ca(R.value),Qe=be(R.value),He=R.value!==null?R.value:Ce;if(u){if(Oe!==u)return[new q(R.key,He,Oe+" stop domain type must match previous stop domain type "+u)]}else u=Oe;if(Oe!=="number"&&Oe!=="string"&&Oe!=="boolean")return[new q(R.key,He,"stop domain value must be a number, string, or boolean")];if(Oe!=="number"&&E!=="categorical"){var xt="number expected, "+Oe+" found";return rl(x)&&E===void 0&&(xt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new q(R.key,He,xt)]}return E!=="categorical"||Oe!=="number"||isFinite(Qe)&&Math.floor(Qe)===Qe?E!=="categorical"&&Oe==="number"&&c!==void 0&&Qe<c?[new q(R.key,He,"stop domain values must appear in ascending order")]:(c=Qe,E==="categorical"&&Qe in A?[new q(R.key,He,"stop domain values must be unique")]:(A[Qe]=!0,[])):[new q(R.key,He,"integer expected, found "+Qe)]}}function Cl(a){var u=(a.expressionContext==="property"?ip:rf)(er(a.value),a.valueSpec);if(u.result==="error")return u.value.map(function(m){return new q(""+a.key+m.key,a.value,m.message)});var c=u.value.expression||u.value._styleExpression.expression;if(a.expressionContext==="property"&&a.propertyKey==="text-font"&&!c.outputDefined())return[new q(a.key,a.value,'Invalid data expression for "'+a.propertyKey+'". Output values must be contained as literals within the expression.')];if(a.expressionContext==="property"&&a.propertyType==="layout"&&!bl(c))return[new q(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if(a.expressionContext==="filter"&&!bl(c))return[new q(a.key,a.value,'"feature-state" data expressions are not supported with filters.')];if(a.expressionContext&&a.expressionContext.indexOf("cluster")===0){if(!Mu(c,["zoom","feature-state"]))return[new q(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(a.expressionContext==="cluster-initial"&&!xl(c))return[new q(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function pu(a){var u=a.key,c=a.value,m=a.valueSpec,x=[];return Array.isArray(m.values)?m.values.indexOf(be(c))===-1&&x.push(new q(u,c,"expected one of ["+m.values.join(", ")+"], "+JSON.stringify(c)+" found")):Object.keys(m.values).indexOf(be(c))===-1&&x.push(new q(u,c,"expected one of ["+Object.keys(m.values).join(", ")+"], "+JSON.stringify(c)+" found")),x}function af(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(var u=0,c=a.slice(1);u<c.length;u+=1){var m=c[u];if(!af(m)&&typeof m!="boolean")return!1}return!0;default:return!0}}nl.deserialize=function(a){return new nl(a._parameters,a._specification)},nl.serialize=function(a){return{_parameters:a._parameters,_specification:a._specification}};var Pc={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Bu(a){if(a==null)return{filter:function(){return!0},needGeometry:!1};af(a)||(a=Of(a));var u=rf(a,Pc);if(u.result==="error")throw new Error(u.value.map(function(c){return c.key+": "+c.message}).join(", "));return{filter:function(c,m,x){return u.value.evaluate(c,m,{},x)},needGeometry:function c(m){if(!Array.isArray(m))return!1;if(m[0]==="within")return!0;for(var x=1;x<m.length;x++)if(c(m[x]))return!0;return!1}(a)}}function Md(a,u){return a<u?-1:a>u?1:0}function Of(a){if(!a)return!0;var u,c=a[0];return a.length<=1?c!=="any":c==="=="?xh(a[1],a[2],"=="):c==="!="?bh(xh(a[1],a[2],"==")):c==="<"||c===">"||c==="<="||c===">="?xh(a[1],a[2],c):c==="any"?(u=a.slice(1),["any"].concat(u.map(Of))):c==="all"?["all"].concat(a.slice(1).map(Of)):c==="none"?["all"].concat(a.slice(1).map(Of).map(bh)):c==="in"?Df(a[1],a.slice(2)):c==="!in"?bh(Df(a[1],a.slice(2))):c==="has"?ko(a[1]):c==="!has"?bh(ko(a[1])):c!=="within"||a}function xh(a,u,c){switch(a){case"$type":return["filter-type-"+c,u];case"$id":return["filter-id-"+c,u];default:return["filter-"+c,a,u]}}function Df(a,u){if(u.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",u]];case"$id":return["filter-id-in",["literal",u]];default:return u.length>200&&!u.some(function(c){return typeof c!=typeof u[0]})?["filter-in-large",a,["literal",u.sort(Md)]]:["filter-in-small",a,["literal",u]]}}function ko(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function bh(a){return["!",a]}function ap(a){return af(er(a.value))?Cl(et({},a,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function u(c){var m=c.value,x=c.key;if(ca(m)!=="array")return[new q(x,m,"array expected, "+ca(m)+" found")];var E,A=c.styleSpec,I=[];if(m.length<1)return[new q(x,m,"filter array must have at least 1 element")];switch(I=I.concat(pu({key:x+"[0]",value:m[0],valueSpec:A.filter_operator,style:c.style,styleSpec:c.styleSpec})),be(m[0])){case"<":case"<=":case">":case">=":m.length>=2&&be(m[1])==="$type"&&I.push(new q(x,m,'"$type" cannot be use with operator "'+m[0]+'"'));case"==":case"!=":m.length!==3&&I.push(new q(x,m,'filter array for operator "'+m[0]+'" must have 3 elements'));case"in":case"!in":m.length>=2&&(E=ca(m[1]))!=="string"&&I.push(new q(x+"[1]",m[1],"string expected, "+E+" found"));for(var D=2;D<m.length;D++)E=ca(m[D]),be(m[1])==="$type"?I=I.concat(pu({key:x+"["+D+"]",value:m[D],valueSpec:A.geometry_type,style:c.style,styleSpec:c.styleSpec})):E!=="string"&&E!=="number"&&E!=="boolean"&&I.push(new q(x+"["+D+"]",m[D],"string, number, or boolean expected, "+E+" found"));break;case"any":case"all":case"none":for(var N=1;N<m.length;N++)I=I.concat(u({key:x+"["+N+"]",value:m[N],style:c.style,styleSpec:c.styleSpec}));break;case"has":case"!has":E=ca(m[1]),m.length!==2?I.push(new q(x,m,'filter array for "'+m[0]+'" operator must have 2 elements')):E!=="string"&&I.push(new q(x+"[1]",m[1],"string expected, "+E+" found"));break;case"within":E=ca(m[1]),m.length!==2?I.push(new q(x,m,'filter array for "'+m[0]+'" operator must have 2 elements')):E!=="object"&&I.push(new q(x+"[1]",m[1],"object expected, "+E+" found"))}return I}(a)}function kf(a,u){var c=a.key,m=a.style,x=a.styleSpec,E=a.value,A=a.objectKey,I=x[u+"_"+a.layerType];if(!I)return[];var D=A.match(/^(.*)-transition$/);if(u==="paint"&&D&&I[D[1]]&&I[D[1]].transition)return ki({key:c,value:E,valueSpec:x.transition,style:m,styleSpec:x});var N,j=a.valueSpec||I[A];if(!j)return[new q(c,E,'unknown property "'+A+'"')];if(ca(E)==="string"&&rl(j)&&!j.tokens&&(N=/^{([^}]+)}$/.exec(E)))return[new q(c,E,'"'+A+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(N[1])+" }`.")];var X=[];return a.layerType==="symbol"&&(A==="text-field"&&m&&!m.glyphs&&X.push(new q(c,E,'use of "text-field" requires a style "glyphs" property')),A==="text-font"&&tf(er(E))&&be(E.type)==="identity"&&X.push(new q(c,E,'"text-font" does not support identity functions'))),X.concat(ki({key:a.key,value:E,valueSpec:j,style:m,styleSpec:x,expressionContext:"property",propertyType:u,propertyKey:A}))}function Eh(a){return kf(a,"paint")}function Oc(a){return kf(a,"layout")}function of(a){var u=[],c=a.value,m=a.key,x=a.style,E=a.styleSpec;c.type||c.ref||u.push(new q(m,c,'either "type" or "ref" is required'));var A,I=be(c.type),D=be(c.ref);if(c.id)for(var N=be(c.id),j=0;j<a.arrayIndex;j++){var X=x.layers[j];be(X.id)===N&&u.push(new q(m,c.id,'duplicate layer id "'+c.id+'", previously used at line '+X.id.__line__))}if("ref"in c)["type","source","source-layer","filter","layout"].forEach(function(Ce){Ce in c&&u.push(new q(m,c[Ce],'"'+Ce+'" is prohibited for ref layers'))}),x.layers.forEach(function(Ce){be(Ce.id)===D&&(A=Ce)}),A?A.ref?u.push(new q(m,c.ref,"ref cannot reference another ref layer")):I=be(A.type):u.push(new q(m,c.ref,'ref layer "'+D+'" not found'));else if(I!=="background")if(c.source){var ee=x.sources&&x.sources[c.source],R=ee&&be(ee.type);ee?R==="vector"&&I==="raster"?u.push(new q(m,c.source,'layer "'+c.id+'" requires a raster source')):R==="raster"&&I!=="raster"?u.push(new q(m,c.source,'layer "'+c.id+'" requires a vector source')):R!=="vector"||c["source-layer"]?R==="raster-dem"&&I!=="hillshade"?u.push(new q(m,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):I!=="line"||!c.paint||!c.paint["line-gradient"]||R==="geojson"&&ee.lineMetrics||u.push(new q(m,c,'layer "'+c.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):u.push(new q(m,c,'layer "'+c.id+'" must specify a "source-layer"')):u.push(new q(m,c.source,'source "'+c.source+'" not found'))}else u.push(new q(m,c,'missing required property "source"'));return u=u.concat(Js({key:m,value:c,valueSpec:E.layer,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return ki({key:m+".type",value:c.type,valueSpec:E.layer.type,style:a.style,styleSpec:a.styleSpec,object:c,objectKey:"type"})},filter:ap,layout:function(Ce){return Js({layer:c,key:Ce.key,value:Ce.value,style:Ce.style,styleSpec:Ce.styleSpec,objectElementValidators:{"*":function(Oe){return Oc(et({layerType:I},Oe))}}})},paint:function(Ce){return Js({layer:c,key:Ce.key,value:Ce.value,style:Ce.style,styleSpec:Ce.styleSpec,objectElementValidators:{"*":function(Oe){return Eh(et({layerType:I},Oe))}}})}}}))}function il(a){var u=a.value,c=a.key,m=ca(u);return m!=="string"?[new q(c,u,"string expected, "+m+" found")]:[]}var pa={promoteId:function(a){var u=a.key,c=a.value;if(ca(c)==="string")return il({key:u,value:c});var m=[];for(var x in c)m.push.apply(m,il({key:u+"."+x,value:c[x]}));return m}};function Ff(a){var u=a.value,c=a.key,m=a.styleSpec,x=a.style;if(!u.type)return[new q(c,u,'"type" is required')];var E,A=be(u.type);switch(A){case"vector":case"raster":case"raster-dem":return Js({key:c,value:u,valueSpec:m["source_"+A.replace("-","_")],style:a.style,styleSpec:m,objectElementValidators:pa});case"geojson":if(E=Js({key:c,value:u,valueSpec:m.source_geojson,style:x,styleSpec:m,objectElementValidators:pa}),u.cluster)for(var I in u.clusterProperties){var D=u.clusterProperties[I],N=D[0],j=typeof N=="string"?[N,["accumulated"],["get",I]]:N;E.push.apply(E,Cl({key:c+"."+I+".map",value:D[1],expressionContext:"cluster-map"})),E.push.apply(E,Cl({key:c+"."+I+".reduce",value:j,expressionContext:"cluster-reduce"}))}return E;case"video":return Js({key:c,value:u,valueSpec:m.source_video,style:x,styleSpec:m});case"image":return Js({key:c,value:u,valueSpec:m.source_image,style:x,styleSpec:m});case"canvas":return[new q(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return pu({key:c+".type",value:u.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:x,styleSpec:m})}}function du(a){var u=a.value,c=a.styleSpec,m=c.light,x=a.style,E=[],A=ca(u);if(u===void 0)return E;if(A!=="object")return E.concat([new q("light",u,"object expected, "+A+" found")]);for(var I in u){var D=I.match(/^(.*)-transition$/);E=E.concat(D&&m[D[1]]&&m[D[1]].transition?ki({key:I,value:u[I],valueSpec:c.transition,style:x,styleSpec:c}):m[I]?ki({key:I,value:u[I],valueSpec:m[I],style:x,styleSpec:c}):[new q(I,u[I],'unknown property "'+I+'"')])}return E}var Rl={"*":function(){return[]},array:nf,boolean:function(a){var u=a.value,c=a.key,m=ca(u);return m!=="boolean"?[new q(c,u,"boolean expected, "+m+" found")]:[]},number:Ic,color:function(a){var u=a.key,c=a.value,m=ca(c);return m!=="string"?[new q(u,c,"color expected, "+m+" found")]:mi(c)===null?[new q(u,c,'color expected, "'+c+'" found')]:[]},constants:De,enum:pu,filter:ap,function:yh,layer:of,object:Js,source:Ff,light:du,string:il,formatted:function(a){return il(a).length===0?[]:Cl(a)},resolvedImage:function(a){return il(a).length===0?[]:Cl(a)}};function ki(a){var u=a.value,c=a.valueSpec,m=a.styleSpec;return c.expression&&tf(be(u))?yh(a):c.expression&&Mc(er(u))?Cl(a):c.type&&Rl[c.type]?Rl[c.type](a):Js(et({},a,{valueSpec:c.type?m[c.type]:c}))}function Ca(a){var u=a.value,c=a.key,m=il(a);return m.length||(u.indexOf("{fontstack}")===-1&&m.push(new q(c,u,'"glyphs" url must include a "{fontstack}" token')),u.indexOf("{range}")===-1&&m.push(new q(c,u,'"glyphs" url must include a "{range}" token'))),m}function $s(a,u){u===void 0&&(u=V);var c=[];return c=c.concat(ki({key:"",value:a,valueSpec:u.$root,styleSpec:u,style:a,objectElementValidators:{glyphs:Ca,"*":function(){return[]}}})),a.constants&&(c=c.concat(De({key:"constants",value:a.constants,style:a,styleSpec:u}))),Bf(c)}function Bf(a){return[].concat(a).sort(function(u,c){return u.line-c.line})}function Ds(a){return function(){for(var u=[],c=arguments.length;c--;)u[c]=arguments[c];return Bf(a.apply(this,u))}}$s.source=Ds(Ff),$s.light=Ds(du),$s.layer=Ds(of),$s.filter=Ds(ap),$s.paintProperty=Ds(Eh),$s.layoutProperty=Ds(Oc);var sf=$s,op=sf.light,Sh=sf.paintProperty,Lf=sf.layoutProperty;function Ml(a,u){var c=!1;if(u&&u.length)for(var m=0,x=u;m<x.length;m+=1)a.fire(new Je(new Error(x[m].message))),c=!0;return c}var Fo=Ha;function Ha(a,u,c){var m=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var x=new Int32Array(this.arrayBuffer);a=x[0],this.d=(u=x[1])+2*(c=x[2]);for(var E=0;E<this.d*this.d;E++){var A=x[3+E],I=x[3+E+1];m.push(A===I?null:x.subarray(A,I))}var D=x[3+m.length+1];this.keys=x.subarray(x[3+m.length],D),this.bboxes=x.subarray(D),this.insert=this._insertReadonly}else{this.d=u+2*c;for(var N=0;N<this.d*this.d;N++)m.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=a,this.padding=c,this.scale=u/a,this.uid=0;var j=c/u*a;this.min=-j,this.max=a+j}Ha.prototype.insert=function(a,u,c,m,x){this._forEachCell(u,c,m,x,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(u),this.bboxes.push(c),this.bboxes.push(m),this.bboxes.push(x)},Ha.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Ha.prototype._insertCell=function(a,u,c,m,x,E){this.cells[x].push(E)},Ha.prototype.query=function(a,u,c,m,x){var E=this.min,A=this.max;if(a<=E&&u<=E&&A<=c&&A<=m&&!x)return Array.prototype.slice.call(this.keys);var I=[];return this._forEachCell(a,u,c,m,this._queryCell,I,{},x),I},Ha.prototype._queryCell=function(a,u,c,m,x,E,A,I){var D=this.cells[x];if(D!==null)for(var N=this.keys,j=this.bboxes,X=0;X<D.length;X++){var ee=D[X];if(A[ee]===void 0){var R=4*ee;(I?I(j[R+0],j[R+1],j[R+2],j[R+3]):a<=j[R+2]&&u<=j[R+3]&&c>=j[R+0]&&m>=j[R+1])?(A[ee]=!0,E.push(N[ee])):A[ee]=!1}}},Ha.prototype._forEachCell=function(a,u,c,m,x,E,A,I){for(var D=this._convertToCellCoord(a),N=this._convertToCellCoord(u),j=this._convertToCellCoord(c),X=this._convertToCellCoord(m),ee=D;ee<=j;ee++)for(var R=N;R<=X;R++){var Ce=this.d*R+ee;if((!I||I(this._convertFromCellCoord(ee),this._convertFromCellCoord(R),this._convertFromCellCoord(ee+1),this._convertFromCellCoord(R+1)))&&x.call(this,a,u,c,m,Ce,E,A,I))return}},Ha.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},Ha.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},Ha.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,u=3+this.cells.length+1+1,c=0,m=0;m<this.cells.length;m++)c+=this.cells[m].length;var x=new Int32Array(u+c+this.keys.length+this.bboxes.length);x[0]=this.extent,x[1]=this.n,x[2]=this.padding;for(var E=u,A=0;A<a.length;A++){var I=a[A];x[3+A]=E,x.set(I,E),E+=I.length}return x[3+a.length]=E,x.set(this.keys,E),x[3+a.length+1]=E+=this.keys.length,x.set(this.bboxes,E),E+=this.bboxes.length,x.buffer};var al=ie.ImageData,Ah=ie.ImageBitmap,qa={};function vn(a,u,c){c===void 0&&(c={}),Object.defineProperty(u,"_classRegistryKey",{value:a,writeable:!1}),qa[a]={klass:u,omit:c.omit||[],shallow:c.shallow||[]}}for(var ks in vn("Object",Object),Fo.serialize=function(a,u){var c=a.toArrayBuffer();return u&&u.push(c),{buffer:c}},Fo.deserialize=function(a){return new Fo(a.buffer)},vn("Grid",Fo),vn("Color",Ti),vn("Error",Error),vn("ResolvedImage",Aa),vn("StylePropertyFunction",nl),vn("StyleExpression",hu,{omit:["_evaluator"]}),vn("ZoomDependentExpression",tc),vn("ZoomConstantExpression",ec),vn("CompoundExpression",Qi,{omit:["_evaluate"]}),Fu)Fu[ks]._classRegistryKey||vn("Expression_"+ks,Fu[ks]);function uf(a){return a&&typeof ArrayBuffer!="undefined"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function rc(a){return Ah&&a instanceof Ah}function us(a,u){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if(uf(a)||rc(a))return u&&u.push(a),a;if(ArrayBuffer.isView(a)){var c=a;return u&&u.push(c.buffer),c}if(a instanceof al)return u&&u.push(a.data.buffer),a;if(Array.isArray(a)){for(var m=[],x=0,E=a;x<E.length;x+=1)m.push(us(E[x],u));return m}if(typeof a=="object"){var A=a.constructor,I=A._classRegistryKey;if(!I)throw new Error("can't serialize object of unregistered class");var D=A.serialize?A.serialize(a,u):{};if(!A.serialize){for(var N in a)if(a.hasOwnProperty(N)&&!(qa[I].omit.indexOf(N)>=0)){var j=a[N];D[N]=qa[I].shallow.indexOf(N)>=0?j:us(j,u)}a instanceof Error&&(D.message=a.message)}if(D.$name)throw new Error("$name property is reserved for worker serialization logic.");return I!=="Object"&&(D.$name=I),D}throw new Error("can't serialize object of type "+typeof a)}function ga(a){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||uf(a)||rc(a)||ArrayBuffer.isView(a)||a instanceof al)return a;if(Array.isArray(a))return a.map(ga);if(typeof a=="object"){var u=a.$name||"Object",c=qa[u].klass;if(!c)throw new Error("can't deserialize unregistered class "+u);if(c.deserialize)return c.deserialize(a);for(var m=Object.create(c.prototype),x=0,E=Object.keys(a);x<E.length;x+=1){var A=E[x];if(A!=="$name"){var I=a[A];m[A]=qa[u].shallow.indexOf(A)>=0?I:ga(I)}}return m}throw new Error("can't deserialize object of type "+typeof a)}var Th=function(){this.first=!0};Th.prototype.update=function(a,u){var c=Math.floor(a);return this.first?(this.first=!1,this.lastIntegerZoom=c,this.lastIntegerZoomTime=0,this.lastZoom=a,this.lastFloorZoom=c,!0):(this.lastFloorZoom>c?(this.lastIntegerZoom=c+1,this.lastIntegerZoomTime=u):this.lastFloorZoom<c&&(this.lastIntegerZoom=c,this.lastIntegerZoomTime=u),a!==this.lastZoom&&(this.lastZoom=a,this.lastFloorZoom=c,!0))};var Yr={"Latin-1 Supplement":function(a){return a>=128&&a<=255},Arabic:function(a){return a>=1536&&a<=1791},"Arabic Supplement":function(a){return a>=1872&&a<=1919},"Arabic Extended-A":function(a){return a>=2208&&a<=2303},"Hangul Jamo":function(a){return a>=4352&&a<=4607},"Unified Canadian Aboriginal Syllabics":function(a){return a>=5120&&a<=5759},Khmer:function(a){return a>=6016&&a<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(a){return a>=6320&&a<=6399},"General Punctuation":function(a){return a>=8192&&a<=8303},"Letterlike Symbols":function(a){return a>=8448&&a<=8527},"Number Forms":function(a){return a>=8528&&a<=8591},"Miscellaneous Technical":function(a){return a>=8960&&a<=9215},"Control Pictures":function(a){return a>=9216&&a<=9279},"Optical Character Recognition":function(a){return a>=9280&&a<=9311},"Enclosed Alphanumerics":function(a){return a>=9312&&a<=9471},"Geometric Shapes":function(a){return a>=9632&&a<=9727},"Miscellaneous Symbols":function(a){return a>=9728&&a<=9983},"Miscellaneous Symbols and Arrows":function(a){return a>=11008&&a<=11263},"CJK Radicals Supplement":function(a){return a>=11904&&a<=12031},"Kangxi Radicals":function(a){return a>=12032&&a<=12255},"Ideographic Description Characters":function(a){return a>=12272&&a<=12287},"CJK Symbols and Punctuation":function(a){return a>=12288&&a<=12351},Hiragana:function(a){return a>=12352&&a<=12447},Katakana:function(a){return a>=12448&&a<=12543},Bopomofo:function(a){return a>=12544&&a<=12591},"Hangul Compatibility Jamo":function(a){return a>=12592&&a<=12687},Kanbun:function(a){return a>=12688&&a<=12703},"Bopomofo Extended":function(a){return a>=12704&&a<=12735},"CJK Strokes":function(a){return a>=12736&&a<=12783},"Katakana Phonetic Extensions":function(a){return a>=12784&&a<=12799},"Enclosed CJK Letters and Months":function(a){return a>=12800&&a<=13055},"CJK Compatibility":function(a){return a>=13056&&a<=13311},"CJK Unified Ideographs Extension A":function(a){return a>=13312&&a<=19903},"Yijing Hexagram Symbols":function(a){return a>=19904&&a<=19967},"CJK Unified Ideographs":function(a){return a>=19968&&a<=40959},"Yi Syllables":function(a){return a>=40960&&a<=42127},"Yi Radicals":function(a){return a>=42128&&a<=42191},"Hangul Jamo Extended-A":function(a){return a>=43360&&a<=43391},"Hangul Syllables":function(a){return a>=44032&&a<=55215},"Hangul Jamo Extended-B":function(a){return a>=55216&&a<=55295},"Private Use Area":function(a){return a>=57344&&a<=63743},"CJK Compatibility Ideographs":function(a){return a>=63744&&a<=64255},"Arabic Presentation Forms-A":function(a){return a>=64336&&a<=65023},"Vertical Forms":function(a){return a>=65040&&a<=65055},"CJK Compatibility Forms":function(a){return a>=65072&&a<=65103},"Small Form Variants":function(a){return a>=65104&&a<=65135},"Arabic Presentation Forms-B":function(a){return a>=65136&&a<=65279},"Halfwidth and Fullwidth Forms":function(a){return a>=65280&&a<=65519}};function ol(a){for(var u=0,c=a;u<c.length;u+=1)if(Dc(c[u].charCodeAt(0)))return!0;return!1}function Dc(a){return!(a!==746&&a!==747&&(a<4352||!(Yr["Bopomofo Extended"](a)||Yr.Bopomofo(a)||Yr["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||Yr["CJK Compatibility Ideographs"](a)||Yr["CJK Compatibility"](a)||Yr["CJK Radicals Supplement"](a)||Yr["CJK Strokes"](a)||!(!Yr["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||Yr["CJK Unified Ideographs Extension A"](a)||Yr["CJK Unified Ideographs"](a)||Yr["Enclosed CJK Letters and Months"](a)||Yr["Hangul Compatibility Jamo"](a)||Yr["Hangul Jamo Extended-A"](a)||Yr["Hangul Jamo Extended-B"](a)||Yr["Hangul Jamo"](a)||Yr["Hangul Syllables"](a)||Yr.Hiragana(a)||Yr["Ideographic Description Characters"](a)||Yr.Kanbun(a)||Yr["Kangxi Radicals"](a)||Yr["Katakana Phonetic Extensions"](a)||Yr.Katakana(a)&&a!==12540||!(!Yr["Halfwidth and Fullwidth Forms"](a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!Yr["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||Yr["Unified Canadian Aboriginal Syllabics"](a)||Yr["Unified Canadian Aboriginal Syllabics Extended"](a)||Yr["Vertical Forms"](a)||Yr["Yijing Hexagram Symbols"](a)||Yr["Yi Syllables"](a)||Yr["Yi Radicals"](a))))}function wh(a){return!(Dc(a)||function(u){return!!(Yr["Latin-1 Supplement"](u)&&(u===167||u===169||u===174||u===177||u===188||u===189||u===190||u===215||u===247)||Yr["General Punctuation"](u)&&(u===8214||u===8224||u===8225||u===8240||u===8241||u===8251||u===8252||u===8258||u===8263||u===8264||u===8265||u===8273)||Yr["Letterlike Symbols"](u)||Yr["Number Forms"](u)||Yr["Miscellaneous Technical"](u)&&(u>=8960&&u<=8967||u>=8972&&u<=8991||u>=8996&&u<=9e3||u===9003||u>=9085&&u<=9114||u>=9150&&u<=9165||u===9167||u>=9169&&u<=9179||u>=9186&&u<=9215)||Yr["Control Pictures"](u)&&u!==9251||Yr["Optical Character Recognition"](u)||Yr["Enclosed Alphanumerics"](u)||Yr["Geometric Shapes"](u)||Yr["Miscellaneous Symbols"](u)&&!(u>=9754&&u<=9759)||Yr["Miscellaneous Symbols and Arrows"](u)&&(u>=11026&&u<=11055||u>=11088&&u<=11097||u>=11192&&u<=11243)||Yr["CJK Symbols and Punctuation"](u)||Yr.Katakana(u)||Yr["Private Use Area"](u)||Yr["CJK Compatibility Forms"](u)||Yr["Small Form Variants"](u)||Yr["Halfwidth and Fullwidth Forms"](u)||u===8734||u===8756||u===8757||u>=9984&&u<=10087||u>=10102&&u<=10131||u===65532||u===65533)}(a))}function eu(a){return a>=1424&&a<=2303||Yr["Arabic Presentation Forms-A"](a)||Yr["Arabic Presentation Forms-B"](a)}function Fs(a,u){return!(!u&&eu(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||Yr.Khmer(a))}function Nf(a){for(var u=0,c=a;u<c.length;u+=1)if(eu(c[u].charCodeAt(0)))return!0;return!1}var Uf=null,Yo="unavailable",Lu=null,sp=function(a){a&&typeof a=="string"&&a.indexOf("NetworkError")>-1&&(Yo="error"),Uf&&Uf(a)};function Il(){lf.fire(new Re("pluginStateChange",{pluginStatus:Yo,pluginURL:Lu}))}var lf=new lt,up=function(){return Yo},Ct=function(){if(Yo!=="deferred"||!Lu)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Yo="loading",Il(),Lu&&Ks({url:Lu},function(a){a?sp(a):(Yo="loaded",Il())})},Ie={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Yo==="loaded"||Ie.applyArabicShaping!=null},isLoading:function(){return Yo==="loading"},setState:function(a){Yo=a.pluginStatus,Lu=a.pluginURL},isParsed:function(){return Ie.applyArabicShaping!=null&&Ie.processBidirectionalText!=null&&Ie.processStyledBidirectionalText!=null},getPluginURL:function(){return Lu}},B=function(a,u){this.zoom=a,u?(this.now=u.now,this.fadeDuration=u.fadeDuration,this.zoomHistory=u.zoomHistory,this.transition=u.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Th,this.transition={})};B.prototype.isSupportedScript=function(a){return function(u,c){for(var m=0,x=u;m<x.length;m+=1)if(!Fs(x[m].charCodeAt(0),c))return!1;return!0}(a,Ie.isLoaded())},B.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},B.prototype.getCrossfadeParameters=function(){var a=this.zoom,u=a-Math.floor(a),c=this.crossFadingFactor();return a>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:u+(1-u)*c}:{fromScale:.5,toScale:1,t:1-(1-c)*u}};var Ys=function(a,u){this.property=a,this.value=u,this.expression=function(c,m){if(tf(c))return new nl(c,m);if(Mc(c)){var x=ip(c,m);if(x.result==="error")throw new Error(x.value.map(function(A){return A.key+": "+A.message}).join(", "));return x.value}var E=c;return typeof c=="string"&&m.type==="color"&&(E=Ti.parse(c)),{kind:"constant",evaluate:function(){return E}}}(u===void 0?a.specification.default:u,a.specification)};Ys.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},Ys.prototype.possiblyEvaluate=function(a,u,c){return this.property.possiblyEvaluate(this,a,u,c)};var me=function(a){this.property=a,this.value=new Ys(a,void 0)};me.prototype.transitioned=function(a,u){return new no(this.property,this.value,u,Ht({},a.transition,this.transition),a.now)},me.prototype.untransitioned=function(){return new no(this.property,this.value,null,{},0)};var Bo=function(a){this._properties=a,this._values=Object.create(a.defaultTransitionablePropertyValues)};Bo.prototype.getValue=function(a){return nt(this._values[a].value.value)},Bo.prototype.setValue=function(a,u){this._values.hasOwnProperty(a)||(this._values[a]=new me(this._values[a].property)),this._values[a].value=new Ys(this._values[a].property,u===null?void 0:nt(u))},Bo.prototype.getTransition=function(a){return nt(this._values[a].transition)},Bo.prototype.setTransition=function(a,u){this._values.hasOwnProperty(a)||(this._values[a]=new me(this._values[a].property)),this._values[a].transition=nt(u)||void 0},Bo.prototype.serialize=function(){for(var a={},u=0,c=Object.keys(this._values);u<c.length;u+=1){var m=c[u],x=this.getValue(m);x!==void 0&&(a[m]=x);var E=this.getTransition(m);E!==void 0&&(a[m+"-transition"]=E)}return a},Bo.prototype.transitioned=function(a,u){for(var c=new vu(this._properties),m=0,x=Object.keys(this._values);m<x.length;m+=1){var E=x[m];c._values[E]=this._values[E].transitioned(a,u._values[E])}return c},Bo.prototype.untransitioned=function(){for(var a=new vu(this._properties),u=0,c=Object.keys(this._values);u<c.length;u+=1){var m=c[u];a._values[m]=this._values[m].untransitioned()}return a};var no=function(a,u,c,m,x){this.property=a,this.value=u,this.begin=x+m.delay||0,this.end=this.begin+m.duration||0,a.specification.transition&&(m.delay||m.duration)&&(this.prior=c)};no.prototype.possiblyEvaluate=function(a,u,c){var m=a.now||0,x=this.value.possiblyEvaluate(a,u,c),E=this.prior;if(E){if(m>this.end)return this.prior=null,x;if(this.value.isDataDriven())return this.prior=null,x;if(m<this.begin)return E.possiblyEvaluate(a,u,c);var A=(m-this.begin)/(this.end-this.begin);return this.property.interpolate(E.possiblyEvaluate(a,u,c),x,function(I){if(I<=0)return 0;if(I>=1)return 1;var D=I*I,N=D*I;return 4*(I<.5?N:3*(I-D)+N-.75)}(A))}return x};var vu=function(a){this._properties=a,this._values=Object.create(a.defaultTransitioningPropertyValues)};vu.prototype.possiblyEvaluate=function(a,u,c){for(var m=new nc(this._properties),x=0,E=Object.keys(this._values);x<E.length;x+=1){var A=E[x];m._values[A]=this._values[A].possiblyEvaluate(a,u,c)}return m},vu.prototype.hasTransition=function(){for(var a=0,u=Object.keys(this._values);a<u.length;a+=1)if(this._values[u[a]].prior)return!0;return!1};var bs=function(a){this._properties=a,this._values=Object.create(a.defaultPropertyValues)};bs.prototype.getValue=function(a){return nt(this._values[a].value)},bs.prototype.setValue=function(a,u){this._values[a]=new Ys(this._values[a].property,u===null?void 0:nt(u))},bs.prototype.serialize=function(){for(var a={},u=0,c=Object.keys(this._values);u<c.length;u+=1){var m=c[u],x=this.getValue(m);x!==void 0&&(a[m]=x)}return a},bs.prototype.possiblyEvaluate=function(a,u,c){for(var m=new nc(this._properties),x=0,E=Object.keys(this._values);x<E.length;x+=1){var A=E[x];m._values[A]=this._values[A].possiblyEvaluate(a,u,c)}return m};var Da=function(a,u,c){this.property=a,this.value=u,this.parameters=c};Da.prototype.isConstant=function(){return this.value.kind==="constant"},Da.prototype.constantOr=function(a){return this.value.kind==="constant"?this.value.value:a},Da.prototype.evaluate=function(a,u,c,m){return this.property.evaluate(this.value,this.parameters,a,u,c,m)};var nc=function(a){this._properties=a,this._values=Object.create(a.defaultPossiblyEvaluatedValues)};nc.prototype.get=function(a){return this._values[a]};var On=function(a){this.specification=a};On.prototype.possiblyEvaluate=function(a,u){return a.expression.evaluate(u)},On.prototype.interpolate=function(a,u,c){var m=El[this.specification.type];return m?m(a,u,c):a};var gn=function(a,u){this.specification=a,this.overrides=u};gn.prototype.possiblyEvaluate=function(a,u,c,m){return new Da(this,a.expression.kind==="constant"||a.expression.kind==="camera"?{kind:"constant",value:a.expression.evaluate(u,null,{},c,m)}:a.expression,u)},gn.prototype.interpolate=function(a,u,c){if(a.value.kind!=="constant"||u.value.kind!=="constant")return a;if(a.value.value===void 0||u.value.value===void 0)return new Da(this,{kind:"constant",value:void 0},a.parameters);var m=El[this.specification.type];return m?new Da(this,{kind:"constant",value:m(a.value.value,u.value.value,c)},a.parameters):a},gn.prototype.evaluate=function(a,u,c,m,x,E){return a.kind==="constant"?a.value:a.evaluate(u,c,m,x,E)};var Bs=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.possiblyEvaluate=function(c,m,x,E){if(c.value===void 0)return new Da(this,{kind:"constant",value:void 0},m);if(c.expression.kind==="constant"){var A=c.expression.evaluate(m,null,{},x,E),I=c.property.specification.type==="resolvedImage"&&typeof A!="string"?A.name:A,D=this._calculate(I,I,I,m);return new Da(this,{kind:"constant",value:D},m)}if(c.expression.kind==="camera"){var N=this._calculate(c.expression.evaluate({zoom:m.zoom-1}),c.expression.evaluate({zoom:m.zoom}),c.expression.evaluate({zoom:m.zoom+1}),m);return new Da(this,{kind:"constant",value:N},m)}return new Da(this,c.expression,m)},u.prototype.evaluate=function(c,m,x,E,A,I){if(c.kind==="source"){var D=c.evaluate(m,x,E,A,I);return this._calculate(D,D,D,m)}return c.kind==="composite"?this._calculate(c.evaluate({zoom:Math.floor(m.zoom)-1},x,E),c.evaluate({zoom:Math.floor(m.zoom)},x,E),c.evaluate({zoom:Math.floor(m.zoom)+1},x,E),m):c.value},u.prototype._calculate=function(c,m,x,E){return E.zoom>E.zoomHistory.lastIntegerZoom?{from:c,to:m}:{from:x,to:m}},u.prototype.interpolate=function(c){return c},u}(gn),qo=function(a){this.specification=a};qo.prototype.possiblyEvaluate=function(a,u,c,m){if(a.value!==void 0){if(a.expression.kind==="constant"){var x=a.expression.evaluate(u,null,{},c,m);return this._calculate(x,x,x,u)}return this._calculate(a.expression.evaluate(new B(Math.floor(u.zoom-1),u)),a.expression.evaluate(new B(Math.floor(u.zoom),u)),a.expression.evaluate(new B(Math.floor(u.zoom+1),u)),u)}},qo.prototype._calculate=function(a,u,c,m){return m.zoom>m.zoomHistory.lastIntegerZoom?{from:a,to:u}:{from:c,to:u}},qo.prototype.interpolate=function(a){return a};var mu=function(a){this.specification=a};mu.prototype.possiblyEvaluate=function(a,u,c,m){return!!a.expression.evaluate(u,null,{},c,m)},mu.prototype.interpolate=function(){return!1};var ka=function(a){for(var u in this.properties=a,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],a){var c=a[u];c.specification.overridable&&this.overridableProperties.push(u);var m=this.defaultPropertyValues[u]=new Ys(c,void 0),x=this.defaultTransitionablePropertyValues[u]=new me(c);this.defaultTransitioningPropertyValues[u]=x.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=m.possiblyEvaluate({})}};vn("DataDrivenProperty",gn),vn("DataConstantProperty",On),vn("CrossFadedDataDrivenProperty",Bs),vn("CrossFadedProperty",qo),vn("ColorRampProperty",mu);var Ls=function(a){function u(c,m){if(a.call(this),this.id=c.id,this.type=c.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},c.type!=="custom"&&(this.metadata=(c=c).metadata,this.minzoom=c.minzoom,this.maxzoom=c.maxzoom,c.type!=="background"&&(this.source=c.source,this.sourceLayer=c["source-layer"],this.filter=c.filter),m.layout&&(this._unevaluatedLayout=new bs(m.layout)),m.paint)){for(var x in this._transitionablePaint=new Bo(m.paint),c.paint)this.setPaintProperty(x,c.paint[x],{validate:!1});for(var E in c.layout)this.setLayoutProperty(E,c.layout[E],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new nc(m.paint)}}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},u.prototype.getLayoutProperty=function(c){return c==="visibility"?this.visibility:this._unevaluatedLayout.getValue(c)},u.prototype.setLayoutProperty=function(c,m,x){x===void 0&&(x={}),m!=null&&this._validate(Lf,"layers."+this.id+".layout."+c,c,m,x)||(c!=="visibility"?this._unevaluatedLayout.setValue(c,m):this.visibility=m)},u.prototype.getPaintProperty=function(c){return hr(c,"-transition")?this._transitionablePaint.getTransition(c.slice(0,-11)):this._transitionablePaint.getValue(c)},u.prototype.setPaintProperty=function(c,m,x){if(x===void 0&&(x={}),m!=null&&this._validate(Sh,"layers."+this.id+".paint."+c,c,m,x))return!1;if(hr(c,"-transition"))return this._transitionablePaint.setTransition(c.slice(0,-11),m||void 0),!1;var E=this._transitionablePaint._values[c],A=E.property.specification["property-type"]==="cross-faded-data-driven",I=E.value.isDataDriven(),D=E.value;this._transitionablePaint.setValue(c,m),this._handleSpecialPaintPropertyUpdate(c);var N=this._transitionablePaint._values[c].value;return N.isDataDriven()||I||A||this._handleOverridablePaintPropertyUpdate(c,D,N)},u.prototype._handleSpecialPaintPropertyUpdate=function(c){},u.prototype._handleOverridablePaintPropertyUpdate=function(c,m,x){return!1},u.prototype.isHidden=function(c){return!!(this.minzoom&&c<this.minzoom)||!!(this.maxzoom&&c>=this.maxzoom)||this.visibility==="none"},u.prototype.updateTransitions=function(c){this._transitioningPaint=this._transitionablePaint.transitioned(c,this._transitioningPaint)},u.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},u.prototype.recalculate=function(c,m){c.getCrossfadeParameters&&(this._crossfadeParameters=c.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(c,void 0,m)),this.paint=this._transitioningPaint.possiblyEvaluate(c,void 0,m)},u.prototype.serialize=function(){var c={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(c.layout=c.layout||{},c.layout.visibility=this.visibility),Et(c,function(m,x){return!(m===void 0||x==="layout"&&!Object.keys(m).length||x==="paint"&&!Object.keys(m).length)})},u.prototype._validate=function(c,m,x,E,A){return A===void 0&&(A={}),(!A||A.validate!==!1)&&Ml(this,c.call(sf,{key:m,layerType:this.type,objectKey:x,value:E,styleSpec:V,style:{glyphs:!0,sprite:!0}}))},u.prototype.is3D=function(){return!1},u.prototype.isTileClipped=function(){return!1},u.prototype.hasOffscreenPass=function(){return!1},u.prototype.resize=function(){},u.prototype.isStateDependent=function(){for(var c in this.paint._values){var m=this.paint.get(c);if(m instanceof Da&&rl(m.property.specification)&&(m.value.kind==="source"||m.value.kind==="composite")&&m.value.isStateDependent)return!0}return!1},u}(lt),qs={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},kc=function(a,u){this._structArray=a,this._pos1=u*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},ea=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function To(a,u){u===void 0&&(u=1);var c=0,m=0;return{members:a.map(function(x){var E=qs[x.type].BYTES_PER_ELEMENT,A=c=Ch(c,Math.max(u,E)),I=x.components||1;return m=Math.max(m,E),c+=E*I,{name:x.name,type:x.type,components:I,offset:A}}),size:Ch(c,Math.max(m,u)),alignment:u}}function Ch(a,u){return Math.ceil(a/u)*u}ea.serialize=function(a,u){return a._trim(),u&&(a.isTransferred=!0,u.push(a.arrayBuffer)),{length:a.length,arrayBuffer:a.arrayBuffer}},ea.deserialize=function(a){var u=Object.create(this.prototype);return u.arrayBuffer=a.arrayBuffer,u.length=a.length,u.capacity=a.arrayBuffer.byteLength/u.bytesPerElement,u._refreshViews(),u},ea.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},ea.prototype.clear=function(){this.length=0},ea.prototype.resize=function(a){this.reserve(a),this.length=a},ea.prototype.reserve=function(a){if(a>this.capacity){this.capacity=Math.max(a,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var u=this.uint8;this._refreshViews(),u&&this.uint8.set(u)}},ea.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Pl=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m){var x=this.length;return this.resize(x+1),this.emplace(x,c,m)},u.prototype.emplace=function(c,m,x){var E=2*c;return this.int16[E+0]=m,this.int16[E+1]=x,c},u}(ea);Pl.prototype.bytesPerElement=4,vn("StructArrayLayout2i4",Pl);var zf=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,x,E){var A=this.length;return this.resize(A+1),this.emplace(A,c,m,x,E)},u.prototype.emplace=function(c,m,x,E,A){var I=4*c;return this.int16[I+0]=m,this.int16[I+1]=x,this.int16[I+2]=E,this.int16[I+3]=A,c},u}(ea);zf.prototype.bytesPerElement=8,vn("StructArrayLayout4i8",zf);var gu=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,x,E,A,I){var D=this.length;return this.resize(D+1),this.emplace(D,c,m,x,E,A,I)},u.prototype.emplace=function(c,m,x,E,A,I,D){var N=6*c;return this.int16[N+0]=m,this.int16[N+1]=x,this.int16[N+2]=E,this.int16[N+3]=A,this.int16[N+4]=I,this.int16[N+5]=D,c},u}(ea);gu.prototype.bytesPerElement=12,vn("StructArrayLayout2i4i12",gu);var Es=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,x,E,A,I){var D=this.length;return this.resize(D+1),this.emplace(D,c,m,x,E,A,I)},u.prototype.emplace=function(c,m,x,E,A,I,D){var N=4*c,j=8*c;return this.int16[N+0]=m,this.int16[N+1]=x,this.uint8[j+4]=E,this.uint8[j+5]=A,this.uint8[j+6]=I,this.uint8[j+7]=D,c},u}(ea);Es.prototype.bytesPerElement=8,vn("StructArrayLayout2i4ub8",Es);var ic=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m){var x=this.length;return this.resize(x+1),this.emplace(x,c,m)},u.prototype.emplace=function(c,m,x){var E=2*c;return this.float32[E+0]=m,this.float32[E+1]=x,c},u}(ea);ic.prototype.bytesPerElement=8,vn("StructArrayLayout2f8",ic);var Nu=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,x,E,A,I,D,N,j,X){var ee=this.length;return this.resize(ee+1),this.emplace(ee,c,m,x,E,A,I,D,N,j,X)},u.prototype.emplace=function(c,m,x,E,A,I,D,N,j,X,ee){var R=10*c;return this.uint16[R+0]=m,this.uint16[R+1]=x,this.uint16[R+2]=E,this.uint16[R+3]=A,this.uint16[R+4]=I,this.uint16[R+5]=D,this.uint16[R+6]=N,this.uint16[R+7]=j,this.uint16[R+8]=X,this.uint16[R+9]=ee,c},u}(ea);Nu.prototype.bytesPerElement=20,vn("StructArrayLayout10ui20",Nu);var Zf=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,x,E,A,I,D,N,j,X,ee,R){var Ce=this.length;return this.resize(Ce+1),this.emplace(Ce,c,m,x,E,A,I,D,N,j,X,ee,R)},u.prototype.emplace=function(c,m,x,E,A,I,D,N,j,X,ee,R,Ce){var Oe=12*c;return this.int16[Oe+0]=m,this.int16[Oe+1]=x,this.int16[Oe+2]=E,this.int16[Oe+3]=A,this.uint16[Oe+4]=I,this.uint16[Oe+5]=D,this.uint16[Oe+6]=N,this.uint16[Oe+7]=j,this.int16[Oe+8]=X,this.int16[Oe+9]=ee,this.int16[Oe+10]=R,this.int16[Oe+11]=Ce,c},u}(ea);Zf.prototype.bytesPerElement=24,vn("StructArrayLayout4i4ui4i24",Zf);var Fc=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,x){var E=this.length;return this.resize(E+1),this.emplace(E,c,m,x)},u.prototype.emplace=function(c,m,x,E){var A=3*c;return this.float32[A+0]=m,this.float32[A+1]=x,this.float32[A+2]=E,c},u}(ea);Fc.prototype.bytesPerElement=12,vn("StructArrayLayout3f12",Fc);var cf=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c){var m=this.length;return this.resize(m+1),this.emplace(m,c)},u.prototype.emplace=function(c,m){return this.uint32[1*c+0]=m,c},u}(ea);cf.prototype.bytesPerElement=4,vn("StructArrayLayout1ul4",cf);var Vf=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,x,E,A,I,D,N,j){var X=this.length;return this.resize(X+1),this.emplace(X,c,m,x,E,A,I,D,N,j)},u.prototype.emplace=function(c,m,x,E,A,I,D,N,j,X){var ee=10*c,R=5*c;return this.int16[ee+0]=m,this.int16[ee+1]=x,this.int16[ee+2]=E,this.int16[ee+3]=A,this.int16[ee+4]=I,this.int16[ee+5]=D,this.uint32[R+3]=N,this.uint16[ee+8]=j,this.uint16[ee+9]=X,c},u}(ea);Vf.prototype.bytesPerElement=20,vn("StructArrayLayout6i1ul2ui20",Vf);var ac=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,x,E,A,I){var D=this.length;return this.resize(D+1),this.emplace(D,c,m,x,E,A,I)},u.prototype.emplace=function(c,m,x,E,A,I,D){var N=6*c;return this.int16[N+0]=m,this.int16[N+1]=x,this.int16[N+2]=E,this.int16[N+3]=A,this.int16[N+4]=I,this.int16[N+5]=D,c},u}(ea);ac.prototype.bytesPerElement=12,vn("StructArrayLayout2i2i2i12",ac);var oc=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,x,E,A){var I=this.length;return this.resize(I+1),this.emplace(I,c,m,x,E,A)},u.prototype.emplace=function(c,m,x,E,A,I){var D=4*c,N=8*c;return this.float32[D+0]=m,this.float32[D+1]=x,this.float32[D+2]=E,this.int16[N+6]=A,this.int16[N+7]=I,c},u}(ea);oc.prototype.bytesPerElement=16,vn("StructArrayLayout2f1f2i16",oc);var Uu=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,x,E){var A=this.length;return this.resize(A+1),this.emplace(A,c,m,x,E)},u.prototype.emplace=function(c,m,x,E,A){var I=12*c,D=3*c;return this.uint8[I+0]=m,this.uint8[I+1]=x,this.float32[D+1]=E,this.float32[D+2]=A,c},u}(ea);Uu.prototype.bytesPerElement=12,vn("StructArrayLayout2ub2f12",Uu);var zu=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,x){var E=this.length;return this.resize(E+1),this.emplace(E,c,m,x)},u.prototype.emplace=function(c,m,x,E){var A=3*c;return this.uint16[A+0]=m,this.uint16[A+1]=x,this.uint16[A+2]=E,c},u}(ea);zu.prototype.bytesPerElement=6,vn("StructArrayLayout3ui6",zu);var tu=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,x,E,A,I,D,N,j,X,ee,R,Ce,Oe,Qe,He,xt){var It=this.length;return this.resize(It+1),this.emplace(It,c,m,x,E,A,I,D,N,j,X,ee,R,Ce,Oe,Qe,He,xt)},u.prototype.emplace=function(c,m,x,E,A,I,D,N,j,X,ee,R,Ce,Oe,Qe,He,xt,It){var Vt=24*c,jt=12*c,fr=48*c;return this.int16[Vt+0]=m,this.int16[Vt+1]=x,this.uint16[Vt+2]=E,this.uint16[Vt+3]=A,this.uint32[jt+2]=I,this.uint32[jt+3]=D,this.uint32[jt+4]=N,this.uint16[Vt+10]=j,this.uint16[Vt+11]=X,this.uint16[Vt+12]=ee,this.float32[jt+7]=R,this.float32[jt+8]=Ce,this.uint8[fr+36]=Oe,this.uint8[fr+37]=Qe,this.uint8[fr+38]=He,this.uint32[jt+10]=xt,this.int16[Vt+22]=It,c},u}(ea);tu.prototype.bytesPerElement=48,vn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",tu);var jf=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,x,E,A,I,D,N,j,X,ee,R,Ce,Oe,Qe,He,xt,It,Vt,jt,fr,Lr,Gr,Dn,sn,zn,cn,Ei){var Qn=this.length;return this.resize(Qn+1),this.emplace(Qn,c,m,x,E,A,I,D,N,j,X,ee,R,Ce,Oe,Qe,He,xt,It,Vt,jt,fr,Lr,Gr,Dn,sn,zn,cn,Ei)},u.prototype.emplace=function(c,m,x,E,A,I,D,N,j,X,ee,R,Ce,Oe,Qe,He,xt,It,Vt,jt,fr,Lr,Gr,Dn,sn,zn,cn,Ei,Qn){var Tn=34*c,Ii=17*c;return this.int16[Tn+0]=m,this.int16[Tn+1]=x,this.int16[Tn+2]=E,this.int16[Tn+3]=A,this.int16[Tn+4]=I,this.int16[Tn+5]=D,this.int16[Tn+6]=N,this.int16[Tn+7]=j,this.uint16[Tn+8]=X,this.uint16[Tn+9]=ee,this.uint16[Tn+10]=R,this.uint16[Tn+11]=Ce,this.uint16[Tn+12]=Oe,this.uint16[Tn+13]=Qe,this.uint16[Tn+14]=He,this.uint16[Tn+15]=xt,this.uint16[Tn+16]=It,this.uint16[Tn+17]=Vt,this.uint16[Tn+18]=jt,this.uint16[Tn+19]=fr,this.uint16[Tn+20]=Lr,this.uint16[Tn+21]=Gr,this.uint16[Tn+22]=Dn,this.uint32[Ii+12]=sn,this.float32[Ii+13]=zn,this.float32[Ii+14]=cn,this.float32[Ii+15]=Ei,this.float32[Ii+16]=Qn,c},u}(ea);jf.prototype.bytesPerElement=68,vn("StructArrayLayout8i15ui1ul4f68",jf);var Ol=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c){var m=this.length;return this.resize(m+1),this.emplace(m,c)},u.prototype.emplace=function(c,m){return this.float32[1*c+0]=m,c},u}(ea);Ol.prototype.bytesPerElement=4,vn("StructArrayLayout1f4",Ol);var ru=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,x){var E=this.length;return this.resize(E+1),this.emplace(E,c,m,x)},u.prototype.emplace=function(c,m,x,E){var A=3*c;return this.int16[A+0]=m,this.int16[A+1]=x,this.int16[A+2]=E,c},u}(ea);ru.prototype.bytesPerElement=6,vn("StructArrayLayout3i6",ru);var Dl=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,x){var E=this.length;return this.resize(E+1),this.emplace(E,c,m,x)},u.prototype.emplace=function(c,m,x,E){var A=4*c;return this.uint32[2*c+0]=m,this.uint16[A+2]=x,this.uint16[A+3]=E,c},u}(ea);Dl.prototype.bytesPerElement=8,vn("StructArrayLayout1ul2ui8",Dl);var ff=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m){var x=this.length;return this.resize(x+1),this.emplace(x,c,m)},u.prototype.emplace=function(c,m,x){var E=2*c;return this.uint16[E+0]=m,this.uint16[E+1]=x,c},u}(ea);ff.prototype.bytesPerElement=4,vn("StructArrayLayout2ui4",ff);var Rh=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c){var m=this.length;return this.resize(m+1),this.emplace(m,c)},u.prototype.emplace=function(c,m){return this.uint16[1*c+0]=m,c},u}(ea);Rh.prototype.bytesPerElement=2,vn("StructArrayLayout1ui2",Rh);var Hf=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,x,E){var A=this.length;return this.resize(A+1),this.emplace(A,c,m,x,E)},u.prototype.emplace=function(c,m,x,E,A){var I=4*c;return this.float32[I+0]=m,this.float32[I+1]=x,this.float32[I+2]=E,this.float32[I+3]=A,c},u}(ea);Hf.prototype.bytesPerElement=16,vn("StructArrayLayout4f16",Hf);var h=function(a){function u(){a.apply(this,arguments)}a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u;var c={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return c.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},c.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},c.x1.get=function(){return this._structArray.int16[this._pos2+2]},c.y1.get=function(){return this._structArray.int16[this._pos2+3]},c.x2.get=function(){return this._structArray.int16[this._pos2+4]},c.y2.get=function(){return this._structArray.int16[this._pos2+5]},c.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},c.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},c.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},c.anchorPoint.get=function(){return new ae(this.anchorPointX,this.anchorPointY)},Object.defineProperties(u.prototype,c),u}(kc);h.prototype.size=20;var d=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.get=function(c){return new h(this,c)},u}(Vf);vn("CollisionBoxArray",d);var p=function(a){function u(){a.apply(this,arguments)}a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u;var c={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return c.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},c.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},c.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},c.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},c.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},c.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},c.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},c.segment.get=function(){return this._structArray.uint16[this._pos2+10]},c.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},c.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},c.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},c.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},c.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},c.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},c.placedOrientation.set=function(m){this._structArray.uint8[this._pos1+37]=m},c.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},c.hidden.set=function(m){this._structArray.uint8[this._pos1+38]=m},c.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},c.crossTileID.set=function(m){this._structArray.uint32[this._pos4+10]=m},c.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(u.prototype,c),u}(kc);p.prototype.size=48;var g=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.get=function(c){return new p(this,c)},u}(tu);vn("PlacedSymbolArray",g);var S=function(a){function u(){a.apply(this,arguments)}a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u;var c={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return c.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},c.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},c.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},c.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},c.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},c.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},c.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},c.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},c.key.get=function(){return this._structArray.uint16[this._pos2+8]},c.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},c.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},c.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},c.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},c.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},c.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},c.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},c.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},c.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},c.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},c.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},c.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},c.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},c.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},c.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},c.crossTileID.set=function(m){this._structArray.uint32[this._pos4+12]=m},c.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},c.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},c.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},c.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(u.prototype,c),u}(kc);S.prototype.size=68;var w=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.get=function(c){return new S(this,c)},u}(jf);vn("SymbolInstanceArray",w);var C=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.getoffsetX=function(c){return this.float32[1*c+0]},u}(Ol);vn("GlyphOffsetArray",C);var P=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.getx=function(c){return this.int16[3*c+0]},u.prototype.gety=function(c){return this.int16[3*c+1]},u.prototype.gettileUnitDistanceFromAnchor=function(c){return this.int16[3*c+2]},u}(ru);vn("SymbolLineVertexArray",P);var Z=function(a){function u(){a.apply(this,arguments)}a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u;var c={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return c.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},c.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},c.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(u.prototype,c),u}(kc);Z.prototype.size=8;var Y=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.get=function(c){return new Z(this,c)},u}(Dl);vn("FeatureIndexArray",Y);var ce=To([{name:"a_pos",components:2,type:"Int16"}],4).members,ge=function(a){a===void 0&&(a=[]),this.segments=a};function _e(a,u){return 256*(a=Dt(Math.floor(a),0,255))+Dt(Math.floor(u),0,255)}ge.prototype.prepareSegment=function(a,u,c,m){var x=this.segments[this.segments.length-1];return a>ge.MAX_VERTEX_ARRAY_LENGTH&&ft("Max vertices per segment is "+ge.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+a),(!x||x.vertexLength+a>ge.MAX_VERTEX_ARRAY_LENGTH||x.sortKey!==m)&&(x={vertexOffset:u.length,primitiveOffset:c.length,vertexLength:0,primitiveLength:0},m!==void 0&&(x.sortKey=m),this.segments.push(x)),x},ge.prototype.get=function(){return this.segments},ge.prototype.destroy=function(){for(var a=0,u=this.segments;a<u.length;a+=1){var c=u[a];for(var m in c.vaos)c.vaos[m].destroy()}},ge.simpleSegment=function(a,u,c,m){return new ge([{vertexOffset:a,primitiveOffset:u,vertexLength:c,primitiveLength:m,vaos:{},sortKey:0}])},ge.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,vn("SegmentVector",ge);var Fe=To([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Pe=le(function(a){a.exports=function(u,c){var m,x,E,A,I,D,N,j;for(x=u.length-(m=3&u.length),E=c,I=3432918353,D=461845907,j=0;j<x;)N=255&u.charCodeAt(j)|(255&u.charCodeAt(++j))<<8|(255&u.charCodeAt(++j))<<16|(255&u.charCodeAt(++j))<<24,++j,E=27492+(65535&(A=5*(65535&(E=(E^=N=(65535&(N=(N=(65535&N)*I+(((N>>>16)*I&65535)<<16)&4294967295)<<15|N>>>17))*D+(((N>>>16)*D&65535)<<16)&4294967295)<<13|E>>>19))+((5*(E>>>16)&65535)<<16)&4294967295))+((58964+(A>>>16)&65535)<<16);switch(N=0,m){case 3:N^=(255&u.charCodeAt(j+2))<<16;case 2:N^=(255&u.charCodeAt(j+1))<<8;case 1:E^=N=(65535&(N=(N=(65535&(N^=255&u.charCodeAt(j)))*I+(((N>>>16)*I&65535)<<16)&4294967295)<<15|N>>>17))*D+(((N>>>16)*D&65535)<<16)&4294967295}return E^=u.length,E=2246822507*(65535&(E^=E>>>16))+((2246822507*(E>>>16)&65535)<<16)&4294967295,E=3266489909*(65535&(E^=E>>>13))+((3266489909*(E>>>16)&65535)<<16)&4294967295,(E^=E>>>16)>>>0}}),Xe=le(function(a){a.exports=function(u,c){for(var m,x=u.length,E=c^x,A=0;x>=4;)m=1540483477*(65535&(m=255&u.charCodeAt(A)|(255&u.charCodeAt(++A))<<8|(255&u.charCodeAt(++A))<<16|(255&u.charCodeAt(++A))<<24))+((1540483477*(m>>>16)&65535)<<16),E=1540483477*(65535&E)+((1540483477*(E>>>16)&65535)<<16)^(m=1540483477*(65535&(m^=m>>>24))+((1540483477*(m>>>16)&65535)<<16)),x-=4,++A;switch(x){case 3:E^=(255&u.charCodeAt(A+2))<<16;case 2:E^=(255&u.charCodeAt(A+1))<<8;case 1:E=1540483477*(65535&(E^=255&u.charCodeAt(A)))+((1540483477*(E>>>16)&65535)<<16)}return E=1540483477*(65535&(E^=E>>>13))+((1540483477*(E>>>16)&65535)<<16),(E^=E>>>15)>>>0}}),we=Pe,Ge=Xe;we.murmur3=Pe,we.murmur2=Ge;var ct=function(){this.ids=[],this.positions=[],this.indexed=!1};ct.prototype.add=function(a,u,c,m){this.ids.push($t(a)),this.positions.push(u,c,m)},ct.prototype.getPositions=function(a){for(var u=$t(a),c=0,m=this.ids.length-1;c<m;){var x=c+m>>1;this.ids[x]>=u?m=x:c=x+1}for(var E=[];this.ids[c]===u;)E.push({index:this.positions[3*c],start:this.positions[3*c+1],end:this.positions[3*c+2]}),c++;return E},ct.serialize=function(a,u){var c=new Float64Array(a.ids),m=new Uint32Array(a.positions);return function x(E,A,I,D){for(;I<D;){for(var N=E[I+D>>1],j=I-1,X=D+1;;){do j++;while(E[j]<N);do X--;while(E[X]>N);if(j>=X)break;Nt(E,j,X),Nt(A,3*j,3*X),Nt(A,3*j+1,3*X+1),Nt(A,3*j+2,3*X+2)}X-I<D-X?(x(E,A,I,X),I=X+1):(x(E,A,X+1,D),D=X)}}(c,m,0,c.length-1),u&&u.push(c.buffer,m.buffer),{ids:c,positions:m}},ct.deserialize=function(a){var u=new ct;return u.ids=a.ids,u.positions=a.positions,u.indexed=!0,u};var At=Math.pow(2,53)-1;function $t(a){var u=+a;return!isNaN(u)&&u<=At?u:we(String(a))}function Nt(a,u,c){var m=a[u];a[u]=a[c],a[c]=m}vn("FeaturePositionMap",ct);var tr=function(a,u){this.gl=a.gl,this.location=u},mr=function(a){function u(c,m){a.call(this,c,m),this.current=0}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.set=function(c){this.current!==c&&(this.current=c,this.gl.uniform1i(this.location,c))},u}(tr),Nr=function(a){function u(c,m){a.call(this,c,m),this.current=0}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.set=function(c){this.current!==c&&(this.current=c,this.gl.uniform1f(this.location,c))},u}(tr),Fr=function(a){function u(c,m){a.call(this,c,m),this.current=[0,0]}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.set=function(c){c[0]===this.current[0]&&c[1]===this.current[1]||(this.current=c,this.gl.uniform2f(this.location,c[0],c[1]))},u}(tr),an=function(a){function u(c,m){a.call(this,c,m),this.current=[0,0,0]}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.set=function(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]||(this.current=c,this.gl.uniform3f(this.location,c[0],c[1],c[2]))},u}(tr),In=function(a){function u(c,m){a.call(this,c,m),this.current=[0,0,0,0]}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.set=function(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]&&c[3]===this.current[3]||(this.current=c,this.gl.uniform4f(this.location,c[0],c[1],c[2],c[3]))},u}(tr),Nn=function(a){function u(c,m){a.call(this,c,m),this.current=Ti.transparent}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.set=function(c){c.r===this.current.r&&c.g===this.current.g&&c.b===this.current.b&&c.a===this.current.a||(this.current=c,this.gl.uniform4f(this.location,c.r,c.g,c.b,c.a))},u}(tr),Un=new Float32Array(16),ji=function(a){function u(c,m){a.call(this,c,m),this.current=Un}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.set=function(c){if(c[12]!==this.current[12]||c[0]!==this.current[0])return this.current=c,void this.gl.uniformMatrix4fv(this.location,!1,c);for(var m=1;m<16;m++)if(c[m]!==this.current[m]){this.current=c,this.gl.uniformMatrix4fv(this.location,!1,c);break}},u}(tr);function hn(a){return[_e(255*a.r,255*a.g),_e(255*a.b,255*a.a)]}var Kn=function(a,u,c){this.value=a,this.uniformNames=u.map(function(m){return"u_"+m}),this.type=c};Kn.prototype.setUniform=function(a,u,c){a.set(c.constantOr(this.value))},Kn.prototype.getBinding=function(a,u,c){return this.type==="color"?new Nn(a,u):new Nr(a,u)};var _i=function(a,u){this.uniformNames=u.map(function(c){return"u_"+c}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};_i.prototype.setConstantPatternPositions=function(a,u){this.pixelRatioFrom=u.pixelRatio,this.pixelRatioTo=a.pixelRatio,this.patternFrom=u.tlbr,this.patternTo=a.tlbr},_i.prototype.setUniform=function(a,u,c,m){var x=m==="u_pattern_to"?this.patternTo:m==="u_pattern_from"?this.patternFrom:m==="u_pixel_ratio_to"?this.pixelRatioTo:m==="u_pixel_ratio_from"?this.pixelRatioFrom:null;x&&a.set(x)},_i.prototype.getBinding=function(a,u,c){return c.substr(0,9)==="u_pattern"?new In(a,u):new Nr(a,u)};var ti=function(a,u,c,m){this.expression=a,this.type=c,this.maxValue=0,this.paintVertexAttributes=u.map(function(x){return{name:"a_"+x,type:"Float32",components:c==="color"?2:1,offset:0}}),this.paintVertexArray=new m};ti.prototype.populatePaintArray=function(a,u,c,m,x){var E=this.paintVertexArray.length,A=this.expression.evaluate(new B(0),u,{},m,[],x);this.paintVertexArray.resize(a),this._setPaintValue(E,a,A)},ti.prototype.updatePaintArray=function(a,u,c,m){var x=this.expression.evaluate({zoom:0},c,m);this._setPaintValue(a,u,x)},ti.prototype._setPaintValue=function(a,u,c){if(this.type==="color")for(var m=hn(c),x=a;x<u;x++)this.paintVertexArray.emplace(x,m[0],m[1]);else{for(var E=a;E<u;E++)this.paintVertexArray.emplace(E,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}},ti.prototype.upload=function(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},ti.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Xn=function(a,u,c,m,x,E){this.expression=a,this.uniformNames=u.map(function(A){return"u_"+A+"_t"}),this.type=c,this.useIntegerZoom=m,this.zoom=x,this.maxValue=0,this.paintVertexAttributes=u.map(function(A){return{name:"a_"+A,type:"Float32",components:c==="color"?4:2,offset:0}}),this.paintVertexArray=new E};Xn.prototype.populatePaintArray=function(a,u,c,m,x){var E=this.expression.evaluate(new B(this.zoom),u,{},m,[],x),A=this.expression.evaluate(new B(this.zoom+1),u,{},m,[],x),I=this.paintVertexArray.length;this.paintVertexArray.resize(a),this._setPaintValue(I,a,E,A)},Xn.prototype.updatePaintArray=function(a,u,c,m){var x=this.expression.evaluate({zoom:this.zoom},c,m),E=this.expression.evaluate({zoom:this.zoom+1},c,m);this._setPaintValue(a,u,x,E)},Xn.prototype._setPaintValue=function(a,u,c,m){if(this.type==="color")for(var x=hn(c),E=hn(m),A=a;A<u;A++)this.paintVertexArray.emplace(A,x[0],x[1],E[0],E[1]);else{for(var I=a;I<u;I++)this.paintVertexArray.emplace(I,c,m);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(m))}},Xn.prototype.upload=function(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Xn.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Xn.prototype.setUniform=function(a,u){var c=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,m=Dt(this.expression.interpolationFactor(c,this.zoom,this.zoom+1),0,1);a.set(m)},Xn.prototype.getBinding=function(a,u,c){return new Nr(a,u)};var pi=function(a,u,c,m,x,E){this.expression=a,this.type=u,this.useIntegerZoom=c,this.zoom=m,this.layerId=E,this.zoomInPaintVertexArray=new x,this.zoomOutPaintVertexArray=new x};pi.prototype.populatePaintArray=function(a,u,c){var m=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(a),this.zoomOutPaintVertexArray.resize(a),this._setPaintValues(m,a,u.patterns&&u.patterns[this.layerId],c)},pi.prototype.updatePaintArray=function(a,u,c,m,x){this._setPaintValues(a,u,c.patterns&&c.patterns[this.layerId],x)},pi.prototype._setPaintValues=function(a,u,c,m){if(m&&c){var x=m[c.min],E=m[c.mid],A=m[c.max];if(x&&E&&A)for(var I=a;I<u;I++)this.zoomInPaintVertexArray.emplace(I,E.tl[0],E.tl[1],E.br[0],E.br[1],x.tl[0],x.tl[1],x.br[0],x.br[1],E.pixelRatio,x.pixelRatio),this.zoomOutPaintVertexArray.emplace(I,E.tl[0],E.tl[1],E.br[0],E.br[1],A.tl[0],A.tl[1],A.br[0],A.br[1],E.pixelRatio,A.pixelRatio)}},pi.prototype.upload=function(a){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=a.createVertexBuffer(this.zoomInPaintVertexArray,Fe.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=a.createVertexBuffer(this.zoomOutPaintVertexArray,Fe.members,this.expression.isStateDependent))},pi.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var qn=function(a,u,c){this.binders={},this._buffers=[];var m=[];for(var x in a.paint._values)if(c(x)){var E=a.paint.get(x);if(E instanceof Da&&rl(E.property.specification)){var A=wo(x,a.type),I=E.value,D=E.property.specification.type,N=E.property.useIntegerZoom,j=E.property.specification["property-type"],X=j==="cross-faded"||j==="cross-faded-data-driven";if(I.kind==="constant")this.binders[x]=X?new _i(I.value,A):new Kn(I.value,A,D),m.push("/u_"+x);else if(I.kind==="source"||X){var ee=Na(x,D,"source");this.binders[x]=X?new pi(I,D,N,u,ee,a.id):new ti(I,A,D,ee),m.push("/a_"+x)}else{var R=Na(x,D,"composite");this.binders[x]=new Xn(I,A,D,N,u,R),m.push("/z_"+x)}}}this.cacheKey=m.sort().join("")};qn.prototype.getMaxValue=function(a){var u=this.binders[a];return u instanceof ti||u instanceof Xn?u.maxValue:0},qn.prototype.populatePaintArrays=function(a,u,c,m,x){for(var E in this.binders){var A=this.binders[E];(A instanceof ti||A instanceof Xn||A instanceof pi)&&A.populatePaintArray(a,u,c,m,x)}},qn.prototype.setConstantPatternPositions=function(a,u){for(var c in this.binders){var m=this.binders[c];m instanceof _i&&m.setConstantPatternPositions(a,u)}},qn.prototype.updatePaintArrays=function(a,u,c,m,x){var E=!1;for(var A in a)for(var I=0,D=u.getPositions(A);I<D.length;I+=1){var N=D[I],j=c.feature(N.index);for(var X in this.binders){var ee=this.binders[X];if((ee instanceof ti||ee instanceof Xn||ee instanceof pi)&&ee.expression.isStateDependent===!0){var R=m.paint.get(X);ee.expression=R.value,ee.updatePaintArray(N.start,N.end,j,a[A],x),E=!0}}}return E},qn.prototype.defines=function(){var a=[];for(var u in this.binders){var c=this.binders[u];(c instanceof Kn||c instanceof _i)&&a.push.apply(a,c.uniformNames.map(function(m){return"#define HAS_UNIFORM_"+m}))}return a},qn.prototype.getBinderAttributes=function(){var a=[];for(var u in this.binders){var c=this.binders[u];if(c instanceof ti||c instanceof Xn)for(var m=0;m<c.paintVertexAttributes.length;m++)a.push(c.paintVertexAttributes[m].name);else if(c instanceof pi)for(var x=0;x<Fe.members.length;x++)a.push(Fe.members[x].name)}return a},qn.prototype.getBinderUniforms=function(){var a=[];for(var u in this.binders){var c=this.binders[u];if(c instanceof Kn||c instanceof _i||c instanceof Xn)for(var m=0,x=c.uniformNames;m<x.length;m+=1)a.push(x[m])}return a},qn.prototype.getPaintVertexBuffers=function(){return this._buffers},qn.prototype.getUniforms=function(a,u){var c=[];for(var m in this.binders){var x=this.binders[m];if(x instanceof Kn||x instanceof _i||x instanceof Xn)for(var E=0,A=x.uniformNames;E<A.length;E+=1){var I=A[E];if(u[I]){var D=x.getBinding(a,u[I],I);c.push({name:I,property:m,binding:D})}}}return c},qn.prototype.setUniforms=function(a,u,c,m){for(var x=0,E=u;x<E.length;x+=1){var A=E[x],I=A.name,D=A.property;this.binders[D].setUniform(A.binding,m,c.get(D),I)}},qn.prototype.updatePaintBuffers=function(a){for(var u in this._buffers=[],this.binders){var c=this.binders[u];if(a&&c instanceof pi){var m=a.fromScale===2?c.zoomInPaintVertexBuffer:c.zoomOutPaintVertexBuffer;m&&this._buffers.push(m)}else(c instanceof ti||c instanceof Xn)&&c.paintVertexBuffer&&this._buffers.push(c.paintVertexBuffer)}},qn.prototype.upload=function(a){for(var u in this.binders){var c=this.binders[u];(c instanceof ti||c instanceof Xn||c instanceof pi)&&c.upload(a)}this.updatePaintBuffers()},qn.prototype.destroy=function(){for(var a in this.binders){var u=this.binders[a];(u instanceof ti||u instanceof Xn||u instanceof pi)&&u.destroy()}};var $n=function(a,u,c){c===void 0&&(c=function(){return!0}),this.programConfigurations={};for(var m=0,x=a;m<x.length;m+=1){var E=x[m];this.programConfigurations[E.id]=new qn(E,u,c)}this.needsUpload=!1,this._featureMap=new ct,this._bufferOffset=0};function wo(a,u){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[a]||[a.replace(u+"-","").replace(/-/g,"_")]}function Na(a,u,c){var m={color:{source:ic,composite:Hf},number:{source:Ol,composite:ic}},x=function(E){return{"line-pattern":{source:Nu,composite:Nu},"fill-pattern":{source:Nu,composite:Nu},"fill-extrusion-pattern":{source:Nu,composite:Nu}}[E]}(a);return x&&x[c]||m[u][c]}$n.prototype.populatePaintArrays=function(a,u,c,m,x,E){for(var A in this.programConfigurations)this.programConfigurations[A].populatePaintArrays(a,u,m,x,E);u.id!==void 0&&this._featureMap.add(u.id,c,this._bufferOffset,a),this._bufferOffset=a,this.needsUpload=!0},$n.prototype.updatePaintArrays=function(a,u,c,m){for(var x=0,E=c;x<E.length;x+=1){var A=E[x];this.needsUpload=this.programConfigurations[A.id].updatePaintArrays(a,this._featureMap,u,A,m)||this.needsUpload}},$n.prototype.get=function(a){return this.programConfigurations[a]},$n.prototype.upload=function(a){if(this.needsUpload){for(var u in this.programConfigurations)this.programConfigurations[u].upload(a);this.needsUpload=!1}},$n.prototype.destroy=function(){for(var a in this.programConfigurations)this.programConfigurations[a].destroy()},vn("ConstantBinder",Kn),vn("CrossFadedConstantBinder",_i),vn("SourceExpressionBinder",ti),vn("CrossFadedCompositeBinder",pi),vn("CompositeExpressionBinder",Xn),vn("ProgramConfiguration",qn,{omit:["_buffers"]}),vn("ProgramConfigurationSet",$n);var Co=Math.pow(2,14)-1,Lo=-Co-1;function Wa(a){for(var u=8192/a.extent,c=a.loadGeometry(),m=0;m<c.length;m++)for(var x=c[m],E=0;E<x.length;E++){var A=x[E],I=Math.round(A.x*u),D=Math.round(A.y*u);A.x=Dt(I,Lo,Co),A.y=Dt(D,Lo,Co),(I<A.x||I>A.x+1||D<A.y||D>A.y+1)&&ft("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return c}function Ga(a,u){return{type:a.type,id:a.id,properties:a.properties,geometry:u?Wa(a):[]}}function Ss(a,u,c,m,x){a.emplaceBack(2*u+(m+1)/2,2*c+(x+1)/2)}var ls=function(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new Pl,this.indexArray=new zu,this.segments=new ge,this.programConfigurations=new $n(a.layers,a.zoom),this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};function Zu(a,u){for(var c=0;c<a.length;c++)if(iu(u,a[c]))return!0;for(var m=0;m<u.length;m++)if(iu(a,u[m]))return!0;return!!sl(a,u)}function cs(a,u,c){return!!iu(a,u)||!!ul(u,a,c)}function nu(a,u){if(a.length===1)return Vu(u,a[0]);for(var c=0;c<u.length;c++)for(var m=u[c],x=0;x<m.length;x++)if(iu(a,m[x]))return!0;for(var E=0;E<a.length;E++)if(Vu(u,a[E]))return!0;for(var A=0;A<u.length;A++)if(sl(a,u[A]))return!0;return!1}function Ns(a,u,c){if(a.length>1){if(sl(a,u))return!0;for(var m=0;m<u.length;m++)if(ul(u[m],a,c))return!0}for(var x=0;x<a.length;x++)if(ul(a[x],u,c))return!0;return!1}function sl(a,u){if(a.length===0||u.length===0)return!1;for(var c=0;c<a.length-1;c++)for(var m=a[c],x=a[c+1],E=0;E<u.length-1;E++)if(kl(m,x,u[E],u[E+1]))return!0;return!1}function kl(a,u,c,m){return qt(a,c,m)!==qt(u,c,m)&&qt(a,u,c)!==qt(a,u,m)}function ul(a,u,c){var m=c*c;if(u.length===1)return a.distSqr(u[0])<m;for(var x=1;x<u.length;x++)if(Fl(a,u[x-1],u[x])<m)return!0;return!1}function Fl(a,u,c){var m=u.distSqr(c);if(m===0)return a.distSqr(u);var x=((a.x-u.x)*(c.x-u.x)+(a.y-u.y)*(c.y-u.y))/m;return a.distSqr(x<0?u:x>1?c:c.sub(u)._mult(x)._add(u))}function Vu(a,u){for(var c,m,x,E=!1,A=0;A<a.length;A++)for(var I=0,D=(c=a[A]).length-1;I<c.length;D=I++)(m=c[I]).y>u.y!=(x=c[D]).y>u.y&&u.x<(x.x-m.x)*(u.y-m.y)/(x.y-m.y)+m.x&&(E=!E);return E}function iu(a,u){for(var c=!1,m=0,x=a.length-1;m<a.length;x=m++){var E=a[m],A=a[x];E.y>u.y!=A.y>u.y&&u.x<(A.x-E.x)*(u.y-E.y)/(A.y-E.y)+E.x&&(c=!c)}return c}function ju(a,u,c){var m=c[0],x=c[2];if(a.x<m.x&&u.x<m.x||a.x>x.x&&u.x>x.x||a.y<m.y&&u.y<m.y||a.y>x.y&&u.y>x.y)return!1;var E=qt(a,u,c[0]);return E!==qt(a,u,c[1])||E!==qt(a,u,c[2])||E!==qt(a,u,c[3])}function Ko(a,u,c){var m=u.paint.get(a).value;return m.kind==="constant"?m.value:c.programConfigurations.get(u.id).getMaxValue(a)}function Ka(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function As(a,u,c,m,x){if(!u[0]&&!u[1])return a;var E=ae.convert(u)._mult(x);c==="viewport"&&E._rotate(-m);for(var A=[],I=0;I<a.length;I++)A.push(a[I].sub(E));return A}ls.prototype.populate=function(a,u,c){var m=this.layers[0],x=[],E=null;m.type==="circle"&&(E=m.layout.get("circle-sort-key"));for(var A=0,I=a;A<I.length;A+=1){var D=I[A],N=D.feature,j=D.id,X=D.index,ee=D.sourceLayerIndex,R=this.layers[0]._featureFilter.needGeometry,Ce=Ga(N,R);if(this.layers[0]._featureFilter.filter(new B(this.zoom),Ce,c)){var Oe=E?E.evaluate(Ce,{},c):void 0,Qe={id:j,properties:N.properties,type:N.type,sourceLayerIndex:ee,index:X,geometry:R?Ce.geometry:Wa(N),patterns:{},sortKey:Oe};x.push(Qe)}}E&&x.sort(function(Gr,Dn){return Gr.sortKey-Dn.sortKey});for(var He=0,xt=x;He<xt.length;He+=1){var It=xt[He],Vt=It.geometry,jt=It.index,fr=It.sourceLayerIndex,Lr=a[jt].feature;this.addFeature(It,Vt,jt,c),u.featureIndex.insert(Lr,Vt,jt,fr,this.index)}},ls.prototype.update=function(a,u,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,u,this.stateDependentLayers,c)},ls.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},ls.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ls.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,ce),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},ls.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},ls.prototype.addFeature=function(a,u,c,m){for(var x=0,E=u;x<E.length;x+=1)for(var A=0,I=E[x];A<I.length;A+=1){var D=I[A],N=D.x,j=D.y;if(!(N<0||N>=8192||j<0||j>=8192)){var X=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,a.sortKey),ee=X.vertexLength;Ss(this.layoutVertexArray,N,j,-1,-1),Ss(this.layoutVertexArray,N,j,1,-1),Ss(this.layoutVertexArray,N,j,1,1),Ss(this.layoutVertexArray,N,j,-1,1),this.indexArray.emplaceBack(ee,ee+1,ee+2),this.indexArray.emplaceBack(ee,ee+3,ee+2),X.vertexLength+=4,X.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,c,{},m)},vn("CircleBucket",ls,{omit:["layers"]});var au=new ka({"circle-sort-key":new gn(V.layout_circle["circle-sort-key"])}),Hu={paint:new ka({"circle-radius":new gn(V.paint_circle["circle-radius"]),"circle-color":new gn(V.paint_circle["circle-color"]),"circle-blur":new gn(V.paint_circle["circle-blur"]),"circle-opacity":new gn(V.paint_circle["circle-opacity"]),"circle-translate":new On(V.paint_circle["circle-translate"]),"circle-translate-anchor":new On(V.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new On(V.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new On(V.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new gn(V.paint_circle["circle-stroke-width"]),"circle-stroke-color":new gn(V.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new gn(V.paint_circle["circle-stroke-opacity"])}),layout:au},Ni=typeof Float32Array!="undefined"?Float32Array:Array;function po(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function io(a,u,c){var m=u[0],x=u[1],E=u[2],A=u[3],I=u[4],D=u[5],N=u[6],j=u[7],X=u[8],ee=u[9],R=u[10],Ce=u[11],Oe=u[12],Qe=u[13],He=u[14],xt=u[15],It=c[0],Vt=c[1],jt=c[2],fr=c[3];return a[0]=It*m+Vt*I+jt*X+fr*Oe,a[1]=It*x+Vt*D+jt*ee+fr*Qe,a[2]=It*E+Vt*N+jt*R+fr*He,a[3]=It*A+Vt*j+jt*Ce+fr*xt,a[4]=(It=c[4])*m+(Vt=c[5])*I+(jt=c[6])*X+(fr=c[7])*Oe,a[5]=It*x+Vt*D+jt*ee+fr*Qe,a[6]=It*E+Vt*N+jt*R+fr*He,a[7]=It*A+Vt*j+jt*Ce+fr*xt,a[8]=(It=c[8])*m+(Vt=c[9])*I+(jt=c[10])*X+(fr=c[11])*Oe,a[9]=It*x+Vt*D+jt*ee+fr*Qe,a[10]=It*E+Vt*N+jt*R+fr*He,a[11]=It*A+Vt*j+jt*Ce+fr*xt,a[12]=(It=c[12])*m+(Vt=c[13])*I+(jt=c[14])*X+(fr=c[15])*Oe,a[13]=It*x+Vt*D+jt*ee+fr*Qe,a[14]=It*E+Vt*N+jt*R+fr*He,a[15]=It*A+Vt*j+jt*Ce+fr*xt,a}Math.hypot||(Math.hypot=function(){for(var a=arguments,u=0,c=arguments.length;c--;)u+=a[c]*a[c];return Math.sqrt(u)});var ou,Bc=io;function Bl(a,u,c){var m=u[0],x=u[1],E=u[2],A=u[3];return a[0]=c[0]*m+c[4]*x+c[8]*E+c[12]*A,a[1]=c[1]*m+c[5]*x+c[9]*E+c[13]*A,a[2]=c[2]*m+c[6]*x+c[10]*E+c[14]*A,a[3]=c[3]*m+c[7]*x+c[11]*E+c[15]*A,a}ou=new Ni(3),Ni!=Float32Array&&(ou[0]=0,ou[1]=0,ou[2]=0),function(){var a=new Ni(4);Ni!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0,a[3]=0)}();var fs=(function(){var a=new Ni(2);Ni!=Float32Array&&(a[0]=0,a[1]=0)}(),function(a){function u(c){a.call(this,c,Hu)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.createBucket=function(c){return new ls(c)},u.prototype.queryRadius=function(c){var m=c;return Ko("circle-radius",this,m)+Ko("circle-stroke-width",this,m)+Ka(this.paint.get("circle-translate"))},u.prototype.queryIntersectsFeature=function(c,m,x,E,A,I,D,N){for(var j=As(c,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),I.angle,D),X=this.paint.get("circle-radius").evaluate(m,x)+this.paint.get("circle-stroke-width").evaluate(m,x),ee=this.paint.get("circle-pitch-alignment")==="map",R=ee?j:function(Lr,Gr){return Lr.map(function(Dn){return Or(Dn,Gr)})}(j,N),Ce=ee?X*D:X,Oe=0,Qe=E;Oe<Qe.length;Oe+=1)for(var He=0,xt=Qe[Oe];He<xt.length;He+=1){var It=xt[He],Vt=ee?It:Or(It,N),jt=Ce,fr=Bl([],[It.x,It.y,0,1],N);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?jt*=fr[3]/I.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(jt*=I.cameraToCenterDistance/fr[3]),cs(R,Vt,jt))return!0}return!1},u}(Ls));function Or(a,u){var c=Bl([],[a.x,a.y,0,1],u);return new ae(c[0]/c[3],c[1]/c[3])}var Wu=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u}(ls);function Gu(a,u,c,m){var x=u.width,E=u.height;if(m){if(m instanceof Uint8ClampedArray)m=new Uint8Array(m.buffer);else if(m.length!==x*E*c)throw new RangeError("mismatched image size")}else m=new Uint8Array(x*E*c);return a.width=x,a.height=E,a.data=m,a}function ao(a,u,c){var m=u.width,x=u.height;if(m!==a.width||x!==a.height){var E=Gu({},{width:m,height:x},c);Ll(a,E,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,m),height:Math.min(a.height,x)},c),a.width=m,a.height=x,a.data=E.data}}function Ll(a,u,c,m,x,E){if(x.width===0||x.height===0)return u;if(x.width>a.width||x.height>a.height||c.x>a.width-x.width||c.y>a.height-x.height)throw new RangeError("out of range source coordinates for image copy");if(x.width>u.width||x.height>u.height||m.x>u.width-x.width||m.y>u.height-x.height)throw new RangeError("out of range destination coordinates for image copy");for(var A=a.data,I=u.data,D=0;D<x.height;D++)for(var N=((c.y+D)*a.width+c.x)*E,j=((m.y+D)*u.width+m.x)*E,X=0;X<x.width*E;X++)I[j+X]=A[N+X];return u}vn("HeatmapBucket",Wu,{omit:["layers"]});var _u=function(a,u){Gu(this,a,1,u)};_u.prototype.resize=function(a){ao(this,a,1)},_u.prototype.clone=function(){return new _u({width:this.width,height:this.height},new Uint8Array(this.data))},_u.copy=function(a,u,c,m,x){Ll(a,u,c,m,x,1)};var Qo=function(a,u){Gu(this,a,4,u)};Qo.prototype.resize=function(a){ao(this,a,4)},Qo.prototype.replace=function(a,u){u?this.data.set(a):this.data=a instanceof Uint8ClampedArray?new Uint8Array(a.buffer):a},Qo.prototype.clone=function(){return new Qo({width:this.width,height:this.height},new Uint8Array(this.data))},Qo.copy=function(a,u,c,m,x){Ll(a,u,c,m,x,4)},vn("AlphaImage",_u),vn("RGBAImage",Qo);var sc={paint:new ka({"heatmap-radius":new gn(V.paint_heatmap["heatmap-radius"]),"heatmap-weight":new gn(V.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new On(V.paint_heatmap["heatmap-intensity"]),"heatmap-color":new mu(V.paint_heatmap["heatmap-color"]),"heatmap-opacity":new On(V.paint_heatmap["heatmap-opacity"])})};function hf(a){var u={},c=a.resolution||256,m=a.clips?a.clips.length:1,x=a.image||new Qo({width:c,height:m}),E=function(Ce,Oe,Qe){u[a.evaluationKey]=Qe;var He=a.expression.evaluate(u);x.data[Ce+Oe+0]=Math.floor(255*He.r/He.a),x.data[Ce+Oe+1]=Math.floor(255*He.g/He.a),x.data[Ce+Oe+2]=Math.floor(255*He.b/He.a),x.data[Ce+Oe+3]=Math.floor(255*He.a)};if(a.clips)for(var A=0,I=0;A<m;++A,I+=4*c)for(var D=0,N=0;D<c;D++,N+=4){var j=D/(c-1),X=a.clips[A];E(I,N,X.start*(1-j)+X.end*j)}else for(var ee=0,R=0;ee<c;ee++,R+=4)E(0,R,ee/(c-1));return x}var Lc=function(a){function u(c){a.call(this,c,sc),this._updateColorRamp()}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.createBucket=function(c){return new Wu(c)},u.prototype._handleSpecialPaintPropertyUpdate=function(c){c==="heatmap-color"&&this._updateColorRamp()},u.prototype._updateColorRamp=function(){this.colorRamp=hf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},u.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},u.prototype.queryRadius=function(){return 0},u.prototype.queryIntersectsFeature=function(){return!1},u.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},u}(Ls),Km={paint:new ka({"hillshade-illumination-direction":new On(V.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new On(V.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new On(V.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new On(V.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new On(V.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new On(V.paint_hillshade["hillshade-accent-color"])})},Bv=function(a){function u(c){a.call(this,c,Km)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},u}(Ls),jp=To([{name:"a_pos",components:2,type:"Int16"}],4).members,pf=lp,Id=lp;function lp(a,u,c){c=c||2;var m,x,E,A,I,D,N,j=u&&u.length,X=j?u[0]*c:a.length,ee=Pd(a,0,X,c,!0),R=[];if(!ee||ee.next===ee.prev)return R;if(j&&(ee=function(Oe,Qe,He,xt){var It,Vt,jt,fr=[];for(It=0,Vt=Qe.length;It<Vt;It++)(jt=Pd(Oe,Qe[It]*xt,It<Vt-1?Qe[It+1]*xt:Oe.length,xt,!1))===jt.next&&(jt.steiner=!0),fr.push(cp(jt));for(fr.sort(Jm),It=0;It<fr.length;It++)kd(fr[It],He),He=Nc(He,He.next);return He}(a,u,ee,c)),a.length>80*c){m=E=a[0],x=A=a[1];for(var Ce=c;Ce<X;Ce+=c)(I=a[Ce])<m&&(m=I),(D=a[Ce+1])<x&&(x=D),I>E&&(E=I),D>A&&(A=D);N=(N=Math.max(E-m,A-x))!==0?1/N:0}return Mh(ee,R,c,m,x,N),R}function Pd(a,u,c,m,x){var E,A;if(x===_f(a,u,c,m)>0)for(E=u;E<c;E+=m)A=gf(E,a[E],a[E+1],A);else for(E=c-m;E>=u;E-=m)A=gf(E,a[E],a[E+1],A);return A&&uc(A,A.next)&&(ll(A),A=A.next),A}function Nc(a,u){if(!a)return a;u||(u=a);var c,m=a;do if(c=!1,m.steiner||!uc(m,m.next)&&oo(m.prev,m,m.next)!==0)m=m.next;else{if(ll(m),(m=u=m.prev)===m.next)break;c=!0}while(c||m!==u);return u}function Mh(a,u,c,m,x,E,A){if(a){!A&&E&&function(j,X,ee,R){var Ce=j;do Ce.z===null&&(Ce.z=Wf(Ce.x,Ce.y,X,ee,R)),Ce.prevZ=Ce.prev,Ce.nextZ=Ce.next,Ce=Ce.next;while(Ce!==j);Ce.prevZ.nextZ=null,Ce.prevZ=null,function(Oe){var Qe,He,xt,It,Vt,jt,fr,Lr,Gr=1;do{for(He=Oe,Oe=null,Vt=null,jt=0;He;){for(jt++,xt=He,fr=0,Qe=0;Qe<Gr&&(fr++,xt=xt.nextZ);Qe++);for(Lr=Gr;fr>0||Lr>0&&xt;)fr!==0&&(Lr===0||!xt||He.z<=xt.z)?(It=He,He=He.nextZ,fr--):(It=xt,xt=xt.nextZ,Lr--),Vt?Vt.nextZ=It:Oe=It,It.prevZ=Vt,Vt=It;He=xt}Vt.nextZ=null,Gr*=2}while(jt>1)}(Ce)}(a,m,x,E);for(var I,D,N=a;a.prev!==a.next;)if(I=a.prev,D=a.next,E?Qm(a,m,x,E):Od(a))u.push(I.i/c),u.push(a.i/c),u.push(D.i/c),ll(a),a=D.next,N=D.next;else if((a=D)===N){A?A===1?Mh(a=Hp(Nc(a),u,c),u,c,m,x,E,2):A===2&&Dd(a,u,c,m,x,E):Mh(Nc(a),u,c,m,x,E,1);break}}}function Od(a){var u=a.prev,c=a,m=a.next;if(oo(u,c,m)>=0)return!1;for(var x=a.next.next;x!==a.prev;){if(df(u.x,u.y,c.x,c.y,m.x,m.y,x.x,x.y)&&oo(x.prev,x,x.next)>=0)return!1;x=x.next}return!0}function Qm(a,u,c,m){var x=a.prev,E=a,A=a.next;if(oo(x,E,A)>=0)return!1;for(var I=x.x>E.x?x.x>A.x?x.x:A.x:E.x>A.x?E.x:A.x,D=x.y>E.y?x.y>A.y?x.y:A.y:E.y>A.y?E.y:A.y,N=Wf(x.x<E.x?x.x<A.x?x.x:A.x:E.x<A.x?E.x:A.x,x.y<E.y?x.y<A.y?x.y:A.y:E.y<A.y?E.y:A.y,u,c,m),j=Wf(I,D,u,c,m),X=a.prevZ,ee=a.nextZ;X&&X.z>=N&&ee&&ee.z<=j;){if(X!==a.prev&&X!==a.next&&df(x.x,x.y,E.x,E.y,A.x,A.y,X.x,X.y)&&oo(X.prev,X,X.next)>=0||(X=X.prevZ,ee!==a.prev&&ee!==a.next&&df(x.x,x.y,E.x,E.y,A.x,A.y,ee.x,ee.y)&&oo(ee.prev,ee,ee.next)>=0))return!1;ee=ee.nextZ}for(;X&&X.z>=N;){if(X!==a.prev&&X!==a.next&&df(x.x,x.y,E.x,E.y,A.x,A.y,X.x,X.y)&&oo(X.prev,X,X.next)>=0)return!1;X=X.prevZ}for(;ee&&ee.z<=j;){if(ee!==a.prev&&ee!==a.next&&df(x.x,x.y,E.x,E.y,A.x,A.y,ee.x,ee.y)&&oo(ee.prev,ee,ee.next)>=0)return!1;ee=ee.nextZ}return!0}function Hp(a,u,c){var m=a;do{var x=m.prev,E=m.next.next;!uc(x,E)&&hp(x,m,m.next,E)&&zc(x,E)&&zc(E,x)&&(u.push(x.i/c),u.push(m.i/c),u.push(E.i/c),ll(m),ll(m.next),m=a=E),m=m.next}while(m!==a);return Nc(m)}function Dd(a,u,c,m,x,E){var A=a;do{for(var I=A.next.next;I!==A.prev;){if(A.i!==I.i&&fp(A,I)){var D=Ih(A,I);return A=Nc(A,A.next),D=Nc(D,D.next),Mh(A,u,c,m,x,E),void Mh(D,u,c,m,x,E)}I=I.next}A=A.next}while(A!==a)}function Jm(a,u){return a.x-u.x}function kd(a,u){if(u=function(m,x){var E,A=x,I=m.x,D=m.y,N=-1/0;do{if(D<=A.y&&D>=A.next.y&&A.next.y!==A.y){var j=A.x+(D-A.y)*(A.next.x-A.x)/(A.next.y-A.y);if(j<=I&&j>N){if(N=j,j===I){if(D===A.y)return A;if(D===A.next.y)return A.next}E=A.x<A.next.x?A:A.next}}A=A.next}while(A!==x);if(!E)return null;if(I===N)return E;var X,ee=E,R=E.x,Ce=E.y,Oe=1/0;A=E;do I>=A.x&&A.x>=R&&I!==A.x&&df(D<Ce?I:N,D,R,Ce,D<Ce?N:I,D,A.x,A.y)&&(X=Math.abs(D-A.y)/(I-A.x),zc(A,m)&&(X<Oe||X===Oe&&(A.x>E.x||A.x===E.x&&Uc(E,A)))&&(E=A,Oe=X)),A=A.next;while(A!==ee);return E}(a,u)){var c=Ih(u,a);Nc(u,u.next),Nc(c,c.next)}}function Uc(a,u){return oo(a.prev,a,u.prev)<0&&oo(u.next,a,a.next)<0}function Wf(a,u,c,m,x){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=32767*(a-c)*x)|a<<8))|a<<4))|a<<2))|a<<1))|(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u=32767*(u-m)*x)|u<<8))|u<<4))|u<<2))|u<<1))<<1}function cp(a){var u=a,c=a;do(u.x<c.x||u.x===c.x&&u.y<c.y)&&(c=u),u=u.next;while(u!==a);return c}function df(a,u,c,m,x,E,A,I){return(x-A)*(u-I)-(a-A)*(E-I)>=0&&(a-A)*(m-I)-(c-A)*(u-I)>=0&&(c-A)*(E-I)-(x-A)*(m-I)>=0}function fp(a,u){return a.next.i!==u.i&&a.prev.i!==u.i&&!function(c,m){var x=c;do{if(x.i!==c.i&&x.next.i!==c.i&&x.i!==m.i&&x.next.i!==m.i&&hp(x,x.next,c,m))return!0;x=x.next}while(x!==c);return!1}(a,u)&&(zc(a,u)&&zc(u,a)&&function(c,m){var x=c,E=!1,A=(c.x+m.x)/2,I=(c.y+m.y)/2;do x.y>I!=x.next.y>I&&x.next.y!==x.y&&A<(x.next.x-x.x)*(I-x.y)/(x.next.y-x.y)+x.x&&(E=!E),x=x.next;while(x!==c);return E}(a,u)&&(oo(a.prev,a,u.prev)||oo(a,u.prev,u))||uc(a,u)&&oo(a.prev,a,a.next)>0&&oo(u.prev,u,u.next)>0)}function oo(a,u,c){return(u.y-a.y)*(c.x-u.x)-(u.x-a.x)*(c.y-u.y)}function uc(a,u){return a.x===u.x&&a.y===u.y}function hp(a,u,c,m){var x=mf(oo(a,u,c)),E=mf(oo(a,u,m)),A=mf(oo(c,m,a)),I=mf(oo(c,m,u));return x!==E&&A!==I||!(x!==0||!vf(a,c,u))||!(E!==0||!vf(a,m,u))||!(A!==0||!vf(c,a,m))||!(I!==0||!vf(c,u,m))}function vf(a,u,c){return u.x<=Math.max(a.x,c.x)&&u.x>=Math.min(a.x,c.x)&&u.y<=Math.max(a.y,c.y)&&u.y>=Math.min(a.y,c.y)}function mf(a){return a>0?1:a<0?-1:0}function zc(a,u){return oo(a.prev,a,a.next)<0?oo(a,u,a.next)>=0&&oo(a,a.prev,u)>=0:oo(a,u,a.prev)<0||oo(a,a.next,u)<0}function Ih(a,u){var c=new Zc(a.i,a.x,a.y),m=new Zc(u.i,u.x,u.y),x=a.next,E=u.prev;return a.next=u,u.prev=a,c.next=x,x.prev=c,m.next=c,c.prev=m,E.next=m,m.prev=E,m}function gf(a,u,c,m){var x=new Zc(a,u,c);return m?(x.next=m.next,x.prev=m,m.next.prev=x,m.next=x):(x.prev=x,x.next=x),x}function ll(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function Zc(a,u,c){this.i=a,this.x=u,this.y=c,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function _f(a,u,c,m){for(var x=0,E=u,A=c-m;E<c;E+=m)x+=(a[A]-a[E])*(a[E+1]+a[A+1]),A=E;return x}function cl(a,u,c,m,x){(function E(A,I,D,N,j){for(;N>D;){if(N-D>600){var X=N-D+1,ee=I-D+1,R=Math.log(X),Ce=.5*Math.exp(2*R/3),Oe=.5*Math.sqrt(R*Ce*(X-Ce)/X)*(ee-X/2<0?-1:1);E(A,I,Math.max(D,Math.floor(I-ee*Ce/X+Oe)),Math.min(N,Math.floor(I+(X-ee)*Ce/X+Oe)),j)}var Qe=A[I],He=D,xt=N;for(lc(A,D,I),j(A[N],Qe)>0&&lc(A,D,N);He<xt;){for(lc(A,He,xt),He++,xt--;j(A[He],Qe)<0;)He++;for(;j(A[xt],Qe)>0;)xt--}j(A[D],Qe)===0?lc(A,D,xt):lc(A,++xt,N),xt<=I&&(D=xt+1),I<=xt&&(N=xt-1)}})(a,u,c||0,m||a.length-1,x||yf)}function lc(a,u,c){var m=a[u];a[u]=a[c],a[c]=m}function yf(a,u){return a<u?-1:a>u?1:0}function pp(a,u){var c=a.length;if(c<=1)return[a];for(var m,x,E=[],A=0;A<c;A++){var I=Sr(a[A]);I!==0&&(a[A].area=Math.abs(I),x===void 0&&(x=I<0),x===I<0?(m&&E.push(m),m=[a[A]]):m.push(a[A]))}if(m&&E.push(m),u>1)for(var D=0;D<E.length;D++)E[D].length<=u||(cl(E[D],u,1,E[D].length-1,Ph),E[D]=E[D].slice(0,u));return E}function Ph(a,u){return u.area-a.area}function Wp(a,u,c){for(var m=c.patternDependencies,x=!1,E=0,A=u;E<A.length;E+=1){var I=A[E].paint.get(a+"-pattern");I.isConstant()||(x=!0);var D=I.constantOr(null);D&&(x=!0,m[D.to]=!0,m[D.from]=!0)}return x}function xf(a,u,c,m,x){for(var E=x.patternDependencies,A=0,I=u;A<I.length;A+=1){var D=I[A],N=D.paint.get(a+"-pattern").value;if(N.kind!=="constant"){var j=N.evaluate({zoom:m-1},c,{},x.availableImages),X=N.evaluate({zoom:m},c,{},x.availableImages),ee=N.evaluate({zoom:m+1},c,{},x.availableImages);X=X&&X.name?X.name:X,ee=ee&&ee.name?ee.name:ee,E[j=j&&j.name?j.name:j]=!0,E[X]=!0,E[ee]=!0,c.patterns[D.id]={min:j,mid:X,max:ee}}}return c}lp.deviation=function(a,u,c,m){var x=u&&u.length,E=Math.abs(_f(a,0,x?u[0]*c:a.length,c));if(x)for(var A=0,I=u.length;A<I;A++)E-=Math.abs(_f(a,u[A]*c,A<I-1?u[A+1]*c:a.length,c));var D=0;for(A=0;A<m.length;A+=3){var N=m[A]*c,j=m[A+1]*c,X=m[A+2]*c;D+=Math.abs((a[N]-a[X])*(a[j+1]-a[N+1])-(a[N]-a[j])*(a[X+1]-a[N+1]))}return E===0&&D===0?0:Math.abs((D-E)/E)},lp.flatten=function(a){for(var u=a[0][0].length,c={vertices:[],holes:[],dimensions:u},m=0,x=0;x<a.length;x++){for(var E=0;E<a[x].length;E++)for(var A=0;A<u;A++)c.vertices.push(a[x][E][A]);x>0&&c.holes.push(m+=a[x-1].length)}return c},pf.default=Id;var fl=function(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Pl,this.indexArray=new zu,this.indexArray2=new ff,this.programConfigurations=new $n(a.layers,a.zoom),this.segments=new ge,this.segments2=new ge,this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};fl.prototype.populate=function(a,u,c){this.hasPattern=Wp("fill",this.layers,u);for(var m=this.layers[0].layout.get("fill-sort-key"),x=[],E=0,A=a;E<A.length;E+=1){var I=A[E],D=I.feature,N=I.id,j=I.index,X=I.sourceLayerIndex,ee=this.layers[0]._featureFilter.needGeometry,R=Ga(D,ee);if(this.layers[0]._featureFilter.filter(new B(this.zoom),R,c)){var Ce=m?m.evaluate(R,{},c,u.availableImages):void 0,Oe={id:N,properties:D.properties,type:D.type,sourceLayerIndex:X,index:j,geometry:ee?R.geometry:Wa(D),patterns:{},sortKey:Ce};x.push(Oe)}}m&&x.sort(function(Lr,Gr){return Lr.sortKey-Gr.sortKey});for(var Qe=0,He=x;Qe<He.length;Qe+=1){var xt=He[Qe],It=xt.geometry,Vt=xt.index,jt=xt.sourceLayerIndex;if(this.hasPattern){var fr=xf("fill",this.layers,xt,this.zoom,u);this.patternFeatures.push(fr)}else this.addFeature(xt,It,Vt,c,{});u.featureIndex.insert(a[Vt].feature,It,Vt,jt,this.index)}},fl.prototype.update=function(a,u,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,u,this.stateDependentLayers,c)},fl.prototype.addFeatures=function(a,u,c){for(var m=0,x=this.patternFeatures;m<x.length;m+=1){var E=x[m];this.addFeature(E,E.geometry,E.index,u,c)}},fl.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},fl.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},fl.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,jp),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.indexBuffer2=a.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(a),this.uploaded=!0},fl.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},fl.prototype.addFeature=function(a,u,c,m,x){for(var E=0,A=pp(u,500);E<A.length;E+=1){for(var I=A[E],D=0,N=0,j=I;N<j.length;N+=1)D+=j[N].length;for(var X=this.segments.prepareSegment(D,this.layoutVertexArray,this.indexArray),ee=X.vertexLength,R=[],Ce=[],Oe=0,Qe=I;Oe<Qe.length;Oe+=1){var He=Qe[Oe];if(He.length!==0){He!==I[0]&&Ce.push(R.length/2);var xt=this.segments2.prepareSegment(He.length,this.layoutVertexArray,this.indexArray2),It=xt.vertexLength;this.layoutVertexArray.emplaceBack(He[0].x,He[0].y),this.indexArray2.emplaceBack(It+He.length-1,It),R.push(He[0].x),R.push(He[0].y);for(var Vt=1;Vt<He.length;Vt++)this.layoutVertexArray.emplaceBack(He[Vt].x,He[Vt].y),this.indexArray2.emplaceBack(It+Vt-1,It+Vt),R.push(He[Vt].x),R.push(He[Vt].y);xt.vertexLength+=He.length,xt.primitiveLength+=He.length}}for(var jt=pf(R,Ce),fr=0;fr<jt.length;fr+=3)this.indexArray.emplaceBack(ee+jt[fr],ee+jt[fr+1],ee+jt[fr+2]);X.vertexLength+=D,X.primitiveLength+=jt.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,c,x,m)},vn("FillBucket",fl,{omit:["layers","patternFeatures"]});var Nl=new ka({"fill-sort-key":new gn(V.layout_fill["fill-sort-key"])}),Fd={paint:new ka({"fill-antialias":new On(V.paint_fill["fill-antialias"]),"fill-opacity":new gn(V.paint_fill["fill-opacity"]),"fill-color":new gn(V.paint_fill["fill-color"]),"fill-outline-color":new gn(V.paint_fill["fill-outline-color"]),"fill-translate":new On(V.paint_fill["fill-translate"]),"fill-translate-anchor":new On(V.paint_fill["fill-translate-anchor"]),"fill-pattern":new Bs(V.paint_fill["fill-pattern"])}),layout:Nl},Oh=function(a){function u(c){a.call(this,c,Fd)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.recalculate=function(c,m){a.prototype.recalculate.call(this,c,m);var x=this.paint._values["fill-outline-color"];x.value.kind==="constant"&&x.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},u.prototype.createBucket=function(c){return new fl(c)},u.prototype.queryRadius=function(){return Ka(this.paint.get("fill-translate"))},u.prototype.queryIntersectsFeature=function(c,m,x,E,A,I,D){return nu(As(c,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),I.angle,D),E)},u.prototype.isTileClipped=function(){return!0},u}(Ls),Gp=To([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,dp=cc;function cc(a,u,c,m,x){this.properties={},this.extent=c,this.type=0,this._pbf=a,this._geometry=-1,this._keys=m,this._values=x,a.readFields(Bd,this,u)}function Bd(a,u,c){a==1?u.id=c.readVarint():a==2?function(m,x){for(var E=m.readVarint()+m.pos;m.pos<E;){var A=x._keys[m.readVarint()],I=x._values[m.readVarint()];x.properties[A]=I}}(c,u):a==3?u.type=c.readVarint():a==4&&(u._geometry=c.pos)}function hl(a){for(var u,c,m=0,x=0,E=a.length,A=E-1;x<E;A=x++)m+=((c=a[A]).x-(u=a[x]).x)*(u.y+c.y);return m}cc.types=["Unknown","Point","LineString","Polygon"],cc.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var u,c=a.readVarint()+a.pos,m=1,x=0,E=0,A=0,I=[];a.pos<c;){if(x<=0){var D=a.readVarint();m=7&D,x=D>>3}if(x--,m===1||m===2)E+=a.readSVarint(),A+=a.readSVarint(),m===1&&(u&&I.push(u),u=[]),u.push(new ae(E,A));else{if(m!==7)throw new Error("unknown command "+m);u&&u.push(u[0].clone())}}return u&&I.push(u),I},cc.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var u=a.readVarint()+a.pos,c=1,m=0,x=0,E=0,A=1/0,I=-1/0,D=1/0,N=-1/0;a.pos<u;){if(m<=0){var j=a.readVarint();c=7&j,m=j>>3}if(m--,c===1||c===2)(x+=a.readSVarint())<A&&(A=x),x>I&&(I=x),(E+=a.readSVarint())<D&&(D=E),E>N&&(N=E);else if(c!==7)throw new Error("unknown command "+c)}return[A,D,I,N]},cc.prototype.toGeoJSON=function(a,u,c){var m,x,E=this.extent*Math.pow(2,c),A=this.extent*a,I=this.extent*u,D=this.loadGeometry(),N=cc.types[this.type];function j(R){for(var Ce=0;Ce<R.length;Ce++){var Oe=R[Ce];R[Ce]=[360*(Oe.x+A)/E-180,360/Math.PI*Math.atan(Math.exp((180-360*(Oe.y+I)/E)*Math.PI/180))-90]}}switch(this.type){case 1:var X=[];for(m=0;m<D.length;m++)X[m]=D[m][0];j(D=X);break;case 2:for(m=0;m<D.length;m++)j(D[m]);break;case 3:for(D=function(R){var Ce=R.length;if(Ce<=1)return[R];for(var Oe,Qe,He=[],xt=0;xt<Ce;xt++){var It=hl(R[xt]);It!==0&&(Qe===void 0&&(Qe=It<0),Qe===It<0?(Oe&&He.push(Oe),Oe=[R[xt]]):Oe.push(R[xt]))}return Oe&&He.push(Oe),He}(D),m=0;m<D.length;m++)for(x=0;x<D[m].length;x++)j(D[m][x])}D.length===1?D=D[0]:N="Multi"+N;var ee={type:"Feature",geometry:{type:N,coordinates:D},properties:this.properties};return"id"in this&&(ee.id=this.id),ee};var pl=bf;function bf(a,u){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(fc,this,u),this.length=this._features.length}function fc(a,u,c){a===15?u.version=c.readVarint():a===1?u.name=c.readString():a===5?u.extent=c.readVarint():a===2?u._features.push(c.pos):a===3?u._keys.push(c.readString()):a===4&&u._values.push(function(m){for(var x=null,E=m.readVarint()+m.pos;m.pos<E;){var A=m.readVarint()>>3;x=A===1?m.readString():A===2?m.readFloat():A===3?m.readDouble():A===4?m.readVarint64():A===5?m.readVarint():A===6?m.readSVarint():A===7?m.readBoolean():null}return x}(c))}function Xp(a,u,c){if(a===3){var m=new pl(c,c.readVarint()+c.pos);m.length&&(u[m.name]=m)}}bf.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var u=this._pbf.readVarint()+this._pbf.pos;return new dp(this._pbf,u,this.extent,this._keys,this._values)};var Ul={VectorTile:function(a,u){this.layers=a.readFields(Xp,{},u)},VectorTileFeature:dp,VectorTileLayer:pl},Gf=Ul.VectorTileFeature.types,vp=Math.pow(2,13);function Ts(a,u,c,m,x,E,A,I){a.emplaceBack(u,c,2*Math.floor(m*vp)+A,x*vp*2,E*vp*2,Math.round(I))}var hs=function(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new gu,this.indexArray=new zu,this.programConfigurations=new $n(a.layers,a.zoom),this.segments=new ge,this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};function vo(a,u){return a.x===u.x&&(a.x<0||a.x>8192)||a.y===u.y&&(a.y<0||a.y>8192)}hs.prototype.populate=function(a,u,c){this.features=[],this.hasPattern=Wp("fill-extrusion",this.layers,u);for(var m=0,x=a;m<x.length;m+=1){var E=x[m],A=E.feature,I=E.id,D=E.index,N=E.sourceLayerIndex,j=this.layers[0]._featureFilter.needGeometry,X=Ga(A,j);if(this.layers[0]._featureFilter.filter(new B(this.zoom),X,c)){var ee={id:I,sourceLayerIndex:N,index:D,geometry:j?X.geometry:Wa(A),properties:A.properties,type:A.type,patterns:{}};this.hasPattern?this.features.push(xf("fill-extrusion",this.layers,ee,this.zoom,u)):this.addFeature(ee,ee.geometry,D,c,{}),u.featureIndex.insert(A,ee.geometry,D,N,this.index,!0)}}},hs.prototype.addFeatures=function(a,u,c){for(var m=0,x=this.features;m<x.length;m+=1){var E=x[m];this.addFeature(E,E.geometry,E.index,u,c)}},hs.prototype.update=function(a,u,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,u,this.stateDependentLayers,c)},hs.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},hs.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},hs.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Gp),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},hs.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},hs.prototype.addFeature=function(a,u,c,m,x){for(var E=0,A=pp(u,500);E<A.length;E+=1){for(var I=A[E],D=0,N=0,j=I;N<j.length;N+=1)D+=j[N].length;for(var X=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),ee=0,R=I;ee<R.length;ee+=1){var Ce=R[ee];if(Ce.length!==0&&!((Ii=Ce).every(function(gi){return gi.x<0})||Ii.every(function(gi){return gi.x>8192})||Ii.every(function(gi){return gi.y<0})||Ii.every(function(gi){return gi.y>8192})))for(var Oe=0,Qe=0;Qe<Ce.length;Qe++){var He=Ce[Qe];if(Qe>=1){var xt=Ce[Qe-1];if(!vo(He,xt)){X.vertexLength+4>ge.MAX_VERTEX_ARRAY_LENGTH&&(X=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var It=He.sub(xt)._perp()._unit(),Vt=xt.dist(He);Oe+Vt>32768&&(Oe=0),Ts(this.layoutVertexArray,He.x,He.y,It.x,It.y,0,0,Oe),Ts(this.layoutVertexArray,He.x,He.y,It.x,It.y,0,1,Oe),Ts(this.layoutVertexArray,xt.x,xt.y,It.x,It.y,0,0,Oe+=Vt),Ts(this.layoutVertexArray,xt.x,xt.y,It.x,It.y,0,1,Oe);var jt=X.vertexLength;this.indexArray.emplaceBack(jt,jt+2,jt+1),this.indexArray.emplaceBack(jt+1,jt+2,jt+3),X.vertexLength+=4,X.primitiveLength+=2}}}}if(X.vertexLength+D>ge.MAX_VERTEX_ARRAY_LENGTH&&(X=this.segments.prepareSegment(D,this.layoutVertexArray,this.indexArray)),Gf[a.type]==="Polygon"){for(var fr=[],Lr=[],Gr=X.vertexLength,Dn=0,sn=I;Dn<sn.length;Dn+=1){var zn=sn[Dn];if(zn.length!==0){zn!==I[0]&&Lr.push(fr.length/2);for(var cn=0;cn<zn.length;cn++){var Ei=zn[cn];Ts(this.layoutVertexArray,Ei.x,Ei.y,0,0,1,1,0),fr.push(Ei.x),fr.push(Ei.y)}}}for(var Qn=pf(fr,Lr),Tn=0;Tn<Qn.length;Tn+=3)this.indexArray.emplaceBack(Gr+Qn[Tn],Gr+Qn[Tn+2],Gr+Qn[Tn+1]);X.primitiveLength+=Qn.length/3,X.vertexLength+=D}}var Ii;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,c,x,m)},vn("FillExtrusionBucket",hs,{omit:["layers","features"]});var Us={paint:new ka({"fill-extrusion-opacity":new On(V["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new gn(V["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new On(V["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new On(V["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Bs(V["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new gn(V["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new gn(V["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new On(V["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},$p=function(a){function u(c){a.call(this,c,Us)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.createBucket=function(c){return new hs(c)},u.prototype.queryRadius=function(){return Ka(this.paint.get("fill-extrusion-translate"))},u.prototype.is3D=function(){return!0},u.prototype.queryIntersectsFeature=function(c,m,x,E,A,I,D,N){var j=As(c,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),I.angle,D),X=this.paint.get("fill-extrusion-height").evaluate(m,x),ee=this.paint.get("fill-extrusion-base").evaluate(m,x),R=function(Oe,Qe,He,xt){for(var It=[],Vt=0,jt=Oe;Vt<jt.length;Vt+=1){var fr=jt[Vt],Lr=[fr.x,fr.y,0,1];Bl(Lr,Lr,Qe),It.push(new ae(Lr[0]/Lr[3],Lr[1]/Lr[3]))}return It}(j,N),Ce=function(Oe,Qe,He,xt){for(var It=[],Vt=[],jt=xt[8]*Qe,fr=xt[9]*Qe,Lr=xt[10]*Qe,Gr=xt[11]*Qe,Dn=xt[8]*He,sn=xt[9]*He,zn=xt[10]*He,cn=xt[11]*He,Ei=0,Qn=Oe;Ei<Qn.length;Ei+=1){for(var Tn=[],Ii=[],gi=0,Bi=Qn[Ei];gi<Bi.length;gi+=1){var Zn=Bi[gi],ra=Zn.x,Ua=Zn.y,Ja=xt[0]*ra+xt[4]*Ua+xt[12],so=xt[1]*ra+xt[5]*Ua+xt[13],za=xt[2]*ra+xt[6]*Ua+xt[14],co=xt[3]*ra+xt[7]*Ua+xt[15],Go=za+Lr,Uo=co+Gr,Zs=Ja+Dn,Fa=so+sn,Vs=za+zn,bo=co+cn,rs=new ae((Ja+jt)/Uo,(so+fr)/Uo);rs.z=Go/Uo,Tn.push(rs);var zi=new ae(Zs/bo,Fa/bo);zi.z=Vs/bo,Ii.push(zi)}It.push(Tn),Vt.push(Ii)}return[It,Vt]}(E,ee,X,N);return function(Oe,Qe,He){var xt=1/0;nu(He,Qe)&&(xt=Ld(He,Qe[0]));for(var It=0;It<Qe.length;It++)for(var Vt=Qe[It],jt=Oe[It],fr=0;fr<Vt.length-1;fr++){var Lr=Vt[fr],Gr=[Lr,Vt[fr+1],jt[fr+1],jt[fr],Lr];Zu(He,Gr)&&(xt=Math.min(xt,Ld(He,Gr)))}return xt!==1/0&&xt}(Ce[0],Ce[1],R)},u}(Ls);function Xf(a,u){return a.x*u.x+a.y*u.y}function Ld(a,u){if(a.length===1){for(var c,m=0,x=u[m++];!c||x.equals(c);)if(!(c=u[m++]))return 1/0;for(;m<u.length;m++){var E=u[m],A=a[0],I=c.sub(x),D=E.sub(x),N=A.sub(x),j=Xf(I,I),X=Xf(I,D),ee=Xf(D,D),R=Xf(N,I),Ce=Xf(N,D),Oe=j*ee-X*X,Qe=(ee*R-X*Ce)/Oe,He=(j*Ce-X*R)/Oe,xt=x.z*(1-Qe-He)+c.z*Qe+E.z*He;if(isFinite(xt))return xt}return 1/0}for(var It=1/0,Vt=0,jt=u;Vt<jt.length;Vt+=1)It=Math.min(It,jt[Vt].z);return It}var Lv=To([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,Yp=To([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,Nd=Ul.VectorTileFeature.types,Nv=Math.cos(Math.PI/180*37.5),Dh=Math.pow(2,14)/.5,Jo=function(a){var u=this;this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(c){return c.id}),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(c){u.gradients[c.id]={}}),this.layoutVertexArray=new Es,this.layoutVertexArray2=new ic,this.indexArray=new zu,this.programConfigurations=new $n(a.layers,a.zoom),this.segments=new ge,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(c){return c.isStateDependent()}).map(function(c){return c.id})};Jo.prototype.populate=function(a,u,c){this.hasPattern=Wp("line",this.layers,u);for(var m=this.layers[0].layout.get("line-sort-key"),x=[],E=0,A=a;E<A.length;E+=1){var I=A[E],D=I.feature,N=I.id,j=I.index,X=I.sourceLayerIndex,ee=this.layers[0]._featureFilter.needGeometry,R=Ga(D,ee);if(this.layers[0]._featureFilter.filter(new B(this.zoom),R,c)){var Ce=m?m.evaluate(R,{},c):void 0,Oe={id:N,properties:D.properties,type:D.type,sourceLayerIndex:X,index:j,geometry:ee?R.geometry:Wa(D),patterns:{},sortKey:Ce};x.push(Oe)}}m&&x.sort(function(Lr,Gr){return Lr.sortKey-Gr.sortKey});for(var Qe=0,He=x;Qe<He.length;Qe+=1){var xt=He[Qe],It=xt.geometry,Vt=xt.index,jt=xt.sourceLayerIndex;if(this.hasPattern){var fr=xf("line",this.layers,xt,this.zoom,u);this.patternFeatures.push(fr)}else this.addFeature(xt,It,Vt,c,{});u.featureIndex.insert(a[Vt].feature,It,Vt,jt,this.index)}},Jo.prototype.update=function(a,u,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,u,this.stateDependentLayers,c)},Jo.prototype.addFeatures=function(a,u,c){for(var m=0,x=this.patternFeatures;m<x.length;m+=1){var E=x[m];this.addFeature(E,E.geometry,E.index,u,c)}},Jo.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Jo.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Jo.prototype.upload=function(a){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=a.createVertexBuffer(this.layoutVertexArray2,Yp)),this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Lv),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},Jo.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Jo.prototype.lineFeatureClips=function(a){if(a.properties&&a.properties.hasOwnProperty("mapbox_clip_start")&&a.properties.hasOwnProperty("mapbox_clip_end"))return{start:+a.properties.mapbox_clip_start,end:+a.properties.mapbox_clip_end}},Jo.prototype.addFeature=function(a,u,c,m,x){var E=this.layers[0].layout,A=E.get("line-join").evaluate(a,{}),I=E.get("line-cap"),D=E.get("line-miter-limit"),N=E.get("line-round-limit");this.lineClips=this.lineFeatureClips(a);for(var j=0,X=u;j<X.length;j+=1)this.addLine(X[j],a,A,I,D,N);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,c,x,m)},Jo.prototype.addLine=function(a,u,c,m,x,E){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var A=0;A<a.length-1;A++)this.totalDistance+=a[A].dist(a[A+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var I=Nd[u.type]==="Polygon",D=a.length;D>=2&&a[D-1].equals(a[D-2]);)D--;for(var N=0;N<D-1&&a[N].equals(a[N+1]);)N++;if(!(D<(I?3:2))){c==="bevel"&&(x=1.05);var j,X=this.overscaling<=16?122880/(512*this.overscaling):0,ee=this.segments.prepareSegment(10*D,this.layoutVertexArray,this.indexArray),R=void 0,Ce=void 0,Oe=void 0,Qe=void 0;this.e1=this.e2=-1,I&&(Qe=a[N].sub(j=a[D-2])._unit()._perp());for(var He=N;He<D;He++)if(!(Ce=He===D-1?I?a[N+1]:void 0:a[He+1])||!a[He].equals(Ce)){Qe&&(Oe=Qe),j&&(R=j),j=a[He],Qe=Ce?Ce.sub(j)._unit()._perp():Oe;var xt=(Oe=Oe||Qe).add(Qe);xt.x===0&&xt.y===0||xt._unit();var It=Oe.x*Qe.x+Oe.y*Qe.y,Vt=xt.x*Qe.x+xt.y*Qe.y,jt=Vt!==0?1/Vt:1/0,fr=2*Math.sqrt(2-2*Vt),Lr=Vt<Nv&&R&&Ce,Gr=Oe.x*Qe.y-Oe.y*Qe.x>0;if(Lr&&He>N){var Dn=j.dist(R);if(Dn>2*X){var sn=j.sub(j.sub(R)._mult(X/Dn)._round());this.updateDistance(R,sn),this.addCurrentVertex(sn,Oe,0,0,ee),R=sn}}var zn=R&&Ce,cn=zn?c:I?"butt":m;if(zn&&cn==="round"&&(jt<E?cn="miter":jt<=2&&(cn="fakeround")),cn==="miter"&&jt>x&&(cn="bevel"),cn==="bevel"&&(jt>2&&(cn="flipbevel"),jt<x&&(cn="miter")),R&&this.updateDistance(R,j),cn==="miter")xt._mult(jt),this.addCurrentVertex(j,xt,0,0,ee);else if(cn==="flipbevel"){if(jt>100)xt=Qe.mult(-1);else{var Ei=jt*Oe.add(Qe).mag()/Oe.sub(Qe).mag();xt._perp()._mult(Ei*(Gr?-1:1))}this.addCurrentVertex(j,xt,0,0,ee),this.addCurrentVertex(j,xt.mult(-1),0,0,ee)}else if(cn==="bevel"||cn==="fakeround"){var Qn=-Math.sqrt(jt*jt-1),Tn=Gr?Qn:0,Ii=Gr?0:Qn;if(R&&this.addCurrentVertex(j,Oe,Tn,Ii,ee),cn==="fakeround")for(var gi=Math.round(180*fr/Math.PI/20),Bi=1;Bi<gi;Bi++){var Zn=Bi/gi;if(Zn!==.5){var ra=Zn-.5;Zn+=Zn*ra*(Zn-1)*((1.0904+It*(It*(3.55645-1.43519*It)-3.2452))*ra*ra+(.848013+It*(.215638*It-1.06021)))}var Ua=Qe.sub(Oe)._mult(Zn)._add(Oe)._unit()._mult(Gr?-1:1);this.addHalfVertex(j,Ua.x,Ua.y,!1,Gr,0,ee)}Ce&&this.addCurrentVertex(j,Qe,-Tn,-Ii,ee)}else if(cn==="butt")this.addCurrentVertex(j,xt,0,0,ee);else if(cn==="square"){var Ja=R?1:-1;this.addCurrentVertex(j,xt,Ja,Ja,ee)}else cn==="round"&&(R&&(this.addCurrentVertex(j,Oe,0,0,ee),this.addCurrentVertex(j,Oe,1,1,ee,!0)),Ce&&(this.addCurrentVertex(j,Qe,-1,-1,ee,!0),this.addCurrentVertex(j,Qe,0,0,ee)));if(Lr&&He<D-1){var so=j.dist(Ce);if(so>2*X){var za=j.add(Ce.sub(j)._mult(X/so)._round());this.updateDistance(j,za),this.addCurrentVertex(za,Qe,0,0,ee),j=za}}}}},Jo.prototype.addCurrentVertex=function(a,u,c,m,x,E){E===void 0&&(E=!1);var A=u.y*m-u.x,I=-u.y-u.x*m;this.addHalfVertex(a,u.x+u.y*c,u.y-u.x*c,E,!1,c,x),this.addHalfVertex(a,A,I,E,!0,-m,x),this.distance>Dh/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(a,u,c,m,x,E))},Jo.prototype.addHalfVertex=function(a,u,c,m,x,E,A){var I=.5*(this.lineClips?this.scaledDistance*(Dh-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((a.x<<1)+(m?1:0),(a.y<<1)+(x?1:0),Math.round(63*u)+128,Math.round(63*c)+128,1+(E===0?0:E<0?-1:1)|(63&I)<<2,I>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var D=A.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,D),A.primitiveLength++),x?this.e2=D:this.e1=D},Jo.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},Jo.prototype.updateDistance=function(a,u){this.distance+=a.dist(u),this.updateScaledDistance()},vn("LineBucket",Jo,{omit:["layers","patternFeatures"]});var Uv=new ka({"line-cap":new On(V.layout_line["line-cap"]),"line-join":new gn(V.layout_line["line-join"]),"line-miter-limit":new On(V.layout_line["line-miter-limit"]),"line-round-limit":new On(V.layout_line["line-round-limit"]),"line-sort-key":new gn(V.layout_line["line-sort-key"])}),$f={paint:new ka({"line-opacity":new gn(V.paint_line["line-opacity"]),"line-color":new gn(V.paint_line["line-color"]),"line-translate":new On(V.paint_line["line-translate"]),"line-translate-anchor":new On(V.paint_line["line-translate-anchor"]),"line-width":new gn(V.paint_line["line-width"]),"line-gap-width":new gn(V.paint_line["line-gap-width"]),"line-offset":new gn(V.paint_line["line-offset"]),"line-blur":new gn(V.paint_line["line-blur"]),"line-dasharray":new qo(V.paint_line["line-dasharray"]),"line-pattern":new Bs(V.paint_line["line-pattern"]),"line-gradient":new mu(V.paint_line["line-gradient"])}),layout:Uv},qp=new(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.possiblyEvaluate=function(c,m){return m=new B(Math.floor(m.zoom),{now:m.now,fadeDuration:m.fadeDuration,zoomHistory:m.zoomHistory,transition:m.transition}),a.prototype.possiblyEvaluate.call(this,c,m)},u.prototype.evaluate=function(c,m,x,E){return m=Ht({},m,{zoom:Math.floor(m.zoom)}),a.prototype.evaluate.call(this,c,m,x,E)},u}(gn))($f.paint.properties["line-width"].specification);qp.useIntegerZoom=!0;var Ud=function(a){function u(c){a.call(this,c,$f),this.gradientVersion=0}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._handleSpecialPaintPropertyUpdate=function(c){c==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Ps,this.gradientVersion=(this.gradientVersion+1)%Ke)},u.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},u.prototype.recalculate=function(c,m){a.prototype.recalculate.call(this,c,m),this.paint._values["line-floorwidth"]=qp.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,c)},u.prototype.createBucket=function(c){return new Jo(c)},u.prototype.queryRadius=function(c){var m=c,x=Kp(Ko("line-width",this,m),Ko("line-gap-width",this,m)),E=Ko("line-offset",this,m);return x/2+Math.abs(E)+Ka(this.paint.get("line-translate"))},u.prototype.queryIntersectsFeature=function(c,m,x,E,A,I,D){var N=As(c,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),I.angle,D),j=D/2*Kp(this.paint.get("line-width").evaluate(m,x),this.paint.get("line-gap-width").evaluate(m,x)),X=this.paint.get("line-offset").evaluate(m,x);return X&&(E=function(ee,R){for(var Ce=[],Oe=new ae(0,0),Qe=0;Qe<ee.length;Qe++){for(var He=ee[Qe],xt=[],It=0;It<He.length;It++){var Vt=He[It],jt=He[It+1],fr=It===0?Oe:Vt.sub(He[It-1])._unit()._perp(),Lr=It===He.length-1?Oe:jt.sub(Vt)._unit()._perp(),Gr=fr._add(Lr)._unit();Gr._mult(1/(Gr.x*Lr.x+Gr.y*Lr.y)),xt.push(Gr._mult(R)._add(Vt))}Ce.push(xt)}return Ce}(E,X*D)),function(ee,R,Ce){for(var Oe=0;Oe<R.length;Oe++){var Qe=R[Oe];if(ee.length>=3){for(var He=0;He<Qe.length;He++)if(iu(ee,Qe[He]))return!0}if(Ns(ee,Qe,Ce))return!0}return!1}(N,E,j)},u.prototype.isTileClipped=function(){return!0},u}(Ls);function Kp(a,u){return u>0?u+2*a:a}var zv=To([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Zv=To([{name:"a_projected_pos",components:3,type:"Float32"}],4),zd=(To([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),To([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Zd=(To([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),To([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),z=To([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Ee(a,u,c){return a.sections.forEach(function(m){m.text=function(x,E,A){var I=E.layout.get("text-transform").evaluate(A,{});return I==="uppercase"?x=x.toLocaleUpperCase():I==="lowercase"&&(x=x.toLocaleLowerCase()),Ie.applyArabicShaping&&(x=Ie.applyArabicShaping(x)),x}(m.text,u,c)}),a}To([{name:"triangle",components:3,type:"Uint16"}]),To([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),To([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),To([{type:"Float32",name:"offsetX"}]),To([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Ze={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},Ut=function(a,u,c,m,x){var E,A,I=8*x-m-1,D=(1<<I)-1,N=D>>1,j=-7,X=c?x-1:0,ee=c?-1:1,R=a[u+X];for(X+=ee,E=R&(1<<-j)-1,R>>=-j,j+=I;j>0;E=256*E+a[u+X],X+=ee,j-=8);for(A=E&(1<<-j)-1,E>>=-j,j+=m;j>0;A=256*A+a[u+X],X+=ee,j-=8);if(E===0)E=1-N;else{if(E===D)return A?NaN:1/0*(R?-1:1);A+=Math.pow(2,m),E-=N}return(R?-1:1)*A*Math.pow(2,E-m)},cr=function(a,u,c,m,x,E){var A,I,D,N=8*E-x-1,j=(1<<N)-1,X=j>>1,ee=x===23?Math.pow(2,-24)-Math.pow(2,-77):0,R=m?0:E-1,Ce=m?1:-1,Oe=u<0||u===0&&1/u<0?1:0;for(u=Math.abs(u),isNaN(u)||u===1/0?(I=isNaN(u)?1:0,A=j):(A=Math.floor(Math.log(u)/Math.LN2),u*(D=Math.pow(2,-A))<1&&(A--,D*=2),(u+=A+X>=1?ee/D:ee*Math.pow(2,1-X))*D>=2&&(A++,D/=2),A+X>=j?(I=0,A=j):A+X>=1?(I=(u*D-1)*Math.pow(2,x),A+=X):(I=u*Math.pow(2,X-1)*Math.pow(2,x),A=0));x>=8;a[c+R]=255&I,R+=Ce,I/=256,x-=8);for(A=A<<x|I,N+=x;N>0;a[c+R]=255&A,R+=Ce,A/=256,N-=8);a[c+R-Ce]|=128*Oe},zt=kt;function kt(a){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(a)?a:new Uint8Array(a||0),this.pos=0,this.type=0,this.length=this.buf.length}kt.Varint=0,kt.Fixed64=1,kt.Bytes=2,kt.Fixed32=5;var Dr=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function wr(a){return a.type===kt.Bytes?a.readVarint()+a.pos:a.pos+1}function Zr(a,u,c){return c?4294967296*u+(a>>>0):4294967296*(u>>>0)+(a>>>0)}function Br(a,u,c){var m=u<=16383?1:u<=2097151?2:u<=268435455?3:Math.floor(Math.log(u)/(7*Math.LN2));c.realloc(m);for(var x=c.pos-1;x>=a;x--)c.buf[x+m]=c.buf[x]}function Ur(a,u){for(var c=0;c<a.length;c++)u.writeVarint(a[c])}function Wr(a,u){for(var c=0;c<a.length;c++)u.writeSVarint(a[c])}function Er(a,u){for(var c=0;c<a.length;c++)u.writeFloat(a[c])}function zr(a,u){for(var c=0;c<a.length;c++)u.writeDouble(a[c])}function St(a,u){for(var c=0;c<a.length;c++)u.writeBoolean(a[c])}function Qt(a,u){for(var c=0;c<a.length;c++)u.writeFixed32(a[c])}function kr(a,u){for(var c=0;c<a.length;c++)u.writeSFixed32(a[c])}function Jr(a,u){for(var c=0;c<a.length;c++)u.writeFixed64(a[c])}function gr(a,u){for(var c=0;c<a.length;c++)u.writeSFixed64(a[c])}function tn(a,u){return(a[u]|a[u+1]<<8|a[u+2]<<16)+16777216*a[u+3]}function Ir(a,u,c){a[c]=u,a[c+1]=u>>>8,a[c+2]=u>>>16,a[c+3]=u>>>24}function en(a,u){return(a[u]|a[u+1]<<8|a[u+2]<<16)+(a[u+3]<<24)}function xr(a,u,c){a===1&&c.readMessage(Xr,u)}function Xr(a,u,c){if(a===3){var m=c.readMessage(Fn,{}),x=m.width,E=m.height,A=m.left,I=m.top,D=m.advance;u.push({id:m.id,bitmap:new _u({width:x+6,height:E+6},m.bitmap),metrics:{width:x,height:E,left:A,top:I,advance:D}})}}function Fn(a,u,c){a===1?u.id=c.readVarint():a===2?u.bitmap=c.readBytes():a===3?u.width=c.readVarint():a===4?u.height=c.readVarint():a===5?u.left=c.readSVarint():a===6?u.top=c.readSVarint():a===7&&(u.advance=c.readVarint())}function ui(a){for(var u=0,c=0,m=0,x=a;m<x.length;m+=1){var E=x[m];u+=E.w*E.h,c=Math.max(c,E.w)}a.sort(function(Oe,Qe){return Qe.h-Oe.h});for(var A=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(u/.95)),c),h:1/0}],I=0,D=0,N=0,j=a;N<j.length;N+=1)for(var X=j[N],ee=A.length-1;ee>=0;ee--){var R=A[ee];if(!(X.w>R.w||X.h>R.h)){if(X.x=R.x,X.y=R.y,D=Math.max(D,X.y+X.h),I=Math.max(I,X.x+X.w),X.w===R.w&&X.h===R.h){var Ce=A.pop();ee<A.length&&(A[ee]=Ce)}else X.h===R.h?(R.x+=X.w,R.w-=X.w):X.w===R.w?(R.y+=X.h,R.h-=X.h):(A.push({x:R.x+X.w,y:R.y,w:R.w-X.w,h:X.h}),R.y+=X.h,R.h-=X.h);break}}return{w:I,h:D,fill:u/(I*D)||0}}kt.prototype={destroy:function(){this.buf=null},readFields:function(a,u,c){for(c=c||this.length;this.pos<c;){var m=this.readVarint(),x=m>>3,E=this.pos;this.type=7&m,a(x,u,this),this.pos===E&&this.skip(m)}return u},readMessage:function(a,u){return this.readFields(a,u,this.readVarint()+this.pos)},readFixed32:function(){var a=tn(this.buf,this.pos);return this.pos+=4,a},readSFixed32:function(){var a=en(this.buf,this.pos);return this.pos+=4,a},readFixed64:function(){var a=tn(this.buf,this.pos)+4294967296*tn(this.buf,this.pos+4);return this.pos+=8,a},readSFixed64:function(){var a=tn(this.buf,this.pos)+4294967296*en(this.buf,this.pos+4);return this.pos+=8,a},readFloat:function(){var a=Ut(this.buf,this.pos,!0,23,4);return this.pos+=4,a},readDouble:function(){var a=Ut(this.buf,this.pos,!0,52,8);return this.pos+=8,a},readVarint:function(a){var u,c,m=this.buf;return u=127&(c=m[this.pos++]),c<128?u:(u|=(127&(c=m[this.pos++]))<<7,c<128?u:(u|=(127&(c=m[this.pos++]))<<14,c<128?u:(u|=(127&(c=m[this.pos++]))<<21,c<128?u:function(x,E,A){var I,D,N=A.buf;if(I=(112&(D=N[A.pos++]))>>4,D<128||(I|=(127&(D=N[A.pos++]))<<3,D<128)||(I|=(127&(D=N[A.pos++]))<<10,D<128)||(I|=(127&(D=N[A.pos++]))<<17,D<128)||(I|=(127&(D=N[A.pos++]))<<24,D<128)||(I|=(1&(D=N[A.pos++]))<<31,D<128))return Zr(x,I,E);throw new Error("Expected varint not more than 10 bytes")}(u|=(15&(c=m[this.pos]))<<28,a,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var a=this.readVarint();return a%2==1?(a+1)/-2:a/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var a=this.readVarint()+this.pos,u=this.pos;return this.pos=a,a-u>=12&&Dr?function(c,m,x){return Dr.decode(c.subarray(m,x))}(this.buf,u,a):function(c,m,x){for(var E="",A=m;A<x;){var I,D,N,j=c[A],X=null,ee=j>239?4:j>223?3:j>191?2:1;if(A+ee>x)break;ee===1?j<128&&(X=j):ee===2?(192&(I=c[A+1]))==128&&(X=(31&j)<<6|63&I)<=127&&(X=null):ee===3?(D=c[A+2],(192&(I=c[A+1]))==128&&(192&D)==128&&((X=(15&j)<<12|(63&I)<<6|63&D)<=2047||X>=55296&&X<=57343)&&(X=null)):ee===4&&(D=c[A+2],N=c[A+3],(192&(I=c[A+1]))==128&&(192&D)==128&&(192&N)==128&&((X=(15&j)<<18|(63&I)<<12|(63&D)<<6|63&N)<=65535||X>=1114112)&&(X=null)),X===null?(X=65533,ee=1):X>65535&&(X-=65536,E+=String.fromCharCode(X>>>10&1023|55296),X=56320|1023&X),E+=String.fromCharCode(X),A+=ee}return E}(this.buf,u,a)},readBytes:function(){var a=this.readVarint()+this.pos,u=this.buf.subarray(this.pos,a);return this.pos=a,u},readPackedVarint:function(a,u){if(this.type!==kt.Bytes)return a.push(this.readVarint(u));var c=wr(this);for(a=a||[];this.pos<c;)a.push(this.readVarint(u));return a},readPackedSVarint:function(a){if(this.type!==kt.Bytes)return a.push(this.readSVarint());var u=wr(this);for(a=a||[];this.pos<u;)a.push(this.readSVarint());return a},readPackedBoolean:function(a){if(this.type!==kt.Bytes)return a.push(this.readBoolean());var u=wr(this);for(a=a||[];this.pos<u;)a.push(this.readBoolean());return a},readPackedFloat:function(a){if(this.type!==kt.Bytes)return a.push(this.readFloat());var u=wr(this);for(a=a||[];this.pos<u;)a.push(this.readFloat());return a},readPackedDouble:function(a){if(this.type!==kt.Bytes)return a.push(this.readDouble());var u=wr(this);for(a=a||[];this.pos<u;)a.push(this.readDouble());return a},readPackedFixed32:function(a){if(this.type!==kt.Bytes)return a.push(this.readFixed32());var u=wr(this);for(a=a||[];this.pos<u;)a.push(this.readFixed32());return a},readPackedSFixed32:function(a){if(this.type!==kt.Bytes)return a.push(this.readSFixed32());var u=wr(this);for(a=a||[];this.pos<u;)a.push(this.readSFixed32());return a},readPackedFixed64:function(a){if(this.type!==kt.Bytes)return a.push(this.readFixed64());var u=wr(this);for(a=a||[];this.pos<u;)a.push(this.readFixed64());return a},readPackedSFixed64:function(a){if(this.type!==kt.Bytes)return a.push(this.readSFixed64());var u=wr(this);for(a=a||[];this.pos<u;)a.push(this.readSFixed64());return a},skip:function(a){var u=7&a;if(u===kt.Varint)for(;this.buf[this.pos++]>127;);else if(u===kt.Bytes)this.pos=this.readVarint()+this.pos;else if(u===kt.Fixed32)this.pos+=4;else{if(u!==kt.Fixed64)throw new Error("Unimplemented type: "+u);this.pos+=8}},writeTag:function(a,u){this.writeVarint(a<<3|u)},realloc:function(a){for(var u=this.length||16;u<this.pos+a;)u*=2;if(u!==this.length){var c=new Uint8Array(u);c.set(this.buf),this.buf=c,this.length=u}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(a){this.realloc(4),Ir(this.buf,a,this.pos),this.pos+=4},writeSFixed32:function(a){this.realloc(4),Ir(this.buf,a,this.pos),this.pos+=4},writeFixed64:function(a){this.realloc(8),Ir(this.buf,-1&a,this.pos),Ir(this.buf,Math.floor(a*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(a){this.realloc(8),Ir(this.buf,-1&a,this.pos),Ir(this.buf,Math.floor(a*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(a){(a=+a||0)>268435455||a<0?function(u,c){var m,x;if(u>=0?(m=u%4294967296|0,x=u/4294967296|0):(x=~(-u/4294967296),4294967295^(m=~(-u%4294967296))?m=m+1|0:(m=0,x=x+1|0)),u>=18446744073709552e3||u<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");c.realloc(10),function(E,A,I){I.buf[I.pos++]=127&E|128,E>>>=7,I.buf[I.pos++]=127&E|128,E>>>=7,I.buf[I.pos++]=127&E|128,E>>>=7,I.buf[I.pos++]=127&E|128,I.buf[I.pos]=127&(E>>>=7)}(m,0,c),function(E,A){var I=(7&E)<<4;A.buf[A.pos++]|=I|((E>>>=3)?128:0),E&&(A.buf[A.pos++]=127&E|((E>>>=7)?128:0),E&&(A.buf[A.pos++]=127&E|((E>>>=7)?128:0),E&&(A.buf[A.pos++]=127&E|((E>>>=7)?128:0),E&&(A.buf[A.pos++]=127&E|((E>>>=7)?128:0),E&&(A.buf[A.pos++]=127&E)))))}(x,c)}(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))},writeSVarint:function(a){this.writeVarint(a<0?2*-a-1:2*a)},writeBoolean:function(a){this.writeVarint(!!a)},writeString:function(a){a=String(a),this.realloc(4*a.length),this.pos++;var u=this.pos;this.pos=function(m,x,E){for(var A,I,D=0;D<x.length;D++){if((A=x.charCodeAt(D))>55295&&A<57344){if(!I){A>56319||D+1===x.length?(m[E++]=239,m[E++]=191,m[E++]=189):I=A;continue}if(A<56320){m[E++]=239,m[E++]=191,m[E++]=189,I=A;continue}A=I-55296<<10|A-56320|65536,I=null}else I&&(m[E++]=239,m[E++]=191,m[E++]=189,I=null);A<128?m[E++]=A:(A<2048?m[E++]=A>>6|192:(A<65536?m[E++]=A>>12|224:(m[E++]=A>>18|240,m[E++]=A>>12&63|128),m[E++]=A>>6&63|128),m[E++]=63&A|128)}return E}(this.buf,a,this.pos);var c=this.pos-u;c>=128&&Br(u,c,this),this.pos=u-1,this.writeVarint(c),this.pos+=c},writeFloat:function(a){this.realloc(4),cr(this.buf,a,this.pos,!0,23,4),this.pos+=4},writeDouble:function(a){this.realloc(8),cr(this.buf,a,this.pos,!0,52,8),this.pos+=8},writeBytes:function(a){var u=a.length;this.writeVarint(u),this.realloc(u);for(var c=0;c<u;c++)this.buf[this.pos++]=a[c]},writeRawMessage:function(a,u){this.pos++;var c=this.pos;a(u,this);var m=this.pos-c;m>=128&&Br(c,m,this),this.pos=c-1,this.writeVarint(m),this.pos+=m},writeMessage:function(a,u,c){this.writeTag(a,kt.Bytes),this.writeRawMessage(u,c)},writePackedVarint:function(a,u){u.length&&this.writeMessage(a,Ur,u)},writePackedSVarint:function(a,u){u.length&&this.writeMessage(a,Wr,u)},writePackedBoolean:function(a,u){u.length&&this.writeMessage(a,St,u)},writePackedFloat:function(a,u){u.length&&this.writeMessage(a,Er,u)},writePackedDouble:function(a,u){u.length&&this.writeMessage(a,zr,u)},writePackedFixed32:function(a,u){u.length&&this.writeMessage(a,Qt,u)},writePackedSFixed32:function(a,u){u.length&&this.writeMessage(a,kr,u)},writePackedFixed64:function(a,u){u.length&&this.writeMessage(a,Jr,u)},writePackedSFixed64:function(a,u){u.length&&this.writeMessage(a,gr,u)},writeBytesField:function(a,u){this.writeTag(a,kt.Bytes),this.writeBytes(u)},writeFixed32Field:function(a,u){this.writeTag(a,kt.Fixed32),this.writeFixed32(u)},writeSFixed32Field:function(a,u){this.writeTag(a,kt.Fixed32),this.writeSFixed32(u)},writeFixed64Field:function(a,u){this.writeTag(a,kt.Fixed64),this.writeFixed64(u)},writeSFixed64Field:function(a,u){this.writeTag(a,kt.Fixed64),this.writeSFixed64(u)},writeVarintField:function(a,u){this.writeTag(a,kt.Varint),this.writeVarint(u)},writeSVarintField:function(a,u){this.writeTag(a,kt.Varint),this.writeSVarint(u)},writeStringField:function(a,u){this.writeTag(a,kt.Bytes),this.writeString(u)},writeFloatField:function(a,u){this.writeTag(a,kt.Fixed32),this.writeFloat(u)},writeDoubleField:function(a,u){this.writeTag(a,kt.Fixed64),this.writeDouble(u)},writeBooleanField:function(a,u){this.writeVarintField(a,!!u)}};var qr=function(a,u){var c=u.pixelRatio,m=u.version,x=u.stretchX,E=u.stretchY,A=u.content;this.paddedRect=a,this.pixelRatio=c,this.stretchX=x,this.stretchY=E,this.content=A,this.version=m},gt={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};gt.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},gt.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},gt.tlbr.get=function(){return this.tl.concat(this.br)},gt.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(qr.prototype,gt);var pr=function(a,u){var c={},m={};this.haveRenderCallbacks=[];var x=[];this.addImages(a,c,x),this.addImages(u,m,x);var E=ui(x),A=new Qo({width:E.w||1,height:E.h||1});for(var I in a){var D=a[I],N=c[I].paddedRect;Qo.copy(D.data,A,{x:0,y:0},{x:N.x+1,y:N.y+1},D.data)}for(var j in u){var X=u[j],ee=m[j].paddedRect,R=ee.x+1,Ce=ee.y+1,Oe=X.data.width,Qe=X.data.height;Qo.copy(X.data,A,{x:0,y:0},{x:R,y:Ce},X.data),Qo.copy(X.data,A,{x:0,y:Qe-1},{x:R,y:Ce-1},{width:Oe,height:1}),Qo.copy(X.data,A,{x:0,y:0},{x:R,y:Ce+Qe},{width:Oe,height:1}),Qo.copy(X.data,A,{x:Oe-1,y:0},{x:R-1,y:Ce},{width:1,height:Qe}),Qo.copy(X.data,A,{x:0,y:0},{x:R+Oe,y:Ce},{width:1,height:Qe})}this.image=A,this.iconPositions=c,this.patternPositions=m};pr.prototype.addImages=function(a,u,c){for(var m in a){var x=a[m],E={x:0,y:0,w:x.data.width+2,h:x.data.height+2};c.push(E),u[m]=new qr(E,x),x.hasRenderCallback&&this.haveRenderCallbacks.push(m)}},pr.prototype.patchUpdatedImages=function(a,u){for(var c in a.dispatchRenderCallbacks(this.haveRenderCallbacks),a.updatedImages)this.patchUpdatedImage(this.iconPositions[c],a.getImage(c),u),this.patchUpdatedImage(this.patternPositions[c],a.getImage(c),u)},pr.prototype.patchUpdatedImage=function(a,u,c){if(a&&u&&a.version!==u.version){a.version=u.version;var m=a.tl;c.update(u.data,void 0,{x:m[0],y:m[1]})}},vn("ImagePosition",qr),vn("ImageAtlas",pr);var tt={horizontal:1,vertical:2,horizontalOnly:3},wi=function(){this.scale=1,this.fontStack="",this.imageName=null};wi.forText=function(a,u){var c=new wi;return c.scale=a||1,c.fontStack=u,c},wi.forImage=function(a){var u=new wi;return u.imageName=a,u};var on=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function yi(a,u,c,m,x,E,A,I,D,N,j,X,ee,R,Ce,Oe){var Qe,He=on.fromFeature(a,x);X===tt.vertical&&He.verticalizePunctuation();var xt=Ie.processBidirectionalText,It=Ie.processStyledBidirectionalText;if(xt&&He.sections.length===1){Qe=[];for(var Vt=0,jt=xt(He.toString(),lo(He,N,E,u,m,R,Ce));Vt<jt.length;Vt+=1){var fr=jt[Vt],Lr=new on;Lr.text=fr,Lr.sections=He.sections;for(var Gr=0;Gr<fr.length;Gr++)Lr.sectionIndex.push(0);Qe.push(Lr)}}else if(It){Qe=[];for(var Dn=0,sn=It(He.text,He.sectionIndex,lo(He,N,E,u,m,R,Ce));Dn<sn.length;Dn+=1){var zn=sn[Dn],cn=new on;cn.text=zn[0],cn.sectionIndex=zn[1],cn.sections=He.sections,Qe.push(cn)}}else Qe=function(Tn,Ii){for(var gi=[],Bi=Tn.text,Zn=0,ra=0,Ua=Ii;ra<Ua.length;ra+=1){var Ja=Ua[ra];gi.push(Tn.substring(Zn,Ja)),Zn=Ja}return Zn<Bi.length&&gi.push(Tn.substring(Zn,Bi.length)),gi}(He,lo(He,N,E,u,m,R,Ce));var Ei=[],Qn={positionedLines:Ei,text:He.toString(),top:j[1],bottom:j[1],left:j[0],right:j[0],writingMode:X,iconsInText:!1,verticalizable:!1};return function(Tn,Ii,gi,Bi,Zn,ra,Ua,Ja,so,za,co,Go){for(var Uo=0,Zs=-17,Fa=0,Vs=0,bo=Ja==="right"?1:Ja==="left"?0:.5,rs=0,zi=0,fa=Zn;zi<fa.length;zi+=1){var va=fa[zi];va.trim();var Xi=va.getMaxScale(),js=24*(Xi-1),ns={positionedGlyphs:[],lineOffset:0};Tn.positionedLines[rs]=ns;var Ba=ns.positionedGlyphs,Po=0;if(va.length()){for(var ws=0;ws<va.length();ws++){var qi=va.getSection(ws),Zl=va.getSectionIndex(ws),su=va.getCharCode(ws),vl=0,eo=null,Vl=null,$u=null,Ef=24,pc=!(so===tt.horizontal||!co&&!Dc(su)||co&&(ai[su]||(Hc=su,Yr.Arabic(Hc)||Yr["Arabic Supplement"](Hc)||Yr["Arabic Extended-A"](Hc)||Yr["Arabic Presentation Forms-A"](Hc)||Yr["Arabic Presentation Forms-B"](Hc))));if(qi.imageName){var Cs=Bi[qi.imageName];if(!Cs)continue;$u=qi.imageName,Tn.iconsInText=Tn.iconsInText||!0,Vl=Cs.paddedRect;var dc=Cs.displaySize;qi.scale=24*qi.scale/Go,vl=js+(24-dc[1]*qi.scale),Ef=(eo={width:dc[0],height:dc[1],left:1,top:-3,advance:pc?dc[1]:dc[0]}).advance;var Jf=pc?dc[0]*qi.scale-24*Xi:dc[1]*qi.scale-24*Xi;Jf>0&&Jf>Po&&(Po=Jf)}else{var vc=gi[qi.fontStack],Ep=vc&&vc[su];if(Ep&&Ep.rect)Vl=Ep.rect,eo=Ep.metrics;else{var ed=Ii[qi.fontStack],Xd=ed&&ed[su];if(!Xd)continue;eo=Xd.metrics}vl=24*(Xi-qi.scale)}pc?(Tn.verticalizable=!0,Ba.push({glyph:su,imageName:$u,x:Uo,y:Zs+vl,vertical:pc,scale:qi.scale,fontStack:qi.fontStack,sectionIndex:Zl,metrics:eo,rect:Vl}),Uo+=Ef*qi.scale+za):(Ba.push({glyph:su,imageName:$u,x:Uo,y:Zs+vl,vertical:pc,scale:qi.scale,fontStack:qi.fontStack,sectionIndex:Zl,metrics:eo,rect:Vl}),Uo+=eo.advance*qi.scale+za)}Ba.length!==0&&(Fa=Math.max(Uo-za,Fa),go(Ba,0,Ba.length-1,bo,Po)),Uo=0;var td=ra*Xi+Po;ns.lineOffset=Math.max(Po,js),Zs+=td,Vs=Math.max(td,Vs),++rs}else Zs+=ra,++rs}var Hc,Sf=Zs- -17,Sp=Sa(Ua),eh=Sp.horizontalAlign,Ap=Sp.verticalAlign;(function(rd,$d,nd,id,Wc,Fh,th,Bh,rh){var nh,Tp=($d-nd)*Wc;nh=Fh!==th?-Bh*id- -17:(-id*rh+.5)*th;for(var Gc=0,Lh=rd;Gc<Lh.length;Gc+=1)for(var mc=0,ih=Lh[Gc].positionedGlyphs;mc<ih.length;mc+=1){var xu=ih[mc];xu.x+=Tp,xu.y+=nh}})(Tn.positionedLines,bo,eh,Ap,Fa,Vs,ra,Sf,Zn.length),Tn.top+=-Ap*Sf,Tn.bottom=Tn.top+Sf,Tn.left+=-eh*Fa,Tn.right=Tn.left+Fa}(Qn,u,c,m,Qe,A,I,D,X,N,ee,Oe),!function(Tn){for(var Ii=0,gi=Tn;Ii<gi.length;Ii+=1)if(gi[Ii].positionedGlyphs.length!==0)return!1;return!0}(Ei)&&Qn}on.fromFeature=function(a,u){for(var c=new on,m=0;m<a.sections.length;m++){var x=a.sections[m];x.image?c.addImageSection(x):c.addTextSection(x,u)}return c},on.prototype.length=function(){return this.text.length},on.prototype.getSection=function(a){return this.sections[this.sectionIndex[a]]},on.prototype.getSectionIndex=function(a){return this.sectionIndex[a]},on.prototype.getCharCode=function(a){return this.text.charCodeAt(a)},on.prototype.verticalizePunctuation=function(){this.text=function(a){for(var u="",c=0;c<a.length;c++){var m=a.charCodeAt(c+1)||null,x=a.charCodeAt(c-1)||null;u+=m&&wh(m)&&!Ze[a[c+1]]||x&&wh(x)&&!Ze[a[c-1]]||!Ze[a[c]]?a[c]:Ze[a[c]]}return u}(this.text)},on.prototype.trim=function(){for(var a=0,u=0;u<this.text.length&&ai[this.text.charCodeAt(u)];u++)a++;for(var c=this.text.length,m=this.text.length-1;m>=0&&m>=a&&ai[this.text.charCodeAt(m)];m--)c--;this.text=this.text.substring(a,c),this.sectionIndex=this.sectionIndex.slice(a,c)},on.prototype.substring=function(a,u){var c=new on;return c.text=this.text.substring(a,u),c.sectionIndex=this.sectionIndex.slice(a,u),c.sections=this.sections,c},on.prototype.toString=function(){return this.text},on.prototype.getMaxScale=function(){var a=this;return this.sectionIndex.reduce(function(u,c){return Math.max(u,a.sections[c].scale)},0)},on.prototype.addTextSection=function(a,u){this.text+=a.text,this.sections.push(wi.forText(a.scale,a.fontStack||u));for(var c=this.sections.length-1,m=0;m<a.text.length;++m)this.sectionIndex.push(c)},on.prototype.addImageSection=function(a){var u=a.image?a.image.name:"";if(u.length!==0){var c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCharCode(c),this.sections.push(wi.forImage(u)),this.sectionIndex.push(this.sections.length-1)):ft("Reached maximum number of images 6401")}else ft("Can't add FormattedSection with an empty image.")},on.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var ai={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Yn={};function Ui(a,u,c,m,x,E){if(u.imageName){var A=m[u.imageName];return A?A.displaySize[0]*u.scale*24/E+x:0}var I=c[u.fontStack],D=I&&I[a];return D?D.metrics.advance*u.scale+x:0}function mo(a,u,c,m){var x=Math.pow(a-u,2);return m?a<u?x/2:2*x:x+Math.abs(c)*c}function Wo(a,u,c){var m=0;return a===10&&(m-=1e4),c&&(m+=150),a!==40&&a!==65288||(m+=50),u!==41&&u!==65289||(m+=50),m}function Ri(a,u,c,m,x,E){for(var A=null,I=mo(u,c,x,E),D=0,N=m;D<N.length;D+=1){var j=N[D],X=mo(u-j.x,c,x,E)+j.badness;X<=I&&(A=j,I=X)}return{index:a,x:u,priorBreak:A,badness:I}}function lo(a,u,c,m,x,E,A){if(E!=="point")return[];if(!a)return[];for(var I,D=[],N=function(Qe,He,xt,It,Vt,jt){for(var fr=0,Lr=0;Lr<Qe.length();Lr++){var Gr=Qe.getSection(Lr);fr+=Ui(Qe.getCharCode(Lr),Gr,It,Vt,He,jt)}return fr/Math.max(1,Math.ceil(fr/xt))}(a,u,c,m,x,A),j=a.text.indexOf("\u200B")>=0,X=0,ee=0;ee<a.length();ee++){var R=a.getSection(ee),Ce=a.getCharCode(ee);if(ai[Ce]||(X+=Ui(Ce,R,m,x,u,A)),ee<a.length()-1){var Oe=!((I=Ce)<11904||!(Yr["Bopomofo Extended"](I)||Yr.Bopomofo(I)||Yr["CJK Compatibility Forms"](I)||Yr["CJK Compatibility Ideographs"](I)||Yr["CJK Compatibility"](I)||Yr["CJK Radicals Supplement"](I)||Yr["CJK Strokes"](I)||Yr["CJK Symbols and Punctuation"](I)||Yr["CJK Unified Ideographs Extension A"](I)||Yr["CJK Unified Ideographs"](I)||Yr["Enclosed CJK Letters and Months"](I)||Yr["Halfwidth and Fullwidth Forms"](I)||Yr.Hiragana(I)||Yr["Ideographic Description Characters"](I)||Yr["Kangxi Radicals"](I)||Yr["Katakana Phonetic Extensions"](I)||Yr.Katakana(I)||Yr["Vertical Forms"](I)||Yr["Yi Radicals"](I)||Yr["Yi Syllables"](I)));(Yn[Ce]||Oe||R.imageName)&&D.push(Ri(ee+1,X,N,D,Wo(Ce,a.getCharCode(ee+1),Oe&&j),!1))}}return function Qe(He){return He?Qe(He.priorBreak).concat(He.index):[]}(Ri(a.length(),X,N,D,0,!0))}function Sa(a){var u=.5,c=.5;switch(a){case"right":case"top-right":case"bottom-right":u=1;break;case"left":case"top-left":case"bottom-left":u=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":c=1;break;case"top":case"top-right":case"top-left":c=0}return{horizontalAlign:u,verticalAlign:c}}function go(a,u,c,m,x){if(m||x)for(var E=a[c],A=(a[c].x+E.metrics.advance*E.scale)*m,I=u;I<=c;I++)a[I].x-=A,a[I].y+=x}function _o(a,u,c,m,x,E){var A,I=a.image;if(I.content){var D=I.content,N=I.pixelRatio||1;A=[D[0]/N,D[1]/N,I.displaySize[0]-D[2]/N,I.displaySize[1]-D[3]/N]}var j,X,ee,R,Ce=u.left*E,Oe=u.right*E;c==="width"||c==="both"?(R=x[0]+Ce-m[3],X=x[0]+Oe+m[1]):X=(R=x[0]+(Ce+Oe-I.displaySize[0])/2)+I.displaySize[0];var Qe=u.top*E,He=u.bottom*E;return c==="height"||c==="both"?(j=x[1]+Qe-m[0],ee=x[1]+He+m[2]):ee=(j=x[1]+(Qe+He-I.displaySize[1])/2)+I.displaySize[1],{image:I,top:j,right:X,bottom:ee,left:R,collisionPadding:A}}Yn[10]=!0,Yn[32]=!0,Yn[38]=!0,Yn[40]=!0,Yn[41]=!0,Yn[43]=!0,Yn[45]=!0,Yn[47]=!0,Yn[173]=!0,Yn[183]=!0,Yn[8203]=!0,Yn[8208]=!0,Yn[8211]=!0,Yn[8231]=!0;var Qa=function(a){function u(c,m,x,E){a.call(this,c,m),this.angle=x,E!==void 0&&(this.segment=E)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.clone=function(){return new u(this.x,this.y,this.angle,this.segment)},u}(ae);function Ro(a,u){var c=u.expression;if(c.kind==="constant")return{kind:"constant",layoutSize:c.evaluate(new B(a+1))};if(c.kind==="source")return{kind:"source"};for(var m=c.zoomStops,x=c.interpolationType,E=0;E<m.length&&m[E]<=a;)E++;for(var A=E=Math.max(0,E-1);A<m.length&&m[A]<a+1;)A++;A=Math.min(m.length-1,A);var I=m[E],D=m[A];return c.kind==="composite"?{kind:"composite",minZoom:I,maxZoom:D,interpolationType:x}:{kind:"camera",minZoom:I,maxZoom:D,minSize:c.evaluate(new B(I)),maxSize:c.evaluate(new B(D)),interpolationType:x}}function ps(a,u,c){var m=u.uSize,x=c.lowerSize;return a.kind==="source"?x/128:a.kind==="composite"?Ya(x/128,c.upperSize/128,u.uSizeT):m}function Mo(a,u){var c=0,m=0;if(a.kind==="constant")m=a.layoutSize;else if(a.kind!=="source"){var x=a.interpolationType,E=x?Dt(Ho.interpolationFactor(x,u,a.minZoom,a.maxZoom),0,1):0;a.kind==="camera"?m=Ya(a.minSize,a.maxSize,E):c=E}return{uSizeT:c,uSize:m}}vn("Anchor",Qa);var xi=Object.freeze({__proto__:null,getSizeData:Ro,evaluateSizeForFeature:ps,evaluateSizeForZoom:Mo,SIZE_PACK_FACTOR:128});function es(a,u,c,m,x){if(u.segment===void 0)return!0;for(var E=u,A=u.segment+1,I=0;I>-c/2;){if(--A<0)return!1;I-=a[A].dist(E),E=a[A]}I+=a[A].dist(a[A+1]),A++;for(var D=[],N=0;I<c/2;){var j=a[A],X=a[A+1];if(!X)return!1;var ee=a[A-1].angleTo(j)-j.angleTo(X);for(ee=Math.abs((ee+3*Math.PI)%(2*Math.PI)-Math.PI),D.push({distance:I,angleDelta:ee}),N+=ee;I-D[0].distance>m;)N-=D.shift().angleDelta;if(N>x)return!1;A++,I+=j.dist(X)}return!0}function aa(a){for(var u=0,c=0;c<a.length-1;c++)u+=a[c].dist(a[c+1]);return u}function Wn(a,u,c){return a?.6*u*c:0}function Mi(a,u){return Math.max(a?a.right-a.left:0,u?u.right-u.left:0)}function Gi(a,u,c,m,x,E){for(var A=Wn(c,x,E),I=Mi(c,m)*E,D=0,N=aa(a)/2,j=0;j<a.length-1;j++){var X=a[j],ee=a[j+1],R=X.dist(ee);if(D+R>N){var Ce=(N-D)/R,Oe=Ya(X.x,ee.x,Ce),Qe=Ya(X.y,ee.y,Ce),He=new Qa(Oe,Qe,ee.angleTo(X),j);return He._round(),!A||es(a,He,I,A,u)?He:void 0}D+=R}}function yo(a,u,c,m,x,E,A,I,D){var N=Wn(m,E,A),j=Mi(m,x),X=j*A,ee=a[0].x===0||a[0].x===D||a[0].y===0||a[0].y===D;return u-X<u/4&&(u=X+u/4),function R(Ce,Oe,Qe,He,xt,It,Vt,jt,fr){for(var Lr=It/2,Gr=aa(Ce),Dn=0,sn=Oe-Qe,zn=[],cn=0;cn<Ce.length-1;cn++){for(var Ei=Ce[cn],Qn=Ce[cn+1],Tn=Ei.dist(Qn),Ii=Qn.angleTo(Ei);sn+Qe<Dn+Tn;){var gi=((sn+=Qe)-Dn)/Tn,Bi=Ya(Ei.x,Qn.x,gi),Zn=Ya(Ei.y,Qn.y,gi);if(Bi>=0&&Bi<fr&&Zn>=0&&Zn<fr&&sn-Lr>=0&&sn+Lr<=Gr){var ra=new Qa(Bi,Zn,Ii,cn);ra._round(),He&&!es(Ce,ra,It,He,xt)||zn.push(ra)}}Dn+=Tn}return jt||zn.length||Vt||(zn=R(Ce,Dn/2,Qe,He,xt,It,Vt,!0,fr)),zn}(a,ee?u/2*I%u:(j/2+2*E)*A*I%u,u,N,c,X,ee,!1,D)}function Xu(a,u,c,m,x){for(var E=[],A=0;A<a.length;A++)for(var I=a[A],D=void 0,N=0;N<I.length-1;N++){var j=I[N],X=I[N+1];j.x<u&&X.x<u||(j.x<u?j=new ae(u,j.y+(u-j.x)/(X.x-j.x)*(X.y-j.y))._round():X.x<u&&(X=new ae(u,j.y+(u-j.x)/(X.x-j.x)*(X.y-j.y))._round()),j.y<c&&X.y<c||(j.y<c?j=new ae(j.x+(c-j.y)/(X.y-j.y)*(X.x-j.x),c)._round():X.y<c&&(X=new ae(j.x+(c-j.y)/(X.y-j.y)*(X.x-j.x),c)._round()),j.x>=m&&X.x>=m||(j.x>=m?j=new ae(m,j.y+(m-j.x)/(X.x-j.x)*(X.y-j.y))._round():X.x>=m&&(X=new ae(m,j.y+(m-j.x)/(X.x-j.x)*(X.y-j.y))._round()),j.y>=x&&X.y>=x||(j.y>=x?j=new ae(j.x+(x-j.y)/(X.y-j.y)*(X.x-j.x),x)._round():X.y>=x&&(X=new ae(j.x+(x-j.y)/(X.y-j.y)*(X.x-j.x),x)._round()),D&&j.equals(D[D.length-1])||E.push(D=[j]),D.push(X)))))}return E}function ke(a,u,c,m){var x=[],E=a.image,A=E.pixelRatio,I=E.paddedRect.w-2,D=E.paddedRect.h-2,N=a.right-a.left,j=a.bottom-a.top,X=E.stretchX||[[0,I]],ee=E.stretchY||[[0,D]],R=function(Bi,Zn){return Bi+Zn[1]-Zn[0]},Ce=X.reduce(R,0),Oe=ee.reduce(R,0),Qe=I-Ce,He=D-Oe,xt=0,It=Ce,Vt=0,jt=Oe,fr=0,Lr=Qe,Gr=0,Dn=He;if(E.content&&m){var sn=E.content;xt=Zt(X,0,sn[0]),Vt=Zt(ee,0,sn[1]),It=Zt(X,sn[0],sn[2]),jt=Zt(ee,sn[1],sn[3]),fr=sn[0]-xt,Gr=sn[1]-Vt,Lr=sn[2]-sn[0]-It,Dn=sn[3]-sn[1]-jt}var zn=function(Bi,Zn,ra,Ua){var Ja=ln(Bi.stretch-xt,It,N,a.left),so=bi(Bi.fixed-fr,Lr,Bi.stretch,Ce),za=ln(Zn.stretch-Vt,jt,j,a.top),co=bi(Zn.fixed-Gr,Dn,Zn.stretch,Oe),Go=ln(ra.stretch-xt,It,N,a.left),Uo=bi(ra.fixed-fr,Lr,ra.stretch,Ce),Zs=ln(Ua.stretch-Vt,jt,j,a.top),Fa=bi(Ua.fixed-Gr,Dn,Ua.stretch,Oe),Vs=new ae(Ja,za),bo=new ae(Go,za),rs=new ae(Go,Zs),zi=new ae(Ja,Zs),fa=new ae(so/A,co/A),va=new ae(Uo/A,Fa/A),Xi=u*Math.PI/180;if(Xi){var js=Math.sin(Xi),ns=Math.cos(Xi),Ba=[ns,-js,js,ns];Vs._matMult(Ba),bo._matMult(Ba),zi._matMult(Ba),rs._matMult(Ba)}var Po=Bi.stretch+Bi.fixed,ws=Zn.stretch+Zn.fixed;return{tl:Vs,tr:bo,bl:zi,br:rs,tex:{x:E.paddedRect.x+1+Po,y:E.paddedRect.y+1+ws,w:ra.stretch+ra.fixed-Po,h:Ua.stretch+Ua.fixed-ws},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:fa,pixelOffsetBR:va,minFontScaleX:Lr/A/N,minFontScaleY:Dn/A/j,isSDF:c}};if(m&&(E.stretchX||E.stretchY))for(var cn=Bt(X,Qe,Ce),Ei=Bt(ee,He,Oe),Qn=0;Qn<cn.length-1;Qn++)for(var Tn=cn[Qn],Ii=cn[Qn+1],gi=0;gi<Ei.length-1;gi++)x.push(zn(Tn,Ei[gi],Ii,Ei[gi+1]));else x.push(zn({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:I+1},{fixed:0,stretch:D+1}));return x}function Zt(a,u,c){for(var m=0,x=0,E=a;x<E.length;x+=1){var A=E[x];m+=Math.max(u,Math.min(c,A[1]))-Math.max(u,Math.min(c,A[0]))}return m}function Bt(a,u,c){for(var m=[{fixed:-1,stretch:0}],x=0,E=a;x<E.length;x+=1){var A=E[x],I=A[0],D=A[1],N=m[m.length-1];m.push({fixed:I-N.stretch,stretch:N.stretch}),m.push({fixed:I-N.stretch,stretch:N.stretch+(D-I)})}return m.push({fixed:u+1,stretch:c}),m}function ln(a,u,c,m){return a/u*c+m}function bi(a,u,c,m){return a-u*c/m}var da=function(a,u,c,m,x,E,A,I,D,N){if(this.boxStartIndex=a.length,D){var j=E.top,X=E.bottom,ee=E.collisionPadding;ee&&(j-=ee[1],X+=ee[3]);var R=X-j;R>0&&(R=Math.max(10,R),this.circleDiameter=R)}else{var Ce=E.top*A-I,Oe=E.bottom*A+I,Qe=E.left*A-I,He=E.right*A+I,xt=E.collisionPadding;if(xt&&(Qe-=xt[0]*A,Ce-=xt[1]*A,He+=xt[2]*A,Oe+=xt[3]*A),N){var It=new ae(Qe,Ce),Vt=new ae(He,Ce),jt=new ae(Qe,Oe),fr=new ae(He,Oe),Lr=N*Math.PI/180;It._rotate(Lr),Vt._rotate(Lr),jt._rotate(Lr),fr._rotate(Lr),Qe=Math.min(It.x,Vt.x,jt.x,fr.x),He=Math.max(It.x,Vt.x,jt.x,fr.x),Ce=Math.min(It.y,Vt.y,jt.y,fr.y),Oe=Math.max(It.y,Vt.y,jt.y,fr.y)}a.emplaceBack(u.x,u.y,Qe,Ce,He,Oe,c,m,x)}this.boxEndIndex=a.length},ue=function(a,u){if(a===void 0&&(a=[]),u===void 0&&(u=Se),this.data=a,this.length=this.data.length,this.compare=u,this.length>0)for(var c=(this.length>>1)-1;c>=0;c--)this._down(c)};function Se(a,u){return a<u?-1:a>u?1:0}function ze(a,u,c){u===void 0&&(u=1),c===void 0&&(c=!1);for(var m=1/0,x=1/0,E=-1/0,A=-1/0,I=a[0],D=0;D<I.length;D++){var N=I[D];(!D||N.x<m)&&(m=N.x),(!D||N.y<x)&&(x=N.y),(!D||N.x>E)&&(E=N.x),(!D||N.y>A)&&(A=N.y)}var j=Math.min(E-m,A-x),X=j/2,ee=new ue([],Lt);if(j===0)return new ae(m,x);for(var R=m;R<E;R+=j)for(var Ce=x;Ce<A;Ce+=j)ee.push(new Ft(R+X,Ce+X,X,a));for(var Oe=function(xt){for(var It=0,Vt=0,jt=0,fr=xt[0],Lr=0,Gr=fr.length,Dn=Gr-1;Lr<Gr;Dn=Lr++){var sn=fr[Lr],zn=fr[Dn],cn=sn.x*zn.y-zn.x*sn.y;Vt+=(sn.x+zn.x)*cn,jt+=(sn.y+zn.y)*cn,It+=3*cn}return new Ft(Vt/It,jt/It,0,xt)}(a),Qe=ee.length;ee.length;){var He=ee.pop();(He.d>Oe.d||!Oe.d)&&(Oe=He,c&&console.log("found best %d after %d probes",Math.round(1e4*He.d)/1e4,Qe)),He.max-Oe.d<=u||(ee.push(new Ft(He.p.x-(X=He.h/2),He.p.y-X,X,a)),ee.push(new Ft(He.p.x+X,He.p.y-X,X,a)),ee.push(new Ft(He.p.x-X,He.p.y+X,X,a)),ee.push(new Ft(He.p.x+X,He.p.y+X,X,a)),Qe+=4)}return c&&(console.log("num probes: "+Qe),console.log("best distance: "+Oe.d)),Oe.p}function Lt(a,u){return u.max-a.max}function Ft(a,u,c,m){this.p=new ae(a,u),this.h=c,this.d=function(x,E){for(var A=!1,I=1/0,D=0;D<E.length;D++)for(var N=E[D],j=0,X=N.length,ee=X-1;j<X;ee=j++){var R=N[j],Ce=N[ee];R.y>x.y!=Ce.y>x.y&&x.x<(Ce.x-R.x)*(x.y-R.y)/(Ce.y-R.y)+R.x&&(A=!A),I=Math.min(I,Fl(x,R,Ce))}return(A?1:-1)*Math.sqrt(I)}(this.p,m),this.max=this.d+this.h*Math.SQRT2}ue.prototype.push=function(a){this.data.push(a),this.length++,this._up(this.length-1)},ue.prototype.pop=function(){if(this.length!==0){var a=this.data[0],u=this.data.pop();return this.length--,this.length>0&&(this.data[0]=u,this._down(0)),a}},ue.prototype.peek=function(){return this.data[0]},ue.prototype._up=function(a){for(var u=this.data,c=this.compare,m=u[a];a>0;){var x=a-1>>1,E=u[x];if(c(m,E)>=0)break;u[a]=E,a=x}u[a]=m},ue.prototype._down=function(a){for(var u=this.data,c=this.compare,m=this.length>>1,x=u[a];a<m;){var E=1+(a<<1),A=u[E],I=E+1;if(I<this.length&&c(u[I],A)<0&&(E=I,A=u[I]),c(A,x)>=0)break;u[a]=A,a=E}u[a]=x};var Ye=Number.POSITIVE_INFINITY;function st(a,u){return u[1]!==Ye?function(c,m,x){var E=0,A=0;switch(m=Math.abs(m),x=Math.abs(x),c){case"top-right":case"top-left":case"top":A=x-7;break;case"bottom-right":case"bottom-left":case"bottom":A=7-x}switch(c){case"top-right":case"bottom-right":case"right":E=-m;break;case"top-left":case"bottom-left":case"left":E=m}return[E,A]}(a,u[0],u[1]):function(c,m){var x=0,E=0;m<0&&(m=0);var A=m/Math.sqrt(2);switch(c){case"top-right":case"top-left":E=A-7;break;case"bottom-right":case"bottom-left":E=7-A;break;case"bottom":E=7-m;break;case"top":E=m-7}switch(c){case"top-right":case"bottom-right":x=-A;break;case"top-left":case"bottom-left":x=A;break;case"left":x=m;break;case"right":x=-m}return[x,E]}(a,u[0])}function pt(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Me(a,u,c,m,x,E,A,I,D,N,j,X,ee,R,Ce){var Oe=function(Vt,jt,fr,Lr,Gr,Dn,sn,zn){for(var cn=Lr.layout.get("text-rotate").evaluate(Dn,{})*Math.PI/180,Ei=[],Qn=0,Tn=jt.positionedLines;Qn<Tn.length;Qn+=1)for(var Ii=Tn[Qn],gi=0,Bi=Ii.positionedGlyphs;gi<Bi.length;gi+=1){var Zn=Bi[gi];if(Zn.rect){var ra=Zn.rect||{},Ua=4,Ja=!0,so=1,za=0,co=(Gr||zn)&&Zn.vertical,Go=Zn.metrics.advance*Zn.scale/2;if(zn&&jt.verticalizable&&(za=Ii.lineOffset/2-(Zn.imageName?-(24-Zn.metrics.width*Zn.scale)/2:24*(Zn.scale-1))),Zn.imageName){var Uo=sn[Zn.imageName];Ja=Uo.sdf,Ua=1/(so=Uo.pixelRatio)}var Zs=Gr?[Zn.x+Go,Zn.y]:[0,0],Fa=Gr?[0,0]:[Zn.x+Go+fr[0],Zn.y+fr[1]-za],Vs=[0,0];co&&(Vs=Fa,Fa=[0,0]);var bo=(Zn.metrics.left-Ua)*Zn.scale-Go+Fa[0],rs=(-Zn.metrics.top-Ua)*Zn.scale+Fa[1],zi=bo+ra.w*Zn.scale/so,fa=rs+ra.h*Zn.scale/so,va=new ae(bo,rs),Xi=new ae(zi,rs),js=new ae(bo,fa),ns=new ae(zi,fa);if(co){var Ba=new ae(-Go,Go- -17),Po=-Math.PI/2,ws=12-Go,qi=new ae(22-ws,-(Zn.imageName?ws:0)),Zl=new(Function.prototype.bind.apply(ae,[null].concat(Vs)));va._rotateAround(Po,Ba)._add(qi)._add(Zl),Xi._rotateAround(Po,Ba)._add(qi)._add(Zl),js._rotateAround(Po,Ba)._add(qi)._add(Zl),ns._rotateAround(Po,Ba)._add(qi)._add(Zl)}if(cn){var su=Math.sin(cn),vl=Math.cos(cn),eo=[vl,-su,su,vl];va._matMult(eo),Xi._matMult(eo),js._matMult(eo),ns._matMult(eo)}var Vl=new ae(0,0),$u=new ae(0,0);Ei.push({tl:va,tr:Xi,bl:js,br:ns,tex:ra,writingMode:jt.writingMode,glyphOffset:Zs,sectionIndex:Zn.sectionIndex,isSDF:Ja,pixelOffsetTL:Vl,pixelOffsetBR:$u,minFontScaleX:0,minFontScaleY:0})}}return Ei}(0,c,I,x,E,A,m,a.allowVerticalPlacement),Qe=a.textSizeData,He=null;Qe.kind==="source"?(He=[128*x.layout.get("text-size").evaluate(A,{})])[0]>32640&&ft(a.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):Qe.kind==="composite"&&((He=[128*R.compositeTextSizes[0].evaluate(A,{},Ce),128*R.compositeTextSizes[1].evaluate(A,{},Ce)])[0]>32640||He[1]>32640)&&ft(a.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),a.addSymbols(a.text,Oe,He,I,E,A,N,u,D.lineStartIndex,D.lineLength,ee,Ce);for(var xt=0,It=j;xt<It.length;xt+=1)X[It[xt]]=a.text.placedSymbolArray.length-1;return 4*Oe.length}function rt(a){for(var u in a)return a[u];return null}function ve(a,u,c,m){var x=a.compareText;if(u in x){for(var E=x[u],A=E.length-1;A>=0;A--)if(m.dist(E[A])<c)return!0}else x[u]=[];return x[u].push(m),!1}var at=Ul.VectorTileFeature.types,Gt=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function or(a,u,c,m,x,E,A,I,D,N,j,X,ee){var R=I?Math.min(32640,Math.round(I[0])):0,Ce=I?Math.min(32640,Math.round(I[1])):0;a.emplaceBack(u,c,Math.round(32*m),Math.round(32*x),E,A,(R<<1)+(D?1:0),Ce,16*N,16*j,256*X,256*ee)}function _r(a,u,c){a.emplaceBack(u.x,u.y,c),a.emplaceBack(u.x,u.y,c),a.emplaceBack(u.x,u.y,c),a.emplaceBack(u.x,u.y,c)}function vr(a){for(var u=0,c=a.sections;u<c.length;u+=1)if(Nf(c[u].text))return!0;return!1}var Rr=function(a){this.layoutVertexArray=new Zf,this.indexArray=new zu,this.programConfigurations=a,this.segments=new ge,this.dynamicLayoutVertexArray=new Fc,this.opacityVertexArray=new cf,this.placedSymbolArray=new g};Rr.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},Rr.prototype.upload=function(a,u,c,m){this.isEmpty()||(c&&(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,zv.members),this.indexBuffer=a.createIndexBuffer(this.indexArray,u),this.dynamicLayoutVertexBuffer=a.createVertexBuffer(this.dynamicLayoutVertexArray,Zv.members,!0),this.opacityVertexBuffer=a.createVertexBuffer(this.opacityVertexArray,Gt,!0),this.opacityVertexBuffer.itemSize=1),(c||m)&&this.programConfigurations.upload(a))},Rr.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},vn("SymbolBuffers",Rr);var Pn=function(a,u,c){this.layoutVertexArray=new a,this.layoutAttributes=u,this.indexArray=new c,this.segments=new ge,this.collisionVertexArray=new Uu};Pn.prototype.upload=function(a){this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=a.createVertexBuffer(this.collisionVertexArray,zd.members,!0)},Pn.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},vn("CollisionBuffers",Pn);var _n=function(a){this.collisionBoxArray=a.collisionBoxArray,this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(E){return E.id}),this.index=a.index,this.pixelRatio=a.pixelRatio,this.sourceLayerIndex=a.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=po([]),this.placementViewportMatrix=po([]);var u=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Ro(this.zoom,u["text-size"]),this.iconSizeData=Ro(this.zoom,u["icon-size"]);var c=this.layers[0].layout,m=c.get("symbol-sort-key"),x=c.get("symbol-z-order");this.canOverlap=c.get("text-allow-overlap")||c.get("icon-allow-overlap")||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey=x!=="viewport-y"&&m.constantOr(1)!==void 0,this.sortFeaturesByY=(x==="viewport-y"||x==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,c.get("symbol-placement")==="point"&&(this.writingModes=c.get("text-writing-mode").map(function(E){return tt[E]})),this.stateDependentLayerIds=this.layers.filter(function(E){return E.isStateDependent()}).map(function(E){return E.id}),this.sourceID=a.sourceID};_n.prototype.createArrays=function(){this.text=new Rr(new $n(this.layers,this.zoom,function(a){return/^text/.test(a)})),this.icon=new Rr(new $n(this.layers,this.zoom,function(a){return/^icon/.test(a)})),this.glyphOffsetArray=new C,this.lineVertexArray=new P,this.symbolInstances=new w},_n.prototype.calculateGlyphDependencies=function(a,u,c,m,x){for(var E=0;E<a.length;E++)if(u[a.charCodeAt(E)]=!0,(c||m)&&x){var A=Ze[a.charAt(E)];A&&(u[A.charCodeAt(0)]=!0)}},_n.prototype.populate=function(a,u,c){var m=this.layers[0],x=m.layout,E=x.get("text-font"),A=x.get("text-field"),I=x.get("icon-image"),D=(A.value.kind!=="constant"||A.value.value instanceof ma&&!A.value.value.isEmpty()||A.value.value.toString().length>0)&&(E.value.kind!=="constant"||E.value.value.length>0),N=I.value.kind!=="constant"||!!I.value.value||Object.keys(I.parameters).length>0,j=x.get("symbol-sort-key");if(this.features=[],D||N){for(var X=u.iconDependencies,ee=u.glyphDependencies,R=u.availableImages,Ce=new B(this.zoom),Oe=0,Qe=a;Oe<Qe.length;Oe+=1){var He=Qe[Oe],xt=He.feature,It=He.id,Vt=He.index,jt=He.sourceLayerIndex,fr=m._featureFilter.needGeometry,Lr=Ga(xt,fr);if(m._featureFilter.filter(Ce,Lr,c)){fr||(Lr.geometry=Wa(xt));var Gr=void 0;if(D){var Dn=m.getValueAndResolveTokens("text-field",Lr,c,R),sn=ma.factory(Dn);vr(sn)&&(this.hasRTLText=!0),(!this.hasRTLText||up()==="unavailable"||this.hasRTLText&&Ie.isParsed())&&(Gr=Ee(sn,m,Lr))}var zn=void 0;if(N){var cn=m.getValueAndResolveTokens("icon-image",Lr,c,R);zn=cn instanceof Aa?cn:Aa.fromString(cn)}if(Gr||zn){var Ei=this.sortFeaturesByKey?j.evaluate(Lr,{},c):void 0;if(this.features.push({id:It,text:Gr,icon:zn,index:Vt,sourceLayerIndex:jt,geometry:Lr.geometry,properties:xt.properties,type:at[xt.type],sortKey:Ei}),zn&&(X[zn.name]=!0),Gr){var Qn=E.evaluate(Lr,{},c).join(","),Tn=x.get("text-rotation-alignment")==="map"&&x.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(tt.vertical)>=0;for(var Ii=0,gi=Gr.sections;Ii<gi.length;Ii+=1){var Bi=gi[Ii];if(Bi.image)X[Bi.image.name]=!0;else{var Zn=ol(Gr.toString()),ra=Bi.fontStack||Qn,Ua=ee[ra]=ee[ra]||{};this.calculateGlyphDependencies(Bi.text,Ua,Tn,this.allowVerticalPlacement,Zn)}}}}}}x.get("symbol-placement")==="line"&&(this.features=function(Ja){var so={},za={},co=[],Go=0;function Uo(Ba){co.push(Ja[Ba]),Go++}function Zs(Ba,Po,ws){var qi=za[Ba];return delete za[Ba],za[Po]=qi,co[qi].geometry[0].pop(),co[qi].geometry[0]=co[qi].geometry[0].concat(ws[0]),qi}function Fa(Ba,Po,ws){var qi=so[Po];return delete so[Po],so[Ba]=qi,co[qi].geometry[0].shift(),co[qi].geometry[0]=ws[0].concat(co[qi].geometry[0]),qi}function Vs(Ba,Po,ws){var qi=ws?Po[0][Po[0].length-1]:Po[0][0];return Ba+":"+qi.x+":"+qi.y}for(var bo=0;bo<Ja.length;bo++){var rs=Ja[bo],zi=rs.geometry,fa=rs.text?rs.text.toString():null;if(fa){var va=Vs(fa,zi),Xi=Vs(fa,zi,!0);if(va in za&&Xi in so&&za[va]!==so[Xi]){var js=Fa(va,Xi,zi),ns=Zs(va,Xi,co[js].geometry);delete so[va],delete za[Xi],za[Vs(fa,co[ns].geometry,!0)]=ns,co[js].geometry=null}else va in za?Zs(va,Xi,zi):Xi in so?Fa(va,Xi,zi):(Uo(bo),so[va]=Go-1,za[Xi]=Go-1)}else Uo(bo)}return co.filter(function(Ba){return Ba.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(Ja,so){return Ja.sortKey-so.sortKey})}},_n.prototype.update=function(a,u,c){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(a,u,this.layers,c),this.icon.programConfigurations.updatePaintArrays(a,u,this.layers,c))},_n.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},_n.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},_n.prototype.upload=function(a){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(a),this.iconCollisionBox.upload(a)),this.text.upload(a,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(a,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},_n.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},_n.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},_n.prototype.addToLineVertexArray=function(a,u){var c=this.lineVertexArray.length;if(a.segment!==void 0){for(var m=a.dist(u[a.segment+1]),x=a.dist(u[a.segment]),E={},A=a.segment+1;A<u.length;A++)E[A]={x:u[A].x,y:u[A].y,tileUnitDistanceFromAnchor:m},A<u.length-1&&(m+=u[A+1].dist(u[A]));for(var I=a.segment||0;I>=0;I--)E[I]={x:u[I].x,y:u[I].y,tileUnitDistanceFromAnchor:x},I>0&&(x+=u[I-1].dist(u[I]));for(var D=0;D<u.length;D++){var N=E[D];this.lineVertexArray.emplaceBack(N.x,N.y,N.tileUnitDistanceFromAnchor)}}return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}},_n.prototype.addSymbols=function(a,u,c,m,x,E,A,I,D,N,j,X){for(var ee=a.indexArray,R=a.layoutVertexArray,Ce=a.segments.prepareSegment(4*u.length,R,ee,this.canOverlap?E.sortKey:void 0),Oe=this.glyphOffsetArray.length,Qe=Ce.vertexLength,He=this.allowVerticalPlacement&&A===tt.vertical?Math.PI/2:0,xt=E.text&&E.text.sections,It=0;It<u.length;It++){var Vt=u[It],jt=Vt.tl,fr=Vt.tr,Lr=Vt.bl,Gr=Vt.br,Dn=Vt.tex,sn=Vt.pixelOffsetTL,zn=Vt.pixelOffsetBR,cn=Vt.minFontScaleX,Ei=Vt.minFontScaleY,Qn=Vt.glyphOffset,Tn=Vt.isSDF,Ii=Vt.sectionIndex,gi=Ce.vertexLength,Bi=Qn[1];or(R,I.x,I.y,jt.x,Bi+jt.y,Dn.x,Dn.y,c,Tn,sn.x,sn.y,cn,Ei),or(R,I.x,I.y,fr.x,Bi+fr.y,Dn.x+Dn.w,Dn.y,c,Tn,zn.x,sn.y,cn,Ei),or(R,I.x,I.y,Lr.x,Bi+Lr.y,Dn.x,Dn.y+Dn.h,c,Tn,sn.x,zn.y,cn,Ei),or(R,I.x,I.y,Gr.x,Bi+Gr.y,Dn.x+Dn.w,Dn.y+Dn.h,c,Tn,zn.x,zn.y,cn,Ei),_r(a.dynamicLayoutVertexArray,I,He),ee.emplaceBack(gi,gi+1,gi+2),ee.emplaceBack(gi+1,gi+2,gi+3),Ce.vertexLength+=4,Ce.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Qn[0]),It!==u.length-1&&Ii===u[It+1].sectionIndex||a.programConfigurations.populatePaintArrays(R.length,E,E.index,{},X,xt&&xt[Ii])}a.placedSymbolArray.emplaceBack(I.x,I.y,Oe,this.glyphOffsetArray.length-Oe,Qe,D,N,I.segment,c?c[0]:0,c?c[1]:0,m[0],m[1],A,0,!1,0,j)},_n.prototype._addCollisionDebugVertex=function(a,u,c,m,x,E){return u.emplaceBack(0,0),a.emplaceBack(c.x,c.y,m,x,Math.round(E.x),Math.round(E.y))},_n.prototype.addCollisionDebugVertices=function(a,u,c,m,x,E,A){var I=x.segments.prepareSegment(4,x.layoutVertexArray,x.indexArray),D=I.vertexLength,N=x.layoutVertexArray,j=x.collisionVertexArray,X=A.anchorX,ee=A.anchorY;this._addCollisionDebugVertex(N,j,E,X,ee,new ae(a,u)),this._addCollisionDebugVertex(N,j,E,X,ee,new ae(c,u)),this._addCollisionDebugVertex(N,j,E,X,ee,new ae(c,m)),this._addCollisionDebugVertex(N,j,E,X,ee,new ae(a,m)),I.vertexLength+=4;var R=x.indexArray;R.emplaceBack(D,D+1),R.emplaceBack(D+1,D+2),R.emplaceBack(D+2,D+3),R.emplaceBack(D+3,D),I.primitiveLength+=4},_n.prototype.addDebugCollisionBoxes=function(a,u,c,m){for(var x=a;x<u;x++){var E=this.collisionBoxArray.get(x);this.addCollisionDebugVertices(E.x1,E.y1,E.x2,E.y2,m?this.textCollisionBox:this.iconCollisionBox,E.anchorPoint,c)}},_n.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Pn(ac,Zd.members,ff),this.iconCollisionBox=new Pn(ac,Zd.members,ff);for(var a=0;a<this.symbolInstances.length;a++){var u=this.symbolInstances.get(a);this.addDebugCollisionBoxes(u.textBoxStartIndex,u.textBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.iconBoxStartIndex,u.iconBoxEndIndex,u,!1),this.addDebugCollisionBoxes(u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex,u,!1)}},_n.prototype._deserializeCollisionBoxesForSymbol=function(a,u,c,m,x,E,A,I,D){for(var N={},j=u;j<c;j++){var X=a.get(j);N.textBox={x1:X.x1,y1:X.y1,x2:X.x2,y2:X.y2,anchorPointX:X.anchorPointX,anchorPointY:X.anchorPointY},N.textFeatureIndex=X.featureIndex;break}for(var ee=m;ee<x;ee++){var R=a.get(ee);N.verticalTextBox={x1:R.x1,y1:R.y1,x2:R.x2,y2:R.y2,anchorPointX:R.anchorPointX,anchorPointY:R.anchorPointY},N.verticalTextFeatureIndex=R.featureIndex;break}for(var Ce=E;Ce<A;Ce++){var Oe=a.get(Ce);N.iconBox={x1:Oe.x1,y1:Oe.y1,x2:Oe.x2,y2:Oe.y2,anchorPointX:Oe.anchorPointX,anchorPointY:Oe.anchorPointY},N.iconFeatureIndex=Oe.featureIndex;break}for(var Qe=I;Qe<D;Qe++){var He=a.get(Qe);N.verticalIconBox={x1:He.x1,y1:He.y1,x2:He.x2,y2:He.y2,anchorPointX:He.anchorPointX,anchorPointY:He.anchorPointY},N.verticalIconFeatureIndex=He.featureIndex;break}return N},_n.prototype.deserializeCollisionBoxes=function(a){this.collisionArrays=[];for(var u=0;u<this.symbolInstances.length;u++){var c=this.symbolInstances.get(u);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(a,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}},_n.prototype.hasTextData=function(){return this.text.segments.get().length>0},_n.prototype.hasIconData=function(){return this.icon.segments.get().length>0},_n.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},_n.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},_n.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},_n.prototype.addIndicesForPlacedSymbol=function(a,u){for(var c=a.placedSymbolArray.get(u),m=c.vertexStartIndex+4*c.numGlyphs,x=c.vertexStartIndex;x<m;x+=4)a.indexArray.emplaceBack(x,x+1,x+2),a.indexArray.emplaceBack(x+1,x+2,x+3)},_n.prototype.getSortedSymbolIndexes=function(a){if(this.sortedAngle===a&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var u=Math.sin(a),c=Math.cos(a),m=[],x=[],E=[],A=0;A<this.symbolInstances.length;++A){E.push(A);var I=this.symbolInstances.get(A);m.push(0|Math.round(u*I.anchorX+c*I.anchorY)),x.push(I.featureIndex)}return E.sort(function(D,N){return m[D]-m[N]||x[N]-x[D]}),E},_n.prototype.addToSortKeyRanges=function(a,u){var c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===u?c.symbolInstanceEnd=a+1:this.sortKeyRanges.push({sortKey:u,symbolInstanceStart:a,symbolInstanceEnd:a+1})},_n.prototype.sortFeatures=function(a){var u=this;if(this.sortFeaturesByY&&this.sortedAngle!==a&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(a),this.sortedAngle=a,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var c=0,m=this.symbolInstanceIndexes;c<m.length;c+=1){var x=this.symbolInstances.get(m[c]);this.featureSortOrder.push(x.featureIndex),[x.rightJustifiedTextSymbolIndex,x.centerJustifiedTextSymbolIndex,x.leftJustifiedTextSymbolIndex].forEach(function(E,A,I){E>=0&&I.indexOf(E)===A&&u.addIndicesForPlacedSymbol(u.text,E)}),x.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,x.verticalPlacedTextSymbolIndex),x.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,x.placedIconSymbolIndex),x.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,x.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},vn("SymbolBucket",_n,{omit:["layers","collisionBoxArray","features","compareText"]}),_n.MAX_GLYPHS=65535,_n.addDynamicAttributes=_r;var Sn=new ka({"symbol-placement":new On(V.layout_symbol["symbol-placement"]),"symbol-spacing":new On(V.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new On(V.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new gn(V.layout_symbol["symbol-sort-key"]),"symbol-z-order":new On(V.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new On(V.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new On(V.layout_symbol["icon-ignore-placement"]),"icon-optional":new On(V.layout_symbol["icon-optional"]),"icon-rotation-alignment":new On(V.layout_symbol["icon-rotation-alignment"]),"icon-size":new gn(V.layout_symbol["icon-size"]),"icon-text-fit":new On(V.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new On(V.layout_symbol["icon-text-fit-padding"]),"icon-image":new gn(V.layout_symbol["icon-image"]),"icon-rotate":new gn(V.layout_symbol["icon-rotate"]),"icon-padding":new On(V.layout_symbol["icon-padding"]),"icon-keep-upright":new On(V.layout_symbol["icon-keep-upright"]),"icon-offset":new gn(V.layout_symbol["icon-offset"]),"icon-anchor":new gn(V.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new On(V.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new On(V.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new On(V.layout_symbol["text-rotation-alignment"]),"text-field":new gn(V.layout_symbol["text-field"]),"text-font":new gn(V.layout_symbol["text-font"]),"text-size":new gn(V.layout_symbol["text-size"]),"text-max-width":new gn(V.layout_symbol["text-max-width"]),"text-line-height":new On(V.layout_symbol["text-line-height"]),"text-letter-spacing":new gn(V.layout_symbol["text-letter-spacing"]),"text-justify":new gn(V.layout_symbol["text-justify"]),"text-radial-offset":new gn(V.layout_symbol["text-radial-offset"]),"text-variable-anchor":new On(V.layout_symbol["text-variable-anchor"]),"text-anchor":new gn(V.layout_symbol["text-anchor"]),"text-max-angle":new On(V.layout_symbol["text-max-angle"]),"text-writing-mode":new On(V.layout_symbol["text-writing-mode"]),"text-rotate":new gn(V.layout_symbol["text-rotate"]),"text-padding":new On(V.layout_symbol["text-padding"]),"text-keep-upright":new On(V.layout_symbol["text-keep-upright"]),"text-transform":new gn(V.layout_symbol["text-transform"]),"text-offset":new gn(V.layout_symbol["text-offset"]),"text-allow-overlap":new On(V.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new On(V.layout_symbol["text-ignore-placement"]),"text-optional":new On(V.layout_symbol["text-optional"])}),Gn={paint:new ka({"icon-opacity":new gn(V.paint_symbol["icon-opacity"]),"icon-color":new gn(V.paint_symbol["icon-color"]),"icon-halo-color":new gn(V.paint_symbol["icon-halo-color"]),"icon-halo-width":new gn(V.paint_symbol["icon-halo-width"]),"icon-halo-blur":new gn(V.paint_symbol["icon-halo-blur"]),"icon-translate":new On(V.paint_symbol["icon-translate"]),"icon-translate-anchor":new On(V.paint_symbol["icon-translate-anchor"]),"text-opacity":new gn(V.paint_symbol["text-opacity"]),"text-color":new gn(V.paint_symbol["text-color"],{runtimeType:$r,getOverride:function(a){return a.textColor},hasOverride:function(a){return!!a.textColor}}),"text-halo-color":new gn(V.paint_symbol["text-halo-color"]),"text-halo-width":new gn(V.paint_symbol["text-halo-width"]),"text-halo-blur":new gn(V.paint_symbol["text-halo-blur"]),"text-translate":new On(V.paint_symbol["text-translate"]),"text-translate-anchor":new On(V.paint_symbol["text-translate-anchor"])}),layout:Sn},ri=function(a){this.type=a.property.overrides?a.property.overrides.runtimeType:nn,this.defaultValue=a};ri.prototype.evaluate=function(a){if(a.formattedSection){var u=this.defaultValue.property.overrides;if(u&&u.hasOverride(a.formattedSection))return u.getOverride(a.formattedSection)}return a.feature&&a.featureState?this.defaultValue.evaluate(a.feature,a.featureState):this.defaultValue.property.specification.default},ri.prototype.eachChild=function(a){this.defaultValue.isConstant()||a(this.defaultValue.value._styleExpression.expression)},ri.prototype.outputDefined=function(){return!1},ri.prototype.serialize=function(){return null},vn("FormatSectionOverride",ri,{omit:["defaultValue"]});var ta=function(a){function u(c){a.call(this,c,Gn)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.recalculate=function(c,m){if(a.prototype.recalculate.call(this,c,m),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var x=this.layout.get("text-writing-mode");if(x){for(var E=[],A=0,I=x;A<I.length;A+=1){var D=I[A];E.indexOf(D)<0&&E.push(D)}this.layout._values["text-writing-mode"]=E}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},u.prototype.getValueAndResolveTokens=function(c,m,x,E){var A=this.layout.get(c).evaluate(m,{},x,E),I=this._unevaluatedLayout._values[c];return I.isDataDriven()||Mc(I.value)||!A?A:function(D,N){return N.replace(/{([^{}]+)}/g,function(j,X){return X in D?String(D[X]):""})}(m.properties,A)},u.prototype.createBucket=function(c){return new _n(c)},u.prototype.queryRadius=function(){return 0},u.prototype.queryIntersectsFeature=function(){return!1},u.prototype._setPaintOverrides=function(){for(var c=0,m=Gn.paint.overridableProperties;c<m.length;c+=1){var x=m[c];if(u.hasPaintOverride(this.layout,x)){var E,A=this.paint.get(x),I=new ri(A),D=new hu(I,A.property.specification);E=A.value.kind==="constant"||A.value.kind==="source"?new ec("source",D):new tc("composite",D,A.value.zoomStops,A.value._interpolationType),this.paint._values[x]=new Da(A.property,E,A.parameters)}}},u.prototype._handleOverridablePaintPropertyUpdate=function(c,m,x){return!(!this.layout||m.isDataDriven()||x.isDataDriven())&&u.hasPaintOverride(this.layout,c)},u.hasPaintOverride=function(c,m){var x=c.get("text-field"),E=Gn.paint.properties[m],A=!1,I=function(j){for(var X=0,ee=j;X<ee.length;X+=1)if(E.overrides&&E.overrides.hasOverride(ee[X]))return void(A=!0)};if(x.value.kind==="constant"&&x.value.value instanceof ma)I(x.value.value.sections);else if(x.value.kind==="source"){var D=function(j){A||(j instanceof Oa&&Ta(j.value)===Yi?I(j.value.sections):j instanceof $o?I(j.sections):j.eachChild(D))},N=x.value;N._styleExpression&&D(N._styleExpression.expression)}return A},u}(Ls),xo={paint:new ka({"background-color":new On(V.paint_background["background-color"]),"background-pattern":new qo(V.paint_background["background-pattern"]),"background-opacity":new On(V.paint_background["background-opacity"])})},dl=function(a){function u(c){a.call(this,c,xo)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u}(Ls),mp={paint:new ka({"raster-opacity":new On(V.paint_raster["raster-opacity"]),"raster-hue-rotate":new On(V.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new On(V.paint_raster["raster-brightness-min"]),"raster-brightness-max":new On(V.paint_raster["raster-brightness-max"]),"raster-saturation":new On(V.paint_raster["raster-saturation"]),"raster-contrast":new On(V.paint_raster["raster-contrast"]),"raster-resampling":new On(V.paint_raster["raster-resampling"]),"raster-fade-duration":new On(V.paint_raster["raster-fade-duration"])})},yu=function(a){function u(c){a.call(this,c,mp)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u}(Ls),Vd=function(a){function u(c){a.call(this,c,{}),this.implementation=c}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},u.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},u.prototype.recalculate=function(){},u.prototype.updateTransitions=function(){},u.prototype.hasTransition=function(){},u.prototype.serialize=function(){},u.prototype.onAdd=function(c){this.implementation.onAdd&&this.implementation.onAdd(c,c.painter.context.gl)},u.prototype.onRemove=function(c){this.implementation.onRemove&&this.implementation.onRemove(c,c.painter.context.gl)},u}(Ls),zs={circle:fs,heatmap:Lc,hillshade:Bv,fill:Oh,"fill-extrusion":$p,line:Ud,symbol:ta,background:dl,raster:yu},hc=ie.HTMLImageElement,Qp=ie.HTMLCanvasElement,ds=ie.HTMLVideoElement,eg=ie.ImageData,jd=ie.ImageBitmap,Yf=function(a,u,c,m){this.context=a,this.format=c,this.texture=a.gl.createTexture(),this.update(u,m)};Yf.prototype.update=function(a,u,c){var m=a.width,x=a.height,E=!(this.size&&this.size[0]===m&&this.size[1]===x||c),A=this.context,I=A.gl;if(this.useMipmap=!!(u&&u.useMipmap),I.bindTexture(I.TEXTURE_2D,this.texture),A.pixelStoreUnpackFlipY.set(!1),A.pixelStoreUnpack.set(1),A.pixelStoreUnpackPremultiplyAlpha.set(this.format===I.RGBA&&(!u||u.premultiply!==!1)),E)this.size=[m,x],a instanceof hc||a instanceof Qp||a instanceof ds||a instanceof eg||jd&&a instanceof jd?I.texImage2D(I.TEXTURE_2D,0,this.format,this.format,I.UNSIGNED_BYTE,a):I.texImage2D(I.TEXTURE_2D,0,this.format,m,x,0,this.format,I.UNSIGNED_BYTE,a.data);else{var D=c||{x:0,y:0},N=D.x,j=D.y;a instanceof hc||a instanceof Qp||a instanceof ds||a instanceof eg||jd&&a instanceof jd?I.texSubImage2D(I.TEXTURE_2D,0,N,j,I.RGBA,I.UNSIGNED_BYTE,a):I.texSubImage2D(I.TEXTURE_2D,0,N,j,m,x,I.RGBA,I.UNSIGNED_BYTE,a.data)}this.useMipmap&&this.isSizePowerOfTwo()&&I.generateMipmap(I.TEXTURE_2D)},Yf.prototype.bind=function(a,u,c){var m=this.context.gl;m.bindTexture(m.TEXTURE_2D,this.texture),c!==m.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(c=m.LINEAR),a!==this.filter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,a),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,c||a),this.filter=a),u!==this.wrap&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,u),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,u),this.wrap=u)},Yf.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},Yf.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Hd=function(a){var u=this;this._callback=a,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){u._triggered=!1,u._callback()})};Hd.prototype.trigger=function(){var a=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){a._triggered=!1,a._callback()},0))},Hd.prototype.remove=function(){delete this._channel,this._callback=function(){}};var gp=function(a,u,c){this.target=a,this.parent=u,this.mapId=c,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},Pr(["receive","process"],this),this.invoker=new Hd(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=te()?a:ie};function tg(a,u,c){var m=2*Math.PI*6378137/256/Math.pow(2,c);return[a*m-2*Math.PI*6378137/2,u*m-2*Math.PI*6378137/2]}gp.prototype.send=function(a,u,c,m,x){var E=this;x===void 0&&(x=!1);var A=Math.round(1e18*Math.random()).toString(36).substring(0,10);c&&(this.callbacks[A]=c);var I=Be(this.globalScope)?void 0:[];return this.target.postMessage({id:A,type:a,hasCallback:!!c,targetMapId:m,mustQueue:x,sourceMapId:this.mapId,data:us(u,I)},I),{cancel:function(){c&&delete E.callbacks[A],E.target.postMessage({id:A,type:"<cancel>",targetMapId:m,sourceMapId:E.mapId})}}},gp.prototype.receive=function(a){var u=a.data,c=u.id;if(c&&(!u.targetMapId||this.mapId===u.targetMapId))if(u.type==="<cancel>"){delete this.tasks[c];var m=this.cancelCallbacks[c];delete this.cancelCallbacks[c],m&&m()}else te()||u.mustQueue?(this.tasks[c]=u,this.taskQueue.push(c),this.invoker.trigger()):this.processTask(c,u)},gp.prototype.process=function(){if(this.taskQueue.length){var a=this.taskQueue.shift(),u=this.tasks[a];delete this.tasks[a],this.taskQueue.length&&this.invoker.trigger(),u&&this.processTask(a,u)}},gp.prototype.processTask=function(a,u){var c=this;if(u.type==="<response>"){var m=this.callbacks[a];delete this.callbacks[a],m&&(u.error?m(ga(u.error)):m(null,ga(u.data)))}else{var x=!1,E=Be(this.globalScope)?void 0:[],A=u.hasCallback?function(j,X){x=!0,delete c.cancelCallbacks[a],c.target.postMessage({id:a,type:"<response>",sourceMapId:c.mapId,error:j?us(j):null,data:us(X,E)},E)}:function(j){x=!0},I=null,D=ga(u.data);if(this.parent[u.type])I=this.parent[u.type](u.sourceMapId,D,A);else if(this.parent.getWorkerSource){var N=u.type.split(".");I=this.parent.getWorkerSource(u.sourceMapId,N[0],D.source)[N[1]](D,A)}else A(new Error("Could not find function "+u.type));!x&&I&&I.cancel&&(this.cancelCallbacks[a]=I.cancel)}},gp.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var No=function(a,u){a&&(u?this.setSouthWest(a).setNorthEast(u):a.length===4?this.setSouthWest([a[0],a[1]]).setNorthEast([a[2],a[3]]):this.setSouthWest(a[0]).setNorthEast(a[1]))};No.prototype.setNorthEast=function(a){return this._ne=a instanceof Xa?new Xa(a.lng,a.lat):Xa.convert(a),this},No.prototype.setSouthWest=function(a){return this._sw=a instanceof Xa?new Xa(a.lng,a.lat):Xa.convert(a),this},No.prototype.extend=function(a){var u,c,m=this._sw,x=this._ne;if(a instanceof Xa)u=a,c=a;else{if(!(a instanceof No))return Array.isArray(a)?a.length===4||a.every(Array.isArray)?this.extend(No.convert(a)):this.extend(Xa.convert(a)):this;if(c=a._ne,!(u=a._sw)||!c)return this}return m||x?(m.lng=Math.min(u.lng,m.lng),m.lat=Math.min(u.lat,m.lat),x.lng=Math.max(c.lng,x.lng),x.lat=Math.max(c.lat,x.lat)):(this._sw=new Xa(u.lng,u.lat),this._ne=new Xa(c.lng,c.lat)),this},No.prototype.getCenter=function(){return new Xa((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},No.prototype.getSouthWest=function(){return this._sw},No.prototype.getNorthEast=function(){return this._ne},No.prototype.getNorthWest=function(){return new Xa(this.getWest(),this.getNorth())},No.prototype.getSouthEast=function(){return new Xa(this.getEast(),this.getSouth())},No.prototype.getWest=function(){return this._sw.lng},No.prototype.getSouth=function(){return this._sw.lat},No.prototype.getEast=function(){return this._ne.lng},No.prototype.getNorth=function(){return this._ne.lat},No.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},No.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},No.prototype.isEmpty=function(){return!(this._sw&&this._ne)},No.prototype.contains=function(a){var u=Xa.convert(a),c=u.lng,m=u.lat,x=this._sw.lng<=c&&c<=this._ne.lng;return this._sw.lng>this._ne.lng&&(x=this._sw.lng>=c&&c>=this._ne.lng),this._sw.lat<=m&&m<=this._ne.lat&&x},No.convert=function(a){return!a||a instanceof No?a:new No(a)};var Xa=function(a,u){if(isNaN(a)||isNaN(u))throw new Error("Invalid LngLat object: ("+a+", "+u+")");if(this.lng=+a,this.lat=+u,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};Xa.prototype.wrap=function(){return new Xa(Yt(this.lng,-180,180),this.lat)},Xa.prototype.toArray=function(){return[this.lng,this.lat]},Xa.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},Xa.prototype.distanceTo=function(a){var u=Math.PI/180,c=this.lat*u,m=a.lat*u,x=Math.sin(c)*Math.sin(m)+Math.cos(c)*Math.cos(m)*Math.cos((a.lng-this.lng)*u);return 63710088e-1*Math.acos(Math.min(x,1))},Xa.prototype.toBounds=function(a){a===void 0&&(a=0);var u=360*a/40075017,c=u/Math.cos(Math.PI/180*this.lat);return new No(new Xa(this.lng-c,this.lat-u),new Xa(this.lng+c,this.lat+u))},Xa.convert=function(a){if(a instanceof Xa)return a;if(Array.isArray(a)&&(a.length===2||a.length===3))return new Xa(Number(a[0]),Number(a[1]));if(!Array.isArray(a)&&typeof a=="object"&&a!==null)return new Xa(Number("lng"in a?a.lng:a.lon),Number(a.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var Fi=2*Math.PI*63710088e-1;function Oi(a){return Fi*Math.cos(a*Math.PI/180)}function kh(a){return(180+a)/360}function Wd(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function rg(a,u){return a/Oi(u)}function Gd(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}var qf=function(a,u,c){c===void 0&&(c=0),this.x=+a,this.y=+u,this.z=+c};qf.fromLngLat=function(a,u){u===void 0&&(u=0);var c=Xa.convert(a);return new qf(kh(c.lng),Wd(c.lat),rg(u,c.lat))},qf.prototype.toLngLat=function(){return new Xa(360*this.x-180,Gd(this.y))},qf.prototype.toAltitude=function(){return this.z*Oi(Gd(this.y))},qf.prototype.meterInMercatorCoordinateUnits=function(){return 1/Fi*(a=Gd(this.y),1/Math.cos(a*Math.PI/180));var a};var zl=function(a,u,c){this.z=a,this.x=u,this.y=c,this.key=_p(0,a,a,u,c)};zl.prototype.equals=function(a){return this.z===a.z&&this.x===a.x&&this.y===a.y},zl.prototype.url=function(a,u){var c,m,x,E,A,I=(m=this.y,x=this.z,E=tg(256*(c=this.x),256*(m=Math.pow(2,x)-m-1),x),A=tg(256*(c+1),256*(m+1),x),E[0]+","+E[1]+","+A[0]+","+A[1]),D=function(N,j,X){for(var ee,R="",Ce=N;Ce>0;Ce--)R+=(j&(ee=1<<Ce-1)?1:0)+(X&ee?2:0);return R}(this.z,this.x,this.y);return a[(this.x+this.y)%a.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(u==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",D).replace("{bbox-epsg-3857}",I)},zl.prototype.getTilePoint=function(a){var u=Math.pow(2,this.z);return new ae(8192*(a.x*u-this.x),8192*(a.y*u-this.y))},zl.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var Kf=function(a,u){this.wrap=a,this.canonical=u,this.key=_p(a,u.z,u.z,u.x,u.y)},Io=function(a,u,c,m,x){this.overscaledZ=a,this.wrap=u,this.canonical=new zl(c,+m,+x),this.key=_p(u,a,c,m,x)};function _p(a,u,c,m,x){(a*=2)<0&&(a=-1*a-1);var E=1<<c;return(E*E*a+E*x+m).toString(36)+c.toString(36)+u.toString(36)}Io.prototype.equals=function(a){return this.overscaledZ===a.overscaledZ&&this.wrap===a.wrap&&this.canonical.equals(a.canonical)},Io.prototype.scaledTo=function(a){var u=this.canonical.z-a;return a>this.canonical.z?new Io(a,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Io(a,this.wrap,a,this.canonical.x>>u,this.canonical.y>>u)},Io.prototype.calculateScaledKey=function(a,u){var c=this.canonical.z-a;return a>this.canonical.z?_p(this.wrap*+u,a,this.canonical.z,this.canonical.x,this.canonical.y):_p(this.wrap*+u,a,a,this.canonical.x>>c,this.canonical.y>>c)},Io.prototype.isChildOf=function(a){if(a.wrap!==this.wrap)return!1;var u=this.canonical.z-a.canonical.z;return a.overscaledZ===0||a.overscaledZ<this.overscaledZ&&a.canonical.x===this.canonical.x>>u&&a.canonical.y===this.canonical.y>>u},Io.prototype.children=function(a){if(this.overscaledZ>=a)return[new Io(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var u=this.canonical.z+1,c=2*this.canonical.x,m=2*this.canonical.y;return[new Io(u,this.wrap,u,c,m),new Io(u,this.wrap,u,c+1,m),new Io(u,this.wrap,u,c,m+1),new Io(u,this.wrap,u,c+1,m+1)]},Io.prototype.isLessThan=function(a){return this.wrap<a.wrap||!(this.wrap>a.wrap)&&(this.overscaledZ<a.overscaledZ||!(this.overscaledZ>a.overscaledZ)&&(this.canonical.x<a.canonical.x||!(this.canonical.x>a.canonical.x)&&this.canonical.y<a.canonical.y))},Io.prototype.wrapped=function(){return new Io(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},Io.prototype.unwrapTo=function(a){return new Io(this.overscaledZ,a,this.canonical.z,this.canonical.x,this.canonical.y)},Io.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},Io.prototype.toUnwrapped=function(){return new Kf(this.wrap,this.canonical)},Io.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},Io.prototype.getTilePoint=function(a){return this.canonical.getTilePoint(new qf(a.x-this.wrap,a.y))},vn("CanonicalTileID",zl),vn("OverscaledTileID",Io,{omit:["posMatrix"]});var Vc=function(a,u,c){if(this.uid=a,u.height!==u.width)throw new RangeError("DEM tiles must be square");if(c&&c!=="mapbox"&&c!=="terrarium")return ft('"'+c+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=u.height;var m=this.dim=u.height-2;this.data=new Uint32Array(u.data.buffer),this.encoding=c||"mapbox";for(var x=0;x<m;x++)this.data[this._idx(-1,x)]=this.data[this._idx(0,x)],this.data[this._idx(m,x)]=this.data[this._idx(m-1,x)],this.data[this._idx(x,-1)]=this.data[this._idx(x,0)],this.data[this._idx(x,m)]=this.data[this._idx(x,m-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(m,-1)]=this.data[this._idx(m-1,0)],this.data[this._idx(-1,m)]=this.data[this._idx(0,m-1)],this.data[this._idx(m,m)]=this.data[this._idx(m-1,m-1)]};Vc.prototype.get=function(a,u){var c=new Uint8Array(this.data.buffer),m=4*this._idx(a,u);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(c[m],c[m+1],c[m+2])},Vc.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},Vc.prototype._idx=function(a,u){if(a<-1||a>=this.dim+1||u<-1||u>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(u+1)*this.stride+(a+1)},Vc.prototype._unpackMapbox=function(a,u,c){return(256*a*256+256*u+c)/10-1e4},Vc.prototype._unpackTerrarium=function(a,u,c){return 256*a+u+c/256-32768},Vc.prototype.getPixels=function(){return new Qo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Vc.prototype.backfillBorder=function(a,u,c){if(this.dim!==a.dim)throw new Error("dem dimension mismatch");var m=u*this.dim,x=u*this.dim+this.dim,E=c*this.dim,A=c*this.dim+this.dim;switch(u){case-1:m=x-1;break;case 1:x=m+1}switch(c){case-1:E=A-1;break;case 1:A=E+1}for(var I=-u*this.dim,D=-c*this.dim,N=E;N<A;N++)for(var j=m;j<x;j++)this.data[this._idx(j,N)]=a.data[this._idx(j+I,N+D)]},vn("DEMData",Vc);var yp=function(a){this._stringToNumber={},this._numberToString=[];for(var u=0;u<a.length;u++){var c=a[u];this._stringToNumber[c]=u,this._numberToString[u]=c}};yp.prototype.encode=function(a){return this._stringToNumber[a]},yp.prototype.decode=function(a){return this._numberToString[a]};var Jp=function(a,u,c,m,x){this.type="Feature",this._vectorTileFeature=a,a._z=u,a._x=c,a._y=m,this.properties=a.properties,this.id=x},Vv={geometry:{configurable:!0}};Vv.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},Vv.geometry.set=function(a){this._geometry=a},Jp.prototype.toJSON=function(){var a={geometry:this.geometry};for(var u in this)u!=="_geometry"&&u!=="_vectorTileFeature"&&(a[u]=this[u]);return a},Object.defineProperties(Jp.prototype,Vv);var xp=function(){this.state={},this.stateChanges={},this.deletedStates={}};xp.prototype.updateState=function(a,u,c){var m=String(u);if(this.stateChanges[a]=this.stateChanges[a]||{},this.stateChanges[a][m]=this.stateChanges[a][m]||{},Ht(this.stateChanges[a][m],c),this.deletedStates[a]===null)for(var x in this.deletedStates[a]={},this.state[a])x!==m&&(this.deletedStates[a][x]=null);else if(this.deletedStates[a]&&this.deletedStates[a][m]===null)for(var E in this.deletedStates[a][m]={},this.state[a][m])c[E]||(this.deletedStates[a][m][E]=null);else for(var A in c)this.deletedStates[a]&&this.deletedStates[a][m]&&this.deletedStates[a][m][A]===null&&delete this.deletedStates[a][m][A]},xp.prototype.removeFeatureState=function(a,u,c){if(this.deletedStates[a]!==null){var m=String(u);if(this.deletedStates[a]=this.deletedStates[a]||{},c&&u!==void 0)this.deletedStates[a][m]!==null&&(this.deletedStates[a][m]=this.deletedStates[a][m]||{},this.deletedStates[a][m][c]=null);else if(u!==void 0)if(this.stateChanges[a]&&this.stateChanges[a][m])for(c in this.deletedStates[a][m]={},this.stateChanges[a][m])this.deletedStates[a][m][c]=null;else this.deletedStates[a][m]=null;else this.deletedStates[a]=null}},xp.prototype.getState=function(a,u){var c=String(u),m=Ht({},(this.state[a]||{})[c],(this.stateChanges[a]||{})[c]);if(this.deletedStates[a]===null)return{};if(this.deletedStates[a]){var x=this.deletedStates[a][u];if(x===null)return{};for(var E in x)delete m[E]}return m},xp.prototype.initializeTileState=function(a,u){a.setFeatureState(this.state,u)},xp.prototype.coalesceChanges=function(a,u){var c={};for(var m in this.stateChanges){this.state[m]=this.state[m]||{};var x={};for(var E in this.stateChanges[m])this.state[m][E]||(this.state[m][E]={}),Ht(this.state[m][E],this.stateChanges[m][E]),x[E]=this.state[m][E];c[m]=x}for(var A in this.deletedStates){this.state[A]=this.state[A]||{};var I={};if(this.deletedStates[A]===null)for(var D in this.state[A])I[D]={},this.state[A][D]={};else for(var N in this.deletedStates[A]){if(this.deletedStates[A][N]===null)this.state[A][N]={};else for(var j=0,X=Object.keys(this.deletedStates[A][N]);j<X.length;j+=1)delete this.state[A][N][X[j]];I[N]=this.state[A][N]}c[A]=c[A]||{},Ht(c[A],I)}if(this.stateChanges={},this.deletedStates={},Object.keys(c).length!==0)for(var ee in a)a[ee].setFeatureState(c,u)};var jc=function(a,u){this.tileID=a,this.x=a.canonical.x,this.y=a.canonical.y,this.z=a.canonical.z,this.grid=new Fo(8192,16,0),this.grid3D=new Fo(8192,16,0),this.featureIndexArray=new Y,this.promoteId=u};function jv(a,u,c,m,x){return ur(a,function(E,A){var I=u instanceof nc?u.get(A):null;return I&&I.evaluate?I.evaluate(c,m,x):I})}function ng(a){for(var u=1/0,c=1/0,m=-1/0,x=-1/0,E=0,A=a;E<A.length;E+=1){var I=A[E];u=Math.min(u,I.x),c=Math.min(c,I.y),m=Math.max(m,I.x),x=Math.max(x,I.y)}return{minX:u,minY:c,maxX:m,maxY:x}}function E0(a,u){return u-a}jc.prototype.insert=function(a,u,c,m,x,E){var A=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,m,x);for(var I=E?this.grid3D:this.grid,D=0;D<u.length;D++){for(var N=u[D],j=[1/0,1/0,-1/0,-1/0],X=0;X<N.length;X++){var ee=N[X];j[0]=Math.min(j[0],ee.x),j[1]=Math.min(j[1],ee.y),j[2]=Math.max(j[2],ee.x),j[3]=Math.max(j[3],ee.y)}j[0]<8192&&j[1]<8192&&j[2]>=0&&j[3]>=0&&I.insert(A,j[0],j[1],j[2],j[3])}},jc.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new Ul.VectorTile(new zt(this.rawTileData)).layers,this.sourceLayerCoder=new yp(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},jc.prototype.query=function(a,u,c,m){var x=this;this.loadVTLayers();for(var E=a.params||{},A=8192/a.tileSize/a.scale,I=Bu(E.filter),D=a.queryGeometry,N=a.queryPadding*A,j=ng(D),X=this.grid.query(j.minX-N,j.minY-N,j.maxX+N,j.maxY+N),ee=ng(a.cameraQueryGeometry),R=this.grid3D.query(ee.minX-N,ee.minY-N,ee.maxX+N,ee.maxY+N,function(Vt,jt,fr,Lr){return function(Gr,Dn,sn,zn,cn){for(var Ei=0,Qn=Gr;Ei<Qn.length;Ei+=1){var Tn=Qn[Ei];if(Dn<=Tn.x&&sn<=Tn.y&&zn>=Tn.x&&cn>=Tn.y)return!0}var Ii=[new ae(Dn,sn),new ae(Dn,cn),new ae(zn,cn),new ae(zn,sn)];if(Gr.length>2){for(var gi=0,Bi=Ii;gi<Bi.length;gi+=1)if(iu(Gr,Bi[gi]))return!0}for(var Zn=0;Zn<Gr.length-1;Zn++)if(ju(Gr[Zn],Gr[Zn+1],Ii))return!0;return!1}(a.cameraQueryGeometry,Vt-N,jt-N,fr+N,Lr+N)}),Ce=0,Oe=R;Ce<Oe.length;Ce+=1)X.push(Oe[Ce]);X.sort(E0);for(var Qe,He={},xt=function(Vt){var jt=X[Vt];if(jt!==Qe){Qe=jt;var fr=x.featureIndexArray.get(jt),Lr=null;x.loadMatchingFeature(He,fr.bucketIndex,fr.sourceLayerIndex,fr.featureIndex,I,E.layers,E.availableImages,u,c,m,function(Gr,Dn,sn){return Lr||(Lr=Wa(Gr)),Dn.queryIntersectsFeature(D,Gr,sn,Lr,x.z,a.transform,A,a.pixelPosMatrix)})}},It=0;It<X.length;It++)xt(It);return He},jc.prototype.loadMatchingFeature=function(a,u,c,m,x,E,A,I,D,N,j){var X=this.bucketLayerIDs[u];if(!E||function(Gr,Dn){for(var sn=0;sn<Gr.length;sn++)if(Dn.indexOf(Gr[sn])>=0)return!0;return!1}(E,X)){var ee=this.sourceLayerCoder.decode(c),R=this.vtLayers[ee].feature(m);if(x.needGeometry){var Ce=Ga(R,!0);if(!x.filter(new B(this.tileID.overscaledZ),Ce,this.tileID.canonical))return}else if(!x.filter(new B(this.tileID.overscaledZ),R))return;for(var Oe=this.getId(R,ee),Qe=0;Qe<X.length;Qe++){var He=X[Qe];if(!(E&&E.indexOf(He)<0)){var xt=I[He];if(xt){var It={};Oe!==void 0&&N&&(It=N.getState(xt.sourceLayer||"_geojsonTileLayer",Oe));var Vt=Ht({},D[He]);Vt.paint=jv(Vt.paint,xt.paint,R,It,A),Vt.layout=jv(Vt.layout,xt.layout,R,It,A);var jt=!j||j(R,xt,It);if(jt){var fr=new Jp(R,this.z,this.x,this.y,Oe);fr.layer=Vt;var Lr=a[He];Lr===void 0&&(Lr=a[He]=[]),Lr.push({featureIndex:m,feature:fr,intersectionZ:jt})}}}}}},jc.prototype.lookupSymbolFeatures=function(a,u,c,m,x,E,A,I){var D={};this.loadVTLayers();for(var N=Bu(x),j=0,X=a;j<X.length;j+=1)this.loadMatchingFeature(D,c,m,X[j],N,E,A,I,u);return D},jc.prototype.hasLayer=function(a){for(var u=0,c=this.bucketLayerIDs;u<c.length;u+=1)for(var m=0,x=c[u];m<x.length;m+=1)if(a===x[m])return!0;return!1},jc.prototype.getId=function(a,u){var c=a.id;return this.promoteId&&typeof(c=a.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[u]])=="boolean"&&(c=Number(c)),c},vn("FeatureIndex",jc,{omit:["rawTileData","sourceLayerCoder"]});var ts=function(a,u){this.tileID=a,this.uid=Xt(),this.uses=0,this.tileSize=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};ts.prototype.registerFadeDuration=function(a){var u=a+this.timeAdded;u<Cn.now()||this.fadeEndTime&&u<this.fadeEndTime||(this.fadeEndTime=u)},ts.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},ts.prototype.loadVectorData=function(a,u,c){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",a){for(var m in a.featureIndex&&(this.latestFeatureIndex=a.featureIndex,a.rawTileData?(this.latestRawTileData=a.rawTileData,this.latestFeatureIndex.rawTileData=a.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=a.collisionBoxArray,this.buckets=function(N,j){var X={};if(!j)return X;for(var ee=function(){var Oe=Ce[R],Qe=Oe.layerIds.map(function(It){return j.getLayer(It)}).filter(Boolean);if(Qe.length!==0){Oe.layers=Qe,Oe.stateDependentLayerIds&&(Oe.stateDependentLayers=Oe.stateDependentLayerIds.map(function(It){return Qe.filter(function(Vt){return Vt.id===It})[0]}));for(var He=0,xt=Qe;He<xt.length;He+=1)X[xt[He].id]=Oe}},R=0,Ce=N;R<Ce.length;R+=1)ee();return X}(a.buckets,u.style),this.hasSymbolBuckets=!1,this.buckets){var x=this.buckets[m];if(x instanceof _n){if(this.hasSymbolBuckets=!0,!c)break;x.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var E in this.buckets){var A=this.buckets[E];if(A instanceof _n&&A.hasRTLText){this.hasRTLText=!0,Ie.isLoading()||Ie.isLoaded()||up()!=="deferred"||Ct();break}}for(var I in this.queryPadding=0,this.buckets){var D=this.buckets[I];this.queryPadding=Math.max(this.queryPadding,u.style.getLayer(I).queryRadius(D))}a.imageAtlas&&(this.imageAtlas=a.imageAtlas),a.glyphAtlasImage&&(this.glyphAtlasImage=a.glyphAtlasImage)}else this.collisionBoxArray=new d},ts.prototype.unloadVectorData=function(){for(var a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},ts.prototype.getBucket=function(a){return this.buckets[a.id]},ts.prototype.upload=function(a){for(var u in this.buckets){var c=this.buckets[u];c.uploadPending()&&c.upload(a)}var m=a.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Yf(a,this.imageAtlas.image,m.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Yf(a,this.glyphAtlasImage,m.ALPHA),this.glyphAtlasImage=null)},ts.prototype.prepare=function(a){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(a,this.imageAtlasTexture)},ts.prototype.queryRenderedFeatures=function(a,u,c,m,x,E,A,I,D,N){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:m,cameraQueryGeometry:x,scale:E,tileSize:this.tileSize,pixelPosMatrix:N,transform:I,params:A,queryPadding:this.queryPadding*D},a,u,c):{}},ts.prototype.querySourceFeatures=function(a,u){var c=this.latestFeatureIndex;if(c&&c.rawTileData){var m=c.loadVTLayers(),x=u?u.sourceLayer:"",E=m._geojsonTileLayer||m[x];if(E)for(var A=Bu(u&&u.filter),I=this.tileID.canonical,D=I.z,N=I.x,j=I.y,X={z:D,x:N,y:j},ee=0;ee<E.length;ee++){var R=E.feature(ee);if(A.needGeometry){var Ce=Ga(R,!0);if(!A.filter(new B(this.tileID.overscaledZ),Ce,this.tileID.canonical))continue}else if(!A.filter(new B(this.tileID.overscaledZ),R))continue;var Oe=c.getId(R,x),Qe=new Jp(R,D,N,j,Oe);Qe.tile=X,a.push(Qe)}}},ts.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},ts.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},ts.prototype.setExpiryData=function(a){var u=this.expirationTime;if(a.cacheControl){var c=H(a.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else a.expires&&(this.expirationTime=new Date(a.expires).getTime());if(this.expirationTime){var m=Date.now(),x=!1;if(this.expirationTime>m)x=!1;else if(u)if(this.expirationTime<u)x=!0;else{var E=this.expirationTime-u;E?this.expirationTime=m+Math.max(E,3e4):x=!0}else x=!0;x?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},ts.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},ts.prototype.setFeatureState=function(a,u){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(a).length!==0){var c=this.latestFeatureIndex.loadVTLayers();for(var m in this.buckets)if(u.style.hasLayer(m)){var x=this.buckets[m],E=x.layers[0].sourceLayer||"_geojsonTileLayer",A=c[E],I=a[E];if(A&&I&&Object.keys(I).length!==0){x.update(I,A,this.imageAtlas&&this.imageAtlas.patternPositions||{});var D=u&&u.style&&u.style.getLayer(m);D&&(this.queryPadding=Math.max(this.queryPadding,D.queryRadius(x)))}}}},ts.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},ts.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Cn.now()},ts.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},ts.prototype.setHoldDuration=function(a){this.symbolFadeHoldUntil=Cn.now()+a},ts.prototype.setDependencies=function(a,u){for(var c={},m=0,x=u;m<x.length;m+=1)c[x[m]]=!0;this.dependencies[a]=c},ts.prototype.hasDependency=function(a,u){for(var c=0,m=a;c<m.length;c+=1){var x=this.dependencies[m[c]];if(x){for(var E=0,A=u;E<A.length;E+=1)if(x[A[E]])return!0}}return!1};var Qf=ie.performance,bp=function(a){this._marks={start:[a.url,"start"].join("#"),end:[a.url,"end"].join("#"),measure:a.url.toString()},Qf.mark(this._marks.start)};bp.prototype.finish=function(){Qf.mark(this._marks.end);var a=Qf.getEntriesByName(this._marks.measure);return a.length===0&&(Qf.measure(this._marks.measure,this._marks.start,this._marks.end),a=Qf.getEntriesByName(this._marks.measure),Qf.clearMarks(this._marks.start),Qf.clearMarks(this._marks.end),Qf.clearMeasures(this._marks.measure)),a},_.Actor=gp,_.AlphaImage=_u,_.CanonicalTileID=zl,_.CollisionBoxArray=d,_.Color=Ti,_.DEMData=Vc,_.DataConstantProperty=On,_.DictionaryCoder=yp,_.EXTENT=8192,_.ErrorEvent=Je,_.EvaluationParameters=B,_.Event=Re,_.Evented=lt,_.FeatureIndex=jc,_.FillBucket=fl,_.FillExtrusionBucket=hs,_.ImageAtlas=pr,_.ImagePosition=qr,_.LineBucket=Jo,_.LngLat=Xa,_.LngLatBounds=No,_.MercatorCoordinate=qf,_.ONE_EM=24,_.OverscaledTileID=Io,_.Point=ae,_.Point$1=ae,_.Properties=ka,_.Protobuf=zt,_.RGBAImage=Qo,_.RequestManager=Wi,_.RequestPerformance=bp,_.ResourceType=xn,_.SegmentVector=ge,_.SourceFeatureState=xp,_.StructArrayLayout1ui2=Rh,_.StructArrayLayout2f1f2i16=oc,_.StructArrayLayout2i4=Pl,_.StructArrayLayout3ui6=zu,_.StructArrayLayout4i8=zf,_.SymbolBucket=_n,_.Texture=Yf,_.Tile=ts,_.Transitionable=Bo,_.Uniform1f=Nr,_.Uniform1i=mr,_.Uniform2f=Fr,_.Uniform3f=an,_.Uniform4f=In,_.UniformColor=Nn,_.UniformMatrix4f=ji,_.UnwrappedTileID=Kf,_.ValidationError=q,_.WritingMode=tt,_.ZoomHistory=Th,_.add=function(a,u,c){return a[0]=u[0]+c[0],a[1]=u[1]+c[1],a[2]=u[2]+c[2],a},_.addDynamicAttributes=_r,_.asyncAll=function(a,u,c){if(!a.length)return c(null,[]);var m=a.length,x=new Array(a.length),E=null;a.forEach(function(A,I){u(A,function(D,N){D&&(E=D),x[I]=N,--m==0&&c(E,x)})})},_.bezier=ht,_.bindAll=Pr,_.browser=Cn,_.cacheEntryPossiblyAdded=function(a){++En>sr&&(a.getActor().send("enforceCacheSizeLimit",wt),En=0)},_.clamp=Dt,_.clearTileCache=function(a){var u=ie.caches.delete("mapbox-tiles");a&&u.catch(a).then(function(){return a()})},_.clipLine=Xu,_.clone=function(a){var u=new Ni(16);return u[0]=a[0],u[1]=a[1],u[2]=a[2],u[3]=a[3],u[4]=a[4],u[5]=a[5],u[6]=a[6],u[7]=a[7],u[8]=a[8],u[9]=a[9],u[10]=a[10],u[11]=a[11],u[12]=a[12],u[13]=a[13],u[14]=a[14],u[15]=a[15],u},_.clone$1=nt,_.clone$2=function(a){var u=new Ni(3);return u[0]=a[0],u[1]=a[1],u[2]=a[2],u},_.collisionCircleLayout=z,_.config=mn,_.create=function(){var a=new Ni(16);return Ni!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},_.create$1=function(){var a=new Ni(9);return Ni!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a},_.create$2=function(){var a=new Ni(4);return Ni!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a},_.createCommonjsModule=le,_.createExpression=rf,_.createLayout=To,_.createStyleLayer=function(a){return a.type==="custom"?new Vd(a):new zs[a.type](a)},_.cross=function(a,u,c){var m=u[0],x=u[1],E=u[2],A=c[0],I=c[1],D=c[2];return a[0]=x*D-E*I,a[1]=E*A-m*D,a[2]=m*I-x*A,a},_.deepEqual=function a(u,c){if(Array.isArray(u)){if(!Array.isArray(c)||u.length!==c.length)return!1;for(var m=0;m<u.length;m++)if(!a(u[m],c[m]))return!1;return!0}if(typeof u=="object"&&u!==null&&c!==null){if(typeof c!="object"||Object.keys(u).length!==Object.keys(c).length)return!1;for(var x in u)if(!a(u[x],c[x]))return!1;return!0}return u===c},_.dot=function(a,u){return a[0]*u[0]+a[1]*u[1]+a[2]*u[2]},_.dot$1=function(a,u){return a[0]*u[0]+a[1]*u[1]+a[2]*u[2]+a[3]*u[3]},_.ease=mt,_.emitValidationErrors=Ml,_.endsWith=hr,_.enforceCacheSizeLimit=function(a){dr(),ne&&ne.then(function(u){u.keys().then(function(c){for(var m=0;m<c.length-a;m++)u.delete(c[m])})})},_.evaluateSizeForFeature=ps,_.evaluateSizeForZoom=Mo,_.evaluateVariableOffset=st,_.evented=lf,_.extend=Ht,_.featureFilter=Bu,_.filterObject=Et,_.fromRotation=function(a,u){var c=Math.sin(u),m=Math.cos(u);return a[0]=m,a[1]=c,a[2]=0,a[3]=-c,a[4]=m,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},_.getAnchorAlignment=Sa,_.getAnchorJustification=pt,_.getArrayBuffer=Ks,_.getImage=Q,_.getJSON=function(a,u){return Eo(Ht(a,{type:"json"}),u)},_.getRTLTextPluginStatus=up,_.getReferrer=ei,_.getVideo=function(a,u){var c,m,x=ie.document.createElement("video");x.muted=!0,x.onloadstart=function(){u(null,x)};for(var E=0;E<a.length;E++){var A=ie.document.createElement("source");c=a[E],m=void 0,(m=ie.document.createElement("a")).href=c,(m.protocol!==ie.document.location.protocol||m.host!==ie.document.location.host)&&(x.crossOrigin="Anonymous"),A.src=a[E],x.appendChild(A)}return{cancel:function(){}}},_.identity=po,_.invert=function(a,u){var c=u[0],m=u[1],x=u[2],E=u[3],A=u[4],I=u[5],D=u[6],N=u[7],j=u[8],X=u[9],ee=u[10],R=u[11],Ce=u[12],Oe=u[13],Qe=u[14],He=u[15],xt=c*I-m*A,It=c*D-x*A,Vt=c*N-E*A,jt=m*D-x*I,fr=m*N-E*I,Lr=x*N-E*D,Gr=j*Oe-X*Ce,Dn=j*Qe-ee*Ce,sn=j*He-R*Ce,zn=X*Qe-ee*Oe,cn=X*He-R*Oe,Ei=ee*He-R*Qe,Qn=xt*Ei-It*cn+Vt*zn+jt*sn-fr*Dn+Lr*Gr;return Qn?(a[0]=(I*Ei-D*cn+N*zn)*(Qn=1/Qn),a[1]=(x*cn-m*Ei-E*zn)*Qn,a[2]=(Oe*Lr-Qe*fr+He*jt)*Qn,a[3]=(ee*fr-X*Lr-R*jt)*Qn,a[4]=(D*sn-A*Ei-N*Dn)*Qn,a[5]=(c*Ei-x*sn+E*Dn)*Qn,a[6]=(Qe*Vt-Ce*Lr-He*It)*Qn,a[7]=(j*Lr-ee*Vt+R*It)*Qn,a[8]=(A*cn-I*sn+N*Gr)*Qn,a[9]=(m*sn-c*cn-E*Gr)*Qn,a[10]=(Ce*fr-Oe*Vt+He*xt)*Qn,a[11]=(X*Vt-j*fr-R*xt)*Qn,a[12]=(I*Dn-A*zn-D*Gr)*Qn,a[13]=(c*zn-m*Dn+x*Gr)*Qn,a[14]=(Oe*It-Ce*jt-Qe*xt)*Qn,a[15]=(j*jt-X*It+ee*xt)*Qn,a):null},_.isChar=Yr,_.isMapboxURL=Zi,_.keysDifference=function(a,u){var c=[];for(var m in a)m in u||c.push(m);return c},_.makeRequest=Eo,_.mapObject=ur,_.mercatorXfromLng=kh,_.mercatorYfromLat=Wd,_.mercatorZfromAltitude=rg,_.mul=Bc,_.multiply=io,_.mvt=Ul,_.nextPowerOfTwo=function(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))},_.normalize=function(a,u){var c=u[0],m=u[1],x=u[2],E=c*c+m*m+x*x;return E>0&&(E=1/Math.sqrt(E)),a[0]=u[0]*E,a[1]=u[1]*E,a[2]=u[2]*E,a},_.number=Ya,_.offscreenCanvasSupported=Rn,_.ortho=function(a,u,c,m,x,E,A){var I=1/(u-c),D=1/(m-x),N=1/(E-A);return a[0]=-2*I,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*D,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*N,a[11]=0,a[12]=(u+c)*I,a[13]=(x+m)*D,a[14]=(A+E)*N,a[15]=1,a},_.parseGlyphPBF=function(a){return new zt(a).readFields(xr,[])},_.pbf=zt,_.performSymbolLayout=function(a,u,c,m,x,E,A){a.createArrays(),a.tilePixelRatio=8192/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;var I=a.layers[0].layout,D=a.layers[0]._unevaluatedLayout._values,N={};if(a.textSizeData.kind==="composite"){var j=a.textSizeData,X=j.maxZoom;N.compositeTextSizes=[D["text-size"].possiblyEvaluate(new B(j.minZoom),A),D["text-size"].possiblyEvaluate(new B(X),A)]}if(a.iconSizeData.kind==="composite"){var ee=a.iconSizeData,R=ee.maxZoom;N.compositeIconSizes=[D["icon-size"].possiblyEvaluate(new B(ee.minZoom),A),D["icon-size"].possiblyEvaluate(new B(R),A)]}N.layoutTextSize=D["text-size"].possiblyEvaluate(new B(a.zoom+1),A),N.layoutIconSize=D["icon-size"].possiblyEvaluate(new B(a.zoom+1),A),N.textMaxSize=D["text-size"].possiblyEvaluate(new B(18));for(var Ce=24*I.get("text-line-height"),Oe=I.get("text-rotation-alignment")==="map"&&I.get("symbol-placement")!=="point",Qe=I.get("text-keep-upright"),He=I.get("text-size"),xt=function(){var jt=Vt[It],fr=I.get("text-font").evaluate(jt,{},A).join(","),Lr=He.evaluate(jt,{},A),Gr=N.layoutTextSize.evaluate(jt,{},A),Dn=N.layoutIconSize.evaluate(jt,{},A),sn={horizontal:{},vertical:void 0},zn=jt.text,cn=[0,0];if(zn){var Ei=zn.toString(),Qn=24*I.get("text-letter-spacing").evaluate(jt,{},A),Tn=function(zi){for(var fa=0,va=zi;fa<va.length;fa+=1)if(Xi=va[fa].charCodeAt(0),Yr.Arabic(Xi)||Yr["Arabic Supplement"](Xi)||Yr["Arabic Extended-A"](Xi)||Yr["Arabic Presentation Forms-A"](Xi)||Yr["Arabic Presentation Forms-B"](Xi))return!1;var Xi;return!0}(Ei)?Qn:0,Ii=I.get("text-anchor").evaluate(jt,{},A),gi=I.get("text-variable-anchor");if(!gi){var Bi=I.get("text-radial-offset").evaluate(jt,{},A);cn=Bi?st(Ii,[24*Bi,Ye]):I.get("text-offset").evaluate(jt,{},A).map(function(zi){return 24*zi})}var Zn=Oe?"center":I.get("text-justify").evaluate(jt,{},A),ra=I.get("symbol-placement"),Ua=ra==="point"?24*I.get("text-max-width").evaluate(jt,{},A):0,Ja=function(){a.allowVerticalPlacement&&ol(Ei)&&(sn.vertical=yi(zn,u,c,x,fr,Ua,Ce,Ii,"left",Tn,cn,tt.vertical,!0,ra,Gr,Lr))};if(!Oe&&gi){for(var so=Zn==="auto"?gi.map(function(zi){return pt(zi)}):[Zn],za=!1,co=0;co<so.length;co++){var Go=so[co];if(!sn.horizontal[Go])if(za)sn.horizontal[Go]=sn.horizontal[0];else{var Uo=yi(zn,u,c,x,fr,Ua,Ce,"center",Go,Tn,cn,tt.horizontal,!1,ra,Gr,Lr);Uo&&(sn.horizontal[Go]=Uo,za=Uo.positionedLines.length===1)}}Ja()}else{Zn==="auto"&&(Zn=pt(Ii));var Zs=yi(zn,u,c,x,fr,Ua,Ce,Ii,Zn,Tn,cn,tt.horizontal,!1,ra,Gr,Lr);Zs&&(sn.horizontal[Zn]=Zs),Ja(),ol(Ei)&&Oe&&Qe&&(sn.vertical=yi(zn,u,c,x,fr,Ua,Ce,Ii,Zn,Tn,cn,tt.vertical,!1,ra,Gr,Lr))}}var Fa=void 0,Vs=!1;if(jt.icon&&jt.icon.name){var bo=m[jt.icon.name];bo&&(Fa=function(zi,fa,va){var Xi=Sa(va),js=fa[0]-zi.displaySize[0]*Xi.horizontalAlign,ns=fa[1]-zi.displaySize[1]*Xi.verticalAlign;return{image:zi,top:ns,bottom:ns+zi.displaySize[1],left:js,right:js+zi.displaySize[0]}}(x[jt.icon.name],I.get("icon-offset").evaluate(jt,{},A),I.get("icon-anchor").evaluate(jt,{},A)),Vs=bo.sdf,a.sdfIcons===void 0?a.sdfIcons=bo.sdf:a.sdfIcons!==bo.sdf&&ft("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(bo.pixelRatio!==a.pixelRatio||I.get("icon-rotate").constantOr(1)!==0)&&(a.iconsNeedLinear=!0))}var rs=rt(sn.horizontal)||sn.vertical;a.iconsInText=!!rs&&rs.iconsInText,(rs||Fa)&&function(zi,fa,va,Xi,js,ns,Ba,Po,ws,qi,Zl){var su=ns.textMaxSize.evaluate(fa,{});su===void 0&&(su=Ba);var vl,eo=zi.layers[0].layout,Vl=eo.get("icon-offset").evaluate(fa,{},Zl),$u=rt(va.horizontal),Ef=Ba/24,pc=zi.tilePixelRatio*Ef,Cs=zi.tilePixelRatio*su/24,dc=zi.tilePixelRatio*Po,Jf=zi.tilePixelRatio*eo.get("symbol-spacing"),vc=eo.get("text-padding")*zi.tilePixelRatio,Ep=eo.get("icon-padding")*zi.tilePixelRatio,ed=eo.get("text-max-angle")/180*Math.PI,Xd=eo.get("text-rotation-alignment")==="map"&&eo.get("symbol-placement")!=="point",td=eo.get("icon-rotation-alignment")==="map"&&eo.get("symbol-placement")!=="point",Hc=eo.get("symbol-placement"),Sf=Jf/2,Sp=eo.get("icon-text-fit");Xi&&Sp!=="none"&&(zi.allowVerticalPlacement&&va.vertical&&(vl=_o(Xi,va.vertical,Sp,eo.get("icon-text-fit-padding"),Vl,Ef)),$u&&(Xi=_o(Xi,$u,Sp,eo.get("icon-text-fit-padding"),Vl,Ef)));var eh=function(ig,qd){qd.x<0||qd.x>=8192||qd.y<0||qd.y>=8192||function(fo,gc,A0,ah,Kd,ag,sd,_c,ud,wp,ld,cd,Qd,Wv,Cp,Gv,Xv,$v,Yv,qv,bu,fd,Kv,yc,Hs){var Qv,oh,Nh,Uh,zh,Zh=fo.addToLineVertexArray(gc,A0),Jv=0,em=0,tm=0,rm=0,Jd=-1,ev=-1,Xc={},nm=we(""),tv=0,rv=0;if(_c._unevaluatedLayout.getValue("text-radial-offset")===void 0?(tv=(Qv=_c.layout.get("text-offset").evaluate(bu,{},yc).map(function(dd){return 24*dd}))[0],rv=Qv[1]):(tv=24*_c.layout.get("text-radial-offset").evaluate(bu,{},yc),rv=Ye),fo.allowVerticalPlacement&&ah.vertical){var og=_c.layout.get("text-rotate").evaluate(bu,{},yc)+90;Uh=new da(ud,gc,wp,ld,cd,ah.vertical,Qd,Wv,Cp,og),sd&&(zh=new da(ud,gc,wp,ld,cd,sd,Xv,$v,Cp,og))}if(Kd){var im=_c.layout.get("icon-rotate").evaluate(bu,{}),sg=_c.layout.get("icon-text-fit")!=="none",ug=ke(Kd,im,Kv,sg),nv=sd?ke(sd,im,Kv,sg):void 0;Nh=new da(ud,gc,wp,ld,cd,Kd,Xv,$v,!1,im),Jv=4*ug.length;var am=fo.iconSizeData,Vh=null;am.kind==="source"?(Vh=[128*_c.layout.get("icon-size").evaluate(bu,{})])[0]>32640&&ft(fo.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):am.kind==="composite"&&((Vh=[128*fd.compositeIconSizes[0].evaluate(bu,{},yc),128*fd.compositeIconSizes[1].evaluate(bu,{},yc)])[0]>32640||Vh[1]>32640)&&ft(fo.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),fo.addSymbols(fo.icon,ug,Vh,qv,Yv,bu,!1,gc,Zh.lineStartIndex,Zh.lineLength,-1,yc),Jd=fo.icon.placedSymbolArray.length-1,nv&&(em=4*nv.length,fo.addSymbols(fo.icon,nv,Vh,qv,Yv,bu,tt.vertical,gc,Zh.lineStartIndex,Zh.lineLength,-1,yc),ev=fo.icon.placedSymbolArray.length-1)}for(var om in ah.horizontal){var hd=ah.horizontal[om];if(!oh){nm=we(hd.text);var lg=_c.layout.get("text-rotate").evaluate(bu,{},yc);oh=new da(ud,gc,wp,ld,cd,hd,Qd,Wv,Cp,lg)}var cg=hd.positionedLines.length===1;if(tm+=Me(fo,gc,hd,ag,_c,Cp,bu,Gv,Zh,ah.vertical?tt.horizontal:tt.horizontalOnly,cg?Object.keys(ah.horizontal):[om],Xc,Jd,fd,yc),cg)break}ah.vertical&&(rm+=Me(fo,gc,ah.vertical,ag,_c,Cp,bu,Gv,Zh,tt.vertical,["vertical"],Xc,ev,fd,yc));var fg=oh?oh.boxStartIndex:fo.collisionBoxArray.length,T0=oh?oh.boxEndIndex:fo.collisionBoxArray.length,hg=Uh?Uh.boxStartIndex:fo.collisionBoxArray.length,pg=Uh?Uh.boxEndIndex:fo.collisionBoxArray.length,w0=Nh?Nh.boxStartIndex:fo.collisionBoxArray.length,C0=Nh?Nh.boxEndIndex:fo.collisionBoxArray.length,R0=zh?zh.boxStartIndex:fo.collisionBoxArray.length,M0=zh?zh.boxEndIndex:fo.collisionBoxArray.length,$c=-1,pd=function(dd,sm){return dd&&dd.circleDiameter?Math.max(dd.circleDiameter,sm):sm};$c=pd(oh,$c),$c=pd(Uh,$c),$c=pd(Nh,$c);var dg=($c=pd(zh,$c))>-1?1:0;dg&&($c*=Hs/24),fo.glyphOffsetArray.length>=_n.MAX_GLYPHS&&ft("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),bu.sortKey!==void 0&&fo.addToSortKeyRanges(fo.symbolInstances.length,bu.sortKey),fo.symbolInstances.emplaceBack(gc.x,gc.y,Xc.right>=0?Xc.right:-1,Xc.center>=0?Xc.center:-1,Xc.left>=0?Xc.left:-1,Xc.vertical||-1,Jd,ev,nm,fg,T0,hg,pg,w0,C0,R0,M0,wp,tm,rm,Jv,em,dg,0,Qd,tv,rv,$c)}(zi,qd,ig,va,Xi,js,vl,zi.layers[0],zi.collisionBoxArray,fa.index,fa.sourceLayerIndex,zi.index,pc,vc,Xd,ws,dc,Ep,td,Vl,fa,ns,qi,Zl,Ba)};if(Hc==="line")for(var Ap=0,rd=Xu(fa.geometry,0,0,8192,8192);Ap<rd.length;Ap+=1)for(var $d=rd[Ap],nd=0,id=yo($d,Jf,ed,va.vertical||$u,Xi,24,Cs,zi.overscaling,8192);nd<id.length;nd+=1){var Wc=id[nd];$u&&ve(zi,$u.text,Sf,Wc)||eh($d,Wc)}else if(Hc==="line-center")for(var Fh=0,th=fa.geometry;Fh<th.length;Fh+=1){var Bh=th[Fh];if(Bh.length>1){var rh=Gi(Bh,ed,va.vertical||$u,Xi,24,Cs);rh&&eh(Bh,rh)}}else if(fa.type==="Polygon")for(var nh=0,Tp=pp(fa.geometry,0);nh<Tp.length;nh+=1){var Gc=Tp[nh],Lh=ze(Gc,16);eh(Gc[0],new Qa(Lh.x,Lh.y,0))}else if(fa.type==="LineString")for(var mc=0,ih=fa.geometry;mc<ih.length;mc+=1){var xu=ih[mc];eh(xu,new Qa(xu[0].x,xu[0].y,0))}else if(fa.type==="Point")for(var ad=0,Yd=fa.geometry;ad<Yd.length;ad+=1)for(var Hv=0,S0=Yd[ad];Hv<S0.length;Hv+=1){var od=S0[Hv];eh([od],new Qa(od.x,od.y,0))}}(a,jt,sn,Fa,m,N,Gr,Dn,cn,Vs,A)},It=0,Vt=a.features;It<Vt.length;It+=1)xt();E&&a.generateCollisionDebugBuffers()},_.perspective=function(a,u,c,m,x){var E,A=1/Math.tan(u/2);return a[0]=A/c,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=A,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,x!=null&&x!==1/0?(a[10]=(x+m)*(E=1/(m-x)),a[14]=2*x*m*E):(a[10]=-1,a[14]=-2*m),a},_.pick=function(a,u){for(var c={},m=0;m<u.length;m++){var x=u[m];x in a&&(c[x]=a[x])}return c},_.plugin=Ie,_.polygonIntersectsPolygon=Zu,_.postMapLoadEvent=Ve,_.postTurnstileEvent=Kt,_.potpack=ui,_.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],_.register=vn,_.registerForPluginStateChange=function(a){return a({pluginStatus:Yo,pluginURL:Lu}),lf.on("pluginStateChange",a),a},_.renderColorRamp=hf,_.rotate=function(a,u,c){var m=u[0],x=u[1],E=u[2],A=u[3],I=Math.sin(c),D=Math.cos(c);return a[0]=m*D+E*I,a[1]=x*D+A*I,a[2]=m*-I+E*D,a[3]=x*-I+A*D,a},_.rotateX=function(a,u,c){var m=Math.sin(c),x=Math.cos(c),E=u[4],A=u[5],I=u[6],D=u[7],N=u[8],j=u[9],X=u[10],ee=u[11];return u!==a&&(a[0]=u[0],a[1]=u[1],a[2]=u[2],a[3]=u[3],a[12]=u[12],a[13]=u[13],a[14]=u[14],a[15]=u[15]),a[4]=E*x+N*m,a[5]=A*x+j*m,a[6]=I*x+X*m,a[7]=D*x+ee*m,a[8]=N*x-E*m,a[9]=j*x-A*m,a[10]=X*x-I*m,a[11]=ee*x-D*m,a},_.rotateZ=function(a,u,c){var m=Math.sin(c),x=Math.cos(c),E=u[0],A=u[1],I=u[2],D=u[3],N=u[4],j=u[5],X=u[6],ee=u[7];return u!==a&&(a[8]=u[8],a[9]=u[9],a[10]=u[10],a[11]=u[11],a[12]=u[12],a[13]=u[13],a[14]=u[14],a[15]=u[15]),a[0]=E*x+N*m,a[1]=A*x+j*m,a[2]=I*x+X*m,a[3]=D*x+ee*m,a[4]=N*x-E*m,a[5]=j*x-A*m,a[6]=X*x-I*m,a[7]=ee*x-D*m,a},_.scale=function(a,u,c){var m=c[0],x=c[1],E=c[2];return a[0]=u[0]*m,a[1]=u[1]*m,a[2]=u[2]*m,a[3]=u[3]*m,a[4]=u[4]*x,a[5]=u[5]*x,a[6]=u[6]*x,a[7]=u[7]*x,a[8]=u[8]*E,a[9]=u[9]*E,a[10]=u[10]*E,a[11]=u[11]*E,a[12]=u[12],a[13]=u[13],a[14]=u[14],a[15]=u[15],a},_.scale$1=function(a,u,c){return a[0]=u[0]*c,a[1]=u[1]*c,a[2]=u[2]*c,a[3]=u[3]*c,a},_.scale$2=function(a,u,c){return a[0]=u[0]*c,a[1]=u[1]*c,a[2]=u[2]*c,a},_.setCacheLimits=function(a,u){wt=a,sr=u},_.setRTLTextPlugin=function(a,u,c){if(c===void 0&&(c=!1),Yo==="deferred"||Yo==="loading"||Yo==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");Lu=Cn.resolveURL(a),Yo="deferred",Uf=u,Il(),c||Ct()},_.sphericalToCartesian=function(a){var u=a[0],c=a[1],m=a[2];return c+=90,c*=Math.PI/180,m*=Math.PI/180,{x:u*Math.cos(c)*Math.sin(m),y:u*Math.sin(c)*Math.sin(m),z:u*Math.cos(m)}},_.sqrLen=function(a){var u=a[0],c=a[1];return u*u+c*c},_.styleSpec=V,_.sub=function(a,u,c){return a[0]=u[0]-c[0],a[1]=u[1]-c[1],a[2]=u[2]-c[2],a},_.symbolSize=xi,_.transformMat3=function(a,u,c){var m=u[0],x=u[1],E=u[2];return a[0]=m*c[0]+x*c[3]+E*c[6],a[1]=m*c[1]+x*c[4]+E*c[7],a[2]=m*c[2]+x*c[5]+E*c[8],a},_.transformMat4=Bl,_.translate=function(a,u,c){var m,x,E,A,I,D,N,j,X,ee,R,Ce,Oe=c[0],Qe=c[1],He=c[2];return u===a?(a[12]=u[0]*Oe+u[4]*Qe+u[8]*He+u[12],a[13]=u[1]*Oe+u[5]*Qe+u[9]*He+u[13],a[14]=u[2]*Oe+u[6]*Qe+u[10]*He+u[14],a[15]=u[3]*Oe+u[7]*Qe+u[11]*He+u[15]):(x=u[1],E=u[2],A=u[3],I=u[4],D=u[5],N=u[6],j=u[7],X=u[8],ee=u[9],R=u[10],Ce=u[11],a[0]=m=u[0],a[1]=x,a[2]=E,a[3]=A,a[4]=I,a[5]=D,a[6]=N,a[7]=j,a[8]=X,a[9]=ee,a[10]=R,a[11]=Ce,a[12]=m*Oe+I*Qe+X*He+u[12],a[13]=x*Oe+D*Qe+ee*He+u[13],a[14]=E*Oe+N*Qe+R*He+u[14],a[15]=A*Oe+j*Qe+Ce*He+u[15]),a},_.triggerPluginCompletionEvent=sp,_.uniqueId=Xt,_.validateCustomStyleLayer=function(a){var u=[],c=a.id;return c===void 0&&u.push({message:"layers."+c+': missing required property "id"'}),a.render===void 0&&u.push({message:"layers."+c+': missing required method "render"'}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&u.push({message:"layers."+c+': property "renderingMode" must be either "2d" or "3d"'}),u},_.validateLight=op,_.validateStyle=sf,_.values=function(a){var u=[];for(var c in a)u.push(a[c]);return u},_.vectorTile=Ul,_.version="1.13.3",_.warnOnce=ft,_.webpSupported=un,_.window=ie,_.wrap=Yt}),pe(["./shared"],function(_){"use strict";function le(W){var Q=typeof W;if(Q==="number"||Q==="boolean"||Q==="string"||W==null)return JSON.stringify(W);if(Array.isArray(W)){for(var se="[",xe=0,Re=W;xe<Re.length;xe+=1)se+=le(Re[xe])+",";return se+"]"}for(var Je=Object.keys(W).sort(),lt="{",V=0;V<Je.length;V++)lt+=JSON.stringify(Je[V])+":"+le(W[Je[V]])+",";return lt+"}"}function U(W){for(var Q="",se=0,xe=_.refProperties;se<xe.length;se+=1)Q+="/"+le(W[xe[se]]);return Q}var he=function(W){this.keyCache={},W&&this.replace(W)};he.prototype.replace=function(W){this._layerConfigs={},this._layers={},this.update(W,[])},he.prototype.update=function(W,Q){for(var se=this,xe=0,Re=W;xe<Re.length;xe+=1){var Je=Re[xe];this._layerConfigs[Je.id]=Je;var lt=this._layers[Je.id]=_.createStyleLayer(Je);lt._featureFilter=_.featureFilter(lt.filter),this.keyCache[Je.id]&&delete this.keyCache[Je.id]}for(var V=0,q=Q;V<q.length;V+=1){var De=q[V];delete this.keyCache[De],delete this._layerConfigs[De],delete this._layers[De]}this.familiesBySource={};for(var et=0,be=function(Hr,$r){for(var hi={},Qr=0;Qr<Hr.length;Qr++){var vi=$r&&$r[Hr[Qr].id]||U(Hr[Qr]);$r&&($r[Hr[Qr].id]=vi);var Yi=hi[vi];Yi||(Yi=hi[vi]=[]),Yi.push(Hr[Qr])}var ci=[];for(var Li in hi)ci.push(hi[Li]);return ci}(_.values(this._layerConfigs),this.keyCache);et<be.length;et+=1){var er=be[et].map(function(Hr){return se._layers[Hr.id]}),Tr=er[0];if(Tr.visibility!=="none"){var bn=Tr.source||"",nn=this.familiesBySource[bn];nn||(nn=this.familiesBySource[bn]={});var ar=Tr.sourceLayer||"_geojsonTileLayer",Kr=nn[ar];Kr||(Kr=nn[ar]=[]),Kr.push(er)}}};var ae=function(W){var Q={},se=[];for(var xe in W){var Re=W[xe],Je=Q[xe]={};for(var lt in Re){var V=Re[+lt];if(V&&V.bitmap.width!==0&&V.bitmap.height!==0){var q={x:0,y:0,w:V.bitmap.width+2,h:V.bitmap.height+2};se.push(q),Je[lt]={rect:q,metrics:V.metrics}}}}var De=_.potpack(se),et=new _.AlphaImage({width:De.w||1,height:De.h||1});for(var be in W){var er=W[be];for(var Tr in er){var bn=er[+Tr];if(bn&&bn.bitmap.width!==0&&bn.bitmap.height!==0){var nn=Q[be][Tr].rect;_.AlphaImage.copy(bn.bitmap,et,{x:0,y:0},{x:nn.x+1,y:nn.y+1},bn.bitmap)}}}this.image=et,this.positions=Q};_.register("GlyphAtlas",ae);var qe=function(W){this.tileID=new _.OverscaledTileID(W.tileID.overscaledZ,W.tileID.wrap,W.tileID.canonical.z,W.tileID.canonical.x,W.tileID.canonical.y),this.uid=W.uid,this.zoom=W.zoom,this.pixelRatio=W.pixelRatio,this.tileSize=W.tileSize,this.source=W.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=W.showCollisionBoxes,this.collectResourceTiming=!!W.collectResourceTiming,this.returnDependencies=!!W.returnDependencies,this.promoteId=W.promoteId};function ie(W,Q,se){for(var xe=new _.EvaluationParameters(Q),Re=0,Je=W;Re<Je.length;Re+=1)Je[Re].recalculate(xe,se)}function Ke(W,Q){var se=_.getArrayBuffer(W.request,function(xe,Re,Je,lt){xe?Q(xe):Re&&Q(null,{vectorTile:new _.vectorTile.VectorTile(new _.pbf(Re)),rawData:Re,cacheControl:Je,expires:lt})});return function(){se.cancel(),Q()}}qe.prototype.parse=function(W,Q,se,xe,Re){var Je=this;this.status="parsing",this.data=W,this.collisionBoxArray=new _.CollisionBoxArray;var lt=new _.DictionaryCoder(Object.keys(W.layers).sort()),V=new _.FeatureIndex(this.tileID,this.promoteId);V.bucketLayerIDs=[];var q,De,et,be,er={},Tr={featureIndex:V,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:se},bn=Q.familiesBySource[this.source];for(var nn in bn){var ar=W.layers[nn];if(ar){ar.version===1&&_.warnOnce('Vector tile source "'+this.source+'" layer "'+nn+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var Kr=lt.encode(nn),Hr=[],$r=0;$r<ar.length;$r++){var hi=ar.feature($r),Qr=V.getId(hi,nn);Hr.push({feature:hi,id:Qr,index:$r,sourceLayerIndex:Kr})}for(var vi=0,Yi=bn[nn];vi<Yi.length;vi+=1){var ci=Yi[vi],Li=ci[0];Li.minzoom&&this.zoom<Math.floor(Li.minzoom)||Li.maxzoom&&this.zoom>=Li.maxzoom||Li.visibility!=="none"&&(ie(ci,this.zoom,se),(er[Li.id]=Li.createBucket({index:V.bucketLayerIDs.length,layers:ci,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Kr,sourceID:this.source})).populate(Hr,Tr,this.tileID.canonical),V.bucketLayerIDs.push(ci.map(function(Ai){return Ai.id})))}}}var Si=_.mapObject(Tr.glyphDependencies,function(Ai){return Object.keys(Ai).map(Number)});Object.keys(Si).length?xe.send("getGlyphs",{uid:this.uid,stacks:Si},function(Ai,mi){q||(q=Ai,De=mi,Ia.call(Je))}):De={};var Xo=Object.keys(Tr.iconDependencies);Xo.length?xe.send("getImages",{icons:Xo,source:this.source,tileID:this.tileID,type:"icons"},function(Ai,mi){q||(q=Ai,et=mi,Ia.call(Je))}):et={};var Ki=Object.keys(Tr.patternDependencies);function Ia(){if(q)return Re(q);if(De&&et&&be){var Ai=new ae(De),mi=new _.ImageAtlas(et,be);for(var Ti in er){var Pa=er[Ti];Pa instanceof _.SymbolBucket?(ie(Pa.layers,this.zoom,se),_.performSymbolLayout(Pa,De,Ai.positions,et,mi.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):Pa.hasPattern&&(Pa instanceof _.LineBucket||Pa instanceof _.FillBucket||Pa instanceof _.FillExtrusionBucket)&&(ie(Pa.layers,this.zoom,se),Pa.addFeatures(Tr,this.tileID.canonical,mi.patternPositions))}this.status="done",Re(null,{buckets:_.values(er).filter(function(cu){return!cu.isEmpty()}),featureIndex:V,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ai.image,imageAtlas:mi,glyphMap:this.returnDependencies?De:null,iconMap:this.returnDependencies?et:null,glyphPositions:this.returnDependencies?Ai.positions:null})}}Ki.length?xe.send("getImages",{icons:Ki,source:this.source,tileID:this.tileID,type:"patterns"},function(Ai,mi){q||(q=Ai,be=mi,Ia.call(Je))}):be={},Ia.call(this)};var ht=function(W,Q,se,xe){this.actor=W,this.layerIndex=Q,this.availableImages=se,this.loadVectorData=xe||Ke,this.loading={},this.loaded={}};ht.prototype.loadTile=function(W,Q){var se=this,xe=W.uid;this.loading||(this.loading={});var Re=!!(W&&W.request&&W.request.collectResourceTiming)&&new _.RequestPerformance(W.request),Je=this.loading[xe]=new qe(W);Je.abort=this.loadVectorData(W,function(lt,V){if(delete se.loading[xe],lt||!V)return Je.status="done",se.loaded[xe]=Je,Q(lt);var q=V.rawData,De={};V.expires&&(De.expires=V.expires),V.cacheControl&&(De.cacheControl=V.cacheControl);var et={};if(Re){var be=Re.finish();be&&(et.resourceTiming=JSON.parse(JSON.stringify(be)))}Je.vectorTile=V.vectorTile,Je.parse(V.vectorTile,se.layerIndex,se.availableImages,se.actor,function(er,Tr){if(er||!Tr)return Q(er);Q(null,_.extend({rawTileData:q.slice(0)},Tr,De,et))}),se.loaded=se.loaded||{},se.loaded[xe]=Je})},ht.prototype.reloadTile=function(W,Q){var se=this,xe=this.loaded,Re=W.uid,Je=this;if(xe&&xe[Re]){var lt=xe[Re];lt.showCollisionBoxes=W.showCollisionBoxes;var V=function(q,De){var et=lt.reloadCallback;et&&(delete lt.reloadCallback,lt.parse(lt.vectorTile,Je.layerIndex,se.availableImages,Je.actor,et)),Q(q,De)};lt.status==="parsing"?lt.reloadCallback=V:lt.status==="done"&&(lt.vectorTile?lt.parse(lt.vectorTile,this.layerIndex,this.availableImages,this.actor,V):V())}},ht.prototype.abortTile=function(W,Q){var se=this.loading,xe=W.uid;se&&se[xe]&&se[xe].abort&&(se[xe].abort(),delete se[xe]),Q()},ht.prototype.removeTile=function(W,Q){var se=this.loaded,xe=W.uid;se&&se[xe]&&delete se[xe],Q()};var mt=_.window.ImageBitmap,Dt=function(){this.loaded={}};function Yt(W,Q){if(W.length!==0){Ht(W[0],Q);for(var se=1;se<W.length;se++)Ht(W[se],!Q)}}function Ht(W,Q){for(var se=0,xe=0,Re=0,Je=W.length,lt=Je-1;Re<Je;lt=Re++){var V=(W[Re][0]-W[lt][0])*(W[lt][1]+W[Re][1]),q=se+V;xe+=Math.abs(se)>=Math.abs(V)?se-q+V:V-q+se,se=q}se+xe>=0!=!!Q&&W.reverse()}Dt.prototype.loadTile=function(W,Q){var se=W.uid,xe=W.encoding,Re=W.rawImageData,Je=mt&&Re instanceof mt?this.getImageData(Re):Re,lt=new _.DEMData(se,Je,xe);this.loaded=this.loaded||{},this.loaded[se]=lt,Q(null,lt)},Dt.prototype.getImageData=function(W){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(W.width,W.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=W.width,this.offscreenCanvas.height=W.height,this.offscreenCanvasContext.drawImage(W,0,0,W.width,W.height);var Q=this.offscreenCanvasContext.getImageData(-1,-1,W.width+2,W.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new _.RGBAImage({width:Q.width,height:Q.height},Q.data)},Dt.prototype.removeTile=function(W){var Q=this.loaded,se=W.uid;Q&&Q[se]&&delete Q[se]};var ir=_.vectorTile.VectorTileFeature.prototype.toGeoJSON,Xt=function(W){this._feature=W,this.extent=_.EXTENT,this.type=W.type,this.properties=W.tags,"id"in W&&!isNaN(W.id)&&(this.id=parseInt(W.id,10))};Xt.prototype.loadGeometry=function(){if(this._feature.type===1){for(var W=[],Q=0,se=this._feature.geometry;Q<se.length;Q+=1){var xe=se[Q];W.push([new _.Point$1(xe[0],xe[1])])}return W}for(var Re=[],Je=0,lt=this._feature.geometry;Je<lt.length;Je+=1){for(var V=[],q=0,De=lt[Je];q<De.length;q+=1){var et=De[q];V.push(new _.Point$1(et[0],et[1]))}Re.push(V)}return Re},Xt.prototype.toGeoJSON=function(W,Q,se){return ir.call(this,W,Q,se)};var yt=function(W){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=_.EXTENT,this.length=W.length,this._features=W};yt.prototype.feature=function(W){return new Xt(this._features[W])};var bt=_.vectorTile.VectorTileFeature,Pr=hr;function hr(W,Q){this.options=Q||{},this.features=W,this.length=W.length}function ur(W,Q){this.id=typeof W.id=="number"?W.id:void 0,this.type=W.type,this.rawGeometry=W.type===1?[W.geometry]:W.geometry,this.properties=W.tags,this.extent=Q||4096}hr.prototype.feature=function(W){return new ur(this.features[W],this.options.extent)},ur.prototype.loadGeometry=function(){var W=this.rawGeometry;this.geometry=[];for(var Q=0;Q<W.length;Q++){for(var se=W[Q],xe=[],Re=0;Re<se.length;Re++)xe.push(new _.Point$1(se[Re][0],se[Re][1]));this.geometry.push(xe)}return this.geometry},ur.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var W=this.geometry,Q=1/0,se=-1/0,xe=1/0,Re=-1/0,Je=0;Je<W.length;Je++)for(var lt=W[Je],V=0;V<lt.length;V++){var q=lt[V];Q=Math.min(Q,q.x),se=Math.max(se,q.x),xe=Math.min(xe,q.y),Re=Math.max(Re,q.y)}return[Q,xe,se,Re]},ur.prototype.toGeoJSON=bt.prototype.toGeoJSON;var Et=Pt,nt=Pr;function Pt(W){var Q=new _.pbf;return function(se,xe){for(var Re in se.layers)xe.writeMessage(3,ft,se.layers[Re])}(W,Q),Q.finish()}function ft(W,Q){var se;Q.writeVarintField(15,W.version||1),Q.writeStringField(1,W.name||""),Q.writeVarintField(5,W.extent||4096);var xe={keys:[],values:[],keycache:{},valuecache:{}};for(se=0;se<W.length;se++)xe.feature=W.feature(se),Q.writeMessage(2,qt,xe);var Re=xe.keys;for(se=0;se<Re.length;se++)Q.writeStringField(3,Re[se]);var Je=xe.values;for(se=0;se<Je.length;se++)Q.writeMessage(4,Be,Je[se])}function qt(W,Q){var se=W.feature;se.id!==void 0&&Q.writeVarintField(1,se.id),Q.writeMessage(2,Sr,W),Q.writeVarintField(3,se.type),Q.writeMessage(4,K,se)}function Sr(W,Q){var se=W.feature,xe=W.keys,Re=W.values,Je=W.keycache,lt=W.valuecache;for(var V in se.properties){var q=Je[V];q===void 0&&(xe.push(V),Je[V]=q=xe.length-1),Q.writeVarint(q);var De=se.properties[V],et=typeof De;et!=="string"&&et!=="boolean"&&et!=="number"&&(De=JSON.stringify(De));var be=et+":"+De,er=lt[be];er===void 0&&(Re.push(De),lt[be]=er=Re.length-1),Q.writeVarint(er)}}function te(W,Q){return(Q<<3)+(7&W)}function H(W){return W<<1^W>>31}function K(W,Q){for(var se=W.loadGeometry(),xe=W.type,Re=0,Je=0,lt=se.length,V=0;V<lt;V++){var q=se[V],De=1;xe===1&&(De=q.length),Q.writeVarint(te(1,De));for(var et=xe===3?q.length-1:q.length,be=0;be<et;be++){be===1&&xe!==1&&Q.writeVarint(te(2,et-1));var er=q[be].x-Re,Tr=q[be].y-Je;Q.writeVarint(H(er)),Q.writeVarint(H(Tr)),Re+=er,Je+=Tr}xe===3&&Q.writeVarint(te(7,1))}}function Be(W,Q){var se=typeof W;se==="string"?Q.writeStringField(1,W):se==="boolean"?Q.writeBooleanField(7,W):se==="number"&&(W%1!=0?Q.writeDoubleField(3,W):W<0?Q.writeSVarintField(6,W):Q.writeVarintField(5,W))}function Ae(W,Q,se,xe){dt(W,se,xe),dt(Q,2*se,2*xe),dt(Q,2*se+1,2*xe+1)}function dt(W,Q,se){var xe=W[Q];W[Q]=W[se],W[se]=xe}function Ue(W,Q,se,xe){var Re=W-se,Je=Q-xe;return Re*Re+Je*Je}Et.fromVectorTileJs=Pt,Et.fromGeojsonVt=function(W,Q){Q=Q||{};var se={};for(var xe in W)se[xe]=new Pr(W[xe].features,Q),se[xe].name=xe,se[xe].version=Q.version,se[xe].extent=Q.extent;return Pt({layers:se})},Et.GeoJSONWrapper=nt;var We=function(W){return W[0]},it=function(W){return W[1]},Mt=function(W,Q,se,xe,Re){Q===void 0&&(Q=We),se===void 0&&(se=it),xe===void 0&&(xe=64),Re===void 0&&(Re=Float64Array),this.nodeSize=xe,this.points=W;for(var Je=W.length<65536?Uint16Array:Uint32Array,lt=this.ids=new Je(W.length),V=this.coords=new Re(2*W.length),q=0;q<W.length;q++)lt[q]=q,V[2*q]=Q(W[q]),V[2*q+1]=se(W[q]);(function De(et,be,er,Tr,bn,nn){if(!(bn-Tr<=er)){var ar=Tr+bn>>1;(function Kr(Hr,$r,hi,Qr,vi,Yi){for(;vi>Qr;){if(vi-Qr>600){var ci=vi-Qr+1,Li=hi-Qr+1,Si=Math.log(ci),Xo=.5*Math.exp(2*Si/3),Ki=.5*Math.sqrt(Si*Xo*(ci-Xo)/ci)*(Li-ci/2<0?-1:1);Kr(Hr,$r,hi,Math.max(Qr,Math.floor(hi-Li*Xo/ci+Ki)),Math.min(vi,Math.floor(hi+(ci-Li)*Xo/ci+Ki)),Yi)}var Ia=$r[2*hi+Yi],Ai=Qr,mi=vi;for(Ae(Hr,$r,Qr,hi),$r[2*vi+Yi]>Ia&&Ae(Hr,$r,Qr,vi);Ai<mi;){for(Ae(Hr,$r,Ai,mi),Ai++,mi--;$r[2*Ai+Yi]<Ia;)Ai++;for(;$r[2*mi+Yi]>Ia;)mi--}$r[2*Qr+Yi]===Ia?Ae(Hr,$r,Qr,mi):Ae(Hr,$r,++mi,vi),mi<=hi&&(Qr=mi+1),hi<=mi&&(vi=mi-1)}})(et,be,ar,Tr,bn,nn%2),De(et,be,er,Tr,ar-1,nn+1),De(et,be,er,ar+1,bn,nn+1)}})(lt,V,xe,0,lt.length-1,0)};Mt.prototype.range=function(W,Q,se,xe){return function(Re,Je,lt,V,q,De,et){for(var be,er,Tr=[0,Re.length-1,0],bn=[];Tr.length;){var nn=Tr.pop(),ar=Tr.pop(),Kr=Tr.pop();if(ar-Kr<=et)for(var Hr=Kr;Hr<=ar;Hr++)er=Je[2*Hr+1],(be=Je[2*Hr])>=lt&&be<=q&&er>=V&&er<=De&&bn.push(Re[Hr]);else{var $r=Math.floor((Kr+ar)/2);er=Je[2*$r+1],(be=Je[2*$r])>=lt&&be<=q&&er>=V&&er<=De&&bn.push(Re[$r]);var hi=(nn+1)%2;(nn===0?lt<=be:V<=er)&&(Tr.push(Kr),Tr.push($r-1),Tr.push(hi)),(nn===0?q>=be:De>=er)&&(Tr.push($r+1),Tr.push(ar),Tr.push(hi))}}return bn}(this.ids,this.coords,W,Q,se,xe,this.nodeSize)},Mt.prototype.within=function(W,Q,se){return function(xe,Re,Je,lt,V,q){for(var De=[0,xe.length-1,0],et=[],be=V*V;De.length;){var er=De.pop(),Tr=De.pop(),bn=De.pop();if(Tr-bn<=q)for(var nn=bn;nn<=Tr;nn++)Ue(Re[2*nn],Re[2*nn+1],Je,lt)<=be&&et.push(xe[nn]);else{var ar=Math.floor((bn+Tr)/2),Kr=Re[2*ar],Hr=Re[2*ar+1];Ue(Kr,Hr,Je,lt)<=be&&et.push(xe[ar]);var $r=(er+1)%2;(er===0?Je-V<=Kr:lt-V<=Hr)&&(De.push(bn),De.push(ar-1),De.push($r)),(er===0?Je+V>=Kr:lt+V>=Hr)&&(De.push(ar+1),De.push(Tr),De.push($r))}}return et}(this.ids,this.coords,W,Q,se,this.nodeSize)};var yr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(W){return W}},lr=function(W){this.options=$i(Object.create(yr),W),this.trees=new Array(this.options.maxZoom+1)};function Cn(W,Q,se,xe,Re){return{x:W,y:Q,zoom:1/0,id:se,parentId:-1,numPoints:xe,properties:Re}}function mn(W,Q){var se=W.geometry.coordinates,xe=se[1];return{x:jn(se[0]),y:rn(xe),zoom:1/0,index:Q,parentId:-1}}function un(W){return{type:"Feature",id:W.id,properties:oi(W),geometry:{type:"Point",coordinates:[(xe=W.x,360*(xe-.5)),(Q=W.y,se=(180-360*Q)*Math.PI/180,360*Math.atan(Math.exp(se))/Math.PI-90)]}};var Q,se,xe}function oi(W){var Q=W.numPoints,se=Q>=1e4?Math.round(Q/1e3)+"k":Q>=1e3?Math.round(Q/100)/10+"k":Q;return $i($i({},W.properties),{cluster:!0,cluster_id:W.id,point_count:Q,point_count_abbreviated:se})}function jn(W){return W/360+.5}function rn(W){var Q=Math.sin(W*Math.PI/180),se=.5-.25*Math.log((1+Q)/(1-Q))/Math.PI;return se<0?0:se>1?1:se}function $i(W,Q){for(var se in Q)W[se]=Q[se];return W}function Wi(W){return W.x}function Zi(W){return W.y}function Jn(W,Q,se,xe,Re,Je){var lt=Re-se,V=Je-xe;if(lt!==0||V!==0){var q=((W-se)*lt+(Q-xe)*V)/(lt*lt+V*V);q>1?(se=Re,xe=Je):q>0&&(se+=lt*q,xe+=V*q)}return(lt=W-se)*lt+(V=Q-xe)*V}function Bn(W,Q,se,xe){var Re={id:W===void 0?null:W,type:Q,geometry:se,tags:xe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Je){var lt=Je.geometry,V=Je.type;if(V==="Point"||V==="MultiPoint"||V==="LineString")Do(Je,lt);else if(V==="Polygon"||V==="MultiLineString")for(var q=0;q<lt.length;q++)Do(Je,lt[q]);else if(V==="MultiPolygon")for(q=0;q<lt.length;q++)for(var De=0;De<lt[q].length;De++)Do(Je,lt[q][De])}(Re),Re}function Do(W,Q){for(var se=0;se<Q.length;se+=3)W.minX=Math.min(W.minX,Q[se]),W.minY=Math.min(W.minY,Q[se+1]),W.maxX=Math.max(W.maxX,Q[se]),W.maxY=Math.max(W.maxY,Q[se+1])}function oa(W,Q,se,xe){if(Q.geometry){var Re=Q.geometry.coordinates,Je=Q.geometry.type,lt=Math.pow(se.tolerance/((1<<se.maxZoom)*se.extent),2),V=[],q=Q.id;if(se.promoteId?q=Q.properties[se.promoteId]:se.generateId&&(q=xe||0),Je==="Point")$a(Re,V);else if(Je==="MultiPoint")for(var De=0;De<Re.length;De++)$a(Re[De],V);else if(Je==="LineString")Ot(Re,V,lt,!1);else if(Je==="MultiLineString"){if(se.lineMetrics){for(De=0;De<Re.length;De++)Ot(Re[De],V=[],lt,!1),W.push(Bn(q,"LineString",V,Q.properties));return}F(Re,V,lt,!1)}else if(Je==="Polygon")F(Re,V,lt,!0);else{if(Je!=="MultiPolygon"){if(Je==="GeometryCollection"){for(De=0;De<Q.geometry.geometries.length;De++)oa(W,{id:q,geometry:Q.geometry.geometries[De],properties:Q.properties},se,xe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(De=0;De<Re.length;De++){var et=[];F(Re[De],et,lt,!0),V.push(et)}}W.push(Bn(q,Je,V,Q.properties))}}function $a(W,Q){Q.push(ne(W[0])),Q.push(de(W[1])),Q.push(0)}function Ot(W,Q,se,xe){for(var Re,Je,lt=0,V=0;V<W.length;V++){var q=ne(W[V][0]),De=de(W[V][1]);Q.push(q),Q.push(De),Q.push(0),V>0&&(lt+=xe?(Re*De-q*Je)/2:Math.sqrt(Math.pow(q-Re,2)+Math.pow(De-Je,2))),Re=q,Je=De}var et=Q.length-3;Q[2]=1,function be(er,Tr,bn,nn){for(var ar,Kr=nn,Hr=bn-Tr>>1,$r=bn-Tr,hi=er[Tr],Qr=er[Tr+1],vi=er[bn],Yi=er[bn+1],ci=Tr+3;ci<bn;ci+=3){var Li=Jn(er[ci],er[ci+1],hi,Qr,vi,Yi);if(Li>Kr)ar=ci,Kr=Li;else if(Li===Kr){var Si=Math.abs(ci-Hr);Si<$r&&(ar=ci,$r=Si)}}Kr>nn&&(ar-Tr>3&&be(er,Tr,ar,nn),er[ar+2]=Kr,bn-ar>3&&be(er,ar,bn,nn))}(Q,0,et,se),Q[et+2]=1,Q.size=Math.abs(lt),Q.start=0,Q.end=Q.size}function F(W,Q,se,xe){for(var Re=0;Re<W.length;Re++){var Je=[];Ot(W[Re],Je,se,xe),Q.push(Je)}}function ne(W){return W/360+.5}function de(W){var Q=Math.sin(W*Math.PI/180),se=.5-.25*Math.log((1+Q)/(1-Q))/Math.PI;return se<0?0:se>1?1:se}function Ne(W,Q,se,xe,Re,Je,lt,V){if(xe/=Q,Je>=(se/=Q)&&lt<xe)return W;if(lt<se||Je>=xe)return null;for(var q=[],De=0;De<W.length;De++){var et=W[De],be=et.geometry,er=et.type,Tr=Re===0?et.minX:et.minY,bn=Re===0?et.maxX:et.maxY;if(Tr>=se&&bn<xe)q.push(et);else if(!(bn<se||Tr>=xe)){var nn=[];if(er==="Point"||er==="MultiPoint")_t(be,nn,se,xe,Re);else if(er==="LineString")Kt(be,nn,se,xe,Re,!1,V.lineMetrics);else if(er==="MultiLineString")Ve(be,nn,se,xe,Re,!1);else if(er==="Polygon")Ve(be,nn,se,xe,Re,!0);else if(er==="MultiPolygon")for(var ar=0;ar<be.length;ar++){var Kr=[];Ve(be[ar],Kr,se,xe,Re,!0),Kr.length&&nn.push(Kr)}if(nn.length){if(V.lineMetrics&&er==="LineString"){for(ar=0;ar<nn.length;ar++)q.push(Bn(et.id,er,nn[ar],et.tags));continue}er!=="LineString"&&er!=="MultiLineString"||(nn.length===1?(er="LineString",nn=nn[0]):er="MultiLineString"),er!=="Point"&&er!=="MultiPoint"||(er=nn.length===3?"Point":"MultiPoint"),q.push(Bn(et.id,er,nn,et.tags))}}}return q.length?q:null}function _t(W,Q,se,xe,Re){for(var Je=0;Je<W.length;Je+=3){var lt=W[Je+Re];lt>=se&&lt<=xe&&(Q.push(W[Je]),Q.push(W[Je+1]),Q.push(W[Je+2]))}}function Kt(W,Q,se,xe,Re,Je,lt){for(var V,q,De=Ar(W),et=Re===0?sr:dr,be=W.start,er=0;er<W.length-3;er+=3){var Tr=W[er],bn=W[er+1],nn=W[er+2],ar=W[er+3],Kr=W[er+4],Hr=Re===0?Tr:bn,$r=Re===0?ar:Kr,hi=!1;lt&&(V=Math.sqrt(Math.pow(Tr-ar,2)+Math.pow(bn-Kr,2))),Hr<se?$r>se&&(q=et(De,Tr,bn,ar,Kr,se),lt&&(De.start=be+V*q)):Hr>xe?$r<xe&&(q=et(De,Tr,bn,ar,Kr,xe),lt&&(De.start=be+V*q)):wt(De,Tr,bn,nn),$r<se&&Hr>=se&&(q=et(De,Tr,bn,ar,Kr,se),hi=!0),$r>xe&&Hr<=xe&&(q=et(De,Tr,bn,ar,Kr,xe),hi=!0),!Je&&hi&&(lt&&(De.end=be+V*q),Q.push(De),De=Ar(W)),lt&&(be+=V)}var Qr=W.length-3;Tr=W[Qr],bn=W[Qr+1],nn=W[Qr+2],(Hr=Re===0?Tr:bn)>=se&&Hr<=xe&&wt(De,Tr,bn,nn),Qr=De.length-3,Je&&Qr>=3&&(De[Qr]!==De[0]||De[Qr+1]!==De[1])&&wt(De,De[0],De[1],De[2]),De.length&&Q.push(De)}function Ar(W){var Q=[];return Q.size=W.size,Q.start=W.start,Q.end=W.end,Q}function Ve(W,Q,se,xe,Re,Je){for(var lt=0;lt<W.length;lt++)Kt(W[lt],Q,se,xe,Re,Je,!1)}function wt(W,Q,se,xe){W.push(Q),W.push(se),W.push(xe)}function sr(W,Q,se,xe,Re,Je){var lt=(Je-Q)/(xe-Q);return W.push(Je),W.push(se+(Re-se)*lt),W.push(1),lt}function dr(W,Q,se,xe,Re,Je){var lt=(Je-se)/(Re-se);return W.push(Q+(xe-Q)*lt),W.push(Je),W.push(1),lt}function Vr(W,Q){for(var se=[],xe=0;xe<W.length;xe++){var Re,Je=W[xe],lt=Je.type;if(lt==="Point"||lt==="MultiPoint"||lt==="LineString")Re=Ln(Je.geometry,Q);else if(lt==="MultiLineString"||lt==="Polygon"){Re=[];for(var V=0;V<Je.geometry.length;V++)Re.push(Ln(Je.geometry[V],Q))}else if(lt==="MultiPolygon")for(Re=[],V=0;V<Je.geometry.length;V++){for(var q=[],De=0;De<Je.geometry[V].length;De++)q.push(Ln(Je.geometry[V][De],Q));Re.push(q)}se.push(Bn(Je.id,lt,Re,Je.tags))}return se}function Ln(W,Q){var se=[];se.size=W.size,W.start!==void 0&&(se.start=W.start,se.end=W.end);for(var xe=0;xe<W.length;xe+=3)se.push(W[xe]+Q,W[xe+1],W[xe+2]);return se}function En(W,Q){if(W.transformed)return W;var se,xe,Re,Je=1<<W.z,lt=W.x,V=W.y;for(se=0;se<W.features.length;se++){var q=W.features[se],De=q.geometry,et=q.type;if(q.geometry=[],et===1)for(xe=0;xe<De.length;xe+=2)q.geometry.push(Rn(De[xe],De[xe+1],Q,Je,lt,V));else for(xe=0;xe<De.length;xe++){var be=[];for(Re=0;Re<De[xe].length;Re+=2)be.push(Rn(De[xe][Re],De[xe][Re+1],Q,Je,lt,V));q.geometry.push(be)}}return W.transformed=!0,W}function Rn(W,Q,se,xe,Re,Je){return[Math.round(se*(W*xe-Re)),Math.round(se*(Q*xe-Je))]}function xn(W,Q,se,xe,Re){for(var Je=Q===Re.maxZoom?0:Re.tolerance/((1<<Q)*Re.extent),lt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:se,y:xe,z:Q,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},V=0;V<W.length;V++){lt.numFeatures++,si(lt,W[V],Je,Re);var q=W[V].minX,De=W[V].minY,et=W[V].maxX,be=W[V].maxY;q<lt.minX&&(lt.minX=q),De<lt.minY&&(lt.minY=De),et>lt.maxX&&(lt.maxX=et),be>lt.maxY&&(lt.maxY=be)}return lt}function si(W,Q,se,xe){var Re=Q.geometry,Je=Q.type,lt=[];if(Je==="Point"||Je==="MultiPoint")for(var V=0;V<Re.length;V+=3)lt.push(Re[V]),lt.push(Re[V+1]),W.numPoints++,W.numSimplified++;else if(Je==="LineString")ei(lt,Re,W,se,!1,!1);else if(Je==="MultiLineString"||Je==="Polygon")for(V=0;V<Re.length;V++)ei(lt,Re[V],W,se,Je==="Polygon",V===0);else if(Je==="MultiPolygon")for(var q=0;q<Re.length;q++){var De=Re[q];for(V=0;V<De.length;V++)ei(lt,De[V],W,se,!0,V===0)}if(lt.length){var et=Q.tags||null;if(Je==="LineString"&&xe.lineMetrics){for(var be in et={},Q.tags)et[be]=Q.tags[be];et.mapbox_clip_start=Re.start/Re.size,et.mapbox_clip_end=Re.end/Re.size}var er={geometry:lt,type:Je==="Polygon"||Je==="MultiPolygon"?3:Je==="LineString"||Je==="MultiLineString"?2:1,tags:et};Q.id!==null&&(er.id=Q.id),W.features.push(er)}}function ei(W,Q,se,xe,Re,Je){var lt=xe*xe;if(xe>0&&Q.size<(Re?lt:xe))se.numPoints+=Q.length/3;else{for(var V=[],q=0;q<Q.length;q+=3)(xe===0||Q[q+2]>lt)&&(se.numSimplified++,V.push(Q[q]),V.push(Q[q+1])),se.numPoints++;Re&&function(De,et){for(var be=0,er=0,Tr=De.length,bn=Tr-2;er<Tr;bn=er,er+=2)be+=(De[er]-De[bn])*(De[er+1]+De[bn+1]);if(be>0===et)for(er=0,Tr=De.length;er<Tr/2;er+=2){var nn=De[er],ar=De[er+1];De[er]=De[Tr-2-er],De[er+1]=De[Tr-1-er],De[Tr-2-er]=nn,De[Tr-1-er]=ar}}(V,Je),W.push(V)}}function la(W,Q){var se=(Q=this.options=function(Re,Je){for(var lt in Je)Re[lt]=Je[lt];return Re}(Object.create(this.options),Q)).debug;if(se&&console.time("preprocess data"),Q.maxZoom<0||Q.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Q.promoteId&&Q.generateId)throw new Error("promoteId and generateId cannot be used together.");var xe=function(Re,Je){var lt=[];if(Re.type==="FeatureCollection")for(var V=0;V<Re.features.length;V++)oa(lt,Re.features[V],Je,V);else oa(lt,Re.type==="Feature"?Re:{geometry:Re},Je);return lt}(W,Q);this.tiles={},this.tileCoords=[],se&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Q.indexMaxZoom,Q.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(xe=function(Re,Je){var lt=Je.buffer/Je.extent,V=Re,q=Ne(Re,1,-1-lt,lt,0,-1,2,Je),De=Ne(Re,1,1-lt,2+lt,0,-1,2,Je);return(q||De)&&(V=Ne(Re,1,-lt,1+lt,0,-1,2,Je)||[],q&&(V=Vr(q,1).concat(V)),De&&(V=V.concat(Vr(De,-1)))),V}(xe,Q)).length&&this.splitTile(xe,0,0,0),se&&(xe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function sa(W,Q,se){return 32*((1<<W)*se+Q)+W}function Eo(W,Q){var se=W.tileID.canonical;if(!this._geoJSONIndex)return Q(null,null);var xe=this._geoJSONIndex.getTile(se.z,se.x,se.y);if(!xe)return Q(null,null);var Re=new yt(xe.features),Je=Et(Re);Je.byteOffset===0&&Je.byteLength===Je.buffer.byteLength||(Je=new Uint8Array(Je)),Q(null,{vectorTile:Re,rawData:Je.buffer})}lr.prototype.load=function(W){var Q=this.options,se=Q.log,xe=Q.minZoom,Re=Q.maxZoom,Je=Q.nodeSize;se&&console.time("total time");var lt="prepare "+W.length+" points";se&&console.time(lt),this.points=W;for(var V=[],q=0;q<W.length;q++)W[q].geometry&&V.push(mn(W[q],q));this.trees[Re+1]=new Mt(V,Wi,Zi,Je,Float32Array),se&&console.timeEnd(lt);for(var De=Re;De>=xe;De--){var et=+Date.now();V=this._cluster(V,De),this.trees[De]=new Mt(V,Wi,Zi,Je,Float32Array),se&&console.log("z%d: %d clusters in %dms",De,V.length,+Date.now()-et)}return se&&console.timeEnd("total time"),this},lr.prototype.getClusters=function(W,Q){var se=((W[0]+180)%360+360)%360-180,xe=Math.max(-90,Math.min(90,W[1])),Re=W[2]===180?180:((W[2]+180)%360+360)%360-180,Je=Math.max(-90,Math.min(90,W[3]));if(W[2]-W[0]>=360)se=-180,Re=180;else if(se>Re){var lt=this.getClusters([se,xe,180,Je],Q),V=this.getClusters([-180,xe,Re,Je],Q);return lt.concat(V)}for(var q=this.trees[this._limitZoom(Q)],De=[],et=0,be=q.range(jn(se),rn(Je),jn(Re),rn(xe));et<be.length;et+=1){var er=q.points[be[et]];De.push(er.numPoints?un(er):this.points[er.index])}return De},lr.prototype.getChildren=function(W){var Q=this._getOriginId(W),se=this._getOriginZoom(W),xe="No cluster with the specified id.",Re=this.trees[se];if(!Re)throw new Error(xe);var Je=Re.points[Q];if(!Je)throw new Error(xe);for(var lt=this.options.radius/(this.options.extent*Math.pow(2,se-1)),V=[],q=0,De=Re.within(Je.x,Je.y,lt);q<De.length;q+=1){var et=Re.points[De[q]];et.parentId===W&&V.push(et.numPoints?un(et):this.points[et.index])}if(V.length===0)throw new Error(xe);return V},lr.prototype.getLeaves=function(W,Q,se){var xe=[];return this._appendLeaves(xe,W,Q=Q||10,se=se||0,0),xe},lr.prototype.getTile=function(W,Q,se){var xe=this.trees[this._limitZoom(W)],Re=Math.pow(2,W),Je=this.options,lt=Je.radius/Je.extent,V=(se-lt)/Re,q=(se+1+lt)/Re,De={features:[]};return this._addTileFeatures(xe.range((Q-lt)/Re,V,(Q+1+lt)/Re,q),xe.points,Q,se,Re,De),Q===0&&this._addTileFeatures(xe.range(1-lt/Re,V,1,q),xe.points,Re,se,Re,De),Q===Re-1&&this._addTileFeatures(xe.range(0,V,lt/Re,q),xe.points,-1,se,Re,De),De.features.length?De:null},lr.prototype.getClusterExpansionZoom=function(W){for(var Q=this._getOriginZoom(W)-1;Q<=this.options.maxZoom;){var se=this.getChildren(W);if(Q++,se.length!==1)break;W=se[0].properties.cluster_id}return Q},lr.prototype._appendLeaves=function(W,Q,se,xe,Re){for(var Je=0,lt=this.getChildren(Q);Je<lt.length;Je+=1){var V=lt[Je],q=V.properties;if(q&&q.cluster?Re+q.point_count<=xe?Re+=q.point_count:Re=this._appendLeaves(W,q.cluster_id,se,xe,Re):Re<xe?Re++:W.push(V),W.length===se)break}return Re},lr.prototype._addTileFeatures=function(W,Q,se,xe,Re,Je){for(var lt=0,V=W;lt<V.length;lt+=1){var q=Q[V[lt]],De=q.numPoints,et={type:1,geometry:[[Math.round(this.options.extent*(q.x*Re-se)),Math.round(this.options.extent*(q.y*Re-xe))]],tags:De?oi(q):this.points[q.index].properties},be=void 0;De?be=q.id:this.options.generateId?be=q.index:this.points[q.index].id&&(be=this.points[q.index].id),be!==void 0&&(et.id=be),Je.features.push(et)}},lr.prototype._limitZoom=function(W){return Math.max(this.options.minZoom,Math.min(+W,this.options.maxZoom+1))},lr.prototype._cluster=function(W,Q){for(var se=[],xe=this.options,Re=xe.reduce,Je=xe.minPoints,lt=xe.radius/(xe.extent*Math.pow(2,Q)),V=0;V<W.length;V++){var q=W[V];if(!(q.zoom<=Q)){q.zoom=Q;for(var De=this.trees[Q+1],et=De.within(q.x,q.y,lt),be=q.numPoints||1,er=be,Tr=0,bn=et;Tr<bn.length;Tr+=1){var nn=De.points[bn[Tr]];nn.zoom>Q&&(er+=nn.numPoints||1)}if(er>=Je){for(var ar=q.x*be,Kr=q.y*be,Hr=Re&&be>1?this._map(q,!0):null,$r=(V<<5)+(Q+1)+this.points.length,hi=0,Qr=et;hi<Qr.length;hi+=1){var vi=De.points[Qr[hi]];if(!(vi.zoom<=Q)){vi.zoom=Q;var Yi=vi.numPoints||1;ar+=vi.x*Yi,Kr+=vi.y*Yi,vi.parentId=$r,Re&&(Hr||(Hr=this._map(q,!0)),Re(Hr,this._map(vi)))}}q.parentId=$r,se.push(Cn(ar/er,Kr/er,$r,er,Hr))}else if(se.push(q),er>1)for(var ci=0,Li=et;ci<Li.length;ci+=1){var Si=De.points[Li[ci]];Si.zoom<=Q||(Si.zoom=Q,se.push(Si))}}}return se},lr.prototype._getOriginId=function(W){return W-this.points.length>>5},lr.prototype._getOriginZoom=function(W){return(W-this.points.length)%32},lr.prototype._map=function(W,Q){if(W.numPoints)return Q?$i({},W.properties):W.properties;var se=this.points[W.index].properties,xe=this.options.map(se);return Q&&xe===se?$i({},xe):xe},la.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},la.prototype.splitTile=function(W,Q,se,xe,Re,Je,lt){for(var V=[W,Q,se,xe],q=this.options,De=q.debug;V.length;){xe=V.pop(),se=V.pop(),Q=V.pop(),W=V.pop();var et=1<<Q,be=sa(Q,se,xe),er=this.tiles[be];if(!er&&(De>1&&console.time("creation"),er=this.tiles[be]=xn(W,Q,se,xe,q),this.tileCoords.push({z:Q,x:se,y:xe}),De)){De>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Q,se,xe,er.numFeatures,er.numPoints,er.numSimplified),console.timeEnd("creation"));var Tr="z"+Q;this.stats[Tr]=(this.stats[Tr]||0)+1,this.total++}if(er.source=W,Re){if(Q===q.maxZoom||Q===Re)continue;var bn=1<<Re-Q;if(se!==Math.floor(Je/bn)||xe!==Math.floor(lt/bn))continue}else if(Q===q.indexMaxZoom||er.numPoints<=q.indexMaxPoints)continue;if(er.source=null,W.length!==0){De>1&&console.time("clipping");var nn,ar,Kr,Hr,$r,hi,Qr=.5*q.buffer/q.extent,vi=.5-Qr,Yi=.5+Qr,ci=1+Qr;nn=ar=Kr=Hr=null,$r=Ne(W,et,se-Qr,se+Yi,0,er.minX,er.maxX,q),hi=Ne(W,et,se+vi,se+ci,0,er.minX,er.maxX,q),W=null,$r&&(nn=Ne($r,et,xe-Qr,xe+Yi,1,er.minY,er.maxY,q),ar=Ne($r,et,xe+vi,xe+ci,1,er.minY,er.maxY,q),$r=null),hi&&(Kr=Ne(hi,et,xe-Qr,xe+Yi,1,er.minY,er.maxY,q),Hr=Ne(hi,et,xe+vi,xe+ci,1,er.minY,er.maxY,q),hi=null),De>1&&console.timeEnd("clipping"),V.push(nn||[],Q+1,2*se,2*xe),V.push(ar||[],Q+1,2*se,2*xe+1),V.push(Kr||[],Q+1,2*se+1,2*xe),V.push(Hr||[],Q+1,2*se+1,2*xe+1)}}},la.prototype.getTile=function(W,Q,se){var xe=this.options,Re=xe.extent,Je=xe.debug;if(W<0||W>24)return null;var lt=1<<W,V=sa(W,Q=(Q%lt+lt)%lt,se);if(this.tiles[V])return En(this.tiles[V],Re);Je>1&&console.log("drilling down to z%d-%d-%d",W,Q,se);for(var q,De=W,et=Q,be=se;!q&&De>0;)De--,et=Math.floor(et/2),be=Math.floor(be/2),q=this.tiles[sa(De,et,be)];return q&&q.source?(Je>1&&console.log("found parent tile z%d-%d-%d",De,et,be),Je>1&&console.time("drilling down"),this.splitTile(q.source,De,et,be,W,Q,se),Je>1&&console.timeEnd("drilling down"),this.tiles[V]?En(this.tiles[V],Re):null):null};var Ks=function(W){function Q(se,xe,Re,Je){W.call(this,se,xe,Re,Eo),Je&&(this.loadGeoJSON=Je)}return W&&(Q.__proto__=W),(Q.prototype=Object.create(W&&W.prototype)).constructor=Q,Q.prototype.loadData=function(se,xe){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=xe,this._pendingLoadDataParams=se,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},Q.prototype._loadData=function(){var se=this;if(this._pendingCallback&&this._pendingLoadDataParams){var xe=this._pendingCallback,Re=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var Je=!!(Re&&Re.request&&Re.request.collectResourceTiming)&&new _.RequestPerformance(Re.request);this.loadGeoJSON(Re,function(lt,V){if(lt||!V)return xe(lt);if(typeof V!="object")return xe(new Error("Input data given to '"+Re.source+"' is not a valid GeoJSON object."));(function er(Tr,bn){var nn,ar=Tr&&Tr.type;if(ar==="FeatureCollection")for(nn=0;nn<Tr.features.length;nn++)er(Tr.features[nn],bn);else if(ar==="GeometryCollection")for(nn=0;nn<Tr.geometries.length;nn++)er(Tr.geometries[nn],bn);else if(ar==="Feature")er(Tr.geometry,bn);else if(ar==="Polygon")Yt(Tr.coordinates,bn);else if(ar==="MultiPolygon")for(nn=0;nn<Tr.coordinates.length;nn++)Yt(Tr.coordinates[nn],bn);return Tr})(V,!0);try{if(Re.filter){var q=_.createExpression(Re.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(q.result==="error")throw new Error(q.value.map(function(er){return er.key+": "+er.message}).join(", "));var De=V.features.filter(function(er){return q.value.evaluate({zoom:0},er)});V={type:"FeatureCollection",features:De}}se._geoJSONIndex=Re.cluster?new lr(function(er){var Tr=er.superclusterOptions,bn=er.clusterProperties;if(!bn||!Tr)return Tr;for(var nn={},ar={},Kr={accumulated:null,zoom:0},Hr={properties:null},$r=Object.keys(bn),hi=0,Qr=$r;hi<Qr.length;hi+=1){var vi=Qr[hi],Yi=bn[vi],ci=Yi[0],Li=_.createExpression(Yi[1]),Si=_.createExpression(typeof ci=="string"?[ci,["accumulated"],["get",vi]]:ci);nn[vi]=Li.value,ar[vi]=Si.value}return Tr.map=function(Xo){Hr.properties=Xo;for(var Ki={},Ia=0,Ai=$r;Ia<Ai.length;Ia+=1){var mi=Ai[Ia];Ki[mi]=nn[mi].evaluate(Kr,Hr)}return Ki},Tr.reduce=function(Xo,Ki){Hr.properties=Ki;for(var Ia=0,Ai=$r;Ia<Ai.length;Ia+=1){var mi=Ai[Ia];Kr.accumulated=Xo[mi],Xo[mi]=ar[mi].evaluate(Kr,Hr)}},Tr}(Re)).load(V.features):function(er,Tr){return new la(er,Tr)}(V,Re.geojsonVtOptions)}catch(er){return xe(er)}se.loaded={};var et={};if(Je){var be=Je.finish();be&&(et.resourceTiming={},et.resourceTiming[Re.source]=JSON.parse(JSON.stringify(be)))}xe(null,et)})}},Q.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},Q.prototype.reloadTile=function(se,xe){var Re=this.loaded;return Re&&Re[se.uid]?W.prototype.reloadTile.call(this,se,xe):this.loadTile(se,xe)},Q.prototype.loadGeoJSON=function(se,xe){if(se.request)_.getJSON(se.request,xe);else{if(typeof se.data!="string")return xe(new Error("Input data given to '"+se.source+"' is not a valid GeoJSON object."));try{return xe(null,JSON.parse(se.data))}catch(Re){return xe(new Error("Input data given to '"+se.source+"' is not a valid GeoJSON object."))}}},Q.prototype.removeSource=function(se,xe){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),xe()},Q.prototype.getClusterExpansionZoom=function(se,xe){try{xe(null,this._geoJSONIndex.getClusterExpansionZoom(se.clusterId))}catch(Re){xe(Re)}},Q.prototype.getClusterChildren=function(se,xe){try{xe(null,this._geoJSONIndex.getChildren(se.clusterId))}catch(Re){xe(Re)}},Q.prototype.getClusterLeaves=function(se,xe){try{xe(null,this._geoJSONIndex.getLeaves(se.clusterId,se.limit,se.offset))}catch(Re){xe(Re)}},Q}(ht),di=function(W){var Q=this;this.self=W,this.actor=new _.Actor(W,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:ht,geojson:Ks},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(se,xe){if(Q.workerSourceTypes[se])throw new Error('Worker source with name "'+se+'" already registered.');Q.workerSourceTypes[se]=xe},this.self.registerRTLTextPlugin=function(se){if(_.plugin.isParsed())throw new Error("RTL text plugin already registered.");_.plugin.applyArabicShaping=se.applyArabicShaping,_.plugin.processBidirectionalText=se.processBidirectionalText,_.plugin.processStyledBidirectionalText=se.processStyledBidirectionalText}};return di.prototype.setReferrer=function(W,Q){this.referrer=Q},di.prototype.setImages=function(W,Q,se){for(var xe in this.availableImages[W]=Q,this.workerSources[W]){var Re=this.workerSources[W][xe];for(var Je in Re)Re[Je].availableImages=Q}se()},di.prototype.setLayers=function(W,Q,se){this.getLayerIndex(W).replace(Q),se()},di.prototype.updateLayers=function(W,Q,se){this.getLayerIndex(W).update(Q.layers,Q.removedIds),se()},di.prototype.loadTile=function(W,Q,se){this.getWorkerSource(W,Q.type,Q.source).loadTile(Q,se)},di.prototype.loadDEMTile=function(W,Q,se){this.getDEMWorkerSource(W,Q.source).loadTile(Q,se)},di.prototype.reloadTile=function(W,Q,se){this.getWorkerSource(W,Q.type,Q.source).reloadTile(Q,se)},di.prototype.abortTile=function(W,Q,se){this.getWorkerSource(W,Q.type,Q.source).abortTile(Q,se)},di.prototype.removeTile=function(W,Q,se){this.getWorkerSource(W,Q.type,Q.source).removeTile(Q,se)},di.prototype.removeDEMTile=function(W,Q){this.getDEMWorkerSource(W,Q.source).removeTile(Q)},di.prototype.removeSource=function(W,Q,se){if(this.workerSources[W]&&this.workerSources[W][Q.type]&&this.workerSources[W][Q.type][Q.source]){var xe=this.workerSources[W][Q.type][Q.source];delete this.workerSources[W][Q.type][Q.source],xe.removeSource!==void 0?xe.removeSource(Q,se):se()}},di.prototype.loadWorkerSource=function(W,Q,se){try{this.self.importScripts(Q.url),se()}catch(xe){se(xe.toString())}},di.prototype.syncRTLPluginState=function(W,Q,se){try{_.plugin.setState(Q);var xe=_.plugin.getPluginURL();if(_.plugin.isLoaded()&&!_.plugin.isParsed()&&xe!=null){this.self.importScripts(xe);var Re=_.plugin.isParsed();se(Re?void 0:new Error("RTL Text Plugin failed to import scripts from "+xe),Re)}}catch(Je){se(Je.toString())}},di.prototype.getAvailableImages=function(W){var Q=this.availableImages[W];return Q||(Q=[]),Q},di.prototype.getLayerIndex=function(W){var Q=this.layerIndexes[W];return Q||(Q=this.layerIndexes[W]=new he),Q},di.prototype.getWorkerSource=function(W,Q,se){var xe=this;return this.workerSources[W]||(this.workerSources[W]={}),this.workerSources[W][Q]||(this.workerSources[W][Q]={}),this.workerSources[W][Q][se]||(this.workerSources[W][Q][se]=new this.workerSourceTypes[Q]({send:function(Re,Je,lt){xe.actor.send(Re,Je,lt,W)}},this.getLayerIndex(W),this.getAvailableImages(W))),this.workerSources[W][Q][se]},di.prototype.getDEMWorkerSource=function(W,Q){return this.demWorkerSources[W]||(this.demWorkerSources[W]={}),this.demWorkerSources[W][Q]||(this.demWorkerSources[W][Q]=new Dt),this.demWorkerSources[W][Q]},di.prototype.enforceCacheSizeLimit=function(W,Q){_.enforceCacheSizeLimit(Q)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new di(self)),di}),pe(["./shared"],function(_){"use strict";var le=_.createCommonjsModule(function(h){function d(S){return!p(S)}function p(S){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var C,P,Z=new Blob([""],{type:"text/javascript"}),Y=URL.createObjectURL(Z);try{P=new Worker(Y),C=!0}catch(ce){C=!1}return P&&P.terminate(),URL.revokeObjectURL(Y),C}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var C=document.createElement("canvas");C.width=C.height=1;var P=C.getContext("2d");if(!P)return!1;var Z=P.getImageData(0,0,1,1);return Z&&Z.width===C.width}()?(g[w=S&&S.failIfMajorPerformanceCaveat]===void 0&&(g[w]=function(C){var P=function(Y){var ce=document.createElement("canvas"),ge=Object.create(d.webGLContextAttributes);return ge.failIfMajorPerformanceCaveat=Y,ce.probablySupportsContext?ce.probablySupportsContext("webgl",ge)||ce.probablySupportsContext("experimental-webgl",ge):ce.supportsContext?ce.supportsContext("webgl",ge)||ce.supportsContext("experimental-webgl",ge):ce.getContext("webgl",ge)||ce.getContext("experimental-webgl",ge)}(C);if(!P)return!1;var Z=P.createShader(P.VERTEX_SHADER);return!(!Z||P.isContextLost())&&(P.shaderSource(Z,"void main() {}"),P.compileShader(Z),P.getShaderParameter(Z,P.COMPILE_STATUS)===!0)}(w)),g[w]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var w}h.exports?h.exports=d:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=d,window.mapboxgl.notSupportedReason=p);var g={};d.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),U={create:function(h,d,p){var g=_.window.document.createElement(h);return d!==void 0&&(g.className=d),p&&p.appendChild(g),g},createNS:function(h,d){return _.window.document.createElementNS(h,d)}},he=_.window.document&&_.window.document.documentElement.style;function ae(h){if(!he)return h[0];for(var d=0;d<h.length;d++)if(h[d]in he)return h[d];return h[0]}var qe,ie=ae(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);U.disableDrag=function(){he&&ie&&(qe=he[ie],he[ie]="none")},U.enableDrag=function(){he&&ie&&(he[ie]=qe)};var Ke=ae(["transform","WebkitTransform"]);U.setTransform=function(h,d){h.style[Ke]=d};var ht=!1;try{var mt=Object.defineProperty({},"passive",{get:function(){ht=!0}});_.window.addEventListener("test",mt,mt),_.window.removeEventListener("test",mt,mt)}catch(h){ht=!1}U.addEventListener=function(h,d,p,g){g===void 0&&(g={}),h.addEventListener(d,p,"passive"in g&&ht?g:g.capture)},U.removeEventListener=function(h,d,p,g){g===void 0&&(g={}),h.removeEventListener(d,p,"passive"in g&&ht?g:g.capture)};var Dt=function(h){h.preventDefault(),h.stopPropagation(),_.window.removeEventListener("click",Dt,!0)};function Yt(h){var d=h.userImage;return!!(d&&d.render&&d.render())&&(h.data.replace(new Uint8Array(d.data.buffer)),!0)}U.suppressClick=function(){_.window.addEventListener("click",Dt,!0),_.window.setTimeout(function(){_.window.removeEventListener("click",Dt,!0)},0)},U.mousePos=function(h,d){var p=h.getBoundingClientRect();return new _.Point(d.clientX-p.left-h.clientLeft,d.clientY-p.top-h.clientTop)},U.touchPos=function(h,d){for(var p=h.getBoundingClientRect(),g=[],S=0;S<d.length;S++)g.push(new _.Point(d[S].clientX-p.left-h.clientLeft,d[S].clientY-p.top-h.clientTop));return g},U.mouseButton=function(h){return _.window.InstallTrigger!==void 0&&h.button===2&&h.ctrlKey&&_.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:h.button},U.remove=function(h){h.parentNode&&h.parentNode.removeChild(h)};var Ht=function(h){function d(){h.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new _.RGBAImage({width:1,height:1}),this.dirty=!0}return h&&(d.__proto__=h),(d.prototype=Object.create(h&&h.prototype)).constructor=d,d.prototype.isLoaded=function(){return this.loaded},d.prototype.setLoaded=function(p){if(this.loaded!==p&&(this.loaded=p,p)){for(var g=0,S=this.requestors;g<S.length;g+=1){var w=S[g];this._notify(w.ids,w.callback)}this.requestors=[]}},d.prototype.getImage=function(p){return this.images[p]},d.prototype.addImage=function(p,g){this._validate(p,g)&&(this.images[p]=g)},d.prototype._validate=function(p,g){var S=!0;return this._validateStretch(g.stretchX,g.data&&g.data.width)||(this.fire(new _.ErrorEvent(new Error('Image "'+p+'" has invalid "stretchX" value'))),S=!1),this._validateStretch(g.stretchY,g.data&&g.data.height)||(this.fire(new _.ErrorEvent(new Error('Image "'+p+'" has invalid "stretchY" value'))),S=!1),this._validateContent(g.content,g)||(this.fire(new _.ErrorEvent(new Error('Image "'+p+'" has invalid "content" value'))),S=!1),S},d.prototype._validateStretch=function(p,g){if(!p)return!0;for(var S=0,w=0,C=p;w<C.length;w+=1){var P=C[w];if(P[0]<S||P[1]<P[0]||g<P[1])return!1;S=P[1]}return!0},d.prototype._validateContent=function(p,g){return!(p&&(p.length!==4||p[0]<0||g.data.width<p[0]||p[1]<0||g.data.height<p[1]||p[2]<0||g.data.width<p[2]||p[3]<0||g.data.height<p[3]||p[2]<p[0]||p[3]<p[1]))},d.prototype.updateImage=function(p,g){g.version=this.images[p].version+1,this.images[p]=g,this.updatedImages[p]=!0},d.prototype.removeImage=function(p){var g=this.images[p];delete this.images[p],delete this.patterns[p],g.userImage&&g.userImage.onRemove&&g.userImage.onRemove()},d.prototype.listImages=function(){return Object.keys(this.images)},d.prototype.getImages=function(p,g){var S=!0;if(!this.isLoaded())for(var w=0,C=p;w<C.length;w+=1)this.images[C[w]]||(S=!1);this.isLoaded()||S?this._notify(p,g):this.requestors.push({ids:p,callback:g})},d.prototype._notify=function(p,g){for(var S={},w=0,C=p;w<C.length;w+=1){var P=C[w];this.images[P]||this.fire(new _.Event("styleimagemissing",{id:P}));var Z=this.images[P];Z?S[P]={data:Z.data.clone(),pixelRatio:Z.pixelRatio,sdf:Z.sdf,version:Z.version,stretchX:Z.stretchX,stretchY:Z.stretchY,content:Z.content,hasRenderCallback:!!(Z.userImage&&Z.userImage.render)}:_.warnOnce('Image "'+P+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}g(null,S)},d.prototype.getPixelSize=function(){var p=this.atlasImage;return{width:p.width,height:p.height}},d.prototype.getPattern=function(p){var g=this.patterns[p],S=this.getImage(p);if(!S)return null;if(g&&g.position.version===S.version)return g.position;if(g)g.position.version=S.version;else{var w={w:S.data.width+2,h:S.data.height+2,x:0,y:0},C=new _.ImagePosition(w,S);this.patterns[p]={bin:w,position:C}}return this._updatePatternAtlas(),this.patterns[p].position},d.prototype.bind=function(p){var g=p.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new _.Texture(p,this.atlasImage,g.RGBA),this.atlasTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE)},d.prototype._updatePatternAtlas=function(){var p=[];for(var g in this.patterns)p.push(this.patterns[g].bin);var S=_.potpack(p),w=S.w,C=S.h,P=this.atlasImage;for(var Z in P.resize({width:w||1,height:C||1}),this.patterns){var Y=this.patterns[Z].bin,ce=Y.x+1,ge=Y.y+1,_e=this.images[Z].data,Fe=_e.width,Pe=_e.height;_.RGBAImage.copy(_e,P,{x:0,y:0},{x:ce,y:ge},{width:Fe,height:Pe}),_.RGBAImage.copy(_e,P,{x:0,y:Pe-1},{x:ce,y:ge-1},{width:Fe,height:1}),_.RGBAImage.copy(_e,P,{x:0,y:0},{x:ce,y:ge+Pe},{width:Fe,height:1}),_.RGBAImage.copy(_e,P,{x:Fe-1,y:0},{x:ce-1,y:ge},{width:1,height:Pe}),_.RGBAImage.copy(_e,P,{x:0,y:0},{x:ce+Fe,y:ge},{width:1,height:Pe})}this.dirty=!0},d.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},d.prototype.dispatchRenderCallbacks=function(p){for(var g=0,S=p;g<S.length;g+=1){var w=S[g];if(!this.callbackDispatchedThisFrame[w]){this.callbackDispatchedThisFrame[w]=!0;var C=this.images[w];Yt(C)&&this.updateImage(w,C)}}},d}(_.Evented),ir=bt,Xt=bt,yt=1e20;function bt(h,d,p,g,S,w){this.fontSize=h||24,this.buffer=d===void 0?3:d,this.cutoff=g||.25,this.fontFamily=S||"sans-serif",this.fontWeight=w||"normal",this.radius=p||8;var C=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=C,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(C*C),this.gridInner=new Float64Array(C*C),this.f=new Float64Array(C),this.d=new Float64Array(C),this.z=new Float64Array(C+1),this.v=new Int16Array(C),this.middle=Math.round(C/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Pr(h,d,p,g,S,w,C){for(var P=0;P<d;P++){for(var Z=0;Z<p;Z++)g[Z]=h[Z*d+P];for(hr(g,S,w,C,p),Z=0;Z<p;Z++)h[Z*d+P]=S[Z]}for(Z=0;Z<p;Z++){for(P=0;P<d;P++)g[P]=h[Z*d+P];for(hr(g,S,w,C,d),P=0;P<d;P++)h[Z*d+P]=Math.sqrt(S[P])}}function hr(h,d,p,g,S){p[0]=0,g[0]=-yt,g[1]=+yt;for(var w=1,C=0;w<S;w++){for(var P=(h[w]+w*w-(h[p[C]]+p[C]*p[C]))/(2*w-2*p[C]);P<=g[C];)C--,P=(h[w]+w*w-(h[p[C]]+p[C]*p[C]))/(2*w-2*p[C]);p[++C]=w,g[C]=P,g[C+1]=+yt}for(w=0,C=0;w<S;w++){for(;g[C+1]<w;)C++;d[w]=(w-p[C])*(w-p[C])+h[p[C]]}}bt.prototype.draw=function(h){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(h,this.buffer,this.middle);for(var d=this.ctx.getImageData(0,0,this.size,this.size),p=new Uint8ClampedArray(this.size*this.size),g=0;g<this.size*this.size;g++){var S=d.data[4*g+3]/255;this.gridOuter[g]=S===1?0:S===0?yt:Math.pow(Math.max(0,.5-S),2),this.gridInner[g]=S===1?yt:S===0?0:Math.pow(Math.max(0,S-.5),2)}for(Pr(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),Pr(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),g=0;g<this.size*this.size;g++)p[g]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[g]-this.gridInner[g])/this.radius+this.cutoff))));return p},ir.default=Xt;var ur=function(h,d){this.requestManager=h,this.localIdeographFontFamily=d,this.entries={}};ur.prototype.setURL=function(h){this.url=h},ur.prototype.getGlyphs=function(h,d){var p=this,g=[];for(var S in h)for(var w=0,C=h[S];w<C.length;w+=1)g.push({stack:S,id:C[w]});_.asyncAll(g,function(P,Z){var Y=P.stack,ce=P.id,ge=p.entries[Y];ge||(ge=p.entries[Y]={glyphs:{},requests:{},ranges:{}});var _e=ge.glyphs[ce];if(_e===void 0){if(_e=p._tinySDF(ge,Y,ce))return ge.glyphs[ce]=_e,void Z(null,{stack:Y,id:ce,glyph:_e});var Fe=Math.floor(ce/256);if(256*Fe>65535)Z(new Error("glyphs > 65535 not supported"));else if(ge.ranges[Fe])Z(null,{stack:Y,id:ce,glyph:_e});else{var Pe=ge.requests[Fe];Pe||(Pe=ge.requests[Fe]=[],ur.loadGlyphRange(Y,Fe,p.url,p.requestManager,function(Xe,we){if(we){for(var Ge in we)p._doesCharSupportLocalGlyph(+Ge)||(ge.glyphs[+Ge]=we[+Ge]);ge.ranges[Fe]=!0}for(var ct=0,At=Pe;ct<At.length;ct+=1)(0,At[ct])(Xe,we);delete ge.requests[Fe]})),Pe.push(function(Xe,we){Xe?Z(Xe):we&&Z(null,{stack:Y,id:ce,glyph:we[ce]||null})})}}else Z(null,{stack:Y,id:ce,glyph:_e})},function(P,Z){if(P)d(P);else if(Z){for(var Y={},ce=0,ge=Z;ce<ge.length;ce+=1){var _e=ge[ce],Fe=_e.stack,Pe=_e.id,Xe=_e.glyph;(Y[Fe]||(Y[Fe]={}))[Pe]=Xe&&{id:Xe.id,bitmap:Xe.bitmap.clone(),metrics:Xe.metrics}}d(null,Y)}})},ur.prototype._doesCharSupportLocalGlyph=function(h){return!!this.localIdeographFontFamily&&(_.isChar["CJK Unified Ideographs"](h)||_.isChar["Hangul Syllables"](h)||_.isChar.Hiragana(h)||_.isChar.Katakana(h))},ur.prototype._tinySDF=function(h,d,p){var g=this.localIdeographFontFamily;if(g&&this._doesCharSupportLocalGlyph(p)){var S=h.tinySDF;if(!S){var w="400";/bold/i.test(d)?w="900":/medium/i.test(d)?w="500":/light/i.test(d)&&(w="200"),S=h.tinySDF=new ur.TinySDF(24,3,8,.25,g,w)}return{id:p,bitmap:new _.AlphaImage({width:30,height:30},S.draw(String.fromCharCode(p))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},ur.loadGlyphRange=function(h,d,p,g,S){var w=256*d,C=w+255,P=g.transformRequest(g.normalizeGlyphsURL(p).replace("{fontstack}",h).replace("{range}",w+"-"+C),_.ResourceType.Glyphs);_.getArrayBuffer(P,function(Z,Y){if(Z)S(Z);else if(Y){for(var ce={},ge=0,_e=_.parseGlyphPBF(Y);ge<_e.length;ge+=1){var Fe=_e[ge];ce[Fe.id]=Fe}S(null,ce)}})},ur.TinySDF=ir;var Et=function(){this.specification=_.styleSpec.light.position};Et.prototype.possiblyEvaluate=function(h,d){return _.sphericalToCartesian(h.expression.evaluate(d))},Et.prototype.interpolate=function(h,d,p){return{x:_.number(h.x,d.x,p),y:_.number(h.y,d.y,p),z:_.number(h.z,d.z,p)}};var nt=new _.Properties({anchor:new _.DataConstantProperty(_.styleSpec.light.anchor),position:new Et,color:new _.DataConstantProperty(_.styleSpec.light.color),intensity:new _.DataConstantProperty(_.styleSpec.light.intensity)}),Pt=function(h){function d(p){h.call(this),this._transitionable=new _.Transitionable(nt),this.setLight(p),this._transitioning=this._transitionable.untransitioned()}return h&&(d.__proto__=h),(d.prototype=Object.create(h&&h.prototype)).constructor=d,d.prototype.getLight=function(){return this._transitionable.serialize()},d.prototype.setLight=function(p,g){if(g===void 0&&(g={}),!this._validate(_.validateLight,p,g))for(var S in p){var w=p[S];_.endsWith(S,"-transition")?this._transitionable.setTransition(S.slice(0,-11),w):this._transitionable.setValue(S,w)}},d.prototype.updateTransitions=function(p){this._transitioning=this._transitionable.transitioned(p,this._transitioning)},d.prototype.hasTransition=function(){return this._transitioning.hasTransition()},d.prototype.recalculate=function(p){this.properties=this._transitioning.possiblyEvaluate(p)},d.prototype._validate=function(p,g,S){return(!S||S.validate!==!1)&&_.emitValidationErrors(this,p.call(_.validateStyle,_.extend({value:g,style:{glyphs:!0,sprite:!0},styleSpec:_.styleSpec})))},d}(_.Evented),ft=function(h,d){this.width=h,this.height=d,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};ft.prototype.getDash=function(h,d){var p=h.join(",")+String(d);return this.dashEntry[p]||(this.dashEntry[p]=this.addDash(h,d)),this.dashEntry[p]},ft.prototype.getDashRanges=function(h,d,p){var g=[],S=h.length%2==1?-h[h.length-1]*p:0,w=h[0]*p,C=!0;g.push({left:S,right:w,isDash:C,zeroLength:h[0]===0});for(var P=h[0],Z=1;Z<h.length;Z++){var Y=h[Z];g.push({left:S=P*p,right:w=(P+=Y)*p,isDash:C=!C,zeroLength:Y===0})}return g},ft.prototype.addRoundDash=function(h,d,p){for(var g=d/2,S=-p;S<=p;S++)for(var w=this.width*(this.nextRow+p+S),C=0,P=h[C],Z=0;Z<this.width;Z++){Z/P.right>1&&(P=h[++C]);var Y=Math.abs(Z-P.left),ce=Math.abs(Z-P.right),ge=Math.min(Y,ce),_e=void 0,Fe=S/p*(g+1);if(P.isDash){var Pe=g-Math.abs(Fe);_e=Math.sqrt(ge*ge+Pe*Pe)}else _e=g-Math.sqrt(ge*ge+Fe*Fe);this.data[w+Z]=Math.max(0,Math.min(255,_e+128))}},ft.prototype.addRegularDash=function(h){for(var d=h.length-1;d>=0;--d){var p=h[d],g=h[d+1];p.zeroLength?h.splice(d,1):g&&g.isDash===p.isDash&&(g.left=p.left,h.splice(d,1))}var S=h[0],w=h[h.length-1];S.isDash===w.isDash&&(S.left=w.left-this.width,w.right=S.right+this.width);for(var C=this.width*this.nextRow,P=0,Z=h[P],Y=0;Y<this.width;Y++){Y/Z.right>1&&(Z=h[++P]);var ce=Math.abs(Y-Z.left),ge=Math.abs(Y-Z.right),_e=Math.min(ce,ge);this.data[C+Y]=Math.max(0,Math.min(255,(Z.isDash?_e:-_e)+128))}},ft.prototype.addDash=function(h,d){var p=d?7:0,g=2*p+1;if(this.nextRow+g>this.height)return _.warnOnce("LineAtlas out of space"),null;for(var S=0,w=0;w<h.length;w++)S+=h[w];if(S!==0){var C=this.width/S,P=this.getDashRanges(h,this.width,C);d?this.addRoundDash(P,C,p):this.addRegularDash(P)}var Z={y:(this.nextRow+p+.5)/this.height,height:2*p/this.height,width:S};return this.nextRow+=g,this.dirty=!0,Z},ft.prototype.bind=function(h){var d=h.gl;this.texture?(d.bindTexture(d.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,d.texSubImage2D(d.TEXTURE_2D,0,0,0,this.width,this.height,d.ALPHA,d.UNSIGNED_BYTE,this.data))):(this.texture=d.createTexture(),d.bindTexture(d.TEXTURE_2D,this.texture),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texImage2D(d.TEXTURE_2D,0,d.ALPHA,this.width,this.height,0,d.ALPHA,d.UNSIGNED_BYTE,this.data))};var qt=function h(d,p){this.workerPool=d,this.actors=[],this.currentActor=0,this.id=_.uniqueId();for(var g=this.workerPool.acquire(this.id),S=0;S<g.length;S++){var w=new h.Actor(g[S],p,this.id);w.name="Worker "+S,this.actors.push(w)}};function Sr(h,d,p){var g=function(S,w){if(S)return p(S);if(w){var C=_.pick(_.extend(w,h),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);w.vector_layers&&(C.vectorLayers=w.vector_layers,C.vectorLayerIds=C.vectorLayers.map(function(P){return P.id})),C.tiles=d.canonicalizeTileset(C,h.url),p(null,C)}};return h.url?_.getJSON(d.transformRequest(d.normalizeSourceURL(h.url),_.ResourceType.Source),g):_.browser.frame(function(){return g(null,h)})}qt.prototype.broadcast=function(h,d,p){_.asyncAll(this.actors,function(g,S){g.send(h,d,S)},p=p||function(){})},qt.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},qt.prototype.remove=function(){this.actors.forEach(function(h){h.remove()}),this.actors=[],this.workerPool.release(this.id)},qt.Actor=_.Actor;var te=function(h,d,p){this.bounds=_.LngLatBounds.convert(this.validateBounds(h)),this.minzoom=d||0,this.maxzoom=p||24};te.prototype.validateBounds=function(h){return Array.isArray(h)&&h.length===4?[Math.max(-180,h[0]),Math.max(-90,h[1]),Math.min(180,h[2]),Math.min(90,h[3])]:[-180,-90,180,90]},te.prototype.contains=function(h){var d=Math.pow(2,h.z),p=Math.floor(_.mercatorXfromLng(this.bounds.getWest())*d),g=Math.floor(_.mercatorYfromLat(this.bounds.getNorth())*d),S=Math.ceil(_.mercatorXfromLng(this.bounds.getEast())*d),w=Math.ceil(_.mercatorYfromLat(this.bounds.getSouth())*d);return h.x>=p&&h.x<S&&h.y>=g&&h.y<w};var H=function(h){function d(p,g,S,w){if(h.call(this),this.id=p,this.dispatcher=S,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,_.extend(this,_.pick(g,["url","scheme","tileSize","promoteId"])),this._options=_.extend({type:"vector"},g),this._collectResourceTiming=g.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(w)}return h&&(d.__proto__=h),(d.prototype=Object.create(h&&h.prototype)).constructor=d,d.prototype.load=function(){var p=this;this._loaded=!1,this.fire(new _.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Sr(this._options,this.map._requestManager,function(g,S){p._tileJSONRequest=null,p._loaded=!0,g?p.fire(new _.ErrorEvent(g)):S&&(_.extend(p,S),S.bounds&&(p.tileBounds=new te(S.bounds,p.minzoom,p.maxzoom)),_.postTurnstileEvent(S.tiles,p.map._requestManager._customAccessToken),_.postMapLoadEvent(S.tiles,p.map._getMapId(),p.map._requestManager._skuToken,p.map._requestManager._customAccessToken),p.fire(new _.Event("data",{dataType:"source",sourceDataType:"metadata"})),p.fire(new _.Event("data",{dataType:"source",sourceDataType:"content"})))})},d.prototype.loaded=function(){return this._loaded},d.prototype.hasTile=function(p){return!this.tileBounds||this.tileBounds.contains(p.canonical)},d.prototype.onAdd=function(p){this.map=p,this.load()},d.prototype.setSourceProperty=function(p){this._tileJSONRequest&&this._tileJSONRequest.cancel(),p(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},d.prototype.setTiles=function(p){var g=this;return this.setSourceProperty(function(){g._options.tiles=p}),this},d.prototype.setUrl=function(p){var g=this;return this.setSourceProperty(function(){g.url=p,g._options.url=p}),this},d.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},d.prototype.serialize=function(){return _.extend({},this._options)},d.prototype.loadTile=function(p,g){var S=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme)),w={request:this.map._requestManager.transformRequest(S,_.ResourceType.Tile),uid:p.uid,tileID:p.tileID,zoom:p.tileID.overscaledZ,tileSize:this.tileSize*p.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:_.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function C(P,Z){return delete p.request,p.aborted?g(null):P&&P.status!==404?g(P):(Z&&Z.resourceTiming&&(p.resourceTiming=Z.resourceTiming),this.map._refreshExpiredTiles&&Z&&p.setExpiryData(Z),p.loadVectorData(Z,this.map.painter),_.cacheEntryPossiblyAdded(this.dispatcher),g(null),void(p.reloadCallback&&(this.loadTile(p,p.reloadCallback),p.reloadCallback=null)))}w.request.collectResourceTiming=this._collectResourceTiming,p.actor&&p.state!=="expired"?p.state==="loading"?p.reloadCallback=g:p.request=p.actor.send("reloadTile",w,C.bind(this)):(p.actor=this.dispatcher.getActor(),p.request=p.actor.send("loadTile",w,C.bind(this)))},d.prototype.abortTile=function(p){p.request&&(p.request.cancel(),delete p.request),p.actor&&p.actor.send("abortTile",{uid:p.uid,type:this.type,source:this.id},void 0)},d.prototype.unloadTile=function(p){p.unloadVectorData(),p.actor&&p.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id},void 0)},d.prototype.hasTransition=function(){return!1},d}(_.Evented),K=function(h){function d(p,g,S,w){h.call(this),this.id=p,this.dispatcher=S,this.setEventedParent(w),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=_.extend({type:"raster"},g),_.extend(this,_.pick(g,["url","scheme","tileSize"]))}return h&&(d.__proto__=h),(d.prototype=Object.create(h&&h.prototype)).constructor=d,d.prototype.load=function(){var p=this;this._loaded=!1,this.fire(new _.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Sr(this._options,this.map._requestManager,function(g,S){p._tileJSONRequest=null,p._loaded=!0,g?p.fire(new _.ErrorEvent(g)):S&&(_.extend(p,S),S.bounds&&(p.tileBounds=new te(S.bounds,p.minzoom,p.maxzoom)),_.postTurnstileEvent(S.tiles),_.postMapLoadEvent(S.tiles,p.map._getMapId(),p.map._requestManager._skuToken),p.fire(new _.Event("data",{dataType:"source",sourceDataType:"metadata"})),p.fire(new _.Event("data",{dataType:"source",sourceDataType:"content"})))})},d.prototype.loaded=function(){return this._loaded},d.prototype.onAdd=function(p){this.map=p,this.load()},d.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},d.prototype.serialize=function(){return _.extend({},this._options)},d.prototype.hasTile=function(p){return!this.tileBounds||this.tileBounds.contains(p.canonical)},d.prototype.loadTile=function(p,g){var S=this,w=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);p.request=_.getImage(this.map._requestManager.transformRequest(w,_.ResourceType.Tile),function(C,P){if(delete p.request,p.aborted)p.state="unloaded",g(null);else if(C)p.state="errored",g(C);else if(P){S.map._refreshExpiredTiles&&p.setExpiryData(P),delete P.cacheControl,delete P.expires;var Z=S.map.painter.context,Y=Z.gl;p.texture=S.map.painter.getTileTexture(P.width),p.texture?p.texture.update(P,{useMipmap:!0}):(p.texture=new _.Texture(Z,P,Y.RGBA,{useMipmap:!0}),p.texture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE,Y.LINEAR_MIPMAP_NEAREST),Z.extTextureFilterAnisotropic&&Y.texParameterf(Y.TEXTURE_2D,Z.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Z.extTextureFilterAnisotropicMax)),p.state="loaded",_.cacheEntryPossiblyAdded(S.dispatcher),g(null)}})},d.prototype.abortTile=function(p,g){p.request&&(p.request.cancel(),delete p.request),g()},d.prototype.unloadTile=function(p,g){p.texture&&this.map.painter.saveTileTexture(p.texture),g()},d.prototype.hasTransition=function(){return!1},d}(_.Evented),Be=function(h){function d(p,g,S,w){h.call(this,p,g,S,w),this.type="raster-dem",this.maxzoom=22,this._options=_.extend({type:"raster-dem"},g),this.encoding=g.encoding||"mapbox"}return h&&(d.__proto__=h),(d.prototype=Object.create(h&&h.prototype)).constructor=d,d.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},d.prototype.loadTile=function(p,g){var S=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function w(C,P){C&&(p.state="errored",g(C)),P&&(p.dem=P,p.needsHillshadePrepare=!0,p.state="loaded",g(null))}p.request=_.getImage(this.map._requestManager.transformRequest(S,_.ResourceType.Tile),function(C,P){if(delete p.request,p.aborted)p.state="unloaded",g(null);else if(C)p.state="errored",g(C);else if(P){this.map._refreshExpiredTiles&&p.setExpiryData(P),delete P.cacheControl,delete P.expires;var Z=_.window.ImageBitmap&&P instanceof _.window.ImageBitmap&&_.offscreenCanvasSupported()?P:_.browser.getImageData(P,1),Y={uid:p.uid,coord:p.tileID,source:this.id,rawImageData:Z,encoding:this.encoding};p.actor&&p.state!=="expired"||(p.actor=this.dispatcher.getActor(),p.actor.send("loadDEMTile",Y,w.bind(this)))}}.bind(this)),p.neighboringTiles=this._getNeighboringTiles(p.tileID)},d.prototype._getNeighboringTiles=function(p){var g=p.canonical,S=Math.pow(2,g.z),w=(g.x-1+S)%S,C=g.x===0?p.wrap-1:p.wrap,P=(g.x+1+S)%S,Z=g.x+1===S?p.wrap+1:p.wrap,Y={};return Y[new _.OverscaledTileID(p.overscaledZ,C,g.z,w,g.y).key]={backfilled:!1},Y[new _.OverscaledTileID(p.overscaledZ,Z,g.z,P,g.y).key]={backfilled:!1},g.y>0&&(Y[new _.OverscaledTileID(p.overscaledZ,C,g.z,w,g.y-1).key]={backfilled:!1},Y[new _.OverscaledTileID(p.overscaledZ,p.wrap,g.z,g.x,g.y-1).key]={backfilled:!1},Y[new _.OverscaledTileID(p.overscaledZ,Z,g.z,P,g.y-1).key]={backfilled:!1}),g.y+1<S&&(Y[new _.OverscaledTileID(p.overscaledZ,C,g.z,w,g.y+1).key]={backfilled:!1},Y[new _.OverscaledTileID(p.overscaledZ,p.wrap,g.z,g.x,g.y+1).key]={backfilled:!1},Y[new _.OverscaledTileID(p.overscaledZ,Z,g.z,P,g.y+1).key]={backfilled:!1}),Y},d.prototype.unloadTile=function(p){p.demTexture&&this.map.painter.saveTileTexture(p.demTexture),p.fbo&&(p.fbo.destroy(),delete p.fbo),p.dem&&delete p.dem,delete p.neighboringTiles,p.state="unloaded",p.actor&&p.actor.send("removeDEMTile",{uid:p.uid,source:this.id})},d}(K),Ae=function(h){function d(p,g,S,w){h.call(this),this.id=p,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=S.getActor(),this.setEventedParent(w),this._data=g.data,this._options=_.extend({},g),this._collectResourceTiming=g.collectResourceTiming,this._resourceTiming=[],g.maxzoom!==void 0&&(this.maxzoom=g.maxzoom),g.type&&(this.type=g.type),g.attribution&&(this.attribution=g.attribution),this.promoteId=g.promoteId;var C=_.EXTENT/this.tileSize;this.workerOptions=_.extend({source:this.id,cluster:g.cluster||!1,geojsonVtOptions:{buffer:(g.buffer!==void 0?g.buffer:128)*C,tolerance:(g.tolerance!==void 0?g.tolerance:.375)*C,extent:_.EXTENT,maxZoom:this.maxzoom,lineMetrics:g.lineMetrics||!1,generateId:g.generateId||!1},superclusterOptions:{maxZoom:g.clusterMaxZoom!==void 0?Math.min(g.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,g.clusterMinPoints||2),extent:_.EXTENT,radius:(g.clusterRadius||50)*C,log:!1,generateId:g.generateId||!1},clusterProperties:g.clusterProperties,filter:g.filter},g.workerOptions)}return h&&(d.__proto__=h),(d.prototype=Object.create(h&&h.prototype)).constructor=d,d.prototype.load=function(){var p=this;this.fire(new _.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(g){if(g)p.fire(new _.ErrorEvent(g));else{var S={dataType:"source",sourceDataType:"metadata"};p._collectResourceTiming&&p._resourceTiming&&p._resourceTiming.length>0&&(S.resourceTiming=p._resourceTiming,p._resourceTiming=[]),p.fire(new _.Event("data",S))}})},d.prototype.onAdd=function(p){this.map=p,this.load()},d.prototype.setData=function(p){var g=this;return this._data=p,this.fire(new _.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(S){if(S)g.fire(new _.ErrorEvent(S));else{var w={dataType:"source",sourceDataType:"content"};g._collectResourceTiming&&g._resourceTiming&&g._resourceTiming.length>0&&(w.resourceTiming=g._resourceTiming,g._resourceTiming=[]),g.fire(new _.Event("data",w))}}),this},d.prototype.getClusterExpansionZoom=function(p,g){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:p,source:this.id},g),this},d.prototype.getClusterChildren=function(p,g){return this.actor.send("geojson.getClusterChildren",{clusterId:p,source:this.id},g),this},d.prototype.getClusterLeaves=function(p,g,S,w){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:p,limit:g,offset:S},w),this},d.prototype._updateWorkerData=function(p){var g=this;this._loaded=!1;var S=_.extend({},this.workerOptions),w=this._data;typeof w=="string"?(S.request=this.map._requestManager.transformRequest(_.browser.resolveURL(w),_.ResourceType.Source),S.request.collectResourceTiming=this._collectResourceTiming):S.data=JSON.stringify(w),this.actor.send(this.type+".loadData",S,function(C,P){g._removed||P&&P.abandoned||(g._loaded=!0,P&&P.resourceTiming&&P.resourceTiming[g.id]&&(g._resourceTiming=P.resourceTiming[g.id].slice(0)),g.actor.send(g.type+".coalesce",{source:S.source},null),p(C))})},d.prototype.loaded=function(){return this._loaded},d.prototype.loadTile=function(p,g){var S=this,w=p.actor?"reloadTile":"loadTile";p.actor=this.actor,p.request=this.actor.send(w,{type:this.type,uid:p.uid,tileID:p.tileID,zoom:p.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:_.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(C,P){return delete p.request,p.unloadVectorData(),p.aborted?g(null):C?g(C):(p.loadVectorData(P,S.map.painter,w==="reloadTile"),g(null))})},d.prototype.abortTile=function(p){p.request&&(p.request.cancel(),delete p.request),p.aborted=!0},d.prototype.unloadTile=function(p){p.unloadVectorData(),this.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id})},d.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},d.prototype.serialize=function(){return _.extend({},this._options,{type:this.type,data:this._data})},d.prototype.hasTransition=function(){return!1},d}(_.Evented),dt=_.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),Ue=function(h){function d(p,g,S,w){h.call(this),this.id=p,this.dispatcher=S,this.coordinates=g.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(w),this.options=g}return h&&(d.__proto__=h),(d.prototype=Object.create(h&&h.prototype)).constructor=d,d.prototype.load=function(p,g){var S=this;this._loaded=!1,this.fire(new _.Event("dataloading",{dataType:"source"})),this.url=this.options.url,_.getImage(this.map._requestManager.transformRequest(this.url,_.ResourceType.Image),function(w,C){S._loaded=!0,w?S.fire(new _.ErrorEvent(w)):C&&(S.image=C,p&&(S.coordinates=p),g&&g(),S._finishLoading())})},d.prototype.loaded=function(){return this._loaded},d.prototype.updateImage=function(p){var g=this;return this.image&&p.url?(this.options.url=p.url,this.load(p.coordinates,function(){g.texture=null}),this):this},d.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new _.Event("data",{dataType:"source",sourceDataType:"metadata"})))},d.prototype.onAdd=function(p){this.map=p,this.load()},d.prototype.setCoordinates=function(p){var g=this;this.coordinates=p;var S=p.map(_.MercatorCoordinate.fromLngLat);this.tileID=function(C){for(var P=1/0,Z=1/0,Y=-1/0,ce=-1/0,ge=0,_e=C;ge<_e.length;ge+=1){var Fe=_e[ge];P=Math.min(P,Fe.x),Z=Math.min(Z,Fe.y),Y=Math.max(Y,Fe.x),ce=Math.max(ce,Fe.y)}var Pe=Math.max(Y-P,ce-Z),Xe=Math.max(0,Math.floor(-Math.log(Pe)/Math.LN2)),we=Math.pow(2,Xe);return new _.CanonicalTileID(Xe,Math.floor((P+Y)/2*we),Math.floor((Z+ce)/2*we))}(S),this.minzoom=this.maxzoom=this.tileID.z;var w=S.map(function(C){return g.tileID.getTilePoint(C)._round()});return this._boundsArray=new _.StructArrayLayout4i8,this._boundsArray.emplaceBack(w[0].x,w[0].y,0,0),this._boundsArray.emplaceBack(w[1].x,w[1].y,_.EXTENT,0),this._boundsArray.emplaceBack(w[3].x,w[3].y,0,_.EXTENT),this._boundsArray.emplaceBack(w[2].x,w[2].y,_.EXTENT,_.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new _.Event("data",{dataType:"source",sourceDataType:"content"})),this},d.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var p=this.map.painter.context,g=p.gl;for(var S in this.boundsBuffer||(this.boundsBuffer=p.createVertexBuffer(this._boundsArray,dt.members)),this.boundsSegments||(this.boundsSegments=_.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new _.Texture(p,this.image,g.RGBA),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE)),this.tiles){var w=this.tiles[S];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture)}}},d.prototype.loadTile=function(p,g){this.tileID&&this.tileID.equals(p.tileID.canonical)?(this.tiles[String(p.tileID.wrap)]=p,p.buckets={},g(null)):(p.state="errored",g(null))},d.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},d.prototype.hasTransition=function(){return!1},d}(_.Evented),We=function(h){function d(p,g,S,w){h.call(this,p,g,S,w),this.roundZoom=!0,this.type="video",this.options=g}return h&&(d.__proto__=h),(d.prototype=Object.create(h&&h.prototype)).constructor=d,d.prototype.load=function(){var p=this;this._loaded=!1;var g=this.options;this.urls=[];for(var S=0,w=g.urls;S<w.length;S+=1)this.urls.push(this.map._requestManager.transformRequest(w[S],_.ResourceType.Source).url);_.getVideo(this.urls,function(C,P){p._loaded=!0,C?p.fire(new _.ErrorEvent(C)):P&&(p.video=P,p.video.loop=!0,p.video.setAttribute("playsinline",""),p.video.addEventListener("playing",function(){p.map.triggerRepaint()}),p.map&&p.video.play(),p._finishLoading())})},d.prototype.pause=function(){this.video&&this.video.pause()},d.prototype.play=function(){this.video&&this.video.play()},d.prototype.seek=function(p){if(this.video){var g=this.video.seekable;p<g.start(0)||p>g.end(0)?this.fire(new _.ErrorEvent(new _.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+g.start(0)+" and "+g.end(0)+"-second mark."))):this.video.currentTime=p}},d.prototype.getVideo=function(){return this.video},d.prototype.onAdd=function(p){this.map||(this.map=p,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},d.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var p=this.map.painter.context,g=p.gl;for(var S in this.boundsBuffer||(this.boundsBuffer=p.createVertexBuffer(this._boundsArray,dt.members)),this.boundsSegments||(this.boundsSegments=_.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE),g.texSubImage2D(g.TEXTURE_2D,0,0,0,g.RGBA,g.UNSIGNED_BYTE,this.video)):(this.texture=new _.Texture(p,this.video,g.RGBA),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE)),this.tiles){var w=this.tiles[S];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture)}}},d.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},d.prototype.hasTransition=function(){return this.video&&!this.video.paused},d}(Ue),it=function(h){function d(p,g,S,w){h.call(this,p,g,S,w),g.coordinates?Array.isArray(g.coordinates)&&g.coordinates.length===4&&!g.coordinates.some(function(C){return!Array.isArray(C)||C.length!==2||C.some(function(P){return typeof P!="number"})})||this.fire(new _.ErrorEvent(new _.ValidationError("sources."+p,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new _.ErrorEvent(new _.ValidationError("sources."+p,null,'missing required property "coordinates"'))),g.animate&&typeof g.animate!="boolean"&&this.fire(new _.ErrorEvent(new _.ValidationError("sources."+p,null,'optional "animate" property must be a boolean value'))),g.canvas?typeof g.canvas=="string"||g.canvas instanceof _.window.HTMLCanvasElement||this.fire(new _.ErrorEvent(new _.ValidationError("sources."+p,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new _.ErrorEvent(new _.ValidationError("sources."+p,null,'missing required property "canvas"'))),this.options=g,this.animate=g.animate===void 0||g.animate}return h&&(d.__proto__=h),(d.prototype=Object.create(h&&h.prototype)).constructor=d,d.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof _.window.HTMLCanvasElement?this.options.canvas:_.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new _.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},d.prototype.getCanvas=function(){return this.canvas},d.prototype.onAdd=function(p){this.map=p,this.load(),this.canvas&&this.animate&&this.play()},d.prototype.onRemove=function(){this.pause()},d.prototype.prepare=function(){var p=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,p=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,p=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var g=this.map.painter.context,S=g.gl;for(var w in this.boundsBuffer||(this.boundsBuffer=g.createVertexBuffer(this._boundsArray,dt.members)),this.boundsSegments||(this.boundsSegments=_.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(p||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new _.Texture(g,this.canvas,S.RGBA,{premultiply:!0}),this.tiles){var C=this.tiles[w];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture)}}},d.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},d.prototype.hasTransition=function(){return this._playing},d.prototype._hasInvalidDimensions=function(){for(var p=0,g=[this.canvas.width,this.canvas.height];p<g.length;p+=1){var S=g[p];if(isNaN(S)||S<=0)return!0}return!1},d}(Ue),Mt={vector:H,raster:K,"raster-dem":Be,geojson:Ae,video:We,image:Ue,canvas:it};function yr(h,d){var p=_.identity([]);return _.translate(p,p,[1,1,0]),_.scale(p,p,[.5*h.width,.5*h.height,1]),_.multiply(p,p,h.calculatePosMatrix(d.toUnwrapped()))}function lr(h,d,p,g,S,w){var C=function(Xe,we,Ge){if(Xe)for(var ct=0,At=Xe;ct<At.length;ct+=1){var $t=we[At[ct]];if($t&&$t.source===Ge&&$t.type==="fill-extrusion")return!0}else for(var Nt in we){var tr=we[Nt];if(tr.source===Ge&&tr.type==="fill-extrusion")return!0}return!1}(S&&S.layers,d,h.id),P=w.maxPitchScaleFactor(),Z=h.tilesIn(g,P,C);Z.sort(Cn);for(var Y=[],ce=0,ge=Z;ce<ge.length;ce+=1){var _e=ge[ce];Y.push({wrappedTileID:_e.tileID.wrapped().key,queryResults:_e.tile.queryRenderedFeatures(d,p,h._state,_e.queryGeometry,_e.cameraQueryGeometry,_e.scale,S,w,P,yr(h.transform,_e.tileID))})}var Fe=function(Xe){for(var we={},Ge={},ct=0,At=Xe;ct<At.length;ct+=1){var $t=At[ct],Nt=$t.queryResults,tr=$t.wrappedTileID,mr=Ge[tr]=Ge[tr]||{};for(var Nr in Nt)for(var Fr=Nt[Nr],an=mr[Nr]=mr[Nr]||{},In=we[Nr]=we[Nr]||[],Nn=0,Un=Fr;Nn<Un.length;Nn+=1){var ji=Un[Nn];an[ji.featureIndex]||(an[ji.featureIndex]=!0,In.push(ji))}}return we}(Y);for(var Pe in Fe)Fe[Pe].forEach(function(Xe){var we=Xe.feature,Ge=h.getFeatureState(we.layer["source-layer"],we.id);we.source=we.layer.source,we.layer["source-layer"]&&(we.sourceLayer=we.layer["source-layer"]),we.state=Ge});return Fe}function Cn(h,d){var p=h.tileID,g=d.tileID;return p.overscaledZ-g.overscaledZ||p.canonical.y-g.canonical.y||p.wrap-g.wrap||p.canonical.x-g.canonical.x}var mn=function(h,d){this.max=h,this.onRemove=d,this.reset()};mn.prototype.reset=function(){for(var h in this.data)for(var d=0,p=this.data[h];d<p.length;d+=1){var g=p[d];g.timeout&&clearTimeout(g.timeout),this.onRemove(g.value)}return this.data={},this.order=[],this},mn.prototype.add=function(h,d,p){var g=this,S=h.wrapped().key;this.data[S]===void 0&&(this.data[S]=[]);var w={value:d,timeout:void 0};if(p!==void 0&&(w.timeout=setTimeout(function(){g.remove(h,w)},p)),this.data[S].push(w),this.order.push(S),this.order.length>this.max){var C=this._getAndRemoveByKey(this.order[0]);C&&this.onRemove(C)}return this},mn.prototype.has=function(h){return h.wrapped().key in this.data},mn.prototype.getAndRemove=function(h){return this.has(h)?this._getAndRemoveByKey(h.wrapped().key):null},mn.prototype._getAndRemoveByKey=function(h){var d=this.data[h].shift();return d.timeout&&clearTimeout(d.timeout),this.data[h].length===0&&delete this.data[h],this.order.splice(this.order.indexOf(h),1),d.value},mn.prototype.getByKey=function(h){var d=this.data[h];return d?d[0].value:null},mn.prototype.get=function(h){return this.has(h)?this.data[h.wrapped().key][0].value:null},mn.prototype.remove=function(h,d){if(!this.has(h))return this;var p=h.wrapped().key,g=d===void 0?0:this.data[p].indexOf(d),S=this.data[p][g];return this.data[p].splice(g,1),S.timeout&&clearTimeout(S.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(S.value),this.order.splice(this.order.indexOf(p),1),this},mn.prototype.setMaxSize=function(h){for(this.max=h;this.order.length>this.max;){var d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this},mn.prototype.filter=function(h){var d=[];for(var p in this.data)for(var g=0,S=this.data[p];g<S.length;g+=1){var w=S[g];h(w.value)||d.push(w)}for(var C=0,P=d;C<P.length;C+=1){var Z=P[C];this.remove(Z.value.tileID,Z)}};var un=function(h,d,p){this.context=h;var g=h.gl;this.buffer=g.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),h.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer};un.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},un.prototype.updateData=function(h){var d=this.context.gl;this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,h.arrayBuffer)},un.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var oi={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},jn=function(h,d,p,g){this.length=d.length,this.attributes=p,this.itemSize=d.bytesPerElement,this.dynamicDraw=g,this.context=h;var S=h.gl;this.buffer=S.createBuffer(),h.bindVertexBuffer.set(this.buffer),S.bufferData(S.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer};jn.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},jn.prototype.updateData=function(h){var d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,h.arrayBuffer)},jn.prototype.enableAttributes=function(h,d){for(var p=0;p<this.attributes.length;p++){var g=d.attributes[this.attributes[p].name];g!==void 0&&h.enableVertexAttribArray(g)}},jn.prototype.setVertexAttribPointers=function(h,d,p){for(var g=0;g<this.attributes.length;g++){var S=this.attributes[g],w=d.attributes[S.name];w!==void 0&&h.vertexAttribPointer(w,S.components,h[oi[S.type]],!1,this.itemSize,S.offset+this.itemSize*(p||0))}},jn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var rn=function(h){this.gl=h.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};rn.prototype.get=function(){return this.current},rn.prototype.set=function(h){},rn.prototype.getDefault=function(){return this.default},rn.prototype.setDefault=function(){this.set(this.default)};var $i=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),(d.prototype=Object.create(h&&h.prototype)).constructor=d,d.prototype.getDefault=function(){return _.Color.transparent},d.prototype.set=function(p){var g=this.current;(p.r!==g.r||p.g!==g.g||p.b!==g.b||p.a!==g.a||this.dirty)&&(this.gl.clearColor(p.r,p.g,p.b,p.a),this.current=p,this.dirty=!1)},d}(rn),Wi=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),(d.prototype=Object.create(h&&h.prototype)).constructor=d,d.prototype.getDefault=function(){return 1},d.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.clearDepth(p),this.current=p,this.dirty=!1)},d}(rn),Zi=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),(d.prototype=Object.create(h&&h.prototype)).constructor=d,d.prototype.getDefault=function(){return 0},d.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.clearStencil(p),this.current=p,this.dirty=!1)},d}(rn),Jn=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),(d.prototype=Object.create(h&&h.prototype)).constructor=d,d.prototype.getDefault=function(){return[!0,!0,!0,!0]},d.prototype.set=function(p){var g=this.current;(p[0]!==g[0]||p[1]!==g[1]||p[2]!==g[2]||p[3]!==g[3]||this.dirty)&&(this.gl.colorMask(p[0],p[1],p[2],p[3]),this.current=p,this.dirty=!1)},d}(rn),Bn=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),(d.prototype=Object.create(h&&h.prototype)).constructor=d,d.prototype.getDefault=function(){return!0},d.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.depthMask(p),this.current=p,this.dirty=!1)},d}(rn),Do=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),(d.prototype=Object.create(h&&h.prototype)).constructor=d,d.prototype.getDefault=function(){return 255},d.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.stencilMask(p),this.current=p,this.dirty=!1)},d}(rn),oa=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),(d.prototype=Object.create(h&&h.prototype)).constructor=d,d.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},d.prototype.set=function(p){var g=this.current;(p.func!==g.func||p.ref!==g.ref||p.mask!==g.mask||this.dirty)&&(this.gl.stencilFunc(p.func,p.ref,p.mask),this.current=p,this.dirty=!1)},d}(rn),$a=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),(d.prototype=Object.create(h&&h.prototype)).constructor=d,d.prototype.getDefault=function(){var p=this.gl;return[p.KEEP,p.KEEP,p.KEEP]},d.prototype.set=function(p){var g=this.current;(p[0]!==g[0]||p[1]!==g[1]||p[2]!==g[2]||this.dirty)&&(this.gl.stencilOp(p[0],p[1],p[2]),this.current=p,this.dirty=!1)},d}(rn),Ot=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),(d.prototype=Object.create(h&&h.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(p){if(p!==this.current||this.dirty){var g=this.gl;p?g.enable(g.STENCIL_TEST):g.disable(g.STENCIL_TEST),this.current=p,this.dirty=!1}},d}(rn),F=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),(d.prototype=Object.create(h&&h.prototype)).constructor=d,d.prototype.getDefault=function(){return[0,1]},d.prototype.set=function(p){var g=this.current;(p[0]!==g[0]||p[1]!==g[1]||this.dirty)&&(this.gl.depthRange(p[0],p[1]),this.current=p,this.dirty=!1)},d}(rn),ne=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),(d.prototype=Object.create(h&&h.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(p){if(p!==this.current||this.dirty){var g=this.gl;p?g.enable(g.DEPTH_TEST):g.disable(g.DEPTH_TEST),this.current=p,this.dirty=!1}},d}(rn),de=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),(d.prototype=Object.create(h&&h.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.LESS},d.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.depthFunc(p),this.current=p,this.dirty=!1)},d}(rn),Ne=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),(d.prototype=Object.create(h&&h.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(p){if(p!==this.current||this.dirty){var g=this.gl;p?g.enable(g.BLEND):g.disable(g.BLEND),this.current=p,this.dirty=!1}},d}(rn),_t=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),(d.prototype=Object.create(h&&h.prototype)).constructor=d,d.prototype.getDefault=function(){var p=this.gl;return[p.ONE,p.ZERO]},d.prototype.set=function(p){var g=this.current;(p[0]!==g[0]||p[1]!==g[1]||this.dirty)&&(this.gl.blendFunc(p[0],p[1]),this.current=p,this.dirty=!1)},d}(rn),Kt=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),(d.prototype=Object.create(h&&h.prototype)).constructor=d,d.prototype.getDefault=function(){return _.Color.transparent},d.prototype.set=function(p){var g=this.current;(p.r!==g.r||p.g!==g.g||p.b!==g.b||p.a!==g.a||this.dirty)&&(this.gl.blendColor(p.r,p.g,p.b,p.a),this.current=p,this.dirty=!1)},d}(rn),Ar=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),(d.prototype=Object.create(h&&h.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.FUNC_ADD},d.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.blendEquation(p),this.current=p,this.dirty=!1)},d}(rn),Ve=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),(d.prototype=Object.create(h&&h.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(p){if(p!==this.current||this.dirty){var g=this.gl;p?g.enable(g.CULL_FACE):g.disable(g.CULL_FACE),this.current=p,this.dirty=!1}},d}(rn),wt=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),(d.prototype=Object.create(h&&h.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.BACK},d.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.cullFace(p),this.current=p,this.dirty=!1)},d}(rn),sr=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),(d.prototype=Object.create(h&&h.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.CCW},d.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.frontFace(p),this.current=p,this.dirty=!1)},d}(rn),dr=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),(d.prototype=Object.create(h&&h.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.useProgram(p),this.current=p,this.dirty=!1)},d}(rn),Vr=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),(d.prototype=Object.create(h&&h.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.TEXTURE0},d.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.activeTexture(p),this.current=p,this.dirty=!1)},d}(rn),Ln=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),(d.prototype=Object.create(h&&h.prototype)).constructor=d,d.prototype.getDefault=function(){var p=this.gl;return[0,0,p.drawingBufferWidth,p.drawingBufferHeight]},d.prototype.set=function(p){var g=this.current;(p[0]!==g[0]||p[1]!==g[1]||p[2]!==g[2]||p[3]!==g[3]||this.dirty)&&(this.gl.viewport(p[0],p[1],p[2],p[3]),this.current=p,this.dirty=!1)},d}(rn),En=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),(d.prototype=Object.create(h&&h.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(p){if(p!==this.current||this.dirty){var g=this.gl;g.bindFramebuffer(g.FRAMEBUFFER,p),this.current=p,this.dirty=!1}},d}(rn),Rn=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),(d.prototype=Object.create(h&&h.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(p){if(p!==this.current||this.dirty){var g=this.gl;g.bindRenderbuffer(g.RENDERBUFFER,p),this.current=p,this.dirty=!1}},d}(rn),xn=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),(d.prototype=Object.create(h&&h.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(p){if(p!==this.current||this.dirty){var g=this.gl;g.bindTexture(g.TEXTURE_2D,p),this.current=p,this.dirty=!1}},d}(rn),si=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),(d.prototype=Object.create(h&&h.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(p){if(p!==this.current||this.dirty){var g=this.gl;g.bindBuffer(g.ARRAY_BUFFER,p),this.current=p,this.dirty=!1}},d}(rn),ei=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),(d.prototype=Object.create(h&&h.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(p){var g=this.gl;g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,p),this.current=p,this.dirty=!1},d}(rn),la=function(h){function d(p){h.call(this,p),this.vao=p.extVertexArrayObject}return h&&(d.__proto__=h),(d.prototype=Object.create(h&&h.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(p){this.vao&&(p!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(p),this.current=p,this.dirty=!1)},d}(rn),sa=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),(d.prototype=Object.create(h&&h.prototype)).constructor=d,d.prototype.getDefault=function(){return 4},d.prototype.set=function(p){if(p!==this.current||this.dirty){var g=this.gl;g.pixelStorei(g.UNPACK_ALIGNMENT,p),this.current=p,this.dirty=!1}},d}(rn),Eo=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),(d.prototype=Object.create(h&&h.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(p){if(p!==this.current||this.dirty){var g=this.gl;g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,p),this.current=p,this.dirty=!1}},d}(rn),Ks=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),(d.prototype=Object.create(h&&h.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(p){if(p!==this.current||this.dirty){var g=this.gl;g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,p),this.current=p,this.dirty=!1}},d}(rn),di=function(h){function d(p,g){h.call(this,p),this.context=p,this.parent=g}return h&&(d.__proto__=h),(d.prototype=Object.create(h&&h.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d}(rn),W=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),(d.prototype=Object.create(h&&h.prototype)).constructor=d,d.prototype.setDirty=function(){this.dirty=!0},d.prototype.set=function(p){if(p!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var g=this.gl;g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,p,0),this.current=p,this.dirty=!1}},d}(di),Q=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),(d.prototype=Object.create(h&&h.prototype)).constructor=d,d.prototype.set=function(p){if(p!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var g=this.gl;g.framebufferRenderbuffer(g.FRAMEBUFFER,g.DEPTH_ATTACHMENT,g.RENDERBUFFER,p),this.current=p,this.dirty=!1}},d}(di),se=function(h,d,p,g){this.context=h,this.width=d,this.height=p;var S=this.framebuffer=h.gl.createFramebuffer();this.colorAttachment=new W(h,S),g&&(this.depthAttachment=new Q(h,S))};se.prototype.destroy=function(){var h=this.context.gl,d=this.colorAttachment.get();if(d&&h.deleteTexture(d),this.depthAttachment){var p=this.depthAttachment.get();p&&h.deleteRenderbuffer(p)}h.deleteFramebuffer(this.framebuffer)};var xe=function(h,d,p){this.func=h,this.mask=d,this.range=p};xe.ReadOnly=!1,xe.ReadWrite=!0,xe.disabled=new xe(519,xe.ReadOnly,[0,1]);var Re=function(h,d,p,g,S,w){this.test=h,this.ref=d,this.mask=p,this.fail=g,this.depthFail=S,this.pass=w};Re.disabled=new Re({func:519,mask:0},0,0,7680,7680,7680);var Je=function(h,d,p){this.blendFunction=h,this.blendColor=d,this.mask=p};Je.disabled=new Je(Je.Replace=[1,0],_.Color.transparent,[!1,!1,!1,!1]),Je.unblended=new Je(Je.Replace,_.Color.transparent,[!0,!0,!0,!0]),Je.alphaBlended=new Je([1,771],_.Color.transparent,[!0,!0,!0,!0]);var lt=function(h,d,p){this.enable=h,this.mode=d,this.frontFace=p};lt.disabled=new lt(!1,1029,2305),lt.backCCW=new lt(!0,1029,2305);var V=function(h){this.gl=h,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new $i(this),this.clearDepth=new Wi(this),this.clearStencil=new Zi(this),this.colorMask=new Jn(this),this.depthMask=new Bn(this),this.stencilMask=new Do(this),this.stencilFunc=new oa(this),this.stencilOp=new $a(this),this.stencilTest=new Ot(this),this.depthRange=new F(this),this.depthTest=new ne(this),this.depthFunc=new de(this),this.blend=new Ne(this),this.blendFunc=new _t(this),this.blendColor=new Kt(this),this.blendEquation=new Ar(this),this.cullFace=new Ve(this),this.cullFaceSide=new wt(this),this.frontFace=new sr(this),this.program=new dr(this),this.activeTexture=new Vr(this),this.viewport=new Ln(this),this.bindFramebuffer=new En(this),this.bindRenderbuffer=new Rn(this),this.bindTexture=new xn(this),this.bindVertexBuffer=new si(this),this.bindElementBuffer=new ei(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new la(this),this.pixelStoreUnpack=new sa(this),this.pixelStoreUnpackPremultiplyAlpha=new Eo(this),this.pixelStoreUnpackFlipY=new Ks(this),this.extTextureFilterAnisotropic=h.getExtension("EXT_texture_filter_anisotropic")||h.getExtension("MOZ_EXT_texture_filter_anisotropic")||h.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=h.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=h.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(h.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=h.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=h.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=h.getParameter(h.MAX_TEXTURE_SIZE)};V.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},V.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},V.prototype.createIndexBuffer=function(h,d){return new un(this,h,d)},V.prototype.createVertexBuffer=function(h,d,p){return new jn(this,h,d,p)},V.prototype.createRenderbuffer=function(h,d,p){var g=this.gl,S=g.createRenderbuffer();return this.bindRenderbuffer.set(S),g.renderbufferStorage(g.RENDERBUFFER,h,d,p),this.bindRenderbuffer.set(null),S},V.prototype.createFramebuffer=function(h,d,p){return new se(this,h,d,p)},V.prototype.clear=function(h){var d=h.color,p=h.depth,g=this.gl,S=0;d&&(S|=g.COLOR_BUFFER_BIT,this.clearColor.set(d),this.colorMask.set([!0,!0,!0,!0])),p!==void 0&&(S|=g.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(p),this.depthMask.set(!0)),g.clear(S)},V.prototype.setCullFace=function(h){h.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(h.mode),this.frontFace.set(h.frontFace))},V.prototype.setDepthMode=function(h){h.func!==this.gl.ALWAYS||h.mask?(this.depthTest.set(!0),this.depthFunc.set(h.func),this.depthMask.set(h.mask),this.depthRange.set(h.range)):this.depthTest.set(!1)},V.prototype.setStencilMode=function(h){h.test.func!==this.gl.ALWAYS||h.mask?(this.stencilTest.set(!0),this.stencilMask.set(h.mask),this.stencilOp.set([h.fail,h.depthFail,h.pass]),this.stencilFunc.set({func:h.test.func,ref:h.ref,mask:h.test.mask})):this.stencilTest.set(!1)},V.prototype.setColorMode=function(h){_.deepEqual(h.blendFunction,Je.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(h.blendFunction),this.blendColor.set(h.blendColor)),this.colorMask.set(h.mask)},V.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var q=function(h){function d(p,g,S){var w=this;h.call(this),this.id=p,this.dispatcher=S,this.on("data",function(C){C.dataType==="source"&&C.sourceDataType==="metadata"&&(w._sourceLoaded=!0),w._sourceLoaded&&!w._paused&&C.dataType==="source"&&C.sourceDataType==="content"&&(w.reload(),w.transform&&w.update(w.transform))}),this.on("error",function(){w._sourceErrored=!0}),this._source=function(C,P,Z,Y){var ce=new Mt[P.type](C,P,Z,Y);if(ce.id!==C)throw new Error("Expected Source id to be "+C+" instead of "+ce.id);return _.bindAll(["load","abort","unload","serialize","prepare"],ce),ce}(p,g,S,this),this._tiles={},this._cache=new mn(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new _.SourceFeatureState}return h&&(d.__proto__=h),(d.prototype=Object.create(h&&h.prototype)).constructor=d,d.prototype.onAdd=function(p){this.map=p,this._maxTileCacheSize=p?p._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(p)},d.prototype.onRemove=function(p){this._source&&this._source.onRemove&&this._source.onRemove(p)},d.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var p in this._tiles){var g=this._tiles[p];if(g.state!=="loaded"&&g.state!=="errored")return!1}return!0},d.prototype.getSource=function(){return this._source},d.prototype.pause=function(){this._paused=!0},d.prototype.resume=function(){if(this._paused){var p=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,p&&this.reload(),this.transform&&this.update(this.transform)}},d.prototype._loadTile=function(p,g){return this._source.loadTile(p,g)},d.prototype._unloadTile=function(p){if(this._source.unloadTile)return this._source.unloadTile(p,function(){})},d.prototype._abortTile=function(p){if(this._source.abortTile)return this._source.abortTile(p,function(){})},d.prototype.serialize=function(){return this._source.serialize()},d.prototype.prepare=function(p){for(var g in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var S=this._tiles[g];S.upload(p),S.prepare(this.map.style.imageManager)}},d.prototype.getIds=function(){return _.values(this._tiles).map(function(p){return p.tileID}).sort(De).map(function(p){return p.key})},d.prototype.getRenderableIds=function(p){var g=this,S=[];for(var w in this._tiles)this._isIdRenderable(w,p)&&S.push(this._tiles[w]);return p?S.sort(function(C,P){var Z=C.tileID,Y=P.tileID,ce=new _.Point(Z.canonical.x,Z.canonical.y)._rotate(g.transform.angle),ge=new _.Point(Y.canonical.x,Y.canonical.y)._rotate(g.transform.angle);return Z.overscaledZ-Y.overscaledZ||ge.y-ce.y||ge.x-ce.x}).map(function(C){return C.tileID.key}):S.map(function(C){return C.tileID}).sort(De).map(function(C){return C.key})},d.prototype.hasRenderableParent=function(p){var g=this.findLoadedParent(p,0);return!!g&&this._isIdRenderable(g.tileID.key)},d.prototype._isIdRenderable=function(p,g){return this._tiles[p]&&this._tiles[p].hasData()&&!this._coveredTiles[p]&&(g||!this._tiles[p].holdingForFade())},d.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var p in this._cache.reset(),this._tiles)this._tiles[p].state!=="errored"&&this._reloadTile(p,"reloading")},d.prototype._reloadTile=function(p,g){var S=this._tiles[p];S&&(S.state!=="loading"&&(S.state=g),this._loadTile(S,this._tileLoaded.bind(this,S,p,g)))},d.prototype._tileLoaded=function(p,g,S,w){if(w)return p.state="errored",void(w.status!==404?this._source.fire(new _.ErrorEvent(w,{tile:p})):this.update(this.transform));p.timeAdded=_.browser.now(),S==="expired"&&(p.refreshedUponExpiration=!0),this._setTileReloadTimer(g,p),this.getSource().type==="raster-dem"&&p.dem&&this._backfillDEM(p),this._state.initializeTileState(p,this.map?this.map.painter:null),this._source.fire(new _.Event("data",{dataType:"source",tile:p,coord:p.tileID}))},d.prototype._backfillDEM=function(p){for(var g=this.getRenderableIds(),S=0;S<g.length;S++){var w=g[S];if(p.neighboringTiles&&p.neighboringTiles[w]){var C=this.getTileByID(w);P(p,C),P(C,p)}}function P(Z,Y){Z.needsHillshadePrepare=!0;var ce=Y.tileID.canonical.x-Z.tileID.canonical.x,ge=Y.tileID.canonical.y-Z.tileID.canonical.y,_e=Math.pow(2,Z.tileID.canonical.z),Fe=Y.tileID.key;ce===0&&ge===0||Math.abs(ge)>1||(Math.abs(ce)>1&&(Math.abs(ce+_e)===1?ce+=_e:Math.abs(ce-_e)===1&&(ce-=_e)),Y.dem&&Z.dem&&(Z.dem.backfillBorder(Y.dem,ce,ge),Z.neighboringTiles&&Z.neighboringTiles[Fe]&&(Z.neighboringTiles[Fe].backfilled=!0)))}},d.prototype.getTile=function(p){return this.getTileByID(p.key)},d.prototype.getTileByID=function(p){return this._tiles[p]},d.prototype._retainLoadedChildren=function(p,g,S,w){for(var C in this._tiles){var P=this._tiles[C];if(!(w[C]||!P.hasData()||P.tileID.overscaledZ<=g||P.tileID.overscaledZ>S)){for(var Z=P.tileID;P&&P.tileID.overscaledZ>g+1;){var Y=P.tileID.scaledTo(P.tileID.overscaledZ-1);(P=this._tiles[Y.key])&&P.hasData()&&(Z=Y)}for(var ce=Z;ce.overscaledZ>g;)if(p[(ce=ce.scaledTo(ce.overscaledZ-1)).key]){w[Z.key]=Z;break}}}},d.prototype.findLoadedParent=function(p,g){if(p.key in this._loadedParentTiles){var S=this._loadedParentTiles[p.key];return S&&S.tileID.overscaledZ>=g?S:null}for(var w=p.overscaledZ-1;w>=g;w--){var C=p.scaledTo(w),P=this._getLoadedTile(C);if(P)return P}},d.prototype._getLoadedTile=function(p){var g=this._tiles[p.key];return g&&g.hasData()?g:this._cache.getByKey(p.wrapped().key)},d.prototype.updateCacheSize=function(p){var g=Math.ceil(p.width/this._source.tileSize)+1,S=Math.ceil(p.height/this._source.tileSize)+1,w=Math.floor(g*S*5),C=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,w):w;this._cache.setMaxSize(C)},d.prototype.handleWrapJump=function(p){var g=Math.round((p-(this._prevLng===void 0?p:this._prevLng))/360);if(this._prevLng=p,g){var S={};for(var w in this._tiles){var C=this._tiles[w];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+g),S[C.tileID.key]=C}for(var P in this._tiles=S,this._timers)clearTimeout(this._timers[P]),delete this._timers[P];for(var Z in this._tiles)this._setTileReloadTimer(Z,this._tiles[Z])}},d.prototype.update=function(p){var g=this;if(this.transform=p,this._sourceLoaded&&!this._paused){var S;this.updateCacheSize(p),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?S=p.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(mr){return new _.OverscaledTileID(mr.canonical.z,mr.wrap,mr.canonical.z,mr.canonical.x,mr.canonical.y)}):(S=p.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(S=S.filter(function(mr){return g._source.hasTile(mr)}))):S=[];var w=p.coveringZoomLevel(this._source),C=Math.max(w-d.maxOverzooming,this._source.minzoom),P=Math.max(w+d.maxUnderzooming,this._source.minzoom),Z=this._updateRetainedTiles(S,w);if(et(this._source.type)){for(var Y={},ce={},ge=0,_e=Object.keys(Z);ge<_e.length;ge+=1){var Fe=_e[ge],Pe=Z[Fe],Xe=this._tiles[Fe];if(Xe&&!(Xe.fadeEndTime&&Xe.fadeEndTime<=_.browser.now())){var we=this.findLoadedParent(Pe,C);we&&(this._addTile(we.tileID),Y[we.tileID.key]=we.tileID),ce[Fe]=Pe}}for(var Ge in this._retainLoadedChildren(ce,w,P,Z),Y)Z[Ge]||(this._coveredTiles[Ge]=!0,Z[Ge]=Y[Ge])}for(var ct in Z)this._tiles[ct].clearFadeHold();for(var At=0,$t=_.keysDifference(this._tiles,Z);At<$t.length;At+=1){var Nt=$t[At],tr=this._tiles[Nt];tr.hasSymbolBuckets&&!tr.holdingForFade()?tr.setHoldDuration(this.map._fadeDuration):tr.hasSymbolBuckets&&!tr.symbolFadeFinished()||this._removeTile(Nt)}this._updateLoadedParentTileCache()}},d.prototype.releaseSymbolFadeTiles=function(){for(var p in this._tiles)this._tiles[p].holdingForFade()&&this._removeTile(p)},d.prototype._updateRetainedTiles=function(p,g){for(var S={},w={},C=Math.max(g-d.maxOverzooming,this._source.minzoom),P=Math.max(g+d.maxUnderzooming,this._source.minzoom),Z={},Y=0,ce=p;Y<ce.length;Y+=1){var ge=ce[Y],_e=this._addTile(ge);S[ge.key]=ge,_e.hasData()||g<this._source.maxzoom&&(Z[ge.key]=ge)}this._retainLoadedChildren(Z,g,P,S);for(var Fe=0,Pe=p;Fe<Pe.length;Fe+=1){var Xe=Pe[Fe],we=this._tiles[Xe.key];if(!we.hasData()){if(g+1>this._source.maxzoom){var Ge=Xe.children(this._source.maxzoom)[0],ct=this.getTile(Ge);if(ct&&ct.hasData()){S[Ge.key]=Ge;continue}}else{var At=Xe.children(this._source.maxzoom);if(S[At[0].key]&&S[At[1].key]&&S[At[2].key]&&S[At[3].key])continue}for(var $t=we.wasRequested(),Nt=Xe.overscaledZ-1;Nt>=C;--Nt){var tr=Xe.scaledTo(Nt);if(w[tr.key]||(w[tr.key]=!0,!(we=this.getTile(tr))&&$t&&(we=this._addTile(tr)),we&&(S[tr.key]=tr,$t=we.wasRequested(),we.hasData())))break}}}return S},d.prototype._updateLoadedParentTileCache=function(){for(var p in this._loadedParentTiles={},this._tiles){for(var g=[],S=void 0,w=this._tiles[p].tileID;w.overscaledZ>0;){if(w.key in this._loadedParentTiles){S=this._loadedParentTiles[w.key];break}g.push(w.key);var C=w.scaledTo(w.overscaledZ-1);if(S=this._getLoadedTile(C))break;w=C}for(var P=0,Z=g;P<Z.length;P+=1)this._loadedParentTiles[Z[P]]=S}},d.prototype._addTile=function(p){var g=this._tiles[p.key];if(g)return g;(g=this._cache.getAndRemove(p))&&(this._setTileReloadTimer(p.key,g),g.tileID=p,this._state.initializeTileState(g,this.map?this.map.painter:null),this._cacheTimers[p.key]&&(clearTimeout(this._cacheTimers[p.key]),delete this._cacheTimers[p.key],this._setTileReloadTimer(p.key,g)));var S=!!g;return S||(g=new _.Tile(p,this._source.tileSize*p.overscaleFactor()),this._loadTile(g,this._tileLoaded.bind(this,g,p.key,g.state))),g?(g.uses++,this._tiles[p.key]=g,S||this._source.fire(new _.Event("dataloading",{tile:g,coord:g.tileID,dataType:"source"})),g):null},d.prototype._setTileReloadTimer=function(p,g){var S=this;p in this._timers&&(clearTimeout(this._timers[p]),delete this._timers[p]);var w=g.getExpiryTimeout();w&&(this._timers[p]=setTimeout(function(){S._reloadTile(p,"expired"),delete S._timers[p]},w))},d.prototype._removeTile=function(p){var g=this._tiles[p];g&&(g.uses--,delete this._tiles[p],this._timers[p]&&(clearTimeout(this._timers[p]),delete this._timers[p]),g.uses>0||(g.hasData()&&g.state!=="reloading"?this._cache.add(g.tileID,g,g.getExpiryTimeout()):(g.aborted=!0,this._abortTile(g),this._unloadTile(g))))},d.prototype.clearTiles=function(){for(var p in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(p);this._cache.reset()},d.prototype.tilesIn=function(p,g,S){var w=this,C=[],P=this.transform;if(!P)return C;for(var Z=S?P.getCameraQueryGeometry(p):p,Y=p.map(function(Nt){return P.pointCoordinate(Nt)}),ce=Z.map(function(Nt){return P.pointCoordinate(Nt)}),ge=this.getIds(),_e=1/0,Fe=1/0,Pe=-1/0,Xe=-1/0,we=0,Ge=ce;we<Ge.length;we+=1){var ct=Ge[we];_e=Math.min(_e,ct.x),Fe=Math.min(Fe,ct.y),Pe=Math.max(Pe,ct.x),Xe=Math.max(Xe,ct.y)}for(var At=function(Nt){var tr=w._tiles[ge[Nt]];if(!tr.holdingForFade()){var mr=tr.tileID,Nr=Math.pow(2,P.zoom-tr.tileID.overscaledZ),Fr=g*tr.queryPadding*_.EXTENT/tr.tileSize/Nr,an=[mr.getTilePoint(new _.MercatorCoordinate(_e,Fe)),mr.getTilePoint(new _.MercatorCoordinate(Pe,Xe))];if(an[0].x-Fr<_.EXTENT&&an[0].y-Fr<_.EXTENT&&an[1].x+Fr>=0&&an[1].y+Fr>=0){var In=Y.map(function(Un){return mr.getTilePoint(Un)}),Nn=ce.map(function(Un){return mr.getTilePoint(Un)});C.push({tile:tr,tileID:mr,queryGeometry:In,cameraQueryGeometry:Nn,scale:Nr})}}},$t=0;$t<ge.length;$t++)At($t);return C},d.prototype.getVisibleCoordinates=function(p){for(var g=this,S=this.getRenderableIds(p).map(function(Z){return g._tiles[Z].tileID}),w=0,C=S;w<C.length;w+=1){var P=C[w];P.posMatrix=this.transform.calculatePosMatrix(P.toUnwrapped())}return S},d.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(et(this._source.type))for(var p in this._tiles){var g=this._tiles[p];if(g.fadeEndTime!==void 0&&g.fadeEndTime>=_.browser.now())return!0}return!1},d.prototype.setFeatureState=function(p,g,S){this._state.updateState(p=p||"_geojsonTileLayer",g,S)},d.prototype.removeFeatureState=function(p,g,S){this._state.removeFeatureState(p=p||"_geojsonTileLayer",g,S)},d.prototype.getFeatureState=function(p,g){return this._state.getState(p=p||"_geojsonTileLayer",g)},d.prototype.setDependencies=function(p,g,S){var w=this._tiles[p];w&&w.setDependencies(g,S)},d.prototype.reloadTilesForDependencies=function(p,g){for(var S in this._tiles)this._tiles[S].hasDependency(p,g)&&this._reloadTile(S,"reloading");this._cache.filter(function(w){return!w.hasDependency(p,g)})},d}(_.Evented);function De(h,d){var p=Math.abs(2*h.wrap)-+(h.wrap<0),g=Math.abs(2*d.wrap)-+(d.wrap<0);return h.overscaledZ-d.overscaledZ||g-p||d.canonical.y-h.canonical.y||d.canonical.x-h.canonical.x}function et(h){return h==="raster"||h==="image"||h==="video"}function be(){return new _.window.Worker(Hf.workerUrl)}q.maxOverzooming=10,q.maxUnderzooming=3;var er="mapboxgl_preloaded_worker_pool",Tr=function(){this.active={}};Tr.prototype.acquire=function(h){if(!this.workers)for(this.workers=[];this.workers.length<Tr.workerCount;)this.workers.push(new be);return this.active[h]=!0,this.workers.slice()},Tr.prototype.release=function(h){delete this.active[h],this.numActive()===0&&(this.workers.forEach(function(d){d.terminate()}),this.workers=null)},Tr.prototype.isPreloaded=function(){return!!this.active[er]},Tr.prototype.numActive=function(){return Object.keys(this.active).length};var bn,nn=Math.floor(_.browser.hardwareConcurrency/2);function ar(){return bn||(bn=new Tr),bn}function Kr(h,d){var p={};for(var g in h)g!=="ref"&&(p[g]=h[g]);return _.refProperties.forEach(function(S){S in d&&(p[S]=d[S])}),p}function Hr(h){h=h.slice();for(var d=Object.create(null),p=0;p<h.length;p++)d[h[p].id]=h[p];for(var g=0;g<h.length;g++)"ref"in h[g]&&(h[g]=Kr(h[g],d[h[g].ref]));return h}Tr.workerCount=Math.max(Math.min(nn,6),1);var $r={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function hi(h,d,p){p.push({command:$r.addSource,args:[h,d[h]]})}function Qr(h,d,p){d.push({command:$r.removeSource,args:[h]}),p[h]=!0}function vi(h,d,p,g){Qr(h,p,g),hi(h,d,p)}function Yi(h,d,p){var g;for(g in h[p])if(h[p].hasOwnProperty(g)&&g!=="data"&&!_.deepEqual(h[p][g],d[p][g]))return!1;for(g in d[p])if(d[p].hasOwnProperty(g)&&g!=="data"&&!_.deepEqual(h[p][g],d[p][g]))return!1;return!0}function ci(h,d,p,g,S,w){var C;for(C in d=d||{},h=h||{})h.hasOwnProperty(C)&&(_.deepEqual(h[C],d[C])||p.push({command:w,args:[g,C,d[C],S]}));for(C in d)d.hasOwnProperty(C)&&!h.hasOwnProperty(C)&&(_.deepEqual(h[C],d[C])||p.push({command:w,args:[g,C,d[C],S]}))}function Li(h){return h.id}function Si(h,d){return h[d.id]=d,h}var Xo=function(h,d){this.reset(h,d)};Xo.prototype.reset=function(h,d){this.points=h||[],this._distances=[0];for(var p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding},Xo.prototype.lerp=function(h){if(this.points.length===1)return this.points[0];h=_.clamp(h,0,1);for(var d=1,p=this._distances[d],g=h*this.paddedLength+this.padding;p<g&&d<this._distances.length;)p=this._distances[++d];var S=d-1,w=this._distances[S],C=p-w,P=C>0?(g-w)/C:0;return this.points[S].mult(1-P).add(this.points[d].mult(P))};var Ki=function(h,d,p){var g=this.boxCells=[],S=this.circleCells=[];this.xCellCount=Math.ceil(h/p),this.yCellCount=Math.ceil(d/p);for(var w=0;w<this.xCellCount*this.yCellCount;w++)g.push([]),S.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=h,this.height=d,this.xScale=this.xCellCount/h,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0};function Ia(h,d,p,g,S){var w=_.create();return d?(_.scale(w,w,[1/S,1/S,1]),p||_.rotateZ(w,w,g.angle)):_.multiply(w,g.labelPlaneMatrix,h),w}function Ai(h,d,p,g,S){if(d){var w=_.clone(h);return _.scale(w,w,[S,S,1]),p||_.rotateZ(w,w,-g.angle),w}return g.glCoordMatrix}function mi(h,d){var p=[h.x,h.y,0,1];ia(p,p,d);var g=p[3];return{point:new _.Point(p[0]/g,p[1]/g),signedDistanceFromCamera:g}}function Ti(h,d){return .5+h/d*.5}function Pa(h,d){var p=h[0]/h[3],g=h[1]/h[3];return p>=-d[0]&&p<=d[0]&&g>=-d[1]&&g<=d[1]}function cu(h,d,p,g,S,w,C,P){var Z=g?h.textSizeData:h.iconSizeData,Y=_.evaluateSizeForZoom(Z,p.transform.zoom),ce=[256/p.width*2+1,256/p.height*2+1],ge=g?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;ge.clear();for(var _e=h.lineVertexArray,Fe=g?h.text.placedSymbolArray:h.icon.placedSymbolArray,Pe=p.transform.width/p.transform.height,Xe=!1,we=0;we<Fe.length;we++){var Ge=Fe.get(we);if(Ge.hidden||Ge.writingMode===_.WritingMode.vertical&&!Xe)Oa(Ge.numGlyphs,ge);else{Xe=!1;var ct=[Ge.anchorX,Ge.anchorY,0,1];if(_.transformMat4(ct,ct,d),Pa(ct,ce)){var At=Ti(p.transform.cameraToCenterDistance,ct[3]),$t=_.evaluateSizeForFeature(Z,Y,Ge),Nt=C?$t/At:$t*At,tr=new _.Point(Ge.anchorX,Ge.anchorY),mr=mi(tr,S).point,Nr={},Fr=$l(Ge,Nt,!1,P,d,S,w,h.glyphOffsetArray,_e,ge,mr,tr,Nr,Pe);Xe=Fr.useVertical,(Fr.notEnoughRoom||Xe||Fr.needsFlipping&&$l(Ge,Nt,!0,P,d,S,w,h.glyphOffsetArray,_e,ge,mr,tr,Nr,Pe).notEnoughRoom)&&Oa(Ge.numGlyphs,ge)}else Oa(Ge.numGlyphs,ge)}}g?h.text.dynamicLayoutVertexBuffer.updateData(ge):h.icon.dynamicLayoutVertexBuffer.updateData(ge)}function ma(h,d,p,g,S,w,C,P,Z,Y,ce){var ge=P.glyphStartIndex+P.numGlyphs,_e=P.lineStartIndex,Fe=P.lineStartIndex+P.lineLength,Pe=d.getoffsetX(P.glyphStartIndex),Xe=d.getoffsetX(ge-1),we=Ta(h*Pe,p,g,S,w,C,P.segment,_e,Fe,Z,Y,ce);if(!we)return null;var Ge=Ta(h*Xe,p,g,S,w,C,P.segment,_e,Fe,Z,Y,ce);return Ge?{first:we,last:Ge}:null}function Aa(h,d,p,g){return h===_.WritingMode.horizontal&&Math.abs(p.y-d.y)>Math.abs(p.x-d.x)*g?{useVertical:!0}:(h===_.WritingMode.vertical?d.y<p.y:d.x>p.x)?{needsFlipping:!0}:null}function $l(h,d,p,g,S,w,C,P,Z,Y,ce,ge,_e,Fe){var Pe,Xe=d/24,we=h.lineOffsetX*Xe,Ge=h.lineOffsetY*Xe;if(h.numGlyphs>1){var ct=h.glyphStartIndex+h.numGlyphs,At=h.lineStartIndex,$t=h.lineStartIndex+h.lineLength,Nt=ma(Xe,P,we,Ge,p,ce,ge,h,Z,w,_e);if(!Nt)return{notEnoughRoom:!0};var tr=mi(Nt.first.point,C).point,mr=mi(Nt.last.point,C).point;if(g&&!p){var Nr=Aa(h.writingMode,tr,mr,Fe);if(Nr)return Nr}Pe=[Nt.first];for(var Fr=h.glyphStartIndex+1;Fr<ct-1;Fr++)Pe.push(Ta(Xe*P.getoffsetX(Fr),we,Ge,p,ce,ge,h.segment,At,$t,Z,w,_e));Pe.push(Nt.last)}else{if(g&&!p){var an=mi(ge,S).point,In=h.lineStartIndex+h.segment+1,Nn=new _.Point(Z.getx(In),Z.gety(In)),Un=mi(Nn,S),ji=Un.signedDistanceFromCamera>0?Un.point:os(ge,Nn,an,1,S),hn=Aa(h.writingMode,an,ji,Fe);if(hn)return hn}var Kn=Ta(Xe*P.getoffsetX(h.glyphStartIndex),we,Ge,p,ce,ge,h.segment,h.lineStartIndex,h.lineStartIndex+h.lineLength,Z,w,_e);if(!Kn)return{notEnoughRoom:!0};Pe=[Kn]}for(var _i=0,ti=Pe;_i<ti.length;_i+=1){var Xn=ti[_i];_.addDynamicAttributes(Y,Xn.point,Xn.angle)}return{}}function os(h,d,p,g,S){var w=mi(h.add(h.sub(d)._unit()),S).point,C=p.sub(w);return p.add(C._mult(g/C.mag()))}function Ta(h,d,p,g,S,w,C,P,Z,Y,ce,ge){var _e=g?h-d:h+d,Fe=_e>0?1:-1,Pe=0;g&&(Fe*=-1,Pe=Math.PI),Fe<0&&(Pe+=Math.PI);for(var Xe=Fe>0?P+C:P+C+1,we=S,Ge=S,ct=0,At=0,$t=Math.abs(_e),Nt=[];ct+At<=$t;){if((Xe+=Fe)<P||Xe>=Z)return null;if(Ge=we,Nt.push(we),(we=ge[Xe])===void 0){var tr=new _.Point(Y.getx(Xe),Y.gety(Xe)),mr=mi(tr,ce);if(mr.signedDistanceFromCamera>0)we=ge[Xe]=mr.point;else{var Nr=Xe-Fe;we=os(ct===0?w:new _.Point(Y.getx(Nr),Y.gety(Nr)),tr,Ge,$t-ct+1,ce)}}ct+=At,At=Ge.dist(we)}var Fr=($t-ct)/At,an=we.sub(Ge),In=an.mult(Fr)._add(Ge);In._add(an._unit()._perp()._mult(p*Fe));var Nn=Pe+Math.atan2(we.y-Ge.y,we.x-Ge.x);return Nt.push(In),{point:In,angle:Nn,path:Nt}}Ki.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Ki.prototype.insert=function(h,d,p,g,S){this._forEachCell(d,p,g,S,this._insertBoxCell,this.boxUid++),this.boxKeys.push(h),this.bboxes.push(d),this.bboxes.push(p),this.bboxes.push(g),this.bboxes.push(S)},Ki.prototype.insertCircle=function(h,d,p,g){this._forEachCell(d-g,p-g,d+g,p+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(h),this.circles.push(d),this.circles.push(p),this.circles.push(g)},Ki.prototype._insertBoxCell=function(h,d,p,g,S,w){this.boxCells[S].push(w)},Ki.prototype._insertCircleCell=function(h,d,p,g,S,w){this.circleCells[S].push(w)},Ki.prototype._query=function(h,d,p,g,S,w){if(p<0||h>this.width||g<0||d>this.height)return!S&&[];var C=[];if(h<=0&&d<=0&&this.width<=p&&this.height<=g){if(S)return!0;for(var P=0;P<this.boxKeys.length;P++)C.push({key:this.boxKeys[P],x1:this.bboxes[4*P],y1:this.bboxes[4*P+1],x2:this.bboxes[4*P+2],y2:this.bboxes[4*P+3]});for(var Z=0;Z<this.circleKeys.length;Z++){var Y=this.circles[3*Z],ce=this.circles[3*Z+1],ge=this.circles[3*Z+2];C.push({key:this.circleKeys[Z],x1:Y-ge,y1:ce-ge,x2:Y+ge,y2:ce+ge})}return w?C.filter(w):C}return this._forEachCell(h,d,p,g,this._queryCell,C,{hitTest:S,seenUids:{box:{},circle:{}}},w),S?C.length>0:C},Ki.prototype._queryCircle=function(h,d,p,g,S){var w=h-p,C=h+p,P=d-p,Z=d+p;if(C<0||w>this.width||Z<0||P>this.height)return!g&&[];var Y=[];return this._forEachCell(w,P,C,Z,this._queryCellCircle,Y,{hitTest:g,circle:{x:h,y:d,radius:p},seenUids:{box:{},circle:{}}},S),g?Y.length>0:Y},Ki.prototype.query=function(h,d,p,g,S){return this._query(h,d,p,g,!1,S)},Ki.prototype.hitTest=function(h,d,p,g,S){return this._query(h,d,p,g,!0,S)},Ki.prototype.hitTestCircle=function(h,d,p,g){return this._queryCircle(h,d,p,!0,g)},Ki.prototype._queryCell=function(h,d,p,g,S,w,C,P){var Z=C.seenUids,Y=this.boxCells[S];if(Y!==null)for(var ce=this.bboxes,ge=0,_e=Y;ge<_e.length;ge+=1){var Fe=_e[ge];if(!Z.box[Fe]){Z.box[Fe]=!0;var Pe=4*Fe;if(h<=ce[Pe+2]&&d<=ce[Pe+3]&&p>=ce[Pe+0]&&g>=ce[Pe+1]&&(!P||P(this.boxKeys[Fe]))){if(C.hitTest)return w.push(!0),!0;w.push({key:this.boxKeys[Fe],x1:ce[Pe],y1:ce[Pe+1],x2:ce[Pe+2],y2:ce[Pe+3]})}}}var Xe=this.circleCells[S];if(Xe!==null)for(var we=this.circles,Ge=0,ct=Xe;Ge<ct.length;Ge+=1){var At=ct[Ge];if(!Z.circle[At]){Z.circle[At]=!0;var $t=3*At;if(this._circleAndRectCollide(we[$t],we[$t+1],we[$t+2],h,d,p,g)&&(!P||P(this.circleKeys[At]))){if(C.hitTest)return w.push(!0),!0;var Nt=we[$t],tr=we[$t+1],mr=we[$t+2];w.push({key:this.circleKeys[At],x1:Nt-mr,y1:tr-mr,x2:Nt+mr,y2:tr+mr})}}}},Ki.prototype._queryCellCircle=function(h,d,p,g,S,w,C,P){var Z=C.circle,Y=C.seenUids,ce=this.boxCells[S];if(ce!==null)for(var ge=this.bboxes,_e=0,Fe=ce;_e<Fe.length;_e+=1){var Pe=Fe[_e];if(!Y.box[Pe]){Y.box[Pe]=!0;var Xe=4*Pe;if(this._circleAndRectCollide(Z.x,Z.y,Z.radius,ge[Xe+0],ge[Xe+1],ge[Xe+2],ge[Xe+3])&&(!P||P(this.boxKeys[Pe])))return w.push(!0),!0}}var we=this.circleCells[S];if(we!==null)for(var Ge=this.circles,ct=0,At=we;ct<At.length;ct+=1){var $t=At[ct];if(!Y.circle[$t]){Y.circle[$t]=!0;var Nt=3*$t;if(this._circlesCollide(Ge[Nt],Ge[Nt+1],Ge[Nt+2],Z.x,Z.y,Z.radius)&&(!P||P(this.circleKeys[$t])))return w.push(!0),!0}}},Ki.prototype._forEachCell=function(h,d,p,g,S,w,C,P){for(var Z=this._convertToXCellCoord(h),Y=this._convertToYCellCoord(d),ce=this._convertToXCellCoord(p),ge=this._convertToYCellCoord(g),_e=Z;_e<=ce;_e++)for(var Fe=Y;Fe<=ge;Fe++)if(S.call(this,h,d,p,g,this.xCellCount*Fe+_e,w,C,P))return},Ki.prototype._convertToXCellCoord=function(h){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(h*this.xScale)))},Ki.prototype._convertToYCellCoord=function(h){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(h*this.yScale)))},Ki.prototype._circlesCollide=function(h,d,p,g,S,w){var C=g-h,P=S-d,Z=p+w;return Z*Z>C*C+P*P},Ki.prototype._circleAndRectCollide=function(h,d,p,g,S,w,C){var P=(w-g)/2,Z=Math.abs(h-(g+P));if(Z>P+p)return!1;var Y=(C-S)/2,ce=Math.abs(d-(S+Y));if(ce>Y+p)return!1;if(Z<=P||ce<=Y)return!0;var ge=Z-P,_e=ce-Y;return ge*ge+_e*_e<=p*p};var fi=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Oa(h,d){for(var p=0;p<h;p++){var g=d.length;d.resize(g+4),d.float32.set(fi,3*g)}}function ia(h,d,p){var g=d[0],S=d[1];return h[0]=p[0]*g+p[4]*S+p[12],h[1]=p[1]*g+p[5]*S+p[13],h[3]=p[3]*g+p[7]*S+p[15],h}var So=function(h,d,p){d===void 0&&(d=new Ki(h.width+200,h.height+200,25)),p===void 0&&(p=new Ki(h.width+200,h.height+200,25)),this.transform=h,this.grid=d,this.ignoredGrid=p,this.pitchfactor=Math.cos(h._pitch)*h.cameraToCenterDistance,this.screenRightBoundary=h.width+100,this.screenBottomBoundary=h.height+100,this.gridRightBoundary=h.width+200,this.gridBottomBoundary=h.height+200};function ha(h,d,p){return d*(_.EXTENT/(h.tileSize*Math.pow(2,p-h.tileID.overscaledZ)))}So.prototype.placeCollisionBox=function(h,d,p,g,S){var w=this.projectAndGetPerspectiveRatio(g,h.anchorPointX,h.anchorPointY),C=p*w.perspectiveRatio,P=h.x1*C+w.point.x,Z=h.y1*C+w.point.y,Y=h.x2*C+w.point.x,ce=h.y2*C+w.point.y;return!this.isInsideGrid(P,Z,Y,ce)||!d&&this.grid.hitTest(P,Z,Y,ce,S)?{box:[],offscreen:!1}:{box:[P,Z,Y,ce],offscreen:this.isOffscreen(P,Z,Y,ce)}},So.prototype.placeCollisionCircles=function(h,d,p,g,S,w,C,P,Z,Y,ce,ge,_e){var Fe=[],Pe=new _.Point(d.anchorX,d.anchorY),Xe=mi(Pe,w),we=Ti(this.transform.cameraToCenterDistance,Xe.signedDistanceFromCamera),Ge=(Y?S/we:S*we)/_.ONE_EM,ct=mi(Pe,C).point,At=ma(Ge,g,d.lineOffsetX*Ge,d.lineOffsetY*Ge,!1,ct,Pe,d,p,C,{}),$t=!1,Nt=!1,tr=!0;if(At){for(var mr=.5*ge*we+_e,Nr=new _.Point(-100,-100),Fr=new _.Point(this.screenRightBoundary,this.screenBottomBoundary),an=new Xo,In=At.first,Nn=At.last,Un=[],ji=In.path.length-1;ji>=1;ji--)Un.push(In.path[ji]);for(var hn=1;hn<Nn.path.length;hn++)Un.push(Nn.path[hn]);var Kn=2.5*mr;if(P){var _i=Un.map(function(Ns){return mi(Ns,P)});Un=_i.some(function(Ns){return Ns.signedDistanceFromCamera<=0})?[]:_i.map(function(Ns){return Ns.point})}var ti=[];if(Un.length>0){for(var Xn=Un[0].clone(),pi=Un[0].clone(),qn=1;qn<Un.length;qn++)Xn.x=Math.min(Xn.x,Un[qn].x),Xn.y=Math.min(Xn.y,Un[qn].y),pi.x=Math.max(pi.x,Un[qn].x),pi.y=Math.max(pi.y,Un[qn].y);ti=Xn.x>=Nr.x&&pi.x<=Fr.x&&Xn.y>=Nr.y&&pi.y<=Fr.y?[Un]:pi.x<Nr.x||Xn.x>Fr.x||pi.y<Nr.y||Xn.y>Fr.y?[]:_.clipLine([Un],Nr.x,Nr.y,Fr.x,Fr.y)}for(var $n=0,wo=ti;$n<wo.length;$n+=1){var Na;an.reset(wo[$n],.25*mr),Na=an.length<=.5*mr?1:Math.ceil(an.paddedLength/Kn)+1;for(var Co=0;Co<Na;Co++){var Lo=Co/Math.max(Na-1,1),Wa=an.lerp(Lo),Ga=Wa.x+100,Ss=Wa.y+100;Fe.push(Ga,Ss,mr,0);var ls=Ga-mr,Zu=Ss-mr,cs=Ga+mr,nu=Ss+mr;if(tr=tr&&this.isOffscreen(ls,Zu,cs,nu),Nt=Nt||this.isInsideGrid(ls,Zu,cs,nu),!h&&this.grid.hitTestCircle(Ga,Ss,mr,ce)&&($t=!0,!Z))return{circles:[],offscreen:!1,collisionDetected:$t}}}}return{circles:!Z&&$t||!Nt?[]:Fe,offscreen:tr,collisionDetected:$t}},So.prototype.queryRenderedSymbols=function(h){if(h.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var d=[],p=1/0,g=1/0,S=-1/0,w=-1/0,C=0,P=h;C<P.length;C+=1){var Z=P[C],Y=new _.Point(Z.x+100,Z.y+100);p=Math.min(p,Y.x),g=Math.min(g,Y.y),S=Math.max(S,Y.x),w=Math.max(w,Y.y),d.push(Y)}for(var ce={},ge={},_e=0,Fe=this.grid.query(p,g,S,w).concat(this.ignoredGrid.query(p,g,S,w));_e<Fe.length;_e+=1){var Pe=Fe[_e],Xe=Pe.key;if(ce[Xe.bucketInstanceId]===void 0&&(ce[Xe.bucketInstanceId]={}),!ce[Xe.bucketInstanceId][Xe.featureIndex]){var we=[new _.Point(Pe.x1,Pe.y1),new _.Point(Pe.x2,Pe.y1),new _.Point(Pe.x2,Pe.y2),new _.Point(Pe.x1,Pe.y2)];_.polygonIntersectsPolygon(d,we)&&(ce[Xe.bucketInstanceId][Xe.featureIndex]=!0,ge[Xe.bucketInstanceId]===void 0&&(ge[Xe.bucketInstanceId]=[]),ge[Xe.bucketInstanceId].push(Xe.featureIndex))}}return ge},So.prototype.insertCollisionBox=function(h,d,p,g,S){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:g,collisionGroupID:S},h[0],h[1],h[2],h[3])},So.prototype.insertCollisionCircles=function(h,d,p,g,S){for(var w=d?this.ignoredGrid:this.grid,C={bucketInstanceId:p,featureIndex:g,collisionGroupID:S},P=0;P<h.length;P+=4)w.insertCircle(C,h[P],h[P+1],h[P+2])},So.prototype.projectAndGetPerspectiveRatio=function(h,d,p){var g=[d,p,0,1];return ia(g,g,h),{point:new _.Point((g[0]/g[3]+1)/2*this.transform.width+100,(-g[1]/g[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/g[3]*.5}},So.prototype.isOffscreen=function(h,d,p,g){return p<100||h>=this.screenRightBoundary||g<100||d>this.screenBottomBoundary},So.prototype.isInsideGrid=function(h,d,p,g){return p>=0&&h<this.gridRightBoundary&&g>=0&&d<this.gridBottomBoundary},So.prototype.getViewportMatrix=function(){var h=_.identity([]);return _.translate(h,h,[-100,-100,0]),h};var $o=function(h,d,p,g){this.opacity=h?Math.max(0,Math.min(1,h.opacity+(h.placed?d:-d))):g&&p?1:0,this.placed=p};$o.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var Vo=function(h,d,p,g,S){this.text=new $o(h?h.text:null,d,p,S),this.icon=new $o(h?h.icon:null,d,g,S)};Vo.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var Ru=function(h,d,p){this.text=h,this.icon=d,this.skipFade=p},ss=function(){this.invProjMatrix=_.create(),this.viewportMatrix=_.create(),this.circles=[]},Cc=function(h,d,p,g,S){this.bucketInstanceId=h,this.featureIndex=d,this.sourceLayerIndex=p,this.bucketIndex=g,this.tileID=S},Ea=function(h){this.crossSourceCollisions=h,this.maxGroupID=0,this.collisionGroups={}};function Qi(h,d,p,g,S){var w=_.getAnchorAlignment(h),C=-(w.horizontalAlign-.5)*d,P=-(w.verticalAlign-.5)*p,Z=_.evaluateVariableOffset(h,g);return new _.Point(C+Z[0]*S,P+Z[1]*S)}function Wt(h,d,p,g,S,w){var C=h.x1,P=h.x2,Z=h.y1,Y=h.y2,ce=h.anchorPointX,ge=h.anchorPointY,_e=new _.Point(d,p);return g&&_e._rotate(S?w:-w),{x1:C+_e.x,y1:Z+_e.y,x2:P+_e.x,y2:Y+_e.y,anchorPointX:ce,anchorPointY:ge}}Ea.prototype.get=function(h){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[h]){var d=++this.maxGroupID;this.collisionGroups[h]={ID:d,predicate:function(p){return p.collisionGroupID===d}}}return this.collisionGroups[h]};var yn=function(h,d,p,g){this.transform=h.clone(),this.collisionIndex=new So(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new Ea(p),this.collisionCircleArrays={},this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}};function fe(h,d,p,g,S){h.emplaceBack(d?1:0,p?1:0,g||0,S||0),h.emplaceBack(d?1:0,p?1:0,g||0,S||0),h.emplaceBack(d?1:0,p?1:0,g||0,S||0),h.emplaceBack(d?1:0,p?1:0,g||0,S||0)}yn.prototype.getBucketParts=function(h,d,p,g){var S=p.getBucket(d),w=p.latestFeatureIndex;if(S&&w&&d.id===S.layerIds[0]){var C=p.collisionBoxArray,P=S.layers[0].layout,Z=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),Y=p.tileSize/_.EXTENT,ce=this.transform.calculatePosMatrix(p.tileID.toUnwrapped()),ge=P.get("text-pitch-alignment")==="map",_e=P.get("text-rotation-alignment")==="map",Fe=ha(p,1,this.transform.zoom),Pe=Ia(ce,ge,_e,this.transform,Fe),Xe=null;if(ge){var we=Ai(ce,ge,_e,this.transform,Fe);Xe=_.multiply([],this.transform.labelPlaneMatrix,we)}this.retainedQueryData[S.bucketInstanceId]=new Cc(S.bucketInstanceId,w,S.sourceLayerIndex,S.index,p.tileID);var Ge={bucket:S,layout:P,posMatrix:ce,textLabelPlaneMatrix:Pe,labelToScreenMatrix:Xe,scale:Z,textPixelRatio:Y,holdingForFade:p.holdingForFade(),collisionBoxArray:C,partiallyEvaluatedTextSize:_.evaluateSizeForZoom(S.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(S.sourceID)};if(g)for(var ct=0,At=S.sortKeyRanges;ct<At.length;ct+=1){var $t=At[ct];h.push({sortKey:$t.sortKey,symbolInstanceStart:$t.symbolInstanceStart,symbolInstanceEnd:$t.symbolInstanceEnd,parameters:Ge})}else h.push({symbolInstanceStart:0,symbolInstanceEnd:S.symbolInstances.length,parameters:Ge})}},yn.prototype.attemptAnchorPlacement=function(h,d,p,g,S,w,C,P,Z,Y,ce,ge,_e,Fe,Pe){var Xe,we=[ge.textOffset0,ge.textOffset1],Ge=Qi(h,p,g,we,S),ct=this.collisionIndex.placeCollisionBox(Wt(d,Ge.x,Ge.y,w,C,this.transform.angle),ce,P,Z,Y.predicate);if(!Pe||this.collisionIndex.placeCollisionBox(Wt(Pe,Ge.x,Ge.y,w,C,this.transform.angle),ce,P,Z,Y.predicate).box.length!==0)return ct.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[ge.crossTileID]&&this.prevPlacement.placements[ge.crossTileID]&&this.prevPlacement.placements[ge.crossTileID].text&&(Xe=this.prevPlacement.variableOffsets[ge.crossTileID].anchor),this.variableOffsets[ge.crossTileID]={textOffset:we,width:p,height:g,anchor:h,textBoxScale:S,prevAnchor:Xe},this.markUsedJustification(_e,h,ge,Fe),_e.allowVerticalPlacement&&(this.markUsedOrientation(_e,Fe,ge),this.placedOrientations[ge.crossTileID]=Fe),{shift:Ge,placedGlyphBoxes:ct}):void 0},yn.prototype.placeLayerBucketPart=function(h,d,p){var g=this,S=h.parameters,w=S.bucket,C=S.layout,P=S.posMatrix,Z=S.textLabelPlaneMatrix,Y=S.labelToScreenMatrix,ce=S.textPixelRatio,ge=S.holdingForFade,_e=S.collisionBoxArray,Fe=S.partiallyEvaluatedTextSize,Pe=S.collisionGroup,Xe=C.get("text-optional"),we=C.get("icon-optional"),Ge=C.get("text-allow-overlap"),ct=C.get("icon-allow-overlap"),At=C.get("text-rotation-alignment")==="map",$t=C.get("text-pitch-alignment")==="map",Nt=C.get("icon-text-fit")!=="none",tr=C.get("symbol-z-order")==="viewport-y",mr=Ge&&(ct||!w.hasIconData()||we),Nr=ct&&(Ge||!w.hasTextData()||Xe);!w.collisionArrays&&_e&&w.deserializeCollisionBoxes(_e);var Fr=function(hn,Kn){if(!d[hn.crossTileID])if(ge)g.placements[hn.crossTileID]=new Ru(!1,!1,!1);else{var _i,ti=!1,Xn=!1,pi=!0,qn=null,$n={box:null,offscreen:null},wo={box:null,offscreen:null},Na=null,Co=null,Lo=0,Wa=0,Ga=0;Kn.textFeatureIndex?Lo=Kn.textFeatureIndex:hn.useRuntimeCollisionCircles&&(Lo=hn.featureIndex),Kn.verticalTextFeatureIndex&&(Wa=Kn.verticalTextFeatureIndex);var Ss=Kn.textBox;if(Ss){var ls=function(Ni){var po=_.WritingMode.horizontal;if(w.allowVerticalPlacement&&!Ni&&g.prevPlacement){var io=g.prevPlacement.placedOrientations[hn.crossTileID];io&&(g.placedOrientations[hn.crossTileID]=io,g.markUsedOrientation(w,po=io,hn))}return po},Zu=function(Ni,po){if(w.allowVerticalPlacement&&hn.numVerticalGlyphVertices>0&&Kn.verticalTextBox)for(var io=0,ou=w.writingModes;io<ou.length&&(ou[io]===_.WritingMode.vertical?($n=po(),wo=$n):$n=Ni(),!($n&&$n.box&&$n.box.length));io+=1);else $n=Ni()};if(C.get("text-variable-anchor")){var cs=C.get("text-variable-anchor");if(g.prevPlacement&&g.prevPlacement.variableOffsets[hn.crossTileID]){var nu=g.prevPlacement.variableOffsets[hn.crossTileID];cs.indexOf(nu.anchor)>0&&(cs=cs.filter(function(Ni){return Ni!==nu.anchor})).unshift(nu.anchor)}var Ns=function(Ni,po,io){for(var ou=Ni.x2-Ni.x1,Bc=Ni.y2-Ni.y1,Bl=hn.textBoxScale,fs=Nt&&!ct?po:null,Or={box:[],offscreen:!1},Wu=Ge?2*cs.length:cs.length,Gu=0;Gu<Wu;++Gu){var ao=g.attemptAnchorPlacement(cs[Gu%cs.length],Ni,ou,Bc,Bl,At,$t,ce,P,Pe,Gu>=cs.length,hn,w,io,fs);if(ao&&(Or=ao.placedGlyphBoxes)&&Or.box&&Or.box.length){ti=!0,qn=ao.shift;break}}return Or};Zu(function(){return Ns(Ss,Kn.iconBox,_.WritingMode.horizontal)},function(){var Ni=Kn.verticalTextBox;return w.allowVerticalPlacement&&!($n&&$n.box&&$n.box.length)&&hn.numVerticalGlyphVertices>0&&Ni?Ns(Ni,Kn.verticalIconBox,_.WritingMode.vertical):{box:null,offscreen:null}}),$n&&(ti=$n.box,pi=$n.offscreen);var sl=ls($n&&$n.box);if(!ti&&g.prevPlacement){var kl=g.prevPlacement.variableOffsets[hn.crossTileID];kl&&(g.variableOffsets[hn.crossTileID]=kl,g.markUsedJustification(w,kl.anchor,hn,sl))}}else{var ul=function(Ni,po){var io=g.collisionIndex.placeCollisionBox(Ni,Ge,ce,P,Pe.predicate);return io&&io.box&&io.box.length&&(g.markUsedOrientation(w,po,hn),g.placedOrientations[hn.crossTileID]=po),io};Zu(function(){return ul(Ss,_.WritingMode.horizontal)},function(){var Ni=Kn.verticalTextBox;return w.allowVerticalPlacement&&hn.numVerticalGlyphVertices>0&&Ni?ul(Ni,_.WritingMode.vertical):{box:null,offscreen:null}}),ls($n&&$n.box&&$n.box.length)}}if(ti=(_i=$n)&&_i.box&&_i.box.length>0,pi=_i&&_i.offscreen,hn.useRuntimeCollisionCircles){var Fl=w.text.placedSymbolArray.get(hn.centerJustifiedTextSymbolIndex),Vu=_.evaluateSizeForFeature(w.textSizeData,Fe,Fl),iu=C.get("text-padding");Na=g.collisionIndex.placeCollisionCircles(Ge,Fl,w.lineVertexArray,w.glyphOffsetArray,Vu,P,Z,Y,p,$t,Pe.predicate,hn.collisionCircleDiameter,iu),ti=Ge||Na.circles.length>0&&!Na.collisionDetected,pi=pi&&Na.offscreen}if(Kn.iconFeatureIndex&&(Ga=Kn.iconFeatureIndex),Kn.iconBox){var ju=function(Ni){var po=Nt&&qn?Wt(Ni,qn.x,qn.y,At,$t,g.transform.angle):Ni;return g.collisionIndex.placeCollisionBox(po,ct,ce,P,Pe.predicate)};Xn=wo&&wo.box&&wo.box.length&&Kn.verticalIconBox?(Co=ju(Kn.verticalIconBox)).box.length>0:(Co=ju(Kn.iconBox)).box.length>0,pi=pi&&Co.offscreen}var Ko=Xe||hn.numHorizontalGlyphVertices===0&&hn.numVerticalGlyphVertices===0,Ka=we||hn.numIconVertices===0;if(Ko||Ka?Ka?Ko||(Xn=Xn&&ti):ti=Xn&&ti:Xn=ti=Xn&&ti,ti&&_i&&_i.box&&g.collisionIndex.insertCollisionBox(_i.box,C.get("text-ignore-placement"),w.bucketInstanceId,wo&&wo.box&&Wa?Wa:Lo,Pe.ID),Xn&&Co&&g.collisionIndex.insertCollisionBox(Co.box,C.get("icon-ignore-placement"),w.bucketInstanceId,Ga,Pe.ID),Na&&(ti&&g.collisionIndex.insertCollisionCircles(Na.circles,C.get("text-ignore-placement"),w.bucketInstanceId,Lo,Pe.ID),p)){var As=w.bucketInstanceId,au=g.collisionCircleArrays[As];au===void 0&&(au=g.collisionCircleArrays[As]=new ss);for(var Hu=0;Hu<Na.circles.length;Hu+=4)au.circles.push(Na.circles[Hu+0]),au.circles.push(Na.circles[Hu+1]),au.circles.push(Na.circles[Hu+2]),au.circles.push(Na.collisionDetected?1:0)}g.placements[hn.crossTileID]=new Ru(ti||mr,Xn||Nr,pi||w.justReloaded),d[hn.crossTileID]=!0}};if(tr)for(var an=w.getSortedSymbolIndexes(this.transform.angle),In=an.length-1;In>=0;--In){var Nn=an[In];Fr(w.symbolInstances.get(Nn),w.collisionArrays[Nn])}else for(var Un=h.symbolInstanceStart;Un<h.symbolInstanceEnd;Un++)Fr(w.symbolInstances.get(Un),w.collisionArrays[Un]);if(p&&w.bucketInstanceId in this.collisionCircleArrays){var ji=this.collisionCircleArrays[w.bucketInstanceId];_.invert(ji.invProjMatrix,P),ji.viewportMatrix=this.collisionIndex.getViewportMatrix()}w.justReloaded=!1},yn.prototype.markUsedJustification=function(h,d,p,g){var S;S=g===_.WritingMode.vertical?p.verticalPlacedTextSymbolIndex:{left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex}[_.getAnchorJustification(d)];for(var w=0,C=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];w<C.length;w+=1){var P=C[w];P>=0&&(h.text.placedSymbolArray.get(P).crossTileID=S>=0&&P!==S?0:p.crossTileID)}},yn.prototype.markUsedOrientation=function(h,d,p){for(var g=d===_.WritingMode.horizontal||d===_.WritingMode.horizontalOnly?d:0,S=d===_.WritingMode.vertical?d:0,w=0,C=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex];w<C.length;w+=1)h.text.placedSymbolArray.get(C[w]).placedOrientation=g;p.verticalPlacedTextSymbolIndex&&(h.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=S)},yn.prototype.commit=function(h){this.commitTime=h,this.zoomAtLastRecencyCheck=this.transform.zoom;var d=this.prevPlacement,p=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;var g=d?d.symbolFadeChange(h):1,S=d?d.opacities:{},w=d?d.variableOffsets:{},C=d?d.placedOrientations:{};for(var P in this.placements){var Z=this.placements[P],Y=S[P];Y?(this.opacities[P]=new Vo(Y,g,Z.text,Z.icon),p=p||Z.text!==Y.text.placed||Z.icon!==Y.icon.placed):(this.opacities[P]=new Vo(null,g,Z.text,Z.icon,Z.skipFade),p=p||Z.text||Z.icon)}for(var ce in S){var ge=S[ce];if(!this.opacities[ce]){var _e=new Vo(ge,g,!1,!1);_e.isHidden()||(this.opacities[ce]=_e,p=p||ge.text.placed||ge.icon.placed)}}for(var Fe in w)this.variableOffsets[Fe]||!this.opacities[Fe]||this.opacities[Fe].isHidden()||(this.variableOffsets[Fe]=w[Fe]);for(var Pe in C)this.placedOrientations[Pe]||!this.opacities[Pe]||this.opacities[Pe].isHidden()||(this.placedOrientations[Pe]=C[Pe]);p?this.lastPlacementChangeTime=h:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:h)},yn.prototype.updateLayerOpacities=function(h,d){for(var p={},g=0,S=d;g<S.length;g+=1){var w=S[g],C=w.getBucket(h);C&&w.latestFeatureIndex&&h.id===C.layerIds[0]&&this.updateBucketOpacities(C,p,w.collisionBoxArray)}},yn.prototype.updateBucketOpacities=function(h,d,p){var g=this;h.hasTextData()&&h.text.opacityVertexArray.clear(),h.hasIconData()&&h.icon.opacityVertexArray.clear(),h.hasIconCollisionBoxData()&&h.iconCollisionBox.collisionVertexArray.clear(),h.hasTextCollisionBoxData()&&h.textCollisionBox.collisionVertexArray.clear();var S=h.layers[0].layout,w=new Vo(null,0,!1,!1,!0),C=S.get("text-allow-overlap"),P=S.get("icon-allow-overlap"),Z=S.get("text-variable-anchor"),Y=S.get("text-rotation-alignment")==="map",ce=S.get("text-pitch-alignment")==="map",ge=S.get("icon-text-fit")!=="none",_e=new Vo(null,0,C&&(P||!h.hasIconData()||S.get("icon-optional")),P&&(C||!h.hasTextData()||S.get("text-optional")),!0);!h.collisionArrays&&p&&(h.hasIconCollisionBoxData()||h.hasTextCollisionBoxData())&&h.deserializeCollisionBoxes(p);for(var Fe=function(Ge,ct,At){for(var $t=0;$t<ct/4;$t++)Ge.opacityVertexArray.emplaceBack(At)},Pe=function(Ge){var ct=h.symbolInstances.get(Ge),At=ct.numHorizontalGlyphVertices,$t=ct.numVerticalGlyphVertices,Nt=ct.crossTileID,tr=g.opacities[Nt];d[Nt]?tr=w:tr||(g.opacities[Nt]=tr=_e),d[Nt]=!0;var mr=ct.numIconVertices>0,Nr=g.placedOrientations[ct.crossTileID],Fr=Nr===_.WritingMode.vertical,an=Nr===_.WritingMode.horizontal||Nr===_.WritingMode.horizontalOnly;if(At>0||$t>0){var In=Ao(tr.text);Fe(h.text,At,Fr?uo:In),Fe(h.text,$t,an?uo:In);var Nn=tr.text.isHidden();[ct.rightJustifiedTextSymbolIndex,ct.centerJustifiedTextSymbolIndex,ct.leftJustifiedTextSymbolIndex].forEach(function($n){$n>=0&&(h.text.placedSymbolArray.get($n).hidden=Nn||Fr?1:0)}),ct.verticalPlacedTextSymbolIndex>=0&&(h.text.placedSymbolArray.get(ct.verticalPlacedTextSymbolIndex).hidden=Nn||an?1:0);var Un=g.variableOffsets[ct.crossTileID];Un&&g.markUsedJustification(h,Un.anchor,ct,Nr);var ji=g.placedOrientations[ct.crossTileID];ji&&(g.markUsedJustification(h,"left",ct,ji),g.markUsedOrientation(h,ji,ct))}if(mr){var hn=Ao(tr.icon),Kn=!(ge&&ct.verticalPlacedIconSymbolIndex&&Fr);ct.placedIconSymbolIndex>=0&&(Fe(h.icon,ct.numIconVertices,Kn?hn:uo),h.icon.placedSymbolArray.get(ct.placedIconSymbolIndex).hidden=tr.icon.isHidden()),ct.verticalPlacedIconSymbolIndex>=0&&(Fe(h.icon,ct.numVerticalIconVertices,Kn?uo:hn),h.icon.placedSymbolArray.get(ct.verticalPlacedIconSymbolIndex).hidden=tr.icon.isHidden())}if(h.hasIconCollisionBoxData()||h.hasTextCollisionBoxData()){var _i=h.collisionArrays[Ge];if(_i){var ti=new _.Point(0,0);if(_i.textBox||_i.verticalTextBox){var Xn=!0;if(Z){var pi=g.variableOffsets[Nt];pi?(ti=Qi(pi.anchor,pi.width,pi.height,pi.textOffset,pi.textBoxScale),Y&&ti._rotate(ce?g.transform.angle:-g.transform.angle)):Xn=!1}_i.textBox&&fe(h.textCollisionBox.collisionVertexArray,tr.text.placed,!Xn||Fr,ti.x,ti.y),_i.verticalTextBox&&fe(h.textCollisionBox.collisionVertexArray,tr.text.placed,!Xn||an,ti.x,ti.y)}var qn=!!(!an&&_i.verticalIconBox);_i.iconBox&&fe(h.iconCollisionBox.collisionVertexArray,tr.icon.placed,qn,ge?ti.x:0,ge?ti.y:0),_i.verticalIconBox&&fe(h.iconCollisionBox.collisionVertexArray,tr.icon.placed,!qn,ge?ti.x:0,ge?ti.y:0)}}},Xe=0;Xe<h.symbolInstances.length;Xe++)Pe(Xe);if(h.sortFeatures(this.transform.angle),this.retainedQueryData[h.bucketInstanceId]&&(this.retainedQueryData[h.bucketInstanceId].featureSortOrder=h.featureSortOrder),h.hasTextData()&&h.text.opacityVertexBuffer&&h.text.opacityVertexBuffer.updateData(h.text.opacityVertexArray),h.hasIconData()&&h.icon.opacityVertexBuffer&&h.icon.opacityVertexBuffer.updateData(h.icon.opacityVertexArray),h.hasIconCollisionBoxData()&&h.iconCollisionBox.collisionVertexBuffer&&h.iconCollisionBox.collisionVertexBuffer.updateData(h.iconCollisionBox.collisionVertexArray),h.hasTextCollisionBoxData()&&h.textCollisionBox.collisionVertexBuffer&&h.textCollisionBox.collisionVertexBuffer.updateData(h.textCollisionBox.collisionVertexArray),h.bucketInstanceId in this.collisionCircleArrays){var we=this.collisionCircleArrays[h.bucketInstanceId];h.placementInvProjMatrix=we.invProjMatrix,h.placementViewportMatrix=we.viewportMatrix,h.collisionCircleArray=we.circles,delete this.collisionCircleArrays[h.bucketInstanceId]}},yn.prototype.symbolFadeChange=function(h){return this.fadeDuration===0?1:(h-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},yn.prototype.zoomAdjustment=function(h){return Math.max(0,(this.transform.zoom-h)/1.5)},yn.prototype.hasTransitions=function(h){return this.stale||h-this.lastPlacementChangeTime<this.fadeDuration},yn.prototype.stillRecent=function(h,d){var p=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*p>h},yn.prototype.setStale=function(){this.stale=!0};var Te=Math.pow(2,25),ot=Math.pow(2,24),nr=Math.pow(2,17),jr=Math.pow(2,16),Mn=Math.pow(2,9),Vi=Math.pow(2,8),ho=Math.pow(2,1);function Ao(h){if(h.opacity===0&&!h.placed)return 0;if(h.opacity===1&&h.placed)return 4294967295;var d=h.placed?1:0,p=Math.floor(127*h.opacity);return p*Te+d*ot+p*nr+d*jr+p*Mn+d*Vi+p*ho+d}var uo=0,Is=function(h){this._sortAcrossTiles=h.layout.get("symbol-z-order")!=="viewport-y"&&h.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};Is.prototype.continuePlacement=function(h,d,p,g,S){for(var w=this._bucketParts;this._currentTileIndex<h.length;)if(d.getBucketParts(w,g,h[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,S())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort(function(C,P){return C.sortKey-P.sortKey}));this._currentPartIndex<w.length;)if(d.placeLayerBucketPart(w[this._currentPartIndex],this._seenCrossTileIDs,p),this._currentPartIndex++,S())return!0;return!1};var ys=function(h,d,p,g,S,w,C){this.placement=new yn(h,S,w,C),this._currentPlacementIndex=d.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=g,this._done=!1};ys.prototype.isDone=function(){return this._done},ys.prototype.continuePlacement=function(h,d,p){for(var g=this,S=_.browser.now(),w=function(){var Z=_.browser.now()-S;return!g._forceFullPlacement&&Z>2};this._currentPlacementIndex>=0;){var C=d[h[this._currentPlacementIndex]],P=this.placement.collisionIndex.transform.zoom;if(C.type==="symbol"&&(!C.minzoom||C.minzoom<=P)&&(!C.maxzoom||C.maxzoom>P)){if(this._inProgressLayer||(this._inProgressLayer=new Is(C)),this._inProgressLayer.continuePlacement(p[C.source],this.placement,this._showCollisionBoxes,C,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},ys.prototype.commit=function(h){return this.placement.commit(h),this.placement};var Kh=512/_.EXTENT/2,Cf=function(h,d,p){this.tileID=h,this.indexedSymbolInstances={},this.bucketInstanceId=p;for(var g=0;g<d.length;g++){var S=d.get(g),w=S.key;this.indexedSymbolInstances[w]||(this.indexedSymbolInstances[w]=[]),this.indexedSymbolInstances[w].push({crossTileID:S.crossTileID,coord:this.getScaledCoordinates(S,h)})}};Cf.prototype.getScaledCoordinates=function(h,d){var p=Kh/Math.pow(2,d.canonical.z-this.tileID.canonical.z);return{x:Math.floor((d.canonical.x*_.EXTENT+h.anchorX)*p),y:Math.floor((d.canonical.y*_.EXTENT+h.anchorY)*p)}},Cf.prototype.findMatches=function(h,d,p){for(var g=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z),S=0;S<h.length;S++){var w=h.get(S);if(!w.crossTileID){var C=this.indexedSymbolInstances[w.key];if(C)for(var P=this.getScaledCoordinates(w,d),Z=0,Y=C;Z<Y.length;Z+=1){var ce=Y[Z];if(Math.abs(ce.coord.x-P.x)<=g&&Math.abs(ce.coord.y-P.y)<=g&&!p[ce.crossTileID]){p[ce.crossTileID]=!0,w.crossTileID=ce.crossTileID;break}}}}};var jo=function(){this.maxCrossTileID=0};jo.prototype.generate=function(){return++this.maxCrossTileID};var xl=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};xl.prototype.handleWrapJump=function(h){var d=Math.round((h-this.lng)/360);if(d!==0)for(var p in this.indexes){var g=this.indexes[p],S={};for(var w in g){var C=g[w];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+d),S[C.tileID.key]=C}this.indexes[p]=S}this.lng=h},xl.prototype.addBucket=function(h,d,p){if(this.indexes[h.overscaledZ]&&this.indexes[h.overscaledZ][h.key]){if(this.indexes[h.overscaledZ][h.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(h.overscaledZ,this.indexes[h.overscaledZ][h.key])}for(var g=0;g<d.symbolInstances.length;g++)d.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[h.overscaledZ]||(this.usedCrossTileIDs[h.overscaledZ]={});var S=this.usedCrossTileIDs[h.overscaledZ];for(var w in this.indexes){var C=this.indexes[w];if(Number(w)>h.overscaledZ)for(var P in C){var Z=C[P];Z.tileID.isChildOf(h)&&Z.findMatches(d.symbolInstances,h,S)}else{var Y=C[h.scaledTo(Number(w)).key];Y&&Y.findMatches(d.symbolInstances,h,S)}}for(var ce=0;ce<d.symbolInstances.length;ce++){var ge=d.symbolInstances.get(ce);ge.crossTileID||(ge.crossTileID=p.generate(),S[ge.crossTileID]=!0)}return this.indexes[h.overscaledZ]===void 0&&(this.indexes[h.overscaledZ]={}),this.indexes[h.overscaledZ][h.key]=new Cf(h,d.symbolInstances,d.bucketInstanceId),!0},xl.prototype.removeBucketCrossTileIDs=function(h,d){for(var p in d.indexedSymbolInstances)for(var g=0,S=d.indexedSymbolInstances[p];g<S.length;g+=1)delete this.usedCrossTileIDs[h][S[g].crossTileID]},xl.prototype.removeStaleBuckets=function(h){var d=!1;for(var p in this.indexes){var g=this.indexes[p];for(var S in g)h[g[S].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,g[S]),delete g[S],d=!0)}return d};var bl=function(){this.layerIndexes={},this.crossTileIDs=new jo,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};bl.prototype.addLayer=function(h,d,p){var g=this.layerIndexes[h.id];g===void 0&&(g=this.layerIndexes[h.id]=new xl);var S=!1,w={};g.handleWrapJump(p);for(var C=0,P=d;C<P.length;C+=1){var Z=P[C],Y=Z.getBucket(h);Y&&h.id===Y.layerIds[0]&&(Y.bucketInstanceId||(Y.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket(Z.tileID,Y,this.crossTileIDs)&&(S=!0),w[Y.bucketInstanceId]=!0)}return g.removeStaleBuckets(w)&&(S=!0),S},bl.prototype.pruneUnusedLayers=function(h){var d={};for(var p in h.forEach(function(g){d[g]=!0}),this.layerIndexes)d[p]||delete this.layerIndexes[p]};var Mu=function(h,d){return _.emitValidationErrors(h,d&&d.filter(function(p){return p.identifier!=="source.canvas"}))},Iu=_.pick($r,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Qu=_.pick($r,["setCenter","setZoom","setBearing","setPitch"]),Qc=function(){var h={},d=_.styleSpec.$version;for(var p in _.styleSpec.$root){var g,S=_.styleSpec.$root[p];S.required&&(g=p==="version"?d:S.type==="array"?[]:{})!=null&&(h[p]=g)}return h}(),Ps=function(h){function d(p,g){var S=this;g===void 0&&(g={}),h.call(this),this.map=p,this.dispatcher=new qt(ar(),this),this.imageManager=new Ht,this.imageManager.setEventedParent(this),this.glyphManager=new ur(p._requestManager,g.localIdeographFontFamily),this.lineAtlas=new ft(256,512),this.crossTileSymbolIndex=new bl,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new _.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",_.getReferrer());var w=this;this._rtlTextPluginCallback=d.registerForPluginStateChange(function(C){w.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:C.pluginStatus,pluginURL:C.pluginURL},function(P,Z){if(_.triggerPluginCompletionEvent(P),Z&&Z.every(function(ce){return ce}))for(var Y in w.sourceCaches)w.sourceCaches[Y].reload()})}),this.on("data",function(C){if(C.dataType==="source"&&C.sourceDataType==="metadata"){var P=S.sourceCaches[C.sourceId];if(P){var Z=P.getSource();if(Z&&Z.vectorLayerIds)for(var Y in S._layers){var ce=S._layers[Y];ce.source===Z.id&&S._validateLayer(ce)}}}})}return h&&(d.__proto__=h),(d.prototype=Object.create(h&&h.prototype)).constructor=d,d.prototype.loadURL=function(p,g){var S=this;g===void 0&&(g={}),this.fire(new _.Event("dataloading",{dataType:"style"}));var w=typeof g.validate=="boolean"?g.validate:!_.isMapboxURL(p);p=this.map._requestManager.normalizeStyleURL(p,g.accessToken);var C=this.map._requestManager.transformRequest(p,_.ResourceType.Style);this._request=_.getJSON(C,function(P,Z){S._request=null,P?S.fire(new _.ErrorEvent(P)):Z&&S._load(Z,w)})},d.prototype.loadJSON=function(p,g){var S=this;g===void 0&&(g={}),this.fire(new _.Event("dataloading",{dataType:"style"})),this._request=_.browser.frame(function(){S._request=null,S._load(p,g.validate!==!1)})},d.prototype.loadEmpty=function(){this.fire(new _.Event("dataloading",{dataType:"style"})),this._load(Qc,!1)},d.prototype._load=function(p,g){if(!g||!Mu(this,_.validateStyle(p))){for(var S in this._loaded=!0,this.stylesheet=p,p.sources)this.addSource(S,p.sources[S],{validate:!1});p.sprite?this._loadSprite(p.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(p.glyphs);var w=Hr(this.stylesheet.layers);this._order=w.map(function(Y){return Y.id}),this._layers={},this._serializedLayers={};for(var C=0,P=w;C<P.length;C+=1){var Z=P[C];(Z=_.createStyleLayer(Z)).setEventedParent(this,{layer:{id:Z.id}}),this._layers[Z.id]=Z,this._serializedLayers[Z.id]=Z.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Pt(this.stylesheet.light),this.fire(new _.Event("data",{dataType:"style"})),this.fire(new _.Event("style.load"))}},d.prototype._loadSprite=function(p){var g=this;this._spriteRequest=function(S,w,C){var P,Z,Y,ce=_.browser.devicePixelRatio>1?"@2x":"",ge=_.getJSON(w.transformRequest(w.normalizeSpriteURL(S,ce,".json"),_.ResourceType.SpriteJSON),function(Pe,Xe){ge=null,Y||(Y=Pe,P=Xe,Fe())}),_e=_.getImage(w.transformRequest(w.normalizeSpriteURL(S,ce,".png"),_.ResourceType.SpriteImage),function(Pe,Xe){_e=null,Y||(Y=Pe,Z=Xe,Fe())});function Fe(){if(Y)C(Y);else if(P&&Z){var Pe=_.browser.getImageData(Z),Xe={};for(var we in P){var Ge=P[we],ct=Ge.width,At=Ge.height,$t=Ge.x,Nt=Ge.y,tr=Ge.sdf,mr=Ge.pixelRatio,Nr=Ge.stretchX,Fr=Ge.stretchY,an=Ge.content,In=new _.RGBAImage({width:ct,height:At});_.RGBAImage.copy(Pe,In,{x:$t,y:Nt},{x:0,y:0},{width:ct,height:At}),Xe[we]={data:In,pixelRatio:mr,sdf:tr,stretchX:Nr,stretchY:Fr,content:an}}C(null,Xe)}}return{cancel:function(){ge&&(ge.cancel(),ge=null),_e&&(_e.cancel(),_e=null)}}}(p,this.map._requestManager,function(S,w){if(g._spriteRequest=null,S)g.fire(new _.ErrorEvent(S));else if(w)for(var C in w)g.imageManager.addImage(C,w[C]);g.imageManager.setLoaded(!0),g._availableImages=g.imageManager.listImages(),g.dispatcher.broadcast("setImages",g._availableImages),g.fire(new _.Event("data",{dataType:"style"}))})},d.prototype._validateLayer=function(p){var g=this.sourceCaches[p.source];if(g){var S=p.sourceLayer;if(S){var w=g.getSource();(w.type==="geojson"||w.vectorLayerIds&&w.vectorLayerIds.indexOf(S)===-1)&&this.fire(new _.ErrorEvent(new Error('Source layer "'+S+'" does not exist on source "'+w.id+'" as specified by style layer "'+p.id+'"')))}}},d.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var p in this.sourceCaches)if(!this.sourceCaches[p].loaded())return!1;return!!this.imageManager.isLoaded()},d.prototype._serializeLayers=function(p){for(var g=[],S=0,w=p;S<w.length;S+=1){var C=this._layers[w[S]];C.type!=="custom"&&g.push(C.serialize())}return g},d.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var p in this.sourceCaches)if(this.sourceCaches[p].hasTransition())return!0;for(var g in this._layers)if(this._layers[g].hasTransition())return!0;return!1},d.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},d.prototype.update=function(p){if(this._loaded){var g=this._changed;if(this._changed){var S=Object.keys(this._updatedLayers),w=Object.keys(this._removedLayers);for(var C in(S.length||w.length)&&this._updateWorkerLayers(S,w),this._updatedSources){var P=this._updatedSources[C];P==="reload"?this._reloadSource(C):P==="clear"&&this._clearSource(C)}for(var Z in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[Z].updateTransitions(p);this.light.updateTransitions(p),this._resetUpdates()}var Y={};for(var ce in this.sourceCaches){var ge=this.sourceCaches[ce];Y[ce]=ge.used,ge.used=!1}for(var _e=0,Fe=this._order;_e<Fe.length;_e+=1){var Pe=this._layers[Fe[_e]];Pe.recalculate(p,this._availableImages),!Pe.isHidden(p.zoom)&&Pe.source&&(this.sourceCaches[Pe.source].used=!0)}for(var Xe in Y){var we=this.sourceCaches[Xe];Y[Xe]!==we.used&&we.fire(new _.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:Xe}))}this.light.recalculate(p),this.z=p.zoom,g&&this.fire(new _.Event("data",{dataType:"style"}))}},d.prototype._updateTilesForChangedImages=function(){var p=Object.keys(this._changedImages);if(p.length){for(var g in this.sourceCaches)this.sourceCaches[g].reloadTilesForDependencies(["icons","patterns"],p);this._changedImages={}}},d.prototype._updateWorkerLayers=function(p,g){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(p),removedIds:g})},d.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},d.prototype.setState=function(p){var g=this;if(this._checkLoaded(),Mu(this,_.validateStyle(p)))return!1;(p=_.clone$1(p)).layers=Hr(p.layers);var S=function(C,P){if(!C)return[{command:$r.setStyle,args:[P]}];var Z=[];try{if(!_.deepEqual(C.version,P.version))return[{command:$r.setStyle,args:[P]}];_.deepEqual(C.center,P.center)||Z.push({command:$r.setCenter,args:[P.center]}),_.deepEqual(C.zoom,P.zoom)||Z.push({command:$r.setZoom,args:[P.zoom]}),_.deepEqual(C.bearing,P.bearing)||Z.push({command:$r.setBearing,args:[P.bearing]}),_.deepEqual(C.pitch,P.pitch)||Z.push({command:$r.setPitch,args:[P.pitch]}),_.deepEqual(C.sprite,P.sprite)||Z.push({command:$r.setSprite,args:[P.sprite]}),_.deepEqual(C.glyphs,P.glyphs)||Z.push({command:$r.setGlyphs,args:[P.glyphs]}),_.deepEqual(C.transition,P.transition)||Z.push({command:$r.setTransition,args:[P.transition]}),_.deepEqual(C.light,P.light)||Z.push({command:$r.setLight,args:[P.light]});var Y={},ce=[];(function(_e,Fe,Pe,Xe){var we;for(we in Fe=Fe||{},_e=_e||{})_e.hasOwnProperty(we)&&(Fe.hasOwnProperty(we)||Qr(we,Pe,Xe));for(we in Fe)Fe.hasOwnProperty(we)&&(_e.hasOwnProperty(we)?_.deepEqual(_e[we],Fe[we])||(_e[we].type==="geojson"&&Fe[we].type==="geojson"&&Yi(_e,Fe,we)?Pe.push({command:$r.setGeoJSONSourceData,args:[we,Fe[we].data]}):vi(we,Fe,Pe,Xe)):hi(we,Fe,Pe))})(C.sources,P.sources,ce,Y);var ge=[];C.layers&&C.layers.forEach(function(_e){Y[_e.source]?Z.push({command:$r.removeLayer,args:[_e.id]}):ge.push(_e)}),Z=Z.concat(ce),function(_e,Fe,Pe){Fe=Fe||[];var Xe,we,Ge,ct,At,$t,Nt,tr=(_e=_e||[]).map(Li),mr=Fe.map(Li),Nr=_e.reduce(Si,{}),Fr=Fe.reduce(Si,{}),an=tr.slice(),In=Object.create(null);for(Xe=0,we=0;Xe<tr.length;Xe++)Fr.hasOwnProperty(Ge=tr[Xe])?we++:(Pe.push({command:$r.removeLayer,args:[Ge]}),an.splice(an.indexOf(Ge,we),1));for(Xe=0,we=0;Xe<mr.length;Xe++)an[an.length-1-Xe]!==(Ge=mr[mr.length-1-Xe])&&(Nr.hasOwnProperty(Ge)?(Pe.push({command:$r.removeLayer,args:[Ge]}),an.splice(an.lastIndexOf(Ge,an.length-we),1)):we++,Pe.push({command:$r.addLayer,args:[Fr[Ge],$t=an[an.length-Xe]]}),an.splice(an.length-Xe,0,Ge),In[Ge]=!0);for(Xe=0;Xe<mr.length;Xe++)if(ct=Nr[Ge=mr[Xe]],At=Fr[Ge],!In[Ge]&&!_.deepEqual(ct,At))if(_.deepEqual(ct.source,At.source)&&_.deepEqual(ct["source-layer"],At["source-layer"])&&_.deepEqual(ct.type,At.type)){for(Nt in ci(ct.layout,At.layout,Pe,Ge,null,$r.setLayoutProperty),ci(ct.paint,At.paint,Pe,Ge,null,$r.setPaintProperty),_.deepEqual(ct.filter,At.filter)||Pe.push({command:$r.setFilter,args:[Ge,At.filter]}),_.deepEqual(ct.minzoom,At.minzoom)&&_.deepEqual(ct.maxzoom,At.maxzoom)||Pe.push({command:$r.setLayerZoomRange,args:[Ge,At.minzoom,At.maxzoom]}),ct)ct.hasOwnProperty(Nt)&&Nt!=="layout"&&Nt!=="paint"&&Nt!=="filter"&&Nt!=="metadata"&&Nt!=="minzoom"&&Nt!=="maxzoom"&&(Nt.indexOf("paint.")===0?ci(ct[Nt],At[Nt],Pe,Ge,Nt.slice(6),$r.setPaintProperty):_.deepEqual(ct[Nt],At[Nt])||Pe.push({command:$r.setLayerProperty,args:[Ge,Nt,At[Nt]]}));for(Nt in At)At.hasOwnProperty(Nt)&&!ct.hasOwnProperty(Nt)&&Nt!=="layout"&&Nt!=="paint"&&Nt!=="filter"&&Nt!=="metadata"&&Nt!=="minzoom"&&Nt!=="maxzoom"&&(Nt.indexOf("paint.")===0?ci(ct[Nt],At[Nt],Pe,Ge,Nt.slice(6),$r.setPaintProperty):_.deepEqual(ct[Nt],At[Nt])||Pe.push({command:$r.setLayerProperty,args:[Ge,Nt,At[Nt]]}))}else Pe.push({command:$r.removeLayer,args:[Ge]}),$t=an[an.lastIndexOf(Ge)+1],Pe.push({command:$r.addLayer,args:[At,$t]})}(ge,P.layers,Z)}catch(_e){console.warn("Unable to compute style diff:",_e),Z=[{command:$r.setStyle,args:[P]}]}return Z}(this.serialize(),p).filter(function(C){return!(C.command in Qu)});if(S.length===0)return!1;var w=S.filter(function(C){return!(C.command in Iu)});if(w.length>0)throw new Error("Unimplemented: "+w.map(function(C){return C.command}).join(", ")+".");return S.forEach(function(C){C.command!=="setTransition"&&g[C.command].apply(g,C.args)}),this.stylesheet=p,!0},d.prototype.addImage=function(p,g){if(this.getImage(p))return this.fire(new _.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(p,g),this._afterImageUpdated(p)},d.prototype.updateImage=function(p,g){this.imageManager.updateImage(p,g)},d.prototype.getImage=function(p){return this.imageManager.getImage(p)},d.prototype.removeImage=function(p){if(!this.getImage(p))return this.fire(new _.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(p),this._afterImageUpdated(p)},d.prototype._afterImageUpdated=function(p){this._availableImages=this.imageManager.listImages(),this._changedImages[p]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new _.Event("data",{dataType:"style"}))},d.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},d.prototype.addSource=function(p,g,S){var w=this;if(S===void 0&&(S={}),this._checkLoaded(),this.sourceCaches[p]!==void 0)throw new Error("There is already a source with this ID");if(!g.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(g).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(g.type)>=0&&this._validate(_.validateStyle.source,"sources."+p,g,null,S))){this.map&&this.map._collectResourceTiming&&(g.collectResourceTiming=!0);var C=this.sourceCaches[p]=new q(p,g,this.dispatcher);C.style=this,C.setEventedParent(this,function(){return{isSourceLoaded:w.loaded(),source:C.serialize(),sourceId:p}}),C.onAdd(this.map),this._changed=!0}},d.prototype.removeSource=function(p){if(this._checkLoaded(),this.sourceCaches[p]===void 0)throw new Error("There is no source with this ID");for(var g in this._layers)if(this._layers[g].source===p)return this.fire(new _.ErrorEvent(new Error('Source "'+p+'" cannot be removed while layer "'+g+'" is using it.')));var S=this.sourceCaches[p];delete this.sourceCaches[p],delete this._updatedSources[p],S.fire(new _.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:p})),S.setEventedParent(null),S.clearTiles(),S.onRemove&&S.onRemove(this.map),this._changed=!0},d.prototype.setGeoJSONSourceData=function(p,g){this._checkLoaded(),this.sourceCaches[p].getSource().setData(g),this._changed=!0},d.prototype.getSource=function(p){return this.sourceCaches[p]&&this.sourceCaches[p].getSource()},d.prototype.addLayer=function(p,g,S){S===void 0&&(S={}),this._checkLoaded();var w=p.id;if(this.getLayer(w))this.fire(new _.ErrorEvent(new Error('Layer with id "'+w+'" already exists on this map')));else{var C;if(p.type==="custom"){if(Mu(this,_.validateCustomStyleLayer(p)))return;C=_.createStyleLayer(p)}else{if(typeof p.source=="object"&&(this.addSource(w,p.source),p=_.clone$1(p),p=_.extend(p,{source:w})),this._validate(_.validateStyle.layer,"layers."+w,p,{arrayIndex:-1},S))return;C=_.createStyleLayer(p),this._validateLayer(C),C.setEventedParent(this,{layer:{id:w}}),this._serializedLayers[C.id]=C.serialize()}var P=g?this._order.indexOf(g):this._order.length;if(g&&P===-1)this.fire(new _.ErrorEvent(new Error('Layer with id "'+g+'" does not exist on this map.')));else{if(this._order.splice(P,0,w),this._layerOrderChanged=!0,this._layers[w]=C,this._removedLayers[w]&&C.source&&C.type!=="custom"){var Z=this._removedLayers[w];delete this._removedLayers[w],Z.type!==C.type?this._updatedSources[C.source]="clear":(this._updatedSources[C.source]="reload",this.sourceCaches[C.source].pause())}this._updateLayer(C),C.onAdd&&C.onAdd(this.map)}}},d.prototype.moveLayer=function(p,g){if(this._checkLoaded(),this._changed=!0,this._layers[p]){if(p!==g){var S=this._order.indexOf(p);this._order.splice(S,1);var w=g?this._order.indexOf(g):this._order.length;g&&w===-1?this.fire(new _.ErrorEvent(new Error('Layer with id "'+g+'" does not exist on this map.'))):(this._order.splice(w,0,p),this._layerOrderChanged=!0)}}else this.fire(new _.ErrorEvent(new Error("The layer '"+p+"' does not exist in the map's style and cannot be moved.")))},d.prototype.removeLayer=function(p){this._checkLoaded();var g=this._layers[p];if(g){g.setEventedParent(null);var S=this._order.indexOf(p);this._order.splice(S,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[p]=g,delete this._layers[p],delete this._serializedLayers[p],delete this._updatedLayers[p],delete this._updatedPaintProps[p],g.onRemove&&g.onRemove(this.map)}else this.fire(new _.ErrorEvent(new Error("The layer '"+p+"' does not exist in the map's style and cannot be removed.")))},d.prototype.getLayer=function(p){return this._layers[p]},d.prototype.hasLayer=function(p){return p in this._layers},d.prototype.setLayerZoomRange=function(p,g,S){this._checkLoaded();var w=this.getLayer(p);w?w.minzoom===g&&w.maxzoom===S||(g!=null&&(w.minzoom=g),S!=null&&(w.maxzoom=S),this._updateLayer(w)):this.fire(new _.ErrorEvent(new Error("The layer '"+p+"' does not exist in the map's style and cannot have zoom extent.")))},d.prototype.setFilter=function(p,g,S){S===void 0&&(S={}),this._checkLoaded();var w=this.getLayer(p);if(w){if(!_.deepEqual(w.filter,g))return g==null?(w.filter=void 0,void this._updateLayer(w)):void(this._validate(_.validateStyle.filter,"layers."+w.id+".filter",g,null,S)||(w.filter=_.clone$1(g),this._updateLayer(w)))}else this.fire(new _.ErrorEvent(new Error("The layer '"+p+"' does not exist in the map's style and cannot be filtered.")))},d.prototype.getFilter=function(p){return _.clone$1(this.getLayer(p).filter)},d.prototype.setLayoutProperty=function(p,g,S,w){w===void 0&&(w={}),this._checkLoaded();var C=this.getLayer(p);C?_.deepEqual(C.getLayoutProperty(g),S)||(C.setLayoutProperty(g,S,w),this._updateLayer(C)):this.fire(new _.ErrorEvent(new Error("The layer '"+p+"' does not exist in the map's style and cannot be styled.")))},d.prototype.getLayoutProperty=function(p,g){var S=this.getLayer(p);if(S)return S.getLayoutProperty(g);this.fire(new _.ErrorEvent(new Error("The layer '"+p+"' does not exist in the map's style.")))},d.prototype.setPaintProperty=function(p,g,S,w){w===void 0&&(w={}),this._checkLoaded();var C=this.getLayer(p);C?_.deepEqual(C.getPaintProperty(g),S)||(C.setPaintProperty(g,S,w)&&this._updateLayer(C),this._changed=!0,this._updatedPaintProps[p]=!0):this.fire(new _.ErrorEvent(new Error("The layer '"+p+"' does not exist in the map's style and cannot be styled.")))},d.prototype.getPaintProperty=function(p,g){return this.getLayer(p).getPaintProperty(g)},d.prototype.setFeatureState=function(p,g){this._checkLoaded();var S=p.source,w=p.sourceLayer,C=this.sourceCaches[S];if(C!==void 0){var P=C.getSource().type;P==="geojson"&&w?this.fire(new _.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):P!=="vector"||w?(p.id===void 0&&this.fire(new _.ErrorEvent(new Error("The feature id parameter must be provided."))),C.setFeatureState(w,p.id,g)):this.fire(new _.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new _.ErrorEvent(new Error("The source '"+S+"' does not exist in the map's style.")))},d.prototype.removeFeatureState=function(p,g){this._checkLoaded();var S=p.source,w=this.sourceCaches[S];if(w!==void 0){var C=w.getSource().type,P=C==="vector"?p.sourceLayer:void 0;C!=="vector"||P?g&&typeof p.id!="string"&&typeof p.id!="number"?this.fire(new _.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):w.removeFeatureState(P,p.id,g):this.fire(new _.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new _.ErrorEvent(new Error("The source '"+S+"' does not exist in the map's style.")))},d.prototype.getFeatureState=function(p){this._checkLoaded();var g=p.source,S=p.sourceLayer,w=this.sourceCaches[g];if(w!==void 0){if(w.getSource().type!=="vector"||S)return p.id===void 0&&this.fire(new _.ErrorEvent(new Error("The feature id parameter must be provided."))),w.getFeatureState(S,p.id);this.fire(new _.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new _.ErrorEvent(new Error("The source '"+g+"' does not exist in the map's style.")))},d.prototype.getTransition=function(){return _.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},d.prototype.serialize=function(){return _.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:_.mapObject(this.sourceCaches,function(p){return p.serialize()}),layers:this._serializeLayers(this._order)},function(p){return p!==void 0})},d.prototype._updateLayer=function(p){this._updatedLayers[p.id]=!0,p.source&&!this._updatedSources[p.source]&&this.sourceCaches[p.source].getSource().type!=="raster"&&(this._updatedSources[p.source]="reload",this.sourceCaches[p.source].pause()),this._changed=!0},d.prototype._flattenAndSortRenderedFeatures=function(p){for(var g=this,S=function(Nr){return g._layers[Nr].type==="fill-extrusion"},w={},C=[],P=this._order.length-1;P>=0;P--){var Z=this._order[P];if(S(Z)){w[Z]=P;for(var Y=0,ce=p;Y<ce.length;Y+=1){var ge=ce[Y][Z];if(ge)for(var _e=0,Fe=ge;_e<Fe.length;_e+=1)C.push(Fe[_e])}}}C.sort(function(Nr,Fr){return Fr.intersectionZ-Nr.intersectionZ});for(var Pe=[],Xe=this._order.length-1;Xe>=0;Xe--){var we=this._order[Xe];if(S(we))for(var Ge=C.length-1;Ge>=0;Ge--){var ct=C[Ge].feature;if(w[ct.layer.id]<Xe)break;Pe.push(ct),C.pop()}else for(var At=0,$t=p;At<$t.length;At+=1){var Nt=$t[At][we];if(Nt)for(var tr=0,mr=Nt;tr<mr.length;tr+=1)Pe.push(mr[tr].feature)}}return Pe},d.prototype.queryRenderedFeatures=function(p,g,S){g&&g.filter&&this._validate(_.validateStyle.filter,"queryRenderedFeatures.filter",g.filter,null,g);var w={};if(g&&g.layers){if(!Array.isArray(g.layers))return this.fire(new _.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var C=0,P=g.layers;C<P.length;C+=1){var Z=P[C],Y=this._layers[Z];if(!Y)return this.fire(new _.ErrorEvent(new Error("The layer '"+Z+"' does not exist in the map's style and cannot be queried for features."))),[];w[Y.source]=!0}}var ce=[];for(var ge in g.availableImages=this._availableImages,this.sourceCaches)g.layers&&!w[ge]||ce.push(lr(this.sourceCaches[ge],this._layers,this._serializedLayers,p,g,S));return this.placement&&ce.push(function(_e,Fe,Pe,Xe,we,Ge,ct){for(var At={},$t=Ge.queryRenderedSymbols(Xe),Nt=[],tr=0,mr=Object.keys($t).map(Number);tr<mr.length;tr+=1)Nt.push(ct[mr[tr]]);Nt.sort(Cn);for(var Nr=function(){var Un=an[Fr],ji=Un.featureIndex.lookupSymbolFeatures($t[Un.bucketInstanceId],Fe,Un.bucketIndex,Un.sourceLayerIndex,we.filter,we.layers,we.availableImages,_e);for(var hn in ji){var Kn=At[hn]=At[hn]||[],_i=ji[hn];_i.sort(function(pi,qn){var $n=Un.featureSortOrder;if($n){var wo=$n.indexOf(pi.featureIndex);return $n.indexOf(qn.featureIndex)-wo}return qn.featureIndex-pi.featureIndex});for(var ti=0,Xn=_i;ti<Xn.length;ti+=1)Kn.push(Xn[ti])}},Fr=0,an=Nt;Fr<an.length;Fr+=1)Nr();var In=function(Un){At[Un].forEach(function(ji){var hn=ji.feature,Kn=Pe[_e[Un].source].getFeatureState(hn.layer["source-layer"],hn.id);hn.source=hn.layer.source,hn.layer["source-layer"]&&(hn.sourceLayer=hn.layer["source-layer"]),hn.state=Kn})};for(var Nn in At)In(Nn);return At}(this._layers,this._serializedLayers,this.sourceCaches,p,g,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(ce)},d.prototype.querySourceFeatures=function(p,g){g&&g.filter&&this._validate(_.validateStyle.filter,"querySourceFeatures.filter",g.filter,null,g);var S=this.sourceCaches[p];return S?function(w,C){for(var P=w.getRenderableIds().map(function(Fe){return w.getTileByID(Fe)}),Z=[],Y={},ce=0;ce<P.length;ce++){var ge=P[ce],_e=ge.tileID.canonical.key;Y[_e]||(Y[_e]=!0,ge.querySourceFeatures(Z,C))}return Z}(S,g):[]},d.prototype.addSourceType=function(p,g,S){return d.getSourceType(p)?S(new Error('A source type called "'+p+'" already exists.')):(d.setSourceType(p,g),g.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:p,url:g.workerSourceURL},S):S(null,null))},d.prototype.getLight=function(){return this.light.getLight()},d.prototype.setLight=function(p,g){g===void 0&&(g={}),this._checkLoaded();var S=this.light.getLight(),w=!1;for(var C in p)if(!_.deepEqual(p[C],S[C])){w=!0;break}if(w){var P={now:_.browser.now(),transition:_.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(p,g),this.light.updateTransitions(P)}},d.prototype._validate=function(p,g,S,w,C){return C===void 0&&(C={}),(!C||C.validate!==!1)&&Mu(this,p.call(_.validateStyle,_.extend({key:g,style:this.serialize(),value:S,styleSpec:_.styleSpec},w)))},d.prototype._remove=function(){for(var p in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),_.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[p].setEventedParent(null);for(var g in this.sourceCaches)this.sourceCaches[g].clearTiles(),this.sourceCaches[g].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},d.prototype._clearSource=function(p){this.sourceCaches[p].clearTiles()},d.prototype._reloadSource=function(p){this.sourceCaches[p].resume(),this.sourceCaches[p].reload()},d.prototype._updateSources=function(p){for(var g in this.sourceCaches)this.sourceCaches[g].update(p)},d.prototype._generateCollisionBoxes=function(){for(var p in this.sourceCaches)this._reloadSource(p)},d.prototype._updatePlacement=function(p,g,S,w,C){C===void 0&&(C=!1);for(var P=!1,Z=!1,Y={},ce=0,ge=this._order;ce<ge.length;ce+=1){var _e=this._layers[ge[ce]];if(_e.type==="symbol"){if(!Y[_e.source]){var Fe=this.sourceCaches[_e.source];Y[_e.source]=Fe.getRenderableIds(!0).map(function(ct){return Fe.getTileByID(ct)}).sort(function(ct,At){return At.tileID.overscaledZ-ct.tileID.overscaledZ||(ct.tileID.isLessThan(At.tileID)?-1:1)})}var Pe=this.crossTileSymbolIndex.addLayer(_e,Y[_e.source],p.center.lng);P=P||Pe}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((C=C||this._layerOrderChanged||S===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(_.browser.now(),p.zoom))&&(this.pauseablePlacement=new ys(p,this._order,C,g,S,w,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,Y),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(_.browser.now()),Z=!0),P&&this.pauseablePlacement.placement.setStale()),Z||P)for(var Xe=0,we=this._order;Xe<we.length;Xe+=1){var Ge=this._layers[we[Xe]];Ge.type==="symbol"&&this.placement.updateLayerOpacities(Ge,Y[Ge.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(_.browser.now())},d.prototype._releaseSymbolFadeTiles=function(){for(var p in this.sourceCaches)this.sourceCaches[p].releaseSymbolFadeTiles()},d.prototype.getImages=function(p,g,S){this.imageManager.getImages(g.icons,S),this._updateTilesForChangedImages();var w=this.sourceCaches[g.source];w&&w.setDependencies(g.tileID.key,g.type,g.icons)},d.prototype.getGlyphs=function(p,g,S){this.glyphManager.getGlyphs(g.stacks,S)},d.prototype.getResource=function(p,g,S){return _.makeRequest(g,S)},d}(_.Evented);Ps.getSourceType=function(h){return Mt[h]},Ps.setSourceType=function(h,d){Mt[h]=d},Ps.registerForPluginStateChange=_.registerForPluginStateChange;var Ya=_.createLayout([{name:"a_pos",type:"Int16",components:2}]),El=Ci(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),Ju=Ci(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Rf=Ci(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),Qh=Ci(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),Mf=Ci("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),ph=Ci(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),dh=Ci(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),vh=Ci("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),Jh=Ci("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),ep=Ci("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),Zp=Ci(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),Jc=Ci(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),Pu=Ci(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),tp=Ci(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),Ho=Ci(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),Yl=Ci(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),Sl=Ci(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),Xs=Ci(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),Al=Ci(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),ii=Ci(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),el=Ci(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),Os=Ci(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),Ou=Ci(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),tl=Ci(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),rp=Ci(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),Ji=Ci(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function Ci(h,d){var p=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,g=d.match(/attribute ([\w]+) ([\w]+)/g),S=h.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=d.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),C=w?w.concat(S):S,P={};return{fragmentSource:h=h.replace(p,function(Z,Y,ce,ge,_e){return P[_e]=!0,Y==="define"?`
#ifndef HAS_UNIFORM_u_`+_e+`
varying `+ce+" "+ge+" "+_e+`;
#else
uniform `+ce+" "+ge+" u_"+_e+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+_e+`
    `+ce+" "+ge+" "+_e+" = u_"+_e+`;
#endif
`}),vertexSource:d=d.replace(p,function(Z,Y,ce,ge,_e){var Fe=ge==="float"?"vec2":"vec4",Pe=_e.match(/color/)?"color":Fe;return P[_e]?Y==="define"?`
#ifndef HAS_UNIFORM_u_`+_e+`
uniform lowp float u_`+_e+`_t;
attribute `+ce+" "+Fe+" a_"+_e+`;
varying `+ce+" "+ge+" "+_e+`;
#else
uniform `+ce+" "+ge+" u_"+_e+`;
#endif
`:Pe==="vec4"?`
#ifndef HAS_UNIFORM_u_`+_e+`
    `+_e+" = a_"+_e+`;
#else
    `+ce+" "+ge+" "+_e+" = u_"+_e+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+_e+`
    `+_e+" = unpack_mix_"+Pe+"(a_"+_e+", u_"+_e+`_t);
#else
    `+ce+" "+ge+" "+_e+" = u_"+_e+`;
#endif
`:Y==="define"?`
#ifndef HAS_UNIFORM_u_`+_e+`
uniform lowp float u_`+_e+`_t;
attribute `+ce+" "+Fe+" a_"+_e+`;
#else
uniform `+ce+" "+ge+" u_"+_e+`;
#endif
`:Pe==="vec4"?`
#ifndef HAS_UNIFORM_u_`+_e+`
    `+ce+" "+ge+" "+_e+" = a_"+_e+`;
#else
    `+ce+" "+ge+" "+_e+" = u_"+_e+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+_e+`
    `+ce+" "+ge+" "+_e+" = unpack_mix_"+Pe+"(a_"+_e+", u_"+_e+`_t);
#else
    `+ce+" "+ge+" "+_e+" = u_"+_e+`;
#endif
`}),staticAttributes:g,staticUniforms:C}}var fu=Object.freeze({__proto__:null,prelude:El,background:Ju,backgroundPattern:Rf,circle:Qh,clippingMask:Mf,heatmap:ph,heatmapTexture:dh,collisionBox:vh,collisionCircle:Jh,debug:ep,fill:Zp,fillOutline:Jc,fillOutlinePattern:Pu,fillPattern:tp,fillExtrusion:Ho,fillExtrusionPattern:Yl,hillshadePrepare:Sl,hillshade:Xs,line:Al,lineGradient:ii,linePattern:el,lineSDF:Os,raster:Ou,symbolIcon:tl,symbolSDF:rp,symbolTextAndIcon:Ji}),Du=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function mh(h){for(var d=[],p=0;p<h.length;p++)if(h[p]!==null){var g=h[p].split(" ");d.push(g.pop())}return d}Du.prototype.bind=function(h,d,p,g,S,w,C,P){this.context=h;for(var Z=this.boundPaintVertexBuffers.length!==g.length,Y=0;!Z&&Y<g.length;Y++)this.boundPaintVertexBuffers[Y]!==g[Y]&&(Z=!0);h.extVertexArrayObject&&this.vao&&this.boundProgram===d&&this.boundLayoutVertexBuffer===p&&!Z&&this.boundIndexBuffer===S&&this.boundVertexOffset===w&&this.boundDynamicVertexBuffer===C&&this.boundDynamicVertexBuffer2===P?(h.bindVertexArrayOES.set(this.vao),C&&C.bind(),S&&S.dynamicDraw&&S.bind(),P&&P.bind()):this.freshBind(d,p,g,S,w,C,P)},Du.prototype.freshBind=function(h,d,p,g,S,w,C){var P,Z=h.numAttributes,Y=this.context,ce=Y.gl;if(Y.extVertexArrayObject)this.vao&&this.destroy(),this.vao=Y.extVertexArrayObject.createVertexArrayOES(),Y.bindVertexArrayOES.set(this.vao),P=0,this.boundProgram=h,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=g,this.boundVertexOffset=S,this.boundDynamicVertexBuffer=w,this.boundDynamicVertexBuffer2=C;else{P=Y.currentNumAttributes||0;for(var ge=Z;ge<P;ge++)ce.disableVertexAttribArray(ge)}d.enableAttributes(ce,h);for(var _e=0,Fe=p;_e<Fe.length;_e+=1)Fe[_e].enableAttributes(ce,h);w&&w.enableAttributes(ce,h),C&&C.enableAttributes(ce,h),d.bind(),d.setVertexAttribPointers(ce,h,S);for(var Pe=0,Xe=p;Pe<Xe.length;Pe+=1){var we=Xe[Pe];we.bind(),we.setVertexAttribPointers(ce,h,S)}w&&(w.bind(),w.setVertexAttribPointers(ce,h,S)),g&&g.bind(),C&&(C.bind(),C.setVertexAttribPointers(ce,h,S)),Y.currentNumAttributes=Z},Du.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var ja=function(h,d,p,g,S,w){var C=h.gl;this.program=C.createProgram();for(var P=mh(p.staticAttributes),Z=g?g.getBinderAttributes():[],Y=P.concat(Z),ce=p.staticUniforms?mh(p.staticUniforms):[],ge=g?g.getBinderUniforms():[],_e=[],Fe=0,Pe=ce.concat(ge);Fe<Pe.length;Fe+=1){var Xe=Pe[Fe];_e.indexOf(Xe)<0&&_e.push(Xe)}var we=g?g.defines():[];w&&we.push("#define OVERDRAW_INSPECTOR;");var Ge=we.concat(El.fragmentSource,p.fragmentSource).join(`
`),ct=we.concat(El.vertexSource,p.vertexSource).join(`
`),At=C.createShader(C.FRAGMENT_SHADER);if(C.isContextLost())this.failedToCreate=!0;else{C.shaderSource(At,Ge),C.compileShader(At),C.attachShader(this.program,At);var $t=C.createShader(C.VERTEX_SHADER);if(C.isContextLost())this.failedToCreate=!0;else{C.shaderSource($t,ct),C.compileShader($t),C.attachShader(this.program,$t),this.attributes={};var Nt={};this.numAttributes=Y.length;for(var tr=0;tr<this.numAttributes;tr++)Y[tr]&&(C.bindAttribLocation(this.program,tr,Y[tr]),this.attributes[Y[tr]]=tr);C.linkProgram(this.program),C.deleteShader($t),C.deleteShader(At);for(var mr=0;mr<_e.length;mr++){var Nr=_e[mr];if(Nr&&!Nt[Nr]){var Fr=C.getUniformLocation(this.program,Nr);Fr&&(Nt[Nr]=Fr)}}this.fixedUniforms=S(h,Nt),this.binderUniforms=g?g.getUniforms(h,Nt):[]}}};function ef(h,d,p){var g=1/ha(p,1,d.transform.tileZoom),S=Math.pow(2,p.tileID.overscaledZ),w=p.tileSize*Math.pow(2,d.transform.tileZoom)/S,C=w*(p.tileID.canonical.x+p.tileID.wrap*S),P=w*p.tileID.canonical.y;return{u_image:0,u_texsize:p.imageAtlasTexture.size,u_scale:[g,h.fromScale,h.toScale],u_fade:h.t,u_pixel_coord_upper:[C>>16,P>>16],u_pixel_coord_lower:[65535&C,65535&P]}}ja.prototype.draw=function(h,d,p,g,S,w,C,P,Z,Y,ce,ge,_e,Fe,Pe,Xe){var we,Ge=h.gl;if(!this.failedToCreate){for(var ct in h.program.set(this.program),h.setDepthMode(p),h.setStencilMode(g),h.setColorMode(S),h.setCullFace(w),this.fixedUniforms)this.fixedUniforms[ct].set(C[ct]);Fe&&Fe.setUniforms(h,this.binderUniforms,ge,{zoom:_e});for(var At=(we={},we[Ge.LINES]=2,we[Ge.TRIANGLES]=3,we[Ge.LINE_STRIP]=1,we)[d],$t=0,Nt=ce.get();$t<Nt.length;$t+=1){var tr=Nt[$t],mr=tr.vaos||(tr.vaos={});(mr[P]||(mr[P]=new Du)).bind(h,this,Z,Fe?Fe.getPaintVertexBuffers():[],Y,tr.vertexOffset,Pe,Xe),Ge.drawElements(d,tr.primitiveLength*At,Ge.UNSIGNED_SHORT,tr.primitiveOffset*At*2)}}};var Vp=function(h,d,p,g){var S=d.style.light,w=S.properties.get("position"),C=[w.x,w.y,w.z],P=_.create$1();S.properties.get("anchor")==="viewport"&&_.fromRotation(P,-d.transform.angle),_.transformMat3(C,C,P);var Z=S.properties.get("color");return{u_matrix:h,u_lightpos:C,u_lightintensity:S.properties.get("intensity"),u_lightcolor:[Z.r,Z.g,Z.b],u_vertical_gradient:+p,u_opacity:g}},xs=function(h,d,p,g,S,w,C){return _.extend(Vp(h,d,p,g),ef(w,d,C),{u_height_factor:-Math.pow(2,S.overscaledZ)/C.tileSize/8})},ku=function(h){return{u_matrix:h}},Fu=function(h,d,p,g){return _.extend(ku(h),ef(p,d,g))},ql=function(h,d){return{u_matrix:h,u_world:d}},If=function(h,d,p,g,S){return _.extend(Fu(h,d,p,g),{u_world:S})},wa=function(h,d,p,g){var S,w,C=h.transform;if(g.paint.get("circle-pitch-alignment")==="map"){var P=ha(p,1,C.zoom);S=!0,w=[P,P]}else S=!1,w=C.pixelsToGLUnits;return{u_camera_to_center_distance:C.cameraToCenterDistance,u_scale_with_map:+(g.paint.get("circle-pitch-scale")==="map"),u_matrix:h.translatePosMatrix(d.posMatrix,p,g.paint.get("circle-translate"),g.paint.get("circle-translate-anchor")),u_pitch_with_map:+S,u_device_pixel_ratio:_.browser.devicePixelRatio,u_extrude_scale:w}},Qs=function(h,d,p){var g=ha(p,1,d.zoom),S=Math.pow(2,d.zoom-p.tileID.overscaledZ),w=p.tileID.overscaleFactor();return{u_matrix:h,u_camera_to_center_distance:d.cameraToCenterDistance,u_pixels_to_tile_units:g,u_extrude_scale:[d.pixelsToGLUnits[0]/(g*S),d.pixelsToGLUnits[1]/(g*S)],u_overscale_factor:w}},Rc=function(h,d,p){return{u_matrix:h,u_inv_matrix:d,u_camera_to_center_distance:p.cameraToCenterDistance,u_viewport_size:[p.width,p.height]}},Kl=function(h,d,p){return p===void 0&&(p=1),{u_matrix:h,u_color:d,u_overlay:0,u_overlay_scale:p}},rl=function(h){return{u_matrix:h}},gh=function(h,d,p,g){return{u_matrix:h,u_extrude_scale:ha(d,1,p),u_intensity:g}},Ql=function(h,d,p){var g=h.transform;return{u_matrix:Jl(h,d,p),u_ratio:1/ha(d,1,g.zoom),u_device_pixel_ratio:_.browser.devicePixelRatio,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},ca=function(h,d,p,g){return _.extend(Ql(h,d,p),{u_image:0,u_image_height:g})},tf=function(h,d,p,g){var S=h.transform,w=Tl(d,S);return{u_matrix:Jl(h,d,p),u_texsize:d.imageAtlasTexture.size,u_ratio:1/ha(d,1,S.zoom),u_device_pixel_ratio:_.browser.devicePixelRatio,u_image:0,u_scale:[w,g.fromScale,g.toScale],u_fade:g.t,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]]}},np=function(h,d,p,g,S){var w=h.lineAtlas,C=Tl(d,h.transform),P=p.layout.get("line-cap")==="round",Z=w.getDash(g.from,P),Y=w.getDash(g.to,P),ce=Z.width*S.fromScale,ge=Y.width*S.toScale;return _.extend(Ql(h,d,p),{u_patternscale_a:[C/ce,-Z.height/2],u_patternscale_b:[C/ge,-Y.height/2],u_sdfgamma:w.width/(256*Math.min(ce,ge)*_.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:Z.y,u_tex_y_b:Y.y,u_mix:S.t})};function Tl(h,d){return 1/ha(h,1,d.tileZoom)}function Jl(h,d,p){return h.translatePosMatrix(d.tileID.posMatrix,d,p.paint.get("line-translate"),p.paint.get("line-translate-anchor"))}var _h=function(h,d,p,g,S){return{u_matrix:h,u_tl_parent:d,u_scale_parent:p,u_buffer_scale:1,u_fade_t:g.mix,u_opacity:g.opacity*S.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:S.paint.get("raster-brightness-min"),u_brightness_high:S.paint.get("raster-brightness-max"),u_saturation_factor:(C=S.paint.get("raster-saturation"),C>0?1-1/(1.001-C):-C),u_contrast_factor:(w=S.paint.get("raster-contrast"),w>0?1/(1-w):1+w),u_spin_weights:Pf(S.paint.get("raster-hue-rotate"))};var w,C};function Pf(h){h*=Math.PI/180;var d=Math.sin(h),p=Math.cos(h);return[(2*p+1)/3,(-Math.sqrt(3)*d-p+1)/3,(Math.sqrt(3)*d-p+1)/3]}var wl,hu=function(h,d,p,g,S,w,C,P,Z,Y){var ce=S.transform;return{u_is_size_zoom_constant:+(h==="constant"||h==="source"),u_is_size_feature_constant:+(h==="constant"||h==="camera"),u_size_t:d?d.uSizeT:0,u_size:d?d.uSize:0,u_camera_to_center_distance:ce.cameraToCenterDistance,u_pitch:ce.pitch/360*2*Math.PI,u_rotate_symbol:+p,u_aspect_ratio:ce.width/ce.height,u_fade_change:S.options.fadeDuration?S.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:C,u_coord_matrix:P,u_is_text:+Z,u_pitch_with_map:+g,u_texsize:Y,u_texture:0}},Mc=function(h,d,p,g,S,w,C,P,Z,Y,ce){var ge=S.transform;return _.extend(hu(h,d,p,g,S,w,C,P,Z,Y),{u_gamma_scale:g?Math.cos(ge._pitch)*ge.cameraToCenterDistance:1,u_device_pixel_ratio:_.browser.devicePixelRatio,u_is_halo:+ce})},rf=function(h,d,p,g,S,w,C,P,Z,Y){return _.extend(Mc(h,d,p,g,S,w,C,P,!0,Z,!0),{u_texsize_icon:Y,u_texture_icon:1})},ec=function(h,d,p){return{u_matrix:h,u_opacity:d,u_color:p}},tc=function(h,d,p,g,S,w){return _.extend(function(C,P,Z,Y){var ce=Z.imageManager.getPattern(C.from.toString()),ge=Z.imageManager.getPattern(C.to.toString()),_e=Z.imageManager.getPixelSize(),Fe=_e.width,Pe=_e.height,Xe=Math.pow(2,Y.tileID.overscaledZ),we=Y.tileSize*Math.pow(2,Z.transform.tileZoom)/Xe,Ge=we*(Y.tileID.canonical.x+Y.tileID.wrap*Xe),ct=we*Y.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:ce.tl,u_pattern_br_a:ce.br,u_pattern_tl_b:ge.tl,u_pattern_br_b:ge.br,u_texsize:[Fe,Pe],u_mix:P.t,u_pattern_size_a:ce.displaySize,u_pattern_size_b:ge.displaySize,u_scale_a:P.fromScale,u_scale_b:P.toScale,u_tile_units_to_pixels:1/ha(Y,1,Z.transform.tileZoom),u_pixel_coord_upper:[Ge>>16,ct>>16],u_pixel_coord_lower:[65535&Ge,65535&ct]}}(g,w,p,S),{u_matrix:h,u_opacity:d})},ip={fillExtrusion:function(h,d){return{u_matrix:new _.UniformMatrix4f(h,d.u_matrix),u_lightpos:new _.Uniform3f(h,d.u_lightpos),u_lightintensity:new _.Uniform1f(h,d.u_lightintensity),u_lightcolor:new _.Uniform3f(h,d.u_lightcolor),u_vertical_gradient:new _.Uniform1f(h,d.u_vertical_gradient),u_opacity:new _.Uniform1f(h,d.u_opacity)}},fillExtrusionPattern:function(h,d){return{u_matrix:new _.UniformMatrix4f(h,d.u_matrix),u_lightpos:new _.Uniform3f(h,d.u_lightpos),u_lightintensity:new _.Uniform1f(h,d.u_lightintensity),u_lightcolor:new _.Uniform3f(h,d.u_lightcolor),u_vertical_gradient:new _.Uniform1f(h,d.u_vertical_gradient),u_height_factor:new _.Uniform1f(h,d.u_height_factor),u_image:new _.Uniform1i(h,d.u_image),u_texsize:new _.Uniform2f(h,d.u_texsize),u_pixel_coord_upper:new _.Uniform2f(h,d.u_pixel_coord_upper),u_pixel_coord_lower:new _.Uniform2f(h,d.u_pixel_coord_lower),u_scale:new _.Uniform3f(h,d.u_scale),u_fade:new _.Uniform1f(h,d.u_fade),u_opacity:new _.Uniform1f(h,d.u_opacity)}},fill:function(h,d){return{u_matrix:new _.UniformMatrix4f(h,d.u_matrix)}},fillPattern:function(h,d){return{u_matrix:new _.UniformMatrix4f(h,d.u_matrix),u_image:new _.Uniform1i(h,d.u_image),u_texsize:new _.Uniform2f(h,d.u_texsize),u_pixel_coord_upper:new _.Uniform2f(h,d.u_pixel_coord_upper),u_pixel_coord_lower:new _.Uniform2f(h,d.u_pixel_coord_lower),u_scale:new _.Uniform3f(h,d.u_scale),u_fade:new _.Uniform1f(h,d.u_fade)}},fillOutline:function(h,d){return{u_matrix:new _.UniformMatrix4f(h,d.u_matrix),u_world:new _.Uniform2f(h,d.u_world)}},fillOutlinePattern:function(h,d){return{u_matrix:new _.UniformMatrix4f(h,d.u_matrix),u_world:new _.Uniform2f(h,d.u_world),u_image:new _.Uniform1i(h,d.u_image),u_texsize:new _.Uniform2f(h,d.u_texsize),u_pixel_coord_upper:new _.Uniform2f(h,d.u_pixel_coord_upper),u_pixel_coord_lower:new _.Uniform2f(h,d.u_pixel_coord_lower),u_scale:new _.Uniform3f(h,d.u_scale),u_fade:new _.Uniform1f(h,d.u_fade)}},circle:function(h,d){return{u_camera_to_center_distance:new _.Uniform1f(h,d.u_camera_to_center_distance),u_scale_with_map:new _.Uniform1i(h,d.u_scale_with_map),u_pitch_with_map:new _.Uniform1i(h,d.u_pitch_with_map),u_extrude_scale:new _.Uniform2f(h,d.u_extrude_scale),u_device_pixel_ratio:new _.Uniform1f(h,d.u_device_pixel_ratio),u_matrix:new _.UniformMatrix4f(h,d.u_matrix)}},collisionBox:function(h,d){return{u_matrix:new _.UniformMatrix4f(h,d.u_matrix),u_camera_to_center_distance:new _.Uniform1f(h,d.u_camera_to_center_distance),u_pixels_to_tile_units:new _.Uniform1f(h,d.u_pixels_to_tile_units),u_extrude_scale:new _.Uniform2f(h,d.u_extrude_scale),u_overscale_factor:new _.Uniform1f(h,d.u_overscale_factor)}},collisionCircle:function(h,d){return{u_matrix:new _.UniformMatrix4f(h,d.u_matrix),u_inv_matrix:new _.UniformMatrix4f(h,d.u_inv_matrix),u_camera_to_center_distance:new _.Uniform1f(h,d.u_camera_to_center_distance),u_viewport_size:new _.Uniform2f(h,d.u_viewport_size)}},debug:function(h,d){return{u_color:new _.UniformColor(h,d.u_color),u_matrix:new _.UniformMatrix4f(h,d.u_matrix),u_overlay:new _.Uniform1i(h,d.u_overlay),u_overlay_scale:new _.Uniform1f(h,d.u_overlay_scale)}},clippingMask:function(h,d){return{u_matrix:new _.UniformMatrix4f(h,d.u_matrix)}},heatmap:function(h,d){return{u_extrude_scale:new _.Uniform1f(h,d.u_extrude_scale),u_intensity:new _.Uniform1f(h,d.u_intensity),u_matrix:new _.UniformMatrix4f(h,d.u_matrix)}},heatmapTexture:function(h,d){return{u_matrix:new _.UniformMatrix4f(h,d.u_matrix),u_world:new _.Uniform2f(h,d.u_world),u_image:new _.Uniform1i(h,d.u_image),u_color_ramp:new _.Uniform1i(h,d.u_color_ramp),u_opacity:new _.Uniform1f(h,d.u_opacity)}},hillshade:function(h,d){return{u_matrix:new _.UniformMatrix4f(h,d.u_matrix),u_image:new _.Uniform1i(h,d.u_image),u_latrange:new _.Uniform2f(h,d.u_latrange),u_light:new _.Uniform2f(h,d.u_light),u_shadow:new _.UniformColor(h,d.u_shadow),u_highlight:new _.UniformColor(h,d.u_highlight),u_accent:new _.UniformColor(h,d.u_accent)}},hillshadePrepare:function(h,d){return{u_matrix:new _.UniformMatrix4f(h,d.u_matrix),u_image:new _.Uniform1i(h,d.u_image),u_dimension:new _.Uniform2f(h,d.u_dimension),u_zoom:new _.Uniform1f(h,d.u_zoom),u_unpack:new _.Uniform4f(h,d.u_unpack)}},line:function(h,d){return{u_matrix:new _.UniformMatrix4f(h,d.u_matrix),u_ratio:new _.Uniform1f(h,d.u_ratio),u_device_pixel_ratio:new _.Uniform1f(h,d.u_device_pixel_ratio),u_units_to_pixels:new _.Uniform2f(h,d.u_units_to_pixels)}},lineGradient:function(h,d){return{u_matrix:new _.UniformMatrix4f(h,d.u_matrix),u_ratio:new _.Uniform1f(h,d.u_ratio),u_device_pixel_ratio:new _.Uniform1f(h,d.u_device_pixel_ratio),u_units_to_pixels:new _.Uniform2f(h,d.u_units_to_pixels),u_image:new _.Uniform1i(h,d.u_image),u_image_height:new _.Uniform1f(h,d.u_image_height)}},linePattern:function(h,d){return{u_matrix:new _.UniformMatrix4f(h,d.u_matrix),u_texsize:new _.Uniform2f(h,d.u_texsize),u_ratio:new _.Uniform1f(h,d.u_ratio),u_device_pixel_ratio:new _.Uniform1f(h,d.u_device_pixel_ratio),u_image:new _.Uniform1i(h,d.u_image),u_units_to_pixels:new _.Uniform2f(h,d.u_units_to_pixels),u_scale:new _.Uniform3f(h,d.u_scale),u_fade:new _.Uniform1f(h,d.u_fade)}},lineSDF:function(h,d){return{u_matrix:new _.UniformMatrix4f(h,d.u_matrix),u_ratio:new _.Uniform1f(h,d.u_ratio),u_device_pixel_ratio:new _.Uniform1f(h,d.u_device_pixel_ratio),u_units_to_pixels:new _.Uniform2f(h,d.u_units_to_pixels),u_patternscale_a:new _.Uniform2f(h,d.u_patternscale_a),u_patternscale_b:new _.Uniform2f(h,d.u_patternscale_b),u_sdfgamma:new _.Uniform1f(h,d.u_sdfgamma),u_image:new _.Uniform1i(h,d.u_image),u_tex_y_a:new _.Uniform1f(h,d.u_tex_y_a),u_tex_y_b:new _.Uniform1f(h,d.u_tex_y_b),u_mix:new _.Uniform1f(h,d.u_mix)}},raster:function(h,d){return{u_matrix:new _.UniformMatrix4f(h,d.u_matrix),u_tl_parent:new _.Uniform2f(h,d.u_tl_parent),u_scale_parent:new _.Uniform1f(h,d.u_scale_parent),u_buffer_scale:new _.Uniform1f(h,d.u_buffer_scale),u_fade_t:new _.Uniform1f(h,d.u_fade_t),u_opacity:new _.Uniform1f(h,d.u_opacity),u_image0:new _.Uniform1i(h,d.u_image0),u_image1:new _.Uniform1i(h,d.u_image1),u_brightness_low:new _.Uniform1f(h,d.u_brightness_low),u_brightness_high:new _.Uniform1f(h,d.u_brightness_high),u_saturation_factor:new _.Uniform1f(h,d.u_saturation_factor),u_contrast_factor:new _.Uniform1f(h,d.u_contrast_factor),u_spin_weights:new _.Uniform3f(h,d.u_spin_weights)}},symbolIcon:function(h,d){return{u_is_size_zoom_constant:new _.Uniform1i(h,d.u_is_size_zoom_constant),u_is_size_feature_constant:new _.Uniform1i(h,d.u_is_size_feature_constant),u_size_t:new _.Uniform1f(h,d.u_size_t),u_size:new _.Uniform1f(h,d.u_size),u_camera_to_center_distance:new _.Uniform1f(h,d.u_camera_to_center_distance),u_pitch:new _.Uniform1f(h,d.u_pitch),u_rotate_symbol:new _.Uniform1i(h,d.u_rotate_symbol),u_aspect_ratio:new _.Uniform1f(h,d.u_aspect_ratio),u_fade_change:new _.Uniform1f(h,d.u_fade_change),u_matrix:new _.UniformMatrix4f(h,d.u_matrix),u_label_plane_matrix:new _.UniformMatrix4f(h,d.u_label_plane_matrix),u_coord_matrix:new _.UniformMatrix4f(h,d.u_coord_matrix),u_is_text:new _.Uniform1i(h,d.u_is_text),u_pitch_with_map:new _.Uniform1i(h,d.u_pitch_with_map),u_texsize:new _.Uniform2f(h,d.u_texsize),u_texture:new _.Uniform1i(h,d.u_texture)}},symbolSDF:function(h,d){return{u_is_size_zoom_constant:new _.Uniform1i(h,d.u_is_size_zoom_constant),u_is_size_feature_constant:new _.Uniform1i(h,d.u_is_size_feature_constant),u_size_t:new _.Uniform1f(h,d.u_size_t),u_size:new _.Uniform1f(h,d.u_size),u_camera_to_center_distance:new _.Uniform1f(h,d.u_camera_to_center_distance),u_pitch:new _.Uniform1f(h,d.u_pitch),u_rotate_symbol:new _.Uniform1i(h,d.u_rotate_symbol),u_aspect_ratio:new _.Uniform1f(h,d.u_aspect_ratio),u_fade_change:new _.Uniform1f(h,d.u_fade_change),u_matrix:new _.UniformMatrix4f(h,d.u_matrix),u_label_plane_matrix:new _.UniformMatrix4f(h,d.u_label_plane_matrix),u_coord_matrix:new _.UniformMatrix4f(h,d.u_coord_matrix),u_is_text:new _.Uniform1i(h,d.u_is_text),u_pitch_with_map:new _.Uniform1i(h,d.u_pitch_with_map),u_texsize:new _.Uniform2f(h,d.u_texsize),u_texture:new _.Uniform1i(h,d.u_texture),u_gamma_scale:new _.Uniform1f(h,d.u_gamma_scale),u_device_pixel_ratio:new _.Uniform1f(h,d.u_device_pixel_ratio),u_is_halo:new _.Uniform1i(h,d.u_is_halo)}},symbolTextAndIcon:function(h,d){return{u_is_size_zoom_constant:new _.Uniform1i(h,d.u_is_size_zoom_constant),u_is_size_feature_constant:new _.Uniform1i(h,d.u_is_size_feature_constant),u_size_t:new _.Uniform1f(h,d.u_size_t),u_size:new _.Uniform1f(h,d.u_size),u_camera_to_center_distance:new _.Uniform1f(h,d.u_camera_to_center_distance),u_pitch:new _.Uniform1f(h,d.u_pitch),u_rotate_symbol:new _.Uniform1i(h,d.u_rotate_symbol),u_aspect_ratio:new _.Uniform1f(h,d.u_aspect_ratio),u_fade_change:new _.Uniform1f(h,d.u_fade_change),u_matrix:new _.UniformMatrix4f(h,d.u_matrix),u_label_plane_matrix:new _.UniformMatrix4f(h,d.u_label_plane_matrix),u_coord_matrix:new _.UniformMatrix4f(h,d.u_coord_matrix),u_is_text:new _.Uniform1i(h,d.u_is_text),u_pitch_with_map:new _.Uniform1i(h,d.u_pitch_with_map),u_texsize:new _.Uniform2f(h,d.u_texsize),u_texsize_icon:new _.Uniform2f(h,d.u_texsize_icon),u_texture:new _.Uniform1i(h,d.u_texture),u_texture_icon:new _.Uniform1i(h,d.u_texture_icon),u_gamma_scale:new _.Uniform1f(h,d.u_gamma_scale),u_device_pixel_ratio:new _.Uniform1f(h,d.u_device_pixel_ratio),u_is_halo:new _.Uniform1i(h,d.u_is_halo)}},background:function(h,d){return{u_matrix:new _.UniformMatrix4f(h,d.u_matrix),u_opacity:new _.Uniform1f(h,d.u_opacity),u_color:new _.UniformColor(h,d.u_color)}},backgroundPattern:function(h,d){return{u_matrix:new _.UniformMatrix4f(h,d.u_matrix),u_opacity:new _.Uniform1f(h,d.u_opacity),u_image:new _.Uniform1i(h,d.u_image),u_pattern_tl_a:new _.Uniform2f(h,d.u_pattern_tl_a),u_pattern_br_a:new _.Uniform2f(h,d.u_pattern_br_a),u_pattern_tl_b:new _.Uniform2f(h,d.u_pattern_tl_b),u_pattern_br_b:new _.Uniform2f(h,d.u_pattern_br_b),u_texsize:new _.Uniform2f(h,d.u_texsize),u_mix:new _.Uniform1f(h,d.u_mix),u_pattern_size_a:new _.Uniform2f(h,d.u_pattern_size_a),u_pattern_size_b:new _.Uniform2f(h,d.u_pattern_size_b),u_scale_a:new _.Uniform1f(h,d.u_scale_a),u_scale_b:new _.Uniform1f(h,d.u_scale_b),u_pixel_coord_upper:new _.Uniform2f(h,d.u_pixel_coord_upper),u_pixel_coord_lower:new _.Uniform2f(h,d.u_pixel_coord_lower),u_tile_units_to_pixels:new _.Uniform1f(h,d.u_tile_units_to_pixels)}}};function nl(h,d,p,g,S,w,C){for(var P=h.context,Z=P.gl,Y=h.useProgram("collisionBox"),ce=[],ge=0,_e=0,Fe=0;Fe<g.length;Fe++){var Pe=g[Fe],Xe=d.getTile(Pe),we=Xe.getBucket(p);if(we){var Ge=Pe.posMatrix;S[0]===0&&S[1]===0||(Ge=h.translatePosMatrix(Pe.posMatrix,Xe,S,w));var ct=C?we.textCollisionBox:we.iconCollisionBox,At=we.collisionCircleArray;if(At.length>0){var $t=_.create(),Nt=Ge;_.mul($t,we.placementInvProjMatrix,h.transform.glCoordMatrix),_.mul($t,$t,we.placementViewportMatrix),ce.push({circleArray:At,circleOffset:_e,transform:Nt,invTransform:$t}),_e=ge+=At.length/4}ct&&Y.draw(P,Z.LINES,xe.disabled,Re.disabled,h.colorModeForRenderPass(),lt.disabled,Qs(Ge,h.transform,Xe),p.id,ct.layoutVertexBuffer,ct.indexBuffer,ct.segments,null,h.transform.zoom,null,null,ct.collisionVertexBuffer)}}if(C&&ce.length){var tr=h.useProgram("collisionCircle"),mr=new _.StructArrayLayout2f1f2i16;mr.resize(4*ge),mr._trim();for(var Nr=0,Fr=0,an=ce;Fr<an.length;Fr+=1)for(var In=an[Fr],Nn=0;Nn<In.circleArray.length/4;Nn++){var Un=4*Nn,ji=In.circleArray[Un+0],hn=In.circleArray[Un+1],Kn=In.circleArray[Un+2],_i=In.circleArray[Un+3];mr.emplace(Nr++,ji,hn,Kn,_i,0),mr.emplace(Nr++,ji,hn,Kn,_i,1),mr.emplace(Nr++,ji,hn,Kn,_i,2),mr.emplace(Nr++,ji,hn,Kn,_i,3)}(!wl||wl.length<2*ge)&&(wl=function(Na){var Co=2*Na,Lo=new _.StructArrayLayout3ui6;Lo.resize(Co),Lo._trim();for(var Wa=0;Wa<Co;Wa++){var Ga=6*Wa;Lo.uint16[Ga+0]=4*Wa+0,Lo.uint16[Ga+1]=4*Wa+1,Lo.uint16[Ga+2]=4*Wa+2,Lo.uint16[Ga+3]=4*Wa+2,Lo.uint16[Ga+4]=4*Wa+3,Lo.uint16[Ga+5]=4*Wa+0}return Lo}(ge));for(var ti=P.createIndexBuffer(wl,!0),Xn=P.createVertexBuffer(mr,_.collisionCircleLayout.members,!0),pi=0,qn=ce;pi<qn.length;pi+=1){var $n=qn[pi],wo=Rc($n.transform,$n.invTransform,h.transform);tr.draw(P,Z.TRIANGLES,xe.disabled,Re.disabled,h.colorModeForRenderPass(),lt.disabled,wo,p.id,Xn,ti,_.SegmentVector.simpleSegment(0,2*$n.circleOffset,$n.circleArray.length,$n.circleArray.length/2),null,h.transform.zoom,null,null,null)}Xn.destroy(),ti.destroy()}}var Js=_.identity(new Float32Array(16));function nf(h,d,p,g,S,w){var C=_.getAnchorAlignment(h),P=-(C.horizontalAlign-.5)*d,Z=-(C.verticalAlign-.5)*p,Y=_.evaluateVariableOffset(h,g);return new _.Point((P/S+Y[0])*w,(Z/S+Y[1])*w)}function Ic(h,d,p,g,S,w,C,P,Z,Y,ce){var ge=h.text.placedSymbolArray,_e=h.text.dynamicLayoutVertexArray,Fe=h.icon.dynamicLayoutVertexArray,Pe={};_e.clear();for(var Xe=0;Xe<ge.length;Xe++){var we=ge.get(Xe),Ge=we.hidden||!we.crossTileID||h.allowVerticalPlacement&&!we.placedOrientation?null:g[we.crossTileID];if(Ge){var ct=new _.Point(we.anchorX,we.anchorY),At=mi(ct,p?P:C),$t=Ti(w.cameraToCenterDistance,At.signedDistanceFromCamera),Nt=S.evaluateSizeForFeature(h.textSizeData,Y,we)*$t/_.ONE_EM;p&&(Nt*=h.tilePixelRatio/Z);for(var tr=nf(Ge.anchor,Ge.width,Ge.height,Ge.textOffset,Ge.textBoxScale,Nt),mr=p?mi(ct.add(tr),C).point:At.point.add(d?tr.rotate(-w.angle):tr),Nr=h.allowVerticalPlacement&&we.placedOrientation===_.WritingMode.vertical?Math.PI/2:0,Fr=0;Fr<we.numGlyphs;Fr++)_.addDynamicAttributes(_e,mr,Nr);ce&&we.associatedIconIndex>=0&&(Pe[we.associatedIconIndex]={shiftedAnchor:mr,angle:Nr})}else Oa(we.numGlyphs,_e)}if(ce){Fe.clear();for(var an=h.icon.placedSymbolArray,In=0;In<an.length;In++){var Nn=an.get(In);if(Nn.hidden)Oa(Nn.numGlyphs,Fe);else{var Un=Pe[In];if(Un)for(var ji=0;ji<Nn.numGlyphs;ji++)_.addDynamicAttributes(Fe,Un.shiftedAnchor,Un.angle);else Oa(Nn.numGlyphs,Fe)}}h.icon.dynamicLayoutVertexBuffer.updateData(Fe)}h.text.dynamicLayoutVertexBuffer.updateData(_e)}function yh(h,d,p){return p.iconsInText&&d?"symbolTextAndIcon":h?"symbolSDF":"symbolIcon"}function Cl(h,d,p,g,S,w,C,P,Z,Y,ce,ge){for(var _e=h.context,Fe=_e.gl,Pe=h.transform,Xe=P==="map",we=Z==="map",Ge=Xe&&p.layout.get("symbol-placement")!=="point",ct=Xe&&!we&&!Ge,At=p.layout.get("symbol-sort-key").constantOr(1)!==void 0,$t=!1,Nt=h.depthModeForSublayer(0,xe.ReadOnly),tr=p.layout.get("text-variable-anchor"),mr=[],Nr=0,Fr=g;Nr<Fr.length;Nr+=1){var an=Fr[Nr],In=d.getTile(an),Nn=In.getBucket(p);if(Nn){var Un=S?Nn.text:Nn.icon;if(Un&&Un.segments.get().length){var ji=Un.programConfigurations.get(p.id),hn=S||Nn.sdfIcons,Kn=S?Nn.textSizeData:Nn.iconSizeData,_i=we||Pe.pitch!==0,ti=h.useProgram(yh(hn,S,Nn),ji),Xn=_.evaluateSizeForZoom(Kn,Pe.zoom),pi=void 0,qn=[0,0],$n=void 0,wo=void 0,Na=null,Co=void 0;if(S)$n=In.glyphAtlasTexture,wo=Fe.LINEAR,pi=In.glyphAtlasTexture.size,Nn.iconsInText&&(qn=In.imageAtlasTexture.size,Na=In.imageAtlasTexture,Co=_i||h.options.rotating||h.options.zooming||Kn.kind==="composite"||Kn.kind==="camera"?Fe.LINEAR:Fe.NEAREST);else{var Lo=p.layout.get("icon-size").constantOr(0)!==1||Nn.iconsNeedLinear;$n=In.imageAtlasTexture,wo=hn||h.options.rotating||h.options.zooming||Lo||_i?Fe.LINEAR:Fe.NEAREST,pi=In.imageAtlasTexture.size}var Wa=ha(In,1,h.transform.zoom),Ga=Ia(an.posMatrix,we,Xe,h.transform,Wa),Ss=Ai(an.posMatrix,we,Xe,h.transform,Wa),ls=tr&&Nn.hasTextData(),Zu=p.layout.get("icon-text-fit")!=="none"&&ls&&Nn.hasIconData();Ge&&cu(Nn,an.posMatrix,h,S,Ga,Ss,we,Y);var cs=h.translatePosMatrix(an.posMatrix,In,w,C),nu=Ge||S&&tr||Zu?Js:Ga,Ns=h.translatePosMatrix(Ss,In,w,C,!0),sl=hn&&p.paint.get(S?"text-halo-width":"icon-halo-width").constantOr(1)!==0,kl={program:ti,buffers:Un,uniformValues:hn?Nn.iconsInText?rf(Kn.kind,Xn,ct,we,h,cs,nu,Ns,pi,qn):Mc(Kn.kind,Xn,ct,we,h,cs,nu,Ns,S,pi,!0):hu(Kn.kind,Xn,ct,we,h,cs,nu,Ns,S,pi),atlasTexture:$n,atlasTextureIcon:Na,atlasInterpolation:wo,atlasInterpolationIcon:Co,isSDF:hn,hasHalo:sl};if(At&&Nn.canOverlap){$t=!0;for(var ul=0,Fl=Un.segments.get();ul<Fl.length;ul+=1){var Vu=Fl[ul];mr.push({segments:new _.SegmentVector([Vu]),sortKey:Vu.sortKey,state:kl})}}else mr.push({segments:Un.segments,sortKey:0,state:kl})}}}$t&&mr.sort(function(au,Hu){return au.sortKey-Hu.sortKey});for(var iu=0,ju=mr;iu<ju.length;iu+=1){var Ko=ju[iu],Ka=Ko.state;if(_e.activeTexture.set(Fe.TEXTURE0),Ka.atlasTexture.bind(Ka.atlasInterpolation,Fe.CLAMP_TO_EDGE),Ka.atlasTextureIcon&&(_e.activeTexture.set(Fe.TEXTURE1),Ka.atlasTextureIcon&&Ka.atlasTextureIcon.bind(Ka.atlasInterpolationIcon,Fe.CLAMP_TO_EDGE)),Ka.isSDF){var As=Ka.uniformValues;Ka.hasHalo&&(As.u_is_halo=1,pu(Ka.buffers,Ko.segments,p,h,Ka.program,Nt,ce,ge,As)),As.u_is_halo=0}pu(Ka.buffers,Ko.segments,p,h,Ka.program,Nt,ce,ge,Ka.uniformValues)}}function pu(h,d,p,g,S,w,C,P,Z){var Y=g.context;S.draw(Y,Y.gl.TRIANGLES,w,C,P,lt.disabled,Z,p.id,h.layoutVertexBuffer,h.indexBuffer,d,p.paint,g.transform.zoom,h.programConfigurations.get(p.id),h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer)}function af(h,d,p,g,S,w,C){var P,Z,Y,ce,ge,_e=h.context.gl,Fe=p.paint.get("fill-pattern"),Pe=Fe&&Fe.constantOr(1),Xe=p.getCrossfadeParameters();C?(Z=Pe&&!p.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",P=_e.LINES):(Z=Pe?"fillPattern":"fill",P=_e.TRIANGLES);for(var we=0,Ge=g;we<Ge.length;we+=1){var ct=Ge[we],At=d.getTile(ct);if(!Pe||At.patternsLoaded()){var $t=At.getBucket(p);if($t){var Nt=$t.programConfigurations.get(p.id),tr=h.useProgram(Z,Nt);Pe&&(h.context.activeTexture.set(_e.TEXTURE0),At.imageAtlasTexture.bind(_e.LINEAR,_e.CLAMP_TO_EDGE),Nt.updatePaintBuffers(Xe));var mr=Fe.constantOr(null);if(mr&&At.imageAtlas){var Nr=At.imageAtlas,Fr=Nr.patternPositions[mr.to.toString()],an=Nr.patternPositions[mr.from.toString()];Fr&&an&&Nt.setConstantPatternPositions(Fr,an)}var In=h.translatePosMatrix(ct.posMatrix,At,p.paint.get("fill-translate"),p.paint.get("fill-translate-anchor"));if(C){ce=$t.indexBuffer2,ge=$t.segments2;var Nn=[_e.drawingBufferWidth,_e.drawingBufferHeight];Y=Z==="fillOutlinePattern"&&Pe?If(In,h,Xe,At,Nn):ql(In,Nn)}else ce=$t.indexBuffer,ge=$t.segments,Y=Pe?Fu(In,h,Xe,At):ku(In);tr.draw(h.context,P,S,h.stencilModeForClipping(ct),w,lt.disabled,Y,p.id,$t.layoutVertexBuffer,ce,ge,p.paint,h.transform.zoom,Nt)}}}}function Pc(h,d,p,g,S,w,C){for(var P=h.context,Z=P.gl,Y=p.paint.get("fill-extrusion-pattern"),ce=Y.constantOr(1),ge=p.getCrossfadeParameters(),_e=p.paint.get("fill-extrusion-opacity"),Fe=0,Pe=g;Fe<Pe.length;Fe+=1){var Xe=Pe[Fe],we=d.getTile(Xe),Ge=we.getBucket(p);if(Ge){var ct=Ge.programConfigurations.get(p.id),At=h.useProgram(ce?"fillExtrusionPattern":"fillExtrusion",ct);ce&&(h.context.activeTexture.set(Z.TEXTURE0),we.imageAtlasTexture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE),ct.updatePaintBuffers(ge));var $t=Y.constantOr(null);if($t&&we.imageAtlas){var Nt=we.imageAtlas,tr=Nt.patternPositions[$t.to.toString()],mr=Nt.patternPositions[$t.from.toString()];tr&&mr&&ct.setConstantPatternPositions(tr,mr)}var Nr=h.translatePosMatrix(Xe.posMatrix,we,p.paint.get("fill-extrusion-translate"),p.paint.get("fill-extrusion-translate-anchor")),Fr=p.paint.get("fill-extrusion-vertical-gradient"),an=ce?xs(Nr,h,Fr,_e,Xe,ge,we):Vp(Nr,h,Fr,_e);At.draw(P,P.gl.TRIANGLES,S,w,C,lt.backCCW,an,p.id,Ge.layoutVertexBuffer,Ge.indexBuffer,Ge.segments,p.paint,h.transform.zoom,ct)}}}function Bu(h,d,p,g,S,w){var C=h.context,P=C.gl,Z=d.fbo;if(Z){var Y=h.useProgram("hillshade");C.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,Z.colorAttachment.get());var ce=function(ge,_e,Fe){var Pe=Fe.paint.get("hillshade-shadow-color"),Xe=Fe.paint.get("hillshade-highlight-color"),we=Fe.paint.get("hillshade-accent-color"),Ge=Fe.paint.get("hillshade-illumination-direction")*(Math.PI/180);Fe.paint.get("hillshade-illumination-anchor")==="viewport"&&(Ge-=ge.transform.angle);var ct,At,$t,Nt=!ge.options.moving;return{u_matrix:ge.transform.calculatePosMatrix(_e.tileID.toUnwrapped(),Nt),u_image:0,u_latrange:(ct=_e.tileID,At=Math.pow(2,ct.canonical.z),$t=ct.canonical.y,[new _.MercatorCoordinate(0,$t/At).toLngLat().lat,new _.MercatorCoordinate(0,($t+1)/At).toLngLat().lat]),u_light:[Fe.paint.get("hillshade-exaggeration"),Ge],u_shadow:Pe,u_highlight:Xe,u_accent:we}}(h,d,p);Y.draw(C,P.TRIANGLES,g,S,w,lt.disabled,ce,p.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments)}}function Md(h,d,p,g,S,w){var C=h.context,P=C.gl,Z=d.dem;if(Z&&Z.data){var Y=Z.dim,ce=Z.stride,ge=Z.getPixels();if(C.activeTexture.set(P.TEXTURE1),C.pixelStoreUnpackPremultiplyAlpha.set(!1),d.demTexture=d.demTexture||h.getTileTexture(ce),d.demTexture){var _e=d.demTexture;_e.update(ge,{premultiply:!1}),_e.bind(P.NEAREST,P.CLAMP_TO_EDGE)}else d.demTexture=new _.Texture(C,ge,P.RGBA,{premultiply:!1}),d.demTexture.bind(P.NEAREST,P.CLAMP_TO_EDGE);C.activeTexture.set(P.TEXTURE0);var Fe=d.fbo;if(!Fe){var Pe=new _.Texture(C,{width:Y,height:Y,data:null},P.RGBA);Pe.bind(P.LINEAR,P.CLAMP_TO_EDGE),(Fe=d.fbo=C.createFramebuffer(Y,Y,!0)).colorAttachment.set(Pe.texture)}C.bindFramebuffer.set(Fe.framebuffer),C.viewport.set([0,0,Y,Y]),h.useProgram("hillshadePrepare").draw(C,P.TRIANGLES,g,S,w,lt.disabled,function(Xe,we){var Ge=we.stride,ct=_.create();return _.ortho(ct,0,_.EXTENT,-_.EXTENT,0,0,1),_.translate(ct,ct,[0,-_.EXTENT,0]),{u_matrix:ct,u_image:1,u_dimension:[Ge,Ge],u_zoom:Xe.overscaledZ,u_unpack:we.getUnpackVector()}}(d.tileID,Z),p.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments),d.needsHillshadePrepare=!1}}function Of(h,d,p,g,S){var w=g.paint.get("raster-fade-duration");if(w>0){var C=_.browser.now(),P=(C-h.timeAdded)/w,Z=d?(C-d.timeAdded)/w:-1,Y=p.getSource(),ce=S.coveringZoomLevel({tileSize:Y.tileSize,roundZoom:Y.roundZoom}),ge=!d||Math.abs(d.tileID.overscaledZ-ce)>Math.abs(h.tileID.overscaledZ-ce),_e=ge&&h.refreshedUponExpiration?1:_.clamp(ge?P:1-Z,0,1);return h.refreshedUponExpiration&&P>=1&&(h.refreshedUponExpiration=!1),d?{opacity:1,mix:1-_e}:{opacity:_e,mix:0}}return{opacity:1,mix:0}}var xh=new _.Color(1,0,0,1),Df=new _.Color(0,1,0,1),ko=new _.Color(0,0,1,1),bh=new _.Color(1,0,1,1),ap=new _.Color(0,1,1,1);function kf(h,d,p,g){Oc(h,0,d+p/2,h.transform.width,p,g)}function Eh(h,d,p,g){Oc(h,d-p/2,0,p,h.transform.height,g)}function Oc(h,d,p,g,S,w){var C=h.context,P=C.gl;P.enable(P.SCISSOR_TEST),P.scissor(d*_.browser.devicePixelRatio,p*_.browser.devicePixelRatio,g*_.browser.devicePixelRatio,S*_.browser.devicePixelRatio),C.clear({color:w}),P.disable(P.SCISSOR_TEST)}function of(h,d,p){var g=h.context,S=g.gl,w=p.posMatrix,C=h.useProgram("debug"),P=xe.disabled,Z=Re.disabled,Y=h.colorModeForRenderPass();g.activeTexture.set(S.TEXTURE0),h.emptyTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),C.draw(g,S.LINE_STRIP,P,Z,Y,lt.disabled,Kl(w,_.Color.red),"$debug",h.debugBuffer,h.tileBorderIndexBuffer,h.debugSegments);var ce=d.getTileByID(p.key).latestRawTileData,ge=Math.floor((ce&&ce.byteLength||0)/1024),_e=d.getTile(p).tileSize,Fe=512/Math.min(_e,512)*(p.overscaledZ/h.transform.zoom)*.5,Pe=p.canonical.toString();p.overscaledZ!==p.canonical.z&&(Pe+=" => "+p.overscaledZ),function(Xe,we){Xe.initDebugOverlayCanvas();var Ge=Xe.debugOverlayCanvas,ct=Xe.context.gl,At=Xe.debugOverlayCanvas.getContext("2d");At.clearRect(0,0,Ge.width,Ge.height),At.shadowColor="white",At.shadowBlur=2,At.lineWidth=1.5,At.strokeStyle="white",At.textBaseline="top",At.font="bold 36px Open Sans, sans-serif",At.fillText(we,5,5),At.strokeText(we,5,5),Xe.debugOverlayTexture.update(Ge),Xe.debugOverlayTexture.bind(ct.LINEAR,ct.CLAMP_TO_EDGE)}(h,Pe+" "+ge+"kb"),C.draw(g,S.TRIANGLES,P,Z,Je.alphaBlended,lt.disabled,Kl(w,_.Color.transparent,Fe),"$debug",h.debugBuffer,h.quadTriangleIndexBuffer,h.debugSegments)}var il={symbol:function(h,d,p,g,S){if(h.renderPass==="translucent"){var w=Re.disabled,C=h.colorModeForRenderPass();p.layout.get("text-variable-anchor")&&function(P,Z,Y,ce,ge,_e,Fe){for(var Pe=Z.transform,Xe=ge==="map",we=_e==="map",Ge=0,ct=P;Ge<ct.length;Ge+=1){var At=ct[Ge],$t=ce.getTile(At),Nt=$t.getBucket(Y);if(Nt&&Nt.text&&Nt.text.segments.get().length){var tr=_.evaluateSizeForZoom(Nt.textSizeData,Pe.zoom),mr=ha($t,1,Z.transform.zoom),Nr=Ia(At.posMatrix,we,Xe,Z.transform,mr),Fr=Y.layout.get("icon-text-fit")!=="none"&&Nt.hasIconData();if(tr){var an=Math.pow(2,Pe.zoom-$t.tileID.overscaledZ);Ic(Nt,Xe,we,Fe,_.symbolSize,Pe,Nr,At.posMatrix,an,tr,Fr)}}}}(g,h,p,d,p.layout.get("text-rotation-alignment"),p.layout.get("text-pitch-alignment"),S),p.paint.get("icon-opacity").constantOr(1)!==0&&Cl(h,d,p,g,!1,p.paint.get("icon-translate"),p.paint.get("icon-translate-anchor"),p.layout.get("icon-rotation-alignment"),p.layout.get("icon-pitch-alignment"),p.layout.get("icon-keep-upright"),w,C),p.paint.get("text-opacity").constantOr(1)!==0&&Cl(h,d,p,g,!0,p.paint.get("text-translate"),p.paint.get("text-translate-anchor"),p.layout.get("text-rotation-alignment"),p.layout.get("text-pitch-alignment"),p.layout.get("text-keep-upright"),w,C),d.map.showCollisionBoxes&&(nl(h,d,p,g,p.paint.get("text-translate"),p.paint.get("text-translate-anchor"),!0),nl(h,d,p,g,p.paint.get("icon-translate"),p.paint.get("icon-translate-anchor"),!1))}},circle:function(h,d,p,g){if(h.renderPass==="translucent"){var S=p.paint.get("circle-opacity"),w=p.paint.get("circle-stroke-width"),C=p.paint.get("circle-stroke-opacity"),P=p.layout.get("circle-sort-key").constantOr(1)!==void 0;if(S.constantOr(1)!==0||w.constantOr(1)!==0&&C.constantOr(1)!==0){for(var Z=h.context,Y=Z.gl,ce=h.depthModeForSublayer(0,xe.ReadOnly),ge=Re.disabled,_e=h.colorModeForRenderPass(),Fe=[],Pe=0;Pe<g.length;Pe++){var Xe=g[Pe],we=d.getTile(Xe),Ge=we.getBucket(p);if(Ge){var ct=Ge.programConfigurations.get(p.id),At={programConfiguration:ct,program:h.useProgram("circle",ct),layoutVertexBuffer:Ge.layoutVertexBuffer,indexBuffer:Ge.indexBuffer,uniformValues:wa(h,Xe,we,p)};if(P)for(var $t=0,Nt=Ge.segments.get();$t<Nt.length;$t+=1){var tr=Nt[$t];Fe.push({segments:new _.SegmentVector([tr]),sortKey:tr.sortKey,state:At})}else Fe.push({segments:Ge.segments,sortKey:0,state:At})}}P&&Fe.sort(function(In,Nn){return In.sortKey-Nn.sortKey});for(var mr=0,Nr=Fe;mr<Nr.length;mr+=1){var Fr=Nr[mr],an=Fr.state;an.program.draw(Z,Y.TRIANGLES,ce,ge,_e,lt.disabled,an.uniformValues,p.id,an.layoutVertexBuffer,an.indexBuffer,Fr.segments,p.paint,h.transform.zoom,an.programConfiguration)}}}},heatmap:function(h,d,p,g){if(p.paint.get("heatmap-opacity")!==0)if(h.renderPass==="offscreen"){var S=h.context,w=S.gl,C=Re.disabled,P=new Je([w.ONE,w.ONE],_.Color.transparent,[!0,!0,!0,!0]);(function(Fe,Pe,Xe){var we=Fe.gl;Fe.activeTexture.set(we.TEXTURE1),Fe.viewport.set([0,0,Pe.width/4,Pe.height/4]);var Ge=Xe.heatmapFbo;if(Ge)we.bindTexture(we.TEXTURE_2D,Ge.colorAttachment.get()),Fe.bindFramebuffer.set(Ge.framebuffer);else{var ct=we.createTexture();we.bindTexture(we.TEXTURE_2D,ct),we.texParameteri(we.TEXTURE_2D,we.TEXTURE_WRAP_S,we.CLAMP_TO_EDGE),we.texParameteri(we.TEXTURE_2D,we.TEXTURE_WRAP_T,we.CLAMP_TO_EDGE),we.texParameteri(we.TEXTURE_2D,we.TEXTURE_MIN_FILTER,we.LINEAR),we.texParameteri(we.TEXTURE_2D,we.TEXTURE_MAG_FILTER,we.LINEAR),Ge=Xe.heatmapFbo=Fe.createFramebuffer(Pe.width/4,Pe.height/4,!1),function(At,$t,Nt,tr){var mr=At.gl;mr.texImage2D(mr.TEXTURE_2D,0,mr.RGBA,$t.width/4,$t.height/4,0,mr.RGBA,At.extRenderToTextureHalfFloat?At.extTextureHalfFloat.HALF_FLOAT_OES:mr.UNSIGNED_BYTE,null),tr.colorAttachment.set(Nt)}(Fe,Pe,ct,Ge)}})(S,h,p),S.clear({color:_.Color.transparent});for(var Z=0;Z<g.length;Z++){var Y=g[Z];if(!d.hasRenderableParent(Y)){var ce=d.getTile(Y),ge=ce.getBucket(p);if(ge){var _e=ge.programConfigurations.get(p.id);h.useProgram("heatmap",_e).draw(S,w.TRIANGLES,xe.disabled,C,P,lt.disabled,gh(Y.posMatrix,ce,h.transform.zoom,p.paint.get("heatmap-intensity")),p.id,ge.layoutVertexBuffer,ge.indexBuffer,ge.segments,p.paint,h.transform.zoom,_e)}}}S.viewport.set([0,0,h.width,h.height])}else h.renderPass==="translucent"&&(h.context.setColorMode(h.colorModeForRenderPass()),function(Fe,Pe){var Xe=Fe.context,we=Xe.gl,Ge=Pe.heatmapFbo;if(Ge){Xe.activeTexture.set(we.TEXTURE0),we.bindTexture(we.TEXTURE_2D,Ge.colorAttachment.get()),Xe.activeTexture.set(we.TEXTURE1);var ct=Pe.colorRampTexture;ct||(ct=Pe.colorRampTexture=new _.Texture(Xe,Pe.colorRamp,we.RGBA)),ct.bind(we.LINEAR,we.CLAMP_TO_EDGE),Fe.useProgram("heatmapTexture").draw(Xe,we.TRIANGLES,xe.disabled,Re.disabled,Fe.colorModeForRenderPass(),lt.disabled,function(At,$t,Nt,tr){var mr=_.create();_.ortho(mr,0,At.width,At.height,0,0,1);var Nr=At.context.gl;return{u_matrix:mr,u_world:[Nr.drawingBufferWidth,Nr.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:$t.paint.get("heatmap-opacity")}}(Fe,Pe),Pe.id,Fe.viewportBuffer,Fe.quadTriangleIndexBuffer,Fe.viewportSegments,Pe.paint,Fe.transform.zoom)}}(h,p))},line:function(h,d,p,g){if(h.renderPass==="translucent"){var S=p.paint.get("line-opacity"),w=p.paint.get("line-width");if(S.constantOr(1)!==0&&w.constantOr(1)!==0)for(var C=h.depthModeForSublayer(0,xe.ReadOnly),P=h.colorModeForRenderPass(),Z=p.paint.get("line-dasharray"),Y=p.paint.get("line-pattern"),ce=Y.constantOr(1),ge=p.paint.get("line-gradient"),_e=p.getCrossfadeParameters(),Fe=ce?"linePattern":Z?"lineSDF":ge?"lineGradient":"line",Pe=h.context,Xe=Pe.gl,we=!0,Ge=0,ct=g;Ge<ct.length;Ge+=1){var At=ct[Ge],$t=d.getTile(At);if(!ce||$t.patternsLoaded()){var Nt=$t.getBucket(p);if(Nt){var tr=Nt.programConfigurations.get(p.id),mr=h.context.program.get(),Nr=h.useProgram(Fe,tr),Fr=we||Nr.program!==mr,an=Y.constantOr(null);if(an&&$t.imageAtlas){var In=$t.imageAtlas,Nn=In.patternPositions[an.to.toString()],Un=In.patternPositions[an.from.toString()];Nn&&Un&&tr.setConstantPatternPositions(Nn,Un)}var ji=ce?tf(h,$t,p,_e):Z?np(h,$t,p,Z,_e):ge?ca(h,$t,p,Nt.lineClipsArray.length):Ql(h,$t,p);if(ce)Pe.activeTexture.set(Xe.TEXTURE0),$t.imageAtlasTexture.bind(Xe.LINEAR,Xe.CLAMP_TO_EDGE),tr.updatePaintBuffers(_e);else if(Z&&(Fr||h.lineAtlas.dirty))Pe.activeTexture.set(Xe.TEXTURE0),h.lineAtlas.bind(Pe);else if(ge){var hn=Nt.gradients[p.id],Kn=hn.texture;if(p.gradientVersion!==hn.version){var _i=256;if(p.stepInterpolant){var ti=d.getSource().maxzoom,Xn=At.canonical.z===ti?Math.ceil(1<<h.transform.maxZoom-At.canonical.z):1;_i=_.clamp(_.nextPowerOfTwo(Nt.maxLineLength/_.EXTENT*1024*Xn),256,Pe.maxTextureSize)}hn.gradient=_.renderColorRamp({expression:p.gradientExpression(),evaluationKey:"lineProgress",resolution:_i,image:hn.gradient||void 0,clips:Nt.lineClipsArray}),hn.texture?hn.texture.update(hn.gradient):hn.texture=new _.Texture(Pe,hn.gradient,Xe.RGBA),hn.version=p.gradientVersion,Kn=hn.texture}Pe.activeTexture.set(Xe.TEXTURE0),Kn.bind(p.stepInterpolant?Xe.NEAREST:Xe.LINEAR,Xe.CLAMP_TO_EDGE)}Nr.draw(Pe,Xe.TRIANGLES,C,h.stencilModeForClipping(At),P,lt.disabled,ji,p.id,Nt.layoutVertexBuffer,Nt.indexBuffer,Nt.segments,p.paint,h.transform.zoom,tr,Nt.layoutVertexBuffer2),we=!1}}}}},fill:function(h,d,p,g){var S=p.paint.get("fill-color"),w=p.paint.get("fill-opacity");if(w.constantOr(1)!==0){var C=h.colorModeForRenderPass(),P=p.paint.get("fill-pattern"),Z=h.opaquePassEnabledForLayer()&&!P.constantOr(1)&&S.constantOr(_.Color.transparent).a===1&&w.constantOr(0)===1?"opaque":"translucent";if(h.renderPass===Z){var Y=h.depthModeForSublayer(1,h.renderPass==="opaque"?xe.ReadWrite:xe.ReadOnly);af(h,d,p,g,Y,C,!1)}if(h.renderPass==="translucent"&&p.paint.get("fill-antialias")){var ce=h.depthModeForSublayer(p.getPaintProperty("fill-outline-color")?2:0,xe.ReadOnly);af(h,d,p,g,ce,C,!0)}}},"fill-extrusion":function(h,d,p,g){var S=p.paint.get("fill-extrusion-opacity");if(S!==0&&h.renderPass==="translucent"){var w=new xe(h.context.gl.LEQUAL,xe.ReadWrite,h.depthRangeFor3D);if(S!==1||p.paint.get("fill-extrusion-pattern").constantOr(1))Pc(h,d,p,g,w,Re.disabled,Je.disabled),Pc(h,d,p,g,w,h.stencilModeFor3D(),h.colorModeForRenderPass());else{var C=h.colorModeForRenderPass();Pc(h,d,p,g,w,Re.disabled,C)}}},hillshade:function(h,d,p,g){if(h.renderPass==="offscreen"||h.renderPass==="translucent"){for(var S=h.context,w=h.depthModeForSublayer(0,xe.ReadOnly),C=h.colorModeForRenderPass(),P=h.renderPass==="translucent"?h.stencilConfigForOverlap(g):[{},g],Z=P[0],Y=0,ce=P[1];Y<ce.length;Y+=1){var ge=ce[Y],_e=d.getTile(ge);_e.needsHillshadePrepare&&h.renderPass==="offscreen"?Md(h,_e,p,w,Re.disabled,C):h.renderPass==="translucent"&&Bu(h,_e,p,w,Z[ge.overscaledZ],C)}S.viewport.set([0,0,h.width,h.height])}},raster:function(h,d,p,g){if(h.renderPass==="translucent"&&p.paint.get("raster-opacity")!==0&&g.length)for(var S=h.context,w=S.gl,C=d.getSource(),P=h.useProgram("raster"),Z=h.colorModeForRenderPass(),Y=C instanceof Ue?[{},g]:h.stencilConfigForOverlap(g),ce=Y[0],ge=Y[1],_e=ge[ge.length-1].overscaledZ,Fe=!h.options.moving,Pe=0,Xe=ge;Pe<Xe.length;Pe+=1){var we=Xe[Pe],Ge=h.depthModeForSublayer(we.overscaledZ-_e,p.paint.get("raster-opacity")===1?xe.ReadWrite:xe.ReadOnly,w.LESS),ct=d.getTile(we),At=h.transform.calculatePosMatrix(we.toUnwrapped(),Fe);ct.registerFadeDuration(p.paint.get("raster-fade-duration"));var $t=d.findLoadedParent(we,0),Nt=Of(ct,$t,d,p,h.transform),tr=void 0,mr=void 0,Nr=p.paint.get("raster-resampling")==="nearest"?w.NEAREST:w.LINEAR;S.activeTexture.set(w.TEXTURE0),ct.texture.bind(Nr,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST),S.activeTexture.set(w.TEXTURE1),$t?($t.texture.bind(Nr,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST),tr=Math.pow(2,$t.tileID.overscaledZ-ct.tileID.overscaledZ),mr=[ct.tileID.canonical.x*tr%1,ct.tileID.canonical.y*tr%1]):ct.texture.bind(Nr,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST);var Fr=_h(At,mr||[0,0],tr||1,Nt,p);C instanceof Ue?P.draw(S,w.TRIANGLES,Ge,Re.disabled,Z,lt.disabled,Fr,p.id,C.boundsBuffer,h.quadTriangleIndexBuffer,C.boundsSegments):P.draw(S,w.TRIANGLES,Ge,ce[we.overscaledZ],Z,lt.disabled,Fr,p.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments)}},background:function(h,d,p){var g=p.paint.get("background-color"),S=p.paint.get("background-opacity");if(S!==0){var w=h.context,C=w.gl,P=h.transform,Z=P.tileSize,Y=p.paint.get("background-pattern");if(!h.isPatternMissing(Y)){var ce=!Y&&g.a===1&&S===1&&h.opaquePassEnabledForLayer()?"opaque":"translucent";if(h.renderPass===ce){var ge=Re.disabled,_e=h.depthModeForSublayer(0,ce==="opaque"?xe.ReadWrite:xe.ReadOnly),Fe=h.colorModeForRenderPass(),Pe=h.useProgram(Y?"backgroundPattern":"background"),Xe=P.coveringTiles({tileSize:Z});Y&&(w.activeTexture.set(C.TEXTURE0),h.imageManager.bind(h.context));for(var we=p.getCrossfadeParameters(),Ge=0,ct=Xe;Ge<ct.length;Ge+=1){var At=ct[Ge],$t=h.transform.calculatePosMatrix(At.toUnwrapped()),Nt=Y?tc($t,S,h,Y,{tileID:At,tileSize:Z},we):ec($t,S,g);Pe.draw(w,C.TRIANGLES,_e,ge,Fe,lt.disabled,Nt,p.id,h.tileExtentBuffer,h.quadTriangleIndexBuffer,h.tileExtentSegments)}}}}},debug:function(h,d,p){for(var g=0;g<p.length;g++)of(h,d,p[g])},custom:function(h,d,p){var g=h.context,S=p.implementation;if(h.renderPass==="offscreen"){var w=S.prerender;w&&(h.setCustomLayerDefaults(),g.setColorMode(h.colorModeForRenderPass()),w.call(S,g.gl,h.transform.customLayerMatrix()),g.setDirty(),h.setBaseState())}else if(h.renderPass==="translucent"){h.setCustomLayerDefaults(),g.setColorMode(h.colorModeForRenderPass()),g.setStencilMode(Re.disabled);var C=S.renderingMode==="3d"?new xe(h.context.gl.LEQUAL,xe.ReadWrite,h.depthRangeFor3D):h.depthModeForSublayer(0,xe.ReadOnly);g.setDepthMode(C),S.render(g.gl,h.transform.customLayerMatrix()),g.setDirty(),h.setBaseState(),g.bindFramebuffer.set(null)}}},pa=function(h,d){this.context=new V(h),this.transform=d,this._tileTextures={},this.setup(),this.numSublayers=q.maxUnderzooming+q.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new bl,this.gpuTimers={}};pa.prototype.resize=function(h,d){if(this.width=h*_.browser.devicePixelRatio,this.height=d*_.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var p=0,g=this.style._order;p<g.length;p+=1)this.style._layers[g[p]].resize()},pa.prototype.setup=function(){var h=this.context,d=new _.StructArrayLayout2i4;d.emplaceBack(0,0),d.emplaceBack(_.EXTENT,0),d.emplaceBack(0,_.EXTENT),d.emplaceBack(_.EXTENT,_.EXTENT),this.tileExtentBuffer=h.createVertexBuffer(d,Ya.members),this.tileExtentSegments=_.SegmentVector.simpleSegment(0,0,4,2);var p=new _.StructArrayLayout2i4;p.emplaceBack(0,0),p.emplaceBack(_.EXTENT,0),p.emplaceBack(0,_.EXTENT),p.emplaceBack(_.EXTENT,_.EXTENT),this.debugBuffer=h.createVertexBuffer(p,Ya.members),this.debugSegments=_.SegmentVector.simpleSegment(0,0,4,5);var g=new _.StructArrayLayout4i8;g.emplaceBack(0,0,0,0),g.emplaceBack(_.EXTENT,0,_.EXTENT,0),g.emplaceBack(0,_.EXTENT,0,_.EXTENT),g.emplaceBack(_.EXTENT,_.EXTENT,_.EXTENT,_.EXTENT),this.rasterBoundsBuffer=h.createVertexBuffer(g,dt.members),this.rasterBoundsSegments=_.SegmentVector.simpleSegment(0,0,4,2);var S=new _.StructArrayLayout2i4;S.emplaceBack(0,0),S.emplaceBack(1,0),S.emplaceBack(0,1),S.emplaceBack(1,1),this.viewportBuffer=h.createVertexBuffer(S,Ya.members),this.viewportSegments=_.SegmentVector.simpleSegment(0,0,4,2);var w=new _.StructArrayLayout1ui2;w.emplaceBack(0),w.emplaceBack(1),w.emplaceBack(3),w.emplaceBack(2),w.emplaceBack(0),this.tileBorderIndexBuffer=h.createIndexBuffer(w);var C=new _.StructArrayLayout3ui6;C.emplaceBack(0,1,2),C.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=h.createIndexBuffer(C),this.emptyTexture=new _.Texture(h,{width:1,height:1,data:new Uint8Array([0,0,0,0])},h.gl.RGBA);var P=this.context.gl;this.stencilClearMode=new Re({func:P.ALWAYS,mask:0},0,255,P.ZERO,P.ZERO,P.ZERO)},pa.prototype.clearStencil=function(){var h=this.context,d=h.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var p=_.create();_.ortho(p,0,this.width,this.height,0,0,1),_.scale(p,p,[d.drawingBufferWidth,d.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(h,d.TRIANGLES,xe.disabled,this.stencilClearMode,Je.disabled,lt.disabled,rl(p),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},pa.prototype._renderTileClippingMasks=function(h,d){if(this.currentStencilSource!==h.source&&h.isTileClipped()&&d&&d.length){this.currentStencilSource=h.source;var p=this.context,g=p.gl;this.nextStencilID+d.length>256&&this.clearStencil(),p.setColorMode(Je.disabled),p.setDepthMode(xe.disabled);var S=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var w=0,C=d;w<C.length;w+=1){var P=C[w],Z=this._tileClippingMaskIDs[P.key]=this.nextStencilID++;S.draw(p,g.TRIANGLES,xe.disabled,new Re({func:g.ALWAYS,mask:0},Z,255,g.KEEP,g.KEEP,g.REPLACE),Je.disabled,lt.disabled,rl(P.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},pa.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var h=this.nextStencilID++,d=this.context.gl;return new Re({func:d.NOTEQUAL,mask:255},h,255,d.KEEP,d.KEEP,d.REPLACE)},pa.prototype.stencilModeForClipping=function(h){var d=this.context.gl;return new Re({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[h.key],0,d.KEEP,d.KEEP,d.REPLACE)},pa.prototype.stencilConfigForOverlap=function(h){var d,p=this.context.gl,g=h.sort(function(Z,Y){return Y.overscaledZ-Z.overscaledZ}),S=g[g.length-1].overscaledZ,w=g[0].overscaledZ-S+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();for(var C={},P=0;P<w;P++)C[P+S]=new Re({func:p.GEQUAL,mask:255},P+this.nextStencilID,255,p.KEEP,p.KEEP,p.REPLACE);return this.nextStencilID+=w,[C,g]}return[(d={},d[S]=Re.disabled,d),g]},pa.prototype.colorModeForRenderPass=function(){var h=this.context.gl;return this._showOverdrawInspector?new Je([h.CONSTANT_COLOR,h.ONE],new _.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Je.unblended:Je.alphaBlended},pa.prototype.depthModeForSublayer=function(h,d,p){if(!this.opaquePassEnabledForLayer())return xe.disabled;var g=1-((1+this.currentLayer)*this.numSublayers+h)*this.depthEpsilon;return new xe(p||this.context.gl.LEQUAL,d,[g,g])},pa.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},pa.prototype.render=function(h,d){var p=this;this.style=h,this.options=d,this.lineAtlas=h.lineAtlas,this.imageManager=h.imageManager,this.glyphManager=h.glyphManager,this.symbolFadeChange=h.placement.symbolFadeChange(_.browser.now()),this.imageManager.beginFrame();var g=this.style._order,S=this.style.sourceCaches;for(var w in S){var C=S[w];C.used&&C.prepare(this.context)}var P,Z,Y={},ce={},ge={};for(var _e in S){var Fe=S[_e];Y[_e]=Fe.getVisibleCoordinates(),ce[_e]=Y[_e].slice().reverse(),ge[_e]=Fe.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var Pe=0;Pe<g.length;Pe++)if(this.style._layers[g[Pe]].is3D()){this.opaquePassCutoff=Pe;break}this.renderPass="offscreen";for(var Xe=0,we=g;Xe<we.length;Xe+=1){var Ge=this.style._layers[we[Xe]];if(Ge.hasOffscreenPass()&&!Ge.isHidden(this.transform.zoom)){var ct=ce[Ge.source];(Ge.type==="custom"||ct.length)&&this.renderLayer(this,S[Ge.source],Ge,ct)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:d.showOverdrawInspector?_.Color.black:_.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.depthRangeFor3D=[0,1-(h._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=g.length-1;this.currentLayer>=0;this.currentLayer--){var At=this.style._layers[g[this.currentLayer]],$t=S[At.source],Nt=Y[At.source];this._renderTileClippingMasks(At,Nt),this.renderLayer(this,$t,At,Nt)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<g.length;this.currentLayer++){var tr=this.style._layers[g[this.currentLayer]],mr=S[tr.source],Nr=(tr.type==="symbol"?ge:ce)[tr.source];this._renderTileClippingMasks(tr,Y[tr.source]),this.renderLayer(this,mr,tr,Nr)}this.options.showTileBoundaries&&(_.values(this.style._layers).forEach(function(Fr){Fr.source&&!Fr.isHidden(p.transform.zoom)&&(Fr.source!==(Z&&Z.id)&&(Z=p.style.sourceCaches[Fr.source]),(!P||P.getSource().maxzoom<Z.getSource().maxzoom)&&(P=Z))}),P&&il.debug(this,P,P.getVisibleCoordinates())),this.options.showPadding&&function(Fr){var an=Fr.transform.padding;kf(Fr,Fr.transform.height-(an.top||0),3,xh),kf(Fr,an.bottom||0,3,Df),Eh(Fr,an.left||0,3,ko),Eh(Fr,Fr.transform.width-(an.right||0),3,bh);var In=Fr.transform.centerPoint;(function(Nn,Un,ji,hn){Oc(Nn,Un-1,ji-10,2,20,hn),Oc(Nn,Un-10,ji-1,20,2,hn)})(Fr,In.x,Fr.transform.height-In.y,ap)}(this),this.context.setDefault()},pa.prototype.renderLayer=function(h,d,p,g){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="custom"||g.length)&&(this.id=p.id,this.gpuTimingStart(p),il[p.type](h,d,p,g,this.style.placement.variableOffsets),this.gpuTimingEnd())},pa.prototype.gpuTimingStart=function(h){if(this.options.gpuTiming){var d=this.context.extTimerQuery,p=this.gpuTimers[h.id];p||(p=this.gpuTimers[h.id]={calls:0,cpuTime:0,query:d.createQueryEXT()}),p.calls++,d.beginQueryEXT(d.TIME_ELAPSED_EXT,p.query)}},pa.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var h=this.context.extTimerQuery;h.endQueryEXT(h.TIME_ELAPSED_EXT)}},pa.prototype.collectGpuTimers=function(){var h=this.gpuTimers;return this.gpuTimers={},h},pa.prototype.queryGpuTimers=function(h){var d={};for(var p in h){var g=h[p],S=this.context.extTimerQuery,w=S.getQueryObjectEXT(g.query,S.QUERY_RESULT_EXT)/1e6;S.deleteQueryEXT(g.query),d[p]=w}return d},pa.prototype.translatePosMatrix=function(h,d,p,g,S){if(!p[0]&&!p[1])return h;var w=S?g==="map"?this.transform.angle:0:g==="viewport"?-this.transform.angle:0;if(w){var C=Math.sin(w),P=Math.cos(w);p=[p[0]*P-p[1]*C,p[0]*C+p[1]*P]}var Z=[S?p[0]:ha(d,p[0],this.transform.zoom),S?p[1]:ha(d,p[1],this.transform.zoom),0],Y=new Float32Array(16);return _.translate(Y,h,Z),Y},pa.prototype.saveTileTexture=function(h){var d=this._tileTextures[h.size[0]];d?d.push(h):this._tileTextures[h.size[0]]=[h]},pa.prototype.getTileTexture=function(h){var d=this._tileTextures[h];return d&&d.length>0?d.pop():null},pa.prototype.isPatternMissing=function(h){if(!h)return!1;if(!h.from||!h.to)return!0;var d=this.imageManager.getPattern(h.from.toString()),p=this.imageManager.getPattern(h.to.toString());return!d||!p},pa.prototype.useProgram=function(h,d){this.cache=this.cache||{};var p=""+h+(d?d.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[p]||(this.cache[p]=new ja(this.context,h,fu[h],d,ip[h],this._showOverdrawInspector)),this.cache[p]},pa.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},pa.prototype.setBaseState=function(){var h=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(h.FUNC_ADD)},pa.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=_.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new _.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},pa.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var Ff=function(h,d){this.points=h,this.planes=d};Ff.fromInvProjectionMatrix=function(h,d,p){var g=Math.pow(2,p),S=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(C){return _.transformMat4([],C,h)}).map(function(C){return _.scale$1([],C,1/C[3]/d*g)}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(C){var P=_.sub([],S[C[0]],S[C[1]]),Z=_.sub([],S[C[2]],S[C[1]]),Y=_.normalize([],_.cross([],P,Z)),ce=-_.dot(Y,S[C[1]]);return Y.concat(ce)});return new Ff(S,w)};var du=function(h,d){this.min=h,this.max=d,this.center=_.scale$2([],_.add([],this.min,this.max),.5)};du.prototype.quadrant=function(h){for(var d=[h%2==0,h<2],p=_.clone$2(this.min),g=_.clone$2(this.max),S=0;S<d.length;S++)p[S]=d[S]?this.min[S]:this.center[S],g[S]=d[S]?this.center[S]:this.max[S];return g[2]=this.max[2],new du(p,g)},du.prototype.distanceX=function(h){return Math.max(Math.min(this.max[0],h[0]),this.min[0])-h[0]},du.prototype.distanceY=function(h){return Math.max(Math.min(this.max[1],h[1]),this.min[1])-h[1]},du.prototype.intersects=function(h){for(var d=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],p=!0,g=0;g<h.planes.length;g++){for(var S=h.planes[g],w=0,C=0;C<d.length;C++)w+=_.dot$1(S,d[C])>=0;if(w===0)return 0;w!==d.length&&(p=!1)}if(p)return 2;for(var P=0;P<3;P++){for(var Z=Number.MAX_VALUE,Y=-Number.MAX_VALUE,ce=0;ce<h.points.length;ce++){var ge=h.points[ce][P]-this.min[P];Z=Math.min(Z,ge),Y=Math.max(Y,ge)}if(Y<0||Z>this.max[P]-this.min[P])return 0}return 1};var Rl=function(h,d,p,g){if(h===void 0&&(h=0),d===void 0&&(d=0),p===void 0&&(p=0),g===void 0&&(g=0),isNaN(h)||h<0||isNaN(d)||d<0||isNaN(p)||p<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=h,this.bottom=d,this.left=p,this.right=g};Rl.prototype.interpolate=function(h,d,p){return d.top!=null&&h.top!=null&&(this.top=_.number(h.top,d.top,p)),d.bottom!=null&&h.bottom!=null&&(this.bottom=_.number(h.bottom,d.bottom,p)),d.left!=null&&h.left!=null&&(this.left=_.number(h.left,d.left,p)),d.right!=null&&h.right!=null&&(this.right=_.number(h.right,d.right,p)),this},Rl.prototype.getCenter=function(h,d){var p=_.clamp((this.left+h-this.right)/2,0,h),g=_.clamp((this.top+d-this.bottom)/2,0,d);return new _.Point(p,g)},Rl.prototype.equals=function(h){return this.top===h.top&&this.bottom===h.bottom&&this.left===h.left&&this.right===h.right},Rl.prototype.clone=function(){return new Rl(this.top,this.bottom,this.left,this.right)},Rl.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var ki=function(h,d,p,g,S){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=S===void 0||S,this._minZoom=h||0,this._maxZoom=d||22,this._minPitch=p==null?0:p,this._maxPitch=g==null?60:g,this.setMaxBounds(),this.width=0,this.height=0,this._center=new _.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Rl,this._posMatrixCache={},this._alignedPosMatrixCache={}},Ca={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};ki.prototype.clone=function(){var h=new ki(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return h.tileSize=this.tileSize,h.latRange=this.latRange,h.width=this.width,h.height=this.height,h._center=this._center,h.zoom=this.zoom,h.angle=this.angle,h._fov=this._fov,h._pitch=this._pitch,h._unmodified=this._unmodified,h._edgeInsets=this._edgeInsets.clone(),h._calcMatrices(),h},Ca.minZoom.get=function(){return this._minZoom},Ca.minZoom.set=function(h){this._minZoom!==h&&(this._minZoom=h,this.zoom=Math.max(this.zoom,h))},Ca.maxZoom.get=function(){return this._maxZoom},Ca.maxZoom.set=function(h){this._maxZoom!==h&&(this._maxZoom=h,this.zoom=Math.min(this.zoom,h))},Ca.minPitch.get=function(){return this._minPitch},Ca.minPitch.set=function(h){this._minPitch!==h&&(this._minPitch=h,this.pitch=Math.max(this.pitch,h))},Ca.maxPitch.get=function(){return this._maxPitch},Ca.maxPitch.set=function(h){this._maxPitch!==h&&(this._maxPitch=h,this.pitch=Math.min(this.pitch,h))},Ca.renderWorldCopies.get=function(){return this._renderWorldCopies},Ca.renderWorldCopies.set=function(h){h===void 0?h=!0:h===null&&(h=!1),this._renderWorldCopies=h},Ca.worldSize.get=function(){return this.tileSize*this.scale},Ca.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Ca.size.get=function(){return new _.Point(this.width,this.height)},Ca.bearing.get=function(){return-this.angle/Math.PI*180},Ca.bearing.set=function(h){var d=-_.wrap(h,-180,180)*Math.PI/180;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=_.create$2(),_.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Ca.pitch.get=function(){return this._pitch/Math.PI*180},Ca.pitch.set=function(h){var d=_.clamp(h,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())},Ca.fov.get=function(){return this._fov/Math.PI*180},Ca.fov.set=function(h){h=Math.max(.01,Math.min(60,h)),this._fov!==h&&(this._unmodified=!1,this._fov=h/180*Math.PI,this._calcMatrices())},Ca.zoom.get=function(){return this._zoom},Ca.zoom.set=function(h){var d=Math.min(Math.max(h,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._zoom=d,this.scale=this.zoomScale(d),this.tileZoom=Math.floor(d),this.zoomFraction=d-this.tileZoom,this._constrain(),this._calcMatrices())},Ca.center.get=function(){return this._center},Ca.center.set=function(h){h.lat===this._center.lat&&h.lng===this._center.lng||(this._unmodified=!1,this._center=h,this._constrain(),this._calcMatrices())},Ca.padding.get=function(){return this._edgeInsets.toJSON()},Ca.padding.set=function(h){this._edgeInsets.equals(h)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,h,1),this._calcMatrices())},Ca.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},ki.prototype.isPaddingEqual=function(h){return this._edgeInsets.equals(h)},ki.prototype.interpolatePadding=function(h,d,p){this._unmodified=!1,this._edgeInsets.interpolate(h,d,p),this._constrain(),this._calcMatrices()},ki.prototype.coveringZoomLevel=function(h){var d=(h.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/h.tileSize));return Math.max(0,d)},ki.prototype.getVisibleUnwrappedCoordinates=function(h){var d=[new _.UnwrappedTileID(0,h)];if(this._renderWorldCopies)for(var p=this.pointCoordinate(new _.Point(0,0)),g=this.pointCoordinate(new _.Point(this.width,0)),S=this.pointCoordinate(new _.Point(this.width,this.height)),w=this.pointCoordinate(new _.Point(0,this.height)),C=Math.floor(Math.min(p.x,g.x,S.x,w.x)),P=Math.floor(Math.max(p.x,g.x,S.x,w.x)),Z=C-1;Z<=P+1;Z++)Z!==0&&d.push(new _.UnwrappedTileID(Z,h));return d},ki.prototype.coveringTiles=function(h){var d=this.coveringZoomLevel(h),p=d;if(h.minzoom!==void 0&&d<h.minzoom)return[];h.maxzoom!==void 0&&d>h.maxzoom&&(d=h.maxzoom);var g=_.MercatorCoordinate.fromLngLat(this.center),S=Math.pow(2,d),w=[S*g.x,S*g.y,0],C=Ff.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,d),P=h.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(P=d);var Z=function(Fr){return{aabb:new du([Fr*S,0,0],[(Fr+1)*S,S,0]),zoom:0,x:0,y:0,wrap:Fr,fullyVisible:!1}},Y=[],ce=[],ge=d,_e=h.reparseOverscaled?p:d;if(this._renderWorldCopies)for(var Fe=1;Fe<=3;Fe++)Y.push(Z(-Fe)),Y.push(Z(Fe));for(Y.push(Z(0));Y.length>0;){var Pe=Y.pop(),Xe=Pe.x,we=Pe.y,Ge=Pe.fullyVisible;if(!Ge){var ct=Pe.aabb.intersects(C);if(ct===0)continue;Ge=ct===2}var At=Pe.aabb.distanceX(w),$t=Pe.aabb.distanceY(w),Nt=Math.max(Math.abs(At),Math.abs($t));if(Pe.zoom===ge||Nt>3+(1<<ge-Pe.zoom)-2&&Pe.zoom>=P)ce.push({tileID:new _.OverscaledTileID(Pe.zoom===ge?_e:Pe.zoom,Pe.wrap,Pe.zoom,Xe,we),distanceSq:_.sqrLen([w[0]-.5-Xe,w[1]-.5-we])});else for(var tr=0;tr<4;tr++){var mr=(Xe<<1)+tr%2,Nr=(we<<1)+(tr>>1);Y.push({aabb:Pe.aabb.quadrant(tr),zoom:Pe.zoom+1,x:mr,y:Nr,wrap:Pe.wrap,fullyVisible:Ge})}}return ce.sort(function(Fr,an){return Fr.distanceSq-an.distanceSq}).map(function(Fr){return Fr.tileID})},ki.prototype.resize=function(h,d){this.width=h,this.height=d,this.pixelsToGLUnits=[2/h,-2/d],this._constrain(),this._calcMatrices()},Ca.unmodified.get=function(){return this._unmodified},ki.prototype.zoomScale=function(h){return Math.pow(2,h)},ki.prototype.scaleZoom=function(h){return Math.log(h)/Math.LN2},ki.prototype.project=function(h){var d=_.clamp(h.lat,-this.maxValidLatitude,this.maxValidLatitude);return new _.Point(_.mercatorXfromLng(h.lng)*this.worldSize,_.mercatorYfromLat(d)*this.worldSize)},ki.prototype.unproject=function(h){return new _.MercatorCoordinate(h.x/this.worldSize,h.y/this.worldSize).toLngLat()},Ca.point.get=function(){return this.project(this.center)},ki.prototype.setLocationAtPoint=function(h,d){var p=this.pointCoordinate(d),g=this.pointCoordinate(this.centerPoint),S=this.locationCoordinate(h),w=new _.MercatorCoordinate(S.x-(p.x-g.x),S.y-(p.y-g.y));this.center=this.coordinateLocation(w),this._renderWorldCopies&&(this.center=this.center.wrap())},ki.prototype.locationPoint=function(h){return this.coordinatePoint(this.locationCoordinate(h))},ki.prototype.pointLocation=function(h){return this.coordinateLocation(this.pointCoordinate(h))},ki.prototype.locationCoordinate=function(h){return _.MercatorCoordinate.fromLngLat(h)},ki.prototype.coordinateLocation=function(h){return h.toLngLat()},ki.prototype.pointCoordinate=function(h){var d=[h.x,h.y,0,1],p=[h.x,h.y,1,1];_.transformMat4(d,d,this.pixelMatrixInverse),_.transformMat4(p,p,this.pixelMatrixInverse);var g=d[3],S=p[3],w=d[1]/g,C=p[1]/S,P=d[2]/g,Z=p[2]/S,Y=P===Z?0:(0-P)/(Z-P);return new _.MercatorCoordinate(_.number(d[0]/g,p[0]/S,Y)/this.worldSize,_.number(w,C,Y)/this.worldSize)},ki.prototype.coordinatePoint=function(h){var d=[h.x*this.worldSize,h.y*this.worldSize,0,1];return _.transformMat4(d,d,this.pixelMatrix),new _.Point(d[0]/d[3],d[1]/d[3])},ki.prototype.getBounds=function(){return new _.LngLatBounds().extend(this.pointLocation(new _.Point(0,0))).extend(this.pointLocation(new _.Point(this.width,0))).extend(this.pointLocation(new _.Point(this.width,this.height))).extend(this.pointLocation(new _.Point(0,this.height)))},ki.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new _.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},ki.prototype.setMaxBounds=function(h){h?(this.lngRange=[h.getWest(),h.getEast()],this.latRange=[h.getSouth(),h.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},ki.prototype.calculatePosMatrix=function(h,d){d===void 0&&(d=!1);var p=h.key,g=d?this._alignedPosMatrixCache:this._posMatrixCache;if(g[p])return g[p];var S=h.canonical,w=this.worldSize/this.zoomScale(S.z),C=S.x+Math.pow(2,S.z)*h.wrap,P=_.identity(new Float64Array(16));return _.translate(P,P,[C*w,S.y*w,0]),_.scale(P,P,[w/_.EXTENT,w/_.EXTENT,1]),_.multiply(P,d?this.alignedProjMatrix:this.projMatrix,P),g[p]=new Float32Array(P),g[p]},ki.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},ki.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var h,d,p,g,S=-90,w=90,C=-180,P=180,Z=this.size,Y=this._unmodified;if(this.latRange){var ce=this.latRange;S=_.mercatorYfromLat(ce[1])*this.worldSize,h=(w=_.mercatorYfromLat(ce[0])*this.worldSize)-S<Z.y?Z.y/(w-S):0}if(this.lngRange){var ge=this.lngRange;C=_.mercatorXfromLng(ge[0])*this.worldSize,d=(P=_.mercatorXfromLng(ge[1])*this.worldSize)-C<Z.x?Z.x/(P-C):0}var _e=this.point,Fe=Math.max(d||0,h||0);if(Fe)return this.center=this.unproject(new _.Point(d?(P+C)/2:_e.x,h?(w+S)/2:_e.y)),this.zoom+=this.scaleZoom(Fe),this._unmodified=Y,void(this._constraining=!1);if(this.latRange){var Pe=_e.y,Xe=Z.y/2;Pe-Xe<S&&(g=S+Xe),Pe+Xe>w&&(g=w-Xe)}if(this.lngRange){var we=_e.x,Ge=Z.x/2;we-Ge<C&&(p=C+Ge),we+Ge>P&&(p=P-Ge)}p===void 0&&g===void 0||(this.center=this.unproject(new _.Point(p!==void 0?p:_e.x,g!==void 0?g:_e.y))),this._unmodified=Y,this._constraining=!1}},ki.prototype._calcMatrices=function(){if(this.height){var h=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var d=Math.PI/2+this._pitch,p=this._fov*(.5+h.y/this.height),g=Math.sin(p)*this.cameraToCenterDistance/Math.sin(_.clamp(Math.PI-d-p,.01,Math.PI-.01)),S=this.point,w=S.x,C=S.y,P=1.01*(Math.cos(Math.PI/2-this._pitch)*g+this.cameraToCenterDistance),Z=this.height/50,Y=new Float64Array(16);_.perspective(Y,this._fov,this.width/this.height,Z,P),Y[8]=2*-h.x/this.width,Y[9]=2*h.y/this.height,_.scale(Y,Y,[1,-1,1]),_.translate(Y,Y,[0,0,-this.cameraToCenterDistance]),_.rotateX(Y,Y,this._pitch),_.rotateZ(Y,Y,this.angle),_.translate(Y,Y,[-w,-C,0]),this.mercatorMatrix=_.scale([],Y,[this.worldSize,this.worldSize,this.worldSize]),_.scale(Y,Y,[1,1,_.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=Y,this.invProjMatrix=_.invert([],this.projMatrix);var ce=this.width%2/2,ge=this.height%2/2,_e=Math.cos(this.angle),Fe=Math.sin(this.angle),Pe=w-Math.round(w)+_e*ce+Fe*ge,Xe=C-Math.round(C)+_e*ge+Fe*ce,we=new Float64Array(Y);if(_.translate(we,we,[Pe>.5?Pe-1:Pe,Xe>.5?Xe-1:Xe,0]),this.alignedProjMatrix=we,Y=_.create(),_.scale(Y,Y,[this.width/2,-this.height/2,1]),_.translate(Y,Y,[1,-1,0]),this.labelPlaneMatrix=Y,Y=_.create(),_.scale(Y,Y,[1,-1,1]),_.translate(Y,Y,[-1,-1,0]),_.scale(Y,Y,[2/this.width,2/this.height,1]),this.glCoordMatrix=Y,this.pixelMatrix=_.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(Y=_.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=Y,this._posMatrixCache={},this._alignedPosMatrixCache={}}},ki.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var h=this.pointCoordinate(new _.Point(0,0)),d=[h.x*this.worldSize,h.y*this.worldSize,0,1];return _.transformMat4(d,d,this.pixelMatrix)[3]/this.cameraToCenterDistance},ki.prototype.getCameraPoint=function(){var h=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new _.Point(0,h))},ki.prototype.getCameraQueryGeometry=function(h){var d=this.getCameraPoint();if(h.length===1)return[h[0],d];for(var p=d.x,g=d.y,S=d.x,w=d.y,C=0,P=h;C<P.length;C+=1){var Z=P[C];p=Math.min(p,Z.x),g=Math.min(g,Z.y),S=Math.max(S,Z.x),w=Math.max(w,Z.y)}return[new _.Point(p,g),new _.Point(S,g),new _.Point(S,w),new _.Point(p,w),new _.Point(p,g)]},Object.defineProperties(ki.prototype,Ca);var $s=function(h){var d,p,g,S;this._hashName=h&&encodeURIComponent(h),_.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(d=this._updateHashUnthrottled.bind(this),p=!1,g=null,S=function(){g=null,p&&(d(),g=setTimeout(S,300),p=!1)},function(){return p=!0,g||S(),g})};$s.prototype.addTo=function(h){return this._map=h,_.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},$s.prototype.remove=function(){return _.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},$s.prototype.getHashString=function(h){var d=this._map.getCenter(),p=Math.round(100*this._map.getZoom())/100,g=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),S=Math.pow(10,g),w=Math.round(d.lng*S)/S,C=Math.round(d.lat*S)/S,P=this._map.getBearing(),Z=this._map.getPitch(),Y="";if(Y+=h?"/"+w+"/"+C+"/"+p:p+"/"+C+"/"+w,(P||Z)&&(Y+="/"+Math.round(10*P)/10),Z&&(Y+="/"+Math.round(Z)),this._hashName){var ce=this._hashName,ge=!1,_e=_.window.location.hash.slice(1).split("&").map(function(Fe){var Pe=Fe.split("=")[0];return Pe===ce?(ge=!0,Pe+"="+Y):Fe}).filter(function(Fe){return Fe});return ge||_e.push(ce+"="+Y),"#"+_e.join("&")}return"#"+Y},$s.prototype._getCurrentHash=function(){var h,d=this,p=_.window.location.hash.replace("#","");return this._hashName?(p.split("&").map(function(g){return g.split("=")}).forEach(function(g){g[0]===d._hashName&&(h=g)}),(h&&h[1]||"").split("/")):p.split("/")},$s.prototype._onHashChange=function(){var h=this._getCurrentHash();if(h.length>=3&&!h.some(function(p){return isNaN(p)})){var d=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(h[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:d,pitch:+(h[4]||0)}),!0}return!1},$s.prototype._updateHashUnthrottled=function(){var h=_.window.location.href.replace(/(#.+)?$/,this.getHashString());try{_.window.history.replaceState(_.window.history.state,null,h)}catch(d){}};var Bf={linearity:.3,easing:_.bezier(0,0,.3,1)},Ds=_.extend({deceleration:2500,maxSpeed:1400},Bf),sf=_.extend({deceleration:20,maxSpeed:1400},Bf),op=_.extend({deceleration:1e3,maxSpeed:360},Bf),Sh=_.extend({deceleration:1e3,maxSpeed:90},Bf),Lf=function(h){this._map=h,this.clear()};function Ml(h,d){(!h.duration||h.duration<d.duration)&&(h.duration=d.duration,h.easing=d.easing)}function Fo(h,d,p){var g=p.maxSpeed,S=p.linearity,w=p.deceleration,C=_.clamp(h*S/(d/1e3),-g,g),P=Math.abs(C)/(w*S);return{easing:p.easing,duration:1e3*P,amount:C*(P/2)}}Lf.prototype.clear=function(){this._inertiaBuffer=[]},Lf.prototype.record=function(h){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:_.browser.now(),settings:h})},Lf.prototype._drainInertiaBuffer=function(){for(var h=this._inertiaBuffer,d=_.browser.now();h.length>0&&d-h[0].time>160;)h.shift()},Lf.prototype._onMoveEnd=function(h){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var d={zoom:0,bearing:0,pitch:0,pan:new _.Point(0,0),pinchAround:void 0,around:void 0},p=0,g=this._inertiaBuffer;p<g.length;p+=1){var S=g[p].settings;d.zoom+=S.zoomDelta||0,d.bearing+=S.bearingDelta||0,d.pitch+=S.pitchDelta||0,S.panDelta&&d.pan._add(S.panDelta),S.around&&(d.around=S.around),S.pinchAround&&(d.pinchAround=S.pinchAround)}var w=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,C={};if(d.pan.mag()){var P=Fo(d.pan.mag(),w,_.extend({},Ds,h||{}));C.offset=d.pan.mult(P.amount/d.pan.mag()),C.center=this._map.transform.center,Ml(C,P)}if(d.zoom){var Z=Fo(d.zoom,w,sf);C.zoom=this._map.transform.zoom+Z.amount,Ml(C,Z)}if(d.bearing){var Y=Fo(d.bearing,w,op);C.bearing=this._map.transform.bearing+_.clamp(Y.amount,-179,179),Ml(C,Y)}if(d.pitch){var ce=Fo(d.pitch,w,Sh);C.pitch=this._map.transform.pitch+ce.amount,Ml(C,ce)}if(C.zoom||C.bearing){var ge=d.pinchAround===void 0?d.around:d.pinchAround;C.around=ge?this._map.unproject(ge):this._map.getCenter()}return this.clear(),_.extend(C,{noMoveStart:!0})}};var Ha=function(h){function d(g,S,w,C){C===void 0&&(C={});var P=U.mousePos(S.getCanvasContainer(),w),Z=S.unproject(P);h.call(this,g,_.extend({point:P,lngLat:Z,originalEvent:w},C)),this._defaultPrevented=!1,this.target=S}h&&(d.__proto__=h),(d.prototype=Object.create(h&&h.prototype)).constructor=d;var p={defaultPrevented:{configurable:!0}};return d.prototype.preventDefault=function(){this._defaultPrevented=!0},p.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(d.prototype,p),d}(_.Event),al=function(h){function d(g,S,w){var C=g==="touchend"?w.changedTouches:w.touches,P=U.touchPos(S.getCanvasContainer(),C),Z=P.map(function(ge){return S.unproject(ge)}),Y=P.reduce(function(ge,_e,Fe,Pe){return ge.add(_e.div(Pe.length))},new _.Point(0,0)),ce=S.unproject(Y);h.call(this,g,{points:P,point:Y,lngLats:Z,lngLat:ce,originalEvent:w}),this._defaultPrevented=!1}h&&(d.__proto__=h),(d.prototype=Object.create(h&&h.prototype)).constructor=d;var p={defaultPrevented:{configurable:!0}};return d.prototype.preventDefault=function(){this._defaultPrevented=!0},p.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(d.prototype,p),d}(_.Event),Ah=function(h){function d(g,S,w){h.call(this,g,{originalEvent:w}),this._defaultPrevented=!1}h&&(d.__proto__=h),(d.prototype=Object.create(h&&h.prototype)).constructor=d;var p={defaultPrevented:{configurable:!0}};return d.prototype.preventDefault=function(){this._defaultPrevented=!0},p.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(d.prototype,p),d}(_.Event),qa=function(h,d){this._map=h,this._clickTolerance=d.clickTolerance};qa.prototype.reset=function(){delete this._mousedownPos},qa.prototype.wheel=function(h){return this._firePreventable(new Ah(h.type,this._map,h))},qa.prototype.mousedown=function(h,d){return this._mousedownPos=d,this._firePreventable(new Ha(h.type,this._map,h))},qa.prototype.mouseup=function(h){this._map.fire(new Ha(h.type,this._map,h))},qa.prototype.click=function(h,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||this._map.fire(new Ha(h.type,this._map,h))},qa.prototype.dblclick=function(h){return this._firePreventable(new Ha(h.type,this._map,h))},qa.prototype.mouseover=function(h){this._map.fire(new Ha(h.type,this._map,h))},qa.prototype.mouseout=function(h){this._map.fire(new Ha(h.type,this._map,h))},qa.prototype.touchstart=function(h){return this._firePreventable(new al(h.type,this._map,h))},qa.prototype.touchmove=function(h){this._map.fire(new al(h.type,this._map,h))},qa.prototype.touchend=function(h){this._map.fire(new al(h.type,this._map,h))},qa.prototype.touchcancel=function(h){this._map.fire(new al(h.type,this._map,h))},qa.prototype._firePreventable=function(h){if(this._map.fire(h),h.defaultPrevented)return{}},qa.prototype.isEnabled=function(){return!0},qa.prototype.isActive=function(){return!1},qa.prototype.enable=function(){},qa.prototype.disable=function(){};var vn=function(h){this._map=h};vn.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},vn.prototype.mousemove=function(h){this._map.fire(new Ha(h.type,this._map,h))},vn.prototype.mousedown=function(){this._delayContextMenu=!0},vn.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ha("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},vn.prototype.contextmenu=function(h){this._delayContextMenu?this._contextMenuEvent=h:this._map.fire(new Ha(h.type,this._map,h)),this._map.listens("contextmenu")&&h.preventDefault()},vn.prototype.isEnabled=function(){return!0},vn.prototype.isActive=function(){return!1},vn.prototype.enable=function(){},vn.prototype.disable=function(){};var ks=function(h,d){this._map=h,this._el=h.getCanvasContainer(),this._container=h.getContainer(),this._clickTolerance=d.clickTolerance||1};function uf(h,d){for(var p={},g=0;g<h.length;g++)p[h[g].identifier]=d[g];return p}ks.prototype.isEnabled=function(){return!!this._enabled},ks.prototype.isActive=function(){return!!this._active},ks.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},ks.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},ks.prototype.mousedown=function(h,d){this.isEnabled()&&h.shiftKey&&h.button===0&&(U.disableDrag(),this._startPos=this._lastPos=d,this._active=!0)},ks.prototype.mousemoveWindow=function(h,d){if(this._active){var p=d;if(!(this._lastPos.equals(p)||!this._box&&p.dist(this._startPos)<this._clickTolerance)){var g=this._startPos;this._lastPos=p,this._box||(this._box=U.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",h));var S=Math.min(g.x,p.x),w=Math.max(g.x,p.x),C=Math.min(g.y,p.y),P=Math.max(g.y,p.y);U.setTransform(this._box,"translate("+S+"px,"+C+"px)"),this._box.style.width=w-S+"px",this._box.style.height=P-C+"px"}}},ks.prototype.mouseupWindow=function(h,d){var p=this;if(this._active&&h.button===0){var g=this._startPos,S=d;if(this.reset(),U.suppressClick(),g.x!==S.x||g.y!==S.y)return this._map.fire(new _.Event("boxzoomend",{originalEvent:h})),{cameraAnimation:function(w){return w.fitScreenCoordinates(g,S,p._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",h)}},ks.prototype.keydown=function(h){this._active&&h.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",h))},ks.prototype.blur=function(){this.reset()},ks.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(U.remove(this._box),this._box=null),U.enableDrag(),delete this._startPos,delete this._lastPos},ks.prototype._fireEvent=function(h,d){return this._map.fire(new _.Event(h,{originalEvent:d}))};var rc=function(h){this.reset(),this.numTouches=h.numTouches};rc.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},rc.prototype.touchstart=function(h,d,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=h.timeStamp),p.length===this.numTouches&&(this.centroid=function(g){for(var S=new _.Point(0,0),w=0,C=g;w<C.length;w+=1)S._add(C[w]);return S.div(g.length)}(d),this.touches=uf(p,d)))},rc.prototype.touchmove=function(h,d,p){if(!this.aborted&&this.centroid){var g=uf(p,d);for(var S in this.touches){var w=g[S];(!w||w.dist(this.touches[S])>30)&&(this.aborted=!0)}}},rc.prototype.touchend=function(h,d,p){if((!this.centroid||h.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){var g=!this.aborted&&this.centroid;if(this.reset(),g)return g}};var us=function(h){this.singleTap=new rc(h),this.numTaps=h.numTaps,this.reset()};us.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},us.prototype.touchstart=function(h,d,p){this.singleTap.touchstart(h,d,p)},us.prototype.touchmove=function(h,d,p){this.singleTap.touchmove(h,d,p)},us.prototype.touchend=function(h,d,p){var g=this.singleTap.touchend(h,d,p);if(g){var S=h.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(g)<30;if(S&&w||this.reset(),this.count++,this.lastTime=h.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}};var ga=function(){this._zoomIn=new us({numTouches:1,numTaps:2}),this._zoomOut=new us({numTouches:2,numTaps:1}),this.reset()};ga.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},ga.prototype.touchstart=function(h,d,p){this._zoomIn.touchstart(h,d,p),this._zoomOut.touchstart(h,d,p)},ga.prototype.touchmove=function(h,d,p){this._zoomIn.touchmove(h,d,p),this._zoomOut.touchmove(h,d,p)},ga.prototype.touchend=function(h,d,p){var g=this,S=this._zoomIn.touchend(h,d,p),w=this._zoomOut.touchend(h,d,p);return S?(this._active=!0,h.preventDefault(),setTimeout(function(){return g.reset()},0),{cameraAnimation:function(C){return C.easeTo({duration:300,zoom:C.getZoom()+1,around:C.unproject(S)},{originalEvent:h})}}):w?(this._active=!0,h.preventDefault(),setTimeout(function(){return g.reset()},0),{cameraAnimation:function(C){return C.easeTo({duration:300,zoom:C.getZoom()-1,around:C.unproject(w)},{originalEvent:h})}}):void 0},ga.prototype.touchcancel=function(){this.reset()},ga.prototype.enable=function(){this._enabled=!0},ga.prototype.disable=function(){this._enabled=!1,this.reset()},ga.prototype.isEnabled=function(){return this._enabled},ga.prototype.isActive=function(){return this._active};var Th={0:1,2:2},Yr=function(h){this.reset(),this._clickTolerance=h.clickTolerance||1};Yr.prototype.blur=function(){this.reset()},Yr.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},Yr.prototype._correctButton=function(h,d){return!1},Yr.prototype._move=function(h,d){return{}},Yr.prototype.mousedown=function(h,d){if(!this._lastPoint){var p=U.mouseButton(h);this._correctButton(h,p)&&(this._lastPoint=d,this._eventButton=p)}},Yr.prototype.mousemoveWindow=function(h,d){var p=this._lastPoint;if(p){if(h.preventDefault(),function(g,S){var w=Th[S];return g.buttons===void 0||(g.buttons&w)!==w}(h,this._eventButton))this.reset();else if(this._moved||!(d.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=d,this._move(p,d)}},Yr.prototype.mouseupWindow=function(h){this._lastPoint&&U.mouseButton(h)===this._eventButton&&(this._moved&&U.suppressClick(),this.reset())},Yr.prototype.enable=function(){this._enabled=!0},Yr.prototype.disable=function(){this._enabled=!1,this.reset()},Yr.prototype.isEnabled=function(){return this._enabled},Yr.prototype.isActive=function(){return this._active};var ol=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),(d.prototype=Object.create(h&&h.prototype)).constructor=d,d.prototype.mousedown=function(p,g){h.prototype.mousedown.call(this,p,g),this._lastPoint&&(this._active=!0)},d.prototype._correctButton=function(p,g){return g===0&&!p.ctrlKey},d.prototype._move=function(p,g){return{around:g,panDelta:g.sub(p)}},d}(Yr),Dc=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),(d.prototype=Object.create(h&&h.prototype)).constructor=d,d.prototype._correctButton=function(p,g){return g===0&&p.ctrlKey||g===2},d.prototype._move=function(p,g){var S=.8*(g.x-p.x);if(S)return this._active=!0,{bearingDelta:S}},d.prototype.contextmenu=function(p){p.preventDefault()},d}(Yr),wh=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),(d.prototype=Object.create(h&&h.prototype)).constructor=d,d.prototype._correctButton=function(p,g){return g===0&&p.ctrlKey||g===2},d.prototype._move=function(p,g){var S=-.5*(g.y-p.y);if(S)return this._active=!0,{pitchDelta:S}},d.prototype.contextmenu=function(p){p.preventDefault()},d}(Yr),eu=function(h){this._minTouches=1,this._clickTolerance=h.clickTolerance||1,this.reset()};eu.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new _.Point(0,0)},eu.prototype.touchstart=function(h,d,p){return this._calculateTransform(h,d,p)},eu.prototype.touchmove=function(h,d,p){if(this._active&&!(p.length<this._minTouches))return h.preventDefault(),this._calculateTransform(h,d,p)},eu.prototype.touchend=function(h,d,p){this._calculateTransform(h,d,p),this._active&&p.length<this._minTouches&&this.reset()},eu.prototype.touchcancel=function(){this.reset()},eu.prototype._calculateTransform=function(h,d,p){p.length>0&&(this._active=!0);var g=uf(p,d),S=new _.Point(0,0),w=new _.Point(0,0),C=0;for(var P in g){var Z=g[P],Y=this._touches[P];Y&&(S._add(Z),w._add(Z.sub(Y)),C++,g[P]=Z)}if(this._touches=g,!(C<this._minTouches)&&w.mag()){var ce=w.div(C);if(this._sum._add(ce),!(this._sum.mag()<this._clickTolerance))return{around:S.div(C),panDelta:ce}}},eu.prototype.enable=function(){this._enabled=!0},eu.prototype.disable=function(){this._enabled=!1,this.reset()},eu.prototype.isEnabled=function(){return this._enabled},eu.prototype.isActive=function(){return this._active};var Fs=function(){this.reset()};function Nf(h,d,p){for(var g=0;g<h.length;g++)if(h[g].identifier===p)return d[g]}function Uf(h,d){return Math.log(h/d)/Math.LN2}Fs.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Fs.prototype._start=function(h){},Fs.prototype._move=function(h,d,p){return{}},Fs.prototype.touchstart=function(h,d,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([d[0],d[1]]))},Fs.prototype.touchmove=function(h,d,p){if(this._firstTwoTouches){h.preventDefault();var g=this._firstTwoTouches,S=g[1],w=Nf(p,d,g[0]),C=Nf(p,d,S);if(w&&C){var P=this._aroundCenter?null:w.add(C).div(2);return this._move([w,C],P,h)}}},Fs.prototype.touchend=function(h,d,p){if(this._firstTwoTouches){var g=this._firstTwoTouches,S=g[1],w=Nf(p,d,g[0]),C=Nf(p,d,S);w&&C||(this._active&&U.suppressClick(),this.reset())}},Fs.prototype.touchcancel=function(){this.reset()},Fs.prototype.enable=function(h){this._enabled=!0,this._aroundCenter=!!h&&h.around==="center"},Fs.prototype.disable=function(){this._enabled=!1,this.reset()},Fs.prototype.isEnabled=function(){return this._enabled},Fs.prototype.isActive=function(){return this._active};var Yo=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),(d.prototype=Object.create(h&&h.prototype)).constructor=d,d.prototype.reset=function(){h.prototype.reset.call(this),delete this._distance,delete this._startDistance},d.prototype._start=function(p){this._startDistance=this._distance=p[0].dist(p[1])},d.prototype._move=function(p,g){var S=this._distance;if(this._distance=p[0].dist(p[1]),this._active||!(Math.abs(Uf(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Uf(this._distance,S),pinchAround:g}},d}(Fs);function Lu(h,d){return 180*h.angleWith(d)/Math.PI}var sp=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),(d.prototype=Object.create(h&&h.prototype)).constructor=d,d.prototype.reset=function(){h.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},d.prototype._start=function(p){this._startVector=this._vector=p[0].sub(p[1]),this._minDiameter=p[0].dist(p[1])},d.prototype._move=function(p,g){var S=this._vector;if(this._vector=p[0].sub(p[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Lu(this._vector,S),pinchAround:g}},d.prototype._isBelowThreshold=function(p){this._minDiameter=Math.min(this._minDiameter,p.mag());var g=25/(Math.PI*this._minDiameter)*360,S=Lu(p,this._startVector);return Math.abs(S)<g},d}(Fs);function Il(h){return Math.abs(h.y)>Math.abs(h.x)}var lf=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),(d.prototype=Object.create(h&&h.prototype)).constructor=d,d.prototype.reset=function(){h.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},d.prototype._start=function(p){this._lastPoints=p,Il(p[0].sub(p[1]))&&(this._valid=!1)},d.prototype._move=function(p,g,S){var w=p[0].sub(this._lastPoints[0]),C=p[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(w,C,S.timeStamp),this._valid)return this._lastPoints=p,this._active=!0,{pitchDelta:(w.y+C.y)/2*-.5}},d.prototype.gestureBeginsVertically=function(p,g,S){if(this._valid!==void 0)return this._valid;var w=p.mag()>=2,C=g.mag()>=2;if(w||C){if(!w||!C)return this._firstMove===void 0&&(this._firstMove=S),S-this._firstMove<100&&void 0;var P=p.y>0==g.y>0;return Il(p)&&Il(g)&&P}},d}(Fs),up={panStep:100,bearingStep:15,pitchStep:10},Ct=function(){var h=up;this._panStep=h.panStep,this._bearingStep=h.bearingStep,this._pitchStep=h.pitchStep,this._rotationDisabled=!1};function Ie(h){return h*(2-h)}Ct.prototype.blur=function(){this.reset()},Ct.prototype.reset=function(){this._active=!1},Ct.prototype.keydown=function(h){var d=this;if(!(h.altKey||h.ctrlKey||h.metaKey)){var p=0,g=0,S=0,w=0,C=0;switch(h.keyCode){case 61:case 107:case 171:case 187:p=1;break;case 189:case 109:case 173:p=-1;break;case 37:h.shiftKey?g=-1:(h.preventDefault(),w=-1);break;case 39:h.shiftKey?g=1:(h.preventDefault(),w=1);break;case 38:h.shiftKey?S=1:(h.preventDefault(),C=-1);break;case 40:h.shiftKey?S=-1:(h.preventDefault(),C=1);break;default:return}return this._rotationDisabled&&(g=0,S=0),{cameraAnimation:function(P){var Z=P.getZoom();P.easeTo({duration:300,easeId:"keyboardHandler",easing:Ie,zoom:p?Math.round(Z)+p*(h.shiftKey?2:1):Z,bearing:P.getBearing()+g*d._bearingStep,pitch:P.getPitch()+S*d._pitchStep,offset:[-w*d._panStep,-C*d._panStep],center:P.getCenter()},{originalEvent:h})}}}},Ct.prototype.enable=function(){this._enabled=!0},Ct.prototype.disable=function(){this._enabled=!1,this.reset()},Ct.prototype.isEnabled=function(){return this._enabled},Ct.prototype.isActive=function(){return this._active},Ct.prototype.disableRotation=function(){this._rotationDisabled=!0},Ct.prototype.enableRotation=function(){this._rotationDisabled=!1};var B=function(h,d){this._map=h,this._el=h.getCanvasContainer(),this._handler=d,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,_.bindAll(["_onTimeout"],this)};B.prototype.setZoomRate=function(h){this._defaultZoomRate=h},B.prototype.setWheelZoomRate=function(h){this._wheelZoomRate=h},B.prototype.isEnabled=function(){return!!this._enabled},B.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},B.prototype.isZooming=function(){return!!this._zooming},B.prototype.enable=function(h){this.isEnabled()||(this._enabled=!0,this._aroundCenter=h&&h.around==="center")},B.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},B.prototype.wheel=function(h){if(this.isEnabled()){var d=h.deltaMode===_.window.WheelEvent.DOM_DELTA_LINE?40*h.deltaY:h.deltaY,p=_.browser.now(),g=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,d!==0&&d%4.000244140625==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,h)):this._type||(this._type=Math.abs(g*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),h.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=h,this._delta-=d,this._active||this._start(h)),h.preventDefault()}},B.prototype._onTimeout=function(h){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(h)},B.prototype._start=function(h){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var d=U.mousePos(this._el,h);this._around=_.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(d)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},B.prototype.renderFrame=function(){var h=this;if(this._frameId&&(this._frameId=null,this.isActive())){var d=this._map.transform;if(this._delta!==0){var p=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,g=2/(1+Math.exp(-Math.abs(this._delta*p)));this._delta<0&&g!==0&&(g=1/g);var S=typeof this._targetZoom=="number"?d.zoomScale(this._targetZoom):d.scale;this._targetZoom=Math.min(d.maxZoom,Math.max(d.minZoom,d.scaleZoom(S*g))),this._type==="wheel"&&(this._startZoom=d.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var w,C=typeof this._targetZoom=="number"?this._targetZoom:d.zoom,P=this._startZoom,Z=this._easing,Y=!1;if(this._type==="wheel"&&P&&Z){var ce=Math.min((_.browser.now()-this._lastWheelEventTime)/200,1),ge=Z(ce);w=_.number(P,C,ge),ce<1?this._frameId||(this._frameId=!0):Y=!0}else w=C,Y=!0;return this._active=!0,Y&&(this._active=!1,this._finishTimeout=setTimeout(function(){h._zooming=!1,h._handler._triggerRenderFrame(),delete h._targetZoom,delete h._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!Y,zoomDelta:w-d.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},B.prototype._smoothOutEasing=function(h){var d=_.ease;if(this._prevEase){var p=this._prevEase,g=(_.browser.now()-p.start)/p.duration,S=p.easing(g+.01)-p.easing(g),w=.27/Math.sqrt(S*S+1e-4)*.01,C=Math.sqrt(.0729-w*w);d=_.bezier(w,C,.25,1)}return this._prevEase={start:_.browser.now(),duration:h,easing:d},d},B.prototype.blur=function(){this.reset()},B.prototype.reset=function(){this._active=!1};var Ys=function(h,d){this._clickZoom=h,this._tapZoom=d};Ys.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},Ys.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},Ys.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},Ys.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var me=function(){this.reset()};me.prototype.reset=function(){this._active=!1},me.prototype.blur=function(){this.reset()},me.prototype.dblclick=function(h,d){return h.preventDefault(),{cameraAnimation:function(p){p.easeTo({duration:300,zoom:p.getZoom()+(h.shiftKey?-1:1),around:p.unproject(d)},{originalEvent:h})}}},me.prototype.enable=function(){this._enabled=!0},me.prototype.disable=function(){this._enabled=!1,this.reset()},me.prototype.isEnabled=function(){return this._enabled},me.prototype.isActive=function(){return this._active};var Bo=function(){this._tap=new us({numTouches:1,numTaps:1}),this.reset()};Bo.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},Bo.prototype.touchstart=function(h,d,p){this._swipePoint||(this._tapTime&&h.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=d[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(h,d,p))},Bo.prototype.touchmove=function(h,d,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;var g=d[0],S=g.y-this._swipePoint.y;return this._swipePoint=g,h.preventDefault(),this._active=!0,{zoomDelta:S/128}}}else this._tap.touchmove(h,d,p)},Bo.prototype.touchend=function(h,d,p){this._tapTime?this._swipePoint&&p.length===0&&this.reset():this._tap.touchend(h,d,p)&&(this._tapTime=h.timeStamp)},Bo.prototype.touchcancel=function(){this.reset()},Bo.prototype.enable=function(){this._enabled=!0},Bo.prototype.disable=function(){this._enabled=!1,this.reset()},Bo.prototype.isEnabled=function(){return this._enabled},Bo.prototype.isActive=function(){return this._active};var no=function(h,d,p){this._el=h,this._mousePan=d,this._touchPan=p};no.prototype.enable=function(h){this._inertiaOptions=h||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},no.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},no.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},no.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var vu=function(h,d,p){this._pitchWithRotate=h.pitchWithRotate,this._mouseRotate=d,this._mousePitch=p};vu.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},vu.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},vu.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},vu.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var bs=function(h,d,p,g){this._el=h,this._touchZoom=d,this._touchRotate=p,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0};bs.prototype.enable=function(h){this._touchZoom.enable(h),this._rotationDisabled||this._touchRotate.enable(h),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},bs.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},bs.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},bs.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},bs.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},bs.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var Da=function(h){return h.zoom||h.drag||h.pitch||h.rotate},nc=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),(d.prototype=Object.create(h&&h.prototype)).constructor=d,d}(_.Event);function On(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta}var gn=function(h,d){this._map=h,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Lf(h),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(d),_.bindAll(["handleEvent","handleWindowEvent"],this);var p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[_.window.document,"mousemove",{capture:!0}],[_.window.document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[_.window,"blur",void 0]];for(var g=0,S=this._listeners;g<S.length;g+=1){var w=S[g],C=w[0];U.addEventListener(C,w[1],C===_.window.document?this.handleWindowEvent:this.handleEvent,w[2])}};gn.prototype.destroy=function(){for(var h=0,d=this._listeners;h<d.length;h+=1){var p=d[h],g=p[0];U.removeEventListener(g,p[1],g===_.window.document?this.handleWindowEvent:this.handleEvent,p[2])}},gn.prototype._addDefaultHandlers=function(h){var d=this._map,p=d.getCanvasContainer();this._add("mapEvent",new qa(d,h));var g=d.boxZoom=new ks(d,h);this._add("boxZoom",g);var S=new ga,w=new me;d.doubleClickZoom=new Ys(w,S),this._add("tapZoom",S),this._add("clickZoom",w);var C=new Bo;this._add("tapDragZoom",C);var P=d.touchPitch=new lf;this._add("touchPitch",P);var Z=new Dc(h),Y=new wh(h);d.dragRotate=new vu(h,Z,Y),this._add("mouseRotate",Z,["mousePitch"]),this._add("mousePitch",Y,["mouseRotate"]);var ce=new ol(h),ge=new eu(h);d.dragPan=new no(p,ce,ge),this._add("mousePan",ce),this._add("touchPan",ge,["touchZoom","touchRotate"]);var _e=new sp,Fe=new Yo;d.touchZoomRotate=new bs(p,Fe,_e,C),this._add("touchRotate",_e,["touchPan","touchZoom"]),this._add("touchZoom",Fe,["touchPan","touchRotate"]);var Pe=d.scrollZoom=new B(d,this);this._add("scrollZoom",Pe,["mousePan"]);var Xe=d.keyboard=new Ct;this._add("keyboard",Xe),this._add("blockableMapEvent",new vn(d));for(var we=0,Ge=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];we<Ge.length;we+=1){var ct=Ge[we];h.interactive&&h[ct]&&d[ct].enable(h[ct])}},gn.prototype._add=function(h,d,p){this._handlers.push({handlerName:h,handler:d,allowed:p}),this._handlersById[h]=d},gn.prototype.stop=function(h){if(!this._updatingCamera){for(var d=0,p=this._handlers;d<p.length;d+=1)p[d].handler.reset();this._inertia.clear(),this._fireEvents({},{},h),this._changes=[]}},gn.prototype.isActive=function(){for(var h=0,d=this._handlers;h<d.length;h+=1)if(d[h].handler.isActive())return!0;return!1},gn.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},gn.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},gn.prototype.isMoving=function(){return!!Da(this._eventsInProgress)||this.isZooming()},gn.prototype._blockedByActive=function(h,d,p){for(var g in h)if(g!==p&&(!d||d.indexOf(g)<0))return!0;return!1},gn.prototype.handleWindowEvent=function(h){this.handleEvent(h,h.type+"Window")},gn.prototype._getMapTouches=function(h){for(var d=[],p=0,g=h;p<g.length;p+=1){var S=g[p];this._el.contains(S.target)&&d.push(S)}return d},gn.prototype.handleEvent=function(h,d){this._updatingCamera=!0;for(var p=h.type==="renderFrame"?void 0:h,g={needsRenderFrame:!1},S={},w={},C=h.touches?this._getMapTouches(h.touches):void 0,P=C?U.touchPos(this._el,C):U.mousePos(this._el,h),Z=0,Y=this._handlers;Z<Y.length;Z+=1){var ce=Y[Z],ge=ce.handlerName,_e=ce.handler,Fe=ce.allowed;if(_e.isEnabled()){var Pe=void 0;this._blockedByActive(w,Fe,ge)?_e.reset():_e[d||h.type]&&(Pe=_e[d||h.type](h,P,C),this.mergeHandlerResult(g,S,Pe,ge,p),Pe&&Pe.needsRenderFrame&&this._triggerRenderFrame()),(Pe||_e.isActive())&&(w[ge]=_e)}}var Xe={};for(var we in this._previousActiveHandlers)w[we]||(Xe[we]=p);this._previousActiveHandlers=w,(Object.keys(Xe).length||On(g))&&(this._changes.push([g,S,Xe]),this._triggerRenderFrame()),(Object.keys(w).length||On(g))&&this._map._stop(!0),this._updatingCamera=!1;var Ge=g.cameraAnimation;Ge&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Ge(this._map))},gn.prototype.mergeHandlerResult=function(h,d,p,g,S){if(p){_.extend(h,p);var w={handlerName:g,originalEvent:p.originalEvent||S};p.zoomDelta!==void 0&&(d.zoom=w),p.panDelta!==void 0&&(d.drag=w),p.pitchDelta!==void 0&&(d.pitch=w),p.bearingDelta!==void 0&&(d.rotate=w)}},gn.prototype._applyChanges=function(){for(var h={},d={},p={},g=0,S=this._changes;g<S.length;g+=1){var w=S[g],C=w[0],P=w[1],Z=w[2];C.panDelta&&(h.panDelta=(h.panDelta||new _.Point(0,0))._add(C.panDelta)),C.zoomDelta&&(h.zoomDelta=(h.zoomDelta||0)+C.zoomDelta),C.bearingDelta&&(h.bearingDelta=(h.bearingDelta||0)+C.bearingDelta),C.pitchDelta&&(h.pitchDelta=(h.pitchDelta||0)+C.pitchDelta),C.around!==void 0&&(h.around=C.around),C.pinchAround!==void 0&&(h.pinchAround=C.pinchAround),C.noInertia&&(h.noInertia=C.noInertia),_.extend(d,P),_.extend(p,Z)}this._updateMapTransform(h,d,p),this._changes=[]},gn.prototype._updateMapTransform=function(h,d,p){var g=this._map,S=g.transform;if(!On(h))return this._fireEvents(d,p,!0);var w=h.panDelta,C=h.zoomDelta,P=h.bearingDelta,Z=h.pitchDelta,Y=h.around,ce=h.pinchAround;ce!==void 0&&(Y=ce),g._stop(!0),Y=Y||g.transform.centerPoint;var ge=S.pointLocation(w?Y.sub(w):Y);P&&(S.bearing+=P),Z&&(S.pitch+=Z),C&&(S.zoom+=C),S.setLocationAtPoint(ge,Y),this._map._update(),h.noInertia||this._inertia.record(h),this._fireEvents(d,p,!0)},gn.prototype._fireEvents=function(h,d,p){var g=this,S=Da(this._eventsInProgress),w=Da(h),C={};for(var P in h)this._eventsInProgress[P]||(C[P+"start"]=h[P].originalEvent),this._eventsInProgress[P]=h[P];for(var Z in!S&&w&&this._fireEvent("movestart",w.originalEvent),C)this._fireEvent(Z,C[Z]);for(var Y in w&&this._fireEvent("move",w.originalEvent),h)this._fireEvent(Y,h[Y].originalEvent);var ce,ge={};for(var _e in this._eventsInProgress){var Fe=this._eventsInProgress[_e],Pe=Fe.handlerName,Xe=Fe.originalEvent;this._handlersById[Pe].isActive()||(delete this._eventsInProgress[_e],ge[_e+"end"]=ce=d[Pe]||Xe)}for(var we in ge)this._fireEvent(we,ge[we]);var Ge=Da(this._eventsInProgress);if(p&&(S||w)&&!Ge){this._updatingCamera=!0;var ct=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),At=function($t){return $t!==0&&-g._bearingSnap<$t&&$t<g._bearingSnap};ct?(At(ct.bearing||this._map.getBearing())&&(ct.bearing=0),this._map.easeTo(ct,{originalEvent:ce})):(this._map.fire(new _.Event("moveend",{originalEvent:ce})),At(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},gn.prototype._fireEvent=function(h,d){this._map.fire(new _.Event(h,d?{originalEvent:d}:{}))},gn.prototype._requestFrame=function(){var h=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(d){delete h._frameId,h.handleEvent(new nc("renderFrame",{timeStamp:d})),h._applyChanges()})},gn.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var Bs=function(h){function d(p,g){h.call(this),this._moving=!1,this._zooming=!1,this.transform=p,this._bearingSnap=g.bearingSnap,_.bindAll(["_renderFrameCallback"],this)}return h&&(d.__proto__=h),(d.prototype=Object.create(h&&h.prototype)).constructor=d,d.prototype.getCenter=function(){return new _.LngLat(this.transform.center.lng,this.transform.center.lat)},d.prototype.setCenter=function(p,g){return this.jumpTo({center:p},g)},d.prototype.panBy=function(p,g,S){return p=_.Point.convert(p).mult(-1),this.panTo(this.transform.center,_.extend({offset:p},g),S)},d.prototype.panTo=function(p,g,S){return this.easeTo(_.extend({center:p},g),S)},d.prototype.getZoom=function(){return this.transform.zoom},d.prototype.setZoom=function(p,g){return this.jumpTo({zoom:p},g),this},d.prototype.zoomTo=function(p,g,S){return this.easeTo(_.extend({zoom:p},g),S)},d.prototype.zoomIn=function(p,g){return this.zoomTo(this.getZoom()+1,p,g),this},d.prototype.zoomOut=function(p,g){return this.zoomTo(this.getZoom()-1,p,g),this},d.prototype.getBearing=function(){return this.transform.bearing},d.prototype.setBearing=function(p,g){return this.jumpTo({bearing:p},g),this},d.prototype.getPadding=function(){return this.transform.padding},d.prototype.setPadding=function(p,g){return this.jumpTo({padding:p},g),this},d.prototype.rotateTo=function(p,g,S){return this.easeTo(_.extend({bearing:p},g),S)},d.prototype.resetNorth=function(p,g){return this.rotateTo(0,_.extend({duration:1e3},p),g),this},d.prototype.resetNorthPitch=function(p,g){return this.easeTo(_.extend({bearing:0,pitch:0,duration:1e3},p),g),this},d.prototype.snapToNorth=function(p,g){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(p,g):this},d.prototype.getPitch=function(){return this.transform.pitch},d.prototype.setPitch=function(p,g){return this.jumpTo({pitch:p},g),this},d.prototype.cameraForBounds=function(p,g){p=_.LngLatBounds.convert(p);var S=g&&g.bearing||0;return this._cameraForBoxAndBearing(p.getNorthWest(),p.getSouthEast(),S,g)},d.prototype._cameraForBoxAndBearing=function(p,g,S,w){var C={top:0,bottom:0,right:0,left:0};if(typeof(w=_.extend({padding:C,offset:[0,0],maxZoom:this.transform.maxZoom},w)).padding=="number"){var P=w.padding;w.padding={top:P,bottom:P,right:P,left:P}}w.padding=_.extend(C,w.padding);var Z=this.transform,Y=Z.padding,ce=Z.project(_.LngLat.convert(p)),ge=Z.project(_.LngLat.convert(g)),_e=ce.rotate(-S*Math.PI/180),Fe=ge.rotate(-S*Math.PI/180),Pe=new _.Point(Math.max(_e.x,Fe.x),Math.max(_e.y,Fe.y)),Xe=new _.Point(Math.min(_e.x,Fe.x),Math.min(_e.y,Fe.y)),we=Pe.sub(Xe),Ge=(Z.width-(Y.left+Y.right+w.padding.left+w.padding.right))/we.x,ct=(Z.height-(Y.top+Y.bottom+w.padding.top+w.padding.bottom))/we.y;if(!(ct<0||Ge<0)){var At=Math.min(Z.scaleZoom(Z.scale*Math.min(Ge,ct)),w.maxZoom),$t=typeof w.offset.x=="number"?new _.Point(w.offset.x,w.offset.y):_.Point.convert(w.offset),Nt=new _.Point((w.padding.left-w.padding.right)/2,(w.padding.top-w.padding.bottom)/2).rotate(S*Math.PI/180),tr=$t.add(Nt).mult(Z.scale/Z.zoomScale(At));return{center:Z.unproject(ce.add(ge).div(2).sub(tr)),zoom:At,bearing:S}}_.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},d.prototype.fitBounds=function(p,g,S){return this._fitInternal(this.cameraForBounds(p,g),g,S)},d.prototype.fitScreenCoordinates=function(p,g,S,w,C){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(_.Point.convert(p)),this.transform.pointLocation(_.Point.convert(g)),S,w),w,C)},d.prototype._fitInternal=function(p,g,S){return p?(delete(g=_.extend(p,g)).padding,g.linear?this.easeTo(g,S):this.flyTo(g,S)):this},d.prototype.jumpTo=function(p,g){this.stop();var S=this.transform,w=!1,C=!1,P=!1;return"zoom"in p&&S.zoom!==+p.zoom&&(w=!0,S.zoom=+p.zoom),p.center!==void 0&&(S.center=_.LngLat.convert(p.center)),"bearing"in p&&S.bearing!==+p.bearing&&(C=!0,S.bearing=+p.bearing),"pitch"in p&&S.pitch!==+p.pitch&&(P=!0,S.pitch=+p.pitch),p.padding==null||S.isPaddingEqual(p.padding)||(S.padding=p.padding),this.fire(new _.Event("movestart",g)).fire(new _.Event("move",g)),w&&this.fire(new _.Event("zoomstart",g)).fire(new _.Event("zoom",g)).fire(new _.Event("zoomend",g)),C&&this.fire(new _.Event("rotatestart",g)).fire(new _.Event("rotate",g)).fire(new _.Event("rotateend",g)),P&&this.fire(new _.Event("pitchstart",g)).fire(new _.Event("pitch",g)).fire(new _.Event("pitchend",g)),this.fire(new _.Event("moveend",g))},d.prototype.easeTo=function(p,g){var S=this;this._stop(!1,p.easeId),((p=_.extend({offset:[0,0],duration:500,easing:_.ease},p)).animate===!1||!p.essential&&_.browser.prefersReducedMotion)&&(p.duration=0);var w=this.transform,C=this.getZoom(),P=this.getBearing(),Z=this.getPitch(),Y=this.getPadding(),ce="zoom"in p?+p.zoom:C,ge="bearing"in p?this._normalizeBearing(p.bearing,P):P,_e="pitch"in p?+p.pitch:Z,Fe="padding"in p?p.padding:w.padding,Pe=_.Point.convert(p.offset),Xe=w.centerPoint.add(Pe),we=w.pointLocation(Xe),Ge=_.LngLat.convert(p.center||we);this._normalizeCenter(Ge);var ct,At,$t=w.project(we),Nt=w.project(Ge).sub($t),tr=w.zoomScale(ce-C);p.around&&(ct=_.LngLat.convert(p.around),At=w.locationPoint(ct));var mr={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||ce!==C,this._rotating=this._rotating||P!==ge,this._pitching=this._pitching||_e!==Z,this._padding=!w.isPaddingEqual(Fe),this._easeId=p.easeId,this._prepareEase(g,p.noMoveStart,mr),this._ease(function(Nr){if(S._zooming&&(w.zoom=_.number(C,ce,Nr)),S._rotating&&(w.bearing=_.number(P,ge,Nr)),S._pitching&&(w.pitch=_.number(Z,_e,Nr)),S._padding&&(w.interpolatePadding(Y,Fe,Nr),Xe=w.centerPoint.add(Pe)),ct)w.setLocationAtPoint(ct,At);else{var Fr=w.zoomScale(w.zoom-C),an=ce>C?Math.min(2,tr):Math.max(.5,tr),In=Math.pow(an,1-Nr),Nn=w.unproject($t.add(Nt.mult(Nr*In)).mult(Fr));w.setLocationAtPoint(w.renderWorldCopies?Nn.wrap():Nn,Xe)}S._fireMoveEvents(g)},function(Nr){S._afterEase(g,Nr)},p),this},d.prototype._prepareEase=function(p,g,S){S===void 0&&(S={}),this._moving=!0,g||S.moving||this.fire(new _.Event("movestart",p)),this._zooming&&!S.zooming&&this.fire(new _.Event("zoomstart",p)),this._rotating&&!S.rotating&&this.fire(new _.Event("rotatestart",p)),this._pitching&&!S.pitching&&this.fire(new _.Event("pitchstart",p))},d.prototype._fireMoveEvents=function(p){this.fire(new _.Event("move",p)),this._zooming&&this.fire(new _.Event("zoom",p)),this._rotating&&this.fire(new _.Event("rotate",p)),this._pitching&&this.fire(new _.Event("pitch",p))},d.prototype._afterEase=function(p,g){if(!this._easeId||!g||this._easeId!==g){delete this._easeId;var S=this._zooming,w=this._rotating,C=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,S&&this.fire(new _.Event("zoomend",p)),w&&this.fire(new _.Event("rotateend",p)),C&&this.fire(new _.Event("pitchend",p)),this.fire(new _.Event("moveend",p))}},d.prototype.flyTo=function(p,g){var S=this;if(!p.essential&&_.browser.prefersReducedMotion){var w=_.pick(p,["center","zoom","bearing","pitch","around"]);return this.jumpTo(w,g)}this.stop(),p=_.extend({offset:[0,0],speed:1.2,curve:1.42,easing:_.ease},p);var C=this.transform,P=this.getZoom(),Z=this.getBearing(),Y=this.getPitch(),ce=this.getPadding(),ge="zoom"in p?_.clamp(+p.zoom,C.minZoom,C.maxZoom):P,_e="bearing"in p?this._normalizeBearing(p.bearing,Z):Z,Fe="pitch"in p?+p.pitch:Y,Pe="padding"in p?p.padding:C.padding,Xe=C.zoomScale(ge-P),we=_.Point.convert(p.offset),Ge=C.centerPoint.add(we),ct=C.pointLocation(Ge),At=_.LngLat.convert(p.center||ct);this._normalizeCenter(At);var $t=C.project(ct),Nt=C.project(At).sub($t),tr=p.curve,mr=Math.max(C.width,C.height),Nr=mr/Xe,Fr=Nt.mag();if("minZoom"in p){var an=_.clamp(Math.min(p.minZoom,P,ge),C.minZoom,C.maxZoom),In=mr/C.zoomScale(an-P);tr=Math.sqrt(In/Fr*2)}var Nn=tr*tr;function Un(qn){var $n=(Nr*Nr-mr*mr+(qn?-1:1)*Nn*Nn*Fr*Fr)/(2*(qn?Nr:mr)*Nn*Fr);return Math.log(Math.sqrt($n*$n+1)-$n)}function ji(qn){return(Math.exp(qn)-Math.exp(-qn))/2}function hn(qn){return(Math.exp(qn)+Math.exp(-qn))/2}var Kn=Un(0),_i=function(qn){return hn(Kn)/hn(Kn+tr*qn)},ti=function(qn){return mr*((hn(Kn)*(ji($n=Kn+tr*qn)/hn($n))-ji(Kn))/Nn)/Fr;var $n},Xn=(Un(1)-Kn)/tr;if(Math.abs(Fr)<1e-6||!isFinite(Xn)){if(Math.abs(mr-Nr)<1e-6)return this.easeTo(p,g);var pi=Nr<mr?-1:1;Xn=Math.abs(Math.log(Nr/mr))/tr,ti=function(){return 0},_i=function(qn){return Math.exp(pi*tr*qn)}}return p.duration="duration"in p?+p.duration:1e3*Xn/("screenSpeed"in p?+p.screenSpeed/tr:+p.speed),p.maxDuration&&p.duration>p.maxDuration&&(p.duration=0),this._zooming=!0,this._rotating=Z!==_e,this._pitching=Fe!==Y,this._padding=!C.isPaddingEqual(Pe),this._prepareEase(g,!1),this._ease(function(qn){var $n=qn*Xn,wo=1/_i($n);C.zoom=qn===1?ge:P+C.scaleZoom(wo),S._rotating&&(C.bearing=_.number(Z,_e,qn)),S._pitching&&(C.pitch=_.number(Y,Fe,qn)),S._padding&&(C.interpolatePadding(ce,Pe,qn),Ge=C.centerPoint.add(we));var Na=qn===1?At:C.unproject($t.add(Nt.mult(ti($n))).mult(wo));C.setLocationAtPoint(C.renderWorldCopies?Na.wrap():Na,Ge),S._fireMoveEvents(g)},function(){return S._afterEase(g)},p),this},d.prototype.isEasing=function(){return!!this._easeFrameId},d.prototype.stop=function(){return this._stop()},d.prototype._stop=function(p,g){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var S=this._onEaseEnd;delete this._onEaseEnd,S.call(this,g)}if(!p){var w=this.handlers;w&&w.stop(!1)}return this},d.prototype._ease=function(p,g,S){S.animate===!1||S.duration===0?(p(1),g()):(this._easeStart=_.browser.now(),this._easeOptions=S,this._onEaseFrame=p,this._onEaseEnd=g,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},d.prototype._renderFrameCallback=function(){var p=Math.min((_.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(p)),p<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},d.prototype._normalizeBearing=function(p,g){p=_.wrap(p,-180,180);var S=Math.abs(p-g);return Math.abs(p-360-g)<S&&(p-=360),Math.abs(p+360-g)<S&&(p+=360),p},d.prototype._normalizeCenter=function(p){var g=this.transform;if(g.renderWorldCopies&&!g.lngRange){var S=p.lng-g.center.lng;p.lng+=S>180?-360:S<-180?360:0}},d}(_.Evented),qo=function(h){h===void 0&&(h={}),this.options=h,_.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};qo.prototype.getDefaultPosition=function(){return"bottom-right"},qo.prototype.onAdd=function(h){var d=this.options&&this.options.compact;return this._map=h,this._container=U.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=U.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=U.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),d&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),d===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},qo.prototype.onRemove=function(){U.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},qo.prototype._setElementTitle=function(h,d){var p=this._map._getUIString("AttributionControl."+d);h.title=p,h.setAttribute("aria-label",p)},qo.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},qo.prototype._updateEditLink=function(){var h=this._editLink;h||(h=this._editLink=this._container.querySelector(".mapbox-improve-map"));var d=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||_.config.ACCESS_TOKEN}];if(h){var p=d.reduce(function(g,S,w){return S.value&&(g+=S.key+"="+S.value+(w<d.length-1?"&":"")),g},"?");h.href=_.config.FEEDBACK_URL+"/"+p+(this._map._hash?this._map._hash.getHashString(!0):""),h.rel="noopener nofollow",this._setElementTitle(h,"MapFeedback")}},qo.prototype._updateData=function(h){!h||h.sourceDataType!=="metadata"&&h.sourceDataType!=="visibility"&&h.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},qo.prototype._updateAttributions=function(){if(this._map.style){var h=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?h=h.concat(this.options.customAttribution.map(function(P){return typeof P!="string"?"":P})):typeof this.options.customAttribution=="string"&&h.push(this.options.customAttribution)),this._map.style.stylesheet){var d=this._map.style.stylesheet;this.styleOwner=d.owner,this.styleId=d.id}var p=this._map.style.sourceCaches;for(var g in p){var S=p[g];if(S.used){var w=S.getSource();w.attribution&&h.indexOf(w.attribution)<0&&h.push(w.attribution)}}h.sort(function(P,Z){return P.length-Z.length});var C=(h=h.filter(function(P,Z){for(var Y=Z+1;Y<h.length;Y++)if(h[Y].indexOf(P)>=0)return!1;return!0})).join(" | ");C!==this._attribHTML&&(this._attribHTML=C,h.length?(this._innerContainer.innerHTML=C,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},qo.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var mu=function(){_.bindAll(["_updateLogo"],this),_.bindAll(["_updateCompact"],this)};mu.prototype.onAdd=function(h){this._map=h,this._container=U.create("div","mapboxgl-ctrl");var d=U.create("a","mapboxgl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://www.mapbox.com/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},mu.prototype.onRemove=function(){U.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},mu.prototype.getDefaultPosition=function(){return"bottom-left"},mu.prototype._updateLogo=function(h){h&&h.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},mu.prototype._logoRequired=function(){if(this._map.style){var h=this._map.style.sourceCaches;for(var d in h)if(h[d].getSource().mapbox_logo)return!0;return!1}},mu.prototype._updateCompact=function(){var h=this._container.children;if(h.length){var d=h[0];this._map.getCanvasContainer().offsetWidth<250?d.classList.add("mapboxgl-compact"):d.classList.remove("mapboxgl-compact")}};var ka=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};ka.prototype.add=function(h){var d=++this._id;return this._queue.push({callback:h,id:d,cancelled:!1}),d},ka.prototype.remove=function(h){for(var d=this._currentlyRunning,p=0,g=d?this._queue.concat(d):this._queue;p<g.length;p+=1){var S=g[p];if(S.id===h)return void(S.cancelled=!0)}},ka.prototype.run=function(h){h===void 0&&(h=0);var d=this._currentlyRunning=this._queue;this._queue=[];for(var p=0,g=d;p<g.length;p+=1){var S=g[p];if(!S.cancelled&&(S.callback(h),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},ka.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var Ls={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},qs=_.window.HTMLImageElement,kc=_.window.HTMLElement,ea=_.window.ImageBitmap,To={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Ch=function(h){function d(g){var S=this;if((g=_.extend({},To,g)).minZoom!=null&&g.maxZoom!=null&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(g.minPitch!=null&&g.maxPitch!=null&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(g.minPitch!=null&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(g.maxPitch!=null&&g.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var w=new ki(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies);if(h.call(this,w,g),this._interactive=g.interactive,this._maxTileCacheSize=g.maxTileCacheSize,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._crossSourceCollisions=g.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=g.collectResourceTiming,this._renderTaskQueue=new ka,this._controls=[],this._mapId=_.uniqueId(),this._locale=_.extend({},Ls,g.locale),this._clickTolerance=g.clickTolerance,this._requestManager=new _.RequestManager(g.transformRequest,g.accessToken),typeof g.container=="string"){if(this._container=_.window.document.getElementById(g.container),!this._container)throw new Error("Container '"+g.container+"' not found.")}else{if(!(g.container instanceof kc))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(g.maxBounds&&this.setMaxBounds(g.maxBounds),_.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return S._update(!1)}),this.on("moveend",function(){return S._update(!1)}),this.on("zoom",function(){return S._update(!0)}),_.window!==void 0&&(_.window.addEventListener("online",this._onWindowOnline,!1),_.window.addEventListener("resize",this._onWindowResize,!1),_.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new gn(this,g),this._hash=g.hash&&new $s(typeof g.hash=="string"&&g.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch}),g.bounds&&(this.resize(),this.fitBounds(g.bounds,_.extend({},g.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=g.localIdeographFontFamily,g.style&&this.setStyle(g.style,{localIdeographFontFamily:g.localIdeographFontFamily}),g.attributionControl&&this.addControl(new qo({customAttribution:g.customAttribution})),this.addControl(new mu,g.logoPosition),this.on("style.load",function(){S.transform.unmodified&&S.jumpTo(S.style.stylesheet)}),this.on("data",function(C){S._update(C.dataType==="style"),S.fire(new _.Event(C.dataType+"data",C))}),this.on("dataloading",function(C){S.fire(new _.Event(C.dataType+"dataloading",C))})}h&&(d.__proto__=h),(d.prototype=Object.create(h&&h.prototype)).constructor=d;var p={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return d.prototype._getMapId=function(){return this._mapId},d.prototype.addControl=function(g,S){if(S===void 0&&(S=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new _.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var w=g.onAdd(this);this._controls.push(g);var C=this._controlPositions[S];return S.indexOf("bottom")!==-1?C.insertBefore(w,C.firstChild):C.appendChild(w),this},d.prototype.removeControl=function(g){if(!g||!g.onRemove)return this.fire(new _.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var S=this._controls.indexOf(g);return S>-1&&this._controls.splice(S,1),g.onRemove(this),this},d.prototype.hasControl=function(g){return this._controls.indexOf(g)>-1},d.prototype.resize=function(g){var S=this._containerDimensions(),w=S[0],C=S[1];if(w===this.transform.width&&C===this.transform.height)return this;this._resizeCanvas(w,C),this.transform.resize(w,C),this.painter.resize(w,C);var P=!this._moving;return P&&this.fire(new _.Event("movestart",g)).fire(new _.Event("move",g)),this.fire(new _.Event("resize",g)),P&&this.fire(new _.Event("moveend",g)),this},d.prototype.getBounds=function(){return this.transform.getBounds()},d.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},d.prototype.setMaxBounds=function(g){return this.transform.setMaxBounds(_.LngLatBounds.convert(g)),this._update()},d.prototype.setMinZoom=function(g){if((g=g==null?-2:g)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g&&this.setZoom(g),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},d.prototype.getMinZoom=function(){return this.transform.minZoom},d.prototype.setMaxZoom=function(g){if((g=g==null?22:g)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g&&this.setZoom(g),this;throw new Error("maxZoom must be greater than the current minZoom")},d.prototype.getMaxZoom=function(){return this.transform.maxZoom},d.prototype.setMinPitch=function(g){if((g=g==null?0:g)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g&&this.setPitch(g),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},d.prototype.getMinPitch=function(){return this.transform.minPitch},d.prototype.setMaxPitch=function(g){if((g=g==null?60:g)>60)throw new Error("maxPitch must be less than or equal to 60");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g&&this.setPitch(g),this;throw new Error("maxPitch must be greater than the current minPitch")},d.prototype.getMaxPitch=function(){return this.transform.maxPitch},d.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},d.prototype.setRenderWorldCopies=function(g){return this.transform.renderWorldCopies=g,this._update()},d.prototype.project=function(g){return this.transform.locationPoint(_.LngLat.convert(g))},d.prototype.unproject=function(g){return this.transform.pointLocation(_.Point.convert(g))},d.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},d.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},d.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},d.prototype._createDelegatedListener=function(g,S,w){var C,P=this;if(g==="mouseenter"||g==="mouseover"){var Z=!1;return{layer:S,listener:w,delegates:{mousemove:function(ce){var ge=P.getLayer(S)?P.queryRenderedFeatures(ce.point,{layers:[S]}):[];ge.length?Z||(Z=!0,w.call(P,new Ha(g,P,ce.originalEvent,{features:ge}))):Z=!1},mouseout:function(){Z=!1}}}}if(g==="mouseleave"||g==="mouseout"){var Y=!1;return{layer:S,listener:w,delegates:{mousemove:function(ce){(P.getLayer(S)?P.queryRenderedFeatures(ce.point,{layers:[S]}):[]).length?Y=!0:Y&&(Y=!1,w.call(P,new Ha(g,P,ce.originalEvent)))},mouseout:function(ce){Y&&(Y=!1,w.call(P,new Ha(g,P,ce.originalEvent)))}}}}return{layer:S,listener:w,delegates:(C={},C[g]=function(ce){var ge=P.getLayer(S)?P.queryRenderedFeatures(ce.point,{layers:[S]}):[];ge.length&&(ce.features=ge,w.call(P,ce),delete ce.features)},C)}},d.prototype.on=function(g,S,w){if(w===void 0)return h.prototype.on.call(this,g,S);var C=this._createDelegatedListener(g,S,w);for(var P in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(C),C.delegates)this.on(P,C.delegates[P]);return this},d.prototype.once=function(g,S,w){if(w===void 0)return h.prototype.once.call(this,g,S);var C=this._createDelegatedListener(g,S,w);for(var P in C.delegates)this.once(P,C.delegates[P]);return this},d.prototype.off=function(g,S,w){var C=this;return w===void 0?h.prototype.off.call(this,g,S):(this._delegatedListeners&&this._delegatedListeners[g]&&function(P){for(var Z=P[g],Y=0;Y<Z.length;Y++){var ce=Z[Y];if(ce.layer===S&&ce.listener===w){for(var ge in ce.delegates)C.off(ge,ce.delegates[ge]);return Z.splice(Y,1),C}}}(this._delegatedListeners),this)},d.prototype.queryRenderedFeatures=function(g,S){if(!this.style)return[];var w;if(S!==void 0||g===void 0||g instanceof _.Point||Array.isArray(g)||(S=g,g=void 0),S=S||{},(g=g||[[0,0],[this.transform.width,this.transform.height]])instanceof _.Point||typeof g[0]=="number")w=[_.Point.convert(g)];else{var C=_.Point.convert(g[0]),P=_.Point.convert(g[1]);w=[C,new _.Point(P.x,C.y),P,new _.Point(C.x,P.y),C]}return this.style.queryRenderedFeatures(w,S,this.transform)},d.prototype.querySourceFeatures=function(g,S){return this.style.querySourceFeatures(g,S)},d.prototype.setStyle=function(g,S){return(S=_.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},S)).diff!==!1&&S.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&g?(this._diffStyle(g,S),this):(this._localIdeographFontFamily=S.localIdeographFontFamily,this._updateStyle(g,S))},d.prototype._getUIString=function(g){var S=this._locale[g];if(S==null)throw new Error("Missing UI string '"+g+"'");return S},d.prototype._updateStyle=function(g,S){return this.style&&(this.style.setEventedParent(null),this.style._remove()),g?(this.style=new Ps(this,S||{}),this.style.setEventedParent(this,{style:this.style}),typeof g=="string"?this.style.loadURL(g):this.style.loadJSON(g),this):(delete this.style,this)},d.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new Ps(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},d.prototype._diffStyle=function(g,S){var w=this;if(typeof g=="string"){var C=this._requestManager.normalizeStyleURL(g),P=this._requestManager.transformRequest(C,_.ResourceType.Style);_.getJSON(P,function(Z,Y){Z?w.fire(new _.ErrorEvent(Z)):Y&&w._updateDiff(Y,S)})}else typeof g=="object"&&this._updateDiff(g,S)},d.prototype._updateDiff=function(g,S){try{this.style.setState(g)&&this._update(!0)}catch(w){_.warnOnce("Unable to perform style diff: "+(w.message||w.error||w)+".  Rebuilding the style from scratch."),this._updateStyle(g,S)}},d.prototype.getStyle=function(){if(this.style)return this.style.serialize()},d.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():_.warnOnce("There is no style added to the map.")},d.prototype.addSource=function(g,S){return this._lazyInitEmptyStyle(),this.style.addSource(g,S),this._update(!0)},d.prototype.isSourceLoaded=function(g){var S=this.style&&this.style.sourceCaches[g];if(S!==void 0)return S.loaded();this.fire(new _.ErrorEvent(new Error("There is no source with ID '"+g+"'")))},d.prototype.areTilesLoaded=function(){var g=this.style&&this.style.sourceCaches;for(var S in g){var w=g[S]._tiles;for(var C in w){var P=w[C];if(P.state!=="loaded"&&P.state!=="errored")return!1}}return!0},d.prototype.addSourceType=function(g,S,w){return this._lazyInitEmptyStyle(),this.style.addSourceType(g,S,w)},d.prototype.removeSource=function(g){return this.style.removeSource(g),this._update(!0)},d.prototype.getSource=function(g){return this.style.getSource(g)},d.prototype.addImage=function(g,S,w){w===void 0&&(w={});var C=w.pixelRatio;C===void 0&&(C=1);var P=w.sdf;P===void 0&&(P=!1);var Z=w.stretchX,Y=w.stretchY,ce=w.content;if(this._lazyInitEmptyStyle(),S instanceof qs||ea&&S instanceof ea){var ge=_.browser.getImageData(S);this.style.addImage(g,{data:new _.RGBAImage({width:ge.width,height:ge.height},ge.data),pixelRatio:C,stretchX:Z,stretchY:Y,content:ce,sdf:P,version:0})}else{if(S.width===void 0||S.height===void 0)return this.fire(new _.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var _e=S;this.style.addImage(g,{data:new _.RGBAImage({width:S.width,height:S.height},new Uint8Array(S.data)),pixelRatio:C,stretchX:Z,stretchY:Y,content:ce,sdf:P,version:0,userImage:_e}),_e.onAdd&&_e.onAdd(this,g)}},d.prototype.updateImage=function(g,S){var w=this.style.getImage(g);if(!w)return this.fire(new _.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var C=S instanceof qs||ea&&S instanceof ea?_.browser.getImageData(S):S,P=C.width,Z=C.height,Y=C.data;return P===void 0||Z===void 0?this.fire(new _.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):P!==w.data.width||Z!==w.data.height?this.fire(new _.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(w.data.replace(Y,!(S instanceof qs||ea&&S instanceof ea)),void this.style.updateImage(g,w))},d.prototype.hasImage=function(g){return g?!!this.style.getImage(g):(this.fire(new _.ErrorEvent(new Error("Missing required image id"))),!1)},d.prototype.removeImage=function(g){this.style.removeImage(g)},d.prototype.loadImage=function(g,S){_.getImage(this._requestManager.transformRequest(g,_.ResourceType.Image),S)},d.prototype.listImages=function(){return this.style.listImages()},d.prototype.addLayer=function(g,S){return this._lazyInitEmptyStyle(),this.style.addLayer(g,S),this._update(!0)},d.prototype.moveLayer=function(g,S){return this.style.moveLayer(g,S),this._update(!0)},d.prototype.removeLayer=function(g){return this.style.removeLayer(g),this._update(!0)},d.prototype.getLayer=function(g){return this.style.getLayer(g)},d.prototype.setLayerZoomRange=function(g,S,w){return this.style.setLayerZoomRange(g,S,w),this._update(!0)},d.prototype.setFilter=function(g,S,w){return w===void 0&&(w={}),this.style.setFilter(g,S,w),this._update(!0)},d.prototype.getFilter=function(g){return this.style.getFilter(g)},d.prototype.setPaintProperty=function(g,S,w,C){return C===void 0&&(C={}),this.style.setPaintProperty(g,S,w,C),this._update(!0)},d.prototype.getPaintProperty=function(g,S){return this.style.getPaintProperty(g,S)},d.prototype.setLayoutProperty=function(g,S,w,C){return C===void 0&&(C={}),this.style.setLayoutProperty(g,S,w,C),this._update(!0)},d.prototype.getLayoutProperty=function(g,S){return this.style.getLayoutProperty(g,S)},d.prototype.setLight=function(g,S){return S===void 0&&(S={}),this._lazyInitEmptyStyle(),this.style.setLight(g,S),this._update(!0)},d.prototype.getLight=function(){return this.style.getLight()},d.prototype.setFeatureState=function(g,S){return this.style.setFeatureState(g,S),this._update()},d.prototype.removeFeatureState=function(g,S){return this.style.removeFeatureState(g,S),this._update()},d.prototype.getFeatureState=function(g){return this.style.getFeatureState(g)},d.prototype.getContainer=function(){return this._container},d.prototype.getCanvasContainer=function(){return this._canvasContainer},d.prototype.getCanvas=function(){return this._canvas},d.prototype._containerDimensions=function(){var g=0,S=0;return this._container&&(g=this._container.clientWidth||400,S=this._container.clientHeight||300),[g,S]},d.prototype._detectMissingCSS=function(){_.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&_.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},d.prototype._setupContainer=function(){var g=this._container;g.classList.add("mapboxgl-map"),(this._missingCSSCanary=U.create("div","mapboxgl-canary",g)).style.visibility="hidden",this._detectMissingCSS();var S=this._canvasContainer=U.create("div","mapboxgl-canvas-container",g);this._interactive&&S.classList.add("mapboxgl-interactive"),this._canvas=U.create("canvas","mapboxgl-canvas",S),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var w=this._containerDimensions();this._resizeCanvas(w[0],w[1]);var C=this._controlContainer=U.create("div","mapboxgl-control-container",g),P=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(Z){P[Z]=U.create("div","mapboxgl-ctrl-"+Z,C)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},d.prototype._resizeCanvas=function(g,S){var w=_.browser.devicePixelRatio||1;this._canvas.width=w*g,this._canvas.height=w*S,this._canvas.style.width=g+"px",this._canvas.style.height=S+"px"},d.prototype._setupPainter=function(){var g=_.extend({},le.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),S=this._canvas.getContext("webgl",g)||this._canvas.getContext("experimental-webgl",g);S?(this.painter=new pa(S,this.transform),_.webpSupported.testSupport(S)):this.fire(new _.ErrorEvent(new Error("Failed to initialize WebGL")))},d.prototype._contextLost=function(g){g.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new _.Event("webglcontextlost",{originalEvent:g}))},d.prototype._contextRestored=function(g){this._setupPainter(),this.resize(),this._update(),this.fire(new _.Event("webglcontextrestored",{originalEvent:g}))},d.prototype._onMapScroll=function(g){if(g.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},d.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},d.prototype._update=function(g){return this.style?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this},d.prototype._requestRenderFrame=function(g){return this._update(),this._renderTaskQueue.add(g)},d.prototype._cancelRenderFrame=function(g){this._renderTaskQueue.remove(g)},d.prototype._render=function(g){var S,w=this,C=0,P=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(S=P.createQueryEXT(),P.beginQueryEXT(P.TIME_ELAPSED_EXT,S),C=_.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(g),!this._removed){var Z=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var Y=this.transform.zoom,ce=_.browser.now();this.style.zoomHistory.update(Y,ce);var ge=new _.EvaluationParameters(Y,{now:ce,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),_e=ge.crossFadingFactor();_e===1&&_e===this._crossFadingFactor||(Z=!0,this._crossFadingFactor=_e),this.style.update(ge)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new _.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new _.Event("load"))),this.style&&(this.style.hasTransitions()||Z)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var Fe=_.browser.now()-C;P.endQueryEXT(P.TIME_ELAPSED_EXT,S),setTimeout(function(){var we=P.getQueryObjectEXT(S,P.QUERY_RESULT_EXT)/1e6;P.deleteQueryEXT(S),w.fire(new _.Event("gpu-timing-frame",{cpuTime:Fe,gpuTime:we}))},50)}if(this.listens("gpu-timing-layer")){var Pe=this.painter.collectGpuTimers();setTimeout(function(){var we=w.painter.queryGpuTimers(Pe);w.fire(new _.Event("gpu-timing-layer",{layerTimes:we}))},50)}var Xe=this._sourcesDirty||this._styleDirty||this._placementDirty;return Xe||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new _.Event("idle")),!this._loaded||this._fullyLoaded||Xe||(this._fullyLoaded=!0),this}},d.prototype.remove=function(){this._hash&&this._hash.remove();for(var g=0,S=this._controls;g<S.length;g+=1)S[g].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),_.window!==void 0&&(_.window.removeEventListener("resize",this._onWindowResize,!1),_.window.removeEventListener("orientationchange",this._onWindowResize,!1),_.window.removeEventListener("online",this._onWindowOnline,!1));var w=this.painter.context.gl.getExtension("WEBGL_lose_context");w&&w.loseContext(),Pl(this._canvasContainer),Pl(this._controlContainer),Pl(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new _.Event("remove"))},d.prototype.triggerRepaint=function(){var g=this;this.style&&!this._frame&&(this._frame=_.browser.frame(function(S){g._frame=null,g._render(S)}))},d.prototype._onWindowOnline=function(){this._update()},d.prototype._onWindowResize=function(g){this._trackResize&&this.resize({originalEvent:g})._update()},p.showTileBoundaries.get=function(){return!!this._showTileBoundaries},p.showTileBoundaries.set=function(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())},p.showPadding.get=function(){return!!this._showPadding},p.showPadding.set=function(g){this._showPadding!==g&&(this._showPadding=g,this._update())},p.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},p.showCollisionBoxes.set=function(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())},p.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},p.showOverdrawInspector.set=function(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())},p.repaint.get=function(){return!!this._repaint},p.repaint.set=function(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())},p.vertices.get=function(){return!!this._vertices},p.vertices.set=function(g){this._vertices=g,this._update()},d.prototype._setCacheLimits=function(g,S){_.setCacheLimits(g,S)},p.version.get=function(){return _.version},Object.defineProperties(d.prototype,p),d}(Bs);function Pl(h){h.parentNode&&h.parentNode.removeChild(h)}var zf={showCompass:!0,showZoom:!0,visualizePitch:!1},gu=function(h){var d=this;this.options=_.extend({},zf,h),this._container=U.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(p){return p.preventDefault()}),this.options.showZoom&&(_.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(p){return d._map.zoomIn({},{originalEvent:p})}),U.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(p){return d._map.zoomOut({},{originalEvent:p})}),U.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(_.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(p){d.options.visualizePitch?d._map.resetNorthPitch({},{originalEvent:p}):d._map.resetNorth({},{originalEvent:p})}),this._compassIcon=U.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};gu.prototype._updateZoomButtons=function(){var h=this._map.getZoom(),d=h===this._map.getMaxZoom(),p=h===this._map.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())},gu.prototype._rotateCompassArrow=function(){var h=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=h},gu.prototype.onAdd=function(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Es(this._map,this._compass,this.options.visualizePitch)),this._container},gu.prototype.onRemove=function(){U.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},gu.prototype._createButton=function(h,d){var p=U.create("button",h,this._container);return p.type="button",p.addEventListener("click",d),p},gu.prototype._setButtonTitle=function(h,d){var p=this._map._getUIString("NavigationControl."+d);h.title=p,h.setAttribute("aria-label",p)};var Es=function(h,d,p){p===void 0&&(p=!1),this._clickTolerance=10,this.element=d,this.mouseRotate=new Dc({clickTolerance:h.dragRotate._mouseRotate._clickTolerance}),this.map=h,p&&(this.mousePitch=new wh({clickTolerance:h.dragRotate._mousePitch._clickTolerance})),_.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),U.addEventListener(d,"mousedown",this.mousedown),U.addEventListener(d,"touchstart",this.touchstart,{passive:!1}),U.addEventListener(d,"touchmove",this.touchmove),U.addEventListener(d,"touchend",this.touchend),U.addEventListener(d,"touchcancel",this.reset)};function ic(h,d,p){if(h=new _.LngLat(h.lng,h.lat),d){var g=new _.LngLat(h.lng-360,h.lat),S=new _.LngLat(h.lng+360,h.lat),w=p.locationPoint(h).distSqr(d);p.locationPoint(g).distSqr(d)<w?h=g:p.locationPoint(S).distSqr(d)<w&&(h=S)}for(;Math.abs(h.lng-p.center.lng)>180;){var C=p.locationPoint(h);if(C.x>=0&&C.y>=0&&C.x<=p.width&&C.y<=p.height)break;h.lng>p.center.lng?h.lng-=360:h.lng+=360}return h}Es.prototype.down=function(h,d){this.mouseRotate.mousedown(h,d),this.mousePitch&&this.mousePitch.mousedown(h,d),U.disableDrag()},Es.prototype.move=function(h,d){var p=this.map,g=this.mouseRotate.mousemoveWindow(h,d);if(g&&g.bearingDelta&&p.setBearing(p.getBearing()+g.bearingDelta),this.mousePitch){var S=this.mousePitch.mousemoveWindow(h,d);S&&S.pitchDelta&&p.setPitch(p.getPitch()+S.pitchDelta)}},Es.prototype.off=function(){var h=this.element;U.removeEventListener(h,"mousedown",this.mousedown),U.removeEventListener(h,"touchstart",this.touchstart,{passive:!1}),U.removeEventListener(h,"touchmove",this.touchmove),U.removeEventListener(h,"touchend",this.touchend),U.removeEventListener(h,"touchcancel",this.reset),this.offTemp()},Es.prototype.offTemp=function(){U.enableDrag(),U.removeEventListener(_.window,"mousemove",this.mousemove),U.removeEventListener(_.window,"mouseup",this.mouseup)},Es.prototype.mousedown=function(h){this.down(_.extend({},h,{ctrlKey:!0,preventDefault:function(){return h.preventDefault()}}),U.mousePos(this.element,h)),U.addEventListener(_.window,"mousemove",this.mousemove),U.addEventListener(_.window,"mouseup",this.mouseup)},Es.prototype.mousemove=function(h){this.move(h,U.mousePos(this.element,h))},Es.prototype.mouseup=function(h){this.mouseRotate.mouseupWindow(h),this.mousePitch&&this.mousePitch.mouseupWindow(h),this.offTemp()},Es.prototype.touchstart=function(h){h.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=U.touchPos(this.element,h.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return h.preventDefault()}},this._startPos))},Es.prototype.touchmove=function(h){h.targetTouches.length!==1?this.reset():(this._lastPos=U.touchPos(this.element,h.targetTouches)[0],this.move({preventDefault:function(){return h.preventDefault()}},this._lastPos))},Es.prototype.touchend=function(h){h.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},Es.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var Nu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Zf(h,d,p){var g=h.classList;for(var S in Nu)g.remove("mapboxgl-"+p+"-anchor-"+S);g.add("mapboxgl-"+p+"-anchor-"+d)}var Fc,cf=function(h){function d(p,g){if(h.call(this),(p instanceof _.window.HTMLElement||g)&&(p=_.extend({element:p},g)),_.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=p&&p.anchor||"center",this._color=p&&p.color||"#3FB1CE",this._scale=p&&p.scale||1,this._draggable=p&&p.draggable||!1,this._clickTolerance=p&&p.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=p&&p.rotation||0,this._rotationAlignment=p&&p.rotationAlignment||"auto",this._pitchAlignment=p&&p.pitchAlignment&&p.pitchAlignment!=="auto"?p.pitchAlignment:this._rotationAlignment,p&&p.element)this._element=p.element,this._offset=_.Point.convert(p&&p.offset||[0,0]);else{this._defaultMarker=!0,this._element=U.create("div"),this._element.setAttribute("aria-label","Map marker");var S=U.createNS("http://www.w3.org/2000/svg","svg");S.setAttributeNS(null,"display","block"),S.setAttributeNS(null,"height","41px"),S.setAttributeNS(null,"width","27px"),S.setAttributeNS(null,"viewBox","0 0 27 41");var w=U.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"stroke","none"),w.setAttributeNS(null,"stroke-width","1"),w.setAttributeNS(null,"fill","none"),w.setAttributeNS(null,"fill-rule","evenodd");var C=U.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"fill-rule","nonzero");var P=U.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"transform","translate(3.0, 29.0)"),P.setAttributeNS(null,"fill","#000000");for(var Z=0,Y=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];Z<Y.length;Z+=1){var ce=Y[Z],ge=U.createNS("http://www.w3.org/2000/svg","ellipse");ge.setAttributeNS(null,"opacity","0.04"),ge.setAttributeNS(null,"cx","10.5"),ge.setAttributeNS(null,"cy","5.80029008"),ge.setAttributeNS(null,"rx",ce.rx),ge.setAttributeNS(null,"ry",ce.ry),P.appendChild(ge)}var _e=U.createNS("http://www.w3.org/2000/svg","g");_e.setAttributeNS(null,"fill",this._color);var Fe=U.createNS("http://www.w3.org/2000/svg","path");Fe.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),_e.appendChild(Fe);var Pe=U.createNS("http://www.w3.org/2000/svg","g");Pe.setAttributeNS(null,"opacity","0.25"),Pe.setAttributeNS(null,"fill","#000000");var Xe=U.createNS("http://www.w3.org/2000/svg","path");Xe.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Pe.appendChild(Xe);var we=U.createNS("http://www.w3.org/2000/svg","g");we.setAttributeNS(null,"transform","translate(6.0, 7.0)"),we.setAttributeNS(null,"fill","#FFFFFF");var Ge=U.createNS("http://www.w3.org/2000/svg","g");Ge.setAttributeNS(null,"transform","translate(8.0, 8.0)");var ct=U.createNS("http://www.w3.org/2000/svg","circle");ct.setAttributeNS(null,"fill","#000000"),ct.setAttributeNS(null,"opacity","0.25"),ct.setAttributeNS(null,"cx","5.5"),ct.setAttributeNS(null,"cy","5.5"),ct.setAttributeNS(null,"r","5.4999962");var At=U.createNS("http://www.w3.org/2000/svg","circle");At.setAttributeNS(null,"fill","#FFFFFF"),At.setAttributeNS(null,"cx","5.5"),At.setAttributeNS(null,"cy","5.5"),At.setAttributeNS(null,"r","5.4999962"),Ge.appendChild(ct),Ge.appendChild(At),C.appendChild(P),C.appendChild(_e),C.appendChild(Pe),C.appendChild(we),C.appendChild(Ge),S.appendChild(C),S.setAttributeNS(null,"height",41*this._scale+"px"),S.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(S),this._offset=_.Point.convert(p&&p.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function($t){$t.preventDefault()}),this._element.addEventListener("mousedown",function($t){$t.preventDefault()}),Zf(this._element,this._anchor,"marker"),this._popup=null}return h&&(d.__proto__=h),(d.prototype=Object.create(h&&h.prototype)).constructor=d,d.prototype.addTo=function(p){return this.remove(),this._map=p,p.getCanvasContainer().appendChild(this._element),p.on("move",this._update),p.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},d.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),U.remove(this._element),this._popup&&this._popup.remove(),this},d.prototype.getLngLat=function(){return this._lngLat},d.prototype.setLngLat=function(p){return this._lngLat=_.LngLat.convert(p),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},d.prototype.getElement=function(){return this._element},d.prototype.setPopup=function(p){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),p){if(!("offset"in p.options)){var g=Math.sqrt(Math.pow(13.5,2)/2);p.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(24.6+g)],"bottom-right":[-g,-1*(24.6+g)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=p,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},d.prototype._onKeyPress=function(p){var g=p.code,S=p.charCode||p.keyCode;g!=="Space"&&g!=="Enter"&&S!==32&&S!==13||this.togglePopup()},d.prototype._onMapClick=function(p){var g=p.originalEvent.target,S=this._element;this._popup&&(g===S||S.contains(g))&&this.togglePopup()},d.prototype.getPopup=function(){return this._popup},d.prototype.togglePopup=function(){var p=this._popup;return p?(p.isOpen()?p.remove():p.addTo(this._map),this):this},d.prototype._update=function(p){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=ic(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var g="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?g="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(g="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var S="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?S="rotateX(0deg)":this._pitchAlignment==="map"&&(S="rotateX("+this._map.getPitch()+"deg)"),p&&p.type!=="moveend"||(this._pos=this._pos.round()),U.setTransform(this._element,Nu[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+S+" "+g)}},d.prototype.getOffset=function(){return this._offset},d.prototype.setOffset=function(p){return this._offset=_.Point.convert(p),this._update(),this},d.prototype._onMove=function(p){if(!this._isDragging){var g=this._clickTolerance||this._map._clickTolerance;this._isDragging=p.point.dist(this._pointerdownPos)>=g}this._isDragging&&(this._pos=p.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new _.Event("dragstart"))),this.fire(new _.Event("drag")))},d.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new _.Event("dragend")),this._state="inactive"},d.prototype._addDragHandler=function(p){this._element.contains(p.originalEvent.target)&&(p.preventDefault(),this._positionDelta=p.point.sub(this._pos).add(this._offset),this._pointerdownPos=p.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},d.prototype.setDraggable=function(p){return this._draggable=!!p,this._map&&(p?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},d.prototype.isDraggable=function(){return this._draggable},d.prototype.setRotation=function(p){return this._rotation=p||0,this._update(),this},d.prototype.getRotation=function(){return this._rotation},d.prototype.setRotationAlignment=function(p){return this._rotationAlignment=p||"auto",this._update(),this},d.prototype.getRotationAlignment=function(){return this._rotationAlignment},d.prototype.setPitchAlignment=function(p){return this._pitchAlignment=p&&p!=="auto"?p:this._rotationAlignment,this._update(),this},d.prototype.getPitchAlignment=function(){return this._pitchAlignment},d}(_.Evented),Vf={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},ac=0,oc=!1,Uu=function(h){function d(p){h.call(this),this.options=_.extend({},Vf,p),_.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return h&&(d.__proto__=h),(d.prototype=Object.create(h&&h.prototype)).constructor=d,d.prototype.onAdd=function(p){var g;return this._map=p,this._container=U.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),g=this._setupUI,Fc!==void 0?g(Fc):_.window.navigator.permissions!==void 0?_.window.navigator.permissions.query({name:"geolocation"}).then(function(S){g(Fc=S.state!=="denied")}):g(Fc=!!_.window.navigator.geolocation),this._container},d.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(_.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),U.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,ac=0,oc=!1},d.prototype._isOutOfMapMaxBounds=function(p){var g=this._map.getMaxBounds(),S=p.coords;return g&&(S.longitude<g.getWest()||S.longitude>g.getEast()||S.latitude<g.getSouth()||S.latitude>g.getNorth())},d.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},d.prototype._onSuccess=function(p){if(this._map){if(this._isOutOfMapMaxBounds(p))return this._setErrorState(),this.fire(new _.Event("outofmaxbounds",p)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=p,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(p),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(p),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new _.Event("geolocate",p)),this._finish()}},d.prototype._updateCamera=function(p){var g=new _.LngLat(p.coords.longitude,p.coords.latitude),S=p.coords.accuracy,w=this._map.getBearing(),C=_.extend({bearing:w},this.options.fitBoundsOptions);this._map.fitBounds(g.toBounds(S),C,{geolocateSource:!0})},d.prototype._updateMarker=function(p){if(p){var g=new _.LngLat(p.coords.longitude,p.coords.latitude);this._accuracyCircleMarker.setLngLat(g).addTo(this._map),this._userLocationDotMarker.setLngLat(g).addTo(this._map),this._accuracy=p.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},d.prototype._updateCircleRadius=function(){var p=this._map._container.clientHeight/2,g=this._map.unproject([0,p]),S=this._map.unproject([1,p]),w=g.distanceTo(S),C=Math.ceil(2*this._accuracy/w);this._circleElement.style.width=C+"px",this._circleElement.style.height=C+"px"},d.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},d.prototype._onError=function(p){if(this._map){if(this.options.trackUserLocation)if(p.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var g=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=g,this._geolocateButton.setAttribute("aria-label",g),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(p.code===3&&oc)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new _.Event("error",p)),this._finish()}},d.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},d.prototype._setupUI=function(p){var g=this;if(this._container.addEventListener("contextmenu",function(C){return C.preventDefault()}),this._geolocateButton=U.create("button","mapboxgl-ctrl-geolocate",this._container),U.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",p===!1){_.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var S=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=S,this._geolocateButton.setAttribute("aria-label",S)}else{var w=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=w,this._geolocateButton.setAttribute("aria-label",w)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=U.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new cf(this._dotElement),this._circleElement=U.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new cf({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(C){C.geolocateSource||g._watchState!=="ACTIVE_LOCK"||C.originalEvent&&C.originalEvent.type==="resize"||(g._watchState="BACKGROUND",g._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),g._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),g.fire(new _.Event("trackuserlocationend")))})},d.prototype.trigger=function(){if(!this._setup)return _.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new _.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ac--,oc=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new _.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new _.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var p;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++ac>1?(p={maximumAge:6e5,timeout:0},oc=!0):(p=this.options.positionOptions,oc=!1),this._geolocationWatchID=_.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,p)}}else _.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},d.prototype._clearWatch=function(){_.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},d}(_.Evented),zu={maxWidth:100,unit:"metric"},tu=function(h){this.options=_.extend({},zu,h),_.bindAll(["_onMove","setUnit"],this)};function jf(h,d,p){var g=p&&p.maxWidth||100,S=h._container.clientHeight/2,w=h.unproject([0,S]),C=h.unproject([g,S]),P=w.distanceTo(C);if(p&&p.unit==="imperial"){var Z=3.2808*P;Z>5280?Ol(d,g,Z/5280,h._getUIString("ScaleControl.Miles")):Ol(d,g,Z,h._getUIString("ScaleControl.Feet"))}else p&&p.unit==="nautical"?Ol(d,g,P/1852,h._getUIString("ScaleControl.NauticalMiles")):P>=1e3?Ol(d,g,P/1e3,h._getUIString("ScaleControl.Kilometers")):Ol(d,g,P,h._getUIString("ScaleControl.Meters"))}function Ol(h,d,p,g){var S,w,C,P=(S=p,(w=Math.pow(10,(""+Math.floor(S)).length-1))*(C=(C=S/w)>=10?10:C>=5?5:C>=3?3:C>=2?2:C>=1?1:function(Z){var Y=Math.pow(10,Math.ceil(-Math.log(Z)/Math.LN10));return Math.round(Z*Y)/Y}(C)));h.style.width=d*(P/p)+"px",h.innerHTML=P+"&nbsp;"+g}tu.prototype.getDefaultPosition=function(){return"bottom-left"},tu.prototype._onMove=function(){jf(this._map,this._container,this.options)},tu.prototype.onAdd=function(h){return this._map=h,this._container=U.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",h.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},tu.prototype.onRemove=function(){U.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},tu.prototype.setUnit=function(h){this.options.unit=h,jf(this._map,this._container,this.options)};var ru=function(h){this._fullscreen=!1,h&&h.container&&(h.container instanceof _.window.HTMLElement?this._container=h.container:_.warnOnce("Full screen control 'container' must be a DOM element.")),_.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in _.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in _.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in _.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in _.window.document&&(this._fullscreenchange="MSFullscreenChange")};ru.prototype.onAdd=function(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=U.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",_.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},ru.prototype.onRemove=function(){U.remove(this._controlContainer),this._map=null,_.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},ru.prototype._checkFullscreenSupport=function(){return!!(_.window.document.fullscreenEnabled||_.window.document.mozFullScreenEnabled||_.window.document.msFullscreenEnabled||_.window.document.webkitFullscreenEnabled)},ru.prototype._setupUI=function(){var h=this._fullscreenButton=U.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);U.create("span","mapboxgl-ctrl-icon",h).setAttribute("aria-hidden",!0),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),_.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},ru.prototype._updateTitle=function(){var h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.title=h},ru.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},ru.prototype._isFullscreen=function(){return this._fullscreen},ru.prototype._changeIcon=function(){(_.window.document.fullscreenElement||_.window.document.mozFullScreenElement||_.window.document.webkitFullscreenElement||_.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},ru.prototype._onClickFullscreen=function(){this._isFullscreen()?_.window.document.exitFullscreen?_.window.document.exitFullscreen():_.window.document.mozCancelFullScreen?_.window.document.mozCancelFullScreen():_.window.document.msExitFullscreen?_.window.document.msExitFullscreen():_.window.document.webkitCancelFullScreen&&_.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var Dl={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},ff=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Rh=function(h){function d(p){h.call(this),this.options=_.extend(Object.create(Dl),p),_.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return h&&(d.__proto__=h),(d.prototype=Object.create(h&&h.prototype)).constructor=d,d.prototype.addTo=function(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new _.Event("open")),this},d.prototype.isOpen=function(){return!!this._map},d.prototype.remove=function(){return this._content&&U.remove(this._content),this._container&&(U.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new _.Event("close")),this},d.prototype.getLngLat=function(){return this._lngLat},d.prototype.setLngLat=function(p){return this._lngLat=_.LngLat.convert(p),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},d.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},d.prototype.getElement=function(){return this._container},d.prototype.setText=function(p){return this.setDOMContent(_.window.document.createTextNode(p))},d.prototype.setHTML=function(p){var g,S=_.window.document.createDocumentFragment(),w=_.window.document.createElement("body");for(w.innerHTML=p;g=w.firstChild;)S.appendChild(g);return this.setDOMContent(S)},d.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},d.prototype.setMaxWidth=function(p){return this.options.maxWidth=p,this._update(),this},d.prototype.setDOMContent=function(p){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=U.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(p),this._createCloseButton(),this._update(),this._focusFirstElement(),this},d.prototype.addClassName=function(p){this._container&&this._container.classList.add(p)},d.prototype.removeClassName=function(p){this._container&&this._container.classList.remove(p)},d.prototype.setOffset=function(p){return this.options.offset=p,this._update(),this},d.prototype.toggleClassName=function(p){if(this._container)return this._container.classList.toggle(p)},d.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=U.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},d.prototype._onMouseUp=function(p){this._update(p.point)},d.prototype._onMouseMove=function(p){this._update(p.point)},d.prototype._onDrag=function(p){this._update(p.point)},d.prototype._update=function(p){var g=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=U.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=U.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(ge){return g._container.classList.add(ge)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ic(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||p)){var S=this._pos=this._trackPointer&&p?p:this._map.project(this._lngLat),w=this.options.anchor,C=function ge(_e){if(_e){if(typeof _e=="number"){var Fe=Math.round(Math.sqrt(.5*Math.pow(_e,2)));return{center:new _.Point(0,0),top:new _.Point(0,_e),"top-left":new _.Point(Fe,Fe),"top-right":new _.Point(-Fe,Fe),bottom:new _.Point(0,-_e),"bottom-left":new _.Point(Fe,-Fe),"bottom-right":new _.Point(-Fe,-Fe),left:new _.Point(_e,0),right:new _.Point(-_e,0)}}if(_e instanceof _.Point||Array.isArray(_e)){var Pe=_.Point.convert(_e);return{center:Pe,top:Pe,"top-left":Pe,"top-right":Pe,bottom:Pe,"bottom-left":Pe,"bottom-right":Pe,left:Pe,right:Pe}}return{center:_.Point.convert(_e.center||[0,0]),top:_.Point.convert(_e.top||[0,0]),"top-left":_.Point.convert(_e["top-left"]||[0,0]),"top-right":_.Point.convert(_e["top-right"]||[0,0]),bottom:_.Point.convert(_e.bottom||[0,0]),"bottom-left":_.Point.convert(_e["bottom-left"]||[0,0]),"bottom-right":_.Point.convert(_e["bottom-right"]||[0,0]),left:_.Point.convert(_e.left||[0,0]),right:_.Point.convert(_e.right||[0,0])}}return ge(new _.Point(0,0))}(this.options.offset);if(!w){var P,Z=this._container.offsetWidth,Y=this._container.offsetHeight;P=S.y+C.bottom.y<Y?["top"]:S.y>this._map.transform.height-Y?["bottom"]:[],S.x<Z/2?P.push("left"):S.x>this._map.transform.width-Z/2&&P.push("right"),w=P.length===0?"bottom":P.join("-")}var ce=S.add(C[w]).round();U.setTransform(this._container,Nu[w]+" translate("+ce.x+"px,"+ce.y+"px)"),Zf(this._container,w,"popup")}},d.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var p=this._container.querySelector(ff);p&&p.focus()}},d.prototype._onClose=function(){this.remove()},d}(_.Evented),Hf={version:_.version,supported:le,setRTLTextPlugin:_.setRTLTextPlugin,getRTLTextPluginStatus:_.getRTLTextPluginStatus,Map:Ch,NavigationControl:gu,GeolocateControl:Uu,AttributionControl:qo,ScaleControl:tu,FullscreenControl:ru,Popup:Rh,Marker:cf,Style:Ps,LngLat:_.LngLat,LngLatBounds:_.LngLatBounds,Point:_.Point,MercatorCoordinate:_.MercatorCoordinate,Evented:_.Evented,config:_.config,prewarm:function(){ar().acquire(er)},clearPrewarmedResources:function(){var h=bn;h&&(h.isPreloaded()&&h.numActive()===1?(h.release(er),bn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return _.config.ACCESS_TOKEN},set accessToken(h){_.config.ACCESS_TOKEN=h},get baseApiUrl(){return _.config.API_URL},set baseApiUrl(h){_.config.API_URL=h},get workerCount(){return Tr.workerCount},set workerCount(h){Tr.workerCount=h},get maxParallelImageRequests(){return _.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(h){_.config.MAX_PARALLEL_IMAGE_REQUESTS=h},clearStorage:function(h){_.clearTileCache(h)},workerUrl:""};return Hf}),re})},63713:function(rr,J,L){"use strict";rr.exports=pe;var re=L(30551);function pe(te){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(te)?te:new Uint8Array(te||0),this.pos=0,this.type=0,this.length=this.buf.length}pe.Varint=0,pe.Fixed64=1,pe.Bytes=2,pe.Fixed32=5;var _=65536*65536,le=1/_,U=12,he=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");pe.prototype={destroy:function(){this.buf=null},readFields:function(te,H,K){for(K=K||this.length;this.pos<K;){var Be=this.readVarint(),Ae=Be>>3,dt=this.pos;this.type=Be&7,te(Ae,H,this),this.pos===dt&&this.skip(Be)}return H},readMessage:function(te,H){return this.readFields(te,H,this.readVarint()+this.pos)},readFixed32:function(){var te=Et(this.buf,this.pos);return this.pos+=4,te},readSFixed32:function(){var te=Pt(this.buf,this.pos);return this.pos+=4,te},readFixed64:function(){var te=Et(this.buf,this.pos)+Et(this.buf,this.pos+4)*_;return this.pos+=8,te},readSFixed64:function(){var te=Et(this.buf,this.pos)+Pt(this.buf,this.pos+4)*_;return this.pos+=8,te},readFloat:function(){var te=re.read(this.buf,this.pos,!0,23,4);return this.pos+=4,te},readDouble:function(){var te=re.read(this.buf,this.pos,!0,52,8);return this.pos+=8,te},readVarint:function(te){var H=this.buf,K,Be;return Be=H[this.pos++],K=Be&127,Be<128||(Be=H[this.pos++],K|=(Be&127)<<7,Be<128)||(Be=H[this.pos++],K|=(Be&127)<<14,Be<128)||(Be=H[this.pos++],K|=(Be&127)<<21,Be<128)?K:(Be=H[this.pos],K|=(Be&15)<<28,ae(K,te,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var te=this.readVarint();return te%2===1?(te+1)/-2:te/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var te=this.readVarint()+this.pos,H=this.pos;return this.pos=te,te-H>=U&&he?qt(this.buf,H,te):ft(this.buf,H,te)},readBytes:function(){var te=this.readVarint()+this.pos,H=this.buf.subarray(this.pos,te);return this.pos=te,H},readPackedVarint:function(te,H){if(this.type!==pe.Bytes)return te.push(this.readVarint(H));var K=qe(this);for(te=te||[];this.pos<K;)te.push(this.readVarint(H));return te},readPackedSVarint:function(te){if(this.type!==pe.Bytes)return te.push(this.readSVarint());var H=qe(this);for(te=te||[];this.pos<H;)te.push(this.readSVarint());return te},readPackedBoolean:function(te){if(this.type!==pe.Bytes)return te.push(this.readBoolean());var H=qe(this);for(te=te||[];this.pos<H;)te.push(this.readBoolean());return te},readPackedFloat:function(te){if(this.type!==pe.Bytes)return te.push(this.readFloat());var H=qe(this);for(te=te||[];this.pos<H;)te.push(this.readFloat());return te},readPackedDouble:function(te){if(this.type!==pe.Bytes)return te.push(this.readDouble());var H=qe(this);for(te=te||[];this.pos<H;)te.push(this.readDouble());return te},readPackedFixed32:function(te){if(this.type!==pe.Bytes)return te.push(this.readFixed32());var H=qe(this);for(te=te||[];this.pos<H;)te.push(this.readFixed32());return te},readPackedSFixed32:function(te){if(this.type!==pe.Bytes)return te.push(this.readSFixed32());var H=qe(this);for(te=te||[];this.pos<H;)te.push(this.readSFixed32());return te},readPackedFixed64:function(te){if(this.type!==pe.Bytes)return te.push(this.readFixed64());var H=qe(this);for(te=te||[];this.pos<H;)te.push(this.readFixed64());return te},readPackedSFixed64:function(te){if(this.type!==pe.Bytes)return te.push(this.readSFixed64());var H=qe(this);for(te=te||[];this.pos<H;)te.push(this.readSFixed64());return te},skip:function(te){var H=te&7;if(H===pe.Varint)for(;this.buf[this.pos++]>127;);else if(H===pe.Bytes)this.pos=this.readVarint()+this.pos;else if(H===pe.Fixed32)this.pos+=4;else if(H===pe.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+H)},writeTag:function(te,H){this.writeVarint(te<<3|H)},realloc:function(te){for(var H=this.length||16;H<this.pos+te;)H*=2;if(H!==this.length){var K=new Uint8Array(H);K.set(this.buf),this.buf=K,this.length=H}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(te){this.realloc(4),nt(this.buf,te,this.pos),this.pos+=4},writeSFixed32:function(te){this.realloc(4),nt(this.buf,te,this.pos),this.pos+=4},writeFixed64:function(te){this.realloc(8),nt(this.buf,te&-1,this.pos),nt(this.buf,Math.floor(te*le),this.pos+4),this.pos+=8},writeSFixed64:function(te){this.realloc(8),nt(this.buf,te&-1,this.pos),nt(this.buf,Math.floor(te*le),this.pos+4),this.pos+=8},writeVarint:function(te){if(te=+te||0,te>268435455||te<0){Ke(te,this);return}this.realloc(4),this.buf[this.pos++]=te&127|(te>127?128:0),!(te<=127)&&(this.buf[this.pos++]=(te>>>=7)&127|(te>127?128:0),!(te<=127)&&(this.buf[this.pos++]=(te>>>=7)&127|(te>127?128:0),!(te<=127)&&(this.buf[this.pos++]=te>>>7&127)))},writeSVarint:function(te){this.writeVarint(te<0?-te*2-1:te*2)},writeBoolean:function(te){this.writeVarint(!!te)},writeString:function(te){te=String(te),this.realloc(te.length*4),this.pos++;var H=this.pos;this.pos=Sr(this.buf,te,this.pos);var K=this.pos-H;K>=128&&Dt(H,K,this),this.pos=H-1,this.writeVarint(K),this.pos+=K},writeFloat:function(te){this.realloc(4),re.write(this.buf,te,this.pos,!0,23,4),this.pos+=4},writeDouble:function(te){this.realloc(8),re.write(this.buf,te,this.pos,!0,52,8),this.pos+=8},writeBytes:function(te){var H=te.length;this.writeVarint(H),this.realloc(H);for(var K=0;K<H;K++)this.buf[this.pos++]=te[K]},writeRawMessage:function(te,H){this.pos++;var K=this.pos;te(H,this);var Be=this.pos-K;Be>=128&&Dt(K,Be,this),this.pos=K-1,this.writeVarint(Be),this.pos+=Be},writeMessage:function(te,H,K){this.writeTag(te,pe.Bytes),this.writeRawMessage(H,K)},writePackedVarint:function(te,H){H.length&&this.writeMessage(te,Yt,H)},writePackedSVarint:function(te,H){H.length&&this.writeMessage(te,Ht,H)},writePackedBoolean:function(te,H){H.length&&this.writeMessage(te,yt,H)},writePackedFloat:function(te,H){H.length&&this.writeMessage(te,ir,H)},writePackedDouble:function(te,H){H.length&&this.writeMessage(te,Xt,H)},writePackedFixed32:function(te,H){H.length&&this.writeMessage(te,bt,H)},writePackedSFixed32:function(te,H){H.length&&this.writeMessage(te,Pr,H)},writePackedFixed64:function(te,H){H.length&&this.writeMessage(te,hr,H)},writePackedSFixed64:function(te,H){H.length&&this.writeMessage(te,ur,H)},writeBytesField:function(te,H){this.writeTag(te,pe.Bytes),this.writeBytes(H)},writeFixed32Field:function(te,H){this.writeTag(te,pe.Fixed32),this.writeFixed32(H)},writeSFixed32Field:function(te,H){this.writeTag(te,pe.Fixed32),this.writeSFixed32(H)},writeFixed64Field:function(te,H){this.writeTag(te,pe.Fixed64),this.writeFixed64(H)},writeSFixed64Field:function(te,H){this.writeTag(te,pe.Fixed64),this.writeSFixed64(H)},writeVarintField:function(te,H){this.writeTag(te,pe.Varint),this.writeVarint(H)},writeSVarintField:function(te,H){this.writeTag(te,pe.Varint),this.writeSVarint(H)},writeStringField:function(te,H){this.writeTag(te,pe.Bytes),this.writeString(H)},writeFloatField:function(te,H){this.writeTag(te,pe.Fixed32),this.writeFloat(H)},writeDoubleField:function(te,H){this.writeTag(te,pe.Fixed64),this.writeDouble(H)},writeBooleanField:function(te,H){this.writeVarintField(te,!!H)}};function ae(te,H,K){var Be=K.buf,Ae,dt;if(dt=Be[K.pos++],Ae=(dt&112)>>4,dt<128||(dt=Be[K.pos++],Ae|=(dt&127)<<3,dt<128)||(dt=Be[K.pos++],Ae|=(dt&127)<<10,dt<128)||(dt=Be[K.pos++],Ae|=(dt&127)<<17,dt<128)||(dt=Be[K.pos++],Ae|=(dt&127)<<24,dt<128)||(dt=Be[K.pos++],Ae|=(dt&1)<<31,dt<128))return ie(te,Ae,H);throw new Error("Expected varint not more than 10 bytes")}function qe(te){return te.type===pe.Bytes?te.readVarint()+te.pos:te.pos+1}function ie(te,H,K){return K?H*4294967296+(te>>>0):(H>>>0)*4294967296+(te>>>0)}function Ke(te,H){var K,Be;if(te>=0?(K=te%4294967296|0,Be=te/4294967296|0):(K=~(-te%4294967296),Be=~(-te/4294967296),K^4294967295?K=K+1|0:(K=0,Be=Be+1|0)),te>=18446744073709552e3||te<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");H.realloc(10),ht(K,Be,H),mt(Be,H)}function ht(te,H,K){K.buf[K.pos++]=te&127|128,te>>>=7,K.buf[K.pos++]=te&127|128,te>>>=7,K.buf[K.pos++]=te&127|128,te>>>=7,K.buf[K.pos++]=te&127|128,te>>>=7,K.buf[K.pos]=te&127}function mt(te,H){var K=(te&7)<<4;H.buf[H.pos++]|=K|((te>>>=3)?128:0),te&&(H.buf[H.pos++]=te&127|((te>>>=7)?128:0),te&&(H.buf[H.pos++]=te&127|((te>>>=7)?128:0),te&&(H.buf[H.pos++]=te&127|((te>>>=7)?128:0),te&&(H.buf[H.pos++]=te&127|((te>>>=7)?128:0),te&&(H.buf[H.pos++]=te&127)))))}function Dt(te,H,K){var Be=H<=16383?1:H<=2097151?2:H<=268435455?3:Math.floor(Math.log(H)/(Math.LN2*7));K.realloc(Be);for(var Ae=K.pos-1;Ae>=te;Ae--)K.buf[Ae+Be]=K.buf[Ae]}function Yt(te,H){for(var K=0;K<te.length;K++)H.writeVarint(te[K])}function Ht(te,H){for(var K=0;K<te.length;K++)H.writeSVarint(te[K])}function ir(te,H){for(var K=0;K<te.length;K++)H.writeFloat(te[K])}function Xt(te,H){for(var K=0;K<te.length;K++)H.writeDouble(te[K])}function yt(te,H){for(var K=0;K<te.length;K++)H.writeBoolean(te[K])}function bt(te,H){for(var K=0;K<te.length;K++)H.writeFixed32(te[K])}function Pr(te,H){for(var K=0;K<te.length;K++)H.writeSFixed32(te[K])}function hr(te,H){for(var K=0;K<te.length;K++)H.writeFixed64(te[K])}function ur(te,H){for(var K=0;K<te.length;K++)H.writeSFixed64(te[K])}function Et(te,H){return(te[H]|te[H+1]<<8|te[H+2]<<16)+te[H+3]*16777216}function nt(te,H,K){te[K]=H,te[K+1]=H>>>8,te[K+2]=H>>>16,te[K+3]=H>>>24}function Pt(te,H){return(te[H]|te[H+1]<<8|te[H+2]<<16)+(te[H+3]<<24)}function ft(te,H,K){for(var Be="",Ae=H;Ae<K;){var dt=te[Ae],Ue=null,We=dt>239?4:dt>223?3:dt>191?2:1;if(Ae+We>K)break;var it,Mt,yr;We===1?dt<128&&(Ue=dt):We===2?(it=te[Ae+1],(it&192)===128&&(Ue=(dt&31)<<6|it&63,Ue<=127&&(Ue=null))):We===3?(it=te[Ae+1],Mt=te[Ae+2],(it&192)===128&&(Mt&192)===128&&(Ue=(dt&15)<<12|(it&63)<<6|Mt&63,(Ue<=2047||Ue>=55296&&Ue<=57343)&&(Ue=null))):We===4&&(it=te[Ae+1],Mt=te[Ae+2],yr=te[Ae+3],(it&192)===128&&(Mt&192)===128&&(yr&192)===128&&(Ue=(dt&15)<<18|(it&63)<<12|(Mt&63)<<6|yr&63,(Ue<=65535||Ue>=1114112)&&(Ue=null))),Ue===null?(Ue=65533,We=1):Ue>65535&&(Ue-=65536,Be+=String.fromCharCode(Ue>>>10&1023|55296),Ue=56320|Ue&1023),Be+=String.fromCharCode(Ue),Ae+=We}return Be}function qt(te,H,K){return he.decode(te.subarray(H,K))}function Sr(te,H,K){for(var Be=0,Ae,dt;Be<H.length;Be++){if(Ae=H.charCodeAt(Be),Ae>55295&&Ae<57344)if(dt)if(Ae<56320){te[K++]=239,te[K++]=191,te[K++]=189,dt=Ae;continue}else Ae=dt-55296<<10|Ae-56320|65536,dt=null;else{Ae>56319||Be+1===H.length?(te[K++]=239,te[K++]=191,te[K++]=189):dt=Ae;continue}else dt&&(te[K++]=239,te[K++]=191,te[K++]=189,dt=null);Ae<128?te[K++]=Ae:(Ae<2048?te[K++]=Ae>>6|192:(Ae<65536?te[K++]=Ae>>12|224:(te[K++]=Ae>>18|240,te[K++]=Ae>>12&63|128),te[K++]=Ae>>6&63|128),te[K++]=Ae&63|128)}return K}},23167:function(rr,J,L){var re=L(14224);(function(pe,_){rr.exports=_()})(this,function(){"use strict";function pe(Ot,F){if(!(Ot instanceof F))throw new TypeError("Cannot call a class as a function")}function _(Ot,F){for(var ne=0;ne<F.length;ne++){var de=F[ne];de.enumerable=de.enumerable||!1,de.configurable=!0,"value"in de&&(de.writable=!0),Object.defineProperty(Ot,de.key,de)}}function le(Ot,F,ne){return F&&_(Ot.prototype,F),ne&&_(Ot,ne),Ot}var U=function(){function Ot(F,ne){this.next=null,this.key=F,this.data=ne,this.left=null,this.right=null}return Ot}();function he(Ot,F){return Ot>F?1:Ot<F?-1:0}function ae(Ot,F,ne){for(var de=new U(null,null),Ne=de,_t=de;;){var Kt=ne(Ot,F.key);if(Kt<0){if(F.left===null)break;if(ne(Ot,F.left.key)<0){var Ar=F.left;if(F.left=Ar.right,Ar.right=F,F=Ar,F.left===null)break}_t.left=F,_t=F,F=F.left}else if(Kt>0){if(F.right===null)break;if(ne(Ot,F.right.key)>0){var Ar=F.right;if(F.right=Ar.left,Ar.left=F,F=Ar,F.right===null)break}Ne.right=F,Ne=F,F=F.right}else break}return Ne.right=F.left,_t.left=F.right,F.left=de.right,F.right=de.left,F}function qe(Ot,F,ne,de){var Ne=new U(Ot,F);if(ne===null)return Ne.left=Ne.right=null,Ne;ne=ae(Ot,ne,de);var _t=de(Ot,ne.key);return _t<0?(Ne.left=ne.left,Ne.right=ne,ne.left=null):_t>=0&&(Ne.right=ne.right,Ne.left=ne,ne.right=null),Ne}function ie(Ot,F,ne){var de=null,Ne=null;if(F){F=ae(Ot,F,ne);var _t=ne(F.key,Ot);_t===0?(de=F.left,Ne=F.right):_t<0?(Ne=F.right,F.right=null,de=F):(de=F.left,F.left=null,Ne=F)}return{left:de,right:Ne}}function Ke(Ot,F,ne){return F===null?Ot:(Ot===null||(F=ae(Ot.key,F,ne),F.left=Ot),F)}function ht(Ot,F,ne,de,Ne){if(Ot){de(""+F+(ne?"\u2514\u2500\u2500 ":"\u251C\u2500\u2500 ")+Ne(Ot)+`
`);var _t=F+(ne?"    ":"\u2502   ");Ot.left&&ht(Ot.left,_t,!1,de,Ne),Ot.right&&ht(Ot.right,_t,!0,de,Ne)}}var mt=function(){function Ot(F){F===void 0&&(F=he),this._root=null,this._size=0,this._comparator=F}return Ot.prototype.insert=function(F,ne){return this._size++,this._root=qe(F,ne,this._root,this._comparator)},Ot.prototype.add=function(F,ne){var de=new U(F,ne);this._root===null&&(de.left=de.right=null,this._size++,this._root=de);var Ne=this._comparator,_t=ae(F,this._root,Ne),Kt=Ne(F,_t.key);return Kt===0?this._root=_t:(Kt<0?(de.left=_t.left,de.right=_t,_t.left=null):Kt>0&&(de.right=_t.right,de.left=_t,_t.right=null),this._size++,this._root=de),this._root},Ot.prototype.remove=function(F){this._root=this._remove(F,this._root,this._comparator)},Ot.prototype._remove=function(F,ne,de){var Ne;if(ne===null)return null;ne=ae(F,ne,de);var _t=de(F,ne.key);return _t===0?(ne.left===null?Ne=ne.right:(Ne=ae(F,ne.left,de),Ne.right=ne.right),this._size--,Ne):ne},Ot.prototype.pop=function(){var F=this._root;if(F){for(;F.left;)F=F.left;return this._root=ae(F.key,this._root,this._comparator),this._root=this._remove(F.key,this._root,this._comparator),{key:F.key,data:F.data}}return null},Ot.prototype.findStatic=function(F){for(var ne=this._root,de=this._comparator;ne;){var Ne=de(F,ne.key);if(Ne===0)return ne;Ne<0?ne=ne.left:ne=ne.right}return null},Ot.prototype.find=function(F){return this._root&&(this._root=ae(F,this._root,this._comparator),this._comparator(F,this._root.key)!==0)?null:this._root},Ot.prototype.contains=function(F){for(var ne=this._root,de=this._comparator;ne;){var Ne=de(F,ne.key);if(Ne===0)return!0;Ne<0?ne=ne.left:ne=ne.right}return!1},Ot.prototype.forEach=function(F,ne){for(var de=this._root,Ne=[],_t=!1;!_t;)de!==null?(Ne.push(de),de=de.left):Ne.length!==0?(de=Ne.pop(),F.call(ne,de),de=de.right):_t=!0;return this},Ot.prototype.range=function(F,ne,de,Ne){for(var _t=[],Kt=this._comparator,Ar=this._root,Ve;_t.length!==0||Ar;)if(Ar)_t.push(Ar),Ar=Ar.left;else{if(Ar=_t.pop(),Ve=Kt(Ar.key,ne),Ve>0)break;if(Kt(Ar.key,F)>=0&&de.call(Ne,Ar))return this;Ar=Ar.right}return this},Ot.prototype.keys=function(){var F=[];return this.forEach(function(ne){var de=ne.key;return F.push(de)}),F},Ot.prototype.values=function(){var F=[];return this.forEach(function(ne){var de=ne.data;return F.push(de)}),F},Ot.prototype.min=function(){return this._root?this.minNode(this._root).key:null},Ot.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},Ot.prototype.minNode=function(F){if(F===void 0&&(F=this._root),F)for(;F.left;)F=F.left;return F},Ot.prototype.maxNode=function(F){if(F===void 0&&(F=this._root),F)for(;F.right;)F=F.right;return F},Ot.prototype.at=function(F){for(var ne=this._root,de=!1,Ne=0,_t=[];!de;)if(ne)_t.push(ne),ne=ne.left;else if(_t.length>0){if(ne=_t.pop(),Ne===F)return ne;Ne++,ne=ne.right}else de=!0;return null},Ot.prototype.next=function(F){var ne=this._root,de=null;if(F.right){for(de=F.right;de.left;)de=de.left;return de}for(var Ne=this._comparator;ne;){var _t=Ne(F.key,ne.key);if(_t===0)break;_t<0?(de=ne,ne=ne.left):ne=ne.right}return de},Ot.prototype.prev=function(F){var ne=this._root,de=null;if(F.left!==null){for(de=F.left;de.right;)de=de.right;return de}for(var Ne=this._comparator;ne;){var _t=Ne(F.key,ne.key);if(_t===0)break;_t<0?ne=ne.left:(de=ne,ne=ne.right)}return de},Ot.prototype.clear=function(){return this._root=null,this._size=0,this},Ot.prototype.toList=function(){return Ht(this._root)},Ot.prototype.load=function(F,ne,de){ne===void 0&&(ne=[]),de===void 0&&(de=!1);var Ne=F.length,_t=this._comparator;if(de&&yt(F,ne,0,Ne-1,_t),this._root===null)this._root=Dt(F,ne,0,Ne),this._size=Ne;else{var Kt=Xt(this.toList(),Yt(F,ne),_t);Ne=this._size+Ne,this._root=ir({head:Kt},0,Ne)}return this},Ot.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(Ot.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(Ot.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),Ot.prototype.toString=function(F){F===void 0&&(F=function(Ne){return String(Ne.key)});var ne=[];return ht(this._root,"",!0,function(de){return ne.push(de)},F),ne.join("")},Ot.prototype.update=function(F,ne,de){var Ne=this._comparator,_t=ie(F,this._root,Ne),Kt=_t.left,Ar=_t.right;Ne(F,ne)<0?Ar=qe(ne,de,Ar,Ne):Kt=qe(ne,de,Kt,Ne),this._root=Ke(Kt,Ar,Ne)},Ot.prototype.split=function(F){return ie(F,this._root,this._comparator)},Ot}();function Dt(Ot,F,ne,de){var Ne=de-ne;if(Ne>0){var _t=ne+Math.floor(Ne/2),Kt=Ot[_t],Ar=F[_t],Ve=new U(Kt,Ar);return Ve.left=Dt(Ot,F,ne,_t),Ve.right=Dt(Ot,F,_t+1,de),Ve}return null}function Yt(Ot,F){for(var ne=new U(null,null),de=ne,Ne=0;Ne<Ot.length;Ne++)de=de.next=new U(Ot[Ne],F[Ne]);return de.next=null,ne.next}function Ht(Ot){for(var F=Ot,ne=[],de=!1,Ne=new U(null,null),_t=Ne;!de;)F?(ne.push(F),F=F.left):ne.length>0?(F=_t=_t.next=ne.pop(),F=F.right):de=!0;return _t.next=null,Ne.next}function ir(Ot,F,ne){var de=ne-F;if(de>0){var Ne=F+Math.floor(de/2),_t=ir(Ot,F,Ne),Kt=Ot.head;return Kt.left=_t,Ot.head=Ot.head.next,Kt.right=ir(Ot,Ne+1,ne),Kt}return null}function Xt(Ot,F,ne){for(var de=new U(null,null),Ne=de,_t=Ot,Kt=F;_t!==null&&Kt!==null;)ne(_t.key,Kt.key)<0?(Ne.next=_t,_t=_t.next):(Ne.next=Kt,Kt=Kt.next),Ne=Ne.next;return _t!==null?Ne.next=_t:Kt!==null&&(Ne.next=Kt),de.next}function yt(Ot,F,ne,de,Ne){if(!(ne>=de)){for(var _t=Ot[ne+de>>1],Kt=ne-1,Ar=de+1;;){do Kt++;while(Ne(Ot[Kt],_t)<0);do Ar--;while(Ne(Ot[Ar],_t)>0);if(Kt>=Ar)break;var Ve=Ot[Kt];Ot[Kt]=Ot[Ar],Ot[Ar]=Ve,Ve=F[Kt],F[Kt]=F[Ar],F[Ar]=Ve}yt(Ot,F,ne,Ar,Ne),yt(Ot,F,Ar+1,de,Ne)}}var bt=function(F,ne){return F.ll.x<=ne.x&&ne.x<=F.ur.x&&F.ll.y<=ne.y&&ne.y<=F.ur.y},Pr=function(F,ne){if(ne.ur.x<F.ll.x||F.ur.x<ne.ll.x||ne.ur.y<F.ll.y||F.ur.y<ne.ll.y)return null;var de=F.ll.x<ne.ll.x?ne.ll.x:F.ll.x,Ne=F.ur.x<ne.ur.x?F.ur.x:ne.ur.x,_t=F.ll.y<ne.ll.y?ne.ll.y:F.ll.y,Kt=F.ur.y<ne.ur.y?F.ur.y:ne.ur.y;return{ll:{x:de,y:_t},ur:{x:Ne,y:Kt}}},hr=Number.EPSILON;hr===void 0&&(hr=Math.pow(2,-52));var ur=hr*hr,Et=function(F,ne){if(-hr<F&&F<hr&&-hr<ne&&ne<hr)return 0;var de=F-ne;return de*de<ur*F*ne?0:F<ne?-1:1},nt=function(){function Ot(){pe(this,Ot),this.reset()}return le(Ot,[{key:"reset",value:function(){this.xRounder=new Pt,this.yRounder=new Pt}},{key:"round",value:function(ne,de){return{x:this.xRounder.round(ne),y:this.yRounder.round(de)}}}]),Ot}(),Pt=function(){function Ot(){pe(this,Ot),this.tree=new mt,this.round(0)}return le(Ot,[{key:"round",value:function(ne){var de=this.tree.add(ne),Ne=this.tree.prev(de);if(Ne!==null&&Et(de.key,Ne.key)===0)return this.tree.remove(ne),Ne.key;var _t=this.tree.next(de);return _t!==null&&Et(de.key,_t.key)===0?(this.tree.remove(ne),_t.key):ne}}]),Ot}(),ft=new nt,qt=function(F,ne){return F.x*ne.y-F.y*ne.x},Sr=function(F,ne){return F.x*ne.x+F.y*ne.y},te=function(F,ne,de){var Ne={x:ne.x-F.x,y:ne.y-F.y},_t={x:de.x-F.x,y:de.y-F.y},Kt=qt(Ne,_t);return Et(Kt,0)},H=function(F){return Math.sqrt(Sr(F,F))},K=function(F,ne,de){var Ne={x:ne.x-F.x,y:ne.y-F.y},_t={x:de.x-F.x,y:de.y-F.y};return qt(_t,Ne)/H(_t)/H(Ne)},Be=function(F,ne,de){var Ne={x:ne.x-F.x,y:ne.y-F.y},_t={x:de.x-F.x,y:de.y-F.y};return Sr(_t,Ne)/H(_t)/H(Ne)},Ae=function(F,ne,de){return ne.y===0?null:{x:F.x+ne.x/ne.y*(de-F.y),y:de}},dt=function(F,ne,de){return ne.x===0?null:{x:de,y:F.y+ne.y/ne.x*(de-F.x)}},Ue=function(F,ne,de,Ne){if(ne.x===0)return dt(de,Ne,F.x);if(Ne.x===0)return dt(F,ne,de.x);if(ne.y===0)return Ae(de,Ne,F.y);if(Ne.y===0)return Ae(F,ne,de.y);var _t=qt(ne,Ne);if(_t==0)return null;var Kt={x:de.x-F.x,y:de.y-F.y},Ar=qt(Kt,ne)/_t,Ve=qt(Kt,Ne)/_t,wt=F.x+Ve*ne.x,sr=de.x+Ar*Ne.x,dr=F.y+Ve*ne.y,Vr=de.y+Ar*Ne.y,Ln=(wt+sr)/2,En=(dr+Vr)/2;return{x:Ln,y:En}},We=function(){le(Ot,null,[{key:"compare",value:function(ne,de){var Ne=Ot.comparePoints(ne.point,de.point);return Ne!==0?Ne:(ne.point!==de.point&&ne.link(de),ne.isLeft!==de.isLeft?ne.isLeft?1:-1:Mt.compare(ne.segment,de.segment))}},{key:"comparePoints",value:function(ne,de){return ne.x<de.x?-1:ne.x>de.x?1:ne.y<de.y?-1:ne.y>de.y?1:0}}]);function Ot(F,ne){pe(this,Ot),F.events===void 0?F.events=[this]:F.events.push(this),this.point=F,this.isLeft=ne}return le(Ot,[{key:"link",value:function(ne){if(ne.point===this.point)throw new Error("Tried to link already linked events");for(var de=ne.point.events,Ne=0,_t=de.length;Ne<_t;Ne++){var Kt=de[Ne];this.point.events.push(Kt),Kt.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var ne=this.point.events.length,de=0;de<ne;de++){var Ne=this.point.events[de];if(Ne.segment.consumedBy===void 0)for(var _t=de+1;_t<ne;_t++){var Kt=this.point.events[_t];Kt.consumedBy===void 0&&Ne.otherSE.point.events===Kt.otherSE.point.events&&Ne.segment.consume(Kt.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var ne=[],de=0,Ne=this.point.events.length;de<Ne;de++){var _t=this.point.events[de];_t!==this&&!_t.segment.ringOut&&_t.segment.isInResult()&&ne.push(_t)}return ne}},{key:"getLeftmostComparator",value:function(ne){var de=this,Ne=new Map,_t=function(Ar){var Ve=Ar.otherSE;Ne.set(Ar,{sine:K(de.point,ne.point,Ve.point),cosine:Be(de.point,ne.point,Ve.point)})};return function(Kt,Ar){Ne.has(Kt)||_t(Kt),Ne.has(Ar)||_t(Ar);var Ve=Ne.get(Kt),wt=Ve.sine,sr=Ve.cosine,dr=Ne.get(Ar),Vr=dr.sine,Ln=dr.cosine;return wt>=0&&Vr>=0?sr<Ln?1:sr>Ln?-1:0:wt<0&&Vr<0?sr<Ln?-1:sr>Ln?1:0:Vr<wt?-1:Vr>wt?1:0}}}]),Ot}(),it=0,Mt=function(){le(Ot,null,[{key:"compare",value:function(ne,de){var Ne=ne.leftSE.point.x,_t=de.leftSE.point.x,Kt=ne.rightSE.point.x,Ar=de.rightSE.point.x;if(Ar<Ne)return 1;if(Kt<_t)return-1;var Ve=ne.leftSE.point.y,wt=de.leftSE.point.y,sr=ne.rightSE.point.y,dr=de.rightSE.point.y;if(Ne<_t){if(wt<Ve&&wt<sr)return 1;if(wt>Ve&&wt>sr)return-1;var Vr=ne.comparePoint(de.leftSE.point);if(Vr<0)return 1;if(Vr>0)return-1;var Ln=de.comparePoint(ne.rightSE.point);return Ln!==0?Ln:-1}if(Ne>_t){if(Ve<wt&&Ve<dr)return-1;if(Ve>wt&&Ve>dr)return 1;var En=de.comparePoint(ne.leftSE.point);if(En!==0)return En;var Rn=ne.comparePoint(de.rightSE.point);return Rn<0?1:Rn>0?-1:1}if(Ve<wt)return-1;if(Ve>wt)return 1;if(Kt<Ar){var xn=de.comparePoint(ne.rightSE.point);if(xn!==0)return xn}if(Kt>Ar){var si=ne.comparePoint(de.rightSE.point);if(si<0)return 1;if(si>0)return-1}if(Kt!==Ar){var ei=sr-Ve,la=Kt-Ne,sa=dr-wt,Eo=Ar-_t;if(ei>la&&sa<Eo)return 1;if(ei<la&&sa>Eo)return-1}return Kt>Ar?1:Kt<Ar||sr<dr?-1:sr>dr?1:ne.id<de.id?-1:ne.id>de.id?1:0}}]);function Ot(F,ne,de,Ne){pe(this,Ot),this.id=++it,this.leftSE=F,F.segment=this,F.otherSE=ne,this.rightSE=ne,ne.segment=this,ne.otherSE=F,this.rings=de,this.windings=Ne}return le(Ot,[{key:"replaceRightSE",value:function(ne){this.rightSE=ne,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var ne=this.leftSE.point.y,de=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:ne<de?ne:de},ur:{x:this.rightSE.point.x,y:ne>de?ne:de}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(ne){return ne.x===this.leftSE.point.x&&ne.y===this.leftSE.point.y||ne.x===this.rightSE.point.x&&ne.y===this.rightSE.point.y}},{key:"comparePoint",value:function(ne){if(this.isAnEndpoint(ne))return 0;var de=this.leftSE.point,Ne=this.rightSE.point,_t=this.vector();if(de.x===Ne.x)return ne.x===de.x?0:ne.x<de.x?1:-1;var Kt=(ne.y-de.y)/_t.y,Ar=de.x+Kt*_t.x;if(ne.x===Ar)return 0;var Ve=(ne.x-de.x)/_t.x,wt=de.y+Ve*_t.y;return ne.y===wt?0:ne.y<wt?-1:1}},{key:"getIntersection",value:function(ne){var de=this.bbox(),Ne=ne.bbox(),_t=Pr(de,Ne);if(_t===null)return null;var Kt=this.leftSE.point,Ar=this.rightSE.point,Ve=ne.leftSE.point,wt=ne.rightSE.point,sr=bt(de,Ve)&&this.comparePoint(Ve)===0,dr=bt(Ne,Kt)&&ne.comparePoint(Kt)===0,Vr=bt(de,wt)&&this.comparePoint(wt)===0,Ln=bt(Ne,Ar)&&ne.comparePoint(Ar)===0;if(dr&&sr)return Ln&&!Vr?Ar:!Ln&&Vr?wt:null;if(dr)return Vr&&Kt.x===wt.x&&Kt.y===wt.y?null:Kt;if(sr)return Ln&&Ar.x===Ve.x&&Ar.y===Ve.y?null:Ve;if(Ln&&Vr)return null;if(Ln)return Ar;if(Vr)return wt;var En=Ue(Kt,this.vector(),Ve,ne.vector());return En===null||!bt(_t,En)?null:ft.round(En.x,En.y)}},{key:"split",value:function(ne){var de=[],Ne=ne.events!==void 0,_t=new We(ne,!0),Kt=new We(ne,!1),Ar=this.rightSE;this.replaceRightSE(Kt),de.push(Kt),de.push(_t);var Ve=new Ot(_t,Ar,this.rings.slice(),this.windings.slice());return We.comparePoints(Ve.leftSE.point,Ve.rightSE.point)>0&&Ve.swapEvents(),We.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),Ne&&(_t.checkForConsuming(),Kt.checkForConsuming()),de}},{key:"swapEvents",value:function(){var ne=this.rightSE;this.rightSE=this.leftSE,this.leftSE=ne,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var de=0,Ne=this.windings.length;de<Ne;de++)this.windings[de]*=-1}},{key:"consume",value:function(ne){for(var de=this,Ne=ne;de.consumedBy;)de=de.consumedBy;for(;Ne.consumedBy;)Ne=Ne.consumedBy;var _t=Ot.compare(de,Ne);if(_t!==0){if(_t>0){var Kt=de;de=Ne,Ne=Kt}if(de.prev===Ne){var Ar=de;de=Ne,Ne=Ar}for(var Ve=0,wt=Ne.rings.length;Ve<wt;Ve++){var sr=Ne.rings[Ve],dr=Ne.windings[Ve],Vr=de.rings.indexOf(sr);Vr===-1?(de.rings.push(sr),de.windings.push(dr)):de.windings[Vr]+=dr}Ne.rings=null,Ne.windings=null,Ne.consumedBy=de,Ne.leftSE.consumedBy=de.leftSE,Ne.rightSE.consumedBy=de.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var ne=this.prev.consumedBy||this.prev;this._beforeState=ne.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var ne=this.beforeState();this._afterState={rings:ne.rings.slice(0),windings:ne.windings.slice(0),multiPolys:[]};for(var de=this._afterState.rings,Ne=this._afterState.windings,_t=this._afterState.multiPolys,Kt=0,Ar=this.rings.length;Kt<Ar;Kt++){var Ve=this.rings[Kt],wt=this.windings[Kt],sr=de.indexOf(Ve);sr===-1?(de.push(Ve),Ne.push(wt)):Ne[sr]+=wt}for(var dr=[],Vr=[],Ln=0,En=de.length;Ln<En;Ln++)if(Ne[Ln]!==0){var Rn=de[Ln],xn=Rn.poly;if(Vr.indexOf(xn)===-1)if(Rn.isExterior)dr.push(xn);else{Vr.indexOf(xn)===-1&&Vr.push(xn);var si=dr.indexOf(Rn.poly);si!==-1&&dr.splice(si,1)}}for(var ei=0,la=dr.length;ei<la;ei++){var sa=dr[ei].multiPoly;_t.indexOf(sa)===-1&&_t.push(sa)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var ne=this.beforeState().multiPolys,de=this.afterState().multiPolys;switch(Zi.type){case"union":{var Ne=ne.length===0,_t=de.length===0;this._isInResult=Ne!==_t;break}case"intersection":{var Kt,Ar;ne.length<de.length?(Kt=ne.length,Ar=de.length):(Kt=de.length,Ar=ne.length),this._isInResult=Ar===Zi.numMultiPolys&&Kt<Ar;break}case"xor":{var Ve=Math.abs(ne.length-de.length);this._isInResult=Ve%2===1;break}case"difference":{var wt=function(dr){return dr.length===1&&dr[0].isSubject};this._isInResult=wt(ne)!==wt(de);break}default:throw new Error("Unrecognized operation type found ".concat(Zi.type))}return this._isInResult}}],[{key:"fromRing",value:function(ne,de,Ne){var _t,Kt,Ar,Ve=We.comparePoints(ne,de);if(Ve<0)_t=ne,Kt=de,Ar=1;else if(Ve>0)_t=de,Kt=ne,Ar=-1;else throw new Error("Tried to create degenerate segment at [".concat(ne.x,", ").concat(ne.y,"]"));var wt=new We(_t,!0),sr=new We(Kt,!1);return new Ot(wt,sr,[Ne],[Ar])}}]),Ot}(),yr=function(){function Ot(F,ne,de){if(pe(this,Ot),!Array.isArray(F)||F.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=ne,this.isExterior=de,this.segments=[],typeof F[0][0]!="number"||typeof F[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var Ne=ft.round(F[0][0],F[0][1]);this.bbox={ll:{x:Ne.x,y:Ne.y},ur:{x:Ne.x,y:Ne.y}};for(var _t=Ne,Kt=1,Ar=F.length;Kt<Ar;Kt++){if(typeof F[Kt][0]!="number"||typeof F[Kt][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var Ve=ft.round(F[Kt][0],F[Kt][1]);Ve.x===_t.x&&Ve.y===_t.y||(this.segments.push(Mt.fromRing(_t,Ve,this)),Ve.x<this.bbox.ll.x&&(this.bbox.ll.x=Ve.x),Ve.y<this.bbox.ll.y&&(this.bbox.ll.y=Ve.y),Ve.x>this.bbox.ur.x&&(this.bbox.ur.x=Ve.x),Ve.y>this.bbox.ur.y&&(this.bbox.ur.y=Ve.y),_t=Ve)}(Ne.x!==_t.x||Ne.y!==_t.y)&&this.segments.push(Mt.fromRing(_t,Ne,this))}return le(Ot,[{key:"getSweepEvents",value:function(){for(var ne=[],de=0,Ne=this.segments.length;de<Ne;de++){var _t=this.segments[de];ne.push(_t.leftSE),ne.push(_t.rightSE)}return ne}}]),Ot}(),lr=function(){function Ot(F,ne){if(pe(this,Ot),!Array.isArray(F))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new yr(F[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var de=1,Ne=F.length;de<Ne;de++){var _t=new yr(F[de],this,!1);_t.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=_t.bbox.ll.x),_t.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=_t.bbox.ll.y),_t.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=_t.bbox.ur.x),_t.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=_t.bbox.ur.y),this.interiorRings.push(_t)}this.multiPoly=ne}return le(Ot,[{key:"getSweepEvents",value:function(){for(var ne=this.exteriorRing.getSweepEvents(),de=0,Ne=this.interiorRings.length;de<Ne;de++)for(var _t=this.interiorRings[de].getSweepEvents(),Kt=0,Ar=_t.length;Kt<Ar;Kt++)ne.push(_t[Kt]);return ne}}]),Ot}(),Cn=function(){function Ot(F,ne){if(pe(this,Ot),!Array.isArray(F))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof F[0][0][0]=="number"&&(F=[F])}catch(Kt){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var de=0,Ne=F.length;de<Ne;de++){var _t=new lr(F[de],this);_t.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=_t.bbox.ll.x),_t.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=_t.bbox.ll.y),_t.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=_t.bbox.ur.x),_t.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=_t.bbox.ur.y),this.polys.push(_t)}this.isSubject=ne}return le(Ot,[{key:"getSweepEvents",value:function(){for(var ne=[],de=0,Ne=this.polys.length;de<Ne;de++)for(var _t=this.polys[de].getSweepEvents(),Kt=0,Ar=_t.length;Kt<Ar;Kt++)ne.push(_t[Kt]);return ne}}]),Ot}(),mn=function(){le(Ot,null,[{key:"factory",value:function(ne){for(var de=[],Ne=0,_t=ne.length;Ne<_t;Ne++){var Kt=ne[Ne];if(!(!Kt.isInResult()||Kt.ringOut)){for(var Ar=null,Ve=Kt.leftSE,wt=Kt.rightSE,sr=[Ve],dr=Ve.point,Vr=[];Ar=Ve,Ve=wt,sr.push(Ve),Ve.point!==dr;)for(;;){var Ln=Ve.getAvailableLinkedEvents();if(Ln.length===0){var En=sr[0].point,Rn=sr[sr.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(En.x,",")+" ".concat(En.y,"]. Last matching segment found ends at")+" [".concat(Rn.x,", ").concat(Rn.y,"]."))}if(Ln.length===1){wt=Ln[0].otherSE;break}for(var xn=null,si=0,ei=Vr.length;si<ei;si++)if(Vr[si].point===Ve.point){xn=si;break}if(xn!==null){var la=Vr.splice(xn)[0],sa=sr.splice(la.index);sa.unshift(sa[0].otherSE),de.push(new Ot(sa.reverse()));continue}Vr.push({index:sr.length,point:Ve.point});var Eo=Ve.getLeftmostComparator(Ar);wt=Ln.sort(Eo)[0].otherSE;break}de.push(new Ot(sr))}}return de}}]);function Ot(F){pe(this,Ot),this.events=F;for(var ne=0,de=F.length;ne<de;ne++)F[ne].segment.ringOut=this;this.poly=null}return le(Ot,[{key:"getGeom",value:function(){for(var ne=this.events[0].point,de=[ne],Ne=1,_t=this.events.length-1;Ne<_t;Ne++){var Kt=this.events[Ne].point,Ar=this.events[Ne+1].point;te(Kt,ne,Ar)!==0&&(de.push(Kt),ne=Kt)}if(de.length===1)return null;var Ve=de[0],wt=de[1];te(Ve,ne,wt)===0&&de.shift(),de.push(de[0]);for(var sr=this.isExteriorRing()?1:-1,dr=this.isExteriorRing()?0:de.length-1,Vr=this.isExteriorRing()?de.length:-1,Ln=[],En=dr;En!=Vr;En+=sr)Ln.push([de[En].x,de[En].y]);return Ln}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var ne=this.enclosingRing();this._isExteriorRing=ne?!ne.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var ne=this.events[0],de=1,Ne=this.events.length;de<Ne;de++){var _t=this.events[de];We.compare(ne,_t)>0&&(ne=_t)}for(var Kt=ne.segment.prevInResult(),Ar=Kt?Kt.prevInResult():null;;){if(!Kt)return null;if(!Ar)return Kt.ringOut;if(Ar.ringOut!==Kt.ringOut)return Ar.ringOut.enclosingRing()!==Kt.ringOut?Kt.ringOut:Kt.ringOut.enclosingRing();Kt=Ar.prevInResult(),Ar=Kt?Kt.prevInResult():null}}}]),Ot}(),un=function(){function Ot(F){pe(this,Ot),this.exteriorRing=F,F.poly=this,this.interiorRings=[]}return le(Ot,[{key:"addInterior",value:function(ne){this.interiorRings.push(ne),ne.poly=this}},{key:"getGeom",value:function(){var ne=[this.exteriorRing.getGeom()];if(ne[0]===null)return null;for(var de=0,Ne=this.interiorRings.length;de<Ne;de++){var _t=this.interiorRings[de].getGeom();_t!==null&&ne.push(_t)}return ne}}]),Ot}(),oi=function(){function Ot(F){pe(this,Ot),this.rings=F,this.polys=this._composePolys(F)}return le(Ot,[{key:"getGeom",value:function(){for(var ne=[],de=0,Ne=this.polys.length;de<Ne;de++){var _t=this.polys[de].getGeom();_t!==null&&ne.push(_t)}return ne}},{key:"_composePolys",value:function(ne){for(var de=[],Ne=0,_t=ne.length;Ne<_t;Ne++){var Kt=ne[Ne];if(!Kt.poly)if(Kt.isExteriorRing())de.push(new un(Kt));else{var Ar=Kt.enclosingRing();Ar.poly||de.push(new un(Ar)),Ar.poly.addInterior(Kt)}}return de}}]),Ot}(),jn=function(){function Ot(F){var ne=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Mt.compare;pe(this,Ot),this.queue=F,this.tree=new mt(ne),this.segments=[]}return le(Ot,[{key:"process",value:function(ne){var de=ne.segment,Ne=[];if(ne.consumedBy)return ne.isLeft?this.queue.remove(ne.otherSE):this.tree.remove(de),Ne;var _t=ne.isLeft?this.tree.insert(de):this.tree.find(de);if(!_t)throw new Error("Unable to find segment #".concat(de.id," ")+"[".concat(de.leftSE.point.x,", ").concat(de.leftSE.point.y,"] -> ")+"[".concat(de.rightSE.point.x,", ").concat(de.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var Kt=_t,Ar=_t,Ve=void 0,wt=void 0;Ve===void 0;)Kt=this.tree.prev(Kt),Kt===null?Ve=null:Kt.key.consumedBy===void 0&&(Ve=Kt.key);for(;wt===void 0;)Ar=this.tree.next(Ar),Ar===null?wt=null:Ar.key.consumedBy===void 0&&(wt=Ar.key);if(ne.isLeft){var sr=null;if(Ve){var dr=Ve.getIntersection(de);if(dr!==null&&(de.isAnEndpoint(dr)||(sr=dr),!Ve.isAnEndpoint(dr)))for(var Vr=this._splitSafely(Ve,dr),Ln=0,En=Vr.length;Ln<En;Ln++)Ne.push(Vr[Ln])}var Rn=null;if(wt){var xn=wt.getIntersection(de);if(xn!==null&&(de.isAnEndpoint(xn)||(Rn=xn),!wt.isAnEndpoint(xn)))for(var si=this._splitSafely(wt,xn),ei=0,la=si.length;ei<la;ei++)Ne.push(si[ei])}if(sr!==null||Rn!==null){var sa=null;if(sr===null)sa=Rn;else if(Rn===null)sa=sr;else{var Eo=We.comparePoints(sr,Rn);sa=Eo<=0?sr:Rn}this.queue.remove(de.rightSE),Ne.push(de.rightSE);for(var Ks=de.split(sa),di=0,W=Ks.length;di<W;di++)Ne.push(Ks[di])}Ne.length>0?(this.tree.remove(de),Ne.push(ne)):(this.segments.push(de),de.prev=Ve)}else{if(Ve&&wt){var Q=Ve.getIntersection(wt);if(Q!==null){if(!Ve.isAnEndpoint(Q))for(var se=this._splitSafely(Ve,Q),xe=0,Re=se.length;xe<Re;xe++)Ne.push(se[xe]);if(!wt.isAnEndpoint(Q))for(var Je=this._splitSafely(wt,Q),lt=0,V=Je.length;lt<V;lt++)Ne.push(Je[lt])}}this.tree.remove(de)}return Ne}},{key:"_splitSafely",value:function(ne,de){this.tree.remove(ne);var Ne=ne.rightSE;this.queue.remove(Ne);var _t=ne.split(de);return _t.push(Ne),ne.consumedBy===void 0&&this.tree.insert(ne),_t}}]),Ot}(),rn=typeof re!="undefined"&&{NODE_ENV:"production",PUBLIC_PATH:"/"}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,$i=typeof re!="undefined"&&{NODE_ENV:"production",PUBLIC_PATH:"/"}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,Wi=function(){function Ot(){pe(this,Ot)}return le(Ot,[{key:"run",value:function(ne,de,Ne){Zi.type=ne,ft.reset();for(var _t=[new Cn(de,!0)],Kt=0,Ar=Ne.length;Kt<Ar;Kt++)_t.push(new Cn(Ne[Kt],!1));if(Zi.numMultiPolys=_t.length,Zi.type==="difference")for(var Ve=_t[0],wt=1;wt<_t.length;)Pr(_t[wt].bbox,Ve.bbox)!==null?wt++:_t.splice(wt,1);if(Zi.type==="intersection"){for(var sr=0,dr=_t.length;sr<dr;sr++)for(var Vr=_t[sr],Ln=sr+1,En=_t.length;Ln<En;Ln++)if(Pr(Vr.bbox,_t[Ln].bbox)===null)return[]}for(var Rn=new mt(We.compare),xn=0,si=_t.length;xn<si;xn++)for(var ei=_t[xn].getSweepEvents(),la=0,sa=ei.length;la<sa;la++)if(Rn.insert(ei[la]),Rn.size>rn)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var Eo=new jn(Rn),Ks=Rn.size,di=Rn.pop();di;){var W=di.key;if(Rn.size===Ks){var Q=W.segment;throw new Error("Unable to pop() ".concat(W.isLeft?"left":"right"," SweepEvent ")+"[".concat(W.point.x,", ").concat(W.point.y,"] from segment #").concat(Q.id," ")+"[".concat(Q.leftSE.point.x,", ").concat(Q.leftSE.point.y,"] -> ")+"[".concat(Q.rightSE.point.x,", ").concat(Q.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(Rn.size>rn)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(Eo.segments.length>$i)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var se=Eo.process(W),xe=0,Re=se.length;xe<Re;xe++){var Je=se[xe];Je.consumedBy===void 0&&Rn.insert(Je)}Ks=Rn.size,di=Rn.pop()}ft.reset();var lt=mn.factory(Eo.segments),V=new oi(lt);return V.getGeom()}}]),Ot}(),Zi=new Wi,Jn=function(F){for(var ne=arguments.length,de=new Array(ne>1?ne-1:0),Ne=1;Ne<ne;Ne++)de[Ne-1]=arguments[Ne];return Zi.run("union",F,de)},Bn=function(F){for(var ne=arguments.length,de=new Array(ne>1?ne-1:0),Ne=1;Ne<ne;Ne++)de[Ne-1]=arguments[Ne];return Zi.run("intersection",F,de)},Do=function(F){for(var ne=arguments.length,de=new Array(ne>1?ne-1:0),Ne=1;Ne<ne;Ne++)de[Ne-1]=arguments[Ne];return Zi.run("xor",F,de)},oa=function(F){for(var ne=arguments.length,de=new Array(ne>1?ne-1:0),Ne=1;Ne<ne;Ne++)de[Ne-1]=arguments[Ne];return Zi.run("difference",F,de)},$a={union:Jn,intersection:Bn,xor:Do,difference:oa};return $a})},96485:function(rr,J,L){var re=L(14224);var pe;(function(_){(function(le){var U=typeof L.g=="object"?L.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),he=ae(_);typeof U.Reflect=="undefined"?U.Reflect=_:he=ae(U.Reflect,he),le(he);function ae(qe,ie){return function(Ke,ht){typeof qe[Ke]!="function"&&Object.defineProperty(qe,Ke,{configurable:!0,writable:!0,value:ht}),ie&&ie(Ke,ht)}}})(function(le){var U=Object.prototype.hasOwnProperty,he=typeof Symbol=="function",ae=he&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",qe=he&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",ie=typeof Object.create=="function",Ke={__proto__:[]}instanceof Array,ht=!ie&&!Ke,mt={create:ie?function(){return Ar(Object.create(null))}:Ke?function(){return Ar({__proto__:null})}:function(){return Ar({})},has:ht?function(Ve,wt){return U.call(Ve,wt)}:function(Ve,wt){return wt in Ve},get:ht?function(Ve,wt){return U.call(Ve,wt)?Ve[wt]:void 0}:function(Ve,wt){return Ve[wt]}},Dt=Object.getPrototypeOf(Function),Yt=typeof re=="object"&&{NODE_ENV:"production",PUBLIC_PATH:"/"}&&{NODE_ENV:"production",PUBLIC_PATH:"/"}.REFLECT_METADATA_USE_MAP_POLYFILL==="true",Ht=!Yt&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:Ne(),ir=!Yt&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:_t(),Xt=!Yt&&typeof WeakMap=="function"?WeakMap:Kt(),yt=new Xt;function bt(Ve,wt,sr,dr){if(lr(sr)){if(!Zi(Ve))throw new TypeError;if(!Bn(wt))throw new TypeError;return te(Ve,wt)}else{if(!Zi(Ve))throw new TypeError;if(!un(wt))throw new TypeError;if(!un(dr)&&!lr(dr)&&!Cn(dr))throw new TypeError;return Cn(dr)&&(dr=void 0),sr=Wi(sr),H(Ve,wt,sr,dr)}}le("decorate",bt);function Pr(Ve,wt){function sr(dr,Vr){if(!un(dr))throw new TypeError;if(!lr(Vr)&&!Do(Vr))throw new TypeError;We(Ve,wt,dr,Vr)}return sr}le("metadata",Pr);function hr(Ve,wt,sr,dr){if(!un(sr))throw new TypeError;return lr(dr)||(dr=Wi(dr)),We(Ve,wt,sr,dr)}le("defineMetadata",hr);function ur(Ve,wt,sr){if(!un(wt))throw new TypeError;return lr(sr)||(sr=Wi(sr)),Be(Ve,wt,sr)}le("hasMetadata",ur);function Et(Ve,wt,sr){if(!un(wt))throw new TypeError;return lr(sr)||(sr=Wi(sr)),Ae(Ve,wt,sr)}le("hasOwnMetadata",Et);function nt(Ve,wt,sr){if(!un(wt))throw new TypeError;return lr(sr)||(sr=Wi(sr)),dt(Ve,wt,sr)}le("getMetadata",nt);function Pt(Ve,wt,sr){if(!un(wt))throw new TypeError;return lr(sr)||(sr=Wi(sr)),Ue(Ve,wt,sr)}le("getOwnMetadata",Pt);function ft(Ve,wt){if(!un(Ve))throw new TypeError;return lr(wt)||(wt=Wi(wt)),it(Ve,wt)}le("getMetadataKeys",ft);function qt(Ve,wt){if(!un(Ve))throw new TypeError;return lr(wt)||(wt=Wi(wt)),Mt(Ve,wt)}le("getOwnMetadataKeys",qt);function Sr(Ve,wt,sr){if(!un(wt))throw new TypeError;lr(sr)||(sr=Wi(sr));var dr=K(wt,sr,!1);if(lr(dr)||!dr.delete(Ve))return!1;if(dr.size>0)return!0;var Vr=yt.get(wt);return Vr.delete(sr),Vr.size>0||yt.delete(wt),!0}le("deleteMetadata",Sr);function te(Ve,wt){for(var sr=Ve.length-1;sr>=0;--sr){var dr=Ve[sr],Vr=dr(wt);if(!lr(Vr)&&!Cn(Vr)){if(!Bn(Vr))throw new TypeError;wt=Vr}}return wt}function H(Ve,wt,sr,dr){for(var Vr=Ve.length-1;Vr>=0;--Vr){var Ln=Ve[Vr],En=Ln(wt,sr,dr);if(!lr(En)&&!Cn(En)){if(!un(En))throw new TypeError;dr=En}}return dr}function K(Ve,wt,sr){var dr=yt.get(Ve);if(lr(dr)){if(!sr)return;dr=new Ht,yt.set(Ve,dr)}var Vr=dr.get(wt);if(lr(Vr)){if(!sr)return;Vr=new Ht,dr.set(wt,Vr)}return Vr}function Be(Ve,wt,sr){var dr=Ae(Ve,wt,sr);if(dr)return!0;var Vr=de(wt);return Cn(Vr)?!1:Be(Ve,Vr,sr)}function Ae(Ve,wt,sr){var dr=K(wt,sr,!1);return lr(dr)?!1:rn(dr.has(Ve))}function dt(Ve,wt,sr){var dr=Ae(Ve,wt,sr);if(dr)return Ue(Ve,wt,sr);var Vr=de(wt);if(!Cn(Vr))return dt(Ve,Vr,sr)}function Ue(Ve,wt,sr){var dr=K(wt,sr,!1);if(!lr(dr))return dr.get(Ve)}function We(Ve,wt,sr,dr){var Vr=K(sr,dr,!0);Vr.set(Ve,wt)}function it(Ve,wt){var sr=Mt(Ve,wt),dr=de(Ve);if(dr===null)return sr;var Vr=it(dr,wt);if(Vr.length<=0)return sr;if(sr.length<=0)return Vr;for(var Ln=new ir,En=[],Rn=0,xn=sr;Rn<xn.length;Rn++){var si=xn[Rn],ei=Ln.has(si);ei||(Ln.add(si),En.push(si))}for(var la=0,sa=Vr;la<sa.length;la++){var si=sa[la],ei=Ln.has(si);ei||(Ln.add(si),En.push(si))}return En}function Mt(Ve,wt){var sr=[],dr=K(Ve,wt,!1);if(lr(dr))return sr;for(var Vr=dr.keys(),Ln=$a(Vr),En=0;;){var Rn=F(Ln);if(!Rn)return sr.length=En,sr;var xn=Ot(Rn);try{sr[En]=xn}catch(si){try{ne(Ln)}finally{throw si}}En++}}function yr(Ve){if(Ve===null)return 1;switch(typeof Ve){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return Ve===null?1:6;default:return 6}}function lr(Ve){return Ve===void 0}function Cn(Ve){return Ve===null}function mn(Ve){return typeof Ve=="symbol"}function un(Ve){return typeof Ve=="object"?Ve!==null:typeof Ve=="function"}function oi(Ve,wt){switch(yr(Ve)){case 0:return Ve;case 1:return Ve;case 2:return Ve;case 3:return Ve;case 4:return Ve;case 5:return Ve}var sr=wt===3?"string":wt===5?"number":"default",dr=oa(Ve,ae);if(dr!==void 0){var Vr=dr.call(Ve,sr);if(un(Vr))throw new TypeError;return Vr}return jn(Ve,sr==="default"?"number":sr)}function jn(Ve,wt){if(wt==="string"){var sr=Ve.toString;if(Jn(sr)){var dr=sr.call(Ve);if(!un(dr))return dr}var Vr=Ve.valueOf;if(Jn(Vr)){var dr=Vr.call(Ve);if(!un(dr))return dr}}else{var Vr=Ve.valueOf;if(Jn(Vr)){var dr=Vr.call(Ve);if(!un(dr))return dr}var Ln=Ve.toString;if(Jn(Ln)){var dr=Ln.call(Ve);if(!un(dr))return dr}}throw new TypeError}function rn(Ve){return!!Ve}function $i(Ve){return""+Ve}function Wi(Ve){var wt=oi(Ve,3);return mn(wt)?wt:$i(wt)}function Zi(Ve){return Array.isArray?Array.isArray(Ve):Ve instanceof Object?Ve instanceof Array:Object.prototype.toString.call(Ve)==="[object Array]"}function Jn(Ve){return typeof Ve=="function"}function Bn(Ve){return typeof Ve=="function"}function Do(Ve){switch(yr(Ve)){case 3:return!0;case 4:return!0;default:return!1}}function oa(Ve,wt){var sr=Ve[wt];if(sr!=null){if(!Jn(sr))throw new TypeError;return sr}}function $a(Ve){var wt=oa(Ve,qe);if(!Jn(wt))throw new TypeError;var sr=wt.call(Ve);if(!un(sr))throw new TypeError;return sr}function Ot(Ve){return Ve.value}function F(Ve){var wt=Ve.next();return wt.done?!1:wt}function ne(Ve){var wt=Ve.return;wt&&wt.call(Ve)}function de(Ve){var wt=Object.getPrototypeOf(Ve);if(typeof Ve!="function"||Ve===Dt||wt!==Dt)return wt;var sr=Ve.prototype,dr=sr&&Object.getPrototypeOf(sr);if(dr==null||dr===Object.prototype)return wt;var Vr=dr.constructor;return typeof Vr!="function"||Vr===Ve?wt:Vr}function Ne(){var Ve={},wt=[],sr=function(){function En(Rn,xn,si){this._index=0,this._keys=Rn,this._values=xn,this._selector=si}return En.prototype["@@iterator"]=function(){return this},En.prototype[qe]=function(){return this},En.prototype.next=function(){var Rn=this._index;if(Rn>=0&&Rn<this._keys.length){var xn=this._selector(this._keys[Rn],this._values[Rn]);return Rn+1>=this._keys.length?(this._index=-1,this._keys=wt,this._values=wt):this._index++,{value:xn,done:!1}}return{value:void 0,done:!0}},En.prototype.throw=function(Rn){throw this._index>=0&&(this._index=-1,this._keys=wt,this._values=wt),Rn},En.prototype.return=function(Rn){return this._index>=0&&(this._index=-1,this._keys=wt,this._values=wt),{value:Rn,done:!0}},En}();return function(){function En(){this._keys=[],this._values=[],this._cacheKey=Ve,this._cacheIndex=-2}return Object.defineProperty(En.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),En.prototype.has=function(Rn){return this._find(Rn,!1)>=0},En.prototype.get=function(Rn){var xn=this._find(Rn,!1);return xn>=0?this._values[xn]:void 0},En.prototype.set=function(Rn,xn){var si=this._find(Rn,!0);return this._values[si]=xn,this},En.prototype.delete=function(Rn){var xn=this._find(Rn,!1);if(xn>=0){for(var si=this._keys.length,ei=xn+1;ei<si;ei++)this._keys[ei-1]=this._keys[ei],this._values[ei-1]=this._values[ei];return this._keys.length--,this._values.length--,Rn===this._cacheKey&&(this._cacheKey=Ve,this._cacheIndex=-2),!0}return!1},En.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=Ve,this._cacheIndex=-2},En.prototype.keys=function(){return new sr(this._keys,this._values,dr)},En.prototype.values=function(){return new sr(this._keys,this._values,Vr)},En.prototype.entries=function(){return new sr(this._keys,this._values,Ln)},En.prototype["@@iterator"]=function(){return this.entries()},En.prototype[qe]=function(){return this.entries()},En.prototype._find=function(Rn,xn){return this._cacheKey!==Rn&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=Rn)),this._cacheIndex<0&&xn&&(this._cacheIndex=this._keys.length,this._keys.push(Rn),this._values.push(void 0)),this._cacheIndex},En}();function dr(En,Rn){return En}function Vr(En,Rn){return Rn}function Ln(En,Rn){return[En,Rn]}}function _t(){return function(){function Ve(){this._map=new Ht}return Object.defineProperty(Ve.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),Ve.prototype.has=function(wt){return this._map.has(wt)},Ve.prototype.add=function(wt){return this._map.set(wt,wt),this},Ve.prototype.delete=function(wt){return this._map.delete(wt)},Ve.prototype.clear=function(){this._map.clear()},Ve.prototype.keys=function(){return this._map.keys()},Ve.prototype.values=function(){return this._map.values()},Ve.prototype.entries=function(){return this._map.entries()},Ve.prototype["@@iterator"]=function(){return this.keys()},Ve.prototype[qe]=function(){return this.keys()},Ve}()}function Kt(){var Ve=16,wt=mt.create(),sr=dr();return function(){function xn(){this._key=dr()}return xn.prototype.has=function(si){var ei=Vr(si,!1);return ei!==void 0?mt.has(ei,this._key):!1},xn.prototype.get=function(si){var ei=Vr(si,!1);return ei!==void 0?mt.get(ei,this._key):void 0},xn.prototype.set=function(si,ei){var la=Vr(si,!0);return la[this._key]=ei,this},xn.prototype.delete=function(si){var ei=Vr(si,!1);return ei!==void 0?delete ei[this._key]:!1},xn.prototype.clear=function(){this._key=dr()},xn}();function dr(){var xn;do xn="@@WeakMap@@"+Rn();while(mt.has(wt,xn));return wt[xn]=!0,xn}function Vr(xn,si){if(!U.call(xn,sr)){if(!si)return;Object.defineProperty(xn,sr,{value:mt.create()})}return xn[sr]}function Ln(xn,si){for(var ei=0;ei<si;++ei)xn[ei]=Math.random()*255|0;return xn}function En(xn){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(xn)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(xn)):Ln(new Uint8Array(xn),xn):Ln(new Array(xn),xn)}function Rn(){var xn=En(Ve);xn[6]=xn[6]&79|64,xn[8]=xn[8]&191|128;for(var si="",ei=0;ei<Ve;++ei){var la=xn[ei];(ei===4||ei===6||ei===8)&&(si+="-"),la<16&&(si+="0"),si+=la.toString(16).toLowerCase()}return si}}function Ar(Ve){return Ve.__=void 0,delete Ve.__,Ve}})})(pe||(pe={}))},79801:function(rr){(function(J,L){rr.exports=L()})(this,function(){"use strict";var J=function(z){return z instanceof Uint8Array||z instanceof Uint16Array||z instanceof Uint32Array||z instanceof Int8Array||z instanceof Int16Array||z instanceof Int32Array||z instanceof Float32Array||z instanceof Float64Array||z instanceof Uint8ClampedArray},L=function(z,Ee){for(var Ze=Object.keys(Ee),Ut=0;Ut<Ze.length;++Ut)z[Ze[Ut]]=Ee[Ze[Ut]];return z},re=`
`;function pe(z){return typeof atob!="undefined"?atob(z):"base64:"+z}function _(z){var Ee=new Error("(regl) "+z);throw console.error(Ee),Ee}function le(z,Ee){z||_(Ee)}function U(z){return z?": "+z:""}function he(z,Ee,Ze){z in Ee||_("unknown parameter ("+z+")"+U(Ze)+". possible values: "+Object.keys(Ee).join())}function ae(z,Ee){J(z)||_("invalid parameter type"+U(Ee)+". must be a typed array")}function qe(z,Ee){switch(Ee){case"number":return typeof z=="number";case"object":return typeof z=="object";case"string":return typeof z=="string";case"boolean":return typeof z=="boolean";case"function":return typeof z=="function";case"undefined":return typeof z=="undefined";case"symbol":return typeof z=="symbol"}}function ie(z,Ee,Ze){qe(z,Ee)||_("invalid parameter type"+U(Ze)+". expected "+Ee+", got "+typeof z)}function Ke(z,Ee){z>=0&&(z|0)===z||_("invalid parameter type, ("+z+")"+U(Ee)+". must be a nonnegative integer")}function ht(z,Ee,Ze){Ee.indexOf(z)<0&&_("invalid value"+U(Ze)+". must be one of: "+Ee)}var mt=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function Dt(z){Object.keys(z).forEach(function(Ee){mt.indexOf(Ee)<0&&_('invalid regl constructor argument "'+Ee+'". must be one of '+mt)})}function Yt(z,Ee){for(z=z+"";z.length<Ee;)z=" "+z;return z}function Ht(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function ir(z,Ee){this.number=z,this.line=Ee,this.errors=[]}function Xt(z,Ee,Ze){this.file=z,this.line=Ee,this.message=Ze}function yt(){var z=new Error,Ee=(z.stack||z).toString(),Ze=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(Ee);if(Ze)return Ze[1];var Ut=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(Ee);return Ut?Ut[1]:"unknown"}function bt(){var z=new Error,Ee=(z.stack||z).toString(),Ze=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(Ee);if(Ze)return Ze[1];var Ut=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(Ee);return Ut?Ut[1]:"unknown"}function Pr(z,Ee){var Ze=z.split(`
`),Ut=1,cr=0,zt={unknown:new Ht,0:new Ht};zt.unknown.name=zt[0].name=Ee||yt(),zt.unknown.lines.push(new ir(0,""));for(var kt=0;kt<Ze.length;++kt){var Dr=Ze[kt],wr=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(Dr);if(wr)switch(wr[1]){case"line":var Zr=/(\d+)(\s+\d+)?/.exec(wr[2]);Zr&&(Ut=Zr[1]|0,Zr[2]&&(cr=Zr[2]|0,cr in zt||(zt[cr]=new Ht)));break;case"define":var Br=/SHADER_NAME(_B64)?\s+(.*)$/.exec(wr[2]);Br&&(zt[cr].name=Br[1]?pe(Br[2]):Br[2]);break}zt[cr].lines.push(new ir(Ut++,Dr))}return Object.keys(zt).forEach(function(Ur){var Wr=zt[Ur];Wr.lines.forEach(function(Er){Wr.index[Er.number]=Er})}),zt}function hr(z){var Ee=[];return z.split(`
`).forEach(function(Ze){if(!(Ze.length<5)){var Ut=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(Ze);Ut?Ee.push(new Xt(Ut[1]|0,Ut[2]|0,Ut[3].trim())):Ze.length>0&&Ee.push(new Xt("unknown",0,Ze))}}),Ee}function ur(z,Ee){Ee.forEach(function(Ze){var Ut=z[Ze.file];if(Ut){var cr=Ut.index[Ze.line];if(cr){cr.errors.push(Ze),Ut.hasErrors=!0;return}}z.unknown.hasErrors=!0,z.unknown.lines[0].errors.push(Ze)})}function Et(z,Ee,Ze,Ut,cr){if(!z.getShaderParameter(Ee,z.COMPILE_STATUS)){var zt=z.getShaderInfoLog(Ee),kt=Ut===z.FRAGMENT_SHADER?"fragment":"vertex";H(Ze,"string",kt+" shader source must be a string",cr);var Dr=Pr(Ze,cr),wr=hr(zt);ur(Dr,wr),Object.keys(Dr).forEach(function(Zr){var Br=Dr[Zr];if(!Br.hasErrors)return;var Ur=[""],Wr=[""];function Er(zr,St){Ur.push(zr),Wr.push(St||"")}Er("file number "+Zr+": "+Br.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),Br.lines.forEach(function(zr){if(zr.errors.length>0){Er(Yt(zr.number,4)+"|  ","background-color:yellow; font-weight:bold"),Er(zr.line+re,"color:red; background-color:yellow; font-weight:bold");var St=0;zr.errors.forEach(function(Qt){var kr=Qt.message,Jr=/^\s*'(.*)'\s*:\s*(.*)$/.exec(kr);if(Jr){var gr=Jr[1];switch(kr=Jr[2],gr){case"assign":gr="=";break}St=Math.max(zr.line.indexOf(gr,St),0)}else St=0;Er(Yt("| ",6)),Er(Yt("^^^",St+3)+re,"font-weight:bold"),Er(Yt("| ",6)),Er(kr+re,"font-weight:bold")}),Er(Yt("| ",6)+re)}else Er(Yt(zr.number,4)+"|  "),Er(zr.line+re,"color:red")}),typeof document!="undefined"&&!window.chrome?(Wr[0]=Ur.join("%c"),console.log.apply(console,Wr)):console.log(Ur.join(""))}),le.raise("Error compiling "+kt+" shader, "+Dr[0].name)}}function nt(z,Ee,Ze,Ut,cr){if(!z.getProgramParameter(Ee,z.LINK_STATUS)){var zt=z.getProgramInfoLog(Ee),kt=Pr(Ze,cr),Dr=Pr(Ut,cr),wr='Error linking program with vertex shader, "'+Dr[0].name+'", and fragment shader "'+kt[0].name+'"';typeof document!="undefined"?console.log("%c"+wr+re+"%c"+zt,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(wr+re+zt),le.raise(wr)}}function Pt(z){z._commandRef=yt()}function ft(z,Ee,Ze,Ut){Pt(z);function cr(wr){return wr?Ut.id(wr):0}z._fragId=cr(z.static.frag),z._vertId=cr(z.static.vert);function zt(wr,Zr){Object.keys(Zr).forEach(function(Br){wr[Ut.id(Br)]=!0})}var kt=z._uniformSet={};zt(kt,Ee.static),zt(kt,Ee.dynamic);var Dr=z._attributeSet={};zt(Dr,Ze.static),zt(Dr,Ze.dynamic),z._hasCount="count"in z.static||"count"in z.dynamic||"elements"in z.static||"elements"in z.dynamic}function qt(z,Ee){var Ze=bt();_(z+" in command "+(Ee||yt())+(Ze==="unknown"?"":" called from "+Ze))}function Sr(z,Ee,Ze){z||qt(Ee,Ze||yt())}function te(z,Ee,Ze,Ut){z in Ee||qt("unknown parameter ("+z+")"+U(Ze)+". possible values: "+Object.keys(Ee).join(),Ut||yt())}function H(z,Ee,Ze,Ut){qe(z,Ee)||qt("invalid parameter type"+U(Ze)+". expected "+Ee+", got "+typeof z,Ut||yt())}function K(z){z()}function Be(z,Ee,Ze){z.texture?ht(z.texture._texture.internalformat,Ee,"unsupported texture format for attachment"):ht(z.renderbuffer._renderbuffer.format,Ze,"unsupported renderbuffer format for attachment")}var Ae=33071,dt=9728,Ue=9984,We=9985,it=9986,Mt=9987,yr=5120,lr=5121,Cn=5122,mn=5123,un=5124,oi=5125,jn=5126,rn=32819,$i=32820,Wi=33635,Zi=34042,Jn=36193,Bn={};Bn[yr]=Bn[lr]=1,Bn[Cn]=Bn[mn]=Bn[Jn]=Bn[Wi]=Bn[rn]=Bn[$i]=2,Bn[un]=Bn[oi]=Bn[jn]=Bn[Zi]=4;function Do(z,Ee){return z===$i||z===rn||z===Wi?2:z===Zi?4:Bn[z]*Ee}function oa(z){return!(z&z-1)&&!!z}function $a(z,Ee,Ze){var Ut,cr=Ee.width,zt=Ee.height,kt=Ee.channels;le(cr>0&&cr<=Ze.maxTextureSize&&zt>0&&zt<=Ze.maxTextureSize,"invalid texture shape"),(z.wrapS!==Ae||z.wrapT!==Ae)&&le(oa(cr)&&oa(zt),"incompatible wrap mode for texture, both width and height must be power of 2"),Ee.mipmask===1?cr!==1&&zt!==1&&le(z.minFilter!==Ue&&z.minFilter!==it&&z.minFilter!==We&&z.minFilter!==Mt,"min filter requires mipmap"):(le(oa(cr)&&oa(zt),"texture must be a square power of 2 to support mipmapping"),le(Ee.mipmask===(cr<<1)-1,"missing or incomplete mipmap data")),Ee.type===jn&&(Ze.extensions.indexOf("oes_texture_float_linear")<0&&le(z.minFilter===dt&&z.magFilter===dt,"filter not supported, must enable oes_texture_float_linear"),le(!z.genMipmaps,"mipmap generation not supported with float textures"));var Dr=Ee.images;for(Ut=0;Ut<16;++Ut)if(Dr[Ut]){var wr=cr>>Ut,Zr=zt>>Ut;le(Ee.mipmask&1<<Ut,"missing mipmap data");var Br=Dr[Ut];if(le(Br.width===wr&&Br.height===Zr,"invalid shape for mip images"),le(Br.format===Ee.format&&Br.internalformat===Ee.internalformat&&Br.type===Ee.type,"incompatible type for mip image"),!Br.compressed)if(Br.data){var Ur=Math.ceil(Do(Br.type,kt)*wr/Br.unpackAlignment)*Br.unpackAlignment;le(Br.data.byteLength===Ur*Zr,"invalid data for image, buffer size is inconsistent with image format")}else Br.element||Br.copy}else z.genMipmaps||le((Ee.mipmask&1<<Ut)===0,"extra mipmap data");Ee.compressed&&le(!z.genMipmaps,"mipmap generation for compressed images not supported")}function Ot(z,Ee,Ze,Ut){var cr=z.width,zt=z.height,kt=z.channels;le(cr>0&&cr<=Ut.maxTextureSize&&zt>0&&zt<=Ut.maxTextureSize,"invalid texture shape"),le(cr===zt,"cube map must be square"),le(Ee.wrapS===Ae&&Ee.wrapT===Ae,"wrap mode not supported by cube map");for(var Dr=0;Dr<Ze.length;++Dr){var wr=Ze[Dr];le(wr.width===cr&&wr.height===zt,"inconsistent cube map face shape"),Ee.genMipmaps&&(le(!wr.compressed,"can not generate mipmap for compressed textures"),le(wr.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var Zr=wr.images,Br=0;Br<16;++Br){var Ur=Zr[Br];if(Ur){var Wr=cr>>Br,Er=zt>>Br;le(wr.mipmask&1<<Br,"missing mipmap data"),le(Ur.width===Wr&&Ur.height===Er,"invalid shape for mip images"),le(Ur.format===z.format&&Ur.internalformat===z.internalformat&&Ur.type===z.type,"incompatible type for mip image"),Ur.compressed||(Ur.data?le(Ur.data.byteLength===Wr*Er*Math.max(Do(Ur.type,kt),Ur.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):Ur.element||Ur.copy)}}}}var F=L(le,{optional:K,raise:_,commandRaise:qt,command:Sr,parameter:he,commandParameter:te,constructor:Dt,type:ie,commandType:H,isTypedArray:ae,nni:Ke,oneOf:ht,shaderError:Et,linkError:nt,callSite:bt,saveCommandRef:Pt,saveDrawInfo:ft,framebufferFormat:Be,guessCommand:yt,texture2D:$a,textureCube:Ot}),ne=0,de=0;function Ne(z,Ee){this.id=ne++,this.type=z,this.data=Ee}function _t(z){return z.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function Kt(z){if(z.length===0)return[];var Ee=z.charAt(0),Ze=z.charAt(z.length-1);if(z.length>1&&Ee===Ze&&(Ee==='"'||Ee==="'"))return['"'+_t(z.substr(1,z.length-2))+'"'];var Ut=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(z);if(Ut)return Kt(z.substr(0,Ut.index)).concat(Kt(Ut[1])).concat(Kt(z.substr(Ut.index+Ut[0].length)));var cr=z.split(".");if(cr.length===1)return['"'+_t(z)+'"'];for(var zt=[],kt=0;kt<cr.length;++kt)zt=zt.concat(Kt(cr[kt]));return zt}function Ar(z){return"["+Kt(z).join("][")+"]"}function Ve(z,Ee){return new Ne(z,Ar(Ee+""))}function wt(z){return typeof z=="function"&&!z._reglType||z instanceof Ne}function sr(z,Ee){return typeof z=="function"?new Ne(de,z):z}var dr={DynamicVariable:Ne,define:Ve,isDynamic:wt,unbox:sr,accessor:Ar},Vr={next:typeof requestAnimationFrame=="function"?function(z){return requestAnimationFrame(z)}:function(z){return setTimeout(z,16)},cancel:typeof cancelAnimationFrame=="function"?function(z){return cancelAnimationFrame(z)}:clearTimeout},Ln=typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function En(){var z={"":0},Ee=[""];return{id:function(Ze){var Ut=z[Ze];return Ut||(Ut=z[Ze]=Ee.length,Ee.push(Ze),Ut)},str:function(Ze){return Ee[Ze]}}}function Rn(z,Ee,Ze){var Ut=document.createElement("canvas");L(Ut.style,{border:0,margin:0,padding:0,top:0,left:0}),z.appendChild(Ut),z===document.body&&(Ut.style.position="absolute",L(z.style,{margin:0,padding:0}));function cr(){var Dr=window.innerWidth,wr=window.innerHeight;if(z!==document.body){var Zr=z.getBoundingClientRect();Dr=Zr.right-Zr.left,wr=Zr.bottom-Zr.top}Ut.width=Ze*Dr,Ut.height=Ze*wr,L(Ut.style,{width:Dr+"px",height:wr+"px"})}var zt;z!==document.body&&typeof ResizeObserver=="function"?(zt=new ResizeObserver(function(){setTimeout(cr)}),zt.observe(z)):window.addEventListener("resize",cr,!1);function kt(){zt?zt.disconnect():window.removeEventListener("resize",cr),z.removeChild(Ut)}return cr(),{canvas:Ut,onDestroy:kt}}function xn(z,Ee){function Ze(Ut){try{return z.getContext(Ut,Ee)}catch(cr){return null}}return Ze("webgl")||Ze("experimental-webgl")||Ze("webgl-experimental")}function si(z){return typeof z.nodeName=="string"&&typeof z.appendChild=="function"&&typeof z.getBoundingClientRect=="function"}function ei(z){return typeof z.drawArrays=="function"||typeof z.drawElements=="function"}function la(z){return typeof z=="string"?z.split():(F(Array.isArray(z),"invalid extension array"),z)}function sa(z){return typeof z=="string"?(F(typeof document!="undefined","not supported outside of DOM"),document.querySelector(z)):z}function Eo(z){var Ee=z||{},Ze,Ut,cr,zt,kt={},Dr=[],wr=[],Zr=typeof window=="undefined"?1:window.devicePixelRatio,Br=!1,Ur=function(zr){zr&&F.raise(zr)},Wr=function(){};if(typeof Ee=="string"?(F(typeof document!="undefined","selector queries only supported in DOM enviroments"),Ze=document.querySelector(Ee),F(Ze,"invalid query string for element")):typeof Ee=="object"?si(Ee)?Ze=Ee:ei(Ee)?(zt=Ee,cr=zt.canvas):(F.constructor(Ee),"gl"in Ee?zt=Ee.gl:"canvas"in Ee?cr=sa(Ee.canvas):"container"in Ee&&(Ut=sa(Ee.container)),"attributes"in Ee&&(kt=Ee.attributes,F.type(kt,"object","invalid context attributes")),"extensions"in Ee&&(Dr=la(Ee.extensions)),"optionalExtensions"in Ee&&(wr=la(Ee.optionalExtensions)),"onDone"in Ee&&(F.type(Ee.onDone,"function","invalid or missing onDone callback"),Ur=Ee.onDone),"profile"in Ee&&(Br=!!Ee.profile),"pixelRatio"in Ee&&(Zr=+Ee.pixelRatio,F(Zr>0,"invalid pixel ratio"))):F.raise("invalid arguments to regl"),Ze&&(Ze.nodeName.toLowerCase()==="canvas"?cr=Ze:Ut=Ze),!zt){if(!cr){F(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var Er=Rn(Ut||document.body,Ur,Zr);if(!Er)return null;cr=Er.canvas,Wr=Er.onDestroy}kt.premultipliedAlpha===void 0&&(kt.premultipliedAlpha=!0),zt=xn(cr,kt)}return zt?{gl:zt,canvas:cr,container:Ut,extensions:Dr,optionalExtensions:wr,pixelRatio:Zr,profile:Br,onDone:Ur,onDestroy:Wr}:(Wr(),Ur("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Ks(z,Ee){var Ze={};function Ut(kt){F.type(kt,"string","extension name must be string");var Dr=kt.toLowerCase(),wr;try{wr=Ze[Dr]=z.getExtension(Dr)}catch(Zr){}return!!wr}for(var cr=0;cr<Ee.extensions.length;++cr){var zt=Ee.extensions[cr];if(!Ut(zt))return Ee.onDestroy(),Ee.onDone('"'+zt+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return Ee.optionalExtensions.forEach(Ut),{extensions:Ze,restore:function(){Object.keys(Ze).forEach(function(kt){if(Ze[kt]&&!Ut(kt))throw new Error("(regl): error restoring extension "+kt)})}}}function di(z,Ee){for(var Ze=Array(z),Ut=0;Ut<z;++Ut)Ze[Ut]=Ee(Ut);return Ze}var W=5120,Q=5121,se=5122,xe=5123,Re=5124,Je=5125,lt=5126;function V(z){for(var Ee=16;Ee<=1<<28;Ee*=16)if(z<=Ee)return Ee;return 0}function q(z){var Ee,Ze;return Ee=(z>65535)<<4,z>>>=Ee,Ze=(z>255)<<3,z>>>=Ze,Ee|=Ze,Ze=(z>15)<<2,z>>>=Ze,Ee|=Ze,Ze=(z>3)<<1,z>>>=Ze,Ee|=Ze,Ee|z>>1}function De(){var z=di(8,function(){return[]});function Ee(zt){var kt=V(zt),Dr=z[q(kt)>>2];return Dr.length>0?Dr.pop():new ArrayBuffer(kt)}function Ze(zt){z[q(zt.byteLength)>>2].push(zt)}function Ut(zt,kt){var Dr=null;switch(zt){case W:Dr=new Int8Array(Ee(kt),0,kt);break;case Q:Dr=new Uint8Array(Ee(kt),0,kt);break;case se:Dr=new Int16Array(Ee(2*kt),0,kt);break;case xe:Dr=new Uint16Array(Ee(2*kt),0,kt);break;case Re:Dr=new Int32Array(Ee(4*kt),0,kt);break;case Je:Dr=new Uint32Array(Ee(4*kt),0,kt);break;case lt:Dr=new Float32Array(Ee(4*kt),0,kt);break;default:return null}return Dr.length!==kt?Dr.subarray(0,kt):Dr}function cr(zt){Ze(zt.buffer)}return{alloc:Ee,free:Ze,allocType:Ut,freeType:cr}}var et=De();et.zero=De();var be=3408,er=3410,Tr=3411,bn=3412,nn=3413,ar=3414,Kr=3415,Hr=33901,$r=33902,hi=3379,Qr=3386,vi=34921,Yi=36347,ci=36348,Li=35661,Si=35660,Xo=34930,Ki=36349,Ia=34076,Ai=34024,mi=7936,Ti=7937,Pa=7938,cu=35724,ma=34047,Aa=36063,$l=34852,os=3553,Ta=34067,fi=34069,Oa=33984,ia=6408,So=5126,ha=5121,$o=36160,Vo=36053,Ru=36064,ss=16384,Cc=function(z,Ee){var Ze=1;Ee.ext_texture_filter_anisotropic&&(Ze=z.getParameter(ma));var Ut=1,cr=1;Ee.webgl_draw_buffers&&(Ut=z.getParameter($l),cr=z.getParameter(Aa));var zt=!!Ee.oes_texture_float;if(zt){var kt=z.createTexture();z.bindTexture(os,kt),z.texImage2D(os,0,ia,1,1,0,ia,So,null);var Dr=z.createFramebuffer();if(z.bindFramebuffer($o,Dr),z.framebufferTexture2D($o,Ru,os,kt,0),z.bindTexture(os,null),z.checkFramebufferStatus($o)!==Vo)zt=!1;else{z.viewport(0,0,1,1),z.clearColor(1,0,0,1),z.clear(ss);var wr=et.allocType(So,4);z.readPixels(0,0,1,1,ia,So,wr),z.getError()?zt=!1:(z.deleteFramebuffer(Dr),z.deleteTexture(kt),zt=wr[0]===1),et.freeType(wr)}}var Zr=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),Br=!0;if(!Zr){var Ur=z.createTexture(),Wr=et.allocType(ha,36);z.activeTexture(Oa),z.bindTexture(Ta,Ur),z.texImage2D(fi,0,ia,3,3,0,ia,ha,Wr),et.freeType(Wr),z.bindTexture(Ta,null),z.deleteTexture(Ur),Br=!z.getError()}return{colorBits:[z.getParameter(er),z.getParameter(Tr),z.getParameter(bn),z.getParameter(nn)],depthBits:z.getParameter(ar),stencilBits:z.getParameter(Kr),subpixelBits:z.getParameter(be),extensions:Object.keys(Ee).filter(function(Er){return!!Ee[Er]}),maxAnisotropic:Ze,maxDrawbuffers:Ut,maxColorAttachments:cr,pointSizeDims:z.getParameter(Hr),lineWidthDims:z.getParameter($r),maxViewportDims:z.getParameter(Qr),maxCombinedTextureUnits:z.getParameter(Li),maxCubeMapSize:z.getParameter(Ia),maxRenderbufferSize:z.getParameter(Ai),maxTextureUnits:z.getParameter(Xo),maxTextureSize:z.getParameter(hi),maxAttributes:z.getParameter(vi),maxVertexUniforms:z.getParameter(Yi),maxVertexTextureUnits:z.getParameter(Si),maxVaryingVectors:z.getParameter(ci),maxFragmentUniforms:z.getParameter(Ki),glsl:z.getParameter(cu),renderer:z.getParameter(Ti),vendor:z.getParameter(mi),version:z.getParameter(Pa),readFloat:zt,npotTextureCube:Br}};function Ea(z){return!!z&&typeof z=="object"&&Array.isArray(z.shape)&&Array.isArray(z.stride)&&typeof z.offset=="number"&&z.shape.length===z.stride.length&&(Array.isArray(z.data)||J(z.data))}var Qi=function(z){return Object.keys(z).map(function(Ee){return z[Ee]})},Wt={shape:jr,flatten:nr};function yn(z,Ee,Ze){for(var Ut=0;Ut<Ee;++Ut)Ze[Ut]=z[Ut]}function fe(z,Ee,Ze,Ut){for(var cr=0,zt=0;zt<Ee;++zt)for(var kt=z[zt],Dr=0;Dr<Ze;++Dr)Ut[cr++]=kt[Dr]}function Te(z,Ee,Ze,Ut,cr,zt){for(var kt=zt,Dr=0;Dr<Ee;++Dr)for(var wr=z[Dr],Zr=0;Zr<Ze;++Zr)for(var Br=wr[Zr],Ur=0;Ur<Ut;++Ur)cr[kt++]=Br[Ur]}function ot(z,Ee,Ze,Ut,cr){for(var zt=1,kt=Ze+1;kt<Ee.length;++kt)zt*=Ee[kt];var Dr=Ee[Ze];if(Ee.length-Ze===4){var wr=Ee[Ze+1],Zr=Ee[Ze+2],Br=Ee[Ze+3];for(kt=0;kt<Dr;++kt)Te(z[kt],wr,Zr,Br,Ut,cr),cr+=zt}else for(kt=0;kt<Dr;++kt)ot(z[kt],Ee,Ze+1,Ut,cr),cr+=zt}function nr(z,Ee,Ze,Ut){var cr=1;if(Ee.length)for(var zt=0;zt<Ee.length;++zt)cr*=Ee[zt];else cr=0;var kt=Ut||et.allocType(Ze,cr);switch(Ee.length){case 0:break;case 1:yn(z,Ee[0],kt);break;case 2:fe(z,Ee[0],Ee[1],kt);break;case 3:Te(z,Ee[0],Ee[1],Ee[2],kt,0);break;default:ot(z,Ee,0,kt,0)}return kt}function jr(z){for(var Ee=[],Ze=z;Ze.length;Ze=Ze[0])Ee.push(Ze.length);return Ee}var Mn={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Vi=5120,ho=5122,Ao=5124,uo=5121,Is=5123,ys=5125,Kh=5126,Cf=5126,jo={int8:Vi,int16:ho,int32:Ao,uint8:uo,uint16:Is,uint32:ys,float:Kh,float32:Cf},xl=35048,bl=35040,Mu={dynamic:xl,stream:bl,static:35044},Iu=Wt.flatten,Qu=Wt.shape,Qc=35044,Ps=35040,Ya=5121,El=5126,Ju=[];Ju[5120]=1,Ju[5122]=2,Ju[5124]=4,Ju[5121]=1,Ju[5123]=2,Ju[5125]=4,Ju[5126]=4;function Rf(z){return Mn[Object.prototype.toString.call(z)]|0}function Qh(z,Ee){for(var Ze=0;Ze<Ee.length;++Ze)z[Ze]=Ee[Ze]}function Mf(z,Ee,Ze,Ut,cr,zt,kt){for(var Dr=0,wr=0;wr<Ze;++wr)for(var Zr=0;Zr<Ut;++Zr)z[Dr++]=Ee[cr*wr+zt*Zr+kt]}function ph(z,Ee,Ze,Ut){var cr=0,zt={};function kt(St){this.id=cr++,this.buffer=z.createBuffer(),this.type=St,this.usage=Qc,this.byteLength=0,this.dimension=1,this.dtype=Ya,this.persistentData=null,Ze.profile&&(this.stats={size:0})}kt.prototype.bind=function(){z.bindBuffer(this.type,this.buffer)},kt.prototype.destroy=function(){Wr(this)};var Dr=[];function wr(St,Qt){var kr=Dr.pop();return kr||(kr=new kt(St)),kr.bind(),Ur(kr,Qt,Ps,0,1,!1),kr}function Zr(St){Dr.push(St)}function Br(St,Qt,kr){St.byteLength=Qt.byteLength,z.bufferData(St.type,Qt,kr)}function Ur(St,Qt,kr,Jr,gr,tn){var Ir;if(St.usage=kr,Array.isArray(Qt)){if(St.dtype=Jr||El,Qt.length>0){var en;if(Array.isArray(Qt[0])){Ir=Qu(Qt);for(var xr=1,Xr=1;Xr<Ir.length;++Xr)xr*=Ir[Xr];St.dimension=xr,en=Iu(Qt,Ir,St.dtype),Br(St,en,kr),tn?St.persistentData=en:et.freeType(en)}else if(typeof Qt[0]=="number"){St.dimension=gr;var Fn=et.allocType(St.dtype,Qt.length);Qh(Fn,Qt),Br(St,Fn,kr),tn?St.persistentData=Fn:et.freeType(Fn)}else J(Qt[0])?(St.dimension=Qt[0].length,St.dtype=Jr||Rf(Qt[0])||El,en=Iu(Qt,[Qt.length,Qt[0].length],St.dtype),Br(St,en,kr),tn?St.persistentData=en:et.freeType(en)):F.raise("invalid buffer data")}}else if(J(Qt))St.dtype=Jr||Rf(Qt),St.dimension=gr,Br(St,Qt,kr),tn&&(St.persistentData=new Uint8Array(new Uint8Array(Qt.buffer)));else if(Ea(Qt)){Ir=Qt.shape;var ui=Qt.stride,qr=Qt.offset,gt=0,pr=0,tt=0,wi=0;Ir.length===1?(gt=Ir[0],pr=1,tt=ui[0],wi=0):Ir.length===2?(gt=Ir[0],pr=Ir[1],tt=ui[0],wi=ui[1]):F.raise("invalid shape"),St.dtype=Jr||Rf(Qt.data)||El,St.dimension=pr;var on=et.allocType(St.dtype,gt*pr);Mf(on,Qt.data,gt,pr,tt,wi,qr),Br(St,on,kr),tn?St.persistentData=on:et.freeType(on)}else Qt instanceof ArrayBuffer?(St.dtype=Ya,St.dimension=gr,Br(St,Qt,kr),tn&&(St.persistentData=new Uint8Array(new Uint8Array(Qt)))):F.raise("invalid buffer data")}function Wr(St){Ee.bufferCount--,Ut(St);var Qt=St.buffer;F(Qt,"buffer must not be deleted already"),z.deleteBuffer(Qt),St.buffer=null,delete zt[St.id]}function Er(St,Qt,kr,Jr){Ee.bufferCount++;var gr=new kt(Qt);zt[gr.id]=gr;function tn(xr){var Xr=Qc,Fn=null,ui=0,qr=0,gt=1;return Array.isArray(xr)||J(xr)||Ea(xr)||xr instanceof ArrayBuffer?Fn=xr:typeof xr=="number"?ui=xr|0:xr&&(F.type(xr,"object","buffer arguments must be an object, a number or an array"),"data"in xr&&(F(Fn===null||Array.isArray(Fn)||J(Fn)||Ea(Fn),"invalid data for buffer"),Fn=xr.data),"usage"in xr&&(F.parameter(xr.usage,Mu,"invalid buffer usage"),Xr=Mu[xr.usage]),"type"in xr&&(F.parameter(xr.type,jo,"invalid buffer type"),qr=jo[xr.type]),"dimension"in xr&&(F.type(xr.dimension,"number","invalid dimension"),gt=xr.dimension|0),"length"in xr&&(F.nni(ui,"buffer length must be a nonnegative integer"),ui=xr.length|0)),gr.bind(),Fn?Ur(gr,Fn,Xr,qr,gt,Jr):(ui&&z.bufferData(gr.type,ui,Xr),gr.dtype=qr||Ya,gr.usage=Xr,gr.dimension=gt,gr.byteLength=ui),Ze.profile&&(gr.stats.size=gr.byteLength*Ju[gr.dtype]),tn}function Ir(xr,Xr){F(Xr+xr.byteLength<=gr.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+xr.byteLength+" starting from offset "+Xr+" to a buffer of size "+gr.byteLength),z.bufferSubData(gr.type,Xr,xr)}function en(xr,Xr){var Fn=(Xr||0)|0,ui;if(gr.bind(),J(xr)||xr instanceof ArrayBuffer)Ir(xr,Fn);else if(Array.isArray(xr)){if(xr.length>0)if(typeof xr[0]=="number"){var qr=et.allocType(gr.dtype,xr.length);Qh(qr,xr),Ir(qr,Fn),et.freeType(qr)}else if(Array.isArray(xr[0])||J(xr[0])){ui=Qu(xr);var gt=Iu(xr,ui,gr.dtype);Ir(gt,Fn),et.freeType(gt)}else F.raise("invalid buffer data")}else if(Ea(xr)){ui=xr.shape;var pr=xr.stride,tt=0,wi=0,on=0,yi=0;ui.length===1?(tt=ui[0],wi=1,on=pr[0],yi=0):ui.length===2?(tt=ui[0],wi=ui[1],on=pr[0],yi=pr[1]):F.raise("invalid shape");var ai=Array.isArray(xr.data)?gr.dtype:Rf(xr.data),Yn=et.allocType(ai,tt*wi);Mf(Yn,xr.data,tt,wi,on,yi,xr.offset),Ir(Yn,Fn),et.freeType(Yn)}else F.raise("invalid data for buffer subdata");return tn}return kr||tn(St),tn._reglType="buffer",tn._buffer=gr,tn.subdata=en,Ze.profile&&(tn.stats=gr.stats),tn.destroy=function(){Wr(gr)},tn}function zr(){Qi(zt).forEach(function(St){St.buffer=z.createBuffer(),z.bindBuffer(St.type,St.buffer),z.bufferData(St.type,St.persistentData||St.byteLength,St.usage)})}return Ze.profile&&(Ee.getTotalBufferSize=function(){var St=0;return Object.keys(zt).forEach(function(Qt){St+=zt[Qt].stats.size}),St}),{create:Er,createStream:wr,destroyStream:Zr,clear:function(){Qi(zt).forEach(Wr),Dr.forEach(Wr)},getBuffer:function(St){return St&&St._buffer instanceof kt?St._buffer:null},restore:zr,_initBuffer:Ur}}var dh=0,vh=0,Jh=1,ep=1,Zp=4,Jc=4,Pu={points:dh,point:vh,lines:Jh,line:ep,triangles:Zp,triangle:Jc,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},tp=0,Ho=1,Yl=4,Sl=5120,Xs=5121,Al=5122,ii=5123,el=5124,Os=5125,Ou=34963,tl=35040,rp=35044;function Ji(z,Ee,Ze,Ut){var cr={},zt=0,kt={uint8:Xs,uint16:ii};Ee.oes_element_index_uint&&(kt.uint32=Os);function Dr(zr){this.id=zt++,cr[this.id]=this,this.buffer=zr,this.primType=Yl,this.vertCount=0,this.type=0}Dr.prototype.bind=function(){this.buffer.bind()};var wr=[];function Zr(zr){var St=wr.pop();return St||(St=new Dr(Ze.create(null,Ou,!0,!1)._buffer)),Ur(St,zr,tl,-1,-1,0,0),St}function Br(zr){wr.push(zr)}function Ur(zr,St,Qt,kr,Jr,gr,tn){zr.buffer.bind();var Ir;if(St){var en=tn;!tn&&(!J(St)||Ea(St)&&!J(St.data))&&(en=Ee.oes_element_index_uint?Os:ii),Ze._initBuffer(zr.buffer,St,Qt,en,3)}else z.bufferData(Ou,gr,Qt),zr.buffer.dtype=Ir||Xs,zr.buffer.usage=Qt,zr.buffer.dimension=3,zr.buffer.byteLength=gr;if(Ir=tn,!tn){switch(zr.buffer.dtype){case Xs:case Sl:Ir=Xs;break;case ii:case Al:Ir=ii;break;case Os:case el:Ir=Os;break;default:F.raise("unsupported type for element array")}zr.buffer.dtype=Ir}zr.type=Ir,F(Ir!==Os||!!Ee.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var xr=Jr;xr<0&&(xr=zr.buffer.byteLength,Ir===ii?xr>>=1:Ir===Os&&(xr>>=2)),zr.vertCount=xr;var Xr=kr;if(kr<0){Xr=Yl;var Fn=zr.buffer.dimension;Fn===1&&(Xr=tp),Fn===2&&(Xr=Ho),Fn===3&&(Xr=Yl)}zr.primType=Xr}function Wr(zr){Ut.elementsCount--,F(zr.buffer!==null,"must not double destroy elements"),delete cr[zr.id],zr.buffer.destroy(),zr.buffer=null}function Er(zr,St){var Qt=Ze.create(null,Ou,!0),kr=new Dr(Qt._buffer);Ut.elementsCount++;function Jr(gr){if(!gr)Qt(),kr.primType=Yl,kr.vertCount=0,kr.type=Xs;else if(typeof gr=="number")Qt(gr),kr.primType=Yl,kr.vertCount=gr|0,kr.type=Xs;else{var tn=null,Ir=rp,en=-1,xr=-1,Xr=0,Fn=0;Array.isArray(gr)||J(gr)||Ea(gr)?tn=gr:(F.type(gr,"object","invalid arguments for elements"),"data"in gr&&(tn=gr.data,F(Array.isArray(tn)||J(tn)||Ea(tn),"invalid data for element buffer")),"usage"in gr&&(F.parameter(gr.usage,Mu,"invalid element buffer usage"),Ir=Mu[gr.usage]),"primitive"in gr&&(F.parameter(gr.primitive,Pu,"invalid element buffer primitive"),en=Pu[gr.primitive]),"count"in gr&&(F(typeof gr.count=="number"&&gr.count>=0,"invalid vertex count for elements"),xr=gr.count|0),"type"in gr&&(F.parameter(gr.type,kt,"invalid buffer type"),Fn=kt[gr.type]),"length"in gr?Xr=gr.length|0:(Xr=xr,Fn===ii||Fn===Al?Xr*=2:(Fn===Os||Fn===el)&&(Xr*=4))),Ur(kr,tn,Ir,en,xr,Xr,Fn)}return Jr}return Jr(zr),Jr._reglType="elements",Jr._elements=kr,Jr.subdata=function(gr,tn){return Qt.subdata(gr,tn),Jr},Jr.destroy=function(){Wr(kr)},Jr}return{create:Er,createStream:Zr,destroyStream:Br,getElements:function(zr){return typeof zr=="function"&&zr._elements instanceof Dr?zr._elements:null},clear:function(){Qi(cr).forEach(Wr)}}}var Ci=new Float32Array(1),fu=new Uint32Array(Ci.buffer),Du=5123;function mh(z){for(var Ee=et.allocType(Du,z.length),Ze=0;Ze<z.length;++Ze)if(isNaN(z[Ze]))Ee[Ze]=65535;else if(z[Ze]===1/0)Ee[Ze]=31744;else if(z[Ze]===-1/0)Ee[Ze]=64512;else{Ci[0]=z[Ze];var Ut=fu[0],cr=Ut>>>31<<15,zt=(Ut<<1>>>24)-127,kt=Ut>>13&1024-1;if(zt<-24)Ee[Ze]=cr;else if(zt<-14){var Dr=-14-zt;Ee[Ze]=cr+(kt+1024>>Dr)}else zt>15?Ee[Ze]=cr+31744:Ee[Ze]=cr+(zt+15<<10)+kt}return Ee}function ja(z){return Array.isArray(z)||J(z)}var ef=function(z){return!(z&z-1)&&!!z},Vp=34467,xs=3553,ku=34067,Fu=34069,ql=6408,If=6406,wa=6407,Qs=6409,Rc=6410,Kl=32854,rl=32855,gh=36194,Ql=32819,ca=32820,tf=33635,np=34042,Tl=6402,Jl=34041,_h=35904,Pf=35906,wl=36193,hu=33776,Mc=33777,rf=33778,ec=33779,tc=35986,ip=35987,nl=34798,Js=35840,nf=35841,Ic=35842,yh=35843,Cl=36196,pu=5121,af=5123,Pc=5125,Bu=5126,Md=10242,Of=10243,xh=10497,Df=33071,ko=33648,bh=10240,ap=10241,kf=9728,Eh=9729,Oc=9984,of=9985,il=9986,pa=9987,Ff=33170,du=4352,Rl=4353,ki=4354,Ca=34046,$s=3317,Bf=37440,Ds=37441,sf=37443,op=37444,Sh=33984,Lf=[Oc,il,of,pa],Ml=[0,Qs,Rc,wa,ql],Fo={};Fo[Qs]=Fo[If]=Fo[Tl]=1,Fo[Jl]=Fo[Rc]=2,Fo[wa]=Fo[_h]=3,Fo[ql]=Fo[Pf]=4;function Ha(z){return"[object "+z+"]"}var al=Ha("HTMLCanvasElement"),Ah=Ha("OffscreenCanvas"),qa=Ha("CanvasRenderingContext2D"),vn=Ha("ImageBitmap"),ks=Ha("HTMLImageElement"),uf=Ha("HTMLVideoElement"),rc=Object.keys(Mn).concat([al,Ah,qa,vn,ks,uf]),us=[];us[pu]=1,us[Bu]=4,us[wl]=2,us[af]=2,us[Pc]=4;var ga=[];ga[Kl]=2,ga[rl]=2,ga[gh]=2,ga[Jl]=4,ga[hu]=.5,ga[Mc]=.5,ga[rf]=1,ga[ec]=1,ga[tc]=.5,ga[ip]=1,ga[nl]=1,ga[Js]=.5,ga[nf]=.25,ga[Ic]=.5,ga[yh]=.25,ga[Cl]=.5;function Th(z){return Array.isArray(z)&&(z.length===0||typeof z[0]=="number")}function Yr(z){if(!Array.isArray(z))return!1;var Ee=z.length;return!(Ee===0||!ja(z[0]))}function ol(z){return Object.prototype.toString.call(z)}function Dc(z){return ol(z)===al}function wh(z){return ol(z)===Ah}function eu(z){return ol(z)===qa}function Fs(z){return ol(z)===vn}function Nf(z){return ol(z)===ks}function Uf(z){return ol(z)===uf}function Yo(z){if(!z)return!1;var Ee=ol(z);return rc.indexOf(Ee)>=0?!0:Th(z)||Yr(z)||Ea(z)}function Lu(z){return Mn[Object.prototype.toString.call(z)]|0}function sp(z,Ee){var Ze=Ee.length;switch(z.type){case pu:case af:case Pc:case Bu:var Ut=et.allocType(z.type,Ze);Ut.set(Ee),z.data=Ut;break;case wl:z.data=mh(Ee);break;default:F.raise("unsupported texture type, must specify a typed array")}}function Il(z,Ee){return et.allocType(z.type===wl?Bu:z.type,Ee)}function lf(z,Ee){z.type===wl?(z.data=mh(Ee),et.freeType(Ee)):z.data=Ee}function up(z,Ee,Ze,Ut,cr,zt){for(var kt=z.width,Dr=z.height,wr=z.channels,Zr=kt*Dr*wr,Br=Il(z,Zr),Ur=0,Wr=0;Wr<Dr;++Wr)for(var Er=0;Er<kt;++Er)for(var zr=0;zr<wr;++zr)Br[Ur++]=Ee[Ze*Er+Ut*Wr+cr*zr+zt];lf(z,Br)}function Ct(z,Ee,Ze,Ut,cr,zt){var kt;if(typeof ga[z]!="undefined"?kt=ga[z]:kt=Fo[z]*us[Ee],zt&&(kt*=6),cr){for(var Dr=0,wr=Ze;wr>=1;)Dr+=kt*wr*wr,wr/=2;return Dr}else return kt*Ze*Ut}function Ie(z,Ee,Ze,Ut,cr,zt,kt){var Dr={"don't care":du,"dont care":du,nice:ki,fast:Rl},wr={repeat:xh,clamp:Df,mirror:ko},Zr={nearest:kf,linear:Eh},Br=L({mipmap:pa,"nearest mipmap nearest":Oc,"linear mipmap nearest":of,"nearest mipmap linear":il,"linear mipmap linear":pa},Zr),Ur={none:0,browser:op},Wr={uint8:pu,rgba4:Ql,rgb565:tf,"rgb5 a1":ca},Er={alpha:If,luminance:Qs,"luminance alpha":Rc,rgb:wa,rgba:ql,rgba4:Kl,"rgb5 a1":rl,rgb565:gh},zr={};Ee.ext_srgb&&(Er.srgb=_h,Er.srgba=Pf),Ee.oes_texture_float&&(Wr.float32=Wr.float=Bu),Ee.oes_texture_half_float&&(Wr.float16=Wr["half float"]=wl),Ee.webgl_depth_texture&&(L(Er,{depth:Tl,"depth stencil":Jl}),L(Wr,{uint16:af,uint32:Pc,"depth stencil":np})),Ee.webgl_compressed_texture_s3tc&&L(zr,{"rgb s3tc dxt1":hu,"rgba s3tc dxt1":Mc,"rgba s3tc dxt3":rf,"rgba s3tc dxt5":ec}),Ee.webgl_compressed_texture_atc&&L(zr,{"rgb atc":tc,"rgba atc explicit alpha":ip,"rgba atc interpolated alpha":nl}),Ee.webgl_compressed_texture_pvrtc&&L(zr,{"rgb pvrtc 4bppv1":Js,"rgb pvrtc 2bppv1":nf,"rgba pvrtc 4bppv1":Ic,"rgba pvrtc 2bppv1":yh}),Ee.webgl_compressed_texture_etc1&&(zr["rgb etc1"]=Cl);var St=Array.prototype.slice.call(z.getParameter(Vp));Object.keys(zr).forEach(function(ke){var Zt=zr[ke];St.indexOf(Zt)>=0&&(Er[ke]=Zt)});var Qt=Object.keys(Er);Ze.textureFormats=Qt;var kr=[];Object.keys(Er).forEach(function(ke){var Zt=Er[ke];kr[Zt]=ke});var Jr=[];Object.keys(Wr).forEach(function(ke){var Zt=Wr[ke];Jr[Zt]=ke});var gr=[];Object.keys(Zr).forEach(function(ke){var Zt=Zr[ke];gr[Zt]=ke});var tn=[];Object.keys(Br).forEach(function(ke){var Zt=Br[ke];tn[Zt]=ke});var Ir=[];Object.keys(wr).forEach(function(ke){var Zt=wr[ke];Ir[Zt]=ke});var en=Qt.reduce(function(ke,Zt){var Bt=Er[Zt];return Bt===Qs||Bt===If||Bt===Qs||Bt===Rc||Bt===Tl||Bt===Jl||Ee.ext_srgb&&(Bt===_h||Bt===Pf)?ke[Bt]=Bt:Bt===rl||Zt.indexOf("rgba")>=0?ke[Bt]=ql:ke[Bt]=wa,ke},{});function xr(){this.internalformat=ql,this.format=ql,this.type=pu,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=op,this.width=0,this.height=0,this.channels=0}function Xr(ke,Zt){ke.internalformat=Zt.internalformat,ke.format=Zt.format,ke.type=Zt.type,ke.compressed=Zt.compressed,ke.premultiplyAlpha=Zt.premultiplyAlpha,ke.flipY=Zt.flipY,ke.unpackAlignment=Zt.unpackAlignment,ke.colorSpace=Zt.colorSpace,ke.width=Zt.width,ke.height=Zt.height,ke.channels=Zt.channels}function Fn(ke,Zt){if(!(typeof Zt!="object"||!Zt)){if("premultiplyAlpha"in Zt&&(F.type(Zt.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),ke.premultiplyAlpha=Zt.premultiplyAlpha),"flipY"in Zt&&(F.type(Zt.flipY,"boolean","invalid texture flip"),ke.flipY=Zt.flipY),"alignment"in Zt&&(F.oneOf(Zt.alignment,[1,2,4,8],"invalid texture unpack alignment"),ke.unpackAlignment=Zt.alignment),"colorSpace"in Zt&&(F.parameter(Zt.colorSpace,Ur,"invalid colorSpace"),ke.colorSpace=Ur[Zt.colorSpace]),"type"in Zt){var Bt=Zt.type;F(Ee.oes_texture_float||!(Bt==="float"||Bt==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),F(Ee.oes_texture_half_float||!(Bt==="half float"||Bt==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),F(Ee.webgl_depth_texture||!(Bt==="uint16"||Bt==="uint32"||Bt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),F.parameter(Bt,Wr,"invalid texture type"),ke.type=Wr[Bt]}var ln=ke.width,bi=ke.height,da=ke.channels,ue=!1;"shape"in Zt?(F(Array.isArray(Zt.shape)&&Zt.shape.length>=2,"shape must be an array"),ln=Zt.shape[0],bi=Zt.shape[1],Zt.shape.length===3&&(da=Zt.shape[2],F(da>0&&da<=4,"invalid number of channels"),ue=!0),F(ln>=0&&ln<=Ze.maxTextureSize,"invalid width"),F(bi>=0&&bi<=Ze.maxTextureSize,"invalid height")):("radius"in Zt&&(ln=bi=Zt.radius,F(ln>=0&&ln<=Ze.maxTextureSize,"invalid radius")),"width"in Zt&&(ln=Zt.width,F(ln>=0&&ln<=Ze.maxTextureSize,"invalid width")),"height"in Zt&&(bi=Zt.height,F(bi>=0&&bi<=Ze.maxTextureSize,"invalid height")),"channels"in Zt&&(da=Zt.channels,F(da>0&&da<=4,"invalid number of channels"),ue=!0)),ke.width=ln|0,ke.height=bi|0,ke.channels=da|0;var Se=!1;if("format"in Zt){var ze=Zt.format;F(Ee.webgl_depth_texture||!(ze==="depth"||ze==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),F.parameter(ze,Er,"invalid texture format");var Lt=ke.internalformat=Er[ze];ke.format=en[Lt],ze in Wr&&("type"in Zt||(ke.type=Wr[ze])),ze in zr&&(ke.compressed=!0),Se=!0}!ue&&Se?ke.channels=Fo[ke.format]:ue&&!Se?ke.channels!==Ml[ke.format]&&(ke.format=ke.internalformat=Ml[ke.channels]):Se&&ue&&F(ke.channels===Fo[ke.format],"number of channels inconsistent with specified format")}}function ui(ke){z.pixelStorei(Bf,ke.flipY),z.pixelStorei(Ds,ke.premultiplyAlpha),z.pixelStorei(sf,ke.colorSpace),z.pixelStorei($s,ke.unpackAlignment)}function qr(){xr.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function gt(ke,Zt){var Bt=null;if(Yo(Zt)?Bt=Zt:Zt&&(F.type(Zt,"object","invalid pixel data type"),Fn(ke,Zt),"x"in Zt&&(ke.xOffset=Zt.x|0),"y"in Zt&&(ke.yOffset=Zt.y|0),Yo(Zt.data)&&(Bt=Zt.data)),F(!ke.compressed||Bt instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),Zt.copy){F(!Bt,"can not specify copy and data field for the same texture");var ln=cr.viewportWidth,bi=cr.viewportHeight;ke.width=ke.width||ln-ke.xOffset,ke.height=ke.height||bi-ke.yOffset,ke.needsCopy=!0,F(ke.xOffset>=0&&ke.xOffset<ln&&ke.yOffset>=0&&ke.yOffset<bi&&ke.width>0&&ke.width<=ln&&ke.height>0&&ke.height<=bi,"copy texture read out of bounds")}else if(!Bt)ke.width=ke.width||1,ke.height=ke.height||1,ke.channels=ke.channels||4;else if(J(Bt))ke.channels=ke.channels||4,ke.data=Bt,!("type"in Zt)&&ke.type===pu&&(ke.type=Lu(Bt));else if(Th(Bt))ke.channels=ke.channels||4,sp(ke,Bt),ke.alignment=1,ke.needsFree=!0;else if(Ea(Bt)){var da=Bt.data;!Array.isArray(da)&&ke.type===pu&&(ke.type=Lu(da));var ue=Bt.shape,Se=Bt.stride,ze,Lt,Ft,Ye,st,pt;ue.length===3?(Ft=ue[2],pt=Se[2]):(F(ue.length===2,"invalid ndarray pixel data, must be 2 or 3D"),Ft=1,pt=1),ze=ue[0],Lt=ue[1],Ye=Se[0],st=Se[1],ke.alignment=1,ke.width=ze,ke.height=Lt,ke.channels=Ft,ke.format=ke.internalformat=Ml[Ft],ke.needsFree=!0,up(ke,da,Ye,st,pt,Bt.offset)}else if(Dc(Bt)||wh(Bt)||eu(Bt))Dc(Bt)||wh(Bt)?ke.element=Bt:ke.element=Bt.canvas,ke.width=ke.element.width,ke.height=ke.element.height,ke.channels=4;else if(Fs(Bt))ke.element=Bt,ke.width=Bt.width,ke.height=Bt.height,ke.channels=4;else if(Nf(Bt))ke.element=Bt,ke.width=Bt.naturalWidth,ke.height=Bt.naturalHeight,ke.channels=4;else if(Uf(Bt))ke.element=Bt,ke.width=Bt.videoWidth,ke.height=Bt.videoHeight,ke.channels=4;else if(Yr(Bt)){var Me=ke.width||Bt[0].length,rt=ke.height||Bt.length,ve=ke.channels;ja(Bt[0][0])?ve=ve||Bt[0][0].length:ve=ve||1;for(var at=Wt.shape(Bt),Gt=1,or=0;or<at.length;++or)Gt*=at[or];var _r=Il(ke,Gt);Wt.flatten(Bt,at,"",_r),lf(ke,_r),ke.alignment=1,ke.width=Me,ke.height=rt,ke.channels=ve,ke.format=ke.internalformat=Ml[ve],ke.needsFree=!0}ke.type===Bu?F(Ze.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):ke.type===wl&&F(Ze.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function pr(ke,Zt,Bt){var ln=ke.element,bi=ke.data,da=ke.internalformat,ue=ke.format,Se=ke.type,ze=ke.width,Lt=ke.height;ui(ke),ln?z.texImage2D(Zt,Bt,ue,ue,Se,ln):ke.compressed?z.compressedTexImage2D(Zt,Bt,da,ze,Lt,0,bi):ke.needsCopy?(Ut(),z.copyTexImage2D(Zt,Bt,ue,ke.xOffset,ke.yOffset,ze,Lt,0)):z.texImage2D(Zt,Bt,ue,ze,Lt,0,ue,Se,bi||null)}function tt(ke,Zt,Bt,ln,bi){var da=ke.element,ue=ke.data,Se=ke.internalformat,ze=ke.format,Lt=ke.type,Ft=ke.width,Ye=ke.height;ui(ke),da?z.texSubImage2D(Zt,bi,Bt,ln,ze,Lt,da):ke.compressed?z.compressedTexSubImage2D(Zt,bi,Bt,ln,Se,Ft,Ye,ue):ke.needsCopy?(Ut(),z.copyTexSubImage2D(Zt,bi,Bt,ln,ke.xOffset,ke.yOffset,Ft,Ye)):z.texSubImage2D(Zt,bi,Bt,ln,Ft,Ye,ze,Lt,ue)}var wi=[];function on(){return wi.pop()||new qr}function yi(ke){ke.needsFree&&et.freeType(ke.data),qr.call(ke),wi.push(ke)}function ai(){xr.call(this),this.genMipmaps=!1,this.mipmapHint=du,this.mipmask=0,this.images=Array(16)}function Yn(ke,Zt,Bt){var ln=ke.images[0]=on();ke.mipmask=1,ln.width=ke.width=Zt,ln.height=ke.height=Bt,ln.channels=ke.channels=4}function Ui(ke,Zt){var Bt=null;if(Yo(Zt))Bt=ke.images[0]=on(),Xr(Bt,ke),gt(Bt,Zt),ke.mipmask=1;else if(Fn(ke,Zt),Array.isArray(Zt.mipmap))for(var ln=Zt.mipmap,bi=0;bi<ln.length;++bi)Bt=ke.images[bi]=on(),Xr(Bt,ke),Bt.width>>=bi,Bt.height>>=bi,gt(Bt,ln[bi]),ke.mipmask|=1<<bi;else Bt=ke.images[0]=on(),Xr(Bt,ke),gt(Bt,Zt),ke.mipmask=1;Xr(ke,ke.images[0]),ke.compressed&&(ke.internalformat===hu||ke.internalformat===Mc||ke.internalformat===rf||ke.internalformat===ec)&&F(ke.width%4===0&&ke.height%4===0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function mo(ke,Zt){for(var Bt=ke.images,ln=0;ln<Bt.length;++ln){if(!Bt[ln])return;pr(Bt[ln],Zt,ln)}}var Wo=[];function Ri(){var ke=Wo.pop()||new ai;xr.call(ke),ke.mipmask=0;for(var Zt=0;Zt<16;++Zt)ke.images[Zt]=null;return ke}function lo(ke){for(var Zt=ke.images,Bt=0;Bt<Zt.length;++Bt)Zt[Bt]&&yi(Zt[Bt]),Zt[Bt]=null;Wo.push(ke)}function Sa(){this.minFilter=kf,this.magFilter=kf,this.wrapS=Df,this.wrapT=Df,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=du}function go(ke,Zt){if("min"in Zt){var Bt=Zt.min;F.parameter(Bt,Br),ke.minFilter=Br[Bt],Lf.indexOf(ke.minFilter)>=0&&!("faces"in Zt)&&(ke.genMipmaps=!0)}if("mag"in Zt){var ln=Zt.mag;F.parameter(ln,Zr),ke.magFilter=Zr[ln]}var bi=ke.wrapS,da=ke.wrapT;if("wrap"in Zt){var ue=Zt.wrap;typeof ue=="string"?(F.parameter(ue,wr),bi=da=wr[ue]):Array.isArray(ue)&&(F.parameter(ue[0],wr),F.parameter(ue[1],wr),bi=wr[ue[0]],da=wr[ue[1]])}else{if("wrapS"in Zt){var Se=Zt.wrapS;F.parameter(Se,wr),bi=wr[Se]}if("wrapT"in Zt){var ze=Zt.wrapT;F.parameter(ze,wr),da=wr[ze]}}if(ke.wrapS=bi,ke.wrapT=da,"anisotropic"in Zt){var Lt=Zt.anisotropic;F(typeof Lt=="number"&&Lt>=1&&Lt<=Ze.maxAnisotropic,"aniso samples must be between 1 and "),ke.anisotropic=Zt.anisotropic}if("mipmap"in Zt){var Ft=!1;switch(typeof Zt.mipmap){case"string":F.parameter(Zt.mipmap,Dr,"invalid mipmap hint"),ke.mipmapHint=Dr[Zt.mipmap],ke.genMipmaps=!0,Ft=!0;break;case"boolean":Ft=ke.genMipmaps=Zt.mipmap;break;case"object":F(Array.isArray(Zt.mipmap),"invalid mipmap type"),ke.genMipmaps=!1,Ft=!0;break;default:F.raise("invalid mipmap type")}Ft&&!("min"in Zt)&&(ke.minFilter=Oc)}}function _o(ke,Zt){z.texParameteri(Zt,ap,ke.minFilter),z.texParameteri(Zt,bh,ke.magFilter),z.texParameteri(Zt,Md,ke.wrapS),z.texParameteri(Zt,Of,ke.wrapT),Ee.ext_texture_filter_anisotropic&&z.texParameteri(Zt,Ca,ke.anisotropic),ke.genMipmaps&&(z.hint(Ff,ke.mipmapHint),z.generateMipmap(Zt))}var Qa=0,Ro={},ps=Ze.maxTextureUnits,Mo=Array(ps).map(function(){return null});function xi(ke){xr.call(this),this.mipmask=0,this.internalformat=ql,this.id=Qa++,this.refCount=1,this.target=ke,this.texture=z.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new Sa,kt.profile&&(this.stats={size:0})}function es(ke){z.activeTexture(Sh),z.bindTexture(ke.target,ke.texture)}function aa(){var ke=Mo[0];ke?z.bindTexture(ke.target,ke.texture):z.bindTexture(xs,null)}function Wn(ke){var Zt=ke.texture;F(Zt,"must not double destroy texture");var Bt=ke.unit,ln=ke.target;Bt>=0&&(z.activeTexture(Sh+Bt),z.bindTexture(ln,null),Mo[Bt]=null),z.deleteTexture(Zt),ke.texture=null,ke.params=null,ke.pixels=null,ke.refCount=0,delete Ro[ke.id],zt.textureCount--}L(xi.prototype,{bind:function(){var ke=this;ke.bindCount+=1;var Zt=ke.unit;if(Zt<0){for(var Bt=0;Bt<ps;++Bt){var ln=Mo[Bt];if(ln){if(ln.bindCount>0)continue;ln.unit=-1}Mo[Bt]=ke,Zt=Bt;break}Zt>=ps&&F.raise("insufficient number of texture units"),kt.profile&&zt.maxTextureUnits<Zt+1&&(zt.maxTextureUnits=Zt+1),ke.unit=Zt,z.activeTexture(Sh+Zt),z.bindTexture(ke.target,ke.texture)}return Zt},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&Wn(this)}});function Mi(ke,Zt){var Bt=new xi(xs);Ro[Bt.id]=Bt,zt.textureCount++;function ln(ue,Se){var ze=Bt.texInfo;Sa.call(ze);var Lt=Ri();return typeof ue=="number"?typeof Se=="number"?Yn(Lt,ue|0,Se|0):Yn(Lt,ue|0,ue|0):ue?(F.type(ue,"object","invalid arguments to regl.texture"),go(ze,ue),Ui(Lt,ue)):Yn(Lt,1,1),ze.genMipmaps&&(Lt.mipmask=(Lt.width<<1)-1),Bt.mipmask=Lt.mipmask,Xr(Bt,Lt),F.texture2D(ze,Lt,Ze),Bt.internalformat=Lt.internalformat,ln.width=Lt.width,ln.height=Lt.height,es(Bt),mo(Lt,xs),_o(ze,xs),aa(),lo(Lt),kt.profile&&(Bt.stats.size=Ct(Bt.internalformat,Bt.type,Lt.width,Lt.height,ze.genMipmaps,!1)),ln.format=kr[Bt.internalformat],ln.type=Jr[Bt.type],ln.mag=gr[ze.magFilter],ln.min=tn[ze.minFilter],ln.wrapS=Ir[ze.wrapS],ln.wrapT=Ir[ze.wrapT],ln}function bi(ue,Se,ze,Lt){F(!!ue,"must specify image data");var Ft=Se|0,Ye=ze|0,st=Lt|0,pt=on();return Xr(pt,Bt),pt.width=0,pt.height=0,gt(pt,ue),pt.width=pt.width||(Bt.width>>st)-Ft,pt.height=pt.height||(Bt.height>>st)-Ye,F(Bt.type===pt.type&&Bt.format===pt.format&&Bt.internalformat===pt.internalformat,"incompatible format for texture.subimage"),F(Ft>=0&&Ye>=0&&Ft+pt.width<=Bt.width&&Ye+pt.height<=Bt.height,"texture.subimage write out of bounds"),F(Bt.mipmask&1<<st,"missing mipmap data"),F(pt.data||pt.element||pt.needsCopy,"missing image data"),es(Bt),tt(pt,xs,Ft,Ye,st),aa(),yi(pt),ln}function da(ue,Se){var ze=ue|0,Lt=Se|0||ze;if(ze===Bt.width&&Lt===Bt.height)return ln;ln.width=Bt.width=ze,ln.height=Bt.height=Lt,es(Bt);for(var Ft=0;Bt.mipmask>>Ft;++Ft){var Ye=ze>>Ft,st=Lt>>Ft;if(!Ye||!st)break;z.texImage2D(xs,Ft,Bt.format,Ye,st,0,Bt.format,Bt.type,null)}return aa(),kt.profile&&(Bt.stats.size=Ct(Bt.internalformat,Bt.type,ze,Lt,!1,!1)),ln}return ln(ke,Zt),ln.subimage=bi,ln.resize=da,ln._reglType="texture2d",ln._texture=Bt,kt.profile&&(ln.stats=Bt.stats),ln.destroy=function(){Bt.decRef()},ln}function Gi(ke,Zt,Bt,ln,bi,da){var ue=new xi(ku);Ro[ue.id]=ue,zt.cubeCount++;var Se=new Array(6);function ze(Ye,st,pt,Me,rt,ve){var at,Gt=ue.texInfo;for(Sa.call(Gt),at=0;at<6;++at)Se[at]=Ri();if(typeof Ye=="number"||!Ye){var or=Ye|0||1;for(at=0;at<6;++at)Yn(Se[at],or,or)}else if(typeof Ye=="object")if(st)Ui(Se[0],Ye),Ui(Se[1],st),Ui(Se[2],pt),Ui(Se[3],Me),Ui(Se[4],rt),Ui(Se[5],ve);else if(go(Gt,Ye),Fn(ue,Ye),"faces"in Ye){var _r=Ye.faces;for(F(Array.isArray(_r)&&_r.length===6,"cube faces must be a length 6 array"),at=0;at<6;++at)F(typeof _r[at]=="object"&&!!_r[at],"invalid input for cube map face"),Xr(Se[at],ue),Ui(Se[at],_r[at])}else for(at=0;at<6;++at)Ui(Se[at],Ye);else F.raise("invalid arguments to cube map");for(Xr(ue,Se[0]),Ze.npotTextureCube||F(ef(ue.width)&&ef(ue.height),"your browser does not support non power or two texture dimensions"),Gt.genMipmaps?ue.mipmask=(Se[0].width<<1)-1:ue.mipmask=Se[0].mipmask,F.textureCube(ue,Gt,Se,Ze),ue.internalformat=Se[0].internalformat,ze.width=Se[0].width,ze.height=Se[0].height,es(ue),at=0;at<6;++at)mo(Se[at],Fu+at);for(_o(Gt,ku),aa(),kt.profile&&(ue.stats.size=Ct(ue.internalformat,ue.type,ze.width,ze.height,Gt.genMipmaps,!0)),ze.format=kr[ue.internalformat],ze.type=Jr[ue.type],ze.mag=gr[Gt.magFilter],ze.min=tn[Gt.minFilter],ze.wrapS=Ir[Gt.wrapS],ze.wrapT=Ir[Gt.wrapT],at=0;at<6;++at)lo(Se[at]);return ze}function Lt(Ye,st,pt,Me,rt){F(!!st,"must specify image data"),F(typeof Ye=="number"&&Ye===(Ye|0)&&Ye>=0&&Ye<6,"invalid face");var ve=pt|0,at=Me|0,Gt=rt|0,or=on();return Xr(or,ue),or.width=0,or.height=0,gt(or,st),or.width=or.width||(ue.width>>Gt)-ve,or.height=or.height||(ue.height>>Gt)-at,F(ue.type===or.type&&ue.format===or.format&&ue.internalformat===or.internalformat,"incompatible format for texture.subimage"),F(ve>=0&&at>=0&&ve+or.width<=ue.width&&at+or.height<=ue.height,"texture.subimage write out of bounds"),F(ue.mipmask&1<<Gt,"missing mipmap data"),F(or.data||or.element||or.needsCopy,"missing image data"),es(ue),tt(or,Fu+Ye,ve,at,Gt),aa(),yi(or),ze}function Ft(Ye){var st=Ye|0;if(st!==ue.width){ze.width=ue.width=st,ze.height=ue.height=st,es(ue);for(var pt=0;pt<6;++pt)for(var Me=0;ue.mipmask>>Me;++Me)z.texImage2D(Fu+pt,Me,ue.format,st>>Me,st>>Me,0,ue.format,ue.type,null);return aa(),kt.profile&&(ue.stats.size=Ct(ue.internalformat,ue.type,ze.width,ze.height,!1,!0)),ze}}return ze(ke,Zt,Bt,ln,bi,da),ze.subimage=Lt,ze.resize=Ft,ze._reglType="textureCube",ze._texture=ue,kt.profile&&(ze.stats=ue.stats),ze.destroy=function(){ue.decRef()},ze}function yo(){for(var ke=0;ke<ps;++ke)z.activeTexture(Sh+ke),z.bindTexture(xs,null),Mo[ke]=null;Qi(Ro).forEach(Wn),zt.cubeCount=0,zt.textureCount=0}kt.profile&&(zt.getTotalTextureSize=function(){var ke=0;return Object.keys(Ro).forEach(function(Zt){ke+=Ro[Zt].stats.size}),ke});function Xu(){for(var ke=0;ke<ps;++ke){var Zt=Mo[ke];Zt&&(Zt.bindCount=0,Zt.unit=-1,Mo[ke]=null)}Qi(Ro).forEach(function(Bt){Bt.texture=z.createTexture(),z.bindTexture(Bt.target,Bt.texture);for(var ln=0;ln<32;++ln)if(Bt.mipmask&1<<ln)if(Bt.target===xs)z.texImage2D(xs,ln,Bt.internalformat,Bt.width>>ln,Bt.height>>ln,0,Bt.internalformat,Bt.type,null);else for(var bi=0;bi<6;++bi)z.texImage2D(Fu+bi,ln,Bt.internalformat,Bt.width>>ln,Bt.height>>ln,0,Bt.internalformat,Bt.type,null);_o(Bt.texInfo,Bt.target)})}return{create2D:Mi,createCube:Gi,clear:yo,getTexture:function(ke){return null},restore:Xu}}var B=36161,Ys=32854,me=32855,Bo=36194,no=33189,vu=36168,bs=34041,Da=35907,nc=34836,On=34842,gn=34843,Bs=[];Bs[Ys]=2,Bs[me]=2,Bs[Bo]=2,Bs[no]=2,Bs[vu]=1,Bs[bs]=4,Bs[Da]=4,Bs[nc]=16,Bs[On]=8,Bs[gn]=6;function qo(z,Ee,Ze){return Bs[z]*Ee*Ze}var mu=function(z,Ee,Ze,Ut,cr){var zt={rgba4:Ys,rgb565:Bo,"rgb5 a1":me,depth:no,stencil:vu,"depth stencil":bs};Ee.ext_srgb&&(zt.srgba=Da),Ee.ext_color_buffer_half_float&&(zt.rgba16f=On,zt.rgb16f=gn),Ee.webgl_color_buffer_float&&(zt.rgba32f=nc);var kt=[];Object.keys(zt).forEach(function(Er){var zr=zt[Er];kt[zr]=Er});var Dr=0,wr={};function Zr(Er){this.id=Dr++,this.refCount=1,this.renderbuffer=Er,this.format=Ys,this.width=0,this.height=0,cr.profile&&(this.stats={size:0})}Zr.prototype.decRef=function(){--this.refCount<=0&&Br(this)};function Br(Er){var zr=Er.renderbuffer;F(zr,"must not double destroy renderbuffer"),z.bindRenderbuffer(B,null),z.deleteRenderbuffer(zr),Er.renderbuffer=null,Er.refCount=0,delete wr[Er.id],Ut.renderbufferCount--}function Ur(Er,zr){var St=new Zr(z.createRenderbuffer());wr[St.id]=St,Ut.renderbufferCount++;function Qt(Jr,gr){var tn=0,Ir=0,en=Ys;if(typeof Jr=="object"&&Jr){var xr=Jr;if("shape"in xr){var Xr=xr.shape;F(Array.isArray(Xr)&&Xr.length>=2,"invalid renderbuffer shape"),tn=Xr[0]|0,Ir=Xr[1]|0}else"radius"in xr&&(tn=Ir=xr.radius|0),"width"in xr&&(tn=xr.width|0),"height"in xr&&(Ir=xr.height|0);"format"in xr&&(F.parameter(xr.format,zt,"invalid renderbuffer format"),en=zt[xr.format])}else typeof Jr=="number"?(tn=Jr|0,typeof gr=="number"?Ir=gr|0:Ir=tn):Jr?F.raise("invalid arguments to renderbuffer constructor"):tn=Ir=1;if(F(tn>0&&Ir>0&&tn<=Ze.maxRenderbufferSize&&Ir<=Ze.maxRenderbufferSize,"invalid renderbuffer size"),!(tn===St.width&&Ir===St.height&&en===St.format))return Qt.width=St.width=tn,Qt.height=St.height=Ir,St.format=en,z.bindRenderbuffer(B,St.renderbuffer),z.renderbufferStorage(B,en,tn,Ir),F(z.getError()===0,"invalid render buffer format"),cr.profile&&(St.stats.size=qo(St.format,St.width,St.height)),Qt.format=kt[St.format],Qt}function kr(Jr,gr){var tn=Jr|0,Ir=gr|0||tn;return tn===St.width&&Ir===St.height||(F(tn>0&&Ir>0&&tn<=Ze.maxRenderbufferSize&&Ir<=Ze.maxRenderbufferSize,"invalid renderbuffer size"),Qt.width=St.width=tn,Qt.height=St.height=Ir,z.bindRenderbuffer(B,St.renderbuffer),z.renderbufferStorage(B,St.format,tn,Ir),F(z.getError()===0,"invalid render buffer format"),cr.profile&&(St.stats.size=qo(St.format,St.width,St.height))),Qt}return Qt(Er,zr),Qt.resize=kr,Qt._reglType="renderbuffer",Qt._renderbuffer=St,cr.profile&&(Qt.stats=St.stats),Qt.destroy=function(){St.decRef()},Qt}cr.profile&&(Ut.getTotalRenderbufferSize=function(){var Er=0;return Object.keys(wr).forEach(function(zr){Er+=wr[zr].stats.size}),Er});function Wr(){Qi(wr).forEach(function(Er){Er.renderbuffer=z.createRenderbuffer(),z.bindRenderbuffer(B,Er.renderbuffer),z.renderbufferStorage(B,Er.format,Er.width,Er.height)}),z.bindRenderbuffer(B,null)}return{create:Ur,clear:function(){Qi(wr).forEach(Br)},restore:Wr}},ka=36160,Ls=36161,qs=3553,kc=34069,ea=36064,To=36096,Ch=36128,Pl=33306,zf=36053,gu=36054,Es=36055,ic=36057,Nu=36061,Zf=36193,Fc=5121,cf=5126,Vf=6407,ac=6408,oc=6402,Uu=[Vf,ac],zu=[];zu[ac]=4,zu[Vf]=3;var tu=[];tu[Fc]=1,tu[cf]=4,tu[Zf]=2;var jf=32854,Ol=32855,ru=36194,Dl=33189,ff=36168,Rh=34041,Hf=35907,h=34836,d=34842,p=34843,g=[jf,Ol,ru,Hf,d,p,h],S={};S[zf]="complete",S[gu]="incomplete attachment",S[ic]="incomplete dimensions",S[Es]="incomplete, missing attachment",S[Nu]="unsupported";function w(z,Ee,Ze,Ut,cr,zt){var kt={cur:null,next:null,dirty:!1,setFBO:null},Dr=["rgba"],wr=["rgba4","rgb565","rgb5 a1"];Ee.ext_srgb&&wr.push("srgba"),Ee.ext_color_buffer_half_float&&wr.push("rgba16f","rgb16f"),Ee.webgl_color_buffer_float&&wr.push("rgba32f");var Zr=["uint8"];Ee.oes_texture_half_float&&Zr.push("half float","float16"),Ee.oes_texture_float&&Zr.push("float","float32");function Br(qr,gt,pr){this.target=qr,this.texture=gt,this.renderbuffer=pr;var tt=0,wi=0;gt?(tt=gt.width,wi=gt.height):pr&&(tt=pr.width,wi=pr.height),this.width=tt,this.height=wi}function Ur(qr){qr&&(qr.texture&&qr.texture._texture.decRef(),qr.renderbuffer&&qr.renderbuffer._renderbuffer.decRef())}function Wr(qr,gt,pr){if(qr)if(qr.texture){var tt=qr.texture._texture,wi=Math.max(1,tt.width),on=Math.max(1,tt.height);F(wi===gt&&on===pr,"inconsistent width/height for supplied texture"),tt.refCount+=1}else{var yi=qr.renderbuffer._renderbuffer;F(yi.width===gt&&yi.height===pr,"inconsistent width/height for renderbuffer"),yi.refCount+=1}}function Er(qr,gt){gt&&(gt.texture?z.framebufferTexture2D(ka,qr,gt.target,gt.texture._texture.texture,0):z.framebufferRenderbuffer(ka,qr,Ls,gt.renderbuffer._renderbuffer.renderbuffer))}function zr(qr){var gt=qs,pr=null,tt=null,wi=qr;typeof qr=="object"&&(wi=qr.data,"target"in qr&&(gt=qr.target|0)),F.type(wi,"function","invalid attachment data");var on=wi._reglType;return on==="texture2d"?(pr=wi,F(gt===qs)):on==="textureCube"?(pr=wi,F(gt>=kc&&gt<kc+6,"invalid cube map target")):on==="renderbuffer"?(tt=wi,gt=Ls):F.raise("invalid regl object for attachment"),new Br(gt,pr,tt)}function St(qr,gt,pr,tt,wi){if(pr){var on=Ut.create2D({width:qr,height:gt,format:tt,type:wi});return on._texture.refCount=0,new Br(qs,on,null)}else{var yi=cr.create({width:qr,height:gt,format:tt});return yi._renderbuffer.refCount=0,new Br(Ls,null,yi)}}function Qt(qr){return qr&&(qr.texture||qr.renderbuffer)}function kr(qr,gt,pr){qr&&(qr.texture?qr.texture.resize(gt,pr):qr.renderbuffer&&qr.renderbuffer.resize(gt,pr),qr.width=gt,qr.height=pr)}var Jr=0,gr={};function tn(){this.id=Jr++,gr[this.id]=this,this.framebuffer=z.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function Ir(qr){qr.colorAttachments.forEach(Ur),Ur(qr.depthAttachment),Ur(qr.stencilAttachment),Ur(qr.depthStencilAttachment)}function en(qr){var gt=qr.framebuffer;F(gt,"must not double destroy framebuffer"),z.deleteFramebuffer(gt),qr.framebuffer=null,zt.framebufferCount--,delete gr[qr.id]}function xr(qr){var gt;z.bindFramebuffer(ka,qr.framebuffer);var pr=qr.colorAttachments;for(gt=0;gt<pr.length;++gt)Er(ea+gt,pr[gt]);for(gt=pr.length;gt<Ze.maxColorAttachments;++gt)z.framebufferTexture2D(ka,ea+gt,qs,null,0);z.framebufferTexture2D(ka,Pl,qs,null,0),z.framebufferTexture2D(ka,To,qs,null,0),z.framebufferTexture2D(ka,Ch,qs,null,0),Er(To,qr.depthAttachment),Er(Ch,qr.stencilAttachment),Er(Pl,qr.depthStencilAttachment);var tt=z.checkFramebufferStatus(ka);!z.isContextLost()&&tt!==zf&&F.raise("framebuffer configuration not supported, status = "+S[tt]),z.bindFramebuffer(ka,kt.next?kt.next.framebuffer:null),kt.cur=kt.next,z.getError()}function Xr(qr,gt){var pr=new tn;zt.framebufferCount++;function tt(on,yi){var ai;F(kt.next!==pr,"can not update framebuffer which is currently in use");var Yn=0,Ui=0,mo=!0,Wo=!0,Ri=null,lo=!0,Sa="rgba",go="uint8",_o=1,Qa=null,Ro=null,ps=null,Mo=!1;if(typeof on=="number")Yn=on|0,Ui=yi|0||Yn;else if(!on)Yn=Ui=1;else{F.type(on,"object","invalid arguments for framebuffer");var xi=on;if("shape"in xi){var es=xi.shape;F(Array.isArray(es)&&es.length>=2,"invalid shape for framebuffer"),Yn=es[0],Ui=es[1]}else"radius"in xi&&(Yn=Ui=xi.radius),"width"in xi&&(Yn=xi.width),"height"in xi&&(Ui=xi.height);("color"in xi||"colors"in xi)&&(Ri=xi.color||xi.colors,Array.isArray(Ri)&&F(Ri.length===1||Ee.webgl_draw_buffers,"multiple render targets not supported")),Ri||("colorCount"in xi&&(_o=xi.colorCount|0,F(_o>0,"invalid color buffer count")),"colorTexture"in xi&&(lo=!!xi.colorTexture,Sa="rgba4"),"colorType"in xi&&(go=xi.colorType,lo?(F(Ee.oes_texture_float||!(go==="float"||go==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),F(Ee.oes_texture_half_float||!(go==="half float"||go==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):go==="half float"||go==="float16"?(F(Ee.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),Sa="rgba16f"):(go==="float"||go==="float32")&&(F(Ee.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),Sa="rgba32f"),F.oneOf(go,Zr,"invalid color type")),"colorFormat"in xi&&(Sa=xi.colorFormat,Dr.indexOf(Sa)>=0?lo=!0:wr.indexOf(Sa)>=0?lo=!1:lo?F.oneOf(xi.colorFormat,Dr,"invalid color format for texture"):F.oneOf(xi.colorFormat,wr,"invalid color format for renderbuffer"))),("depthTexture"in xi||"depthStencilTexture"in xi)&&(Mo=!!(xi.depthTexture||xi.depthStencilTexture),F(!Mo||Ee.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in xi&&(typeof xi.depth=="boolean"?mo=xi.depth:(Qa=xi.depth,Wo=!1)),"stencil"in xi&&(typeof xi.stencil=="boolean"?Wo=xi.stencil:(Ro=xi.stencil,mo=!1)),"depthStencil"in xi&&(typeof xi.depthStencil=="boolean"?mo=Wo=xi.depthStencil:(ps=xi.depthStencil,mo=!1,Wo=!1))}var aa=null,Wn=null,Mi=null,Gi=null;if(Array.isArray(Ri))aa=Ri.map(zr);else if(Ri)aa=[zr(Ri)];else for(aa=new Array(_o),ai=0;ai<_o;++ai)aa[ai]=St(Yn,Ui,lo,Sa,go);F(Ee.webgl_draw_buffers||aa.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),F(aa.length<=Ze.maxColorAttachments,"too many color attachments, not supported"),Yn=Yn||aa[0].width,Ui=Ui||aa[0].height,Qa?Wn=zr(Qa):mo&&!Wo&&(Wn=St(Yn,Ui,Mo,"depth","uint32")),Ro?Mi=zr(Ro):Wo&&!mo&&(Mi=St(Yn,Ui,!1,"stencil","uint8")),ps?Gi=zr(ps):!Qa&&!Ro&&Wo&&mo&&(Gi=St(Yn,Ui,Mo,"depth stencil","depth stencil")),F(!!Qa+!!Ro+!!ps<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var yo=null;for(ai=0;ai<aa.length;++ai)if(Wr(aa[ai],Yn,Ui),F(!aa[ai]||aa[ai].texture&&Uu.indexOf(aa[ai].texture._texture.format)>=0||aa[ai].renderbuffer&&g.indexOf(aa[ai].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+ai+" is invalid"),aa[ai]&&aa[ai].texture){var Xu=zu[aa[ai].texture._texture.format]*tu[aa[ai].texture._texture.type];yo===null?yo=Xu:F(yo===Xu,"all color attachments much have the same number of bits per pixel.")}return Wr(Wn,Yn,Ui),F(!Wn||Wn.texture&&Wn.texture._texture.format===oc||Wn.renderbuffer&&Wn.renderbuffer._renderbuffer.format===Dl,"invalid depth attachment for framebuffer object"),Wr(Mi,Yn,Ui),F(!Mi||Mi.renderbuffer&&Mi.renderbuffer._renderbuffer.format===ff,"invalid stencil attachment for framebuffer object"),Wr(Gi,Yn,Ui),F(!Gi||Gi.texture&&Gi.texture._texture.format===Rh||Gi.renderbuffer&&Gi.renderbuffer._renderbuffer.format===Rh,"invalid depth-stencil attachment for framebuffer object"),Ir(pr),pr.width=Yn,pr.height=Ui,pr.colorAttachments=aa,pr.depthAttachment=Wn,pr.stencilAttachment=Mi,pr.depthStencilAttachment=Gi,tt.color=aa.map(Qt),tt.depth=Qt(Wn),tt.stencil=Qt(Mi),tt.depthStencil=Qt(Gi),tt.width=pr.width,tt.height=pr.height,xr(pr),tt}function wi(on,yi){F(kt.next!==pr,"can not resize a framebuffer which is currently in use");var ai=Math.max(on|0,1),Yn=Math.max(yi|0||ai,1);if(ai===pr.width&&Yn===pr.height)return tt;for(var Ui=pr.colorAttachments,mo=0;mo<Ui.length;++mo)kr(Ui[mo],ai,Yn);return kr(pr.depthAttachment,ai,Yn),kr(pr.stencilAttachment,ai,Yn),kr(pr.depthStencilAttachment,ai,Yn),pr.width=tt.width=ai,pr.height=tt.height=Yn,xr(pr),tt}return tt(qr,gt),L(tt,{resize:wi,_reglType:"framebuffer",_framebuffer:pr,destroy:function(){en(pr),Ir(pr)},use:function(on){kt.setFBO({framebuffer:tt},on)}})}function Fn(qr){var gt=Array(6);function pr(wi){var on;F(gt.indexOf(kt.next)<0,"can not update framebuffer which is currently in use");var yi={color:null},ai=0,Yn=null,Ui="rgba",mo="uint8",Wo=1;if(typeof wi=="number")ai=wi|0;else if(!wi)ai=1;else{F.type(wi,"object","invalid arguments for framebuffer");var Ri=wi;if("shape"in Ri){var lo=Ri.shape;F(Array.isArray(lo)&&lo.length>=2,"invalid shape for framebuffer"),F(lo[0]===lo[1],"cube framebuffer must be square"),ai=lo[0]}else"radius"in Ri&&(ai=Ri.radius|0),"width"in Ri?(ai=Ri.width|0,"height"in Ri&&F(Ri.height===ai,"must be square")):"height"in Ri&&(ai=Ri.height|0);("color"in Ri||"colors"in Ri)&&(Yn=Ri.color||Ri.colors,Array.isArray(Yn)&&F(Yn.length===1||Ee.webgl_draw_buffers,"multiple render targets not supported")),Yn||("colorCount"in Ri&&(Wo=Ri.colorCount|0,F(Wo>0,"invalid color buffer count")),"colorType"in Ri&&(F.oneOf(Ri.colorType,Zr,"invalid color type"),mo=Ri.colorType),"colorFormat"in Ri&&(Ui=Ri.colorFormat,F.oneOf(Ri.colorFormat,Dr,"invalid color format for texture"))),"depth"in Ri&&(yi.depth=Ri.depth),"stencil"in Ri&&(yi.stencil=Ri.stencil),"depthStencil"in Ri&&(yi.depthStencil=Ri.depthStencil)}var Sa;if(Yn)if(Array.isArray(Yn))for(Sa=[],on=0;on<Yn.length;++on)Sa[on]=Yn[on];else Sa=[Yn];else{Sa=Array(Wo);var go={radius:ai,format:Ui,type:mo};for(on=0;on<Wo;++on)Sa[on]=Ut.createCube(go)}for(yi.color=Array(Sa.length),on=0;on<Sa.length;++on){var _o=Sa[on];F(typeof _o=="function"&&_o._reglType==="textureCube","invalid cube map"),ai=ai||_o.width,F(_o.width===ai&&_o.height===ai,"invalid cube map shape"),yi.color[on]={target:kc,data:Sa[on]}}for(on=0;on<6;++on){for(var Qa=0;Qa<Sa.length;++Qa)yi.color[Qa].target=kc+on;on>0&&(yi.depth=gt[0].depth,yi.stencil=gt[0].stencil,yi.depthStencil=gt[0].depthStencil),gt[on]?gt[on](yi):gt[on]=Xr(yi)}return L(pr,{width:ai,height:ai,color:Sa})}function tt(wi){var on,yi=wi|0;if(F(yi>0&&yi<=Ze.maxCubeMapSize,"invalid radius for cube fbo"),yi===pr.width)return pr;var ai=pr.color;for(on=0;on<ai.length;++on)ai[on].resize(yi);for(on=0;on<6;++on)gt[on].resize(yi);return pr.width=pr.height=yi,pr}return pr(qr),L(pr,{faces:gt,resize:tt,_reglType:"framebufferCube",destroy:function(){gt.forEach(function(wi){wi.destroy()})}})}function ui(){kt.cur=null,kt.next=null,kt.dirty=!0,Qi(gr).forEach(function(qr){qr.framebuffer=z.createFramebuffer(),xr(qr)})}return L(kt,{getFramebuffer:function(qr){if(typeof qr=="function"&&qr._reglType==="framebuffer"){var gt=qr._framebuffer;if(gt instanceof tn)return gt}return null},create:Xr,createCube:Fn,clear:function(){Qi(gr).forEach(en)},restore:ui})}var C=5126,P=34962;function Z(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=C,this.offset=0,this.stride=0,this.divisor=0}function Y(z,Ee,Ze,Ut,cr){for(var zt=Ze.maxAttributes,kt=new Array(zt),Dr=0;Dr<zt;++Dr)kt[Dr]=new Z;var wr=0,Zr={},Br={Record:Z,scope:{},state:kt,currentVAO:null,targetVAO:null,restore:Wr()?gr:function(){},createVAO:tn,getVAO:zr,destroyBuffer:Ur,setVAO:Wr()?St:Qt,clear:Wr()?kr:function(){}};function Ur(Ir){for(var en=0;en<kt.length;++en){var xr=kt[en];xr.buffer===Ir&&(z.disableVertexAttribArray(en),xr.buffer=null)}}function Wr(){return Ee.oes_vertex_array_object}function Er(){return Ee.angle_instanced_arrays}function zr(Ir){return typeof Ir=="function"&&Ir._vao?Ir._vao:null}function St(Ir){if(Ir!==Br.currentVAO){var en=Wr();Ir?en.bindVertexArrayOES(Ir.vao):en.bindVertexArrayOES(null),Br.currentVAO=Ir}}function Qt(Ir){if(Ir!==Br.currentVAO){if(Ir)Ir.bindAttrs();else for(var en=Er(),xr=0;xr<kt.length;++xr){var Xr=kt[xr];Xr.buffer?(z.enableVertexAttribArray(xr),z.vertexAttribPointer(xr,Xr.size,Xr.type,Xr.normalized,Xr.stride,Xr.offfset),en&&en.vertexAttribDivisorANGLE(xr,Xr.divisor)):(z.disableVertexAttribArray(xr),z.vertexAttrib4f(xr,Xr.x,Xr.y,Xr.z,Xr.w))}Br.currentVAO=Ir}}function kr(){Qi(Zr).forEach(function(Ir){Ir.destroy()})}function Jr(){this.id=++wr,this.attributes=[];var Ir=Wr();Ir?this.vao=Ir.createVertexArrayOES():this.vao=null,Zr[this.id]=this,this.buffers=[]}Jr.prototype.bindAttrs=function(){for(var Ir=Er(),en=this.attributes,xr=0;xr<en.length;++xr){var Xr=en[xr];Xr.buffer?(z.enableVertexAttribArray(xr),z.bindBuffer(P,Xr.buffer.buffer),z.vertexAttribPointer(xr,Xr.size,Xr.type,Xr.normalized,Xr.stride,Xr.offset),Ir&&Ir.vertexAttribDivisorANGLE(xr,Xr.divisor)):(z.disableVertexAttribArray(xr),z.vertexAttrib4f(xr,Xr.x,Xr.y,Xr.z,Xr.w))}for(var Fn=en.length;Fn<zt;++Fn)z.disableVertexAttribArray(Fn)},Jr.prototype.refresh=function(){var Ir=Wr();Ir&&(Ir.bindVertexArrayOES(this.vao),this.bindAttrs(),Br.currentVAO=this)},Jr.prototype.destroy=function(){if(this.vao){var Ir=Wr();this===Br.currentVAO&&(Br.currentVAO=null,Ir.bindVertexArrayOES(null)),Ir.deleteVertexArrayOES(this.vao),this.vao=null}Zr[this.id]&&(delete Zr[this.id],Ut.vaoCount-=1)};function gr(){var Ir=Wr();Ir&&Qi(Zr).forEach(function(en){en.refresh()})}function tn(Ir){var en=new Jr;Ut.vaoCount+=1;function xr(Xr){F(Array.isArray(Xr),"arguments to vertex array constructor must be an array"),F(Xr.length<zt,"too many attributes"),F(Xr.length>0,"must specify at least one attribute");for(var Fn=0;Fn<en.buffers.length;++Fn)en.buffers[Fn].destroy();en.buffers.length=0;var ui=en.attributes;ui.length=Xr.length;for(var qr=0;qr<Xr.length;++qr){var gt=Xr[qr],pr=ui[qr]=new Z;if(Array.isArray(gt)||J(gt)||Ea(gt)){var tt=cr.create(gt,P,!1,!0);pr.buffer=cr.getBuffer(tt),pr.size=pr.buffer.dimension|0,pr.normalized=!1,pr.type=pr.buffer.dtype,pr.offset=0,pr.stride=0,pr.divisor=0,pr.state=1,en.buffers.push(tt)}else cr.getBuffer(gt)?(pr.buffer=cr.getBuffer(gt),pr.size=pr.buffer.dimension|0,pr.normalized=!1,pr.type=pr.buffer.dtype,pr.offset=0,pr.stride=0,pr.divisor=0,pr.state=1):cr.getBuffer(gt.buffer)?(pr.buffer=cr.getBuffer(gt.buffer),pr.size=(+gt.size||pr.buffer.dimension)|0,pr.normalized=!!gt.normalized||!1,"type"in gt?(F.parameter(gt.type,jo,"invalid buffer type"),pr.type=jo[gt.type]):pr.type=pr.buffer.dtype,pr.offset=(gt.offset||0)|0,pr.stride=(gt.stride||0)|0,pr.divisor=(gt.divisor||0)|0,pr.state=1,F(pr.size>=1&&pr.size<=4,"size must be between 1 and 4"),F(pr.offset>=0,"invalid offset"),F(pr.stride>=0&&pr.stride<=255,"stride must be between 0 and 255"),F(pr.divisor>=0,"divisor must be positive"),F(!pr.divisor||!!Ee.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in gt?(F(qr>0,"first attribute must not be a constant"),pr.x=+gt.x||0,pr.y=+gt.y||0,pr.z=+gt.z||0,pr.w=+gt.w||0,pr.state=2):F(!1,"invalid attribute spec for location "+qr)}return en.refresh(),xr}return xr.destroy=function(){en.destroy()},xr._vao=en,xr._reglType="vao",xr(Ir)}return Br}var ce=35632,ge=35633,_e=35718,Fe=35721;function Pe(z,Ee,Ze,Ut){var cr={},zt={};function kt(St,Qt,kr,Jr){this.name=St,this.id=Qt,this.location=kr,this.info=Jr}function Dr(St,Qt){for(var kr=0;kr<St.length;++kr)if(St[kr].id===Qt.id){St[kr].location=Qt.location;return}St.push(Qt)}function wr(St,Qt,kr){var Jr=St===ce?cr:zt,gr=Jr[Qt];if(!gr){var tn=Ee.str(Qt);gr=z.createShader(St),z.shaderSource(gr,tn),z.compileShader(gr),F.shaderError(z,gr,tn,St,kr),Jr[Qt]=gr}return gr}var Zr={},Br=[],Ur=0;function Wr(St,Qt){this.id=Ur++,this.fragId=St,this.vertId=Qt,this.program=null,this.uniforms=[],this.attributes=[],Ut.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function Er(St,Qt,kr){var Jr,gr,tn=wr(ce,St.fragId),Ir=wr(ge,St.vertId),en=St.program=z.createProgram();if(z.attachShader(en,tn),z.attachShader(en,Ir),kr)for(Jr=0;Jr<kr.length;++Jr){var xr=kr[Jr];z.bindAttribLocation(en,xr[0],xr[1])}z.linkProgram(en),F.linkError(z,en,Ee.str(St.fragId),Ee.str(St.vertId),Qt);var Xr=z.getProgramParameter(en,_e);Ut.profile&&(St.stats.uniformsCount=Xr);var Fn=St.uniforms;for(Jr=0;Jr<Xr;++Jr)if(gr=z.getActiveUniform(en,Jr),gr)if(gr.size>1)for(var ui=0;ui<gr.size;++ui){var qr=gr.name.replace("[0]","["+ui+"]");Dr(Fn,new kt(qr,Ee.id(qr),z.getUniformLocation(en,qr),gr))}else Dr(Fn,new kt(gr.name,Ee.id(gr.name),z.getUniformLocation(en,gr.name),gr));var gt=z.getProgramParameter(en,Fe);Ut.profile&&(St.stats.attributesCount=gt);var pr=St.attributes;for(Jr=0;Jr<gt;++Jr)gr=z.getActiveAttrib(en,Jr),gr&&Dr(pr,new kt(gr.name,Ee.id(gr.name),z.getAttribLocation(en,gr.name),gr))}Ut.profile&&(Ze.getMaxUniformsCount=function(){var St=0;return Br.forEach(function(Qt){Qt.stats.uniformsCount>St&&(St=Qt.stats.uniformsCount)}),St},Ze.getMaxAttributesCount=function(){var St=0;return Br.forEach(function(Qt){Qt.stats.attributesCount>St&&(St=Qt.stats.attributesCount)}),St});function zr(){cr={},zt={};for(var St=0;St<Br.length;++St)Er(Br[St],null,Br[St].attributes.map(function(Qt){return[Qt.location,Qt.name]}))}return{clear:function(){var St=z.deleteShader.bind(z);Qi(cr).forEach(St),cr={},Qi(zt).forEach(St),zt={},Br.forEach(function(Qt){z.deleteProgram(Qt.program)}),Br.length=0,Zr={},Ze.shaderCount=0},program:function(St,Qt,kr,Jr){F.command(St>=0,"missing vertex shader",kr),F.command(Qt>=0,"missing fragment shader",kr);var gr=Zr[Qt];gr||(gr=Zr[Qt]={});var tn=gr[St];if(tn&&!Jr)return tn;var Ir=new Wr(Qt,St);return Ze.shaderCount++,Er(Ir,kr,Jr),tn||(gr[St]=Ir),Br.push(Ir),Ir},restore:zr,shader:wr,frag:-1,vert:-1}}var Xe=6408,we=5121,Ge=3333,ct=5126;function At(z,Ee,Ze,Ut,cr,zt,kt){function Dr(Br){var Ur;Ee.next===null?(F(cr.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),Ur=we):(F(Ee.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),Ur=Ee.next.colorAttachments[0].texture._texture.type,zt.oes_texture_float?(F(Ur===we||Ur===ct,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),Ur===ct&&F(kt.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):F(Ur===we,"Reading from a framebuffer is only allowed for the type 'uint8'"));var Wr=0,Er=0,zr=Ut.framebufferWidth,St=Ut.framebufferHeight,Qt=null;J(Br)?Qt=Br:Br&&(F.type(Br,"object","invalid arguments to regl.read()"),Wr=Br.x|0,Er=Br.y|0,F(Wr>=0&&Wr<Ut.framebufferWidth,"invalid x offset for regl.read"),F(Er>=0&&Er<Ut.framebufferHeight,"invalid y offset for regl.read"),zr=(Br.width||Ut.framebufferWidth-Wr)|0,St=(Br.height||Ut.framebufferHeight-Er)|0,Qt=Br.data||null),Qt&&(Ur===we?F(Qt instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):Ur===ct&&F(Qt instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),F(zr>0&&zr+Wr<=Ut.framebufferWidth,"invalid width for read pixels"),F(St>0&&St+Er<=Ut.framebufferHeight,"invalid height for read pixels"),Ze();var kr=zr*St*4;return Qt||(Ur===we?Qt=new Uint8Array(kr):Ur===ct&&(Qt=Qt||new Float32Array(kr))),F.isTypedArray(Qt,"data buffer for regl.read() must be a typedarray"),F(Qt.byteLength>=kr,"data buffer for regl.read() too small"),z.pixelStorei(Ge,4),z.readPixels(Wr,Er,zr,St,Xe,Ur,Qt),Qt}function wr(Br){var Ur;return Ee.setFBO({framebuffer:Br.framebuffer},function(){Ur=Dr(Br)}),Ur}function Zr(Br){return!Br||!("framebuffer"in Br)?Dr(Br):wr(Br)}return Zr}function $t(z){return Array.prototype.slice.call(z)}function Nt(z){return $t(z).join("")}function tr(){var z=0,Ee=[],Ze=[];function Ut(Ur){for(var Wr=0;Wr<Ze.length;++Wr)if(Ze[Wr]===Ur)return Ee[Wr];var Er="g"+z++;return Ee.push(Er),Ze.push(Ur),Er}function cr(){var Ur=[];function Wr(){Ur.push.apply(Ur,$t(arguments))}var Er=[];function zr(){var St="v"+z++;return Er.push(St),arguments.length>0&&(Ur.push(St,"="),Ur.push.apply(Ur,$t(arguments)),Ur.push(";")),St}return L(Wr,{def:zr,toString:function(){return Nt([Er.length>0?"var "+Er.join(",")+";":"",Nt(Ur)])}})}function zt(){var Ur=cr(),Wr=cr(),Er=Ur.toString,zr=Wr.toString;function St(Qt,kr){Wr(Qt,kr,"=",Ur.def(Qt,kr),";")}return L(function(){Ur.apply(Ur,$t(arguments))},{def:Ur.def,entry:Ur,exit:Wr,save:St,set:function(Qt,kr,Jr){St(Qt,kr),Ur(Qt,kr,"=",Jr,";")},toString:function(){return Er()+zr()}})}function kt(){var Ur=Nt(arguments),Wr=zt(),Er=zt(),zr=Wr.toString,St=Er.toString;return L(Wr,{then:function(){return Wr.apply(Wr,$t(arguments)),this},else:function(){return Er.apply(Er,$t(arguments)),this},toString:function(){var Qt=St();return Qt&&(Qt="else{"+Qt+"}"),Nt(["if(",Ur,"){",zr(),"}",Qt])}})}var Dr=cr(),wr={};function Zr(Ur,Wr){var Er=[];function zr(){var gr="a"+Er.length;return Er.push(gr),gr}Wr=Wr||0;for(var St=0;St<Wr;++St)zr();var Qt=zt(),kr=Qt.toString,Jr=wr[Ur]=L(Qt,{arg:zr,toString:function(){return Nt(["function(",Er.join(),"){",kr(),"}"])}});return Jr}function Br(){var Ur=['"use strict";',Dr,"return {"];Object.keys(wr).forEach(function(zr){Ur.push('"',zr,'":',wr[zr].toString(),",")}),Ur.push("}");var Wr=Nt(Ur).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),Er=Function.apply(null,Ee.concat(Wr));return Er.apply(null,Ze)}return{global:Dr,link:Ut,block:cr,proc:Zr,scope:zt,cond:kt,compile:Br}}var mr="xyzw".split(""),Nr=5121,Fr=1,an=2,In=0,Nn=1,Un=2,ji=3,hn=4,Kn="dither",_i="blend.enable",ti="blend.color",Xn="blend.equation",pi="blend.func",qn="depth.enable",$n="depth.func",wo="depth.range",Na="depth.mask",Co="colorMask",Lo="cull.enable",Wa="cull.face",Ga="frontFace",Ss="lineWidth",ls="polygonOffset.enable",Zu="polygonOffset.offset",cs="sample.alpha",nu="sample.enable",Ns="sample.coverage",sl="stencil.enable",kl="stencil.mask",ul="stencil.func",Fl="stencil.opFront",Vu="stencil.opBack",iu="scissor.enable",ju="scissor.box",Ko="viewport",Ka="profile",As="framebuffer",au="vert",Hu="frag",Ni="elements",po="primitive",io="count",ou="offset",Bc="instances",Bl="vao",fs="Width",Or="Height",Wu=As+fs,Gu=As+Or,ao=Ko+fs,Ll=Ko+Or,_u="drawingBuffer",Qo=_u+fs,sc=_u+Or,hf=[pi,Xn,ul,Fl,Vu,Ns,Ko,ju,Zu],Lc=34962,Km=34963,Bv=35632,jp=35633,pf=3553,Id=34067,lp=2884,Pd=3042,Nc=3024,Mh=2960,Od=2929,Qm=3089,Hp=32823,Dd=32926,Jm=32928,kd=5126,Uc=35664,Wf=35665,cp=35666,df=5124,fp=35667,oo=35668,uc=35669,hp=35670,vf=35671,mf=35672,zc=35673,Ih=35674,gf=35675,ll=35676,Zc=35678,_f=35680,cl=4,lc=1028,yf=1029,pp=2304,Ph=2305,Wp=32775,xf=32776,fl=519,Nl=7680,Fd=0,Oh=1,Gp=32774,dp=513,cc=36160,Bd=36064,hl={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},pl=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],bf={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},fc={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Xp={frag:Bv,vert:jp},Ul={cw:pp,ccw:Ph};function Gf(z){return Array.isArray(z)||J(z)||Ea(z)}function vp(z){return z.sort(function(Ee,Ze){return Ee===Ko?-1:Ze===Ko?1:Ee<Ze?-1:1})}function Ts(z,Ee,Ze,Ut){this.thisDep=z,this.contextDep=Ee,this.propDep=Ze,this.append=Ut}function hs(z){return z&&!(z.thisDep||z.contextDep||z.propDep)}function vo(z){return new Ts(!1,!1,!1,z)}function Us(z,Ee){var Ze=z.type;if(Ze===In){var Ut=z.data.length;return new Ts(!0,Ut>=1,Ut>=2,Ee)}else if(Ze===hn){var cr=z.data;return new Ts(cr.thisDep,cr.contextDep,cr.propDep,Ee)}else return new Ts(Ze===ji,Ze===Un,Ze===Nn,Ee)}var $p=new Ts(!1,!1,!1,function(){});function Xf(z,Ee,Ze,Ut,cr,zt,kt,Dr,wr,Zr,Br,Ur,Wr,Er,zr){var St=Zr.Record,Qt={add:32774,subtract:32778,"reverse subtract":32779};Ze.ext_blend_minmax&&(Qt.min=Wp,Qt.max=xf);var kr=Ze.angle_instanced_arrays,Jr=Ze.webgl_draw_buffers,gr={dirty:!0,profile:zr.profile},tn={},Ir=[],en={},xr={};function Xr(ue){return ue.replace(".","_")}function Fn(ue,Se,ze){var Lt=Xr(ue);Ir.push(ue),tn[Lt]=gr[Lt]=!!ze,en[Lt]=Se}function ui(ue,Se,ze){var Lt=Xr(ue);Ir.push(ue),Array.isArray(ze)?(gr[Lt]=ze.slice(),tn[Lt]=ze.slice()):gr[Lt]=tn[Lt]=ze,xr[Lt]=Se}Fn(Kn,Nc),Fn(_i,Pd),ui(ti,"blendColor",[0,0,0,0]),ui(Xn,"blendEquationSeparate",[Gp,Gp]),ui(pi,"blendFuncSeparate",[Oh,Fd,Oh,Fd]),Fn(qn,Od,!0),ui($n,"depthFunc",dp),ui(wo,"depthRange",[0,1]),ui(Na,"depthMask",!0),ui(Co,Co,[!0,!0,!0,!0]),Fn(Lo,lp),ui(Wa,"cullFace",yf),ui(Ga,Ga,Ph),ui(Ss,Ss,1),Fn(ls,Hp),ui(Zu,"polygonOffset",[0,0]),Fn(cs,Dd),Fn(nu,Jm),ui(Ns,"sampleCoverage",[1,!1]),Fn(sl,Mh),ui(kl,"stencilMask",-1),ui(ul,"stencilFunc",[fl,0,-1]),ui(Fl,"stencilOpSeparate",[lc,Nl,Nl,Nl]),ui(Vu,"stencilOpSeparate",[yf,Nl,Nl,Nl]),Fn(iu,Qm),ui(ju,"scissor",[0,0,z.drawingBufferWidth,z.drawingBufferHeight]),ui(Ko,Ko,[0,0,z.drawingBufferWidth,z.drawingBufferHeight]);var qr={gl:z,context:Wr,strings:Ee,next:tn,current:gr,draw:Ur,elements:zt,buffer:cr,shader:Br,attributes:Zr.state,vao:Zr,uniforms:wr,framebuffer:Dr,extensions:Ze,timer:Er,isBufferArgs:Gf},gt={primTypes:Pu,compareFuncs:bf,blendFuncs:hl,blendEquations:Qt,stencilOps:fc,glTypes:jo,orientationType:Ul};F.optional(function(){qr.isArrayLike=ja}),Jr&&(gt.backBuffer=[yf],gt.drawBuffer=di(Ut.maxDrawbuffers,function(ue){return ue===0?[0]:di(ue,function(Se){return Bd+Se})}));var pr=0;function tt(){var ue=tr(),Se=ue.link,ze=ue.global;ue.id=pr++,ue.batchId="0";var Lt=Se(qr),Ft=ue.shared={props:"a0"};Object.keys(qr).forEach(function(rt){Ft[rt]=ze.def(Lt,".",rt)}),F.optional(function(){ue.CHECK=Se(F),ue.commandStr=F.guessCommand(),ue.command=Se(ue.commandStr),ue.assert=function(rt,ve,at){rt("if(!(",ve,"))",this.CHECK,".commandRaise(",Se(at),",",this.command,");")},gt.invalidBlendCombinations=pl});var Ye=ue.next={},st=ue.current={};Object.keys(xr).forEach(function(rt){Array.isArray(gr[rt])&&(Ye[rt]=ze.def(Ft.next,".",rt),st[rt]=ze.def(Ft.current,".",rt))});var pt=ue.constants={};Object.keys(gt).forEach(function(rt){pt[rt]=ze.def(JSON.stringify(gt[rt]))}),ue.invoke=function(rt,ve){switch(ve.type){case In:var at=["this",Ft.context,Ft.props,ue.batchId];return rt.def(Se(ve.data),".call(",at.slice(0,Math.max(ve.data.length+1,4)),")");case Nn:return rt.def(Ft.props,ve.data);case Un:return rt.def(Ft.context,ve.data);case ji:return rt.def("this",ve.data);case hn:return ve.data.append(ue,rt),ve.data.ref}},ue.attribCache={};var Me={};return ue.scopeAttrib=function(rt){var ve=Ee.id(rt);if(ve in Me)return Me[ve];var at=Zr.scope[ve];at||(at=Zr.scope[ve]=new St);var Gt=Me[ve]=Se(at);return Gt},ue}function wi(ue){var Se=ue.static,ze=ue.dynamic,Lt;if(Ka in Se){var Ft=!!Se[Ka];Lt=vo(function(st,pt){return Ft}),Lt.enable=Ft}else if(Ka in ze){var Ye=ze[Ka];Lt=Us(Ye,function(st,pt){return st.invoke(pt,Ye)})}return Lt}function on(ue,Se){var ze=ue.static,Lt=ue.dynamic;if(As in ze){var Ft=ze[As];return Ft?(Ft=Dr.getFramebuffer(Ft),F.command(Ft,"invalid framebuffer object"),vo(function(st,pt){var Me=st.link(Ft),rt=st.shared;pt.set(rt.framebuffer,".next",Me);var ve=rt.context;return pt.set(ve,"."+Wu,Me+".width"),pt.set(ve,"."+Gu,Me+".height"),Me})):vo(function(st,pt){var Me=st.shared;pt.set(Me.framebuffer,".next","null");var rt=Me.context;return pt.set(rt,"."+Wu,rt+"."+Qo),pt.set(rt,"."+Gu,rt+"."+sc),"null"})}else if(As in Lt){var Ye=Lt[As];return Us(Ye,function(st,pt){var Me=st.invoke(pt,Ye),rt=st.shared,ve=rt.framebuffer,at=pt.def(ve,".getFramebuffer(",Me,")");F.optional(function(){st.assert(pt,"!"+Me+"||"+at,"invalid framebuffer object")}),pt.set(ve,".next",at);var Gt=rt.context;return pt.set(Gt,"."+Wu,at+"?"+at+".width:"+Gt+"."+Qo),pt.set(Gt,"."+Gu,at+"?"+at+".height:"+Gt+"."+sc),at})}else return null}function yi(ue,Se,ze){var Lt=ue.static,Ft=ue.dynamic;function Ye(Me){if(Me in Lt){var rt=Lt[Me];F.commandType(rt,"object","invalid "+Me,ze.commandStr);var ve=!0,at=rt.x|0,Gt=rt.y|0,or,_r;return"width"in rt?(or=rt.width|0,F.command(or>=0,"invalid "+Me,ze.commandStr)):ve=!1,"height"in rt?(_r=rt.height|0,F.command(_r>=0,"invalid "+Me,ze.commandStr)):ve=!1,new Ts(!ve&&Se&&Se.thisDep,!ve&&Se&&Se.contextDep,!ve&&Se&&Se.propDep,function(Pn,_n){var Sn=Pn.shared.context,Gn=or;"width"in rt||(Gn=_n.def(Sn,".",Wu,"-",at));var ri=_r;return"height"in rt||(ri=_n.def(Sn,".",Gu,"-",Gt)),[at,Gt,Gn,ri]})}else if(Me in Ft){var vr=Ft[Me],Rr=Us(vr,function(Pn,_n){var Sn=Pn.invoke(_n,vr);F.optional(function(){Pn.assert(_n,Sn+"&&typeof "+Sn+'==="object"',"invalid "+Me)});var Gn=Pn.shared.context,ri=_n.def(Sn,".x|0"),ta=_n.def(Sn,".y|0"),xo=_n.def('"width" in ',Sn,"?",Sn,".width|0:","(",Gn,".",Wu,"-",ri,")"),dl=_n.def('"height" in ',Sn,"?",Sn,".height|0:","(",Gn,".",Gu,"-",ta,")");return F.optional(function(){Pn.assert(_n,xo+">=0&&"+dl+">=0","invalid "+Me)}),[ri,ta,xo,dl]});return Se&&(Rr.thisDep=Rr.thisDep||Se.thisDep,Rr.contextDep=Rr.contextDep||Se.contextDep,Rr.propDep=Rr.propDep||Se.propDep),Rr}else return Se?new Ts(Se.thisDep,Se.contextDep,Se.propDep,function(Pn,_n){var Sn=Pn.shared.context;return[0,0,_n.def(Sn,".",Wu),_n.def(Sn,".",Gu)]}):null}var st=Ye(Ko);if(st){var pt=st;st=new Ts(st.thisDep,st.contextDep,st.propDep,function(Me,rt){var ve=pt.append(Me,rt),at=Me.shared.context;return rt.set(at,"."+ao,ve[2]),rt.set(at,"."+Ll,ve[3]),ve})}return{viewport:st,scissor_box:Ye(ju)}}function ai(ue,Se){var ze=ue.static,Lt=typeof ze[Hu]=="string"&&typeof ze[au]=="string";if(Lt){if(Object.keys(Se.dynamic).length>0)return null;var Ft=Se.static,Ye=Object.keys(Ft);if(Ye.length>0&&typeof Ft[Ye[0]]=="number"){for(var st=[],pt=0;pt<Ye.length;++pt)F(typeof Ft[Ye[pt]]=="number","must specify all vertex attribute locations when using vaos"),st.push([Ft[Ye[pt]]|0,Ye[pt]]);return st}}return null}function Yn(ue,Se,ze){var Lt=ue.static,Ft=ue.dynamic;function Ye(ve){if(ve in Lt){var at=Ee.id(Lt[ve]);F.optional(function(){Br.shader(Xp[ve],at,F.guessCommand())});var Gt=vo(function(){return at});return Gt.id=at,Gt}else if(ve in Ft){var or=Ft[ve];return Us(or,function(_r,vr){var Rr=_r.invoke(vr,or),Pn=vr.def(_r.shared.strings,".id(",Rr,")");return F.optional(function(){vr(_r.shared.shader,".shader(",Xp[ve],",",Pn,",",_r.command,");")}),Pn})}return null}var st=Ye(Hu),pt=Ye(au),Me=null,rt;return hs(st)&&hs(pt)?(Me=Br.program(pt.id,st.id,null,ze),rt=vo(function(ve,at){return ve.link(Me)})):rt=new Ts(st&&st.thisDep||pt&&pt.thisDep,st&&st.contextDep||pt&&pt.contextDep,st&&st.propDep||pt&&pt.propDep,function(ve,at){var Gt=ve.shared.shader,or;st?or=st.append(ve,at):or=at.def(Gt,".",Hu);var _r;pt?_r=pt.append(ve,at):_r=at.def(Gt,".",au);var vr=Gt+".program("+_r+","+or;return F.optional(function(){vr+=","+ve.command}),at.def(vr+")")}),{frag:st,vert:pt,progVar:rt,program:Me}}function Ui(ue,Se){var ze=ue.static,Lt=ue.dynamic;function Ft(){if(Ni in ze){var ve=ze[Ni];Gf(ve)?ve=zt.getElements(zt.create(ve,!0)):ve&&(ve=zt.getElements(ve),F.command(ve,"invalid elements",Se.commandStr));var at=vo(function(or,_r){if(ve){var vr=or.link(ve);return or.ELEMENTS=vr,vr}return or.ELEMENTS=null,null});return at.value=ve,at}else if(Ni in Lt){var Gt=Lt[Ni];return Us(Gt,function(or,_r){var vr=or.shared,Rr=vr.isBufferArgs,Pn=vr.elements,_n=or.invoke(_r,Gt),Sn=_r.def("null"),Gn=_r.def(Rr,"(",_n,")"),ri=or.cond(Gn).then(Sn,"=",Pn,".createStream(",_n,");").else(Sn,"=",Pn,".getElements(",_n,");");return F.optional(function(){or.assert(ri.else,"!"+_n+"||"+Sn,"invalid elements")}),_r.entry(ri),_r.exit(or.cond(Gn).then(Pn,".destroyStream(",Sn,");")),or.ELEMENTS=Sn,Sn})}return null}var Ye=Ft();function st(){if(po in ze){var ve=ze[po];return F.commandParameter(ve,Pu,"invalid primitve",Se.commandStr),vo(function(Gt,or){return Pu[ve]})}else if(po in Lt){var at=Lt[po];return Us(at,function(Gt,or){var _r=Gt.constants.primTypes,vr=Gt.invoke(or,at);return F.optional(function(){Gt.assert(or,vr+" in "+_r,"invalid primitive, must be one of "+Object.keys(Pu))}),or.def(_r,"[",vr,"]")})}else if(Ye)return hs(Ye)?Ye.value?vo(function(Gt,or){return or.def(Gt.ELEMENTS,".primType")}):vo(function(){return cl}):new Ts(Ye.thisDep,Ye.contextDep,Ye.propDep,function(Gt,or){var _r=Gt.ELEMENTS;return or.def(_r,"?",_r,".primType:",cl)});return null}function pt(ve,at){if(ve in ze){var Gt=ze[ve]|0;return F.command(!at||Gt>=0,"invalid "+ve,Se.commandStr),vo(function(_r,vr){return at&&(_r.OFFSET=Gt),Gt})}else if(ve in Lt){var or=Lt[ve];return Us(or,function(_r,vr){var Rr=_r.invoke(vr,or);return at&&(_r.OFFSET=Rr,F.optional(function(){_r.assert(vr,Rr+">=0","invalid "+ve)})),Rr})}else if(at&&Ye)return vo(function(_r,vr){return _r.OFFSET="0",0});return null}var Me=pt(ou,!0);function rt(){if(io in ze){var ve=ze[io]|0;return F.command(typeof ve=="number"&&ve>=0,"invalid vertex count",Se.commandStr),vo(function(){return ve})}else if(io in Lt){var at=Lt[io];return Us(at,function(_r,vr){var Rr=_r.invoke(vr,at);return F.optional(function(){_r.assert(vr,"typeof "+Rr+'==="number"&&'+Rr+">=0&&"+Rr+"===("+Rr+"|0)","invalid vertex count")}),Rr})}else if(Ye)if(hs(Ye)){if(Ye)return Me?new Ts(Me.thisDep,Me.contextDep,Me.propDep,function(_r,vr){var Rr=vr.def(_r.ELEMENTS,".vertCount-",_r.OFFSET);return F.optional(function(){_r.assert(vr,Rr+">=0","invalid vertex offset/element buffer too small")}),Rr}):vo(function(_r,vr){return vr.def(_r.ELEMENTS,".vertCount")});var Gt=vo(function(){return-1});return F.optional(function(){Gt.MISSING=!0}),Gt}else{var or=new Ts(Ye.thisDep||Me.thisDep,Ye.contextDep||Me.contextDep,Ye.propDep||Me.propDep,function(_r,vr){var Rr=_r.ELEMENTS;return _r.OFFSET?vr.def(Rr,"?",Rr,".vertCount-",_r.OFFSET,":-1"):vr.def(Rr,"?",Rr,".vertCount:-1")});return F.optional(function(){or.DYNAMIC=!0}),or}return null}return{elements:Ye,primitive:st(),count:rt(),instances:pt(Bc,!1),offset:Me}}function mo(ue,Se){var ze=ue.static,Lt=ue.dynamic,Ft={};return Ir.forEach(function(Ye){var st=Xr(Ye);function pt(Me,rt){if(Ye in ze){var ve=Me(ze[Ye]);Ft[st]=vo(function(){return ve})}else if(Ye in Lt){var at=Lt[Ye];Ft[st]=Us(at,function(Gt,or){return rt(Gt,or,Gt.invoke(or,at))})}}switch(Ye){case Lo:case _i:case Kn:case sl:case qn:case iu:case ls:case cs:case nu:case Na:return pt(function(Me){return F.commandType(Me,"boolean",Ye,Se.commandStr),Me},function(Me,rt,ve){return F.optional(function(){Me.assert(rt,"typeof "+ve+'==="boolean"',"invalid flag "+Ye,Me.commandStr)}),ve});case $n:return pt(function(Me){return F.commandParameter(Me,bf,"invalid "+Ye,Se.commandStr),bf[Me]},function(Me,rt,ve){var at=Me.constants.compareFuncs;return F.optional(function(){Me.assert(rt,ve+" in "+at,"invalid "+Ye+", must be one of "+Object.keys(bf))}),rt.def(at,"[",ve,"]")});case wo:return pt(function(Me){return F.command(ja(Me)&&Me.length===2&&typeof Me[0]=="number"&&typeof Me[1]=="number"&&Me[0]<=Me[1],"depth range is 2d array",Se.commandStr),Me},function(Me,rt,ve){F.optional(function(){Me.assert(rt,Me.shared.isArrayLike+"("+ve+")&&"+ve+".length===2&&typeof "+ve+'[0]==="number"&&typeof '+ve+'[1]==="number"&&'+ve+"[0]<="+ve+"[1]","depth range must be a 2d array")});var at=rt.def("+",ve,"[0]"),Gt=rt.def("+",ve,"[1]");return[at,Gt]});case pi:return pt(function(Me){F.commandType(Me,"object","blend.func",Se.commandStr);var rt="srcRGB"in Me?Me.srcRGB:Me.src,ve="srcAlpha"in Me?Me.srcAlpha:Me.src,at="dstRGB"in Me?Me.dstRGB:Me.dst,Gt="dstAlpha"in Me?Me.dstAlpha:Me.dst;return F.commandParameter(rt,hl,st+".srcRGB",Se.commandStr),F.commandParameter(ve,hl,st+".srcAlpha",Se.commandStr),F.commandParameter(at,hl,st+".dstRGB",Se.commandStr),F.commandParameter(Gt,hl,st+".dstAlpha",Se.commandStr),F.command(pl.indexOf(rt+", "+at)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+rt+", "+at+")",Se.commandStr),[hl[rt],hl[at],hl[ve],hl[Gt]]},function(Me,rt,ve){var at=Me.constants.blendFuncs;F.optional(function(){Me.assert(rt,ve+"&&typeof "+ve+'==="object"',"invalid blend func, must be an object")});function Gt(Sn,Gn){var ri=rt.def('"',Sn,Gn,'" in ',ve,"?",ve,".",Sn,Gn,":",ve,".",Sn);return F.optional(function(){Me.assert(rt,ri+" in "+at,"invalid "+Ye+"."+Sn+Gn+", must be one of "+Object.keys(hl))}),ri}var or=Gt("src","RGB"),_r=Gt("dst","RGB");F.optional(function(){var Sn=Me.constants.invalidBlendCombinations;Me.assert(rt,Sn+".indexOf("+or+'+", "+'+_r+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var vr=rt.def(at,"[",or,"]"),Rr=rt.def(at,"[",Gt("src","Alpha"),"]"),Pn=rt.def(at,"[",_r,"]"),_n=rt.def(at,"[",Gt("dst","Alpha"),"]");return[vr,Pn,Rr,_n]});case Xn:return pt(function(Me){if(typeof Me=="string")return F.commandParameter(Me,Qt,"invalid "+Ye,Se.commandStr),[Qt[Me],Qt[Me]];if(typeof Me=="object")return F.commandParameter(Me.rgb,Qt,Ye+".rgb",Se.commandStr),F.commandParameter(Me.alpha,Qt,Ye+".alpha",Se.commandStr),[Qt[Me.rgb],Qt[Me.alpha]];F.commandRaise("invalid blend.equation",Se.commandStr)},function(Me,rt,ve){var at=Me.constants.blendEquations,Gt=rt.def(),or=rt.def(),_r=Me.cond("typeof ",ve,'==="string"');return F.optional(function(){function vr(Rr,Pn,_n){Me.assert(Rr,_n+" in "+at,"invalid "+Pn+", must be one of "+Object.keys(Qt))}vr(_r.then,Ye,ve),Me.assert(_r.else,ve+"&&typeof "+ve+'==="object"',"invalid "+Ye),vr(_r.else,Ye+".rgb",ve+".rgb"),vr(_r.else,Ye+".alpha",ve+".alpha")}),_r.then(Gt,"=",or,"=",at,"[",ve,"];"),_r.else(Gt,"=",at,"[",ve,".rgb];",or,"=",at,"[",ve,".alpha];"),rt(_r),[Gt,or]});case ti:return pt(function(Me){return F.command(ja(Me)&&Me.length===4,"blend.color must be a 4d array",Se.commandStr),di(4,function(rt){return+Me[rt]})},function(Me,rt,ve){return F.optional(function(){Me.assert(rt,Me.shared.isArrayLike+"("+ve+")&&"+ve+".length===4","blend.color must be a 4d array")}),di(4,function(at){return rt.def("+",ve,"[",at,"]")})});case kl:return pt(function(Me){return F.commandType(Me,"number",st,Se.commandStr),Me|0},function(Me,rt,ve){return F.optional(function(){Me.assert(rt,"typeof "+ve+'==="number"',"invalid stencil.mask")}),rt.def(ve,"|0")});case ul:return pt(function(Me){F.commandType(Me,"object",st,Se.commandStr);var rt=Me.cmp||"keep",ve=Me.ref||0,at="mask"in Me?Me.mask:-1;return F.commandParameter(rt,bf,Ye+".cmp",Se.commandStr),F.commandType(ve,"number",Ye+".ref",Se.commandStr),F.commandType(at,"number",Ye+".mask",Se.commandStr),[bf[rt],ve,at]},function(Me,rt,ve){var at=Me.constants.compareFuncs;F.optional(function(){function vr(){Me.assert(rt,Array.prototype.join.call(arguments,""),"invalid stencil.func")}vr(ve+"&&typeof ",ve,'==="object"'),vr('!("cmp" in ',ve,")||(",ve,".cmp in ",at,")")});var Gt=rt.def('"cmp" in ',ve,"?",at,"[",ve,".cmp]",":",Nl),or=rt.def(ve,".ref|0"),_r=rt.def('"mask" in ',ve,"?",ve,".mask|0:-1");return[Gt,or,_r]});case Fl:case Vu:return pt(function(Me){F.commandType(Me,"object",st,Se.commandStr);var rt=Me.fail||"keep",ve=Me.zfail||"keep",at=Me.zpass||"keep";return F.commandParameter(rt,fc,Ye+".fail",Se.commandStr),F.commandParameter(ve,fc,Ye+".zfail",Se.commandStr),F.commandParameter(at,fc,Ye+".zpass",Se.commandStr),[Ye===Vu?yf:lc,fc[rt],fc[ve],fc[at]]},function(Me,rt,ve){var at=Me.constants.stencilOps;F.optional(function(){Me.assert(rt,ve+"&&typeof "+ve+'==="object"',"invalid "+Ye)});function Gt(or){return F.optional(function(){Me.assert(rt,'!("'+or+'" in '+ve+")||("+ve+"."+or+" in "+at+")","invalid "+Ye+"."+or+", must be one of "+Object.keys(fc))}),rt.def('"',or,'" in ',ve,"?",at,"[",ve,".",or,"]:",Nl)}return[Ye===Vu?yf:lc,Gt("fail"),Gt("zfail"),Gt("zpass")]});case Zu:return pt(function(Me){F.commandType(Me,"object",st,Se.commandStr);var rt=Me.factor|0,ve=Me.units|0;return F.commandType(rt,"number",st+".factor",Se.commandStr),F.commandType(ve,"number",st+".units",Se.commandStr),[rt,ve]},function(Me,rt,ve){F.optional(function(){Me.assert(rt,ve+"&&typeof "+ve+'==="object"',"invalid "+Ye)});var at=rt.def(ve,".factor|0"),Gt=rt.def(ve,".units|0");return[at,Gt]});case Wa:return pt(function(Me){var rt=0;return Me==="front"?rt=lc:Me==="back"&&(rt=yf),F.command(!!rt,st,Se.commandStr),rt},function(Me,rt,ve){return F.optional(function(){Me.assert(rt,ve+'==="front"||'+ve+'==="back"',"invalid cull.face")}),rt.def(ve,'==="front"?',lc,":",yf)});case Ss:return pt(function(Me){return F.command(typeof Me=="number"&&Me>=Ut.lineWidthDims[0]&&Me<=Ut.lineWidthDims[1],"invalid line width, must be a positive number between "+Ut.lineWidthDims[0]+" and "+Ut.lineWidthDims[1],Se.commandStr),Me},function(Me,rt,ve){return F.optional(function(){Me.assert(rt,"typeof "+ve+'==="number"&&'+ve+">="+Ut.lineWidthDims[0]+"&&"+ve+"<="+Ut.lineWidthDims[1],"invalid line width")}),ve});case Ga:return pt(function(Me){return F.commandParameter(Me,Ul,st,Se.commandStr),Ul[Me]},function(Me,rt,ve){return F.optional(function(){Me.assert(rt,ve+'==="cw"||'+ve+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),rt.def(ve+'==="cw"?'+pp+":"+Ph)});case Co:return pt(function(Me){return F.command(ja(Me)&&Me.length===4,"color.mask must be length 4 array",Se.commandStr),Me.map(function(rt){return!!rt})},function(Me,rt,ve){return F.optional(function(){Me.assert(rt,Me.shared.isArrayLike+"("+ve+")&&"+ve+".length===4","invalid color.mask")}),di(4,function(at){return"!!"+ve+"["+at+"]"})});case Ns:return pt(function(Me){F.command(typeof Me=="object"&&Me,st,Se.commandStr);var rt="value"in Me?Me.value:1,ve=!!Me.invert;return F.command(typeof rt=="number"&&rt>=0&&rt<=1,"sample.coverage.value must be a number between 0 and 1",Se.commandStr),[rt,ve]},function(Me,rt,ve){F.optional(function(){Me.assert(rt,ve+"&&typeof "+ve+'==="object"',"invalid sample.coverage")});var at=rt.def('"value" in ',ve,"?+",ve,".value:1"),Gt=rt.def("!!",ve,".invert");return[at,Gt]})}}),Ft}function Wo(ue,Se){var ze=ue.static,Lt=ue.dynamic,Ft={};return Object.keys(ze).forEach(function(Ye){var st=ze[Ye],pt;if(typeof st=="number"||typeof st=="boolean")pt=vo(function(){return st});else if(typeof st=="function"){var Me=st._reglType;Me==="texture2d"||Me==="textureCube"?pt=vo(function(rt){return rt.link(st)}):Me==="framebuffer"||Me==="framebufferCube"?(F.command(st.color.length>0,'missing color attachment for framebuffer sent to uniform "'+Ye+'"',Se.commandStr),pt=vo(function(rt){return rt.link(st.color[0])})):F.commandRaise('invalid data for uniform "'+Ye+'"',Se.commandStr)}else ja(st)?pt=vo(function(rt){var ve=rt.global.def("[",di(st.length,function(at){return F.command(typeof st[at]=="number"||typeof st[at]=="boolean","invalid uniform "+Ye,rt.commandStr),st[at]}),"]");return ve}):F.commandRaise('invalid or missing data for uniform "'+Ye+'"',Se.commandStr);pt.value=st,Ft[Ye]=pt}),Object.keys(Lt).forEach(function(Ye){var st=Lt[Ye];Ft[Ye]=Us(st,function(pt,Me){return pt.invoke(Me,st)})}),Ft}function Ri(ue,Se){var ze=ue.static,Lt=ue.dynamic,Ft={};return Object.keys(ze).forEach(function(Ye){var st=ze[Ye],pt=Ee.id(Ye),Me=new St;if(Gf(st))Me.state=Fr,Me.buffer=cr.getBuffer(cr.create(st,Lc,!1,!0)),Me.type=0;else{var rt=cr.getBuffer(st);if(rt)Me.state=Fr,Me.buffer=rt,Me.type=0;else if(F.command(typeof st=="object"&&st,"invalid data for attribute "+Ye,Se.commandStr),"constant"in st){var ve=st.constant;Me.buffer="null",Me.state=an,typeof ve=="number"?Me.x=ve:(F.command(ja(ve)&&ve.length>0&&ve.length<=4,"invalid constant for attribute "+Ye,Se.commandStr),mr.forEach(function(Pn,_n){_n<ve.length&&(Me[Pn]=ve[_n])}))}else{Gf(st.buffer)?rt=cr.getBuffer(cr.create(st.buffer,Lc,!1,!0)):rt=cr.getBuffer(st.buffer),F.command(!!rt,'missing buffer for attribute "'+Ye+'"',Se.commandStr);var at=st.offset|0;F.command(at>=0,'invalid offset for attribute "'+Ye+'"',Se.commandStr);var Gt=st.stride|0;F.command(Gt>=0&&Gt<256,'invalid stride for attribute "'+Ye+'", must be integer betweeen [0, 255]',Se.commandStr);var or=st.size|0;F.command(!("size"in st)||or>0&&or<=4,'invalid size for attribute "'+Ye+'", must be 1,2,3,4',Se.commandStr);var _r=!!st.normalized,vr=0;"type"in st&&(F.commandParameter(st.type,jo,"invalid type for attribute "+Ye,Se.commandStr),vr=jo[st.type]);var Rr=st.divisor|0;"divisor"in st&&(F.command(Rr===0||kr,'cannot specify divisor for attribute "'+Ye+'", instancing not supported',Se.commandStr),F.command(Rr>=0,'invalid divisor for attribute "'+Ye+'"',Se.commandStr)),F.optional(function(){var Pn=Se.commandStr,_n=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(st).forEach(function(Sn){F.command(_n.indexOf(Sn)>=0,'unknown parameter "'+Sn+'" for attribute pointer "'+Ye+'" (valid parameters are '+_n+")",Pn)})}),Me.buffer=rt,Me.state=Fr,Me.size=or,Me.normalized=_r,Me.type=vr||rt.dtype,Me.offset=at,Me.stride=Gt,Me.divisor=Rr}}Ft[Ye]=vo(function(Pn,_n){var Sn=Pn.attribCache;if(pt in Sn)return Sn[pt];var Gn={isStream:!1};return Object.keys(Me).forEach(function(ri){Gn[ri]=Me[ri]}),Me.buffer&&(Gn.buffer=Pn.link(Me.buffer),Gn.type=Gn.type||Gn.buffer+".dtype"),Sn[pt]=Gn,Gn})}),Object.keys(Lt).forEach(function(Ye){var st=Lt[Ye];function pt(Me,rt){var ve=Me.invoke(rt,st),at=Me.shared,Gt=Me.constants,or=at.isBufferArgs,_r=at.buffer;F.optional(function(){Me.assert(rt,ve+"&&(typeof "+ve+'==="object"||typeof '+ve+'==="function")&&('+or+"("+ve+")||"+_r+".getBuffer("+ve+")||"+_r+".getBuffer("+ve+".buffer)||"+or+"("+ve+'.buffer)||("constant" in '+ve+"&&(typeof "+ve+'.constant==="number"||'+at.isArrayLike+"("+ve+".constant))))",'invalid dynamic attribute "'+Ye+'"')});var vr={isStream:rt.def(!1)},Rr=new St;Rr.state=Fr,Object.keys(Rr).forEach(function(Gn){vr[Gn]=rt.def(""+Rr[Gn])});var Pn=vr.buffer,_n=vr.type;rt("if(",or,"(",ve,")){",vr.isStream,"=true;",Pn,"=",_r,".createStream(",Lc,",",ve,");",_n,"=",Pn,".dtype;","}else{",Pn,"=",_r,".getBuffer(",ve,");","if(",Pn,"){",_n,"=",Pn,".dtype;",'}else if("constant" in ',ve,"){",vr.state,"=",an,";","if(typeof "+ve+'.constant === "number"){',vr[mr[0]],"=",ve,".constant;",mr.slice(1).map(function(Gn){return vr[Gn]}).join("="),"=0;","}else{",mr.map(function(Gn,ri){return vr[Gn]+"="+ve+".constant.length>"+ri+"?"+ve+".constant["+ri+"]:0;"}).join(""),"}}else{","if(",or,"(",ve,".buffer)){",Pn,"=",_r,".createStream(",Lc,",",ve,".buffer);","}else{",Pn,"=",_r,".getBuffer(",ve,".buffer);","}",_n,'="type" in ',ve,"?",Gt.glTypes,"[",ve,".type]:",Pn,".dtype;",vr.normalized,"=!!",ve,".normalized;");function Sn(Gn){rt(vr[Gn],"=",ve,".",Gn,"|0;")}return Sn("size"),Sn("offset"),Sn("stride"),Sn("divisor"),rt("}}"),rt.exit("if(",vr.isStream,"){",_r,".destroyStream(",Pn,");","}"),vr}Ft[Ye]=Us(st,pt)}),Ft}function lo(ue,Se){var ze=ue.static,Lt=ue.dynamic;if(Bl in ze){var Ft=ze[Bl];return Ft!==null&&Zr.getVAO(Ft)===null&&(Ft=Zr.createVAO(Ft)),vo(function(st){return st.link(Zr.getVAO(Ft))})}else if(Bl in Lt){var Ye=Lt[Bl];return Us(Ye,function(st,pt){var Me=st.invoke(pt,Ye);return pt.def(st.shared.vao+".getVAO("+Me+")")})}return null}function Sa(ue){var Se=ue.static,ze=ue.dynamic,Lt={};return Object.keys(Se).forEach(function(Ft){var Ye=Se[Ft];Lt[Ft]=vo(function(st,pt){return typeof Ye=="number"||typeof Ye=="boolean"?""+Ye:st.link(Ye)})}),Object.keys(ze).forEach(function(Ft){var Ye=ze[Ft];Lt[Ft]=Us(Ye,function(st,pt){return st.invoke(pt,Ye)})}),Lt}function go(ue,Se,ze,Lt,Ft){var Ye=ue.static,st=ue.dynamic;F.optional(function(){var Sn=[As,au,Hu,Ni,po,ou,io,Bc,Ka,Bl].concat(Ir);function Gn(ri){Object.keys(ri).forEach(function(ta){F.command(Sn.indexOf(ta)>=0,'unknown parameter "'+ta+'"',Ft.commandStr)})}Gn(Ye),Gn(st)});var pt=ai(ue,Se),Me=on(ue,Ft),rt=yi(ue,Me,Ft),ve=Ui(ue,Ft),at=mo(ue,Ft),Gt=Yn(ue,Ft,pt);function or(Sn){var Gn=rt[Sn];Gn&&(at[Sn]=Gn)}or(Ko),or(Xr(ju));var _r=Object.keys(at).length>0,vr={framebuffer:Me,draw:ve,shader:Gt,state:at,dirty:_r,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(vr.profile=wi(ue,Ft),vr.uniforms=Wo(ze,Ft),vr.drawVAO=vr.scopeVAO=lo(ue,Ft),!vr.drawVAO&&Gt.program&&!pt&&Ze.angle_instanced_arrays){var Rr=!0,Pn=Gt.program.attributes.map(function(Sn){var Gn=Se.static[Sn];return Rr=Rr&&!!Gn,Gn});if(Rr&&Pn.length>0){var _n=Zr.getVAO(Zr.createVAO(Pn));vr.drawVAO=new Ts(null,null,null,function(Sn,Gn){return Sn.link(_n)}),vr.useVAO=!0}}return pt?vr.useVAO=!0:vr.attributes=Ri(Se,Ft),vr.context=Sa(Lt,Ft),vr}function _o(ue,Se,ze){var Lt=ue.shared,Ft=Lt.context,Ye=ue.scope();Object.keys(ze).forEach(function(st){Se.save(Ft,"."+st);var pt=ze[st];Ye(Ft,".",st,"=",pt.append(ue,Se),";")}),Se(Ye)}function Qa(ue,Se,ze,Lt){var Ft=ue.shared,Ye=Ft.gl,st=Ft.framebuffer,pt;Jr&&(pt=Se.def(Ft.extensions,".webgl_draw_buffers"));var Me=ue.constants,rt=Me.drawBuffer,ve=Me.backBuffer,at;ze?at=ze.append(ue,Se):at=Se.def(st,".next"),Lt||Se("if(",at,"!==",st,".cur){"),Se("if(",at,"){",Ye,".bindFramebuffer(",cc,",",at,".framebuffer);"),Jr&&Se(pt,".drawBuffersWEBGL(",rt,"[",at,".colorAttachments.length]);"),Se("}else{",Ye,".bindFramebuffer(",cc,",null);"),Jr&&Se(pt,".drawBuffersWEBGL(",ve,");"),Se("}",st,".cur=",at,";"),Lt||Se("}")}function Ro(ue,Se,ze){var Lt=ue.shared,Ft=Lt.gl,Ye=ue.current,st=ue.next,pt=Lt.current,Me=Lt.next,rt=ue.cond(pt,".dirty");Ir.forEach(function(ve){var at=Xr(ve);if(!(at in ze.state)){var Gt,or;if(at in st){Gt=st[at],or=Ye[at];var _r=di(gr[at].length,function(Rr){return rt.def(Gt,"[",Rr,"]")});rt(ue.cond(_r.map(function(Rr,Pn){return Rr+"!=="+or+"["+Pn+"]"}).join("||")).then(Ft,".",xr[at],"(",_r,");",_r.map(function(Rr,Pn){return or+"["+Pn+"]="+Rr}).join(";"),";"))}else{Gt=rt.def(Me,".",at);var vr=ue.cond(Gt,"!==",pt,".",at);rt(vr),at in en?vr(ue.cond(Gt).then(Ft,".enable(",en[at],");").else(Ft,".disable(",en[at],");"),pt,".",at,"=",Gt,";"):vr(Ft,".",xr[at],"(",Gt,");",pt,".",at,"=",Gt,";")}}}),Object.keys(ze.state).length===0&&rt(pt,".dirty=false;"),Se(rt)}function ps(ue,Se,ze,Lt){var Ft=ue.shared,Ye=ue.current,st=Ft.current,pt=Ft.gl;vp(Object.keys(ze)).forEach(function(Me){var rt=ze[Me];if(!(Lt&&!Lt(rt))){var ve=rt.append(ue,Se);if(en[Me]){var at=en[Me];hs(rt)?ve?Se(pt,".enable(",at,");"):Se(pt,".disable(",at,");"):Se(ue.cond(ve).then(pt,".enable(",at,");").else(pt,".disable(",at,");")),Se(st,".",Me,"=",ve,";")}else if(ja(ve)){var Gt=Ye[Me];Se(pt,".",xr[Me],"(",ve,");",ve.map(function(or,_r){return Gt+"["+_r+"]="+or}).join(";"),";")}else Se(pt,".",xr[Me],"(",ve,");",st,".",Me,"=",ve,";")}})}function Mo(ue,Se){kr&&(ue.instancing=Se.def(ue.shared.extensions,".angle_instanced_arrays"))}function xi(ue,Se,ze,Lt,Ft){var Ye=ue.shared,st=ue.stats,pt=Ye.current,Me=Ye.timer,rt=ze.profile;function ve(){return typeof performance=="undefined"?"Date.now()":"performance.now()"}var at,Gt;function or(Sn){at=Se.def(),Sn(at,"=",ve(),";"),typeof Ft=="string"?Sn(st,".count+=",Ft,";"):Sn(st,".count++;"),Er&&(Lt?(Gt=Se.def(),Sn(Gt,"=",Me,".getNumPendingQueries();")):Sn(Me,".beginQuery(",st,");"))}function _r(Sn){Sn(st,".cpuTime+=",ve(),"-",at,";"),Er&&(Lt?Sn(Me,".pushScopeStats(",Gt,",",Me,".getNumPendingQueries(),",st,");"):Sn(Me,".endQuery();"))}function vr(Sn){var Gn=Se.def(pt,".profile");Se(pt,".profile=",Sn,";"),Se.exit(pt,".profile=",Gn,";")}var Rr;if(rt){if(hs(rt)){rt.enable?(or(Se),_r(Se.exit),vr("true")):vr("false");return}Rr=rt.append(ue,Se),vr(Rr)}else Rr=Se.def(pt,".profile");var Pn=ue.block();or(Pn),Se("if(",Rr,"){",Pn,"}");var _n=ue.block();_r(_n),Se.exit("if(",Rr,"){",_n,"}")}function es(ue,Se,ze,Lt,Ft){var Ye=ue.shared;function st(Me){switch(Me){case Uc:case fp:case vf:return 2;case Wf:case oo:case mf:return 3;case cp:case uc:case zc:return 4;default:return 1}}function pt(Me,rt,ve){var at=Ye.gl,Gt=Se.def(Me,".location"),or=Se.def(Ye.attributes,"[",Gt,"]"),_r=ve.state,vr=ve.buffer,Rr=[ve.x,ve.y,ve.z,ve.w],Pn=["buffer","normalized","offset","stride"];function _n(){Se("if(!",or,".buffer){",at,".enableVertexAttribArray(",Gt,");}");var Gn=ve.type,ri;if(ve.size?ri=Se.def(ve.size,"||",rt):ri=rt,Se("if(",or,".type!==",Gn,"||",or,".size!==",ri,"||",Pn.map(function(xo){return or+"."+xo+"!=="+ve[xo]}).join("||"),"){",at,".bindBuffer(",Lc,",",vr,".buffer);",at,".vertexAttribPointer(",[Gt,ri,Gn,ve.normalized,ve.stride,ve.offset],");",or,".type=",Gn,";",or,".size=",ri,";",Pn.map(function(xo){return or+"."+xo+"="+ve[xo]+";"}).join(""),"}"),kr){var ta=ve.divisor;Se("if(",or,".divisor!==",ta,"){",ue.instancing,".vertexAttribDivisorANGLE(",[Gt,ta],");",or,".divisor=",ta,";}")}}function Sn(){Se("if(",or,".buffer){",at,".disableVertexAttribArray(",Gt,");",or,".buffer=null;","}if(",mr.map(function(Gn,ri){return or+"."+Gn+"!=="+Rr[ri]}).join("||"),"){",at,".vertexAttrib4f(",Gt,",",Rr,");",mr.map(function(Gn,ri){return or+"."+Gn+"="+Rr[ri]+";"}).join(""),"}")}_r===Fr?_n():_r===an?Sn():(Se("if(",_r,"===",Fr,"){"),_n(),Se("}else{"),Sn(),Se("}"))}Lt.forEach(function(Me){var rt=Me.name,ve=ze.attributes[rt],at;if(ve){if(!Ft(ve))return;at=ve.append(ue,Se)}else{if(!Ft($p))return;var Gt=ue.scopeAttrib(rt);F.optional(function(){ue.assert(Se,Gt+".state","missing attribute "+rt)}),at={},Object.keys(new St).forEach(function(or){at[or]=Se.def(Gt,".",or)})}pt(ue.link(Me),st(Me.info.type),at)})}function aa(ue,Se,ze,Lt,Ft){for(var Ye=ue.shared,st=Ye.gl,pt,Me=0;Me<Lt.length;++Me){var rt=Lt[Me],ve=rt.name,at=rt.info.type,Gt=ze.uniforms[ve],or=ue.link(rt),_r=or+".location",vr;if(Gt){if(!Ft(Gt))continue;if(hs(Gt)){var Rr=Gt.value;if(F.command(Rr!==null&&typeof Rr!="undefined",'missing uniform "'+ve+'"',ue.commandStr),at===Zc||at===_f){F.command(typeof Rr=="function"&&(at===Zc&&(Rr._reglType==="texture2d"||Rr._reglType==="framebuffer")||at===_f&&(Rr._reglType==="textureCube"||Rr._reglType==="framebufferCube")),"invalid texture for uniform "+ve,ue.commandStr);var Pn=ue.link(Rr._texture||Rr.color[0]._texture);Se(st,".uniform1i(",_r,",",Pn+".bind());"),Se.exit(Pn,".unbind();")}else if(at===Ih||at===gf||at===ll){F.optional(function(){F.command(ja(Rr),"invalid matrix for uniform "+ve,ue.commandStr),F.command(at===Ih&&Rr.length===4||at===gf&&Rr.length===9||at===ll&&Rr.length===16,"invalid length for matrix uniform "+ve,ue.commandStr)});var _n=ue.global.def("new Float32Array(["+Array.prototype.slice.call(Rr)+"])"),Sn=2;at===gf?Sn=3:at===ll&&(Sn=4),Se(st,".uniformMatrix",Sn,"fv(",_r,",false,",_n,");")}else{switch(at){case kd:F.commandType(Rr,"number","uniform "+ve,ue.commandStr),pt="1f";break;case Uc:F.command(ja(Rr)&&Rr.length===2,"uniform "+ve,ue.commandStr),pt="2f";break;case Wf:F.command(ja(Rr)&&Rr.length===3,"uniform "+ve,ue.commandStr),pt="3f";break;case cp:F.command(ja(Rr)&&Rr.length===4,"uniform "+ve,ue.commandStr),pt="4f";break;case hp:F.commandType(Rr,"boolean","uniform "+ve,ue.commandStr),pt="1i";break;case df:F.commandType(Rr,"number","uniform "+ve,ue.commandStr),pt="1i";break;case vf:F.command(ja(Rr)&&Rr.length===2,"uniform "+ve,ue.commandStr),pt="2i";break;case fp:F.command(ja(Rr)&&Rr.length===2,"uniform "+ve,ue.commandStr),pt="2i";break;case mf:F.command(ja(Rr)&&Rr.length===3,"uniform "+ve,ue.commandStr),pt="3i";break;case oo:F.command(ja(Rr)&&Rr.length===3,"uniform "+ve,ue.commandStr),pt="3i";break;case zc:F.command(ja(Rr)&&Rr.length===4,"uniform "+ve,ue.commandStr),pt="4i";break;case uc:F.command(ja(Rr)&&Rr.length===4,"uniform "+ve,ue.commandStr),pt="4i";break}Se(st,".uniform",pt,"(",_r,",",ja(Rr)?Array.prototype.slice.call(Rr):Rr,");")}continue}else vr=Gt.append(ue,Se)}else{if(!Ft($p))continue;vr=Se.def(Ye.uniforms,"[",Ee.id(ve),"]")}at===Zc?Se("if(",vr,"&&",vr,'._reglType==="framebuffer"){',vr,"=",vr,".color[0];","}"):at===_f&&Se("if(",vr,"&&",vr,'._reglType==="framebufferCube"){',vr,"=",vr,".color[0];","}"),F.optional(function(){function dl(zs,hc){ue.assert(Se,zs,'bad data or missing for uniform "'+ve+'".  '+hc)}function mp(zs){dl("typeof "+vr+'==="'+zs+'"',"invalid type, expected "+zs)}function yu(zs,hc){dl(Ye.isArrayLike+"("+vr+")&&"+vr+".length==="+zs,"invalid vector, should have length "+zs,ue.commandStr)}function Vd(zs){dl("typeof "+vr+'==="function"&&'+vr+'._reglType==="texture'+(zs===pf?"2d":"Cube")+'"',"invalid texture type",ue.commandStr)}switch(at){case df:mp("number");break;case fp:yu(2,"number");break;case oo:yu(3,"number");break;case uc:yu(4,"number");break;case kd:mp("number");break;case Uc:yu(2,"number");break;case Wf:yu(3,"number");break;case cp:yu(4,"number");break;case hp:mp("boolean");break;case vf:yu(2,"boolean");break;case mf:yu(3,"boolean");break;case zc:yu(4,"boolean");break;case Ih:yu(4,"number");break;case gf:yu(9,"number");break;case ll:yu(16,"number");break;case Zc:Vd(pf);break;case _f:Vd(Id);break}});var Gn=1;switch(at){case Zc:case _f:var ri=Se.def(vr,"._texture");Se(st,".uniform1i(",_r,",",ri,".bind());"),Se.exit(ri,".unbind();");continue;case df:case hp:pt="1i";break;case fp:case vf:pt="2i",Gn=2;break;case oo:case mf:pt="3i",Gn=3;break;case uc:case zc:pt="4i",Gn=4;break;case kd:pt="1f";break;case Uc:pt="2f",Gn=2;break;case Wf:pt="3f",Gn=3;break;case cp:pt="4f",Gn=4;break;case Ih:pt="Matrix2fv";break;case gf:pt="Matrix3fv";break;case ll:pt="Matrix4fv";break}if(Se(st,".uniform",pt,"(",_r,","),pt.charAt(0)==="M"){var ta=Math.pow(at-Ih+2,2),xo=ue.global.def("new Float32Array(",ta,")");Se("false,(Array.isArray(",vr,")||",vr," instanceof Float32Array)?",vr,":(",di(ta,function(dl){return xo+"["+dl+"]="+vr+"["+dl+"]"}),",",xo,")")}else Gn>1?Se(di(Gn,function(dl){return vr+"["+dl+"]"})):Se(vr);Se(");")}}function Wn(ue,Se,ze,Lt){var Ft=ue.shared,Ye=Ft.gl,st=Ft.draw,pt=Lt.draw;function Me(){var ri=pt.elements,ta,xo=Se;return ri?((ri.contextDep&&Lt.contextDynamic||ri.propDep)&&(xo=ze),ta=ri.append(ue,xo)):ta=xo.def(st,".",Ni),ta&&xo("if("+ta+")"+Ye+".bindBuffer("+Km+","+ta+".buffer.buffer);"),ta}function rt(){var ri=pt.count,ta,xo=Se;return ri?((ri.contextDep&&Lt.contextDynamic||ri.propDep)&&(xo=ze),ta=ri.append(ue,xo),F.optional(function(){ri.MISSING&&ue.assert(Se,"false","missing vertex count"),ri.DYNAMIC&&ue.assert(xo,ta+">=0","missing vertex count")})):(ta=xo.def(st,".",io),F.optional(function(){ue.assert(xo,ta+">=0","missing vertex count")})),ta}var ve=Me();function at(ri){var ta=pt[ri];return ta?ta.contextDep&&Lt.contextDynamic||ta.propDep?ta.append(ue,ze):ta.append(ue,Se):Se.def(st,".",ri)}var Gt=at(po),or=at(ou),_r=rt();if(typeof _r=="number"){if(_r===0)return}else ze("if(",_r,"){"),ze.exit("}");var vr,Rr;kr&&(vr=at(Bc),Rr=ue.instancing);var Pn=ve+".type",_n=pt.elements&&hs(pt.elements);function Sn(){function ri(){ze(Rr,".drawElementsInstancedANGLE(",[Gt,_r,Pn,or+"<<(("+Pn+"-"+Nr+")>>1)",vr],");")}function ta(){ze(Rr,".drawArraysInstancedANGLE(",[Gt,or,_r,vr],");")}ve?_n?ri():(ze("if(",ve,"){"),ri(),ze("}else{"),ta(),ze("}")):ta()}function Gn(){function ri(){ze(Ye+".drawElements("+[Gt,_r,Pn,or+"<<(("+Pn+"-"+Nr+")>>1)"]+");")}function ta(){ze(Ye+".drawArrays("+[Gt,or,_r]+");")}ve?_n?ri():(ze("if(",ve,"){"),ri(),ze("}else{"),ta(),ze("}")):ta()}kr&&(typeof vr!="number"||vr>=0)?typeof vr=="string"?(ze("if(",vr,">0){"),Sn(),ze("}else if(",vr,"<0){"),Gn(),ze("}")):Sn():Gn()}function Mi(ue,Se,ze,Lt,Ft){var Ye=tt(),st=Ye.proc("body",Ft);return F.optional(function(){Ye.commandStr=Se.commandStr,Ye.command=Ye.link(Se.commandStr)}),kr&&(Ye.instancing=st.def(Ye.shared.extensions,".angle_instanced_arrays")),ue(Ye,st,ze,Lt),Ye.compile().body}function Gi(ue,Se,ze,Lt){Mo(ue,Se),ze.useVAO?ze.drawVAO?Se(ue.shared.vao,".setVAO(",ze.drawVAO.append(ue,Se),");"):Se(ue.shared.vao,".setVAO(",ue.shared.vao,".targetVAO);"):(Se(ue.shared.vao,".setVAO(null);"),es(ue,Se,ze,Lt.attributes,function(){return!0})),aa(ue,Se,ze,Lt.uniforms,function(){return!0}),Wn(ue,Se,Se,ze)}function yo(ue,Se){var ze=ue.proc("draw",1);Mo(ue,ze),_o(ue,ze,Se.context),Qa(ue,ze,Se.framebuffer),Ro(ue,ze,Se),ps(ue,ze,Se.state),xi(ue,ze,Se,!1,!0);var Lt=Se.shader.progVar.append(ue,ze);if(ze(ue.shared.gl,".useProgram(",Lt,".program);"),Se.shader.program)Gi(ue,ze,Se,Se.shader.program);else{ze(ue.shared.vao,".setVAO(null);");var Ft=ue.global.def("{}"),Ye=ze.def(Lt,".id"),st=ze.def(Ft,"[",Ye,"]");ze(ue.cond(st).then(st,".call(this,a0);").else(st,"=",Ft,"[",Ye,"]=",ue.link(function(pt){return Mi(Gi,ue,Se,pt,1)}),"(",Lt,");",st,".call(this,a0);"))}Object.keys(Se.state).length>0&&ze(ue.shared.current,".dirty=true;")}function Xu(ue,Se,ze,Lt){ue.batchId="a1",Mo(ue,Se);function Ft(){return!0}es(ue,Se,ze,Lt.attributes,Ft),aa(ue,Se,ze,Lt.uniforms,Ft),Wn(ue,Se,Se,ze)}function ke(ue,Se,ze,Lt){Mo(ue,Se);var Ft=ze.contextDep,Ye=Se.def(),st="a0",pt="a1",Me=Se.def();ue.shared.props=Me,ue.batchId=Ye;var rt=ue.scope(),ve=ue.scope();Se(rt.entry,"for(",Ye,"=0;",Ye,"<",pt,";++",Ye,"){",Me,"=",st,"[",Ye,"];",ve,"}",rt.exit);function at(Pn){return Pn.contextDep&&Ft||Pn.propDep}function Gt(Pn){return!at(Pn)}if(ze.needsContext&&_o(ue,ve,ze.context),ze.needsFramebuffer&&Qa(ue,ve,ze.framebuffer),ps(ue,ve,ze.state,at),ze.profile&&at(ze.profile)&&xi(ue,ve,ze,!1,!0),Lt)ze.useVAO?ze.drawVAO?at(ze.drawVAO)?ve(ue.shared.vao,".setVAO(",ze.drawVAO.append(ue,ve),");"):rt(ue.shared.vao,".setVAO(",ze.drawVAO.append(ue,rt),");"):rt(ue.shared.vao,".setVAO(",ue.shared.vao,".targetVAO);"):(rt(ue.shared.vao,".setVAO(null);"),es(ue,rt,ze,Lt.attributes,Gt),es(ue,ve,ze,Lt.attributes,at)),aa(ue,rt,ze,Lt.uniforms,Gt),aa(ue,ve,ze,Lt.uniforms,at),Wn(ue,rt,ve,ze);else{var or=ue.global.def("{}"),_r=ze.shader.progVar.append(ue,ve),vr=ve.def(_r,".id"),Rr=ve.def(or,"[",vr,"]");ve(ue.shared.gl,".useProgram(",_r,".program);","if(!",Rr,"){",Rr,"=",or,"[",vr,"]=",ue.link(function(Pn){return Mi(Xu,ue,ze,Pn,2)}),"(",_r,");}",Rr,".call(this,a0[",Ye,"],",Ye,");")}}function Zt(ue,Se){var ze=ue.proc("batch",2);ue.batchId="0",Mo(ue,ze);var Lt=!1,Ft=!0;Object.keys(Se.context).forEach(function(or){Lt=Lt||Se.context[or].propDep}),Lt||(_o(ue,ze,Se.context),Ft=!1);var Ye=Se.framebuffer,st=!1;Ye?(Ye.propDep?Lt=st=!0:Ye.contextDep&&Lt&&(st=!0),st||Qa(ue,ze,Ye)):Qa(ue,ze,null),Se.state.viewport&&Se.state.viewport.propDep&&(Lt=!0);function pt(or){return or.contextDep&&Lt||or.propDep}Ro(ue,ze,Se),ps(ue,ze,Se.state,function(or){return!pt(or)}),(!Se.profile||!pt(Se.profile))&&xi(ue,ze,Se,!1,"a1"),Se.contextDep=Lt,Se.needsContext=Ft,Se.needsFramebuffer=st;var Me=Se.shader.progVar;if(Me.contextDep&&Lt||Me.propDep)ke(ue,ze,Se,null);else{var rt=Me.append(ue,ze);if(ze(ue.shared.gl,".useProgram(",rt,".program);"),Se.shader.program)ke(ue,ze,Se,Se.shader.program);else{ze(ue.shared.vao,".setVAO(null);");var ve=ue.global.def("{}"),at=ze.def(rt,".id"),Gt=ze.def(ve,"[",at,"]");ze(ue.cond(Gt).then(Gt,".call(this,a0,a1);").else(Gt,"=",ve,"[",at,"]=",ue.link(function(or){return Mi(ke,ue,Se,or,2)}),"(",rt,");",Gt,".call(this,a0,a1);"))}}Object.keys(Se.state).length>0&&ze(ue.shared.current,".dirty=true;")}function Bt(ue,Se){var ze=ue.proc("scope",3);ue.batchId="a2";var Lt=ue.shared,Ft=Lt.current;_o(ue,ze,Se.context),Se.framebuffer&&Se.framebuffer.append(ue,ze),vp(Object.keys(Se.state)).forEach(function(st){var pt=Se.state[st],Me=pt.append(ue,ze);ja(Me)?Me.forEach(function(rt,ve){ze.set(ue.next[st],"["+ve+"]",rt)}):ze.set(Lt.next,"."+st,Me)}),xi(ue,ze,Se,!0,!0),[Ni,ou,io,Bc,po].forEach(function(st){var pt=Se.draw[st];pt&&ze.set(Lt.draw,"."+st,""+pt.append(ue,ze))}),Object.keys(Se.uniforms).forEach(function(st){ze.set(Lt.uniforms,"["+Ee.id(st)+"]",Se.uniforms[st].append(ue,ze))}),Object.keys(Se.attributes).forEach(function(st){var pt=Se.attributes[st].append(ue,ze),Me=ue.scopeAttrib(st);Object.keys(new St).forEach(function(rt){ze.set(Me,"."+rt,pt[rt])})}),Se.scopeVAO&&ze.set(Lt.vao,".targetVAO",Se.scopeVAO.append(ue,ze));function Ye(st){var pt=Se.shader[st];pt&&ze.set(Lt.shader,"."+st,pt.append(ue,ze))}Ye(au),Ye(Hu),Object.keys(Se.state).length>0&&(ze(Ft,".dirty=true;"),ze.exit(Ft,".dirty=true;")),ze("a1(",ue.shared.context,",a0,",ue.batchId,");")}function ln(ue){if(!(typeof ue!="object"||ja(ue))){for(var Se=Object.keys(ue),ze=0;ze<Se.length;++ze)if(dr.isDynamic(ue[Se[ze]]))return!0;return!1}}function bi(ue,Se,ze){var Lt=Se.static[ze];if(!Lt||!ln(Lt))return;var Ft=ue.global,Ye=Object.keys(Lt),st=!1,pt=!1,Me=!1,rt=ue.global.def("{}");Ye.forEach(function(at){var Gt=Lt[at];if(dr.isDynamic(Gt)){typeof Gt=="function"&&(Gt=Lt[at]=dr.unbox(Gt));var or=Us(Gt,null);st=st||or.thisDep,Me=Me||or.propDep,pt=pt||or.contextDep}else{switch(Ft(rt,".",at,"="),typeof Gt){case"number":Ft(Gt);break;case"string":Ft('"',Gt,'"');break;case"object":Array.isArray(Gt)&&Ft("[",Gt.join(),"]");break;default:Ft(ue.link(Gt));break}Ft(";")}});function ve(at,Gt){Ye.forEach(function(or){var _r=Lt[or];if(dr.isDynamic(_r)){var vr=at.invoke(Gt,_r);Gt(rt,".",or,"=",vr,";")}})}Se.dynamic[ze]=new dr.DynamicVariable(hn,{thisDep:st,contextDep:pt,propDep:Me,ref:rt,append:ve}),delete Se.static[ze]}function da(ue,Se,ze,Lt,Ft){var Ye=tt();Ye.stats=Ye.link(Ft),Object.keys(Se.static).forEach(function(pt){bi(Ye,Se,pt)}),hf.forEach(function(pt){bi(Ye,ue,pt)});var st=go(ue,Se,ze,Lt,Ye);return yo(Ye,st),Bt(Ye,st),Zt(Ye,st),Ye.compile()}return{next:tn,current:gr,procs:function(){var ue=tt(),Se=ue.proc("poll"),ze=ue.proc("refresh"),Lt=ue.block();Se(Lt),ze(Lt);var Ft=ue.shared,Ye=Ft.gl,st=Ft.next,pt=Ft.current;Lt(pt,".dirty=false;"),Qa(ue,Se),Qa(ue,ze,null,!0);var Me;kr&&(Me=ue.link(kr)),Ze.oes_vertex_array_object&&ze(ue.link(Ze.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var rt=0;rt<Ut.maxAttributes;++rt){var ve=ze.def(Ft.attributes,"[",rt,"]"),at=ue.cond(ve,".buffer");at.then(Ye,".enableVertexAttribArray(",rt,");",Ye,".bindBuffer(",Lc,",",ve,".buffer.buffer);",Ye,".vertexAttribPointer(",rt,",",ve,".size,",ve,".type,",ve,".normalized,",ve,".stride,",ve,".offset);").else(Ye,".disableVertexAttribArray(",rt,");",Ye,".vertexAttrib4f(",rt,",",ve,".x,",ve,".y,",ve,".z,",ve,".w);",ve,".buffer=null;"),ze(at),kr&&ze(Me,".vertexAttribDivisorANGLE(",rt,",",ve,".divisor);")}return ze(ue.shared.vao,".currentVAO=null;",ue.shared.vao,".setVAO(",ue.shared.vao,".targetVAO);"),Object.keys(en).forEach(function(Gt){var or=en[Gt],_r=Lt.def(st,".",Gt),vr=ue.block();vr("if(",_r,"){",Ye,".enable(",or,")}else{",Ye,".disable(",or,")}",pt,".",Gt,"=",_r,";"),ze(vr),Se("if(",_r,"!==",pt,".",Gt,"){",vr,"}")}),Object.keys(xr).forEach(function(Gt){var or=xr[Gt],_r=gr[Gt],vr,Rr,Pn=ue.block();if(Pn(Ye,".",or,"("),ja(_r)){var _n=_r.length;vr=ue.global.def(st,".",Gt),Rr=ue.global.def(pt,".",Gt),Pn(di(_n,function(Sn){return vr+"["+Sn+"]"}),");",di(_n,function(Sn){return Rr+"["+Sn+"]="+vr+"["+Sn+"];"}).join("")),Se("if(",di(_n,function(Sn){return vr+"["+Sn+"]!=="+Rr+"["+Sn+"]"}).join("||"),"){",Pn,"}")}else vr=Lt.def(st,".",Gt),Rr=Lt.def(pt,".",Gt),Pn(vr,");",pt,".",Gt,"=",vr,";"),Se("if(",vr,"!==",Rr,"){",Pn,"}");ze(Pn)}),ue.compile()}(),compile:da}}function Ld(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Lv=34918,Yp=34919,Nd=35007,Nv=function(z,Ee){if(!Ee.ext_disjoint_timer_query)return null;var Ze=[];function Ut(){return Ze.pop()||Ee.ext_disjoint_timer_query.createQueryEXT()}function cr(kr){Ze.push(kr)}var zt=[];function kt(kr){var Jr=Ut();Ee.ext_disjoint_timer_query.beginQueryEXT(Nd,Jr),zt.push(Jr),Er(zt.length-1,zt.length,kr)}function Dr(){Ee.ext_disjoint_timer_query.endQueryEXT(Nd)}function wr(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var Zr=[];function Br(){return Zr.pop()||new wr}function Ur(kr){Zr.push(kr)}var Wr=[];function Er(kr,Jr,gr){var tn=Br();tn.startQueryIndex=kr,tn.endQueryIndex=Jr,tn.sum=0,tn.stats=gr,Wr.push(tn)}var zr=[],St=[];function Qt(){var kr,Jr,gr=zt.length;if(gr!==0){St.length=Math.max(St.length,gr+1),zr.length=Math.max(zr.length,gr+1),zr[0]=0,St[0]=0;var tn=0;for(kr=0,Jr=0;Jr<zt.length;++Jr){var Ir=zt[Jr];Ee.ext_disjoint_timer_query.getQueryObjectEXT(Ir,Yp)?(tn+=Ee.ext_disjoint_timer_query.getQueryObjectEXT(Ir,Lv),cr(Ir)):zt[kr++]=Ir,zr[Jr+1]=tn,St[Jr+1]=kr}for(zt.length=kr,kr=0,Jr=0;Jr<Wr.length;++Jr){var en=Wr[Jr],xr=en.startQueryIndex,Xr=en.endQueryIndex;en.sum+=zr[Xr]-zr[xr];var Fn=St[xr],ui=St[Xr];ui===Fn?(en.stats.gpuTime+=en.sum/1e6,Ur(en)):(en.startQueryIndex=Fn,en.endQueryIndex=ui,Wr[kr++]=en)}Wr.length=kr}}return{beginQuery:kt,endQuery:Dr,pushScopeStats:Er,update:Qt,getNumPendingQueries:function(){return zt.length},clear:function(){Ze.push.apply(Ze,zt);for(var kr=0;kr<Ze.length;kr++)Ee.ext_disjoint_timer_query.deleteQueryEXT(Ze[kr]);zt.length=0,Ze.length=0},restore:function(){zt.length=0,Ze.length=0}}},Dh=16384,Jo=256,Uv=1024,$f=34962,qp="webglcontextlost",Ud="webglcontextrestored",Kp=1,zv=2,Zv=3;function zd(z,Ee){for(var Ze=0;Ze<z.length;++Ze)if(z[Ze]===Ee)return Ze;return-1}function Zd(z){var Ee=Eo(z);if(!Ee)return null;var Ze=Ee.gl,Ut=Ze.getContextAttributes(),cr=Ze.isContextLost(),zt=Ks(Ze,Ee);if(!zt)return null;var kt=En(),Dr=Ld(),wr=zt.extensions,Zr=Nv(Ze,wr),Br=Ln(),Ur=Ze.drawingBufferWidth,Wr=Ze.drawingBufferHeight,Er={tick:0,time:0,viewportWidth:Ur,viewportHeight:Wr,framebufferWidth:Ur,framebufferHeight:Wr,drawingBufferWidth:Ur,drawingBufferHeight:Wr,pixelRatio:Ee.pixelRatio},zr={},St={elements:null,primitive:4,count:-1,offset:0,instances:-1},Qt=Cc(Ze,wr),kr=ph(Ze,Dr,Ee,gr),Jr=Y(Ze,wr,Qt,Dr,kr);function gr(Wn){return Jr.destroyBuffer(Wn)}var tn=Ji(Ze,wr,kr,Dr),Ir=Pe(Ze,kt,Dr,Ee),en=Ie(Ze,wr,Qt,function(){Fn.procs.poll()},Er,Dr,Ee),xr=mu(Ze,wr,Qt,Dr,Ee),Xr=w(Ze,wr,Qt,en,xr,Dr),Fn=Xf(Ze,kt,wr,Qt,kr,tn,en,Xr,zr,Jr,Ir,St,Er,Zr,Ee),ui=At(Ze,Xr,Fn.procs.poll,Er,Ut,wr,Qt),qr=Fn.next,gt=Ze.canvas,pr=[],tt=[],wi=[],on=[Ee.onDestroy],yi=null;function ai(){if(pr.length===0){Zr&&Zr.update(),yi=null;return}yi=Vr.next(ai),ps();for(var Wn=pr.length-1;Wn>=0;--Wn){var Mi=pr[Wn];Mi&&Mi(Er,null,0)}Ze.flush(),Zr&&Zr.update()}function Yn(){!yi&&pr.length>0&&(yi=Vr.next(ai))}function Ui(){yi&&(Vr.cancel(ai),yi=null)}function mo(Wn){Wn.preventDefault(),cr=!0,Ui(),tt.forEach(function(Mi){Mi()})}function Wo(Wn){Ze.getError(),cr=!1,zt.restore(),Ir.restore(),kr.restore(),en.restore(),xr.restore(),Xr.restore(),Jr.restore(),Zr&&Zr.restore(),Fn.procs.refresh(),Yn(),wi.forEach(function(Mi){Mi()})}gt&&(gt.addEventListener(qp,mo,!1),gt.addEventListener(Ud,Wo,!1));function Ri(){pr.length=0,Ui(),gt&&(gt.removeEventListener(qp,mo),gt.removeEventListener(Ud,Wo)),Ir.clear(),Xr.clear(),xr.clear(),en.clear(),tn.clear(),kr.clear(),Jr.clear(),Zr&&Zr.clear(),on.forEach(function(Wn){Wn()})}function lo(Wn){F(!!Wn,"invalid args to regl({...})"),F.type(Wn,"object","invalid args to regl({...})");function Mi(Ft){var Ye=L({},Ft);delete Ye.uniforms,delete Ye.attributes,delete Ye.context,delete Ye.vao,"stencil"in Ye&&Ye.stencil.op&&(Ye.stencil.opBack=Ye.stencil.opFront=Ye.stencil.op,delete Ye.stencil.op);function st(pt){if(pt in Ye){var Me=Ye[pt];delete Ye[pt],Object.keys(Me).forEach(function(rt){Ye[pt+"."+rt]=Me[rt]})}}return st("blend"),st("depth"),st("cull"),st("stencil"),st("polygonOffset"),st("scissor"),st("sample"),"vao"in Ft&&(Ye.vao=Ft.vao),Ye}function Gi(Ft){var Ye={},st={};return Object.keys(Ft).forEach(function(pt){var Me=Ft[pt];dr.isDynamic(Me)?st[pt]=dr.unbox(Me,pt):Ye[pt]=Me}),{dynamic:st,static:Ye}}var yo=Gi(Wn.context||{}),Xu=Gi(Wn.uniforms||{}),ke=Gi(Wn.attributes||{}),Zt=Gi(Mi(Wn)),Bt={gpuTime:0,cpuTime:0,count:0},ln=Fn.compile(Zt,ke,Xu,yo,Bt),bi=ln.draw,da=ln.batch,ue=ln.scope,Se=[];function ze(Ft){for(;Se.length<Ft;)Se.push(null);return Se}function Lt(Ft,Ye){var st;if(cr&&F.raise("context lost"),typeof Ft=="function")return ue.call(this,null,Ft,0);if(typeof Ye=="function")if(typeof Ft=="number")for(st=0;st<Ft;++st)ue.call(this,null,Ye,st);else if(Array.isArray(Ft))for(st=0;st<Ft.length;++st)ue.call(this,Ft[st],Ye,st);else return ue.call(this,Ft,Ye,0);else if(typeof Ft=="number"){if(Ft>0)return da.call(this,ze(Ft|0),Ft|0)}else if(Array.isArray(Ft)){if(Ft.length)return da.call(this,Ft,Ft.length)}else return bi.call(this,Ft)}return L(Lt,{stats:Bt})}var Sa=Xr.setFBO=lo({framebuffer:dr.define.call(null,Kp,"framebuffer")});function go(Wn,Mi){var Gi=0;Fn.procs.poll();var yo=Mi.color;yo&&(Ze.clearColor(+yo[0]||0,+yo[1]||0,+yo[2]||0,+yo[3]||0),Gi|=Dh),"depth"in Mi&&(Ze.clearDepth(+Mi.depth),Gi|=Jo),"stencil"in Mi&&(Ze.clearStencil(Mi.stencil|0),Gi|=Uv),F(!!Gi,"called regl.clear with no buffer specified"),Ze.clear(Gi)}function _o(Wn){if(F(typeof Wn=="object"&&Wn,"regl.clear() takes an object as input"),"framebuffer"in Wn)if(Wn.framebuffer&&Wn.framebuffer_reglType==="framebufferCube")for(var Mi=0;Mi<6;++Mi)Sa(L({framebuffer:Wn.framebuffer.faces[Mi]},Wn),go);else Sa(Wn,go);else go(null,Wn)}function Qa(Wn){F.type(Wn,"function","regl.frame() callback must be a function"),pr.push(Wn);function Mi(){var Gi=zd(pr,Wn);F(Gi>=0,"cannot cancel a frame twice");function yo(){var Xu=zd(pr,yo);pr[Xu]=pr[pr.length-1],pr.length-=1,pr.length<=0&&Ui()}pr[Gi]=yo}return Yn(),{cancel:Mi}}function Ro(){var Wn=qr.viewport,Mi=qr.scissor_box;Wn[0]=Wn[1]=Mi[0]=Mi[1]=0,Er.viewportWidth=Er.framebufferWidth=Er.drawingBufferWidth=Wn[2]=Mi[2]=Ze.drawingBufferWidth,Er.viewportHeight=Er.framebufferHeight=Er.drawingBufferHeight=Wn[3]=Mi[3]=Ze.drawingBufferHeight}function ps(){Er.tick+=1,Er.time=xi(),Ro(),Fn.procs.poll()}function Mo(){Ro(),Fn.procs.refresh(),Zr&&Zr.update()}function xi(){return(Ln()-Br)/1e3}Mo();function es(Wn,Mi){F.type(Mi,"function","listener callback must be a function");var Gi;switch(Wn){case"frame":return Qa(Mi);case"lost":Gi=tt;break;case"restore":Gi=wi;break;case"destroy":Gi=on;break;default:F.raise("invalid event, must be one of frame,lost,restore,destroy")}return Gi.push(Mi),{cancel:function(){for(var yo=0;yo<Gi.length;++yo)if(Gi[yo]===Mi){Gi[yo]=Gi[Gi.length-1],Gi.pop();return}}}}var aa=L(lo,{clear:_o,prop:dr.define.bind(null,Kp),context:dr.define.bind(null,zv),this:dr.define.bind(null,Zv),draw:lo({}),buffer:function(Wn){return kr.create(Wn,$f,!1,!1)},elements:function(Wn){return tn.create(Wn,!1)},texture:en.create2D,cube:en.createCube,renderbuffer:xr.create,framebuffer:Xr.create,framebufferCube:Xr.createCube,vao:Jr.createVAO,attributes:Ut,frame:Qa,on:es,limits:Qt,hasExtension:function(Wn){return Qt.extensions.indexOf(Wn.toLowerCase())>=0},read:ui,destroy:Ri,_gl:Ze,_refresh:Mo,poll:function(){ps(),Zr&&Zr.update()},now:xi,stats:Dr});return Ee.onDone(null,aa),aa}return Zd})},48096:function(rr){(function(J,L){rr.exports=L()})(this,function(){"use strict";function J(Et,nt,Pt,ft,qt,Sr){if(!(qt-ft<=Pt)){var te=ft+qt>>1;L(Et,nt,te,ft,qt,Sr%2),J(Et,nt,Pt,ft,te-1,Sr+1),J(Et,nt,Pt,te+1,qt,Sr+1)}}function L(Et,nt,Pt,ft,qt,Sr){for(;qt>ft;){if(qt-ft>600){var te=qt-ft+1,H=Pt-ft+1,K=Math.log(te),Be=.5*Math.exp(2*K/3),Ae=.5*Math.sqrt(K*Be*(te-Be)/te)*(H-te/2<0?-1:1),dt=Math.max(ft,Math.floor(Pt-H*Be/te+Ae)),Ue=Math.min(qt,Math.floor(Pt+(te-H)*Be/te+Ae));L(Et,nt,Pt,dt,Ue,Sr)}var We=nt[2*Pt+Sr],it=ft,Mt=qt;for(re(Et,nt,ft,Pt),nt[2*qt+Sr]>We&&re(Et,nt,ft,qt);it<Mt;){for(re(Et,nt,it,Mt),it++,Mt--;nt[2*it+Sr]<We;)it++;for(;nt[2*Mt+Sr]>We;)Mt--}nt[2*ft+Sr]===We?re(Et,nt,ft,Mt):(Mt++,re(Et,nt,Mt,qt)),Mt<=Pt&&(ft=Mt+1),Pt<=Mt&&(qt=Mt-1)}}function re(Et,nt,Pt,ft){pe(Et,Pt,ft),pe(nt,2*Pt,2*ft),pe(nt,2*Pt+1,2*ft+1)}function pe(Et,nt,Pt){var ft=Et[nt];Et[nt]=Et[Pt],Et[Pt]=ft}function _(Et,nt,Pt,ft,qt,Sr,te){for(var H=[0,Et.length-1,0],K=[],Be,Ae;H.length;){var dt=H.pop(),Ue=H.pop(),We=H.pop();if(Ue-We<=te){for(var it=We;it<=Ue;it++)Be=nt[2*it],Ae=nt[2*it+1],Be>=Pt&&Be<=qt&&Ae>=ft&&Ae<=Sr&&K.push(Et[it]);continue}var Mt=Math.floor((We+Ue)/2);Be=nt[2*Mt],Ae=nt[2*Mt+1],Be>=Pt&&Be<=qt&&Ae>=ft&&Ae<=Sr&&K.push(Et[Mt]);var yr=(dt+1)%2;(dt===0?Pt<=Be:ft<=Ae)&&(H.push(We),H.push(Mt-1),H.push(yr)),(dt===0?qt>=Be:Sr>=Ae)&&(H.push(Mt+1),H.push(Ue),H.push(yr))}return K}function le(Et,nt,Pt,ft,qt,Sr){for(var te=[0,Et.length-1,0],H=[],K=qt*qt;te.length;){var Be=te.pop(),Ae=te.pop(),dt=te.pop();if(Ae-dt<=Sr){for(var Ue=dt;Ue<=Ae;Ue++)U(nt[2*Ue],nt[2*Ue+1],Pt,ft)<=K&&H.push(Et[Ue]);continue}var We=Math.floor((dt+Ae)/2),it=nt[2*We],Mt=nt[2*We+1];U(it,Mt,Pt,ft)<=K&&H.push(Et[We]);var yr=(Be+1)%2;(Be===0?Pt-qt<=it:ft-qt<=Mt)&&(te.push(dt),te.push(We-1),te.push(yr)),(Be===0?Pt+qt>=it:ft+qt>=Mt)&&(te.push(We+1),te.push(Ae),te.push(yr))}return H}function U(Et,nt,Pt,ft){var qt=Et-Pt,Sr=nt-ft;return qt*qt+Sr*Sr}var he=function(Et){return Et[0]},ae=function(Et){return Et[1]},qe=function(nt,Pt,ft,qt,Sr){Pt===void 0&&(Pt=he),ft===void 0&&(ft=ae),qt===void 0&&(qt=64),Sr===void 0&&(Sr=Float64Array),this.nodeSize=qt,this.points=nt;for(var te=nt.length<65536?Uint16Array:Uint32Array,H=this.ids=new te(nt.length),K=this.coords=new Sr(nt.length*2),Be=0;Be<nt.length;Be++)H[Be]=Be,K[2*Be]=Pt(nt[Be]),K[2*Be+1]=ft(nt[Be]);J(H,K,qt,0,H.length-1,0)};qe.prototype.range=function(nt,Pt,ft,qt){return _(this.ids,this.coords,nt,Pt,ft,qt,this.nodeSize)},qe.prototype.within=function(nt,Pt,ft){return le(this.ids,this.coords,nt,Pt,ft,this.nodeSize)};var ie={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(Et){return Et}},Ke=Math.fround||function(Et){return function(nt){return Et[0]=+nt,Et[0]}}(new Float32Array(1)),ht=function(nt){this.options=Pr(Object.create(ie),nt),this.trees=new Array(this.options.maxZoom+1)};ht.prototype.load=function(nt){var Pt=this.options,ft=Pt.log,qt=Pt.minZoom,Sr=Pt.maxZoom,te=Pt.nodeSize;ft&&console.time("total time");var H="prepare "+nt.length+" points";ft&&console.time(H),this.points=nt;for(var K=[],Be=0;Be<nt.length;Be++)nt[Be].geometry&&K.push(Dt(nt[Be],Be));this.trees[Sr+1]=new qe(K,hr,ur,te,Float32Array),ft&&console.timeEnd(H);for(var Ae=Sr;Ae>=qt;Ae--){var dt=+Date.now();K=this._cluster(K,Ae),this.trees[Ae]=new qe(K,hr,ur,te,Float32Array),ft&&console.log("z%d: %d clusters in %dms",Ae,K.length,+Date.now()-dt)}return ft&&console.timeEnd("total time"),this},ht.prototype.getClusters=function(nt,Pt){var ft=((nt[0]+180)%360+360)%360-180,qt=Math.max(-90,Math.min(90,nt[1])),Sr=nt[2]===180?180:((nt[2]+180)%360+360)%360-180,te=Math.max(-90,Math.min(90,nt[3]));if(nt[2]-nt[0]>=360)ft=-180,Sr=180;else if(ft>Sr){var H=this.getClusters([ft,qt,180,te],Pt),K=this.getClusters([-180,qt,Sr,te],Pt);return H.concat(K)}for(var Be=this.trees[this._limitZoom(Pt)],Ae=Be.range(ir(ft),Xt(te),ir(Sr),Xt(qt)),dt=[],Ue=0,We=Ae;Ue<We.length;Ue+=1){var it=We[Ue],Mt=Be.points[it];dt.push(Mt.numPoints?Yt(Mt):this.points[Mt.index])}return dt},ht.prototype.getChildren=function(nt){var Pt=this._getOriginId(nt),ft=this._getOriginZoom(nt),qt="No cluster with the specified id.",Sr=this.trees[ft];if(!Sr)throw new Error(qt);var te=Sr.points[Pt];if(!te)throw new Error(qt);for(var H=this.options.radius/(this.options.extent*Math.pow(2,ft-1)),K=Sr.within(te.x,te.y,H),Be=[],Ae=0,dt=K;Ae<dt.length;Ae+=1){var Ue=dt[Ae],We=Sr.points[Ue];We.parentId===nt&&Be.push(We.numPoints?Yt(We):this.points[We.index])}if(Be.length===0)throw new Error(qt);return Be},ht.prototype.getLeaves=function(nt,Pt,ft){Pt=Pt||10,ft=ft||0;var qt=[];return this._appendLeaves(qt,nt,Pt,ft,0),qt},ht.prototype.getTile=function(nt,Pt,ft){var qt=this.trees[this._limitZoom(nt)],Sr=Math.pow(2,nt),te=this.options,H=te.extent,K=te.radius,Be=K/H,Ae=(ft-Be)/Sr,dt=(ft+1+Be)/Sr,Ue={features:[]};return this._addTileFeatures(qt.range((Pt-Be)/Sr,Ae,(Pt+1+Be)/Sr,dt),qt.points,Pt,ft,Sr,Ue),Pt===0&&this._addTileFeatures(qt.range(1-Be/Sr,Ae,1,dt),qt.points,Sr,ft,Sr,Ue),Pt===Sr-1&&this._addTileFeatures(qt.range(0,Ae,Be/Sr,dt),qt.points,-1,ft,Sr,Ue),Ue.features.length?Ue:null},ht.prototype.getClusterExpansionZoom=function(nt){for(var Pt=this._getOriginZoom(nt)-1;Pt<=this.options.maxZoom;){var ft=this.getChildren(nt);if(Pt++,ft.length!==1)break;nt=ft[0].properties.cluster_id}return Pt},ht.prototype._appendLeaves=function(nt,Pt,ft,qt,Sr){for(var te=this.getChildren(Pt),H=0,K=te;H<K.length;H+=1){var Be=K[H],Ae=Be.properties;if(Ae&&Ae.cluster?Sr+Ae.point_count<=qt?Sr+=Ae.point_count:Sr=this._appendLeaves(nt,Ae.cluster_id,ft,qt,Sr):Sr<qt?Sr++:nt.push(Be),nt.length===ft)break}return Sr},ht.prototype._addTileFeatures=function(nt,Pt,ft,qt,Sr,te){for(var H=0,K=nt;H<K.length;H+=1){var Be=K[H],Ae=Pt[Be],dt=Ae.numPoints,Ue=void 0,We=void 0,it=void 0;if(dt)Ue=Ht(Ae),We=Ae.x,it=Ae.y;else{var Mt=this.points[Ae.index];Ue=Mt.properties,We=ir(Mt.geometry.coordinates[0]),it=Xt(Mt.geometry.coordinates[1])}var yr={type:1,geometry:[[Math.round(this.options.extent*(We*Sr-ft)),Math.round(this.options.extent*(it*Sr-qt))]],tags:Ue},lr=void 0;dt?lr=Ae.id:this.options.generateId?lr=Ae.index:this.points[Ae.index].id&&(lr=this.points[Ae.index].id),lr!==void 0&&(yr.id=lr),te.features.push(yr)}},ht.prototype._limitZoom=function(nt){return Math.max(this.options.minZoom,Math.min(Math.floor(+nt),this.options.maxZoom+1))},ht.prototype._cluster=function(nt,Pt){for(var ft=[],qt=this.options,Sr=qt.radius,te=qt.extent,H=qt.reduce,K=qt.minPoints,Be=Sr/(te*Math.pow(2,Pt)),Ae=0;Ae<nt.length;Ae++){var dt=nt[Ae];if(!(dt.zoom<=Pt)){dt.zoom=Pt;for(var Ue=this.trees[Pt+1],We=Ue.within(dt.x,dt.y,Be),it=dt.numPoints||1,Mt=it,yr=0,lr=We;yr<lr.length;yr+=1){var Cn=lr[yr],mn=Ue.points[Cn];mn.zoom>Pt&&(Mt+=mn.numPoints||1)}if(Mt>it&&Mt>=K){for(var un=dt.x*it,oi=dt.y*it,jn=H&&it>1?this._map(dt,!0):null,rn=(Ae<<5)+(Pt+1)+this.points.length,$i=0,Wi=We;$i<Wi.length;$i+=1){var Zi=Wi[$i],Jn=Ue.points[Zi];if(!(Jn.zoom<=Pt)){Jn.zoom=Pt;var Bn=Jn.numPoints||1;un+=Jn.x*Bn,oi+=Jn.y*Bn,Jn.parentId=rn,H&&(jn||(jn=this._map(dt,!0)),H(jn,this._map(Jn)))}}dt.parentId=rn,ft.push(mt(un/Mt,oi/Mt,rn,Mt,jn))}else if(ft.push(dt),Mt>1)for(var Do=0,oa=We;Do<oa.length;Do+=1){var $a=oa[Do],Ot=Ue.points[$a];Ot.zoom<=Pt||(Ot.zoom=Pt,ft.push(Ot))}}}return ft},ht.prototype._getOriginId=function(nt){return nt-this.points.length>>5},ht.prototype._getOriginZoom=function(nt){return(nt-this.points.length)%32},ht.prototype._map=function(nt,Pt){if(nt.numPoints)return Pt?Pr({},nt.properties):nt.properties;var ft=this.points[nt.index].properties,qt=this.options.map(ft);return Pt&&qt===ft?Pr({},qt):qt};function mt(Et,nt,Pt,ft,qt){return{x:Ke(Et),y:Ke(nt),zoom:1/0,id:Pt,parentId:-1,numPoints:ft,properties:qt}}function Dt(Et,nt){var Pt=Et.geometry.coordinates,ft=Pt[0],qt=Pt[1];return{x:Ke(ir(ft)),y:Ke(Xt(qt)),zoom:1/0,index:nt,parentId:-1}}function Yt(Et){return{type:"Feature",id:Et.id,properties:Ht(Et),geometry:{type:"Point",coordinates:[yt(Et.x),bt(Et.y)]}}}function Ht(Et){var nt=Et.numPoints,Pt=nt>=1e4?Math.round(nt/1e3)+"k":nt>=1e3?Math.round(nt/100)/10+"k":nt;return Pr(Pr({},Et.properties),{cluster:!0,cluster_id:Et.id,point_count:nt,point_count_abbreviated:Pt})}function ir(Et){return Et/360+.5}function Xt(Et){var nt=Math.sin(Et*Math.PI/180),Pt=.5-.25*Math.log((1+nt)/(1-nt))/Math.PI;return Pt<0?0:Pt>1?1:Pt}function yt(Et){return(Et-.5)*360}function bt(Et){var nt=(180-Et*360)*Math.PI/180;return 360*Math.atan(Math.exp(nt))/Math.PI-90}function Pr(Et,nt){for(var Pt in nt)Et[Pt]=nt[Pt];return Et}function hr(Et){return Et.x}function ur(Et){return Et.y}return ht})},19684:function(rr,J,L){var re=L(79569).default;function pe(){"use strict";rr.exports=pe=function(){return le},rr.exports.__esModule=!0,rr.exports.default=rr.exports;var _,le={},U=Object.prototype,he=U.hasOwnProperty,ae=Object.defineProperty||function(Ue,We,it){Ue[We]=it.value},qe=typeof Symbol=="function"?Symbol:{},ie=qe.iterator||"@@iterator",Ke=qe.asyncIterator||"@@asyncIterator",ht=qe.toStringTag||"@@toStringTag";function mt(Ue,We,it){return Object.defineProperty(Ue,We,{value:it,enumerable:!0,configurable:!0,writable:!0}),Ue[We]}try{mt({},"")}catch(Ue){mt=function(it,Mt,yr){return it[Mt]=yr}}function Dt(Ue,We,it,Mt){var yr=We&&We.prototype instanceof Pr?We:Pr,lr=Object.create(yr.prototype),Cn=new Ae(Mt||[]);return ae(lr,"_invoke",{value:te(Ue,it,Cn)}),lr}function Yt(Ue,We,it){try{return{type:"normal",arg:Ue.call(We,it)}}catch(Mt){return{type:"throw",arg:Mt}}}le.wrap=Dt;var Ht="suspendedStart",ir="suspendedYield",Xt="executing",yt="completed",bt={};function Pr(){}function hr(){}function ur(){}var Et={};mt(Et,ie,function(){return this});var nt=Object.getPrototypeOf,Pt=nt&&nt(nt(dt([])));Pt&&Pt!==U&&he.call(Pt,ie)&&(Et=Pt);var ft=ur.prototype=Pr.prototype=Object.create(Et);function qt(Ue){["next","throw","return"].forEach(function(We){mt(Ue,We,function(it){return this._invoke(We,it)})})}function Sr(Ue,We){function it(yr,lr,Cn,mn){var un=Yt(Ue[yr],Ue,lr);if(un.type!=="throw"){var oi=un.arg,jn=oi.value;return jn&&re(jn)=="object"&&he.call(jn,"__await")?We.resolve(jn.__await).then(function(rn){it("next",rn,Cn,mn)},function(rn){it("throw",rn,Cn,mn)}):We.resolve(jn).then(function(rn){oi.value=rn,Cn(oi)},function(rn){return it("throw",rn,Cn,mn)})}mn(un.arg)}var Mt;ae(this,"_invoke",{value:function(lr,Cn){function mn(){return new We(function(un,oi){it(lr,Cn,un,oi)})}return Mt=Mt?Mt.then(mn,mn):mn()}})}function te(Ue,We,it){var Mt=Ht;return function(yr,lr){if(Mt===Xt)throw new Error("Generator is already running");if(Mt===yt){if(yr==="throw")throw lr;return{value:_,done:!0}}for(it.method=yr,it.arg=lr;;){var Cn=it.delegate;if(Cn){var mn=H(Cn,it);if(mn){if(mn===bt)continue;return mn}}if(it.method==="next")it.sent=it._sent=it.arg;else if(it.method==="throw"){if(Mt===Ht)throw Mt=yt,it.arg;it.dispatchException(it.arg)}else it.method==="return"&&it.abrupt("return",it.arg);Mt=Xt;var un=Yt(Ue,We,it);if(un.type==="normal"){if(Mt=it.done?yt:ir,un.arg===bt)continue;return{value:un.arg,done:it.done}}un.type==="throw"&&(Mt=yt,it.method="throw",it.arg=un.arg)}}}function H(Ue,We){var it=We.method,Mt=Ue.iterator[it];if(Mt===_)return We.delegate=null,it==="throw"&&Ue.iterator.return&&(We.method="return",We.arg=_,H(Ue,We),We.method==="throw")||it!=="return"&&(We.method="throw",We.arg=new TypeError("The iterator does not provide a '"+it+"' method")),bt;var yr=Yt(Mt,Ue.iterator,We.arg);if(yr.type==="throw")return We.method="throw",We.arg=yr.arg,We.delegate=null,bt;var lr=yr.arg;return lr?lr.done?(We[Ue.resultName]=lr.value,We.next=Ue.nextLoc,We.method!=="return"&&(We.method="next",We.arg=_),We.delegate=null,bt):lr:(We.method="throw",We.arg=new TypeError("iterator result is not an object"),We.delegate=null,bt)}function K(Ue){var We={tryLoc:Ue[0]};1 in Ue&&(We.catchLoc=Ue[1]),2 in Ue&&(We.finallyLoc=Ue[2],We.afterLoc=Ue[3]),this.tryEntries.push(We)}function Be(Ue){var We=Ue.completion||{};We.type="normal",delete We.arg,Ue.completion=We}function Ae(Ue){this.tryEntries=[{tryLoc:"root"}],Ue.forEach(K,this),this.reset(!0)}function dt(Ue){if(Ue||Ue===""){var We=Ue[ie];if(We)return We.call(Ue);if(typeof Ue.next=="function")return Ue;if(!isNaN(Ue.length)){var it=-1,Mt=function yr(){for(;++it<Ue.length;)if(he.call(Ue,it))return yr.value=Ue[it],yr.done=!1,yr;return yr.value=_,yr.done=!0,yr};return Mt.next=Mt}}throw new TypeError(re(Ue)+" is not iterable")}return hr.prototype=ur,ae(ft,"constructor",{value:ur,configurable:!0}),ae(ur,"constructor",{value:hr,configurable:!0}),hr.displayName=mt(ur,ht,"GeneratorFunction"),le.isGeneratorFunction=function(Ue){var We=typeof Ue=="function"&&Ue.constructor;return!!We&&(We===hr||(We.displayName||We.name)==="GeneratorFunction")},le.mark=function(Ue){return Object.setPrototypeOf?Object.setPrototypeOf(Ue,ur):(Ue.__proto__=ur,mt(Ue,ht,"GeneratorFunction")),Ue.prototype=Object.create(ft),Ue},le.awrap=function(Ue){return{__await:Ue}},qt(Sr.prototype),mt(Sr.prototype,Ke,function(){return this}),le.AsyncIterator=Sr,le.async=function(Ue,We,it,Mt,yr){yr===void 0&&(yr=Promise);var lr=new Sr(Dt(Ue,We,it,Mt),yr);return le.isGeneratorFunction(We)?lr:lr.next().then(function(Cn){return Cn.done?Cn.value:lr.next()})},qt(ft),mt(ft,ht,"Generator"),mt(ft,ie,function(){return this}),mt(ft,"toString",function(){return"[object Generator]"}),le.keys=function(Ue){var We=Object(Ue),it=[];for(var Mt in We)it.push(Mt);return it.reverse(),function yr(){for(;it.length;){var lr=it.pop();if(lr in We)return yr.value=lr,yr.done=!1,yr}return yr.done=!0,yr}},le.values=dt,Ae.prototype={constructor:Ae,reset:function(We){if(this.prev=0,this.next=0,this.sent=this._sent=_,this.done=!1,this.delegate=null,this.method="next",this.arg=_,this.tryEntries.forEach(Be),!We)for(var it in this)it.charAt(0)==="t"&&he.call(this,it)&&!isNaN(+it.slice(1))&&(this[it]=_)},stop:function(){this.done=!0;var We=this.tryEntries[0].completion;if(We.type==="throw")throw We.arg;return this.rval},dispatchException:function(We){if(this.done)throw We;var it=this;function Mt(oi,jn){return Cn.type="throw",Cn.arg=We,it.next=oi,jn&&(it.method="next",it.arg=_),!!jn}for(var yr=this.tryEntries.length-1;yr>=0;--yr){var lr=this.tryEntries[yr],Cn=lr.completion;if(lr.tryLoc==="root")return Mt("end");if(lr.tryLoc<=this.prev){var mn=he.call(lr,"catchLoc"),un=he.call(lr,"finallyLoc");if(mn&&un){if(this.prev<lr.catchLoc)return Mt(lr.catchLoc,!0);if(this.prev<lr.finallyLoc)return Mt(lr.finallyLoc)}else if(mn){if(this.prev<lr.catchLoc)return Mt(lr.catchLoc,!0)}else{if(!un)throw new Error("try statement without catch or finally");if(this.prev<lr.finallyLoc)return Mt(lr.finallyLoc)}}}},abrupt:function(We,it){for(var Mt=this.tryEntries.length-1;Mt>=0;--Mt){var yr=this.tryEntries[Mt];if(yr.tryLoc<=this.prev&&he.call(yr,"finallyLoc")&&this.prev<yr.finallyLoc){var lr=yr;break}}lr&&(We==="break"||We==="continue")&&lr.tryLoc<=it&&it<=lr.finallyLoc&&(lr=null);var Cn=lr?lr.completion:{};return Cn.type=We,Cn.arg=it,lr?(this.method="next",this.next=lr.finallyLoc,bt):this.complete(Cn)},complete:function(We,it){if(We.type==="throw")throw We.arg;return We.type==="break"||We.type==="continue"?this.next=We.arg:We.type==="return"?(this.rval=this.arg=We.arg,this.method="return",this.next="end"):We.type==="normal"&&it&&(this.next=it),bt},finish:function(We){for(var it=this.tryEntries.length-1;it>=0;--it){var Mt=this.tryEntries[it];if(Mt.finallyLoc===We)return this.complete(Mt.completion,Mt.afterLoc),Be(Mt),bt}},catch:function(We){for(var it=this.tryEntries.length-1;it>=0;--it){var Mt=this.tryEntries[it];if(Mt.tryLoc===We){var yr=Mt.completion;if(yr.type==="throw"){var lr=yr.arg;Be(Mt)}return lr}}throw new Error("illegal catch attempt")},delegateYield:function(We,it,Mt){return this.delegate={iterator:dt(We),resultName:it,nextLoc:Mt},this.method==="next"&&(this.arg=_),bt}},le}rr.exports=pe,rr.exports.__esModule=!0,rr.exports.default=rr.exports},79569:function(rr){function J(L){"@babel/helpers - typeof";return rr.exports=J=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(re){return typeof re}:function(re){return re&&typeof Symbol=="function"&&re.constructor===Symbol&&re!==Symbol.prototype?"symbol":typeof re},rr.exports.__esModule=!0,rr.exports.default=rr.exports,J(L)}rr.exports=J,rr.exports.__esModule=!0,rr.exports.default=rr.exports},51726:function(rr,J,L){var re=L(19684)();rr.exports=re;try{regeneratorRuntime=re}catch(pe){typeof globalThis=="object"?globalThis.regeneratorRuntime=re:Function("r","regeneratorRuntime = r")(re)}}}]);
}());